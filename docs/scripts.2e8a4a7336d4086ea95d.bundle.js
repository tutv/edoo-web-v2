webpackJsonp([1,3],{1094:function(t,n,e){e(452),e(451),e(453),e(458),e(457),e(454),e(455),t.exports=e(456)},451:function(t,n,e){e(76)(e(762))},452:function(t,n,e){e(76)(e(763))},453:function(t,n,e){e(76)(e(764))},454:function(t,n,e){e(76)(e(765))},455:function(t,n,e){e(76)(e(766))},456:function(t,n,e){e(76)(e(767))},457:function(t,n,e){e(76)(e(768))},458:function(t,n,e){e(76)(e(769))},76:function(t,n){t.exports=function(t){"undefined"!=typeof execScript?execScript(t):eval.call(null,t)}},762:function(t,n){t.exports='/*!\n * Bootstrap v3.3.7 (http://getbootstrap.com)\n * Copyright 2011-2016 Twitter, Inc.\n * Licensed under the MIT license\n */\nif("undefined"==typeof jQuery)throw new Error("Bootstrap\'s JavaScript requires jQuery");+function(a){"use strict";var b=a.fn.jquery.split(" ")[0].split(".");if(b[0]<2&&b[1]<9||1==b[0]&&9==b[1]&&b[2]<1||b[0]>3)throw new Error("Bootstrap\'s JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(jQuery),+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one("bsTransitionEnd",function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){if(a(b.target).is(this))return b.handleObj.handler.apply(this,arguments)}})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var c=a(this),e=c.data("bs.alert");e||c.data("bs.alert",e=new d(this)),"string"==typeof b&&e[b].call(c)})}var c=\'[data-dismiss="alert"]\',d=function(b){a(b).on("click",c,this.close)};d.VERSION="3.3.7",d.TRANSITION_DURATION=150,d.prototype.close=function(b){function c(){g.detach().trigger("closed.bs.alert").remove()}var e=a(this),f=e.attr("data-target");f||(f=e.attr("href"),f=f&&f.replace(/.*(?=#[^\\s]*$)/,""));var g=a("#"===f?[]:f);b&&b.preventDefault(),g.length||(g=e.closest(".alert")),g.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(g.removeClass("in"),a.support.transition&&g.hasClass("fade")?g.one("bsTransitionEnd",c).emulateTransitionEnd(d.TRANSITION_DURATION):c())};var e=a.fn.alert;a.fn.alert=b,a.fn.alert.Constructor=d,a.fn.alert.noConflict=function(){return a.fn.alert=e,this},a(document).on("click.bs.alert.data-api",c,d.prototype.close)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.button"),f="object"==typeof b&&b;e||d.data("bs.button",e=new c(this,f)),"toggle"==b?e.toggle():b&&e.setState(b)})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.isLoading=!1};c.VERSION="3.3.7",c.DEFAULTS={loadingText:"loading..."},c.prototype.setState=function(b){var c="disabled",d=this.$element,e=d.is("input")?"val":"html",f=d.data();b+="Text",null==f.resetText&&d.data("resetText",d[e]()),setTimeout(a.proxy(function(){d[e](null==f[b]?this.options[b]:f[b]),"loadingText"==b?(this.isLoading=!0,d.addClass(c).attr(c,c).prop(c,!0)):this.isLoading&&(this.isLoading=!1,d.removeClass(c).removeAttr(c).prop(c,!1))},this),0)},c.prototype.toggle=function(){var a=!0,b=this.$element.closest(\'[data-toggle="buttons"]\');if(b.length){var c=this.$element.find("input");"radio"==c.prop("type")?(c.prop("checked")&&(a=!1),b.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==c.prop("type")&&(c.prop("checked")!==this.$element.hasClass("active")&&(a=!1),this.$element.toggleClass("active")),c.prop("checked",this.$element.hasClass("active")),a&&c.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var d=a.fn.button;a.fn.button=b,a.fn.button.Constructor=c,a.fn.button.noConflict=function(){return a.fn.button=d,this},a(document).on("click.bs.button.data-api",\'[data-toggle^="button"]\',function(c){var d=a(c.target).closest(".btn");b.call(d,"toggle"),a(c.target).is(\'input[type="radio"], input[type="checkbox"]\')||(c.preventDefault(),d.is("input,button")?d.trigger("focus"):d.find("input:visible,button:visible").first().trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",\'[data-toggle^="button"]\',function(b){a(b.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(b.type))})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},c.DEFAULTS,d.data(),"object"==typeof b&&b),g="string"==typeof b?b:f.slide;e||d.data("bs.carousel",e=new c(this,f)),"number"==typeof b?e.to(b):g?e[g]():f.interval&&e.pause().cycle()})}var c=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",a.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",a.proxy(this.pause,this)).on("mouseleave.bs.carousel",a.proxy(this.cycle,this))};c.VERSION="3.3.7",c.TRANSITION_DURATION=600,c.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},c.prototype.keydown=function(a){if(!/input|textarea/i.test(a.target.tagName)){switch(a.which){case 37:this.prev();break;case 39:this.next();break;default:return}a.preventDefault()}},c.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},c.prototype.getItemIndex=function(a){return this.$items=a.parent().children(".item"),this.$items.index(a||this.$active)},c.prototype.getItemForDirection=function(a,b){var c=this.getItemIndex(b),d="prev"==a&&0===c||"next"==a&&c==this.$items.length-1;if(d&&!this.options.wrap)return b;var e="prev"==a?-1:1,f=(c+e)%this.$items.length;return this.$items.eq(f)},c.prototype.to=function(a){var b=this,c=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(a>this.$items.length-1||a<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){b.to(a)}):c==a?this.pause().cycle():this.slide(a>c?"next":"prev",this.$items.eq(a))},c.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},c.prototype.next=function(){if(!this.sliding)return this.slide("next")},c.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},c.prototype.slide=function(b,d){var e=this.$element.find(".item.active"),f=d||this.getItemForDirection(b,e),g=this.interval,h="next"==b?"left":"right",i=this;if(f.hasClass("active"))return this.sliding=!1;var j=f[0],k=a.Event("slide.bs.carousel",{relatedTarget:j,direction:h});if(this.$element.trigger(k),!k.isDefaultPrevented()){if(this.sliding=!0,g&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var l=a(this.$indicators.children()[this.getItemIndex(f)]);l&&l.addClass("active")}var m=a.Event("slid.bs.carousel",{relatedTarget:j,direction:h});return a.support.transition&&this.$element.hasClass("slide")?(f.addClass(b),f[0].offsetWidth,e.addClass(h),f.addClass(h),e.one("bsTransitionEnd",function(){f.removeClass([b,h].join(" ")).addClass("active"),e.removeClass(["active",h].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger(m)},0)}).emulateTransitionEnd(c.TRANSITION_DURATION)):(e.removeClass("active"),f.addClass("active"),this.sliding=!1,this.$element.trigger(m)),g&&this.cycle(),this}};var d=a.fn.carousel;a.fn.carousel=b,a.fn.carousel.Constructor=c,a.fn.carousel.noConflict=function(){return a.fn.carousel=d,this};var e=function(c){var d,e=a(this),f=a(e.attr("data-target")||(d=e.attr("href"))&&d.replace(/.*(?=#[^\\s]+$)/,""));if(f.hasClass("carousel")){var g=a.extend({},f.data(),e.data()),h=e.attr("data-slide-to");h&&(g.interval=!1),b.call(f,g),h&&f.data("bs.carousel").to(h),c.preventDefault()}};a(document).on("click.bs.carousel.data-api","[data-slide]",e).on("click.bs.carousel.data-api","[data-slide-to]",e),a(window).on("load",function(){a(\'[data-ride="carousel"]\').each(function(){var c=a(this);b.call(c,c.data())})})}(jQuery),+function(a){"use strict";function b(b){var c,d=b.attr("data-target")||(c=b.attr("href"))&&c.replace(/.*(?=#[^\\s]+$)/,"");return a(d)}function c(b){return this.each(function(){var c=a(this),e=c.data("bs.collapse"),f=a.extend({},d.DEFAULTS,c.data(),"object"==typeof b&&b);!e&&f.toggle&&/show|hide/.test(b)&&(f.toggle=!1),e||c.data("bs.collapse",e=new d(this,f)),"string"==typeof b&&e[b]()})}var d=function(b,c){this.$element=a(b),this.options=a.extend({},d.DEFAULTS,c),this.$trigger=a(\'[data-toggle="collapse"][href="#\'+b.id+\'"],[data-toggle="collapse"][data-target="#\'+b.id+\'"]\'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};d.VERSION="3.3.7",d.TRANSITION_DURATION=350,d.DEFAULTS={toggle:!0},d.prototype.dimension=function(){var a=this.$element.hasClass("width");return a?"width":"height"},d.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var b,e=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(e&&e.length&&(b=e.data("bs.collapse"),b&&b.transitioning))){var f=a.Event("show.bs.collapse");if(this.$element.trigger(f),!f.isDefaultPrevented()){e&&e.length&&(c.call(e,"hide"),b||e.data("bs.collapse",null));var g=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[g](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var h=function(){this.$element.removeClass("collapsing").addClass("collapse in")[g](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return h.call(this);var i=a.camelCase(["scroll",g].join("-"));this.$element.one("bsTransitionEnd",a.proxy(h,this)).emulateTransitionEnd(d.TRANSITION_DURATION)[g](this.$element[0][i])}}}},d.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var e=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return a.support.transition?void this.$element[c](0).one("bsTransitionEnd",a.proxy(e,this)).emulateTransitionEnd(d.TRANSITION_DURATION):e.call(this)}}},d.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},d.prototype.getParent=function(){return a(this.options.parent).find(\'[data-toggle="collapse"][data-parent="\'+this.options.parent+\'"]\').each(a.proxy(function(c,d){var e=a(d);this.addAriaAndCollapsedClass(b(e),e)},this)).end()},d.prototype.addAriaAndCollapsedClass=function(a,b){var c=a.hasClass("in");a.attr("aria-expanded",c),b.toggleClass("collapsed",!c).attr("aria-expanded",c)};var e=a.fn.collapse;a.fn.collapse=c,a.fn.collapse.Constructor=d,a.fn.collapse.noConflict=function(){return a.fn.collapse=e,this},a(document).on("click.bs.collapse.data-api",\'[data-toggle="collapse"]\',function(d){var e=a(this);e.attr("data-target")||d.preventDefault();var f=b(e),g=f.data("bs.collapse"),h=g?"toggle":e.data();c.call(f,h)})}(jQuery),+function(a){"use strict";function b(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}function c(c){c&&3===c.which||(a(e).remove(),a(f).each(function(){var d=a(this),e=b(d),f={relatedTarget:this};e.hasClass("open")&&(c&&"click"==c.type&&/input|textarea/i.test(c.target.tagName)&&a.contains(e[0],c.target)||(e.trigger(c=a.Event("hide.bs.dropdown",f)),c.isDefaultPrevented()||(d.attr("aria-expanded","false"),e.removeClass("open").trigger(a.Event("hidden.bs.dropdown",f)))))}))}function d(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})}var e=".dropdown-backdrop",f=\'[data-toggle="dropdown"]\',g=function(b){a(b).on("click.bs.dropdown",this.toggle)};g.VERSION="3.3.7",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=b(e),g=f.hasClass("open");if(c(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(a(this)).on("click",c);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.bs.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),f.toggleClass("open").trigger(a.Event("shown.bs.dropdown",h))}return!1}},g.prototype.keydown=function(c){if(/(38|40|27|32)/.test(c.which)&&!/input|textarea/i.test(c.target.tagName)){var d=a(this);if(c.preventDefault(),c.stopPropagation(),!d.is(".disabled, :disabled")){var e=b(d),g=e.hasClass("open");if(!g&&27!=c.which||g&&27==c.which)return 27==c.which&&e.find(f).trigger("focus"),d.trigger("click");var h=" li:not(.disabled):visible a",i=e.find(".dropdown-menu"+h);if(i.length){var j=i.index(c.target);38==c.which&&j>0&&j--,40==c.which&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.dropdown;a.fn.dropdown=d,a.fn.dropdown.Constructor=g,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=h,this},a(document).on("click.bs.dropdown.data-api",c).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",f,g.prototype.toggle).on("keydown.bs.dropdown.data-api",f,g.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",g.prototype.keydown)}(jQuery),+function(a){"use strict";function b(b,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},c.DEFAULTS,e.data(),"object"==typeof b&&b);f||e.data("bs.modal",f=new c(this,g)),"string"==typeof b?f[b](d):g.show&&f.show(d)})}var c=function(b,c){this.options=c,this.$body=a(document.body),this.$element=a(b),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};c.VERSION="3.3.7",c.TRANSITION_DURATION=300,c.BACKDROP_TRANSITION_DURATION=150,c.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},c.prototype.toggle=function(a){return this.isShown?this.hide():this.show(a)},c.prototype.show=function(b){var d=this,e=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",\'[data-dismiss="modal"]\',a.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){d.$element.one("mouseup.dismiss.bs.modal",function(b){a(b.target).is(d.$element)&&(d.ignoreBackdropClick=!0)})}),this.backdrop(function(){var e=a.support.transition&&d.$element.hasClass("fade");d.$element.parent().length||d.$element.appendTo(d.$body),d.$element.show().scrollTop(0),d.adjustDialog(),e&&d.$element[0].offsetWidth,d.$element.addClass("in"),d.enforceFocus();var f=a.Event("shown.bs.modal",{relatedTarget:b});e?d.$dialog.one("bsTransitionEnd",function(){d.$element.trigger("focus").trigger(f)}).emulateTransitionEnd(c.TRANSITION_DURATION):d.$element.trigger("focus").trigger(f)}))},c.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(c.TRANSITION_DURATION):this.hideModal())},c.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){document===a.target||this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.trigger("focus")},this))},c.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},c.prototype.resize=function(){this.isShown?a(window).on("resize.bs.modal",a.proxy(this.handleUpdate,this)):a(window).off("resize.bs.modal")},c.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.$body.removeClass("modal-open"),a.resetAdjustments(),a.resetScrollbar(),a.$element.trigger("hidden.bs.modal")})},c.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},c.prototype.backdrop=function(b){var d=this,e=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var f=a.support.transition&&e;if(this.$backdrop=a(document.createElement("div")).addClass("modal-backdrop "+e).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",a.proxy(function(a){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),f&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;f?this.$backdrop.one("bsTransitionEnd",b).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):b()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var g=function(){d.removeBackdrop(),b&&b()};a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",g).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):g()}else b&&b()},c.prototype.handleUpdate=function(){this.adjustDialog()},c.prototype.adjustDialog=function(){var a=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&a?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!a?this.scrollbarWidth:""})},c.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},c.prototype.checkScrollbar=function(){var a=window.innerWidth;if(!a){var b=document.documentElement.getBoundingClientRect();a=b.right-Math.abs(b.left)}this.bodyIsOverflowing=document.body.clientWidth<a,this.scrollbarWidth=this.measureScrollbar()},c.prototype.setScrollbar=function(){var a=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",a+this.scrollbarWidth)},c.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},c.prototype.measureScrollbar=function(){var a=document.createElement("div");a.className="modal-scrollbar-measure",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b};var d=a.fn.modal;a.fn.modal=b,a.fn.modal.Constructor=c,a.fn.modal.noConflict=function(){return a.fn.modal=d,this},a(document).on("click.bs.modal.data-api",\'[data-toggle="modal"]\',function(c){var d=a(this),e=d.attr("href"),f=a(d.attr("data-target")||e&&e.replace(/.*(?=#[^\\s]+$)/,"")),g=f.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(e)&&e},f.data(),d.data());d.is("a")&&c.preventDefault(),f.one("show.bs.modal",function(a){a.isDefaultPrevented()||f.one("hidden.bs.modal",function(){d.is(":visible")&&d.trigger("focus")})}),b.call(f,g,this)})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b;!e&&/destroy|hide/.test(b)||(e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",a,b)};c.VERSION="3.3.7",c.TRANSITION_DURATION=150,c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:\'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>\',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){if(this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(a.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusin"==b.type?"focus":"hover"]=!0),c.tip().hasClass("in")||"in"==c.hoverState?void(c.hoverState="in"):(clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show())},c.prototype.isInStateTrue=function(){for(var a in this.inState)if(this.inState[a])return!0;return!1},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);if(c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusout"==b.type?"focus":"hover"]=!1),!c.isInStateTrue())return clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var d=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!d)return;var e=this,f=this.tip(),g=this.getUID(this.type);this.setContent(),f.attr("id",g),this.$element.attr("aria-describedby",g),this.options.animation&&f.addClass("fade");var h="function"==typeof this.options.placement?this.options.placement.call(this,f[0],this.$element[0]):this.options.placement,i=/\\s?auto?\\s?/i,j=i.test(h);j&&(h=h.replace(i,"")||"top"),f.detach().css({top:0,left:0,display:"block"}).addClass(h).data("bs."+this.type,this),this.options.container?f.appendTo(this.options.container):f.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var k=this.getPosition(),l=f[0].offsetWidth,m=f[0].offsetHeight;if(j){var n=h,o=this.getPosition(this.$viewport);h="bottom"==h&&k.bottom+m>o.bottom?"top":"top"==h&&k.top-m<o.top?"bottom":"right"==h&&k.right+l>o.width?"left":"left"==h&&k.left-l<o.left?"right":h,f.removeClass(n).addClass(h)}var p=this.getCalculatedOffset(h,k,l,m);this.applyPlacement(p,h);var q=function(){var a=e.hoverState;e.$element.trigger("shown.bs."+e.type),e.hoverState=null,"out"==a&&e.leave(e)};a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",q).emulateTransitionEnd(c.TRANSITION_DURATION):q()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top+=g,b.left+=h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=/top|bottom/.test(c),m=l?2*k.left-e+i:2*k.top-f+j,n=l?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(m,d[0][n],l)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c?"left":"top",50*(1-a/b)+"%").css(c?"top":"left","")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(b){function d(){"in"!=e.hoverState&&f.detach(),e.$element&&e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),b&&b()}var e=this,f=a(this.$tip),g=a.Event("hide.bs."+this.type);if(this.$element.trigger(g),!g.isDefaultPrevented())return f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one("bsTransitionEnd",d).emulateTransitionEnd(c.TRANSITION_DURATION):d(),this.hoverState=null,this},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"==c.tagName,e=c.getBoundingClientRect();null==e.width&&(e=a.extend({},e,{width:e.right-e.left,height:e.bottom-e.top}));var f=window.SVGElement&&c instanceof window.SVGElement,g=d?{top:0,left:0}:f?null:b.offset(),h={scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop()},i=d?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},e,h,i,g)},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.right&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do a+=~~(1e6*Math.random());while(document.getElementById(a));return a},c.prototype.tip=function(){if(!this.$tip&&(this.$tip=a(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&(c=a(b.currentTarget).data("bs."+this.type),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),b?(c.inState.click=!c.inState.click,c.isInStateTrue()?c.enter(c):c.leave(c)):c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){var a=this;clearTimeout(this.timeout),this.hide(function(){a.$element.off("."+a.type).removeData("bs."+a.type),a.$tip&&a.$tip.detach(),a.$tip=null,a.$arrow=null,a.$viewport=null,a.$element=null})};var d=a.fn.tooltip;a.fn.tooltip=b,a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof b&&b;!e&&/destroy|hide/.test(b)||(e||d.data("bs.popover",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");c.VERSION="3.3.7",c.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:\'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>\'}),c.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),c.prototype.constructor=c,c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof c?"html":"append":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},c.prototype.hasContent=function(){return this.getTitle()||this.getContent()},c.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var d=a.fn.popover;a.fn.popover=b,a.fn.popover.Constructor=c,a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(jQuery),+function(a){"use strict";function b(c,d){this.$body=a(document.body),this.$scrollElement=a(a(c).is(document.body)?window:c),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",a.proxy(this.process,this)),this.refresh(),this.process()}function c(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})}b.VERSION="3.3.7",b.DEFAULTS={offset:10},b.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},b.prototype.refresh=function(){var b=this,c="offset",d=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),a.isWindow(this.$scrollElement[0])||(c="position",d=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var b=a(this),e=b.data("target")||b.attr("href"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(":visible")&&[[f[c]().top+d,e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){b.offsets.push(this[0]),b.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.getScrollHeight(),d=this.options.offset+c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(this.scrollHeight!=c&&this.refresh(),b>=d)return g!=(a=f[f.length-1])&&this.activate(a);if(g&&b<e[0])return this.activeTarget=null,this.clear();for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(void 0===e[a+1]||b<e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){\nthis.activeTarget=b,this.clear();var c=this.selector+\'[data-target="\'+b+\'"],\'+this.selector+\'[href="\'+b+\'"]\',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate.bs.scrollspy")},b.prototype.clear=function(){a(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var d=a.fn.scrollspy;a.fn.scrollspy=c,a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=d,this},a(window).on("load.bs.scrollspy.data-api",function(){a(\'[data-spy="scroll"]\').each(function(){var b=a(this);c.call(b,b.data())})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tab");e||d.data("bs.tab",e=new c(this)),"string"==typeof b&&e[b]()})}var c=function(b){this.element=a(b)};c.VERSION="3.3.7",c.TRANSITION_DURATION=150,c.prototype.show=function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.data("target");if(d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\\s]*$)/,"")),!b.parent("li").hasClass("active")){var e=c.find(".active:last a"),f=a.Event("hide.bs.tab",{relatedTarget:b[0]}),g=a.Event("show.bs.tab",{relatedTarget:e[0]});if(e.trigger(f),b.trigger(g),!g.isDefaultPrevented()&&!f.isDefaultPrevented()){var h=a(d);this.activate(b.closest("li"),c),this.activate(h,h.parent(),function(){e.trigger({type:"hidden.bs.tab",relatedTarget:b[0]}),b.trigger({type:"shown.bs.tab",relatedTarget:e[0]})})}}},c.prototype.activate=function(b,d,e){function f(){g.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find(\'[data-toggle="tab"]\').attr("aria-expanded",!1),b.addClass("active").find(\'[data-toggle="tab"]\').attr("aria-expanded",!0),h?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu").length&&b.closest("li.dropdown").addClass("active").end().find(\'[data-toggle="tab"]\').attr("aria-expanded",!0),e&&e()}var g=d.find("> .active"),h=e&&a.support.transition&&(g.length&&g.hasClass("fade")||!!d.find("> .fade").length);g.length&&h?g.one("bsTransitionEnd",f).emulateTransitionEnd(c.TRANSITION_DURATION):f(),g.removeClass("in")};var d=a.fn.tab;a.fn.tab=b,a.fn.tab.Constructor=c,a.fn.tab.noConflict=function(){return a.fn.tab=d,this};var e=function(c){c.preventDefault(),b.call(a(this),"show")};a(document).on("click.bs.tab.data-api",\'[data-toggle="tab"]\',e).on("click.bs.tab.data-api",\'[data-toggle="pill"]\',e)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.affix"),f="object"==typeof b&&b;e||d.data("bs.affix",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.options=a.extend({},c.DEFAULTS,d),this.$target=a(this.options.target).on("scroll.bs.affix.data-api",a.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(b),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};c.VERSION="3.3.7",c.RESET="affix affix-top affix-bottom",c.DEFAULTS={offset:0,target:window},c.prototype.getState=function(a,b,c,d){var e=this.$target.scrollTop(),f=this.$element.offset(),g=this.$target.height();if(null!=c&&"top"==this.affixed)return e<c&&"top";if("bottom"==this.affixed)return null!=c?!(e+this.unpin<=f.top)&&"bottom":!(e+g<=a-d)&&"bottom";var h=null==this.affixed,i=h?e:f.top,j=h?g:b;return null!=c&&e<=c?"top":null!=d&&i+j>=a-d&&"bottom"},c.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(c.RESET).addClass("affix");var a=this.$target.scrollTop(),b=this.$element.offset();return this.pinnedOffset=b.top-a},c.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},c.prototype.checkPosition=function(){if(this.$element.is(":visible")){var b=this.$element.height(),d=this.options.offset,e=d.top,f=d.bottom,g=Math.max(a(document).height(),a(document.body).height());"object"!=typeof d&&(f=e=d),"function"==typeof e&&(e=d.top(this.$element)),"function"==typeof f&&(f=d.bottom(this.$element));var h=this.getState(g,b,e,f);if(this.affixed!=h){null!=this.unpin&&this.$element.css("top","");var i="affix"+(h?"-"+h:""),j=a.Event(i+".bs.affix");if(this.$element.trigger(j),j.isDefaultPrevented())return;this.affixed=h,this.unpin="bottom"==h?this.getPinnedOffset():null,this.$element.removeClass(c.RESET).addClass(i).trigger(i.replace("affix","affixed")+".bs.affix")}"bottom"==h&&this.$element.offset({top:g-b-f})}};var d=a.fn.affix;a.fn.affix=b,a.fn.affix.Constructor=c,a.fn.affix.noConflict=function(){return a.fn.affix=d,this},a(window).on("load",function(){a(\'[data-spy="affix"]\').each(function(){var c=a(this),d=c.data();d.offset=d.offset||{},null!=d.offsetBottom&&(d.offset.bottom=d.offsetBottom),null!=d.offsetTop&&(d.offset.top=d.offsetTop),b.call(c,d)})})}(jQuery);';
},763:function(t,n){t.exports='/*! jQuery v3.1.1 | (c) jQuery Foundation | jquery.org/license */\n!function(a,b){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){"use strict";var c=[],d=a.document,e=Object.getPrototypeOf,f=c.slice,g=c.concat,h=c.push,i=c.indexOf,j={},k=j.toString,l=j.hasOwnProperty,m=l.toString,n=m.call(Object),o={};function p(a,b){b=b||d;var c=b.createElement("script");c.text=a,b.head.appendChild(c).parentNode.removeChild(c)}var q="3.1.1",r=function(a,b){return new r.fn.init(a,b)},s=/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g,t=/^-ms-/,u=/-([a-z])/g,v=function(a,b){return b.toUpperCase()};r.fn=r.prototype={jquery:q,constructor:r,length:0,toArray:function(){return f.call(this)},get:function(a){return null==a?f.call(this):a<0?this[a+this.length]:this[a]},pushStack:function(a){var b=r.merge(this.constructor(),a);return b.prevObject=this,b},each:function(a){return r.each(this,a)},map:function(a){return this.pushStack(r.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(f.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(a<0?b:0);return this.pushStack(c>=0&&c<b?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:h,sort:c.sort,splice:c.splice},r.extend=r.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||r.isFunction(g)||(g={}),h===i&&(g=this,h--);h<i;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(r.isPlainObject(d)||(e=r.isArray(d)))?(e?(e=!1,f=c&&r.isArray(c)?c:[]):f=c&&r.isPlainObject(c)?c:{},g[b]=r.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},r.extend({expando:"jQuery"+(q+Math.random()).replace(/\\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===r.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){var b=r.type(a);return("number"===b||"string"===b)&&!isNaN(a-parseFloat(a))},isPlainObject:function(a){var b,c;return!(!a||"[object Object]"!==k.call(a))&&(!(b=e(a))||(c=l.call(b,"constructor")&&b.constructor,"function"==typeof c&&m.call(c)===n))},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?j[k.call(a)]||"object":typeof a},globalEval:function(a){p(a)},camelCase:function(a){return a.replace(t,"ms-").replace(u,v)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,d=0;if(w(a)){for(c=a.length;d<c;d++)if(b.call(a[d],d,a[d])===!1)break}else for(d in a)if(b.call(a[d],d,a[d])===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(s,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(w(Object(a))?r.merge(c,"string"==typeof a?[a]:a):h.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:i.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;d<c;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;f<g;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,f=0,h=[];if(w(a))for(d=a.length;f<d;f++)e=b(a[f],f,c),null!=e&&h.push(e);else for(f in a)e=b(a[f],f,c),null!=e&&h.push(e);return g.apply([],h)},guid:1,proxy:function(a,b){var c,d,e;if("string"==typeof b&&(c=a[b],b=a,a=c),r.isFunction(a))return d=f.call(arguments,2),e=function(){return a.apply(b||this,d.concat(f.call(arguments)))},e.guid=a.guid=a.guid||r.guid++,e},now:Date.now,support:o}),"function"==typeof Symbol&&(r.fn[Symbol.iterator]=c[Symbol.iterator]),r.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){j["[object "+b+"]"]=b.toLowerCase()});function w(a){var b=!!a&&"length"in a&&a.length,c=r.type(a);return"function"!==c&&!r.isWindow(a)&&("array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a)}var x=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ha(),z=ha(),A=ha(),B=function(a,b){return a===b&&(l=!0),0},C={}.hasOwnProperty,D=[],E=D.pop,F=D.push,G=D.push,H=D.slice,I=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},J="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",K="[\\\\x20\\\\t\\\\r\\\\n\\\\f]",L="(?:\\\\\\\\.|[\\\\w-]|[^\\0-\\\\xa0])+",M="\\\\["+K+"*("+L+")(?:"+K+"*([*^$|!~]?=)"+K+"*(?:\'((?:\\\\\\\\.|[^\\\\\\\\\'])*)\'|\\"((?:\\\\\\\\.|[^\\\\\\\\\\"])*)\\"|("+L+"))|)"+K+"*\\\\]",N=":("+L+")(?:\\\\(((\'((?:\\\\\\\\.|[^\\\\\\\\\'])*)\'|\\"((?:\\\\\\\\.|[^\\\\\\\\\\"])*)\\")|((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|"+M+")*)|.*)\\\\)|)",O=new RegExp(K+"+","g"),P=new RegExp("^"+K+"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)"+K+"+$","g"),Q=new RegExp("^"+K+"*,"+K+"*"),R=new RegExp("^"+K+"*([>+~]|"+K+")"+K+"*"),S=new RegExp("="+K+"*([^\\\\]\'\\"]*?)"+K+"*\\\\]","g"),T=new RegExp(N),U=new RegExp("^"+L+"$"),V={ID:new RegExp("^#("+L+")"),CLASS:new RegExp("^\\\\.("+L+")"),TAG:new RegExp("^("+L+"|[*])"),ATTR:new RegExp("^"+M),PSEUDO:new RegExp("^"+N),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\("+K+"*(even|odd|(([+-]|)(\\\\d*)n|)"+K+"*(?:([+-]|)"+K+"*(\\\\d+)|))"+K+"*\\\\)|)","i"),bool:new RegExp("^(?:"+J+")$","i"),needsContext:new RegExp("^"+K+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\("+K+"*((?:-\\\\d)?\\\\d*)"+K+"*\\\\)|)(?=[^-]|$)","i")},W=/^(?:input|select|textarea|button)$/i,X=/^h\\d$/i,Y=/^[^{]+\\{\\s*\\[native \\w/,Z=/^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,$=/[+~]/,_=new RegExp("\\\\\\\\([\\\\da-f]{1,6}"+K+"?|("+K+")|.)","ig"),aa=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:d<0?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},ba=/([\\0-\\x1f\\x7f]|^-?\\d)|^-$|[^\\0-\\x1f\\x7f-\\uFFFF\\w-]/g,ca=function(a,b){return b?"\\0"===a?"\\ufffd":a.slice(0,-1)+"\\\\"+a.charCodeAt(a.length-1).toString(16)+" ":"\\\\"+a},da=function(){m()},ea=ta(function(a){return a.disabled===!0&&("form"in a||"label"in a)},{dir:"parentNode",next:"legend"});try{G.apply(D=H.call(v.childNodes),v.childNodes),D[v.childNodes.length].nodeType}catch(fa){G={apply:D.length?function(a,b){F.apply(a,H.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function ga(a,b,d,e){var f,h,j,k,l,o,r,s=b&&b.ownerDocument,w=b?b.nodeType:9;if(d=d||[],"string"!=typeof a||!a||1!==w&&9!==w&&11!==w)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==w&&(l=Z.exec(a)))if(f=l[1]){if(9===w){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(s&&(j=s.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(l[2])return G.apply(d,b.getElementsByTagName(a)),d;if((f=l[3])&&c.getElementsByClassName&&b.getElementsByClassName)return G.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+" "]&&(!q||!q.test(a))){if(1!==w)s=b,r=a;else if("object"!==b.nodeName.toLowerCase()){(k=b.getAttribute("id"))?k=k.replace(ba,ca):b.setAttribute("id",k=u),o=g(a),h=o.length;while(h--)o[h]="#"+k+" "+sa(o[h]);r=o.join(","),s=$.test(a)&&qa(b.parentNode)||b}if(r)try{return G.apply(d,s.querySelectorAll(r)),d}catch(x){}finally{k===u&&b.removeAttribute("id")}}}return i(a.replace(P,"$1"),b,d,e)}function ha(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ia(a){return a[u]=!0,a}function ja(a){var b=n.createElement("fieldset");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ka(a,b){var c=a.split("|"),e=c.length;while(e--)d.attrHandle[c[e]]=b}function la(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function na(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function oa(a){return function(b){return"form"in b?b.parentNode&&b.disabled===!1?"label"in b?"label"in b.parentNode?b.parentNode.disabled===a:b.disabled===a:b.isDisabled===a||b.isDisabled!==!a&&ea(b)===a:b.disabled===a:"label"in b&&b.disabled===a}}function pa(a){return ia(function(b){return b=+b,ia(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function qa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=ga.support={},f=ga.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return!!b&&"HTML"!==b.nodeName},m=ga.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=n.documentElement,p=!f(n),v!==n&&(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",da,!1):e.attachEvent&&e.attachEvent("onunload",da)),c.attributes=ja(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ja(function(a){return a.appendChild(n.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Y.test(n.getElementsByClassName),c.getById=ja(function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length}),c.getById?(d.filter.ID=function(a){var b=a.replace(_,aa);return function(a){return a.getAttribute("id")===b}},d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}}):(d.filter.ID=function(a){var b=a.replace(_,aa);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}},d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c,d,e,f=b.getElementById(a);if(f){if(c=f.getAttributeNode("id"),c&&c.value===a)return[f];e=b.getElementsByName(a),d=0;while(f=e[d++])if(c=f.getAttributeNode("id"),c&&c.value===a)return[f]}return[]}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){if("undefined"!=typeof b.getElementsByClassName&&p)return b.getElementsByClassName(a)},r=[],q=[],(c.qsa=Y.test(n.querySelectorAll))&&(ja(function(a){o.appendChild(a).innerHTML="<a id=\'"+u+"\'></a><select id=\'"+u+"-\\r\\\\\' msallowcapture=\'\'><option selected=\'\'></option></select>",a.querySelectorAll("[msallowcapture^=\'\']").length&&q.push("[*^$]="+K+"*(?:\'\'|\\"\\")"),a.querySelectorAll("[selected]").length||q.push("\\\\["+K+"*(?:value|"+J+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ja(function(a){a.innerHTML="<a href=\'\' disabled=\'disabled\'></a><select disabled=\'disabled\'><option/></select>";var b=n.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+K+"*[*^$|!~]?="),2!==a.querySelectorAll(":enabled").length&&q.push(":enabled",":disabled"),o.appendChild(a).disabled=!0,2!==a.querySelectorAll(":disabled").length&&q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=Y.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ja(function(a){c.disconnectedMatch=s.call(a,"*"),s.call(a,"[s!=\'\']:x"),r.push("!=",N)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=Y.test(o.compareDocumentPosition),t=b||Y.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?I(k,a)-I(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?I(k,a)-I(k,b):0;if(e===f)return la(a,b);c=a;while(c=c.parentNode)g.unshift(c);c=b;while(c=c.parentNode)h.unshift(c);while(g[d]===h[d])d++;return d?la(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},ga.matches=function(a,b){return ga(a,null,null,b)},ga.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(S,"=\'$1\']"),c.matchesSelector&&p&&!A[b+" "]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return ga(b,n,null,[a]).length>0},ga.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},ga.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&C.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},ga.escape=function(a){return(a+"").replace(ba,ca)},ga.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},ga.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=ga.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=ga.selectors={cacheLength:50,createPseudo:ia,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(_,aa),a[3]=(a[3]||a[4]||a[5]||"").replace(_,aa),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||ga.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&ga.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return V.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&T.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(_,aa).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+K+")"+a+"("+K+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=ga.attr(d,a);return null==e?"!="===b:!b||(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(O," ")+" ").indexOf(c)>-1:"|="===b&&(e===c||e.slice(0,c.length+1)===c+"-"))}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){while(p){m=b;while(m=m[p])if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){m=q,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n&&j[2],m=n&&q.childNodes[n];while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(m=b,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n),t===!1)while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if((h?m.nodeName.toLowerCase()===r:1===m.nodeType)&&++t&&(s&&(l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[w,t]),m===b))break;return t-=e,t===d||t%d===0&&t/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||ga.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ia(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=I(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ia(function(a){var b=[],c=[],d=h(a.replace(P,"$1"));return d[u]?ia(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ia(function(a){return function(b){return ga(a,b).length>0}}),contains:ia(function(a){return a=a.replace(_,aa),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ia(function(a){return U.test(a||"")||ga.error("unsupported lang: "+a),a=a.replace(_,aa).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:oa(!1),disabled:oa(!0),checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return X.test(a.nodeName)},input:function(a){return W.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:pa(function(){return[0]}),last:pa(function(a,b){return[b-1]}),eq:pa(function(a,b,c){return[c<0?c+b:c]}),even:pa(function(a,b){for(var c=0;c<b;c+=2)a.push(c);return a}),odd:pa(function(a,b){for(var c=1;c<b;c+=2)a.push(c);return a}),lt:pa(function(a,b,c){for(var d=c<0?c+b:c;--d>=0;)a.push(d);return a}),gt:pa(function(a,b,c){for(var d=c<0?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=ma(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=na(b);function ra(){}ra.prototype=d.filters=d.pseudos,d.setFilters=new ra,g=ga.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){c&&!(e=Q.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=R.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(P," ")}),h=h.slice(c.length));for(g in d.filter)!(e=V[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?ga.error(a):z(a,i).slice(0)};function sa(a){for(var b=0,c=a.length,d="";b<c;b++)d+=a[b].value;return d}function ta(a,b,c){var d=b.dir,e=b.next,f=e||d,g=c&&"parentNode"===f,h=x++;return b.first?function(b,c,e){while(b=b[d])if(1===b.nodeType||g)return a(b,c,e);return!1}:function(b,c,i){var j,k,l,m=[w,h];if(i){while(b=b[d])if((1===b.nodeType||g)&&a(b,c,i))return!0}else while(b=b[d])if(1===b.nodeType||g)if(l=b[u]||(b[u]={}),k=l[b.uniqueID]||(l[b.uniqueID]={}),e&&e===b.nodeName.toLowerCase())b=b[d]||b;else{if((j=k[f])&&j[0]===w&&j[1]===h)return m[2]=j[2];if(k[f]=m,m[2]=a(b,c,i))return!0}return!1}}function ua(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function va(a,b,c){for(var d=0,e=b.length;d<e;d++)ga(a,b[d],c);return c}function wa(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;h<i;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function xa(a,b,c,d,e,f){return d&&!d[u]&&(d=xa(d)),e&&!e[u]&&(e=xa(e,f)),ia(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||va(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:wa(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=wa(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?I(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=wa(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):G.apply(g,r)})}function ya(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=ta(function(a){return a===b},h,!0),l=ta(function(a){return I(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];i<f;i++)if(c=d.relative[a[i].type])m=[ta(ua(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;e<f;e++)if(d.relative[a[e].type])break;return xa(i>1&&ua(m),i>1&&sa(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(P,"$1"),c,i<e&&ya(a.slice(i,e)),e<f&&ya(a=a.slice(e)),e<f&&sa(a))}m.push(c)}return ua(m)}function za(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,o,q,r=0,s="0",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG("*",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){o=0,g||l.ownerDocument===n||(m(l),h=!p);while(q=a[o++])if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){o=0;while(q=b[o++])q(t,u,g,h);if(f){if(r>0)while(s--)t[s]||u[s]||(u[s]=E.call(i));u=wa(u)}G.apply(i,u),k&&!f&&u.length>0&&r+b.length>1&&ga.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ia(f):f}return h=ga.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=ya(b[c]),f[u]?d.push(f):e.push(f);f=A(a,za(e,d)),f.selector=a}return f},i=ga.select=function(a,b,c,e){var f,i,j,k,l,m="function"==typeof a&&a,n=!e&&g(a=m.selector||a);if(c=c||[],1===n.length){if(i=n[0]=n[0].slice(0),i.length>2&&"ID"===(j=i[0]).type&&9===b.nodeType&&p&&d.relative[i[1].type]){if(b=(d.find.ID(j.matches[0].replace(_,aa),b)||[])[0],!b)return c;m&&(b=b.parentNode),a=a.slice(i.shift().value.length)}f=V.needsContext.test(a)?0:i.length;while(f--){if(j=i[f],d.relative[k=j.type])break;if((l=d.find[k])&&(e=l(j.matches[0].replace(_,aa),$.test(i[0].type)&&qa(b.parentNode)||b))){if(i.splice(f,1),a=e.length&&sa(i),!a)return G.apply(c,e),c;break}}}return(m||h(a,n))(e,b,!p,c,!b||$.test(a)&&qa(b.parentNode)||b),c},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ja(function(a){return 1&a.compareDocumentPosition(n.createElement("fieldset"))}),ja(function(a){return a.innerHTML="<a href=\'#\'></a>","#"===a.firstChild.getAttribute("href")})||ka("type|href|height|width",function(a,b,c){if(!c)return a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ja(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ka("value",function(a,b,c){if(!c&&"input"===a.nodeName.toLowerCase())return a.defaultValue}),ja(function(a){return null==a.getAttribute("disabled")})||ka(J,function(a,b,c){var d;if(!c)return a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),ga}(a);r.find=x,r.expr=x.selectors,r.expr[":"]=r.expr.pseudos,r.uniqueSort=r.unique=x.uniqueSort,r.text=x.getText,r.isXMLDoc=x.isXML,r.contains=x.contains,r.escapeSelector=x.escape;var y=function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&r(a).is(c))break;d.push(a)}return d},z=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},A=r.expr.match.needsContext,B=/^<([a-z][^\\/\\0>:\\x20\\t\\r\\n\\f]*)[\\x20\\t\\r\\n\\f]*\\/?>(?:<\\/\\1>|)$/i,C=/^.[^:#\\[\\.,]*$/;function D(a,b,c){return r.isFunction(b)?r.grep(a,function(a,d){return!!b.call(a,d,a)!==c}):b.nodeType?r.grep(a,function(a){return a===b!==c}):"string"!=typeof b?r.grep(a,function(a){return i.call(b,a)>-1!==c}):C.test(b)?r.filter(b,a,c):(b=r.filter(b,a),r.grep(a,function(a){return i.call(b,a)>-1!==c&&1===a.nodeType}))}r.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?r.find.matchesSelector(d,a)?[d]:[]:r.find.matches(a,r.grep(b,function(a){return 1===a.nodeType}))},r.fn.extend({find:function(a){var b,c,d=this.length,e=this;if("string"!=typeof a)return this.pushStack(r(a).filter(function(){for(b=0;b<d;b++)if(r.contains(e[b],this))return!0}));for(c=this.pushStack([]),b=0;b<d;b++)r.find(a,e[b],c);return d>1?r.uniqueSort(c):c},filter:function(a){return this.pushStack(D(this,a||[],!1))},not:function(a){return this.pushStack(D(this,a||[],!0))},is:function(a){return!!D(this,"string"==typeof a&&A.test(a)?r(a):a||[],!1).length}});var E,F=/^(?:\\s*(<[\\w\\W]+>)[^>]*|#([\\w-]+))$/,G=r.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||E,"string"==typeof a){if(e="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:F.exec(a),!e||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof r?b[0]:b,r.merge(this,r.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),B.test(e[1])&&r.isPlainObject(b))for(e in b)r.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}return f=d.getElementById(e[2]),f&&(this[0]=f,this.length=1),this}return a.nodeType?(this[0]=a,this.length=1,this):r.isFunction(a)?void 0!==c.ready?c.ready(a):a(r):r.makeArray(a,this)};G.prototype=r.fn,E=r(d);var H=/^(?:parents|prev(?:Until|All))/,I={children:!0,contents:!0,next:!0,prev:!0};r.fn.extend({has:function(a){var b=r(a,this),c=b.length;return this.filter(function(){for(var a=0;a<c;a++)if(r.contains(this,b[a]))return!0})},closest:function(a,b){var c,d=0,e=this.length,f=[],g="string"!=typeof a&&r(a);if(!A.test(a))for(;d<e;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&r.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?r.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?i.call(r(a),this[0]):i.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(r.uniqueSort(r.merge(this.get(),r(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function J(a,b){while((a=a[b])&&1!==a.nodeType);return a}r.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return y(a,"parentNode")},parentsUntil:function(a,b,c){return y(a,"parentNode",c)},next:function(a){return J(a,"nextSibling")},prev:function(a){return J(a,"previousSibling")},nextAll:function(a){return y(a,"nextSibling")},prevAll:function(a){return y(a,"previousSibling")},nextUntil:function(a,b,c){return y(a,"nextSibling",c)},prevUntil:function(a,b,c){return y(a,"previousSibling",c)},siblings:function(a){return z((a.parentNode||{}).firstChild,a)},children:function(a){return z(a.firstChild)},contents:function(a){return a.contentDocument||r.merge([],a.childNodes)}},function(a,b){r.fn[a]=function(c,d){var e=r.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=r.filter(d,e)),this.length>1&&(I[a]||r.uniqueSort(e),H.test(a)&&e.reverse()),this.pushStack(e)}});var K=/[^\\x20\\t\\r\\n\\f]+/g;function L(a){var b={};return r.each(a.match(K)||[],function(a,c){b[c]=!0}),b}r.Callbacks=function(a){a="string"==typeof a?L(a):r.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=a.once,d=b=!0;g.length;h=-1){c=g.shift();while(++h<f.length)f[h].apply(c[0],c[1])===!1&&a.stopOnFalse&&(h=f.length,c=!1)}a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){r.each(b,function(b,c){r.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&"string"!==r.type(c)&&d(c)})}(arguments),c&&!b&&i()),this},remove:function(){return r.each(arguments,function(a,b){var c;while((c=r.inArray(b,f,c))>-1)f.splice(c,1),c<=h&&h--}),this},has:function(a){return a?r.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=g=[],c||b||(f=c=""),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j};function M(a){return a}function N(a){throw a}function O(a,b,c){var d;try{a&&r.isFunction(d=a.promise)?d.call(a).done(b).fail(c):a&&r.isFunction(d=a.then)?d.call(a,b,c):b.call(void 0,a)}catch(a){c.call(void 0,a)}}r.extend({Deferred:function(b){var c=[["notify","progress",r.Callbacks("memory"),r.Callbacks("memory"),2],["resolve","done",r.Callbacks("once memory"),r.Callbacks("once memory"),0,"resolved"],["reject","fail",r.Callbacks("once memory"),r.Callbacks("once memory"),1,"rejected"]],d="pending",e={state:function(){return d},always:function(){return f.done(arguments).fail(arguments),this},"catch":function(a){return e.then(null,a)},pipe:function(){var a=arguments;return r.Deferred(function(b){r.each(c,function(c,d){var e=r.isFunction(a[d[4]])&&a[d[4]];f[d[1]](function(){var a=e&&e.apply(this,arguments);a&&r.isFunction(a.promise)?a.promise().progress(b.notify).done(b.resolve).fail(b.reject):b[d[0]+"With"](this,e?[a]:arguments)})}),a=null}).promise()},then:function(b,d,e){var f=0;function g(b,c,d,e){return function(){var h=this,i=arguments,j=function(){var a,j;if(!(b<f)){if(a=d.apply(h,i),a===c.promise())throw new TypeError("Thenable self-resolution");j=a&&("object"==typeof a||"function"==typeof a)&&a.then,r.isFunction(j)?e?j.call(a,g(f,c,M,e),g(f,c,N,e)):(f++,j.call(a,g(f,c,M,e),g(f,c,N,e),g(f,c,M,c.notifyWith))):(d!==M&&(h=void 0,i=[a]),(e||c.resolveWith)(h,i))}},k=e?j:function(){try{j()}catch(a){r.Deferred.exceptionHook&&r.Deferred.exceptionHook(a,k.stackTrace),b+1>=f&&(d!==N&&(h=void 0,i=[a]),c.rejectWith(h,i))}};b?k():(r.Deferred.getStackHook&&(k.stackTrace=r.Deferred.getStackHook()),a.setTimeout(k))}}return r.Deferred(function(a){c[0][3].add(g(0,a,r.isFunction(e)?e:M,a.notifyWith)),c[1][3].add(g(0,a,r.isFunction(b)?b:M)),c[2][3].add(g(0,a,r.isFunction(d)?d:N))}).promise()},promise:function(a){return null!=a?r.extend(a,e):e}},f={};return r.each(c,function(a,b){var g=b[2],h=b[5];e[b[1]]=g.add,h&&g.add(function(){d=h},c[3-a][2].disable,c[0][2].lock),g.add(b[3].fire),f[b[0]]=function(){return f[b[0]+"With"](this===f?void 0:this,arguments),this},f[b[0]+"With"]=g.fireWith}),e.promise(f),b&&b.call(f,f),f},when:function(a){var b=arguments.length,c=b,d=Array(c),e=f.call(arguments),g=r.Deferred(),h=function(a){return function(c){d[a]=this,e[a]=arguments.length>1?f.call(arguments):c,--b||g.resolveWith(d,e)}};if(b<=1&&(O(a,g.done(h(c)).resolve,g.reject),"pending"===g.state()||r.isFunction(e[c]&&e[c].then)))return g.then();while(c--)O(e[c],h(c),g.reject);return g.promise()}});var P=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;r.Deferred.exceptionHook=function(b,c){a.console&&a.console.warn&&b&&P.test(b.name)&&a.console.warn("jQuery.Deferred exception: "+b.message,b.stack,c)},r.readyException=function(b){a.setTimeout(function(){throw b})};var Q=r.Deferred();r.fn.ready=function(a){return Q.then(a)["catch"](function(a){r.readyException(a)}),this},r.extend({isReady:!1,readyWait:1,holdReady:function(a){a?r.readyWait++:r.ready(!0)},ready:function(a){(a===!0?--r.readyWait:r.isReady)||(r.isReady=!0,a!==!0&&--r.readyWait>0||Q.resolveWith(d,[r]))}}),r.ready.then=Q.then;function R(){d.removeEventListener("DOMContentLoaded",R),\na.removeEventListener("load",R),r.ready()}"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll?a.setTimeout(r.ready):(d.addEventListener("DOMContentLoaded",R),a.addEventListener("load",R));var S=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===r.type(c)){e=!0;for(h in c)S(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,r.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(r(a),c)})),b))for(;h<i;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},T=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function U(){this.expando=r.expando+U.uid++}U.uid=1,U.prototype={cache:function(a){var b=a[this.expando];return b||(b={},T(a)&&(a.nodeType?a[this.expando]=b:Object.defineProperty(a,this.expando,{value:b,configurable:!0}))),b},set:function(a,b,c){var d,e=this.cache(a);if("string"==typeof b)e[r.camelCase(b)]=c;else for(d in b)e[r.camelCase(d)]=b[d];return e},get:function(a,b){return void 0===b?this.cache(a):a[this.expando]&&a[this.expando][r.camelCase(b)]},access:function(a,b,c){return void 0===b||b&&"string"==typeof b&&void 0===c?this.get(a,b):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d=a[this.expando];if(void 0!==d){if(void 0!==b){r.isArray(b)?b=b.map(r.camelCase):(b=r.camelCase(b),b=b in d?[b]:b.match(K)||[]),c=b.length;while(c--)delete d[b[c]]}(void 0===b||r.isEmptyObject(d))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){var b=a[this.expando];return void 0!==b&&!r.isEmptyObject(b)}};var V=new U,W=new U,X=/^(?:\\{[\\w\\W]*\\}|\\[[\\w\\W]*\\])$/,Y=/[A-Z]/g;function Z(a){return"true"===a||"false"!==a&&("null"===a?null:a===+a+""?+a:X.test(a)?JSON.parse(a):a)}function $(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(Y,"-$&").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c=Z(c)}catch(e){}W.set(a,b,c)}else c=void 0;return c}r.extend({hasData:function(a){return W.hasData(a)||V.hasData(a)},data:function(a,b,c){return W.access(a,b,c)},removeData:function(a,b){W.remove(a,b)},_data:function(a,b,c){return V.access(a,b,c)},_removeData:function(a,b){V.remove(a,b)}}),r.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=W.get(f),1===f.nodeType&&!V.get(f,"hasDataAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=r.camelCase(d.slice(5)),$(f,d,e[d])));V.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){W.set(this,a)}):S(this,function(b){var c;if(f&&void 0===b){if(c=W.get(f,a),void 0!==c)return c;if(c=$(f,a),void 0!==c)return c}else this.each(function(){W.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){W.remove(this,a)})}}),r.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=V.get(a,b),c&&(!d||r.isArray(c)?d=V.access(a,b,r.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=r.queue(a,b),d=c.length,e=c.shift(),f=r._queueHooks(a,b),g=function(){r.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return V.get(a,c)||V.access(a,c,{empty:r.Callbacks("once memory").add(function(){V.remove(a,[b+"queue",c])})})}}),r.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?r.queue(this[0],a):void 0===b?this:this.each(function(){var c=r.queue(this,a,b);r._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&r.dequeue(this,a)})},dequeue:function(a){return this.each(function(){r.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=r.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=V.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var _=/[+-]?(?:\\d*\\.|)\\d+(?:[eE][+-]?\\d+|)/.source,aa=new RegExp("^(?:([+-])=|)("+_+")([a-z%]*)$","i"),ba=["Top","Right","Bottom","Left"],ca=function(a,b){return a=b||a,"none"===a.style.display||""===a.style.display&&r.contains(a.ownerDocument,a)&&"none"===r.css(a,"display")},da=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};function ea(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return r.css(a,b,"")},i=h(),j=c&&c[3]||(r.cssNumber[b]?"":"px"),k=(r.cssNumber[b]||"px"!==j&&+i)&&aa.exec(r.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do f=f||".5",k/=f,r.style(a,b,k+j);while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}var fa={};function ga(a){var b,c=a.ownerDocument,d=a.nodeName,e=fa[d];return e?e:(b=c.body.appendChild(c.createElement(d)),e=r.css(b,"display"),b.parentNode.removeChild(b),"none"===e&&(e="block"),fa[d]=e,e)}function ha(a,b){for(var c,d,e=[],f=0,g=a.length;f<g;f++)d=a[f],d.style&&(c=d.style.display,b?("none"===c&&(e[f]=V.get(d,"display")||null,e[f]||(d.style.display="")),""===d.style.display&&ca(d)&&(e[f]=ga(d))):"none"!==c&&(e[f]="none",V.set(d,"display",c)));for(f=0;f<g;f++)null!=e[f]&&(a[f].style.display=e[f]);return a}r.fn.extend({show:function(){return ha(this,!0)},hide:function(){return ha(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){ca(this)?r(this).show():r(this).hide()})}});var ia=/^(?:checkbox|radio)$/i,ja=/<([a-z][^\\/\\0>\\x20\\t\\r\\n\\f]+)/i,ka=/^$|\\/(?:java|ecma)script/i,la={option:[1,"<select multiple=\'multiple\'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};la.optgroup=la.option,la.tbody=la.tfoot=la.colgroup=la.caption=la.thead,la.th=la.td;function ma(a,b){var c;return c="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):[],void 0===b||b&&r.nodeName(a,b)?r.merge([a],c):c}function na(a,b){for(var c=0,d=a.length;c<d;c++)V.set(a[c],"globalEval",!b||V.get(b[c],"globalEval"))}var oa=/<|&#?\\w+;/;function pa(a,b,c,d,e){for(var f,g,h,i,j,k,l=b.createDocumentFragment(),m=[],n=0,o=a.length;n<o;n++)if(f=a[n],f||0===f)if("object"===r.type(f))r.merge(m,f.nodeType?[f]:f);else if(oa.test(f)){g=g||l.appendChild(b.createElement("div")),h=(ja.exec(f)||["",""])[1].toLowerCase(),i=la[h]||la._default,g.innerHTML=i[1]+r.htmlPrefilter(f)+i[2],k=i[0];while(k--)g=g.lastChild;r.merge(m,g.childNodes),g=l.firstChild,g.textContent=""}else m.push(b.createTextNode(f));l.textContent="",n=0;while(f=m[n++])if(d&&r.inArray(f,d)>-1)e&&e.push(f);else if(j=r.contains(f.ownerDocument,f),g=ma(l.appendChild(f),"script"),j&&na(g),c){k=0;while(f=g[k++])ka.test(f.type||"")&&c.push(f)}return l}!function(){var a=d.createDocumentFragment(),b=a.appendChild(d.createElement("div")),c=d.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),o.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",o.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var qa=d.documentElement,ra=/^key/,sa=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,ta=/^([^.]*)(?:\\.(.+)|)/;function ua(){return!0}function va(){return!1}function wa(){try{return d.activeElement}catch(a){}}function xa(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)xa(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),e===!1)e=va;else if(!e)return a;return 1===f&&(g=e,e=function(a){return r().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=r.guid++)),a.each(function(){r.event.add(this,b,e,d,c)})}r.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=V.get(a);if(q){c.handler&&(f=c,c=f.handler,e=f.selector),e&&r.find.matchesSelector(qa,e),c.guid||(c.guid=r.guid++),(i=q.events)||(i=q.events={}),(g=q.handle)||(g=q.handle=function(b){return"undefined"!=typeof r&&r.event.triggered!==b.type?r.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(K)||[""],j=b.length;while(j--)h=ta.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n&&(l=r.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=r.event.special[n]||{},k=r.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&r.expr.match.needsContext.test(e),namespace:o.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,o,g)!==!1||a.addEventListener&&a.addEventListener(n,g)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),r.event.global[n]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=V.hasData(a)&&V.get(a);if(q&&(i=q.events)){b=(b||"").match(K)||[""],j=b.length;while(j--)if(h=ta.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){l=r.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\\\.)"+o.join("\\\\.(?:.*\\\\.|)")+"(\\\\.|$)"),g=f=m.length;while(f--)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||r.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)r.event.remove(a,n+b[j],c,d,!0);r.isEmptyObject(i)&&V.remove(a,"handle events")}},dispatch:function(a){var b=r.event.fix(a),c,d,e,f,g,h,i=new Array(arguments.length),j=(V.get(this,"events")||{})[b.type]||[],k=r.event.special[b.type]||{};for(i[0]=b,c=1;c<arguments.length;c++)i[c]=arguments[c];if(b.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,b)!==!1){h=r.event.handlers.call(this,b,j),c=0;while((f=h[c++])&&!b.isPropagationStopped()){b.currentTarget=f.elem,d=0;while((g=f.handlers[d++])&&!b.isImmediatePropagationStopped())b.rnamespace&&!b.rnamespace.test(g.namespace)||(b.handleObj=g,b.data=g.data,e=((r.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==e&&(b.result=e)===!1&&(b.preventDefault(),b.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,b),b.result}},handlers:function(a,b){var c,d,e,f,g,h=[],i=b.delegateCount,j=a.target;if(i&&j.nodeType&&!("click"===a.type&&a.button>=1))for(;j!==this;j=j.parentNode||this)if(1===j.nodeType&&("click"!==a.type||j.disabled!==!0)){for(f=[],g={},c=0;c<i;c++)d=b[c],e=d.selector+" ",void 0===g[e]&&(g[e]=d.needsContext?r(e,this).index(j)>-1:r.find(e,this,null,[j]).length),g[e]&&f.push(d);f.length&&h.push({elem:j,handlers:f})}return j=this,i<b.length&&h.push({elem:j,handlers:b.slice(i)}),h},addProp:function(a,b){Object.defineProperty(r.Event.prototype,a,{enumerable:!0,configurable:!0,get:r.isFunction(b)?function(){if(this.originalEvent)return b(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[a]},set:function(b){Object.defineProperty(this,a,{enumerable:!0,configurable:!0,writable:!0,value:b})}})},fix:function(a){return a[r.expando]?a:new r.Event(a)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==wa()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===wa()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&r.nodeName(this,"input"))return this.click(),!1},_default:function(a){return r.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}},r.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)},r.Event=function(a,b){return this instanceof r.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?ua:va,this.target=a.target&&3===a.target.nodeType?a.target.parentNode:a.target,this.currentTarget=a.currentTarget,this.relatedTarget=a.relatedTarget):this.type=a,b&&r.extend(this,b),this.timeStamp=a&&a.timeStamp||r.now(),void(this[r.expando]=!0)):new r.Event(a,b)},r.Event.prototype={constructor:r.Event,isDefaultPrevented:va,isPropagationStopped:va,isImmediatePropagationStopped:va,isSimulated:!1,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=ua,a&&!this.isSimulated&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=ua,a&&!this.isSimulated&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=ua,a&&!this.isSimulated&&a.stopImmediatePropagation(),this.stopPropagation()}},r.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(a){var b=a.button;return null==a.which&&ra.test(a.type)?null!=a.charCode?a.charCode:a.keyCode:!a.which&&void 0!==b&&sa.test(a.type)?1&b?1:2&b?3:4&b?2:0:a.which}},r.event.addProp),r.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){r.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||r.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),r.fn.extend({on:function(a,b,c,d){return xa(this,a,b,c,d)},one:function(a,b,c,d){return xa(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,r(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return b!==!1&&"function"!=typeof b||(c=b,b=void 0),c===!1&&(c=va),this.each(function(){r.event.remove(this,a,c,b)})}});var ya=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\\/\\0>\\x20\\t\\r\\n\\f]*)[^>]*)\\/>/gi,za=/<script|<style|<link/i,Aa=/checked\\s*(?:[^=]|=\\s*.checked.)/i,Ba=/^true\\/(.*)/,Ca=/^\\s*<!(?:\\[CDATA\\[|--)|(?:\\]\\]|--)>\\s*$/g;function Da(a,b){return r.nodeName(a,"table")&&r.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a:a}function Ea(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function Fa(a){var b=Ba.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Ga(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(V.hasData(a)&&(f=V.access(a),g=V.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;c<d;c++)r.event.add(b,e,j[e][c])}W.hasData(a)&&(h=W.access(a),i=r.extend({},h),W.set(b,i))}}function Ha(a,b){var c=b.nodeName.toLowerCase();"input"===c&&ia.test(a.type)?b.checked=a.checked:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}function Ia(a,b,c,d){b=g.apply([],b);var e,f,h,i,j,k,l=0,m=a.length,n=m-1,q=b[0],s=r.isFunction(q);if(s||m>1&&"string"==typeof q&&!o.checkClone&&Aa.test(q))return a.each(function(e){var f=a.eq(e);s&&(b[0]=q.call(this,e,f.html())),Ia(f,b,c,d)});if(m&&(e=pa(b,a[0].ownerDocument,!1,a,d),f=e.firstChild,1===e.childNodes.length&&(e=f),f||d)){for(h=r.map(ma(e,"script"),Ea),i=h.length;l<m;l++)j=e,l!==n&&(j=r.clone(j,!0,!0),i&&r.merge(h,ma(j,"script"))),c.call(a[l],j,l);if(i)for(k=h[h.length-1].ownerDocument,r.map(h,Fa),l=0;l<i;l++)j=h[l],ka.test(j.type||"")&&!V.access(j,"globalEval")&&r.contains(k,j)&&(j.src?r._evalUrl&&r._evalUrl(j.src):p(j.textContent.replace(Ca,""),k))}return a}function Ja(a,b,c){for(var d,e=b?r.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||r.cleanData(ma(d)),d.parentNode&&(c&&r.contains(d.ownerDocument,d)&&na(ma(d,"script")),d.parentNode.removeChild(d));return a}r.extend({htmlPrefilter:function(a){return a.replace(ya,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=r.contains(a.ownerDocument,a);if(!(o.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||r.isXMLDoc(a)))for(g=ma(h),f=ma(a),d=0,e=f.length;d<e;d++)Ha(f[d],g[d]);if(b)if(c)for(f=f||ma(a),g=g||ma(h),d=0,e=f.length;d<e;d++)Ga(f[d],g[d]);else Ga(a,h);return g=ma(h,"script"),g.length>0&&na(g,!i&&ma(a,"script")),h},cleanData:function(a){for(var b,c,d,e=r.event.special,f=0;void 0!==(c=a[f]);f++)if(T(c)){if(b=c[V.expando]){if(b.events)for(d in b.events)e[d]?r.event.remove(c,d):r.removeEvent(c,d,b.handle);c[V.expando]=void 0}c[W.expando]&&(c[W.expando]=void 0)}}}),r.fn.extend({detach:function(a){return Ja(this,a,!0)},remove:function(a){return Ja(this,a)},text:function(a){return S(this,function(a){return void 0===a?r.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=a)})},null,a,arguments.length)},append:function(){return Ia(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Da(this,a);b.appendChild(a)}})},prepend:function(){return Ia(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Da(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return Ia(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return Ia(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(r.cleanData(ma(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null!=a&&a,b=null==b?a:b,this.map(function(){return r.clone(this,a,b)})},html:function(a){return S(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!za.test(a)&&!la[(ja.exec(a)||["",""])[1].toLowerCase()]){a=r.htmlPrefilter(a);try{for(;c<d;c++)b=this[c]||{},1===b.nodeType&&(r.cleanData(ma(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return Ia(this,arguments,function(b){var c=this.parentNode;r.inArray(this,a)<0&&(r.cleanData(ma(this)),c&&c.replaceChild(b,this))},a)}}),r.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){r.fn[a]=function(a){for(var c,d=[],e=r(a),f=e.length-1,g=0;g<=f;g++)c=g===f?this:this.clone(!0),r(e[g])[b](c),h.apply(d,c.get());return this.pushStack(d)}});var Ka=/^margin/,La=new RegExp("^("+_+")(?!px)[a-z%]+$","i"),Ma=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)};!function(){function b(){if(i){i.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",i.innerHTML="",qa.appendChild(h);var b=a.getComputedStyle(i);c="1%"!==b.top,g="2px"===b.marginLeft,e="4px"===b.width,i.style.marginRight="50%",f="4px"===b.marginRight,qa.removeChild(h),i=null}}var c,e,f,g,h=d.createElement("div"),i=d.createElement("div");i.style&&(i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",o.clearCloneStyle="content-box"===i.style.backgroundClip,h.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",h.appendChild(i),r.extend(o,{pixelPosition:function(){return b(),c},boxSizingReliable:function(){return b(),e},pixelMarginRight:function(){return b(),f},reliableMarginLeft:function(){return b(),g}}))}();function Na(a,b,c){var d,e,f,g,h=a.style;return c=c||Ma(a),c&&(g=c.getPropertyValue(b)||c[b],""!==g||r.contains(a.ownerDocument,a)||(g=r.style(a,b)),!o.pixelMarginRight()&&La.test(g)&&Ka.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function Oa(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}var Pa=/^(none|table(?!-c[ea]).+)/,Qa={position:"absolute",visibility:"hidden",display:"block"},Ra={letterSpacing:"0",fontWeight:"400"},Sa=["Webkit","Moz","ms"],Ta=d.createElement("div").style;function Ua(a){if(a in Ta)return a;var b=a[0].toUpperCase()+a.slice(1),c=Sa.length;while(c--)if(a=Sa[c]+b,a in Ta)return a}function Va(a,b,c){var d=aa.exec(b);return d?Math.max(0,d[2]-(c||0))+(d[3]||"px"):b}function Wa(a,b,c,d,e){var f,g=0;for(f=c===(d?"border":"content")?4:"width"===b?1:0;f<4;f+=2)"margin"===c&&(g+=r.css(a,c+ba[f],!0,e)),d?("content"===c&&(g-=r.css(a,"padding"+ba[f],!0,e)),"margin"!==c&&(g-=r.css(a,"border"+ba[f]+"Width",!0,e))):(g+=r.css(a,"padding"+ba[f],!0,e),"padding"!==c&&(g+=r.css(a,"border"+ba[f]+"Width",!0,e)));return g}function Xa(a,b,c){var d,e=!0,f=Ma(a),g="border-box"===r.css(a,"boxSizing",!1,f);if(a.getClientRects().length&&(d=a.getBoundingClientRect()[b]),d<=0||null==d){if(d=Na(a,b,f),(d<0||null==d)&&(d=a.style[b]),La.test(d))return d;e=g&&(o.boxSizingReliable()||d===a.style[b]),d=parseFloat(d)||0}return d+Wa(a,b,c||(g?"border":"content"),e,f)+"px"}r.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Na(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=r.camelCase(b),i=a.style;return b=r.cssProps[h]||(r.cssProps[h]=Ua(h)||h),g=r.cssHooks[b]||r.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=aa.exec(c))&&e[1]&&(c=ea(a,b,e),f="number"),null!=c&&c===c&&("number"===f&&(c+=e&&e[3]||(r.cssNumber[h]?"":"px")),o.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=r.camelCase(b);return b=r.cssProps[h]||(r.cssProps[h]=Ua(h)||h),g=r.cssHooks[b]||r.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=Na(a,b,d)),"normal"===e&&b in Ra&&(e=Ra[b]),""===c||c?(f=parseFloat(e),c===!0||isFinite(f)?f||0:e):e}}),r.each(["height","width"],function(a,b){r.cssHooks[b]={get:function(a,c,d){if(c)return!Pa.test(r.css(a,"display"))||a.getClientRects().length&&a.getBoundingClientRect().width?Xa(a,b,d):da(a,Qa,function(){return Xa(a,b,d)})},set:function(a,c,d){var e,f=d&&Ma(a),g=d&&Wa(a,b,d,"border-box"===r.css(a,"boxSizing",!1,f),f);return g&&(e=aa.exec(c))&&"px"!==(e[3]||"px")&&(a.style[b]=c,c=r.css(a,b)),Va(a,c,g)}}}),r.cssHooks.marginLeft=Oa(o.reliableMarginLeft,function(a,b){if(b)return(parseFloat(Na(a,"marginLeft"))||a.getBoundingClientRect().left-da(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+"px"}),r.each({margin:"",padding:"",border:"Width"},function(a,b){r.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];d<4;d++)e[a+ba[d]+b]=f[d]||f[d-2]||f[0];return e}},Ka.test(a)||(r.cssHooks[a+b].set=Va)}),r.fn.extend({css:function(a,b){return S(this,function(a,b,c){var d,e,f={},g=0;if(r.isArray(b)){for(d=Ma(a),e=b.length;g<e;g++)f[b[g]]=r.css(a,b[g],!1,d);return f}return void 0!==c?r.style(a,b,c):r.css(a,b)},a,b,arguments.length>1)}});function Ya(a,b,c,d,e){return new Ya.prototype.init(a,b,c,d,e)}r.Tween=Ya,Ya.prototype={constructor:Ya,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||r.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(r.cssNumber[c]?"":"px")},cur:function(){var a=Ya.propHooks[this.prop];return a&&a.get?a.get(this):Ya.propHooks._default.get(this)},run:function(a){var b,c=Ya.propHooks[this.prop];return this.options.duration?this.pos=b=r.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Ya.propHooks._default.set(this),this}},Ya.prototype.init.prototype=Ya.prototype,Ya.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=r.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){r.fx.step[a.prop]?r.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[r.cssProps[a.prop]]&&!r.cssHooks[a.prop]?a.elem[a.prop]=a.now:r.style(a.elem,a.prop,a.now+a.unit)}}},Ya.propHooks.scrollTop=Ya.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},r.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},r.fx=Ya.prototype.init,r.fx.step={};var Za,$a,_a=/^(?:toggle|show|hide)$/,ab=/queueHooks$/;function bb(){$a&&(a.requestAnimationFrame(bb),r.fx.tick())}function cb(){return a.setTimeout(function(){Za=void 0}),Za=r.now()}function db(a,b){var c,d=0,e={height:a};for(b=b?1:0;d<4;d+=2-b)c=ba[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function eb(a,b,c){for(var d,e=(hb.tweeners[b]||[]).concat(hb.tweeners["*"]),f=0,g=e.length;f<g;f++)if(d=e[f].call(c,b,a))return d}function fb(a,b,c){var d,e,f,g,h,i,j,k,l="width"in b||"height"in b,m=this,n={},o=a.style,p=a.nodeType&&ca(a),q=V.get(a,"fxshow");c.queue||(g=r._queueHooks(a,"fx"),null==g.unqueued&&(g.unqueued=0,h=g.empty.fire,g.empty.fire=function(){g.unqueued||h()}),g.unqueued++,m.always(function(){m.always(function(){g.unqueued--,r.queue(a,"fx").length||g.empty.fire()})}));for(d in b)if(e=b[d],_a.test(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}n[d]=q&&q[d]||r.style(a,d)}if(i=!r.isEmptyObject(b),i||!r.isEmptyObject(n)){l&&1===a.nodeType&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=q&&q.display,null==j&&(j=V.get(a,"display")),k=r.css(a,"display"),"none"===k&&(j?k=j:(ha([a],!0),j=a.style.display||j,k=r.css(a,"display"),ha([a]))),("inline"===k||"inline-block"===k&&null!=j)&&"none"===r.css(a,"float")&&(i||(m.done(function(){o.display=j}),null==j&&(k=o.display,j="none"===k?"":k)),o.display="inline-block")),c.overflow&&(o.overflow="hidden",m.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]})),i=!1;for(d in n)i||(q?"hidden"in q&&(p=q.hidden):q=V.access(a,"fxshow",{display:j}),f&&(q.hidden=!p),p&&ha([a],!0),m.done(function(){p||ha([a]),V.remove(a,"fxshow");for(d in n)r.style(a,d,n[d])})),i=eb(p?q[d]:0,d,m),d in q||(q[d]=i.start,p&&(i.end=i.start,i.start=0))}}function gb(a,b){var c,d,e,f,g;for(c in a)if(d=r.camelCase(c),e=b[d],f=a[c],r.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=r.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function hb(a,b,c){var d,e,f=0,g=hb.prefilters.length,h=r.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Za||cb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;g<i;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),f<1&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:r.extend({},b),opts:r.extend(!0,{specialEasing:{},easing:r.easing._default},c),originalProperties:b,originalOptions:c,startTime:Za||cb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=r.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;c<d;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for(gb(k,j.opts.specialEasing);f<g;f++)if(d=hb.prefilters[f].call(j,a,k,j.opts))return r.isFunction(d.stop)&&(r._queueHooks(j.elem,j.opts.queue).stop=r.proxy(d.stop,d)),d;return r.map(k,eb,j),r.isFunction(j.opts.start)&&j.opts.start.call(a,j),r.fx.timer(r.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}r.Animation=r.extend(hb,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return ea(c.elem,a,aa.exec(b),c),c}]},tweener:function(a,b){r.isFunction(a)?(b=a,a=["*"]):a=a.match(K);for(var c,d=0,e=a.length;d<e;d++)c=a[d],hb.tweeners[c]=hb.tweeners[c]||[],hb.tweeners[c].unshift(b)},prefilters:[fb],prefilter:function(a,b){b?hb.prefilters.unshift(a):hb.prefilters.push(a)}}),r.speed=function(a,b,c){var e=a&&"object"==typeof a?r.extend({},a):{complete:c||!c&&b||r.isFunction(a)&&a,duration:a,easing:c&&b||b&&!r.isFunction(b)&&b};return r.fx.off||d.hidden?e.duration=0:"number"!=typeof e.duration&&(e.duration in r.fx.speeds?e.duration=r.fx.speeds[e.duration]:e.duration=r.fx.speeds._default),null!=e.queue&&e.queue!==!0||(e.queue="fx"),e.old=e.complete,e.complete=function(){r.isFunction(e.old)&&e.old.call(this),e.queue&&r.dequeue(this,e.queue)},e},r.fn.extend({fadeTo:function(a,b,c,d){return this.filter(ca).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=r.isEmptyObject(a),f=r.speed(b,c,d),g=function(){var b=hb(this,r.extend({},a),f);(e||V.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=r.timers,g=V.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&ab.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||r.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=V.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=r.timers,g=d?d.length:0;for(c.finish=!0,r.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;b<g;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),r.each(["toggle","show","hide"],function(a,b){var c=r.fn[b];r.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(db(b,!0),a,d,e)}}),r.each({slideDown:db("show"),slideUp:db("hide"),slideToggle:db("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){r.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),r.timers=[],r.fx.tick=function(){var a,b=0,c=r.timers;for(Za=r.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||r.fx.stop(),Za=void 0},r.fx.timer=function(a){r.timers.push(a),a()?r.fx.start():r.timers.pop()},r.fx.interval=13,r.fx.start=function(){$a||($a=a.requestAnimationFrame?a.requestAnimationFrame(bb):a.setInterval(r.fx.tick,r.fx.interval))},r.fx.stop=function(){a.cancelAnimationFrame?a.cancelAnimationFrame($a):a.clearInterval($a),$a=null},r.fx.speeds={slow:600,fast:200,_default:400},r.fn.delay=function(b,c){return b=r.fx?r.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a=d.createElement("input"),b=d.createElement("select"),c=b.appendChild(d.createElement("option"));a.type="checkbox",o.checkOn=""!==a.value,o.optSelected=c.selected,a=d.createElement("input"),a.value="t",a.type="radio",o.radioValue="t"===a.value}();var ib,jb=r.expr.attrHandle;r.fn.extend({attr:function(a,b){return S(this,r.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){r.removeAttr(this,a)})}}),r.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return"undefined"==typeof a.getAttribute?r.prop(a,b,c):(1===f&&r.isXMLDoc(a)||(e=r.attrHooks[b.toLowerCase()]||(r.expr.match.bool.test(b)?ib:void 0)),\nvoid 0!==c?null===c?void r.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:(d=r.find.attr(a,b),null==d?void 0:d))},attrHooks:{type:{set:function(a,b){if(!o.radioValue&&"radio"===b&&r.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d=0,e=b&&b.match(K);if(e&&1===a.nodeType)while(c=e[d++])a.removeAttribute(c)}}),ib={set:function(a,b,c){return b===!1?r.removeAttr(a,c):a.setAttribute(c,c),c}},r.each(r.expr.match.bool.source.match(/\\w+/g),function(a,b){var c=jb[b]||r.find.attr;jb[b]=function(a,b,d){var e,f,g=b.toLowerCase();return d||(f=jb[g],jb[g]=e,e=null!=c(a,b,d)?g:null,jb[g]=f),e}});var kb=/^(?:input|select|textarea|button)$/i,lb=/^(?:a|area)$/i;r.fn.extend({prop:function(a,b){return S(this,r.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[r.propFix[a]||a]})}}),r.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&r.isXMLDoc(a)||(b=r.propFix[b]||b,e=r.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=r.find.attr(a,"tabindex");return b?parseInt(b,10):kb.test(a.nodeName)||lb.test(a.nodeName)&&a.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),o.optSelected||(r.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),r.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){r.propFix[this.toLowerCase()]=this});function mb(a){var b=a.match(K)||[];return b.join(" ")}function nb(a){return a.getAttribute&&a.getAttribute("class")||""}r.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(r.isFunction(a))return this.each(function(b){r(this).addClass(a.call(this,b,nb(this)))});if("string"==typeof a&&a){b=a.match(K)||[];while(c=this[i++])if(e=nb(c),d=1===c.nodeType&&" "+mb(e)+" "){g=0;while(f=b[g++])d.indexOf(" "+f+" ")<0&&(d+=f+" ");h=mb(d),e!==h&&c.setAttribute("class",h)}}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(r.isFunction(a))return this.each(function(b){r(this).removeClass(a.call(this,b,nb(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a){b=a.match(K)||[];while(c=this[i++])if(e=nb(c),d=1===c.nodeType&&" "+mb(e)+" "){g=0;while(f=b[g++])while(d.indexOf(" "+f+" ")>-1)d=d.replace(" "+f+" "," ");h=mb(d),e!==h&&c.setAttribute("class",h)}}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):r.isFunction(a)?this.each(function(c){r(this).toggleClass(a.call(this,c,nb(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c){d=0,e=r(this),f=a.match(K)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else void 0!==a&&"boolean"!==c||(b=nb(this),b&&V.set(this,"__className__",b),this.setAttribute&&this.setAttribute("class",b||a===!1?"":V.get(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;b=" "+a+" ";while(c=this[d++])if(1===c.nodeType&&(" "+mb(nb(c))+" ").indexOf(b)>-1)return!0;return!1}});var ob=/\\r/g;r.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=r.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,r(this).val()):a,null==e?e="":"number"==typeof e?e+="":r.isArray(e)&&(e=r.map(e,function(a){return null==a?"":a+""})),b=r.valHooks[this.type]||r.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=r.valHooks[e.type]||r.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(ob,""):null==c?"":c)}}}),r.extend({valHooks:{option:{get:function(a){var b=r.find.attr(a,"value");return null!=b?b:mb(r.text(a))}},select:{get:function(a){var b,c,d,e=a.options,f=a.selectedIndex,g="select-one"===a.type,h=g?null:[],i=g?f+1:e.length;for(d=f<0?i:g?f:0;d<i;d++)if(c=e[d],(c.selected||d===f)&&!c.disabled&&(!c.parentNode.disabled||!r.nodeName(c.parentNode,"optgroup"))){if(b=r(c).val(),g)return b;h.push(b)}return h},set:function(a,b){var c,d,e=a.options,f=r.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=r.inArray(r.valHooks.option.get(d),f)>-1)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),r.each(["radio","checkbox"],function(){r.valHooks[this]={set:function(a,b){if(r.isArray(b))return a.checked=r.inArray(r(a).val(),b)>-1}},o.checkOn||(r.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var pb=/^(?:focusinfocus|focusoutblur)$/;r.extend(r.event,{trigger:function(b,c,e,f){var g,h,i,j,k,m,n,o=[e||d],p=l.call(b,"type")?b.type:b,q=l.call(b,"namespace")?b.namespace.split("."):[];if(h=i=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!pb.test(p+r.event.triggered)&&(p.indexOf(".")>-1&&(q=p.split("."),p=q.shift(),q.sort()),k=p.indexOf(":")<0&&"on"+p,b=b[r.expando]?b:new r.Event(p,"object"==typeof b&&b),b.isTrigger=f?2:3,b.namespace=q.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\\\.)"+q.join("\\\\.(?:.*\\\\.|)")+"(\\\\.|$)"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:r.makeArray(c,[b]),n=r.event.special[p]||{},f||!n.trigger||n.trigger.apply(e,c)!==!1)){if(!f&&!n.noBubble&&!r.isWindow(e)){for(j=n.delegateType||p,pb.test(j+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),i=h;i===(e.ownerDocument||d)&&o.push(i.defaultView||i.parentWindow||a)}g=0;while((h=o[g++])&&!b.isPropagationStopped())b.type=g>1?j:n.bindType||p,m=(V.get(h,"events")||{})[b.type]&&V.get(h,"handle"),m&&m.apply(h,c),m=k&&h[k],m&&m.apply&&T(h)&&(b.result=m.apply(h,c),b.result===!1&&b.preventDefault());return b.type=p,f||b.isDefaultPrevented()||n._default&&n._default.apply(o.pop(),c)!==!1||!T(e)||k&&r.isFunction(e[p])&&!r.isWindow(e)&&(i=e[k],i&&(e[k]=null),r.event.triggered=p,e[p](),r.event.triggered=void 0,i&&(e[k]=i)),b.result}},simulate:function(a,b,c){var d=r.extend(new r.Event,c,{type:a,isSimulated:!0});r.event.trigger(d,null,b)}}),r.fn.extend({trigger:function(a,b){return this.each(function(){r.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];if(c)return r.event.trigger(a,b,c,!0)}}),r.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(a,b){r.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),r.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),o.focusin="onfocusin"in a,o.focusin||r.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){r.event.simulate(b,a.target,r.event.fix(a))};r.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=V.access(d,b);e||d.addEventListener(a,c,!0),V.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=V.access(d,b)-1;e?V.access(d,b,e):(d.removeEventListener(a,c,!0),V.remove(d,b))}}});var qb=a.location,rb=r.now(),sb=/\\?/;r.parseXML=function(b){var c;if(!b||"string"!=typeof b)return null;try{c=(new a.DOMParser).parseFromString(b,"text/xml")}catch(d){c=void 0}return c&&!c.getElementsByTagName("parsererror").length||r.error("Invalid XML: "+b),c};var tb=/\\[\\]$/,ub=/\\r?\\n/g,vb=/^(?:submit|button|image|reset|file)$/i,wb=/^(?:input|select|textarea|keygen)/i;function xb(a,b,c,d){var e;if(r.isArray(b))r.each(b,function(b,e){c||tb.test(a)?d(a,e):xb(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==r.type(b))d(a,b);else for(e in b)xb(a+"["+e+"]",b[e],c,d)}r.param=function(a,b){var c,d=[],e=function(a,b){var c=r.isFunction(b)?b():b;d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(null==c?"":c)};if(r.isArray(a)||a.jquery&&!r.isPlainObject(a))r.each(a,function(){e(this.name,this.value)});else for(c in a)xb(c,a[c],b,e);return d.join("&")},r.fn.extend({serialize:function(){return r.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=r.prop(this,"elements");return a?r.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!r(this).is(":disabled")&&wb.test(this.nodeName)&&!vb.test(a)&&(this.checked||!ia.test(a))}).map(function(a,b){var c=r(this).val();return null==c?null:r.isArray(c)?r.map(c,function(a){return{name:b.name,value:a.replace(ub,"\\r\\n")}}):{name:b.name,value:c.replace(ub,"\\r\\n")}}).get()}});var yb=/%20/g,zb=/#.*$/,Ab=/([?&])_=[^&]*/,Bb=/^(.*?):[ \\t]*([^\\r\\n]*)$/gm,Cb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Db=/^(?:GET|HEAD)$/,Eb=/^\\/\\//,Fb={},Gb={},Hb="*/".concat("*"),Ib=d.createElement("a");Ib.href=qb.href;function Jb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(K)||[];if(r.isFunction(c))while(d=f[e++])"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Kb(a,b,c,d){var e={},f=a===Gb;function g(h){var i;return e[h]=!0,r.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Lb(a,b){var c,d,e=r.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&r.extend(!0,a,d),a}function Mb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}if(f)return f!==i[0]&&i.unshift(f),c[f]}function Nb(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}r.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:qb.href,type:"GET",isLocal:Cb.test(qb.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Hb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\\bxml\\b/,html:/\\bhtml/,json:/\\bjson\\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":r.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Lb(Lb(a,r.ajaxSettings),b):Lb(r.ajaxSettings,a)},ajaxPrefilter:Jb(Fb),ajaxTransport:Jb(Gb),ajax:function(b,c){"object"==typeof b&&(c=b,b=void 0),c=c||{};var e,f,g,h,i,j,k,l,m,n,o=r.ajaxSetup({},c),p=o.context||o,q=o.context&&(p.nodeType||p.jquery)?r(p):r.event,s=r.Deferred(),t=r.Callbacks("once memory"),u=o.statusCode||{},v={},w={},x="canceled",y={readyState:0,getResponseHeader:function(a){var b;if(k){if(!h){h={};while(b=Bb.exec(g))h[b[1].toLowerCase()]=b[2]}b=h[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return k?g:null},setRequestHeader:function(a,b){return null==k&&(a=w[a.toLowerCase()]=w[a.toLowerCase()]||a,v[a]=b),this},overrideMimeType:function(a){return null==k&&(o.mimeType=a),this},statusCode:function(a){var b;if(a)if(k)y.always(a[y.status]);else for(b in a)u[b]=[u[b],a[b]];return this},abort:function(a){var b=a||x;return e&&e.abort(b),A(0,b),this}};if(s.promise(y),o.url=((b||o.url||qb.href)+"").replace(Eb,qb.protocol+"//"),o.type=c.method||c.type||o.method||o.type,o.dataTypes=(o.dataType||"*").toLowerCase().match(K)||[""],null==o.crossDomain){j=d.createElement("a");try{j.href=o.url,j.href=j.href,o.crossDomain=Ib.protocol+"//"+Ib.host!=j.protocol+"//"+j.host}catch(z){o.crossDomain=!0}}if(o.data&&o.processData&&"string"!=typeof o.data&&(o.data=r.param(o.data,o.traditional)),Kb(Fb,o,c,y),k)return y;l=r.event&&o.global,l&&0===r.active++&&r.event.trigger("ajaxStart"),o.type=o.type.toUpperCase(),o.hasContent=!Db.test(o.type),f=o.url.replace(zb,""),o.hasContent?o.data&&o.processData&&0===(o.contentType||"").indexOf("application/x-www-form-urlencoded")&&(o.data=o.data.replace(yb,"+")):(n=o.url.slice(f.length),o.data&&(f+=(sb.test(f)?"&":"?")+o.data,delete o.data),o.cache===!1&&(f=f.replace(Ab,"$1"),n=(sb.test(f)?"&":"?")+"_="+rb++ +n),o.url=f+n),o.ifModified&&(r.lastModified[f]&&y.setRequestHeader("If-Modified-Since",r.lastModified[f]),r.etag[f]&&y.setRequestHeader("If-None-Match",r.etag[f])),(o.data&&o.hasContent&&o.contentType!==!1||c.contentType)&&y.setRequestHeader("Content-Type",o.contentType),y.setRequestHeader("Accept",o.dataTypes[0]&&o.accepts[o.dataTypes[0]]?o.accepts[o.dataTypes[0]]+("*"!==o.dataTypes[0]?", "+Hb+"; q=0.01":""):o.accepts["*"]);for(m in o.headers)y.setRequestHeader(m,o.headers[m]);if(o.beforeSend&&(o.beforeSend.call(p,y,o)===!1||k))return y.abort();if(x="abort",t.add(o.complete),y.done(o.success),y.fail(o.error),e=Kb(Gb,o,c,y)){if(y.readyState=1,l&&q.trigger("ajaxSend",[y,o]),k)return y;o.async&&o.timeout>0&&(i=a.setTimeout(function(){y.abort("timeout")},o.timeout));try{k=!1,e.send(v,A)}catch(z){if(k)throw z;A(-1,z)}}else A(-1,"No Transport");function A(b,c,d,h){var j,m,n,v,w,x=c;k||(k=!0,i&&a.clearTimeout(i),e=void 0,g=h||"",y.readyState=b>0?4:0,j=b>=200&&b<300||304===b,d&&(v=Mb(o,y,d)),v=Nb(o,v,y,j),j?(o.ifModified&&(w=y.getResponseHeader("Last-Modified"),w&&(r.lastModified[f]=w),w=y.getResponseHeader("etag"),w&&(r.etag[f]=w)),204===b||"HEAD"===o.type?x="nocontent":304===b?x="notmodified":(x=v.state,m=v.data,n=v.error,j=!n)):(n=x,!b&&x||(x="error",b<0&&(b=0))),y.status=b,y.statusText=(c||x)+"",j?s.resolveWith(p,[m,x,y]):s.rejectWith(p,[y,x,n]),y.statusCode(u),u=void 0,l&&q.trigger(j?"ajaxSuccess":"ajaxError",[y,o,j?m:n]),t.fireWith(p,[y,x]),l&&(q.trigger("ajaxComplete",[y,o]),--r.active||r.event.trigger("ajaxStop")))}return y},getJSON:function(a,b,c){return r.get(a,b,c,"json")},getScript:function(a,b){return r.get(a,void 0,b,"script")}}),r.each(["get","post"],function(a,b){r[b]=function(a,c,d,e){return r.isFunction(c)&&(e=e||d,d=c,c=void 0),r.ajax(r.extend({url:a,type:b,dataType:e,data:c,success:d},r.isPlainObject(a)&&a))}}),r._evalUrl=function(a){return r.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},r.fn.extend({wrapAll:function(a){var b;return this[0]&&(r.isFunction(a)&&(a=a.call(this[0])),b=r(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(a){return r.isFunction(a)?this.each(function(b){r(this).wrapInner(a.call(this,b))}):this.each(function(){var b=r(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=r.isFunction(a);return this.each(function(c){r(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(a){return this.parent(a).not("body").each(function(){r(this).replaceWith(this.childNodes)}),this}}),r.expr.pseudos.hidden=function(a){return!r.expr.pseudos.visible(a)},r.expr.pseudos.visible=function(a){return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)},r.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch(b){}};var Ob={0:200,1223:204},Pb=r.ajaxSettings.xhr();o.cors=!!Pb&&"withCredentials"in Pb,o.ajax=Pb=!!Pb,r.ajaxTransport(function(b){var c,d;if(o.cors||Pb&&!b.crossDomain)return{send:function(e,f){var g,h=b.xhr();if(h.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(g in b.xhrFields)h[g]=b.xhrFields[g];b.mimeType&&h.overrideMimeType&&h.overrideMimeType(b.mimeType),b.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");for(g in e)h.setRequestHeader(g,e[g]);c=function(a){return function(){c&&(c=d=h.onload=h.onerror=h.onabort=h.onreadystatechange=null,"abort"===a?h.abort():"error"===a?"number"!=typeof h.status?f(0,"error"):f(h.status,h.statusText):f(Ob[h.status]||h.status,h.statusText,"text"!==(h.responseType||"text")||"string"!=typeof h.responseText?{binary:h.response}:{text:h.responseText},h.getAllResponseHeaders()))}},h.onload=c(),d=h.onerror=c("error"),void 0!==h.onabort?h.onabort=d:h.onreadystatechange=function(){4===h.readyState&&a.setTimeout(function(){c&&d()})},c=c("abort");try{h.send(b.hasContent&&b.data||null)}catch(i){if(c)throw i}},abort:function(){c&&c()}}}),r.ajaxPrefilter(function(a){a.crossDomain&&(a.contents.script=!1)}),r.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\\b(?:java|ecma)script\\b/},converters:{"text script":function(a){return r.globalEval(a),a}}}),r.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),r.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(e,f){b=r("<script>").prop({charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&f("error"===a.type?404:200,a.type)}),d.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Qb=[],Rb=/(=)\\?(?=&|$)|\\?\\?/;r.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Qb.pop()||r.expando+"_"+rb++;return this[a]=!0,a}}),r.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Rb.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Rb.test(b.data)&&"data");if(h||"jsonp"===b.dataTypes[0])return e=b.jsonpCallback=r.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Rb,"$1"+e):b.jsonp!==!1&&(b.url+=(sb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||r.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?r(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Qb.push(e)),g&&r.isFunction(f)&&f(g[0]),g=f=void 0}),"script"}),o.createHTMLDocument=function(){var a=d.implementation.createHTMLDocument("").body;return a.innerHTML="<form></form><form></form>",2===a.childNodes.length}(),r.parseHTML=function(a,b,c){if("string"!=typeof a)return[];"boolean"==typeof b&&(c=b,b=!1);var e,f,g;return b||(o.createHTMLDocument?(b=d.implementation.createHTMLDocument(""),e=b.createElement("base"),e.href=d.location.href,b.head.appendChild(e)):b=d),f=B.exec(a),g=!c&&[],f?[b.createElement(f[1])]:(f=pa([a],b,g),g&&g.length&&r(g).remove(),r.merge([],f.childNodes))},r.fn.load=function(a,b,c){var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=mb(a.slice(h)),a=a.slice(0,h)),r.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&r.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?r("<div>").append(r.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},r.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){r.fn[b]=function(a){return this.on(b,a)}}),r.expr.pseudos.animated=function(a){return r.grep(r.timers,function(b){return a===b.elem}).length};function Sb(a){return r.isWindow(a)?a:9===a.nodeType&&a.defaultView}r.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=r.css(a,"position"),l=r(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=r.css(a,"top"),i=r.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),r.isFunction(b)&&(b=b.call(a,c,r.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},r.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){r.offset.setOffset(this,a,b)});var b,c,d,e,f=this[0];if(f)return f.getClientRects().length?(d=f.getBoundingClientRect(),d.width||d.height?(e=f.ownerDocument,c=Sb(e),b=e.documentElement,{top:d.top+c.pageYOffset-b.clientTop,left:d.left+c.pageXOffset-b.clientLeft}):d):{top:0,left:0}},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===r.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),r.nodeName(a[0],"html")||(d=a.offset()),d={top:d.top+r.css(a[0],"borderTopWidth",!0),left:d.left+r.css(a[0],"borderLeftWidth",!0)}),{top:b.top-d.top-r.css(c,"marginTop",!0),left:b.left-d.left-r.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent;while(a&&"static"===r.css(a,"position"))a=a.offsetParent;return a||qa})}}),r.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c="pageYOffset"===b;r.fn[a]=function(d){return S(this,function(a,d,e){var f=Sb(a);return void 0===e?f?f[b]:a[d]:void(f?f.scrollTo(c?f.pageXOffset:e,c?e:f.pageYOffset):a[d]=e)},a,d,arguments.length)}}),r.each(["top","left"],function(a,b){r.cssHooks[b]=Oa(o.pixelPosition,function(a,c){if(c)return c=Na(a,b),La.test(c)?r(a).position()[b]+"px":c})}),r.each({Height:"height",Width:"width"},function(a,b){r.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){r.fn[d]=function(e,f){var g=arguments.length&&(c||"boolean"!=typeof e),h=c||(e===!0||f===!0?"margin":"border");return S(this,function(b,c,e){var f;return r.isWindow(b)?0===d.indexOf("outer")?b["inner"+a]:b.document.documentElement["client"+a]:9===b.nodeType?(f=b.documentElement,Math.max(b.body["scroll"+a],f["scroll"+a],b.body["offset"+a],f["offset"+a],f["client"+a])):void 0===e?r.css(b,c,h):r.style(b,c,e,h)},b,g?e:void 0,g)}})}),r.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}}),r.parseJSON=JSON.parse,"function"==typeof define&&define.amd&&define("jquery",[],function(){return r});var Tb=a.jQuery,Ub=a.$;return r.noConflict=function(b){return a.$===r&&(a.$=Ub),b&&a.jQuery===r&&(a.jQuery=Tb),r},b||(a.jQuery=a.$=r),r});\n';
},764:function(t,n){t.exports="(function ($) {\n    $(document).ready(function () {\n\n    });\n})(jQuery);"},765:function(t,n){t.exports="/**\n * plugin.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*global tinymce:true */\n\ntinymce.PluginManager.add('link', function(editor) {\n\tfunction createLinkList(callback) {\n\t\treturn function() {\n\t\t\tvar linkList = editor.settings.link_list;\n\n\t\t\tif (typeof linkList == \"string\") {\n\t\t\t\ttinymce.util.XHR.send({\n\t\t\t\t\turl: linkList,\n\t\t\t\t\tsuccess: function(text) {\n\t\t\t\t\t\tcallback(tinymce.util.JSON.parse(text));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (typeof linkList == \"function\") {\n\t\t\t\tlinkList(callback);\n\t\t\t} else {\n\t\t\t\tcallback(linkList);\n\t\t\t}\n\t\t};\n\t}\n\n\tfunction buildListItems(inputList, itemCallback, startItems) {\n\t\tfunction appendItems(values, output) {\n\t\t\toutput = output || [];\n\n\t\t\ttinymce.each(values, function(item) {\n\t\t\t\tvar menuItem = {text: item.text || item.title};\n\n\t\t\t\tif (item.menu) {\n\t\t\t\t\tmenuItem.menu = appendItems(item.menu);\n\t\t\t\t} else {\n\t\t\t\t\tmenuItem.value = item.value;\n\n\t\t\t\t\tif (itemCallback) {\n\t\t\t\t\t\titemCallback(menuItem);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\toutput.push(menuItem);\n\t\t\t});\n\n\t\t\treturn output;\n\t\t}\n\n\t\treturn appendItems(inputList, startItems || []);\n\t}\n\n\tfunction showDialog(linkList) {\n\t\tvar data = {}, selection = editor.selection, dom = editor.dom, selectedElm, anchorElm, initialText;\n\t\tvar win, onlyText, textListCtrl, linkListCtrl, relListCtrl, targetListCtrl, classListCtrl, linkTitleCtrl, value;\n\n\t\tfunction linkListChangeHandler(e) {\n\t\t\tvar textCtrl = win.find('#text');\n\n\t\t\tif (!textCtrl.value() || (e.lastControl && textCtrl.value() == e.lastControl.text())) {\n\t\t\t\ttextCtrl.value(e.control.text());\n\t\t\t}\n\n\t\t\twin.find('#href').value(e.control.value());\n\t\t}\n\n\t\tfunction buildAnchorListControl(url) {\n\t\t\tvar anchorList = [];\n\n\t\t\ttinymce.each(editor.dom.select('a:not([href])'), function(anchor) {\n\t\t\t\tvar id = anchor.name || anchor.id;\n\n\t\t\t\tif (id) {\n\t\t\t\t\tanchorList.push({\n\t\t\t\t\t\ttext: id,\n\t\t\t\t\t\tvalue: '#' + id,\n\t\t\t\t\t\tselected: url.indexOf('#' + id) != -1\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (anchorList.length) {\n\t\t\t\tanchorList.unshift({text: 'None', value: ''});\n\n\t\t\t\treturn {\n\t\t\t\t\tname: 'anchor',\n\t\t\t\t\ttype: 'listbox',\n\t\t\t\t\tlabel: 'Anchors',\n\t\t\t\t\tvalues: anchorList,\n\t\t\t\t\tonselect: linkListChangeHandler\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tfunction updateText() {\n\t\t\tif (!initialText && data.text.length === 0 && onlyText) {\n\t\t\t\tthis.parent().parent().find('#text')[0].value(this.value());\n\t\t\t}\n\t\t}\n\n\t\tfunction urlChange(e) {\n\t\t\tvar meta = e.meta || {};\n\n\t\t\tif (linkListCtrl) {\n\t\t\t\tlinkListCtrl.value(editor.convertURL(this.value(), 'href'));\n\t\t\t}\n\n\t\t\ttinymce.each(e.meta, function(value, key) {\n\t\t\t\twin.find('#' + key).value(value);\n\t\t\t});\n\n\t\t\tif (!meta.text) {\n\t\t\t\tupdateText.call(this);\n\t\t\t}\n\t\t}\n\n\t\tfunction isOnlyTextSelected(anchorElm) {\n\t\t\tvar html = selection.getContent();\n\n\t\t\t// Partial html and not a fully selected anchor element\n\t\t\tif (/</.test(html) && (!/^<a [^>]+>[^<]+<\\/a>$/.test(html) || html.indexOf('href=') == -1)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (anchorElm) {\n\t\t\t\tvar nodes = anchorElm.childNodes, i;\n\n\t\t\t\tif (nodes.length === 0) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tfor (i = nodes.length - 1; i >= 0; i--) {\n\t\t\t\t\tif (nodes[i].nodeType != 3) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\tselectedElm = selection.getNode();\n\t\tanchorElm = dom.getParent(selectedElm, 'a[href]');\n\t\tonlyText = isOnlyTextSelected();\n\n\t\tdata.text = initialText = anchorElm ? (anchorElm.innerText || anchorElm.textContent) : selection.getContent({format: 'text'});\n\t\tdata.href = anchorElm ? dom.getAttrib(anchorElm, 'href') : '';\n\n\t\tif (anchorElm) {\n\t\t\tdata.target = dom.getAttrib(anchorElm, 'target');\n\t\t} else if (editor.settings.default_link_target) {\n\t\t\tdata.target = editor.settings.default_link_target;\n\t\t}\n\n\t\tif ((value = dom.getAttrib(anchorElm, 'rel'))) {\n\t\t\tdata.rel = value;\n\t\t}\n\n\t\tif ((value = dom.getAttrib(anchorElm, 'class'))) {\n\t\t\tdata['class'] = value;\n\t\t}\n\n\t\tif ((value = dom.getAttrib(anchorElm, 'title'))) {\n\t\t\tdata.title = value;\n\t\t}\n\n\t\tif (onlyText) {\n\t\t\ttextListCtrl = {\n\t\t\t\tname: 'text',\n\t\t\t\ttype: 'textbox',\n\t\t\t\tsize: 40,\n\t\t\t\tlabel: 'Text to display',\n\t\t\t\tonchange: function() {\n\t\t\t\t\tdata.text = this.value();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (linkList) {\n\t\t\tlinkListCtrl = {\n\t\t\t\ttype: 'listbox',\n\t\t\t\tlabel: 'Link list',\n\t\t\t\tvalues: buildListItems(\n\t\t\t\t\tlinkList,\n\t\t\t\t\tfunction(item) {\n\t\t\t\t\t\titem.value = editor.convertURL(item.value || item.url, 'href');\n\t\t\t\t\t},\n\t\t\t\t\t[{text: 'None', value: ''}]\n\t\t\t\t),\n\t\t\t\tonselect: linkListChangeHandler,\n\t\t\t\tvalue: editor.convertURL(data.href, 'href'),\n\t\t\t\tonPostRender: function() {\n\t\t\t\t\t/*eslint consistent-this:0*/\n\t\t\t\t\tlinkListCtrl = this;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (editor.settings.target_list !== false) {\n\t\t\tif (!editor.settings.target_list) {\n\t\t\t\teditor.settings.target_list = [\n\t\t\t\t\t{text: 'None', value: ''},\n\t\t\t\t\t{text: 'New window', value: '_blank'}\n\t\t\t\t];\n\t\t\t}\n\n\t\t\ttargetListCtrl = {\n\t\t\t\tname: 'target',\n\t\t\t\ttype: 'listbox',\n\t\t\t\tlabel: 'Target',\n\t\t\t\tvalues: buildListItems(editor.settings.target_list)\n\t\t\t};\n\t\t}\n\n\t\tif (editor.settings.rel_list) {\n\t\t\trelListCtrl = {\n\t\t\t\tname: 'rel',\n\t\t\t\ttype: 'listbox',\n\t\t\t\tlabel: 'Rel',\n\t\t\t\tvalues: buildListItems(editor.settings.rel_list)\n\t\t\t};\n\t\t}\n\n\t\tif (editor.settings.link_class_list) {\n\t\t\tclassListCtrl = {\n\t\t\t\tname: 'class',\n\t\t\t\ttype: 'listbox',\n\t\t\t\tlabel: 'Class',\n\t\t\t\tvalues: buildListItems(\n\t\t\t\t\teditor.settings.link_class_list,\n\t\t\t\t\tfunction(item) {\n\t\t\t\t\t\tif (item.value) {\n\t\t\t\t\t\t\titem.textStyle = function() {\n\t\t\t\t\t\t\t\treturn editor.formatter.getCssText({inline: 'a', classes: [item.value]});\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t};\n\t\t}\n\n\t\tif (editor.settings.link_title !== false) {\n\t\t\tlinkTitleCtrl = {\n\t\t\t\tname: 'title',\n\t\t\t\ttype: 'textbox',\n\t\t\t\tlabel: 'Title',\n\t\t\t\tvalue: data.title\n\t\t\t};\n\t\t}\n\n\t\twin = editor.windowManager.open({\n\t\t\ttitle: 'Insert link',\n\t\t\tdata: data,\n\t\t\tbody: [\n\t\t\t\t{\n\t\t\t\t\tname: 'href',\n\t\t\t\t\ttype: 'filepicker',\n\t\t\t\t\tfiletype: 'file',\n\t\t\t\t\tsize: 40,\n\t\t\t\t\tautofocus: true,\n\t\t\t\t\tlabel: 'Url',\n\t\t\t\t\tonchange: urlChange,\n\t\t\t\t\tonkeyup: updateText\n\t\t\t\t},\n\t\t\t\ttextListCtrl,\n\t\t\t\tlinkTitleCtrl,\n\t\t\t\tbuildAnchorListControl(data.href),\n\t\t\t\tlinkListCtrl,\n\t\t\t\trelListCtrl,\n\t\t\t\ttargetListCtrl,\n\t\t\t\tclassListCtrl\n\t\t\t],\n\t\t\tonSubmit: function(e) {\n\t\t\t\t/*eslint dot-notation: 0*/\n\t\t\t\tvar href;\n\n\t\t\t\tdata = tinymce.extend(data, e.data);\n\t\t\t\thref = data.href;\n\n\t\t\t\t// Delay confirm since onSubmit will move focus\n\t\t\t\tfunction delayedConfirm(message, callback) {\n\t\t\t\t\tvar rng = editor.selection.getRng();\n\n\t\t\t\t\ttinymce.util.Delay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\teditor.windowManager.confirm(message, function(state) {\n\t\t\t\t\t\t\teditor.selection.setRng(rng);\n\t\t\t\t\t\t\tcallback(state);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction insertLink() {\n\t\t\t\t\tvar linkAttrs = {\n\t\t\t\t\t\thref: href,\n\t\t\t\t\t\ttarget: data.target ? data.target : null,\n\t\t\t\t\t\trel: data.rel ? data.rel : null,\n\t\t\t\t\t\t\"class\": data[\"class\"] ? data[\"class\"] : null,\n\t\t\t\t\t\ttitle: data.title ? data.title : null\n\t\t\t\t\t};\n\n\t\t\t\t\tif (anchorElm) {\n\t\t\t\t\t\teditor.focus();\n\n\t\t\t\t\t\tif (onlyText && data.text != initialText) {\n\t\t\t\t\t\t\tif (\"innerText\" in anchorElm) {\n\t\t\t\t\t\t\t\tanchorElm.innerText = data.text;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tanchorElm.textContent = data.text;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdom.setAttribs(anchorElm, linkAttrs);\n\n\t\t\t\t\t\tselection.select(anchorElm);\n\t\t\t\t\t\teditor.undoManager.add();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (onlyText) {\n\t\t\t\t\t\t\teditor.insertContent(dom.createHTML('a', linkAttrs, dom.encode(data.text)));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\teditor.execCommand('mceInsertLink', false, linkAttrs);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!href) {\n\t\t\t\t\teditor.execCommand('unlink');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Is email and not //user@domain.com\n\t\t\t\tif (href.indexOf('@') > 0 && href.indexOf('//') == -1 && href.indexOf('mailto:') == -1) {\n\t\t\t\t\tdelayedConfirm(\n\t\t\t\t\t\t'The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?',\n\t\t\t\t\t\tfunction(state) {\n\t\t\t\t\t\t\tif (state) {\n\t\t\t\t\t\t\t\thref = 'mailto:' + href;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tinsertLink();\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Is not protocol prefixed\n\t\t\t\tif ((editor.settings.link_assume_external_targets && !/^\\w+:/i.test(href)) ||\n\t\t\t\t\t(!editor.settings.link_assume_external_targets && /^\\s*www[\\.|\\d\\.]/i.test(href))) {\n\t\t\t\t\tdelayedConfirm(\n\t\t\t\t\t\t'The URL you entered seems to be an external link. Do you want to add the required http:// prefix?',\n\t\t\t\t\t\tfunction(state) {\n\t\t\t\t\t\t\tif (state) {\n\t\t\t\t\t\t\t\thref = 'http://' + href;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tinsertLink();\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tinsertLink();\n\t\t\t}\n\t\t});\n\t}\n\n\teditor.addButton('link', {\n\t\ticon: 'link',\n\t\ttooltip: 'Insert/edit link',\n\t\tshortcut: 'Meta+K',\n\t\tonclick: createLinkList(showDialog),\n\t\tstateSelector: 'a[href]'\n\t});\n\n\teditor.addButton('unlink', {\n\t\ticon: 'unlink',\n\t\ttooltip: 'Remove link',\n\t\tcmd: 'unlink',\n\t\tstateSelector: 'a[href]'\n\t});\n\n\teditor.addShortcut('Meta+K', '', createLinkList(showDialog));\n\teditor.addCommand('mceLink', createLinkList(showDialog));\n\n\tthis.showDialog = showDialog;\n\n\teditor.addMenuItem('link', {\n\t\ticon: 'link',\n\t\ttext: 'Insert/edit link',\n\t\tshortcut: 'Meta+K',\n\t\tonclick: createLinkList(showDialog),\n\t\tstateSelector: 'a[href]',\n\t\tcontext: 'insert',\n\t\tprependToContext: true\n\t});\n});\n"},766:function(t,n){t.exports="/**\n * Compiled inline version. (Library mode)\n */\n\n/*jshint smarttabs:true, undef:true, latedef:true, curly:true, bitwise:true, camelcase:true */\n/*globals $code */\n\n(function(exports, undefined) {\n\t\"use strict\";\n\n\tvar modules = {};\n\n\tfunction require(ids, callback) {\n\t\tvar module, defs = [];\n\n\t\tfor (var i = 0; i < ids.length; ++i) {\n\t\t\tmodule = modules[ids[i]] || resolve(ids[i]);\n\t\t\tif (!module) {\n\t\t\t\tthrow 'module definition dependecy not found: ' + ids[i];\n\t\t\t}\n\n\t\t\tdefs.push(module);\n\t\t}\n\n\t\tcallback.apply(null, defs);\n\t}\n\n\tfunction define(id, dependencies, definition) {\n\t\tif (typeof id !== 'string') {\n\t\t\tthrow 'invalid module definition, module id must be defined and be a string';\n\t\t}\n\n\t\tif (dependencies === undefined) {\n\t\t\tthrow 'invalid module definition, dependencies must be specified';\n\t\t}\n\n\t\tif (definition === undefined) {\n\t\t\tthrow 'invalid module definition, definition function must be specified';\n\t\t}\n\n\t\trequire(dependencies, function() {\n\t\t\tmodules[id] = definition.apply(null, arguments);\n\t\t});\n\t}\n\n\tfunction defined(id) {\n\t\treturn !!modules[id];\n\t}\n\n\tfunction resolve(id) {\n\t\tvar target = exports;\n\t\tvar fragments = id.split(/[.\\/]/);\n\n\t\tfor (var fi = 0; fi < fragments.length; ++fi) {\n\t\t\tif (!target[fragments[fi]]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttarget = target[fragments[fi]];\n\t\t}\n\n\t\treturn target;\n\t}\n\n\tfunction expose(ids) {\n\t\tvar i, target, id, fragments, privateModules;\n\n\t\tfor (i = 0; i < ids.length; i++) {\n\t\t\ttarget = exports;\n\t\t\tid = ids[i];\n\t\t\tfragments = id.split(/[.\\/]/);\n\n\t\t\tfor (var fi = 0; fi < fragments.length - 1; ++fi) {\n\t\t\t\tif (target[fragments[fi]] === undefined) {\n\t\t\t\t\ttarget[fragments[fi]] = {};\n\t\t\t\t}\n\n\t\t\t\ttarget = target[fragments[fi]];\n\t\t\t}\n\n\t\t\ttarget[fragments[fragments.length - 1]] = modules[id];\n\t\t}\n\t\t\n\t\t// Expose private modules for unit tests\n\t\tif (exports.AMDLC_TESTS) {\n\t\t\tprivateModules = exports.privateModules || {};\n\n\t\t\tfor (id in modules) {\n\t\t\t\tprivateModules[id] = modules[id];\n\t\t\t}\n\n\t\t\tfor (i = 0; i < ids.length; i++) {\n\t\t\t\tdelete privateModules[ids[i]];\n\t\t\t}\n\n\t\t\texports.privateModules = privateModules;\n\t\t}\n\t}\n\n// Included from: js/tinymce/plugins/paste/classes/Utils.js\n\n/**\n * Utils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contails various utility functions for the paste plugin.\n *\n * @class tinymce.pasteplugin.Utils\n */\ndefine(\"tinymce/pasteplugin/Utils\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/html/DomParser\",\n\t\"tinymce/html/Schema\"\n], function(Tools, DomParser, Schema) {\n\tfunction filter(content, items) {\n\t\tTools.each(items, function(v) {\n\t\t\tif (v.constructor == RegExp) {\n\t\t\t\tcontent = content.replace(v, '');\n\t\t\t} else {\n\t\t\t\tcontent = content.replace(v[0], v[1]);\n\t\t\t}\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t/**\n\t * Gets the innerText of the specified element. It will handle edge cases\n\t * and works better than textContent on Gecko.\n\t *\n\t * @param {String} html HTML string to get text from.\n\t * @return {String} String of text with line feeds.\n\t */\n\tfunction innerText(html) {\n\t\tvar schema = new Schema(), domParser = new DomParser({}, schema), text = '';\n\t\tvar shortEndedElements = schema.getShortEndedElements();\n\t\tvar ignoreElements = Tools.makeMap('script noscript style textarea video audio iframe object', ' ');\n\t\tvar blockElements = schema.getBlockElements();\n\n\t\tfunction walk(node) {\n\t\t\tvar name = node.name, currentNode = node;\n\n\t\t\tif (name === 'br') {\n\t\t\t\ttext += '\\n';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// img/input/hr\n\t\t\tif (shortEndedElements[name]) {\n\t\t\t\ttext += ' ';\n\t\t\t}\n\n\t\t\t// Ingore script, video contents\n\t\t\tif (ignoreElements[name]) {\n\t\t\t\ttext += ' ';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (node.type == 3) {\n\t\t\t\ttext += node.value;\n\t\t\t}\n\n\t\t\t// Walk all children\n\t\t\tif (!node.shortEnded) {\n\t\t\t\tif ((node = node.firstChild)) {\n\t\t\t\t\tdo {\n\t\t\t\t\t\twalk(node);\n\t\t\t\t\t} while ((node = node.next));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Add \\n or \\n\\n for blocks or P\n\t\t\tif (blockElements[name] && currentNode.next) {\n\t\t\t\ttext += '\\n';\n\n\t\t\t\tif (name == 'p') {\n\t\t\t\t\ttext += '\\n';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\thtml = filter(html, [\n\t\t\t/<!\\[[^\\]]+\\]>/g // Conditional comments\n\t\t]);\n\n\t\twalk(domParser.parse(html));\n\n\t\treturn text;\n\t}\n\n\t/**\n\t * Trims the specified HTML by removing all WebKit fragments, all elements wrapping the body trailing BR elements etc.\n\t *\n\t * @param {String} html Html string to trim contents on.\n\t * @return {String} Html contents that got trimmed.\n\t */\n\tfunction trimHtml(html) {\n\t\tfunction trimSpaces(all, s1, s2) {\n\t\t\t// WebKit &nbsp; meant to preserve multiple spaces but instead inserted around all inline tags,\n\t\t\t// including the spans with inline styles created on paste\n\t\t\tif (!s1 && !s2) {\n\t\t\t\treturn ' ';\n\t\t\t}\n\n\t\t\treturn '\\u00a0';\n\t\t}\n\n\t\thtml = filter(html, [\n\t\t\t/^[\\s\\S]*<body[^>]*>\\s*|\\s*<\\/body[^>]*>[\\s\\S]*$/g, // Remove anything but the contents within the BODY element\n\t\t\t/<!--StartFragment-->|<!--EndFragment-->/g, // Inner fragments (tables from excel on mac)\n\t\t\t[/( ?)<span class=\"Apple-converted-space\">\\u00a0<\\/span>( ?)/g, trimSpaces],\n\t\t\t/<br class=\"Apple-interchange-newline\">/g,\n\t\t\t/<br>$/i // Trailing BR elements\n\t\t]);\n\n\t\treturn html;\n\t}\n\n\t// TODO: Should be in some global class\n\tfunction createIdGenerator(prefix) {\n\t\tvar count = 0;\n\n\t\treturn function() {\n\t\t\treturn prefix + (count++);\n\t\t};\n\t}\n\n\treturn {\n\t\tfilter: filter,\n\t\tinnerText: innerText,\n\t\ttrimHtml: trimHtml,\n\t\tcreateIdGenerator: createIdGenerator\n\t};\n});\n\n// Included from: js/tinymce/plugins/paste/classes/SmartPaste.js\n\n/**\n * SmartPaste.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Tries to be smart depending on what the user pastes if it looks like an url\n * it will make a link out of the current selection. If it's an image url that looks\n * like an image it will check if it's an image and insert it as an image.\n *\n * @class tinymce.pasteplugin.SmartPaste\n * @private\n */\ndefine(\"tinymce/pasteplugin/SmartPaste\", [\n\t\"tinymce/util/Tools\"\n], function (Tools) {\n\tvar isAbsoluteUrl = function (url) {\n\t\treturn /^https?:\\/\\/[\\w\\?\\-\\/+=.&%@~#]+$/i.test(url);\n\t};\n\n\tvar isImageUrl = function (url) {\n\t\treturn isAbsoluteUrl(url) && /.(gif|jpe?g|png)$/.test(url);\n\t};\n\n\tvar createImage = function (editor, url, pasteHtml) {\n\t\teditor.undoManager.extra(function () {\n\t\t\tpasteHtml(editor, url);\n\t\t}, function () {\n\t\t\teditor.insertContent('<img src=\"' + url + '\">');\n\t\t});\n\n\t\treturn true;\n\t};\n\n\tvar createLink = function (editor, url, pasteHtml) {\n\t\teditor.undoManager.extra(function () {\n\t\t\tpasteHtml(editor, url);\n\t\t}, function () {\n\t\t\teditor.execCommand('mceInsertLink', false, url);\n\t\t});\n\n\t\treturn true;\n\t};\n\n\tvar linkSelection = function (editor, html, pasteHtml) {\n\t\treturn editor.selection.isCollapsed() === false && isAbsoluteUrl(html) ? createLink(editor, html, pasteHtml) : false;\n\t};\n\n\tvar insertImage = function (editor, html, pasteHtml) {\n\t\treturn isImageUrl(html) ? createImage(editor, html, pasteHtml) : false;\n\t};\n\n\tvar pasteHtml = function (editor, html) {\n\t\teditor.insertContent(html, {\n\t\t\tmerge: editor.settings.paste_merge_formats !== false,\n\t\t\tpaste: true\n\t\t});\n\n\t\treturn true;\n\t};\n\n\tvar smartInsertContent = function (editor, html) {\n\t\tTools.each([\n\t\t\tlinkSelection,\n\t\t\tinsertImage,\n\t\t\tpasteHtml\n\t\t], function (action) {\n\t\t\treturn action(editor, html, pasteHtml) !== true;\n\t\t});\n\t};\n\n\tvar insertContent = function (editor, html) {\n\t\tif (editor.settings.smart_paste === false) {\n\t\t\tpasteHtml(editor, html);\n\t\t} else {\n\t\t\tsmartInsertContent(editor, html);\n\t\t}\n\t};\n\n\treturn {\n\t\tisImageUrl: isImageUrl,\n\t\tisAbsoluteUrl: isAbsoluteUrl,\n\t\tinsertContent: insertContent\n\t};\n});\n\n// Included from: js/tinymce/plugins/paste/classes/Clipboard.js\n\n/**\n * Clipboard.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains logic for getting HTML contents out of the clipboard.\n *\n * We need to make a lot of ugly hacks to get the contents out of the clipboard since\n * the W3C Clipboard API is broken in all browsers that have it: Gecko/WebKit/Blink.\n * We might rewrite this the way those API:s stabilize. Browsers doesn't handle pasting\n * from applications like Word the same way as it does when pasting into a contentEditable area\n * so we need to do lots of extra work to try to get to this clipboard data.\n *\n * Current implementation steps:\n *  1. On keydown with paste keys Ctrl+V or Shift+Insert create\n *     a paste bin element and move focus to that element.\n *  2. Wait for the browser to fire a \"paste\" event and get the contents out of the paste bin.\n *  3. Check if the paste was successful if true, process the HTML.\n *  (4). If the paste was unsuccessful use IE execCommand, Clipboard API, document.dataTransfer old WebKit API etc.\n *\n * @class tinymce.pasteplugin.Clipboard\n * @private\n */\ndefine(\"tinymce/pasteplugin/Clipboard\", [\n\t\"tinymce/Env\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/util/VK\",\n\t\"tinymce/pasteplugin/Utils\",\n\t\"tinymce/pasteplugin/SmartPaste\",\n\t\"tinymce/util/Delay\"\n], function(Env, RangeUtils, VK, Utils, SmartPaste, Delay) {\n\treturn function(editor) {\n\t\tvar self = this, pasteBinElm, lastRng, keyboardPasteTimeStamp = 0, draggingInternally = false;\n\t\tvar pasteBinDefaultContent = '%MCEPASTEBIN%', keyboardPastePlainTextState;\n\t\tvar mceInternalUrlPrefix = 'data:text/mce-internal,';\n\t\tvar uniqueId = Utils.createIdGenerator(\"mceclip\");\n\n\t\t/**\n\t\t * Pastes the specified HTML. This means that the HTML is filtered and then\n\t\t * inserted at the current selection in the editor. It will also fire paste events\n\t\t * for custom user filtering.\n\t\t *\n\t\t * @param {String} html HTML code to paste into the current selection.\n\t\t */\n\t\tfunction pasteHtml(html) {\n\t\t\tvar args, dom = editor.dom;\n\n\t\t\targs = editor.fire('BeforePastePreProcess', {content: html}); // Internal event used by Quirks\n\t\t\targs = editor.fire('PastePreProcess', args);\n\t\t\thtml = args.content;\n\n\t\t\tif (!args.isDefaultPrevented()) {\n\t\t\t\t// User has bound PastePostProcess events then we need to pass it through a DOM node\n\t\t\t\t// This is not ideal but we don't want to let the browser mess up the HTML for example\n\t\t\t\t// some browsers add &nbsp; to P tags etc\n\t\t\t\tif (editor.hasEventListeners('PastePostProcess') && !args.isDefaultPrevented()) {\n\t\t\t\t\t// We need to attach the element to the DOM so Sizzle selectors work on the contents\n\t\t\t\t\tvar tempBody = dom.add(editor.getBody(), 'div', {style: 'display:none'}, html);\n\t\t\t\t\targs = editor.fire('PastePostProcess', {node: tempBody});\n\t\t\t\t\tdom.remove(tempBody);\n\t\t\t\t\thtml = args.node.innerHTML;\n\t\t\t\t}\n\n\t\t\t\tif (!args.isDefaultPrevented()) {\n\t\t\t\t\tSmartPaste.insertContent(editor, html);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Pastes the specified text. This means that the plain text is processed\n\t\t * and converted into BR and P elements. It will fire paste events for custom filtering.\n\t\t *\n\t\t * @param {String} text Text to paste as the current selection location.\n\t\t */\n\t\tfunction pasteText(text) {\n\t\t\ttext = editor.dom.encode(text).replace(/\\r\\n/g, '\\n');\n\n\t\t\tvar startBlock = editor.dom.getParent(editor.selection.getStart(), editor.dom.isBlock);\n\n\t\t\t// Create start block html for example <p attr=\"value\">\n\t\t\tvar forcedRootBlockName = editor.settings.forced_root_block;\n\t\t\tvar forcedRootBlockStartHtml;\n\t\t\tif (forcedRootBlockName) {\n\t\t\t\tforcedRootBlockStartHtml = editor.dom.createHTML(forcedRootBlockName, editor.settings.forced_root_block_attrs);\n\t\t\t\tforcedRootBlockStartHtml = forcedRootBlockStartHtml.substr(0, forcedRootBlockStartHtml.length - 3) + '>';\n\t\t\t}\n\n\t\t\tif ((startBlock && /^(PRE|DIV)$/.test(startBlock.nodeName)) || !forcedRootBlockName) {\n\t\t\t\ttext = Utils.filter(text, [\n\t\t\t\t\t[/\\n/g, \"<br>\"]\n\t\t\t\t]);\n\t\t\t} else {\n\t\t\t\ttext = Utils.filter(text, [\n\t\t\t\t\t[/\\n\\n/g, \"</p>\" + forcedRootBlockStartHtml],\n\t\t\t\t\t[/^(.*<\\/p>)(<p>)$/, forcedRootBlockStartHtml + '$1'],\n\t\t\t\t\t[/\\n/g, \"<br />\"]\n\t\t\t\t]);\n\n\t\t\t\tif (text.indexOf('<p>') != -1) {\n\t\t\t\t\ttext = forcedRootBlockStartHtml + text;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tpasteHtml(text);\n\t\t}\n\n\t\t/**\n\t\t * Creates a paste bin element as close as possible to the current caret location and places the focus inside that element\n\t\t * so that when the real paste event occurs the contents gets inserted into this element\n\t\t * instead of the current editor selection element.\n\t\t */\n\t\tfunction createPasteBin() {\n\t\t\tvar dom = editor.dom, body = editor.getBody();\n\t\t\tvar viewport = editor.dom.getViewPort(editor.getWin()), scrollTop = viewport.y, top = 20;\n\t\t\tvar scrollContainer;\n\n\t\t\tlastRng = editor.selection.getRng();\n\n\t\t\tif (editor.inline) {\n\t\t\t\tscrollContainer = editor.selection.getScrollContainer();\n\n\t\t\t\t// Can't always rely on scrollTop returning a useful value.\n\t\t\t\t// It returns 0 if the browser doesn't support scrollTop for the element or is non-scrollable\n\t\t\t\tif (scrollContainer && scrollContainer.scrollTop > 0) {\n\t\t\t\t\tscrollTop = scrollContainer.scrollTop;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Returns the rect of the current caret if the caret is in an empty block before a\n\t\t\t * BR we insert a temporary invisible character that we get the rect this way we always get a proper rect.\n\t\t\t *\n\t\t\t * TODO: This might be useful in core.\n\t\t\t */\n\t\t\tfunction getCaretRect(rng) {\n\t\t\t\tvar rects, textNode, node, container = rng.startContainer;\n\n\t\t\t\trects = rng.getClientRects();\n\t\t\t\tif (rects.length) {\n\t\t\t\t\treturn rects[0];\n\t\t\t\t}\n\n\t\t\t\tif (!rng.collapsed || container.nodeType != 1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tnode = container.childNodes[lastRng.startOffset];\n\n\t\t\t\t// Skip empty whitespace nodes\n\t\t\t\twhile (node && node.nodeType == 3 && !node.data.length) {\n\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t}\n\n\t\t\t\tif (!node) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Check if the location is |<br>\n\t\t\t\t// TODO: Might need to expand this to say |<table>\n\t\t\t\tif (node.tagName == 'BR') {\n\t\t\t\t\ttextNode = dom.doc.createTextNode('\\uFEFF');\n\t\t\t\t\tnode.parentNode.insertBefore(textNode, node);\n\n\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\trng.setStartBefore(textNode);\n\t\t\t\t\trng.setEndAfter(textNode);\n\n\t\t\t\t\trects = rng.getClientRects();\n\t\t\t\t\tdom.remove(textNode);\n\t\t\t\t}\n\n\t\t\t\tif (rects.length) {\n\t\t\t\t\treturn rects[0];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Calculate top cordinate this is needed to avoid scrolling to top of document\n\t\t\t// We want the paste bin to be as close to the caret as possible to avoid scrolling\n\t\t\tif (lastRng.getClientRects) {\n\t\t\t\tvar rect = getCaretRect(lastRng);\n\n\t\t\t\tif (rect) {\n\t\t\t\t\t// Client rects gets us closes to the actual\n\t\t\t\t\t// caret location in for example a wrapped paragraph block\n\t\t\t\t\ttop = scrollTop + (rect.top - dom.getPos(body).y);\n\t\t\t\t} else {\n\t\t\t\t\ttop = scrollTop;\n\n\t\t\t\t\t// Check if we can find a closer location by checking the range element\n\t\t\t\t\tvar container = lastRng.startContainer;\n\t\t\t\t\tif (container) {\n\t\t\t\t\t\tif (container.nodeType == 3 && container.parentNode != body) {\n\t\t\t\t\t\t\tcontainer = container.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (container.nodeType == 1) {\n\t\t\t\t\t\t\ttop = dom.getPos(container, scrollContainer || body).y;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Create a pastebin\n\t\t\tpasteBinElm = dom.add(editor.getBody(), 'div', {\n\t\t\t\tid: \"mcepastebin\",\n\t\t\t\tcontentEditable: true,\n\t\t\t\t\"data-mce-bogus\": \"all\",\n\t\t\t\tstyle: 'position: absolute; top: ' + top + 'px;' +\n\t\t\t\t\t'width: 10px; height: 10px; overflow: hidden; opacity: 0'\n\t\t\t}, pasteBinDefaultContent);\n\n\t\t\t// Move paste bin out of sight since the controlSelection rect gets displayed otherwise on IE and Gecko\n\t\t\tif (Env.ie || Env.gecko) {\n\t\t\t\tdom.setStyle(pasteBinElm, 'left', dom.getStyle(body, 'direction', true) == 'rtl' ? 0xFFFF : -0xFFFF);\n\t\t\t}\n\n\t\t\t// Prevent focus events from bubbeling fixed FocusManager issues\n\t\t\tdom.bind(pasteBinElm, 'beforedeactivate focusin focusout', function(e) {\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\n\t\t\tpasteBinElm.focus();\n\t\t\teditor.selection.select(pasteBinElm, true);\n\t\t}\n\n\t\t/**\n\t\t * Removes the paste bin if it exists.\n\t\t */\n\t\tfunction removePasteBin() {\n\t\t\tif (pasteBinElm) {\n\t\t\t\tvar pasteBinClone;\n\n\t\t\t\t// WebKit/Blink might clone the div so\n\t\t\t\t// lets make sure we remove all clones\n\t\t\t\t// TODO: Man o man is this ugly. WebKit is the new IE! Remove this if they ever fix it!\n\t\t\t\twhile ((pasteBinClone = editor.dom.get('mcepastebin'))) {\n\t\t\t\t\teditor.dom.remove(pasteBinClone);\n\t\t\t\t\teditor.dom.unbind(pasteBinClone);\n\t\t\t\t}\n\n\t\t\t\tif (lastRng) {\n\t\t\t\t\teditor.selection.setRng(lastRng);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tpasteBinElm = lastRng = null;\n\t\t}\n\n\t\t/**\n\t\t * Returns the contents of the paste bin as a HTML string.\n\t\t *\n\t\t * @return {String} Get the contents of the paste bin.\n\t\t */\n\t\tfunction getPasteBinHtml() {\n\t\t\tvar html = '', pasteBinClones, i, clone, cloneHtml;\n\n\t\t\t// Since WebKit/Chrome might clone the paste bin when pasting\n\t\t\t// for example: <img style=\"float: right\"> we need to check if any of them contains some useful html.\n\t\t\t// TODO: Man o man is this ugly. WebKit is the new IE! Remove this if they ever fix it!\n\t\t\tpasteBinClones = editor.dom.select('div[id=mcepastebin]');\n\t\t\tfor (i = 0; i < pasteBinClones.length; i++) {\n\t\t\t\tclone = pasteBinClones[i];\n\n\t\t\t\t// Pasting plain text produces pastebins in pastebinds makes sence right!?\n\t\t\t\tif (clone.firstChild && clone.firstChild.id == 'mcepastebin') {\n\t\t\t\t\tclone = clone.firstChild;\n\t\t\t\t}\n\n\t\t\t\tcloneHtml = clone.innerHTML;\n\t\t\t\tif (html != pasteBinDefaultContent) {\n\t\t\t\t\thtml += cloneHtml;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn html;\n\t\t}\n\n\t\t/**\n\t\t * Gets various content types out of a datatransfer object.\n\t\t *\n\t\t * @param {DataTransfer} dataTransfer Event fired on paste.\n\t\t * @return {Object} Object with mime types and data for those mime types.\n\t\t */\n\t\tfunction getDataTransferItems(dataTransfer) {\n\t\t\tvar items = {};\n\n\t\t\tif (dataTransfer) {\n\t\t\t\t// Use old WebKit/IE API\n\t\t\t\tif (dataTransfer.getData) {\n\t\t\t\t\tvar legacyText = dataTransfer.getData('Text');\n\t\t\t\t\tif (legacyText && legacyText.length > 0) {\n\t\t\t\t\t\tif (legacyText.indexOf(mceInternalUrlPrefix) == -1) {\n\t\t\t\t\t\t\titems['text/plain'] = legacyText;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (dataTransfer.types) {\n\t\t\t\t\tfor (var i = 0; i < dataTransfer.types.length; i++) {\n\t\t\t\t\t\tvar contentType = dataTransfer.types[i];\n\t\t\t\t\t\titems[contentType] = dataTransfer.getData(contentType);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn items;\n\t\t}\n\n\t\t/**\n\t\t * Gets various content types out of the Clipboard API. It will also get the\n\t\t * plain text using older IE and WebKit API:s.\n\t\t *\n\t\t * @param {ClipboardEvent} clipboardEvent Event fired on paste.\n\t\t * @return {Object} Object with mime types and data for those mime types.\n\t\t */\n\t\tfunction getClipboardContent(clipboardEvent) {\n\t\t\treturn getDataTransferItems(clipboardEvent.clipboardData || editor.getDoc().dataTransfer);\n\t\t}\n\n\t\tfunction hasHtmlOrText(content) {\n\t\t\treturn hasContentType(content, 'text/html') || hasContentType(content, 'text/plain');\n\t\t}\n\n\t\tfunction getBase64FromUri(uri) {\n\t\t\tvar idx;\n\n\t\t\tidx = uri.indexOf(',');\n\t\t\tif (idx !== -1) {\n\t\t\t\treturn uri.substr(idx + 1);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction isValidDataUriImage(settings, imgElm) {\n\t\t\treturn settings.images_dataimg_filter ? settings.images_dataimg_filter(imgElm) : true;\n\t\t}\n\n\t\tfunction pasteImage(rng, reader, blob) {\n\t\t\tif (rng) {\n\t\t\t\teditor.selection.setRng(rng);\n\t\t\t\trng = null;\n\t\t\t}\n\n\t\t\tvar dataUri = reader.result;\n\t\t\tvar base64 = getBase64FromUri(dataUri);\n\n\t\t\tvar img = new Image();\n\t\t\timg.src = dataUri;\n\n\t\t\t// TODO: Move the bulk of the cache logic to EditorUpload\n\t\t\tif (isValidDataUriImage(editor.settings, img)) {\n\t\t\t\tvar blobCache = editor.editorUpload.blobCache;\n\t\t\t\tvar blobInfo, existingBlobInfo;\n\n\t\t\t\texistingBlobInfo = blobCache.findFirst(function(cachedBlobInfo) {\n\t\t\t\t\treturn cachedBlobInfo.base64() === base64;\n\t\t\t\t});\n\n\t\t\t\tif (!existingBlobInfo) {\n\t\t\t\t\tblobInfo = blobCache.create(uniqueId(), blob, base64);\n\t\t\t\t\tblobCache.add(blobInfo);\n\t\t\t\t} else {\n\t\t\t\t\tblobInfo = existingBlobInfo;\n\t\t\t\t}\n\n\t\t\t\tpasteHtml('<img src=\"' + blobInfo.blobUri() + '\">');\n\t\t\t} else {\n\t\t\t\tpasteHtml('<img src=\"' + dataUri + '\">');\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Checks if the clipboard contains image data if it does it will take that data\n\t\t * and convert it into a data url image and paste that image at the caret location.\n\t\t *\n\t\t * @param  {ClipboardEvent} e Paste/drop event object.\n\t\t * @param  {DOMRange} rng Rng object to move selection to.\n\t\t * @return {Boolean} true/false if the image data was found or not.\n\t\t */\n\t\tfunction pasteImageData(e, rng) {\n\t\t\tvar dataTransfer = e.clipboardData || e.dataTransfer;\n\n\t\t\tfunction processItems(items) {\n\t\t\t\tvar i, item, reader, hadImage = false;\n\n\t\t\t\tif (items) {\n\t\t\t\t\tfor (i = 0; i < items.length; i++) {\n\t\t\t\t\t\titem = items[i];\n\n\t\t\t\t\t\tif (/^image\\/(jpeg|png|gif|bmp)$/.test(item.type)) {\n\t\t\t\t\t\t\tvar blob = item.getAsFile ? item.getAsFile() : item;\n\n\t\t\t\t\t\t\treader = new FileReader();\n\t\t\t\t\t\t\treader.onload = pasteImage.bind(null, rng, reader, blob);\n\t\t\t\t\t\t\treader.readAsDataURL(blob);\n\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\thadImage = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn hadImage;\n\t\t\t}\n\n\t\t\tif (editor.settings.paste_data_images && dataTransfer) {\n\t\t\t\treturn processItems(dataTransfer.items) || processItems(dataTransfer.files);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Chrome on Android doesn't support proper clipboard access so we have no choice but to allow the browser default behavior.\n\t\t *\n\t\t * @param {Event} e Paste event object to check if it contains any data.\n\t\t * @return {Boolean} true/false if the clipboard is empty or not.\n\t\t */\n\t\tfunction isBrokenAndroidClipboardEvent(e) {\n\t\t\tvar clipboardData = e.clipboardData;\n\n\t\t\treturn navigator.userAgent.indexOf('Android') != -1 && clipboardData && clipboardData.items && clipboardData.items.length === 0;\n\t\t}\n\n\t\tfunction getCaretRangeFromEvent(e) {\n\t\t\treturn RangeUtils.getCaretRangeFromPoint(e.clientX, e.clientY, editor.getDoc());\n\t\t}\n\n\t\tfunction hasContentType(clipboardContent, mimeType) {\n\t\t\treturn mimeType in clipboardContent && clipboardContent[mimeType].length > 0;\n\t\t}\n\n\t\tfunction isKeyboardPasteEvent(e) {\n\t\t\treturn (VK.metaKeyPressed(e) && e.keyCode == 86) || (e.shiftKey && e.keyCode == 45);\n\t\t}\n\n\t\tfunction registerEventHandlers() {\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tfunction removePasteBinOnKeyUp(e) {\n\t\t\t\t\t// Ctrl+V or Shift+Insert\n\t\t\t\t\tif (isKeyboardPasteEvent(e) && !e.isDefaultPrevented()) {\n\t\t\t\t\t\tremovePasteBin();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Ctrl+V or Shift+Insert\n\t\t\t\tif (isKeyboardPasteEvent(e) && !e.isDefaultPrevented()) {\n\t\t\t\t\tkeyboardPastePlainTextState = e.shiftKey && e.keyCode == 86;\n\n\t\t\t\t\t// Edge case on Safari on Mac where it doesn't handle Cmd+Shift+V correctly\n\t\t\t\t\t// it fires the keydown but no paste or keyup so we are left with a paste bin\n\t\t\t\t\tif (keyboardPastePlainTextState && Env.webkit && navigator.userAgent.indexOf('Version/') != -1) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Prevent undoManager keydown handler from making an undo level with the pastebin in it\n\t\t\t\t\te.stopImmediatePropagation();\n\n\t\t\t\t\tkeyboardPasteTimeStamp = new Date().getTime();\n\n\t\t\t\t\t// IE doesn't support Ctrl+Shift+V and it doesn't even produce a paste event\n\t\t\t\t\t// so lets fake a paste event and let IE use the execCommand/dataTransfer methods\n\t\t\t\t\tif (Env.ie && keyboardPastePlainTextState) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.fire('paste', {ieFake: true});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tremovePasteBin();\n\t\t\t\t\tcreatePasteBin();\n\n\t\t\t\t\t// Remove pastebin if we get a keyup and no paste event\n\t\t\t\t\t// For example pasting a file in IE 11 will not produce a paste event\n\t\t\t\t\teditor.once('keyup', removePasteBinOnKeyUp);\n\t\t\t\t\teditor.once('paste', function() {\n\t\t\t\t\t\teditor.off('keyup', removePasteBinOnKeyUp);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfunction insertClipboardContent(clipboardContent, isKeyBoardPaste, plainTextMode) {\n\t\t\t\tvar content;\n\n\t\t\t\t// Grab HTML from Clipboard API or paste bin as a fallback\n\t\t\t\tif (hasContentType(clipboardContent, 'text/html')) {\n\t\t\t\t\tcontent = clipboardContent['text/html'];\n\t\t\t\t} else {\n\t\t\t\t\tcontent = getPasteBinHtml();\n\n\t\t\t\t\t// If paste bin is empty try using plain text mode\n\t\t\t\t\t// since that is better than nothing right\n\t\t\t\t\tif (content == pasteBinDefaultContent) {\n\t\t\t\t\t\tplainTextMode = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcontent = Utils.trimHtml(content);\n\n\t\t\t\t// WebKit has a nice bug where it clones the paste bin if you paste from for example notepad\n\t\t\t\t// so we need to force plain text mode in this case\n\t\t\t\tif (pasteBinElm && pasteBinElm.firstChild && pasteBinElm.firstChild.id === 'mcepastebin') {\n\t\t\t\t\tplainTextMode = true;\n\t\t\t\t}\n\n\t\t\t\tremovePasteBin();\n\n\t\t\t\t// If we got nothing from clipboard API and pastebin then we could try the last resort: plain/text\n\t\t\t\tif (!content.length) {\n\t\t\t\t\tplainTextMode = true;\n\t\t\t\t}\n\n\t\t\t\t// Grab plain text from Clipboard API or convert existing HTML to plain text\n\t\t\t\tif (plainTextMode) {\n\t\t\t\t\t// Use plain text contents from Clipboard API unless the HTML contains paragraphs then\n\t\t\t\t\t// we should convert the HTML to plain text since works better when pasting HTML/Word contents as plain text\n\t\t\t\t\tif (hasContentType(clipboardContent, 'text/plain') && content.indexOf('</p>') == -1) {\n\t\t\t\t\t\tcontent = clipboardContent['text/plain'];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontent = Utils.innerText(content);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If the content is the paste bin default HTML then it was\n\t\t\t\t// impossible to get the cliboard data out.\n\t\t\t\tif (content == pasteBinDefaultContent) {\n\t\t\t\t\tif (!isKeyBoardPaste) {\n\t\t\t\t\t\teditor.windowManager.alert('Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents.');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (plainTextMode) {\n\t\t\t\t\tpasteText(content);\n\t\t\t\t} else {\n\t\t\t\t\tpasteHtml(content);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar getLastRng = function() {\n\t\t\t\treturn lastRng || editor.selection.getRng();\n\t\t\t};\n\n\t\t\teditor.on('paste', function(e) {\n\t\t\t\t// Getting content from the Clipboard can take some time\n\t\t\t\tvar clipboardTimer = new Date().getTime();\n\t\t\t\tvar clipboardContent = getClipboardContent(e);\n\t\t\t\tvar clipboardDelay = new Date().getTime() - clipboardTimer;\n\n\t\t\t\tvar isKeyBoardPaste = (new Date().getTime() - keyboardPasteTimeStamp - clipboardDelay) < 1000;\n\t\t\t\tvar plainTextMode = self.pasteFormat == \"text\" || keyboardPastePlainTextState;\n\n\t\t\t\tkeyboardPastePlainTextState = false;\n\n\t\t\t\tif (e.isDefaultPrevented() || isBrokenAndroidClipboardEvent(e)) {\n\t\t\t\t\tremovePasteBin();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!hasHtmlOrText(clipboardContent) && pasteImageData(e, getLastRng())) {\n\t\t\t\t\tremovePasteBin();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Not a keyboard paste prevent default paste and try to grab the clipboard contents using different APIs\n\t\t\t\tif (!isKeyBoardPaste) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\n\t\t\t\t// Try IE only method if paste isn't a keyboard paste\n\t\t\t\tif (Env.ie && (!isKeyBoardPaste || e.ieFake)) {\n\t\t\t\t\tcreatePasteBin();\n\n\t\t\t\t\teditor.dom.bind(pasteBinElm, 'paste', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t});\n\n\t\t\t\t\teditor.getDoc().execCommand('Paste', false, null);\n\t\t\t\t\tclipboardContent[\"text/html\"] = getPasteBinHtml();\n\t\t\t\t}\n\n\t\t\t\t// If clipboard API has HTML then use that directly\n\t\t\t\tif (hasContentType(clipboardContent, 'text/html')) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tinsertClipboardContent(clipboardContent, isKeyBoardPaste, plainTextMode);\n\t\t\t\t} else {\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\tinsertClipboardContent(clipboardContent, isKeyBoardPaste, plainTextMode);\n\t\t\t\t\t}, 0);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('dragstart dragend', function(e) {\n\t\t\t\tdraggingInternally = e.type == 'dragstart';\n\t\t\t});\n\n\t\t\tfunction isPlainTextFileUrl(content) {\n\t\t\t\treturn content['text/plain'].indexOf('file://') === 0;\n\t\t\t}\n\n\t\t\teditor.on('drop', function(e) {\n\t\t\t\tvar dropContent, rng;\n\n\t\t\t\trng = getCaretRangeFromEvent(e);\n\n\t\t\t\tif (e.isDefaultPrevented() || draggingInternally) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdropContent = getDataTransferItems(e.dataTransfer);\n\n\t\t\t\tif ((!hasHtmlOrText(dropContent) || isPlainTextFileUrl(dropContent)) && pasteImageData(e, rng)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (rng && editor.settings.paste_filter_drop !== false) {\n\t\t\t\t\tvar content = dropContent['mce-internal'] || dropContent['text/html'] || dropContent['text/plain'];\n\n\t\t\t\t\tif (content) {\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t// FF 45 doesn't paint a caret when dragging in text in due to focus call by execCommand\n\t\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\t\teditor.undoManager.transact(function() {\n\t\t\t\t\t\t\t\tif (dropContent['mce-internal']) {\n\t\t\t\t\t\t\t\t\teditor.execCommand('Delete');\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\teditor.selection.setRng(rng);\n\n\t\t\t\t\t\t\t\tcontent = Utils.trimHtml(content);\n\n\t\t\t\t\t\t\t\tif (!dropContent['text/html']) {\n\t\t\t\t\t\t\t\t\tpasteText(content);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tpasteHtml(content);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('dragover dragend', function(e) {\n\t\t\t\tif (editor.settings.paste_data_images) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tself.pasteHtml = pasteHtml;\n\t\tself.pasteText = pasteText;\n\t\tself.pasteImageData = pasteImageData;\n\n\t\teditor.on('preInit', function() {\n\t\t\tregisterEventHandlers();\n\n\t\t\t// Remove all data images from paste for example from Gecko\n\t\t\t// except internal images like video elements\n\t\t\teditor.parser.addNodeFilter('img', function(nodes, name, args) {\n\t\t\t\tfunction isPasteInsert(args) {\n\t\t\t\t\treturn args.data && args.data.paste === true;\n\t\t\t\t}\n\n\t\t\t\tfunction remove(node) {\n\t\t\t\t\tif (!node.attr('data-mce-object') && src !== Env.transparentSrc) {\n\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction isWebKitFakeUrl(src) {\n\t\t\t\t\treturn src.indexOf(\"webkit-fake-url\") === 0;\n\t\t\t\t}\n\n\t\t\t\tfunction isDataUri(src) {\n\t\t\t\t\treturn src.indexOf(\"data:\") === 0;\n\t\t\t\t}\n\n\t\t\t\tif (!editor.settings.paste_data_images && isPasteInsert(args)) {\n\t\t\t\t\tvar i = nodes.length;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tvar src = nodes[i].attributes.map.src;\n\n\t\t\t\t\t\tif (!src) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Safari on Mac produces webkit-fake-url see: https://bugs.webkit.org/show_bug.cgi?id=49141\n\t\t\t\t\t\tif (isWebKitFakeUrl(src)) {\n\t\t\t\t\t\t\tremove(nodes[i]);\n\t\t\t\t\t\t} else if (!editor.settings.allow_html_data_urls && isDataUri(src)) {\n\t\t\t\t\t\t\tremove(nodes[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n});\n\n// Included from: js/tinymce/plugins/paste/classes/WordFilter.js\n\n/**\n * WordFilter.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class parses word HTML into proper TinyMCE markup.\n *\n * @class tinymce.pasteplugin.WordFilter\n * @private\n */\ndefine(\"tinymce/pasteplugin/WordFilter\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/html/DomParser\",\n\t\"tinymce/html/Schema\",\n\t\"tinymce/html/Serializer\",\n\t\"tinymce/html/Node\",\n\t\"tinymce/pasteplugin/Utils\"\n], function(Tools, DomParser, Schema, Serializer, Node, Utils) {\n\t/**\n\t * Checks if the specified content is from any of the following sources: MS Word/Office 365/Google docs.\n\t */\n\tfunction isWordContent(content) {\n\t\treturn (\n\t\t\t(/<font face=\"Times New Roman\"|class=\"?Mso|style=\"[^\"]*\\bmso-|style='[^'']*\\bmso-|w:WordDocument/i).test(content) ||\n\t\t\t(/class=\"OutlineElement/).test(content) ||\n\t\t\t(/id=\"?docs\\-internal\\-guid\\-/.test(content))\n\t\t);\n\t}\n\n\t/**\n\t * Checks if the specified text starts with \"1. \" or \"a. \" etc.\n\t */\n\tfunction isNumericList(text) {\n\t\tvar found, patterns;\n\n\t\tpatterns = [\n\t\t\t/^[IVXLMCD]{1,2}\\.[ \\u00a0]/,  // Roman upper case\n\t\t\t/^[ivxlmcd]{1,2}\\.[ \\u00a0]/,  // Roman lower case\n\t\t\t/^[a-z]{1,2}[\\.\\)][ \\u00a0]/,  // Alphabetical a-z\n\t\t\t/^[A-Z]{1,2}[\\.\\)][ \\u00a0]/,  // Alphabetical A-Z\n\t\t\t/^[0-9]+\\.[ \\u00a0]/,          // Numeric lists\n\t\t\t/^[\\u3007\\u4e00\\u4e8c\\u4e09\\u56db\\u4e94\\u516d\\u4e03\\u516b\\u4e5d]+\\.[ \\u00a0]/, // Japanese\n\t\t\t/^[\\u58f1\\u5f10\\u53c2\\u56db\\u4f0d\\u516d\\u4e03\\u516b\\u4e5d\\u62fe]+\\.[ \\u00a0]/  // Chinese\n\t\t];\n\n\t\ttext = text.replace(/^[\\u00a0 ]+/, '');\n\n\t\tTools.each(patterns, function(pattern) {\n\t\t\tif (pattern.test(text)) {\n\t\t\t\tfound = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\treturn found;\n\t}\n\n\tfunction isBulletList(text) {\n\t\treturn /^[\\s\\u00a0]*[\\u2022\\u00b7\\u00a7\\u25CF]\\s*/.test(text);\n\t}\n\n\tfunction WordFilter(editor) {\n\t\tvar settings = editor.settings;\n\n\t\teditor.on('BeforePastePreProcess', function(e) {\n\t\t\tvar content = e.content, retainStyleProperties, validStyles;\n\n\t\t\t// Remove google docs internal guid markers\n\t\t\tcontent = content.replace(/<b[^>]+id=\"?docs-internal-[^>]*>/gi, '');\n\t\t\tcontent = content.replace(/<br class=\"?Apple-interchange-newline\"?>/gi, '');\n\n\t\t\tretainStyleProperties = settings.paste_retain_style_properties;\n\t\t\tif (retainStyleProperties) {\n\t\t\t\tvalidStyles = Tools.makeMap(retainStyleProperties.split(/[, ]/));\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Converts fake bullet and numbered lists to real semantic OL/UL.\n\t\t\t *\n\t\t\t * @param {tinymce.html.Node} node Root node to convert children of.\n\t\t\t */\n\t\t\tfunction convertFakeListsToProperLists(node) {\n\t\t\t\tvar currentListNode, prevListNode, lastLevel = 1;\n\n\t\t\t\tfunction getText(node) {\n\t\t\t\t\tvar txt = '';\n\n\t\t\t\t\tif (node.type === 3) {\n\t\t\t\t\t\treturn node.value;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((node = node.firstChild)) {\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\ttxt += getText(node);\n\t\t\t\t\t\t} while ((node = node.next));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn txt;\n\t\t\t\t}\n\n\t\t\t\tfunction trimListStart(node, regExp) {\n\t\t\t\t\tif (node.type === 3) {\n\t\t\t\t\t\tif (regExp.test(node.value)) {\n\t\t\t\t\t\t\tnode.value = node.value.replace(regExp, '');\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((node = node.firstChild)) {\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\tif (!trimListStart(node, regExp)) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} while ((node = node.next));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tfunction removeIgnoredNodes(node) {\n\t\t\t\t\tif (node._listIgnore) {\n\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((node = node.firstChild)) {\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\tremoveIgnoredNodes(node);\n\t\t\t\t\t\t} while ((node = node.next));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction convertParagraphToLi(paragraphNode, listName, start) {\n\t\t\t\t\tvar level = paragraphNode._listLevel || lastLevel;\n\n\t\t\t\t\t// Handle list nesting\n\t\t\t\t\tif (level != lastLevel) {\n\t\t\t\t\t\tif (level < lastLevel) {\n\t\t\t\t\t\t\t// Move to parent list\n\t\t\t\t\t\t\tif (currentListNode) {\n\t\t\t\t\t\t\t\tcurrentListNode = currentListNode.parent.parent;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Create new list\n\t\t\t\t\t\t\tprevListNode = currentListNode;\n\t\t\t\t\t\t\tcurrentListNode = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!currentListNode || currentListNode.name != listName) {\n\t\t\t\t\t\tprevListNode = prevListNode || currentListNode;\n\t\t\t\t\t\tcurrentListNode = new Node(listName, 1);\n\n\t\t\t\t\t\tif (start > 1) {\n\t\t\t\t\t\t\tcurrentListNode.attr('start', '' + start);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tparagraphNode.wrap(currentListNode);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurrentListNode.append(paragraphNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tparagraphNode.name = 'li';\n\n\t\t\t\t\t// Append list to previous list if it exists\n\t\t\t\t\tif (level > lastLevel && prevListNode) {\n\t\t\t\t\t\tprevListNode.lastChild.append(currentListNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tlastLevel = level;\n\n\t\t\t\t\t// Remove start of list item \"1. \" or \"&middot; \" etc\n\t\t\t\t\tremoveIgnoredNodes(paragraphNode);\n\t\t\t\t\ttrimListStart(paragraphNode, /^\\u00a0+/);\n\t\t\t\t\ttrimListStart(paragraphNode, /^\\s*([\\u2022\\u00b7\\u00a7\\u25CF]|\\w+\\.)/);\n\t\t\t\t\ttrimListStart(paragraphNode, /^\\u00a0+/);\n\t\t\t\t}\n\n\t\t\t\t// Build a list of all root level elements before we start\n\t\t\t\t// altering them in the loop below.\n\t\t\t\tvar elements = [], child = node.firstChild;\n\t\t\t\twhile (typeof child !== 'undefined' && child !== null) {\n\t\t\t\t\telements.push(child);\n\n\t\t\t\t\tchild = child.walk();\n\t\t\t\t\tif (child !== null) {\n\t\t\t\t\t\twhile (typeof child !== 'undefined' && child.parent !== node) {\n\t\t\t\t\t\t\tchild = child.walk();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0; i < elements.length; i++) {\n\t\t\t\t\tnode = elements[i];\n\n\t\t\t\t\tif (node.name == 'p' && node.firstChild) {\n\t\t\t\t\t\t// Find first text node in paragraph\n\t\t\t\t\t\tvar nodeText = getText(node);\n\n\t\t\t\t\t\t// Detect unordered lists look for bullets\n\t\t\t\t\t\tif (isBulletList(nodeText)) {\n\t\t\t\t\t\t\tconvertParagraphToLi(node, 'ul');\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Detect ordered lists 1., a. or ixv.\n\t\t\t\t\t\tif (isNumericList(nodeText)) {\n\t\t\t\t\t\t\t// Parse OL start number\n\t\t\t\t\t\t\tvar matches = /([0-9]+)\\./.exec(nodeText);\n\t\t\t\t\t\t\tvar start = 1;\n\t\t\t\t\t\t\tif (matches) {\n\t\t\t\t\t\t\t\tstart = parseInt(matches[1], 10);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconvertParagraphToLi(node, 'ol', start);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Convert paragraphs marked as lists but doesn't look like anything\n\t\t\t\t\t\tif (node._listLevel) {\n\t\t\t\t\t\t\tconvertParagraphToLi(node, 'ul', 1);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcurrentListNode = null;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If the root level element isn't a p tag which can be\n\t\t\t\t\t\t// processed by convertParagraphToLi, it interrupts the\n\t\t\t\t\t\t// lists, causing a new list to start instead of having\n\t\t\t\t\t\t// elements from the next list inserted above this tag.\n\t\t\t\t\t\tprevListNode = currentListNode;\n\t\t\t\t\t\tcurrentListNode = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction filterStyles(node, styleValue) {\n\t\t\t\tvar outputStyles = {}, matches, styles = editor.dom.parseStyle(styleValue);\n\n\t\t\t\tTools.each(styles, function(value, name) {\n\t\t\t\t\t// Convert various MS styles to W3C styles\n\t\t\t\t\tswitch (name) {\n\t\t\t\t\t\tcase 'mso-list':\n\t\t\t\t\t\t\t// Parse out list indent level for lists\n\t\t\t\t\t\t\tmatches = /\\w+ \\w+([0-9]+)/i.exec(styleValue);\n\t\t\t\t\t\t\tif (matches) {\n\t\t\t\t\t\t\t\tnode._listLevel = parseInt(matches[1], 10);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Remove these nodes <span style=\"mso-list:Ignore\">o</span>\n\t\t\t\t\t\t\t// Since the span gets removed we mark the text node and the span\n\t\t\t\t\t\t\tif (/Ignore/i.test(value) && node.firstChild) {\n\t\t\t\t\t\t\t\tnode._listIgnore = true;\n\t\t\t\t\t\t\t\tnode.firstChild._listIgnore = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase \"horiz-align\":\n\t\t\t\t\t\t\tname = \"text-align\";\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase \"vert-align\":\n\t\t\t\t\t\t\tname = \"vertical-align\";\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase \"font-color\":\n\t\t\t\t\t\tcase \"mso-foreground\":\n\t\t\t\t\t\t\tname = \"color\";\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase \"mso-background\":\n\t\t\t\t\t\tcase \"mso-highlight\":\n\t\t\t\t\t\t\tname = \"background\";\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase \"font-weight\":\n\t\t\t\t\t\tcase \"font-style\":\n\t\t\t\t\t\t\tif (value != \"normal\") {\n\t\t\t\t\t\t\t\toutputStyles[name] = value;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tcase \"mso-element\":\n\t\t\t\t\t\t\t// Remove track changes code\n\t\t\t\t\t\t\tif (/^(comment|comment-list)$/i.test(value)) {\n\t\t\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (name.indexOf('mso-comment') === 0) {\n\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Never allow mso- prefixed names\n\t\t\t\t\tif (name.indexOf('mso-') === 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Output only valid styles\n\t\t\t\t\tif (retainStyleProperties == \"all\" || (validStyles && validStyles[name])) {\n\t\t\t\t\t\toutputStyles[name] = value;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Convert bold style to \"b\" element\n\t\t\t\tif (/(bold)/i.test(outputStyles[\"font-weight\"])) {\n\t\t\t\t\tdelete outputStyles[\"font-weight\"];\n\t\t\t\t\tnode.wrap(new Node(\"b\", 1));\n\t\t\t\t}\n\n\t\t\t\t// Convert italic style to \"i\" element\n\t\t\t\tif (/(italic)/i.test(outputStyles[\"font-style\"])) {\n\t\t\t\t\tdelete outputStyles[\"font-style\"];\n\t\t\t\t\tnode.wrap(new Node(\"i\", 1));\n\t\t\t\t}\n\n\t\t\t\t// Serialize the styles and see if there is something left to keep\n\t\t\t\toutputStyles = editor.dom.serializeStyle(outputStyles, node.name);\n\t\t\t\tif (outputStyles) {\n\t\t\t\t\treturn outputStyles;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (settings.paste_enable_default_filters === false) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Detect is the contents is Word junk HTML\n\t\t\tif (isWordContent(e.content)) {\n\t\t\t\te.wordContent = true; // Mark it for other processors\n\n\t\t\t\t// Remove basic Word junk\n\t\t\t\tcontent = Utils.filter(content, [\n\t\t\t\t\t// Word comments like conditional comments etc\n\t\t\t\t\t/<!--[\\s\\S]+?-->/gi,\n\n\t\t\t\t\t// Remove comments, scripts (e.g., msoShowComment), XML tag, VML content,\n\t\t\t\t\t// MS Office namespaced tags, and a few other tags\n\t\t\t\t\t/<(!|script[^>]*>.*?<\\/script(?=[>\\s])|\\/?(\\?xml(:\\w+)?|img|meta|link|style|\\w:\\w+)(?=[\\s\\/>]))[^>]*>/gi,\n\n\t\t\t\t\t// Convert <s> into <strike> for line-though\n\t\t\t\t\t[/<(\\/?)s>/gi, \"<$1strike>\"],\n\n\t\t\t\t\t// Replace nsbp entites to char since it's easier to handle\n\t\t\t\t\t[/&nbsp;/gi, \"\\u00a0\"],\n\n\t\t\t\t\t// Convert <span style=\"mso-spacerun:yes\">___</span> to string of alternating\n\t\t\t\t\t// breaking/non-breaking spaces of same length\n\t\t\t\t\t[/<span\\s+style\\s*=\\s*\"\\s*mso-spacerun\\s*:\\s*yes\\s*;?\\s*\"\\s*>([\\s\\u00a0]*)<\\/span>/gi,\n\t\t\t\t\t\tfunction(str, spaces) {\n\t\t\t\t\t\t\treturn (spaces.length > 0) ?\n\t\t\t\t\t\t\t\tspaces.replace(/./, \" \").slice(Math.floor(spaces.length / 2)).split(\"\").join(\"\\u00a0\") : \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t]);\n\n\t\t\t\tvar validElements = settings.paste_word_valid_elements;\n\t\t\t\tif (!validElements) {\n\t\t\t\t\tvalidElements = (\n\t\t\t\t\t\t'-strong/b,-em/i,-u,-span,-p,-ol,-ul,-li,-h1,-h2,-h3,-h4,-h5,-h6,' +\n\t\t\t\t\t\t'-p/div,-a[href|name],sub,sup,strike,br,del,table[width],tr,' +\n\t\t\t\t\t\t'td[colspan|rowspan|width],th[colspan|rowspan|width],thead,tfoot,tbody'\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Setup strict schema\n\t\t\t\tvar schema = new Schema({\n\t\t\t\t\tvalid_elements: validElements,\n\t\t\t\t\tvalid_children: '-li[p]'\n\t\t\t\t});\n\n\t\t\t\t// Add style/class attribute to all element rules since the user might have removed them from\n\t\t\t\t// paste_word_valid_elements config option and we need to check them for properties\n\t\t\t\tTools.each(schema.elements, function(rule) {\n\t\t\t\t\t/*eslint dot-notation:0*/\n\t\t\t\t\tif (!rule.attributes[\"class\"]) {\n\t\t\t\t\t\trule.attributes[\"class\"] = {};\n\t\t\t\t\t\trule.attributesOrder.push(\"class\");\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!rule.attributes.style) {\n\t\t\t\t\t\trule.attributes.style = {};\n\t\t\t\t\t\trule.attributesOrder.push(\"style\");\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Parse HTML into DOM structure\n\t\t\t\tvar domParser = new DomParser({}, schema);\n\n\t\t\t\t// Filter styles to remove \"mso\" specific styles and convert some of them\n\t\t\t\tdomParser.addAttributeFilter('style', function(nodes) {\n\t\t\t\t\tvar i = nodes.length, node;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\t\tnode.attr('style', filterStyles(node, node.attr('style')));\n\n\t\t\t\t\t\t// Remove pointess spans\n\t\t\t\t\t\tif (node.name == 'span' && node.parent && !node.attributes.length) {\n\t\t\t\t\t\t\tnode.unwrap();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Check the class attribute for comments or del items and remove those\n\t\t\t\tdomParser.addAttributeFilter('class', function(nodes) {\n\t\t\t\t\tvar i = nodes.length, node, className;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnode = nodes[i];\n\n\t\t\t\t\t\tclassName = node.attr('class');\n\t\t\t\t\t\tif (/^(MsoCommentReference|MsoCommentText|msoDel)$/i.test(className)) {\n\t\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode.attr('class', null);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Remove all del elements since we don't want the track changes code in the editor\n\t\t\t\tdomParser.addNodeFilter('del', function(nodes) {\n\t\t\t\t\tvar i = nodes.length;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnodes[i].remove();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Keep some of the links and anchors\n\t\t\t\tdomParser.addNodeFilter('a', function(nodes) {\n\t\t\t\t\tvar i = nodes.length, node, href, name;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\t\thref = node.attr('href');\n\t\t\t\t\t\tname = node.attr('name');\n\n\t\t\t\t\t\tif (href && href.indexOf('#_msocom_') != -1) {\n\t\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (href && href.indexOf('file://') === 0) {\n\t\t\t\t\t\t\thref = href.split('#')[1];\n\t\t\t\t\t\t\tif (href) {\n\t\t\t\t\t\t\t\thref = '#' + href;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!href && !name) {\n\t\t\t\t\t\t\tnode.unwrap();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Remove all named anchors that aren't specific to TOC, Footnotes or Endnotes\n\t\t\t\t\t\t\tif (name && !/^_?(?:toc|edn|ftn)/i.test(name)) {\n\t\t\t\t\t\t\t\tnode.unwrap();\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnode.attr({\n\t\t\t\t\t\t\t\thref: href,\n\t\t\t\t\t\t\t\tname: name\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Parse into DOM structure\n\t\t\t\tvar rootNode = domParser.parse(content);\n\n\t\t\t\t// Process DOM\n\t\t\t\tif (settings.paste_convert_word_fake_lists !== false) {\n\t\t\t\t\tconvertFakeListsToProperLists(rootNode);\n\t\t\t\t}\n\n\t\t\t\t// Serialize DOM back to HTML\n\t\t\t\te.content = new Serializer({\n\t\t\t\t\tvalidate: settings.validate\n\t\t\t\t}, schema).serialize(rootNode);\n\t\t\t}\n\t\t});\n\t}\n\n\tWordFilter.isWordContent = isWordContent;\n\n\treturn WordFilter;\n});\n\n// Included from: js/tinymce/plugins/paste/classes/Quirks.js\n\n/**\n * Quirks.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains various fixes for browsers. These issues can not be feature\n * detected since we have no direct control over the clipboard. However we might be able\n * to remove some of these fixes once the browsers gets updated/fixed.\n *\n * @class tinymce.pasteplugin.Quirks\n * @private\n */\ndefine(\"tinymce/pasteplugin/Quirks\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/pasteplugin/WordFilter\",\n\t\"tinymce/pasteplugin/Utils\"\n], function(Env, Tools, WordFilter, Utils) {\n\t\"use strict\";\n\n\treturn function(editor) {\n\t\tfunction addPreProcessFilter(filterFunc) {\n\t\t\teditor.on('BeforePastePreProcess', function(e) {\n\t\t\t\te.content = filterFunc(e.content);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Removes BR elements after block elements. IE9 has a nasty bug where it puts a BR element after each\n\t\t * block element when pasting from word. This removes those elements.\n\t\t *\n\t\t * This:\n\t\t *  <p>a</p><br><p>b</p>\n\t\t *\n\t\t * Becomes:\n\t\t *  <p>a</p><p>b</p>\n\t\t */\n\t\tfunction removeExplorerBrElementsAfterBlocks(html) {\n\t\t\t// Only filter word specific content\n\t\t\tif (!WordFilter.isWordContent(html)) {\n\t\t\t\treturn html;\n\t\t\t}\n\n\t\t\t// Produce block regexp based on the block elements in schema\n\t\t\tvar blockElements = [];\n\n\t\t\tTools.each(editor.schema.getBlockElements(), function(block, blockName) {\n\t\t\t\tblockElements.push(blockName);\n\t\t\t});\n\n\t\t\tvar explorerBlocksRegExp = new RegExp(\n\t\t\t\t'(?:<br>&nbsp;[\\\\s\\\\r\\\\n]+|<br>)*(<\\\\/?(' + blockElements.join('|') + ')[^>]*>)(?:<br>&nbsp;[\\\\s\\\\r\\\\n]+|<br>)*',\n\t\t\t\t'g'\n\t\t\t);\n\n\t\t\t// Remove BR:s from: <BLOCK>X</BLOCK><BR>\n\t\t\thtml = Utils.filter(html, [\n\t\t\t\t[explorerBlocksRegExp, '$1']\n\t\t\t]);\n\n\t\t\t// IE9 also adds an extra BR element for each soft-linefeed and it also adds a BR for each word wrap break\n\t\t\thtml = Utils.filter(html, [\n\t\t\t\t[/<br><br>/g, '<BR><BR>'], // Replace multiple BR elements with uppercase BR to keep them intact\n\t\t\t\t[/<br>/g, ' '],            // Replace single br elements with space since they are word wrap BR:s\n\t\t\t\t[/<BR><BR>/g, '<br>']      // Replace back the double brs but into a single BR\n\t\t\t]);\n\n\t\t\treturn html;\n\t\t}\n\n\t\t/**\n\t\t * WebKit has a nasty bug where the all computed styles gets added to style attributes when copy/pasting contents.\n\t\t * This fix solves that by simply removing the whole style attribute.\n\t\t *\n\t\t * The paste_webkit_styles option can be set to specify what to keep:\n\t\t *  paste_webkit_styles: \"none\" // Keep no styles\n\t\t *  paste_webkit_styles: \"all\", // Keep all of them\n\t\t *  paste_webkit_styles: \"font-weight color\" // Keep specific ones\n\t\t *\n\t\t * @param {String} content Content that needs to be processed.\n\t\t * @return {String} Processed contents.\n\t\t */\n\t\tfunction removeWebKitStyles(content) {\n\t\t\t// Passthrough all styles from Word and let the WordFilter handle that junk\n\t\t\tif (WordFilter.isWordContent(content)) {\n\t\t\t\treturn content;\n\t\t\t}\n\n\t\t\t// Filter away styles that isn't matching the target node\n\t\t\tvar webKitStyles = editor.settings.paste_webkit_styles;\n\n\t\t\tif (editor.settings.paste_remove_styles_if_webkit === false || webKitStyles == \"all\") {\n\t\t\t\treturn content;\n\t\t\t}\n\n\t\t\tif (webKitStyles) {\n\t\t\t\twebKitStyles = webKitStyles.split(/[, ]/);\n\t\t\t}\n\n\t\t\t// Keep specific styles that doesn't match the current node computed style\n\t\t\tif (webKitStyles) {\n\t\t\t\tvar dom = editor.dom, node = editor.selection.getNode();\n\n\t\t\t\tcontent = content.replace(/(<[^>]+) style=\"([^\"]*)\"([^>]*>)/gi, function(all, before, value, after) {\n\t\t\t\t\tvar inputStyles = dom.parseStyle(value, 'span'), outputStyles = {};\n\n\t\t\t\t\tif (webKitStyles === \"none\") {\n\t\t\t\t\t\treturn before + after;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (var i = 0; i < webKitStyles.length; i++) {\n\t\t\t\t\t\tvar inputValue = inputStyles[webKitStyles[i]], currentValue = dom.getStyle(node, webKitStyles[i], true);\n\n\t\t\t\t\t\tif (/color/.test(webKitStyles[i])) {\n\t\t\t\t\t\t\tinputValue = dom.toHex(inputValue);\n\t\t\t\t\t\t\tcurrentValue = dom.toHex(currentValue);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (currentValue != inputValue) {\n\t\t\t\t\t\t\toutputStyles[webKitStyles[i]] = inputValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\toutputStyles = dom.serializeStyle(outputStyles, 'span');\n\t\t\t\t\tif (outputStyles) {\n\t\t\t\t\t\treturn before + ' style=\"' + outputStyles + '\"' + after;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn before + after;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Remove all external styles\n\t\t\t\tcontent = content.replace(/(<[^>]+) style=\"([^\"]*)\"([^>]*>)/gi, '$1$3');\n\t\t\t}\n\n\t\t\t// Keep internal styles\n\t\t\tcontent = content.replace(/(<[^>]+) data-mce-style=\"([^\"]+)\"([^>]*>)/gi, function(all, before, value, after) {\n\t\t\t\treturn before + ' style=\"' + value + '\"' + after;\n\t\t\t});\n\n\t\t\treturn content;\n\t\t}\n\n\t\t// Sniff browsers and apply fixes since we can't feature detect\n\t\tif (Env.webkit) {\n\t\t\taddPreProcessFilter(removeWebKitStyles);\n\t\t}\n\n\t\tif (Env.ie) {\n\t\t\taddPreProcessFilter(removeExplorerBrElementsAfterBlocks);\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/plugins/paste/classes/Plugin.js\n\n/**\n * Plugin.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains the tinymce plugin logic for the paste plugin.\n *\n * @class tinymce.pasteplugin.Plugin\n * @private\n */\ndefine(\"tinymce/pasteplugin/Plugin\", [\n\t\"tinymce/PluginManager\",\n\t\"tinymce/pasteplugin/Clipboard\",\n\t\"tinymce/pasteplugin/WordFilter\",\n\t\"tinymce/pasteplugin/Quirks\"\n], function(PluginManager, Clipboard, WordFilter, Quirks) {\n\tvar userIsInformed;\n\n\tPluginManager.add('paste', function(editor) {\n\t\tvar self = this, clipboard, settings = editor.settings;\n\n\t\tfunction isUserInformedAboutPlainText() {\n\t\t\treturn userIsInformed || editor.settings.paste_plaintext_inform === false;\n\t\t}\n\n\t\tfunction togglePlainTextPaste() {\n\t\t\tif (clipboard.pasteFormat == \"text\") {\n\t\t\t\tthis.active(false);\n\t\t\t\tclipboard.pasteFormat = \"html\";\n\t\t\t\teditor.fire('PastePlainTextToggle', {state: false});\n\t\t\t} else {\n\t\t\t\tclipboard.pasteFormat = \"text\";\n\t\t\t\tthis.active(true);\n\n\t\t\t\tif (!isUserInformedAboutPlainText()) {\n\t\t\t\t\tvar message = editor.translate('Paste is now in plain text mode. Contents will now ' +\n\t\t\t\t\t\t'be pasted as plain text until you toggle this option off.');\n\n\t\t\t\t\teditor.notificationManager.open({\n\t\t\t\t\t\ttext: message,\n\t\t\t\t\t\ttype: 'info'\n\t\t\t\t\t});\n\n\t\t\t\t\tuserIsInformed = true;\n\t\t\t\t\teditor.fire('PastePlainTextToggle', {state: true});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\teditor.focus();\n\t\t}\n\n\t\t// draw back if power version is requested and registered\n\t\tif (/(^|[ ,])powerpaste([, ]|$)/.test(settings.plugins) && PluginManager.get('powerpaste')) {\n\t\t\t/*eslint no-console:0 */\n\t\t\tif (typeof console !== \"undefined\" && console.log) {\n\t\t\t\tconsole.log(\"PowerPaste is incompatible with Paste plugin! Remove 'paste' from the 'plugins' option.\");\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tself.clipboard = clipboard = new Clipboard(editor);\n\t\tself.quirks = new Quirks(editor);\n\t\tself.wordFilter = new WordFilter(editor);\n\n\t\tif (editor.settings.paste_as_text) {\n\t\t\tself.clipboard.pasteFormat = \"text\";\n\t\t}\n\n\t\tif (settings.paste_preprocess) {\n\t\t\teditor.on('PastePreProcess', function(e) {\n\t\t\t\tsettings.paste_preprocess.call(self, self, e);\n\t\t\t});\n\t\t}\n\n\t\tif (settings.paste_postprocess) {\n\t\t\teditor.on('PastePostProcess', function(e) {\n\t\t\t\tsettings.paste_postprocess.call(self, self, e);\n\t\t\t});\n\t\t}\n\n\t\teditor.addCommand('mceInsertClipboardContent', function(ui, value) {\n\t\t\tif (value.content) {\n\t\t\t\tself.clipboard.pasteHtml(value.content);\n\t\t\t}\n\n\t\t\tif (value.text) {\n\t\t\t\tself.clipboard.pasteText(value.text);\n\t\t\t}\n\t\t});\n\n\t\t// Block all drag/drop events\n\t\tif (editor.settings.paste_block_drop) {\n\t\t\teditor.on('dragend dragover draggesture dragdrop drop drag', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\t\t}\n\n\t\t// Prevent users from dropping data images on Gecko\n\t\tif (!editor.settings.paste_data_images) {\n\t\t\teditor.on('drop', function(e) {\n\t\t\t\tvar dataTransfer = e.dataTransfer;\n\n\t\t\t\tif (dataTransfer && dataTransfer.files && dataTransfer.files.length > 0) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\teditor.addButton('pastetext', {\n\t\t\ticon: 'pastetext',\n\t\t\ttooltip: 'Paste as text',\n\t\t\tonclick: togglePlainTextPaste,\n\t\t\tactive: self.clipboard.pasteFormat == \"text\"\n\t\t});\n\n\t\teditor.addMenuItem('pastetext', {\n\t\t\ttext: 'Paste as text',\n\t\t\tselectable: true,\n\t\t\tactive: clipboard.pasteFormat,\n\t\t\tonclick: togglePlainTextPaste\n\t\t});\n\t});\n});\n\nexpose([\"tinymce/pasteplugin/Utils\"]);\n})(this);";
},767:function(t,n){t.exports="/**\n * Compiled inline version. (Library mode)\n */\n\n/*jshint smarttabs:true, undef:true, latedef:true, curly:true, bitwise:true, camelcase:true */\n/*globals $code */\n\n(function(exports, undefined) {\n\t\"use strict\";\n\n\tvar modules = {};\n\n\tfunction require(ids, callback) {\n\t\tvar module, defs = [];\n\n\t\tfor (var i = 0; i < ids.length; ++i) {\n\t\t\tmodule = modules[ids[i]] || resolve(ids[i]);\n\t\t\tif (!module) {\n\t\t\t\tthrow 'module definition dependecy not found: ' + ids[i];\n\t\t\t}\n\n\t\t\tdefs.push(module);\n\t\t}\n\n\t\tcallback.apply(null, defs);\n\t}\n\n\tfunction define(id, dependencies, definition) {\n\t\tif (typeof id !== 'string') {\n\t\t\tthrow 'invalid module definition, module id must be defined and be a string';\n\t\t}\n\n\t\tif (dependencies === undefined) {\n\t\t\tthrow 'invalid module definition, dependencies must be specified';\n\t\t}\n\n\t\tif (definition === undefined) {\n\t\t\tthrow 'invalid module definition, definition function must be specified';\n\t\t}\n\n\t\trequire(dependencies, function() {\n\t\t\tmodules[id] = definition.apply(null, arguments);\n\t\t});\n\t}\n\n\tfunction defined(id) {\n\t\treturn !!modules[id];\n\t}\n\n\tfunction resolve(id) {\n\t\tvar target = exports;\n\t\tvar fragments = id.split(/[.\\/]/);\n\n\t\tfor (var fi = 0; fi < fragments.length; ++fi) {\n\t\t\tif (!target[fragments[fi]]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttarget = target[fragments[fi]];\n\t\t}\n\n\t\treturn target;\n\t}\n\n\tfunction expose(ids) {\n\t\tvar i, target, id, fragments, privateModules;\n\n\t\tfor (i = 0; i < ids.length; i++) {\n\t\t\ttarget = exports;\n\t\t\tid = ids[i];\n\t\t\tfragments = id.split(/[.\\/]/);\n\n\t\t\tfor (var fi = 0; fi < fragments.length - 1; ++fi) {\n\t\t\t\tif (target[fragments[fi]] === undefined) {\n\t\t\t\t\ttarget[fragments[fi]] = {};\n\t\t\t\t}\n\n\t\t\t\ttarget = target[fragments[fi]];\n\t\t\t}\n\n\t\t\ttarget[fragments[fragments.length - 1]] = modules[id];\n\t\t}\n\t\t\n\t\t// Expose private modules for unit tests\n\t\tif (exports.AMDLC_TESTS) {\n\t\t\tprivateModules = exports.privateModules || {};\n\n\t\t\tfor (id in modules) {\n\t\t\t\tprivateModules[id] = modules[id];\n\t\t\t}\n\n\t\t\tfor (i = 0; i < ids.length; i++) {\n\t\t\t\tdelete privateModules[ids[i]];\n\t\t\t}\n\n\t\t\texports.privateModules = privateModules;\n\t\t}\n\t}\n\n// Included from: js/tinymce/plugins/table/classes/Utils.js\n\n/**\n * Utils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Various utility functions.\n *\n * @class tinymce.tableplugin.Utils\n * @private\n */\ndefine(\"tinymce/tableplugin/Utils\", [\n\t\"tinymce/Env\"\n], function(Env) {\n\tvar setSpanVal = function (name) {\n\t\treturn function (td, val) {\n\t\t\tif (td) {\n\t\t\t\tval = parseInt(val, 10);\n\n\t\t\t\tif (val === 1 || val === 0) {\n\t\t\t\t\ttd.removeAttribute(name, 1);\n\t\t\t\t} else {\n\t\t\t\t\ttd.setAttribute(name, val, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t};\n\n\tvar getSpanVal = function (name) {\n\t\treturn function (td) {\n\t\t\treturn parseInt(td.getAttribute(name) || 1, 10);\n\t\t};\n\t};\n\n\tfunction paddCell(cell) {\n\t\tif (!Env.ie || Env.ie > 9) {\n\t\t\tif (!cell.hasChildNodes()) {\n\t\t\t\tcell.innerHTML = '<br data-mce-bogus=\"1\" />';\n\t\t\t}\n\t\t}\n\t}\n\n\treturn {\n\t\tsetColSpan: setSpanVal('colSpan'),\n\t\tsetRowSpan: setSpanVal('rowspan'),\n\t\tgetColSpan: getSpanVal('colSpan'),\n\t\tgetRowSpan: getSpanVal('rowSpan'),\n\t\tsetSpanVal: function (td, name, value) {\n\t\t\tsetSpanVal(name)(td, value);\n\t\t},\n\t\tgetSpanVal: function (td, name) {\n\t\t\treturn getSpanVal(name)(td);\n\t\t},\n\t\tpaddCell: paddCell\n\t};\n});\n\n// Included from: js/tinymce/plugins/table/classes/SplitCols.js\n\n/**\n * SplitCols.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Contains logic for handling splitting of merged rows.\n *\n * @class tinymce.tableplugin.SplitCols\n * @private\n */\ndefine(\"tinymce/tableplugin/SplitCols\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/tableplugin/Utils\"\n], function(Tools, Utils) {\n\tvar getCellAt = function (grid, x, y) {\n\t\treturn grid[y] ? grid[y][x] : null;\n\t};\n\n\tvar getCellElmAt = function (grid, x, y) {\n\t\tvar cell = getCellAt(grid, x, y);\n\t\treturn cell ? cell.elm : null;\n\t};\n\n\tvar countHoles = function (grid, x, y, delta) {\n\t\tvar y2, cell, count = 0, elm = getCellElmAt(grid, x, y);\n\n\t\tfor (y2 = y; delta > 0 ? y2 < grid.length : y2 >= 0; y2 += delta) {\n\t\t\tcell = getCellAt(grid, x, y2);\n\t\t\tif (elm !== cell.elm) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcount++;\n\t\t}\n\n\t\treturn count;\n\t};\n\n\tvar findRealElm = function (grid, x, y) {\n\t\tvar cell, row = grid[y];\n\n\t\tfor (var x2 = x; x2 < row.length; x2++) {\n\t\t\tcell = row[x2];\n\t\t\tif (cell.real) {\n\t\t\t\treturn cell.elm;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t};\n\n\tvar getRowSplitInfo = function (grid, y) {\n\t\tvar cell, result = [], row = grid[y];\n\n\t\tfor (var x = 0; x < row.length; x++) {\n\t\t\tcell = row[x];\n\t\t\tresult.push({\n\t\t\t\telm: cell.elm,\n\t\t\t\tabove: countHoles(grid, x, y, -1) - 1,\n\t\t\t\tbelow: countHoles(grid, x, y, 1) - 1\n\t\t\t});\n\n\t\t\tx += Utils.getColSpan(cell.elm) - 1;\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tvar createCell = function (info, rowSpan) {\n\t\tvar doc = info.elm.ownerDocument;\n\t\tvar newCell = doc.createElement('td');\n\n\t\tUtils.setColSpan(newCell, Utils.getColSpan(info.elm));\n\t\tUtils.setRowSpan(newCell, rowSpan);\n\t\tUtils.paddCell(newCell);\n\n\t\treturn newCell;\n\t};\n\n\tvar insertOrAppendCell = function (grid, newCell, x, y) {\n\t\tvar realCellElm = findRealElm(grid, x + 1, y);\n\n\t\tif (!realCellElm) {\n\t\t\trealCellElm = findRealElm(grid, 0, y);\n\t\t\trealCellElm.parentNode.appendChild(newCell);\n\t\t} else {\n\t\t\trealCellElm.parentNode.insertBefore(newCell, realCellElm);\n\t\t}\n\t};\n\n\tvar splitAbove = function (grid, info, x, y) {\n\t\tif (info.above !== 0) {\n\t\t\tUtils.setRowSpan(info.elm, info.above);\n\t\t\tvar cell = createCell(info, info.below + 1);\n\t\t\tinsertOrAppendCell(grid, cell, x, y);\n\t\t\treturn cell;\n\t\t}\n\n\t\treturn null;\n\t};\n\n\tvar splitBelow = function (grid, info, x, y) {\n\t\tif (info.below !== 0) {\n\t\t\tUtils.setRowSpan(info.elm, info.above + 1);\n\t\t\tvar cell = createCell(info, info.below);\n\t\t\tinsertOrAppendCell(grid, cell, x, y + 1);\n\t\t\treturn cell;\n\t\t}\n\n\t\treturn null;\n\t};\n\n\tvar splitAt = function (grid, x, y, before) {\n\t\tvar rowInfos = getRowSplitInfo(grid, y);\n\t\tvar rowElm = getCellElmAt(grid, x, y).parentNode;\n\t\tvar cells = [];\n\n\t\tTools.each(rowInfos, function (info, x) {\n\t\t\tvar cell = before ? splitAbove(grid, info, x, y) : splitBelow(grid, info, x, y);\n\t\t\tif (cell !== null) {\n\t\t\t\tcells.push(cells);\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tcells: cells,\n\t\t\trow: rowElm\n\t\t};\n\t};\n\n\treturn {\n\t\tsplitAt: splitAt\n\t};\n});\n\n// Included from: js/tinymce/plugins/table/classes/TableGrid.js\n\n/**\n * TableGrid.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a grid out of a table element. This\n * makes it a whole lot easier to handle complex tables with\n * col/row spans.\n *\n * @class tinymce.tableplugin.TableGrid\n * @private\n */\ndefine(\"tinymce/tableplugin/TableGrid\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/Env\",\n\t\"tinymce/tableplugin/Utils\",\n\t\"tinymce/tableplugin/SplitCols\"\n], function(Tools, Env, Utils, SplitCols) {\n\tvar each = Tools.each, getSpanVal = Utils.getSpanVal, setSpanVal = Utils.setSpanVal;\n\n\treturn function(editor, table, selectedCell) {\n\t\tvar grid, gridWidth, startPos, endPos, selection = editor.selection, dom = selection.dom;\n\n\t\tfunction removeCellSelection() {\n\t\t\teditor.$('td[data-mce-selected],th[data-mce-selected]').removeAttr('data-mce-selected');\n\t\t}\n\n\t\tfunction isEditorBody(node) {\n\t\t\treturn node === editor.getBody();\n\t\t}\n\n\t\tfunction getChildrenByName(node, names) {\n\t\t\tif (!node) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tnames = Tools.map(names.split(','), function(name) {\n\t\t\t\treturn name.toLowerCase();\n\t\t\t});\n\n\t\t\treturn Tools.grep(node.childNodes, function(node) {\n\t\t\t\treturn Tools.inArray(names, node.nodeName.toLowerCase()) !== -1;\n\t\t\t});\n\t\t}\n\n\t\tfunction buildGrid() {\n\t\t\tvar startY = 0;\n\n\t\t\tgrid = [];\n\t\t\tgridWidth = 0;\n\n\t\t\teach(['thead', 'tbody', 'tfoot'], function(part) {\n\t\t\t\tvar partElm = getChildrenByName(table, part)[0];\n\t\t\t\tvar rows = getChildrenByName(partElm, 'tr');\n\n\t\t\t\teach(rows, function(tr, y) {\n\t\t\t\t\ty += startY;\n\n\t\t\t\t\teach(getChildrenByName(tr, 'td,th'), function(td, x) {\n\t\t\t\t\t\tvar x2, y2, rowspan, colspan;\n\n\t\t\t\t\t\t// Skip over existing cells produced by rowspan\n\t\t\t\t\t\tif (grid[y]) {\n\t\t\t\t\t\t\twhile (grid[y][x]) {\n\t\t\t\t\t\t\t\tx++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Get col/rowspan from cell\n\t\t\t\t\t\trowspan = getSpanVal(td, 'rowspan');\n\t\t\t\t\t\tcolspan = getSpanVal(td, 'colspan');\n\n\t\t\t\t\t\t// Fill out rowspan/colspan right and down\n\t\t\t\t\t\tfor (y2 = y; y2 < y + rowspan; y2++) {\n\t\t\t\t\t\t\tif (!grid[y2]) {\n\t\t\t\t\t\t\t\tgrid[y2] = [];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfor (x2 = x; x2 < x + colspan; x2++) {\n\t\t\t\t\t\t\t\tgrid[y2][x2] = {\n\t\t\t\t\t\t\t\t\tpart: part,\n\t\t\t\t\t\t\t\t\treal: y2 == y && x2 == x,\n\t\t\t\t\t\t\t\t\telm: td,\n\t\t\t\t\t\t\t\t\trowspan: rowspan,\n\t\t\t\t\t\t\t\t\tcolspan: colspan\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tgridWidth = Math.max(gridWidth, x + 1);\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tstartY += rows.length;\n\t\t\t});\n\t\t}\n\n\t\tfunction fireNewRow(node) {\n\t\t\teditor.fire('newrow', {\n\t\t\t\tnode: node\n\t\t\t});\n\n\t\t\treturn node;\n\t\t}\n\n\t\tfunction fireNewCell(node) {\n\t\t\teditor.fire('newcell', {\n\t\t\t\tnode: node\n\t\t\t});\n\n\t\t\treturn node;\n\t\t}\n\n\t\tfunction cloneNode(node, children) {\n\t\t\tnode = node.cloneNode(children);\n\t\t\tnode.removeAttribute('id');\n\n\t\t\treturn node;\n\t\t}\n\n\t\tfunction getCell(x, y) {\n\t\t\tvar row;\n\n\t\t\trow = grid[y];\n\t\t\tif (row) {\n\t\t\t\treturn row[x];\n\t\t\t}\n\t\t}\n\n\t\tfunction getRow(grid, y) {\n\t\t\treturn grid[y] ? grid[y] : null;\n\t\t}\n\n\t\tfunction getColumn(grid, x) {\n\t\t\tvar out = [];\n\n\t\t\tfor (var y = 0; y < grid.length; y++) {\n\t\t\t\tout.push(getCell(x, y));\n\t\t\t}\n\n\t\t\treturn out;\n\t\t}\n\n\t\tfunction isCellSelected(cell) {\n\t\t\treturn cell && (!!dom.getAttrib(cell.elm, 'data-mce-selected') || cell == selectedCell);\n\t\t}\n\n\t\tfunction getSelectedRows() {\n\t\t\tvar rows = [];\n\n\t\t\teach(table.rows, function(row) {\n\t\t\t\teach(row.cells, function(cell) {\n\t\t\t\t\tif (dom.getAttrib(cell, 'data-mce-selected') || (selectedCell && cell == selectedCell.elm)) {\n\t\t\t\t\t\trows.push(row);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn rows;\n\t\t}\n\n\t\tfunction deleteTable() {\n\t\t\tvar rng = dom.createRng();\n\n\t\t\tif (isEditorBody(table)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trng.setStartAfter(table);\n\t\t\trng.setEndAfter(table);\n\n\t\t\tselection.setRng(rng);\n\n\t\t\tdom.remove(table);\n\t\t}\n\n\t\tfunction cloneCell(cell) {\n\t\t\tvar formatNode, cloneFormats = {};\n\n\t\t\tif (editor.settings.table_clone_elements !== false) {\n\t\t\t\tcloneFormats = Tools.makeMap(\n\t\t\t\t\t(editor.settings.table_clone_elements || 'strong em b i span font h1 h2 h3 h4 h5 h6 p div').toUpperCase(),\n\t\t\t\t\t/[ ,]/\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Clone formats\n\t\t\tTools.walk(cell, function(node) {\n\t\t\t\tvar curNode;\n\n\t\t\t\tif (node.nodeType == 3) {\n\t\t\t\t\teach(dom.getParents(node.parentNode, null, cell).reverse(), function(node) {\n\t\t\t\t\t\tif (!cloneFormats[node.nodeName]) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = cloneNode(node, false);\n\n\t\t\t\t\t\tif (!formatNode) {\n\t\t\t\t\t\t\tformatNode = curNode = node;\n\t\t\t\t\t\t} else if (curNode) {\n\t\t\t\t\t\t\tcurNode.appendChild(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcurNode = node;\n\t\t\t\t\t});\n\n\t\t\t\t\t// Add something to the inner node\n\t\t\t\t\tif (curNode) {\n\t\t\t\t\t\tcurNode.innerHTML = Env.ie && Env.ie < 10 ? '&nbsp;' : '<br data-mce-bogus=\"1\" />';\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}, 'childNodes');\n\n\t\t\tcell = cloneNode(cell, false);\n\t\t\tfireNewCell(cell);\n\n\t\t\tsetSpanVal(cell, 'rowSpan', 1);\n\t\t\tsetSpanVal(cell, 'colSpan', 1);\n\n\t\t\tif (formatNode) {\n\t\t\t\tcell.appendChild(formatNode);\n\t\t\t} else {\n\t\t\t\tUtils.paddCell(cell);\n\t\t\t}\n\n\t\t\treturn cell;\n\t\t}\n\n\t\tfunction cleanup() {\n\t\t\tvar rng = dom.createRng(), row;\n\n\t\t\t// Empty rows\n\t\t\teach(dom.select('tr', table), function(tr) {\n\t\t\t\tif (tr.cells.length === 0) {\n\t\t\t\t\tdom.remove(tr);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Empty table\n\t\t\tif (dom.select('tr', table).length === 0) {\n\t\t\t\trng.setStartBefore(table);\n\t\t\t\trng.setEndBefore(table);\n\t\t\t\tselection.setRng(rng);\n\t\t\t\tdom.remove(table);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Empty header/body/footer\n\t\t\teach(dom.select('thead,tbody,tfoot', table), function(part) {\n\t\t\t\tif (part.rows.length === 0) {\n\t\t\t\t\tdom.remove(part);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Restore selection to start position if it still exists\n\t\t\tbuildGrid();\n\n\t\t\t// If we have a valid startPos object\n\t\t\tif (startPos) {\n\t\t\t\t// Restore the selection to the closest table position\n\t\t\t\trow = grid[Math.min(grid.length - 1, startPos.y)];\n\t\t\t\tif (row) {\n\t\t\t\t\tselection.select(row[Math.min(row.length - 1, startPos.x)].elm, true);\n\t\t\t\t\tselection.collapse(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction fillLeftDown(x, y, rows, cols) {\n\t\t\tvar tr, x2, r, c, cell;\n\n\t\t\ttr = grid[y][x].elm.parentNode;\n\t\t\tfor (r = 1; r <= rows; r++) {\n\t\t\t\ttr = dom.getNext(tr, 'tr');\n\n\t\t\t\tif (tr) {\n\t\t\t\t\t// Loop left to find real cell\n\t\t\t\t\tfor (x2 = x; x2 >= 0; x2--) {\n\t\t\t\t\t\tcell = grid[y + r][x2].elm;\n\n\t\t\t\t\t\tif (cell.parentNode == tr) {\n\t\t\t\t\t\t\t// Append clones after\n\t\t\t\t\t\t\tfor (c = 1; c <= cols; c++) {\n\t\t\t\t\t\t\t\tdom.insertAfter(cloneCell(cell), cell);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (x2 == -1) {\n\t\t\t\t\t\t// Insert nodes before first cell\n\t\t\t\t\t\tfor (c = 1; c <= cols; c++) {\n\t\t\t\t\t\t\ttr.insertBefore(cloneCell(tr.cells[0]), tr.cells[0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction split() {\n\t\t\teach(grid, function(row, y) {\n\t\t\t\teach(row, function(cell, x) {\n\t\t\t\t\tvar colSpan, rowSpan, i;\n\n\t\t\t\t\tif (isCellSelected(cell)) {\n\t\t\t\t\t\tcell = cell.elm;\n\t\t\t\t\t\tcolSpan = getSpanVal(cell, 'colspan');\n\t\t\t\t\t\trowSpan = getSpanVal(cell, 'rowspan');\n\n\t\t\t\t\t\tif (colSpan > 1 || rowSpan > 1) {\n\t\t\t\t\t\t\tsetSpanVal(cell, 'rowSpan', 1);\n\t\t\t\t\t\t\tsetSpanVal(cell, 'colSpan', 1);\n\n\t\t\t\t\t\t\t// Insert cells right\n\t\t\t\t\t\t\tfor (i = 0; i < colSpan - 1; i++) {\n\t\t\t\t\t\t\t\tdom.insertAfter(cloneCell(cell), cell);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfillLeftDown(x, y, rowSpan - 1, colSpan);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction findItemsOutsideOfRange(items, start, end) {\n\t\t\tvar out = [];\n\n\t\t\tfor (var i = 0; i < items.length; i++) {\n\t\t\t\tif (i < start || i > end) {\n\t\t\t\t\tout.push(items[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn out;\n\t\t}\n\n\t\tfunction getFakeCells(cells) {\n\t\t\treturn Tools.grep(cells, function (cell) {\n\t\t\t\treturn cell.real === false;\n\t\t\t});\n\t\t}\n\n\t\tfunction getUniqueElms(cells) {\n\t\t\tvar elms = [];\n\n\t\t\tfor (var i = 0; i < cells.length; i++) {\n\t\t\t\tvar elm = cells[i].elm;\n\t\t\t\tif (elms[elms.length - 1] !== elm) {\n\t\t\t\t\telms.push(elm);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn elms;\n\t\t}\n\n\t\tfunction reduceRowSpans(grid, startX, startY, endX, endY) {\n\t\t\tvar count = 0;\n\n\t\t\tfor (var y = startY; y <= endY; y++) {\n\t\t\t\tvar allCells = findItemsOutsideOfRange(getRow(grid, y), startX, endX);\n\t\t\t\tvar fakeCells = getFakeCells(allCells);\n\n\t\t\t\tif (allCells.length === fakeCells.length) {\n\t\t\t\t\tTools.each(getUniqueElms(fakeCells), function (elm) {\n\t\t\t\t\t\tUtils.setRowSpan(elm, Utils.getRowSpan(elm) - 1);\n\t\t\t\t\t});\n\n\t\t\t\t\tcount++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn count;\n\t\t}\n\n\t\tfunction reduceColSpans(grid, startX, startY, endX, endY) {\n\t\t\tvar count = 0;\n\n\t\t\tfor (var x = startX; x <= endX; x++) {\n\t\t\t\tvar allCells = findItemsOutsideOfRange(getColumn(grid, x), startY, endY);\n\t\t\t\tvar fakeCells = getFakeCells(allCells);\n\n\t\t\t\tif (allCells.length === fakeCells.length) {\n\t\t\t\t\tTools.each(getUniqueElms(fakeCells), function (elm) {\n\t\t\t\t\t\tUtils.setColSpan(elm, Utils.getColSpan(elm) - 1);\n\t\t\t\t\t});\n\n\t\t\t\t\tcount++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn count;\n\t\t}\n\n\t\tfunction merge(cell, cols, rows) {\n\t\t\tvar pos, startX, startY, endX, endY, x, y, startCell, endCell, children, count, reducedRows, reducedCols;\n\n\t\t\t// Use specified cell and cols/rows\n\t\t\tif (cell) {\n\t\t\t\tpos = getPos(cell);\n\t\t\t\tstartX = pos.x;\n\t\t\t\tstartY = pos.y;\n\t\t\t\tendX = startX + (cols - 1);\n\t\t\t\tendY = startY + (rows - 1);\n\t\t\t} else {\n\t\t\t\tstartPos = endPos = null;\n\n\t\t\t\t// Calculate start/end pos by checking for selected cells in grid works better with context menu\n\t\t\t\teach(grid, function(row, y) {\n\t\t\t\t\teach(row, function(cell, x) {\n\t\t\t\t\t\tif (isCellSelected(cell)) {\n\t\t\t\t\t\t\tif (!startPos) {\n\t\t\t\t\t\t\t\tstartPos = {x: x, y: y};\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tendPos = {x: x, y: y};\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\t// Use selection, but make sure startPos is valid before accessing\n\t\t\t\tif (startPos) {\n\t\t\t\t\tstartX = startPos.x;\n\t\t\t\t\tstartY = startPos.y;\n\t\t\t\t\tendX = endPos.x;\n\t\t\t\t\tendY = endPos.y;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Find start/end cells\n\t\t\tstartCell = getCell(startX, startY);\n\t\t\tendCell = getCell(endX, endY);\n\n\t\t\t// Check if the cells exists and if they are of the same part for example tbody = tbody\n\t\t\tif (startCell && endCell && startCell.part == endCell.part) {\n\t\t\t\t// Split and rebuild grid\n\t\t\t\tsplit();\n\t\t\t\tbuildGrid();\n\n\t\t\t\treducedRows = reduceRowSpans(grid, startX, startY, endX, endY);\n\t\t\t\treducedCols = reduceColSpans(grid, startX, startY, endX, endY);\n\n\t\t\t\t// Set row/col span to start cell\n\t\t\t\tstartCell = getCell(startX, startY).elm;\n\t\t\t\tvar colSpan = (endX - startX - reducedCols) + 1;\n\t\t\t\tvar rowSpan = (endY - startY - reducedRows) + 1;\n\n\t\t\t\t// All cells in table selected then just make it a table with one cell\n\t\t\t\tif (colSpan === gridWidth && rowSpan === grid.length) {\n\t\t\t\t\tcolSpan = 1;\n\t\t\t\t\trowSpan = 1;\n\t\t\t\t}\n\n\t\t\t\t// Multiple whole rows selected then just make it one rowSpan\n\t\t\t\tif (colSpan === gridWidth && rowSpan > 1) {\n\t\t\t\t\trowSpan = 1;\n\t\t\t\t}\n\n\t\t\t\tsetSpanVal(startCell, 'colSpan', colSpan);\n\t\t\t\tsetSpanVal(startCell, 'rowSpan', rowSpan);\n\n\t\t\t\t// Remove other cells and add it's contents to the start cell\n\t\t\t\tfor (y = startY; y <= endY; y++) {\n\t\t\t\t\tfor (x = startX; x <= endX; x++) {\n\t\t\t\t\t\tif (!grid[y] || !grid[y][x]) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcell = grid[y][x].elm;\n\n\t\t\t\t\t\t/*jshint loopfunc:true */\n\t\t\t\t\t\t/*eslint no-loop-func:0 */\n\t\t\t\t\t\tif (cell != startCell) {\n\t\t\t\t\t\t\t// Move children to startCell\n\t\t\t\t\t\t\tchildren = Tools.grep(cell.childNodes);\n\t\t\t\t\t\t\teach(children, function(node) {\n\t\t\t\t\t\t\t\tstartCell.appendChild(node);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Remove bogus nodes if there is children in the target cell\n\t\t\t\t\t\t\tif (children.length) {\n\t\t\t\t\t\t\t\tchildren = Tools.grep(startCell.childNodes);\n\t\t\t\t\t\t\t\tcount = 0;\n\t\t\t\t\t\t\t\teach(children, function(node) {\n\t\t\t\t\t\t\t\t\tif (node.nodeName == 'BR' && count++ < children.length - 1) {\n\t\t\t\t\t\t\t\t\t\tstartCell.removeChild(node);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdom.remove(cell);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Remove empty rows etc and restore caret location\n\t\t\t\tcleanup();\n\t\t\t}\n\t\t}\n\n\t\tfunction insertRow(before) {\n\t\t\tvar posY, cell, lastCell, x, rowElm, newRow, newCell, otherCell, rowSpan, spanValue;\n\n\t\t\t// Find first/last row\n\t\t\teach(grid, function(row, y) {\n\t\t\t\teach(row, function(cell) {\n\t\t\t\t\tif (isCellSelected(cell)) {\n\t\t\t\t\t\tcell = cell.elm;\n\t\t\t\t\t\trowElm = cell.parentNode;\n\t\t\t\t\t\tnewRow = fireNewRow(cloneNode(rowElm, false));\n\t\t\t\t\t\tposY = y;\n\n\t\t\t\t\t\tif (before) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (before) {\n\t\t\t\t\treturn !posY;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// If posY is undefined there is nothing for us to do here...just return to avoid crashing below\n\t\t\tif (posY === undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (x = 0, spanValue = 0; x < grid[0].length; x += spanValue) {\n\t\t\t\t// Cell not found could be because of an invalid table structure\n\t\t\t\tif (!grid[posY][x]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tcell = grid[posY][x].elm;\n\t\t\t\tspanValue = getSpanVal(cell, 'colspan');\n\n\t\t\t\tif (cell != lastCell) {\n\t\t\t\t\tif (!before) {\n\t\t\t\t\t\trowSpan = getSpanVal(cell, 'rowspan');\n\t\t\t\t\t\tif (rowSpan > 1) {\n\t\t\t\t\t\t\tsetSpanVal(cell, 'rowSpan', rowSpan + 1);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Check if cell above can be expanded\n\t\t\t\t\t\tif (posY > 0 && grid[posY - 1][x]) {\n\t\t\t\t\t\t\totherCell = grid[posY - 1][x].elm;\n\t\t\t\t\t\t\trowSpan = getSpanVal(otherCell, 'rowSpan');\n\t\t\t\t\t\t\tif (rowSpan > 1) {\n\t\t\t\t\t\t\t\tsetSpanVal(otherCell, 'rowSpan', rowSpan + 1);\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Insert new cell into new row\n\t\t\t\t\tnewCell = cloneCell(cell);\n\t\t\t\t\tsetSpanVal(newCell, 'colSpan', cell.colSpan);\n\n\t\t\t\t\tnewRow.appendChild(newCell);\n\n\t\t\t\t\tlastCell = cell;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (newRow.hasChildNodes()) {\n\t\t\t\tif (!before) {\n\t\t\t\t\tdom.insertAfter(newRow, rowElm);\n\t\t\t\t} else {\n\t\t\t\t\trowElm.parentNode.insertBefore(newRow, rowElm);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction insertCol(before) {\n\t\t\tvar posX, lastCell;\n\n\t\t\t// Find first/last column\n\t\t\teach(grid, function(row) {\n\t\t\t\teach(row, function(cell, x) {\n\t\t\t\t\tif (isCellSelected(cell)) {\n\t\t\t\t\t\tposX = x;\n\n\t\t\t\t\t\tif (before) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (before) {\n\t\t\t\t\treturn !posX;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teach(grid, function(row, y) {\n\t\t\t\tvar cell, rowSpan, colSpan;\n\n\t\t\t\tif (!row[posX]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcell = row[posX].elm;\n\t\t\t\tif (cell != lastCell) {\n\t\t\t\t\tcolSpan = getSpanVal(cell, 'colspan');\n\t\t\t\t\trowSpan = getSpanVal(cell, 'rowspan');\n\n\t\t\t\t\tif (colSpan == 1) {\n\t\t\t\t\t\tif (!before) {\n\t\t\t\t\t\t\tdom.insertAfter(cloneCell(cell), cell);\n\t\t\t\t\t\t\tfillLeftDown(posX, y, rowSpan - 1, colSpan);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcell.parentNode.insertBefore(cloneCell(cell), cell);\n\t\t\t\t\t\t\tfillLeftDown(posX, y, rowSpan - 1, colSpan);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetSpanVal(cell, 'colSpan', cell.colSpan + 1);\n\t\t\t\t\t}\n\n\t\t\t\t\tlastCell = cell;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction getSelectedCells(grid) {\n\t\t\treturn Tools.grep(getAllCells(grid), isCellSelected);\n\t\t}\n\n\t\tfunction getAllCells(grid) {\n\t\t\tvar cells = [];\n\n\t\t\teach(grid, function(row) {\n\t\t\t\teach(row, function(cell) {\n\t\t\t\t\tcells.push(cell);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn cells;\n\t\t}\n\n\t\tfunction deleteCols() {\n\t\t\tvar cols = [];\n\n\t\t\tif (isEditorBody(table)) {\n\t\t\t\tif (grid[0].length == 1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (getSelectedCells(grid).length == getAllCells(grid).length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Get selected column indexes\n\t\t\teach(grid, function(row) {\n\t\t\t\teach(row, function(cell, x) {\n\t\t\t\t\tif (isCellSelected(cell) && Tools.inArray(cols, x) === -1) {\n\t\t\t\t\t\teach(grid, function(row) {\n\t\t\t\t\t\t\tvar cell = row[x].elm, colSpan;\n\n\t\t\t\t\t\t\tcolSpan = getSpanVal(cell, 'colSpan');\n\n\t\t\t\t\t\t\tif (colSpan > 1) {\n\t\t\t\t\t\t\t\tsetSpanVal(cell, 'colSpan', colSpan - 1);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdom.remove(cell);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tcols.push(x);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tcleanup();\n\t\t}\n\n\t\tfunction deleteRows() {\n\t\t\tvar rows;\n\n\t\t\tfunction deleteRow(tr) {\n\t\t\t\tvar pos, lastCell;\n\n\t\t\t\t// Move down row spanned cells\n\t\t\t\teach(tr.cells, function(cell) {\n\t\t\t\t\tvar rowSpan = getSpanVal(cell, 'rowSpan');\n\n\t\t\t\t\tif (rowSpan > 1) {\n\t\t\t\t\t\tsetSpanVal(cell, 'rowSpan', rowSpan - 1);\n\t\t\t\t\t\tpos = getPos(cell);\n\t\t\t\t\t\tfillLeftDown(pos.x, pos.y, 1, 1);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Delete cells\n\t\t\t\tpos = getPos(tr.cells[0]);\n\t\t\t\teach(grid[pos.y], function(cell) {\n\t\t\t\t\tvar rowSpan;\n\n\t\t\t\t\tcell = cell.elm;\n\n\t\t\t\t\tif (cell != lastCell) {\n\t\t\t\t\t\trowSpan = getSpanVal(cell, 'rowSpan');\n\n\t\t\t\t\t\tif (rowSpan <= 1) {\n\t\t\t\t\t\t\tdom.remove(cell);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetSpanVal(cell, 'rowSpan', rowSpan - 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlastCell = cell;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Get selected rows and move selection out of scope\n\t\t\trows = getSelectedRows();\n\n\t\t\tif (isEditorBody(table) && rows.length == table.rows.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Delete all selected rows\n\t\t\teach(rows.reverse(), function(tr) {\n\t\t\t\tdeleteRow(tr);\n\t\t\t});\n\n\t\t\tcleanup();\n\t\t}\n\n\t\tfunction cutRows() {\n\t\t\tvar rows = getSelectedRows();\n\n\t\t\tif (isEditorBody(table) && rows.length == table.rows.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdom.remove(rows);\n\t\t\tcleanup();\n\n\t\t\treturn rows;\n\t\t}\n\n\t\tfunction copyRows() {\n\t\t\tvar rows = getSelectedRows();\n\n\t\t\teach(rows, function(row, i) {\n\t\t\t\trows[i] = cloneNode(row, true);\n\t\t\t});\n\n\t\t\treturn rows;\n\t\t}\n\n\t\tfunction pasteRows(rows, before) {\n\t\t\tvar splitResult, targetRow, newRows;\n\n\t\t\t// Nothing to paste\n\t\t\tif (!rows) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsplitResult = SplitCols.splitAt(grid, startPos.x, startPos.y, before);\n\t\t\ttargetRow = splitResult.row;\n\t\t\tTools.each(splitResult.cells, fireNewCell);\n\n\t\t\tnewRows = Tools.map(rows, function (row) {\n\t\t\t\treturn row.cloneNode(true);\n\t\t\t});\n\n\t\t\tif (!before) {\n\t\t\t\tnewRows.reverse();\n\t\t\t}\n\n\t\t\teach(newRows, function(row) {\n\t\t\t\tvar i, cellCount = row.cells.length, cell;\n\n\t\t\t\tfireNewRow(row);\n\n\t\t\t\t// Remove col/rowspans\n\t\t\t\tfor (i = 0; i < cellCount; i++) {\n\t\t\t\t\tcell = row.cells[i];\n\n\t\t\t\t\tfireNewCell(cell);\n\t\t\t\t\tsetSpanVal(cell, 'colSpan', 1);\n\t\t\t\t\tsetSpanVal(cell, 'rowSpan', 1);\n\t\t\t\t}\n\n\t\t\t\t// Needs more cells\n\t\t\t\tfor (i = cellCount; i < gridWidth; i++) {\n\t\t\t\t\trow.appendChild(fireNewCell(cloneCell(row.cells[cellCount - 1])));\n\t\t\t\t}\n\n\t\t\t\t// Needs less cells\n\t\t\t\tfor (i = gridWidth; i < cellCount; i++) {\n\t\t\t\t\tdom.remove(row.cells[i]);\n\t\t\t\t}\n\n\t\t\t\t// Add before/after\n\t\t\t\tif (before) {\n\t\t\t\t\ttargetRow.parentNode.insertBefore(row, targetRow);\n\t\t\t\t} else {\n\t\t\t\t\tdom.insertAfter(row, targetRow);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tremoveCellSelection();\n\t\t}\n\n\t\tfunction getPos(target) {\n\t\t\tvar pos;\n\n\t\t\teach(grid, function(row, y) {\n\t\t\t\teach(row, function(cell, x) {\n\t\t\t\t\tif (cell.elm == target) {\n\t\t\t\t\t\tpos = {x: x, y: y};\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn !pos;\n\t\t\t});\n\n\t\t\treturn pos;\n\t\t}\n\n\t\tfunction setStartCell(cell) {\n\t\t\tstartPos = getPos(cell);\n\t\t}\n\n\t\tfunction findEndPos() {\n\t\t\tvar maxX, maxY;\n\n\t\t\tmaxX = maxY = 0;\n\n\t\t\teach(grid, function(row, y) {\n\t\t\t\teach(row, function(cell, x) {\n\t\t\t\t\tvar colSpan, rowSpan;\n\n\t\t\t\t\tif (isCellSelected(cell)) {\n\t\t\t\t\t\tcell = grid[y][x];\n\n\t\t\t\t\t\tif (x > maxX) {\n\t\t\t\t\t\t\tmaxX = x;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (y > maxY) {\n\t\t\t\t\t\t\tmaxY = y;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (cell.real) {\n\t\t\t\t\t\t\tcolSpan = cell.colspan - 1;\n\t\t\t\t\t\t\trowSpan = cell.rowspan - 1;\n\n\t\t\t\t\t\t\tif (colSpan) {\n\t\t\t\t\t\t\t\tif (x + colSpan > maxX) {\n\t\t\t\t\t\t\t\t\tmaxX = x + colSpan;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (rowSpan) {\n\t\t\t\t\t\t\t\tif (y + rowSpan > maxY) {\n\t\t\t\t\t\t\t\t\tmaxY = y + rowSpan;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn {x: maxX, y: maxY};\n\t\t}\n\n\t\tfunction setEndCell(cell) {\n\t\t\tvar startX, startY, endX, endY, maxX, maxY, colSpan, rowSpan, x, y;\n\n\t\t\tendPos = getPos(cell);\n\n\t\t\tif (startPos && endPos) {\n\t\t\t\t// Get start/end positions\n\t\t\t\tstartX = Math.min(startPos.x, endPos.x);\n\t\t\t\tstartY = Math.min(startPos.y, endPos.y);\n\t\t\t\tendX = Math.max(startPos.x, endPos.x);\n\t\t\t\tendY = Math.max(startPos.y, endPos.y);\n\n\t\t\t\t// Expand end position to include spans\n\t\t\t\tmaxX = endX;\n\t\t\t\tmaxY = endY;\n\n\t\t\t\t// This logic tried to expand the selection to always be a rectangle\n\t\t\t\t// Expand startX\n\t\t\t\t/*for (y = startY; y <= maxY; y++) {\n\t\t\t\t\tcell = grid[y][startX];\n\n\t\t\t\t\tif (!cell.real) {\n\t\t\t\t\t\tnewX = startX - (cell.colspan - 1);\n\t\t\t\t\t\tif (newX < startX && newX >= 0) {\n\t\t\t\t\t\t\tstartX = newX;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Expand startY\n\t\t\t\tfor (x = startX; x <= maxX; x++) {\n\t\t\t\t\tcell = grid[startY][x];\n\n\t\t\t\t\tif (!cell.real) {\n\t\t\t\t\t\tnewY = startY - (cell.rowspan - 1);\n\t\t\t\t\t\tif (newY < startY && newY >= 0) {\n\t\t\t\t\t\t\tstartY = newY;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}*/\n\n\t\t\t\t// Find max X, Y\n\t\t\t\tfor (y = startY; y <= endY; y++) {\n\t\t\t\t\tfor (x = startX; x <= endX; x++) {\n\t\t\t\t\t\tcell = grid[y][x];\n\n\t\t\t\t\t\tif (cell.real) {\n\t\t\t\t\t\t\tcolSpan = cell.colspan - 1;\n\t\t\t\t\t\t\trowSpan = cell.rowspan - 1;\n\n\t\t\t\t\t\t\tif (colSpan) {\n\t\t\t\t\t\t\t\tif (x + colSpan > maxX) {\n\t\t\t\t\t\t\t\t\tmaxX = x + colSpan;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (rowSpan) {\n\t\t\t\t\t\t\t\tif (y + rowSpan > maxY) {\n\t\t\t\t\t\t\t\t\tmaxY = y + rowSpan;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tremoveCellSelection();\n\n\t\t\t\t// Add new selection\n\t\t\t\tfor (y = startY; y <= maxY; y++) {\n\t\t\t\t\tfor (x = startX; x <= maxX; x++) {\n\t\t\t\t\t\tif (grid[y][x]) {\n\t\t\t\t\t\t\tdom.setAttrib(grid[y][x].elm, 'data-mce-selected', '1');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction moveRelIdx(cellElm, delta) {\n\t\t\tvar pos, index, cell;\n\n\t\t\tpos = getPos(cellElm);\n\t\t\tindex = pos.y * gridWidth + pos.x;\n\n\t\t\tdo {\n\t\t\t\tindex += delta;\n\t\t\t\tcell = getCell(index % gridWidth, Math.floor(index / gridWidth));\n\n\t\t\t\tif (!cell) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (cell.elm != cellElm) {\n\t\t\t\t\tselection.select(cell.elm, true);\n\n\t\t\t\t\tif (dom.isEmpty(cell.elm)) {\n\t\t\t\t\t\tselection.collapse(true);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} while (cell.elm == cellElm);\n\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction splitCols(before) {\n\t\t\tif (startPos) {\n\t\t\t\tvar splitResult = SplitCols.splitAt(grid, startPos.x, startPos.y, before);\n\t\t\t\tTools.each(splitResult.cells, fireNewCell);\n\t\t\t}\n\t\t}\n\n\t\ttable = table || dom.getParent(selection.getStart(true), 'table');\n\n\t\tbuildGrid();\n\n\t\tselectedCell = selectedCell || dom.getParent(selection.getStart(true), 'th,td');\n\n\t\tif (selectedCell) {\n\t\t\tstartPos = getPos(selectedCell);\n\t\t\tendPos = findEndPos();\n\t\t\tselectedCell = getCell(startPos.x, startPos.y);\n\t\t}\n\n\t\tTools.extend(this, {\n\t\t\tdeleteTable: deleteTable,\n\t\t\tsplit: split,\n\t\t\tmerge: merge,\n\t\t\tinsertRow: insertRow,\n\t\t\tinsertCol: insertCol,\n\t\t\tsplitCols: splitCols,\n\t\t\tdeleteCols: deleteCols,\n\t\t\tdeleteRows: deleteRows,\n\t\t\tcutRows: cutRows,\n\t\t\tcopyRows: copyRows,\n\t\t\tpasteRows: pasteRows,\n\t\t\tgetPos: getPos,\n\t\t\tsetStartCell: setStartCell,\n\t\t\tsetEndCell: setEndCell,\n\t\t\tmoveRelIdx: moveRelIdx,\n\t\t\trefresh: buildGrid\n\t\t});\n\t};\n});\n\n// Included from: js/tinymce/plugins/table/classes/Quirks.js\n\n/**\n * Quirks.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class includes fixes for various browser quirks.\n *\n * @class tinymce.tableplugin.Quirks\n * @private\n */\ndefine(\"tinymce/tableplugin/Quirks\", [\n\t\"tinymce/util/VK\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/tableplugin/Utils\"\n], function(VK, Delay, Env, Tools, Utils) {\n\tvar each = Tools.each, getSpanVal = Utils.getSpanVal;\n\n\treturn function(editor) {\n\t\t/**\n\t\t * Fixed caret movement around tables on WebKit.\n\t\t */\n\t\tfunction moveWebKitSelection() {\n\t\t\tfunction eventHandler(e) {\n\t\t\t\tvar key = e.keyCode;\n\n\t\t\t\tfunction handle(upBool, sourceNode) {\n\t\t\t\t\tvar siblingDirection = upBool ? 'previousSibling' : 'nextSibling';\n\t\t\t\t\tvar currentRow = editor.dom.getParent(sourceNode, 'tr');\n\t\t\t\t\tvar siblingRow = currentRow[siblingDirection];\n\n\t\t\t\t\tif (siblingRow) {\n\t\t\t\t\t\tmoveCursorToRow(editor, sourceNode, siblingRow, upBool);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tableNode = editor.dom.getParent(currentRow, 'table');\n\t\t\t\t\tvar middleNode = currentRow.parentNode;\n\t\t\t\t\tvar parentNodeName = middleNode.nodeName.toLowerCase();\n\t\t\t\t\tif (parentNodeName === 'tbody' || parentNodeName === (upBool ? 'tfoot' : 'thead')) {\n\t\t\t\t\t\tvar targetParent = getTargetParent(upBool, tableNode, middleNode, 'tbody');\n\t\t\t\t\t\tif (targetParent !== null) {\n\t\t\t\t\t\t\treturn moveToRowInTarget(upBool, targetParent, sourceNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn escapeTable(upBool, currentRow, siblingDirection, tableNode);\n\t\t\t\t}\n\n\t\t\t\tfunction getTargetParent(upBool, topNode, secondNode, nodeName) {\n\t\t\t\t\tvar tbodies = editor.dom.select('>' + nodeName, topNode);\n\t\t\t\t\tvar position = tbodies.indexOf(secondNode);\n\t\t\t\t\tif (upBool && position === 0 || !upBool && position === tbodies.length - 1) {\n\t\t\t\t\t\treturn getFirstHeadOrFoot(upBool, topNode);\n\t\t\t\t\t} else if (position === -1) {\n\t\t\t\t\t\tvar topOrBottom = secondNode.tagName.toLowerCase() === 'thead' ? 0 : tbodies.length - 1;\n\t\t\t\t\t\treturn tbodies[topOrBottom];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn tbodies[position + (upBool ? -1 : 1)];\n\t\t\t\t}\n\n\t\t\t\tfunction getFirstHeadOrFoot(upBool, parent) {\n\t\t\t\t\tvar tagName = upBool ? 'thead' : 'tfoot';\n\t\t\t\t\tvar headOrFoot = editor.dom.select('>' + tagName, parent);\n\t\t\t\t\treturn headOrFoot.length !== 0 ? headOrFoot[0] : null;\n\t\t\t\t}\n\n\t\t\t\tfunction moveToRowInTarget(upBool, targetParent, sourceNode) {\n\t\t\t\t\tvar targetRow = getChildForDirection(targetParent, upBool);\n\n\t\t\t\t\tif (targetRow) {\n\t\t\t\t\t\tmoveCursorToRow(editor, sourceNode, targetRow, upBool);\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tfunction escapeTable(upBool, currentRow, siblingDirection, table) {\n\t\t\t\t\tvar tableSibling = table[siblingDirection];\n\n\t\t\t\t\tif (tableSibling) {\n\t\t\t\t\t\tmoveCursorToStartOfElement(tableSibling);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar parentCell = editor.dom.getParent(table, 'td,th');\n\t\t\t\t\tif (parentCell) {\n\t\t\t\t\t\treturn handle(upBool, parentCell, e);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar backUpSibling = getChildForDirection(currentRow, !upBool);\n\t\t\t\t\tmoveCursorToStartOfElement(backUpSibling);\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tfunction getChildForDirection(parent, up) {\n\t\t\t\t\tvar child = parent && parent[up ? 'lastChild' : 'firstChild'];\n\t\t\t\t\t// BR is not a valid table child to return in this case we return the table cell\n\t\t\t\t\treturn child && child.nodeName === 'BR' ? editor.dom.getParent(child, 'td,th') : child;\n\t\t\t\t}\n\n\t\t\t\tfunction moveCursorToStartOfElement(n) {\n\t\t\t\t\teditor.selection.setCursorLocation(n, 0);\n\t\t\t\t}\n\n\t\t\t\tfunction isVerticalMovement() {\n\t\t\t\t\treturn key == VK.UP || key == VK.DOWN;\n\t\t\t\t}\n\n\t\t\t\tfunction isInTable(editor) {\n\t\t\t\t\tvar node = editor.selection.getNode();\n\t\t\t\t\tvar currentRow = editor.dom.getParent(node, 'tr');\n\t\t\t\t\treturn currentRow !== null;\n\t\t\t\t}\n\n\t\t\t\tfunction columnIndex(column) {\n\t\t\t\t\tvar colIndex = 0;\n\t\t\t\t\tvar c = column;\n\t\t\t\t\twhile (c.previousSibling) {\n\t\t\t\t\t\tc = c.previousSibling;\n\t\t\t\t\t\tcolIndex = colIndex + getSpanVal(c, \"colspan\");\n\t\t\t\t\t}\n\t\t\t\t\treturn colIndex;\n\t\t\t\t}\n\n\t\t\t\tfunction findColumn(rowElement, columnIndex) {\n\t\t\t\t\tvar c = 0, r = 0;\n\n\t\t\t\t\teach(rowElement.children, function(cell, i) {\n\t\t\t\t\t\tc = c + getSpanVal(cell, \"colspan\");\n\t\t\t\t\t\tr = i;\n\t\t\t\t\t\tif (c > columnIndex) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn r;\n\t\t\t\t}\n\n\t\t\t\tfunction moveCursorToRow(ed, node, row, upBool) {\n\t\t\t\t\tvar srcColumnIndex = columnIndex(editor.dom.getParent(node, 'td,th'));\n\t\t\t\t\tvar tgtColumnIndex = findColumn(row, srcColumnIndex);\n\t\t\t\t\tvar tgtNode = row.childNodes[tgtColumnIndex];\n\t\t\t\t\tvar rowCellTarget = getChildForDirection(tgtNode, upBool);\n\t\t\t\t\tmoveCursorToStartOfElement(rowCellTarget || tgtNode);\n\t\t\t\t}\n\n\t\t\t\tfunction shouldFixCaret(preBrowserNode) {\n\t\t\t\t\tvar newNode = editor.selection.getNode();\n\t\t\t\t\tvar newParent = editor.dom.getParent(newNode, 'td,th');\n\t\t\t\t\tvar oldParent = editor.dom.getParent(preBrowserNode, 'td,th');\n\n\t\t\t\t\treturn newParent && newParent !== oldParent && checkSameParentTable(newParent, oldParent);\n\t\t\t\t}\n\n\t\t\t\tfunction checkSameParentTable(nodeOne, NodeTwo) {\n\t\t\t\t\treturn editor.dom.getParent(nodeOne, 'TABLE') === editor.dom.getParent(NodeTwo, 'TABLE');\n\t\t\t\t}\n\n\t\t\t\tif (isVerticalMovement() && isInTable(editor)) {\n\t\t\t\t\tvar preBrowserNode = editor.selection.getNode();\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\tif (shouldFixCaret(preBrowserNode)) {\n\t\t\t\t\t\t\thandle(!e.shiftKey && key === VK.UP, preBrowserNode, e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 0);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\teditor.on('KeyDown', function(e) {\n\t\t\t\teventHandler(e);\n\t\t\t});\n\t\t}\n\n\t\tfunction fixBeforeTableCaretBug() {\n\t\t\t// Checks if the selection/caret is at the start of the specified block element\n\t\t\tfunction isAtStart(rng, par) {\n\t\t\t\tvar doc = par.ownerDocument, rng2 = doc.createRange(), elm;\n\n\t\t\t\trng2.setStartBefore(par);\n\t\t\t\trng2.setEnd(rng.endContainer, rng.endOffset);\n\n\t\t\t\telm = doc.createElement('body');\n\t\t\t\telm.appendChild(rng2.cloneContents());\n\n\t\t\t\t// Check for text characters of other elements that should be treated as content\n\t\t\t\treturn elm.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi, '-').replace(/<[^>]+>/g, '').length === 0;\n\t\t\t}\n\n\t\t\t// Fixes an bug where it's impossible to place the caret before a table in Gecko\n\t\t\t// this fix solves it by detecting when the caret is at the beginning of such a table\n\t\t\t// and then manually moves the caret infront of the table\n\t\t\teditor.on('KeyDown', function(e) {\n\t\t\t\tvar rng, table, dom = editor.dom;\n\n\t\t\t\t// On gecko it's not possible to place the caret before a table\n\t\t\t\tif (e.keyCode == 37 || e.keyCode == 38) {\n\t\t\t\t\trng = editor.selection.getRng();\n\t\t\t\t\ttable = dom.getParent(rng.startContainer, 'table');\n\n\t\t\t\t\tif (table && editor.getBody().firstChild == table) {\n\t\t\t\t\t\tif (isAtStart(rng, table)) {\n\t\t\t\t\t\t\trng = dom.createRng();\n\n\t\t\t\t\t\t\trng.setStartBefore(table);\n\t\t\t\t\t\t\trng.setEndBefore(table);\n\n\t\t\t\t\t\t\teditor.selection.setRng(rng);\n\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Fixes an issue on Gecko where it's impossible to place the caret behind a table\n\t\t// This fix will force a paragraph element after the table but only when the forced_root_block setting is enabled\n\t\tfunction fixTableCaretPos() {\n\t\t\teditor.on('KeyDown SetContent VisualAid', function() {\n\t\t\t\tvar last;\n\n\t\t\t\t// Skip empty text nodes from the end\n\t\t\t\tfor (last = editor.getBody().lastChild; last; last = last.previousSibling) {\n\t\t\t\t\tif (last.nodeType == 3) {\n\t\t\t\t\t\tif (last.nodeValue.length > 0) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (last.nodeType == 1 && (last.tagName == 'BR' || !last.getAttribute('data-mce-bogus'))) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (last && last.nodeName == 'TABLE') {\n\t\t\t\t\tif (editor.settings.forced_root_block) {\n\t\t\t\t\t\teditor.dom.add(\n\t\t\t\t\t\t\teditor.getBody(),\n\t\t\t\t\t\t\teditor.settings.forced_root_block,\n\t\t\t\t\t\t\teditor.settings.forced_root_block_attrs,\n\t\t\t\t\t\t\tEnv.ie && Env.ie < 10 ? '&nbsp;' : '<br data-mce-bogus=\"1\" />'\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.dom.add(editor.getBody(), 'br', {'data-mce-bogus': '1'});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('PreProcess', function(o) {\n\t\t\t\tvar last = o.node.lastChild;\n\n\t\t\t\tif (last && (last.nodeName == \"BR\" || (last.childNodes.length == 1 &&\n\t\t\t\t\t(last.firstChild.nodeName == 'BR' || last.firstChild.nodeValue == '\\u00a0'))) &&\n\t\t\t\t\tlast.previousSibling && last.previousSibling.nodeName == \"TABLE\") {\n\t\t\t\t\teditor.dom.remove(last);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// this nasty hack is here to work around some WebKit selection bugs.\n\t\tfunction fixTableCellSelection() {\n\t\t\tfunction tableCellSelected(ed, rng, n, currentCell) {\n\t\t\t\t// The decision of when a table cell is selected is somewhat involved.  The fact that this code is\n\t\t\t\t// required is actually a pointer to the root cause of this bug. A cell is selected when the start\n\t\t\t\t// and end offsets are 0, the start container is a text, and the selection node is either a TR (most cases)\n\t\t\t\t// or the parent of the table (in the case of the selection containing the last cell of a table).\n\t\t\t\tvar TEXT_NODE = 3, table = ed.dom.getParent(rng.startContainer, 'TABLE');\n\t\t\t\tvar tableParent, allOfCellSelected, tableCellSelection;\n\n\t\t\t\tif (table) {\n\t\t\t\t\ttableParent = table.parentNode;\n\t\t\t\t}\n\n\t\t\t\tallOfCellSelected = rng.startContainer.nodeType == TEXT_NODE &&\n\t\t\t\t\trng.startOffset === 0 &&\n\t\t\t\t\trng.endOffset === 0 &&\n\t\t\t\t\tcurrentCell &&\n\t\t\t\t\t(n.nodeName == \"TR\" || n == tableParent);\n\n\t\t\t\ttableCellSelection = (n.nodeName == \"TD\" || n.nodeName == \"TH\") && !currentCell;\n\n\t\t\t\treturn allOfCellSelected || tableCellSelection;\n\t\t\t}\n\n\t\t\tfunction fixSelection() {\n\t\t\t\tvar rng = editor.selection.getRng();\n\t\t\t\tvar n = editor.selection.getNode();\n\t\t\t\tvar currentCell = editor.dom.getParent(rng.startContainer, 'TD,TH');\n\n\t\t\t\tif (!tableCellSelected(editor, rng, n, currentCell)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!currentCell) {\n\t\t\t\t\tcurrentCell = n;\n\t\t\t\t}\n\n\t\t\t\t// Get the very last node inside the table cell\n\t\t\t\tvar end = currentCell.lastChild;\n\t\t\t\twhile (end.lastChild) {\n\t\t\t\t\tend = end.lastChild;\n\t\t\t\t}\n\n\t\t\t\t// Select the entire table cell. Nothing outside of the table cell should be selected.\n\t\t\t\tif (end.nodeType == 3) {\n\t\t\t\t\trng.setEnd(end, end.data.length);\n\t\t\t\t\teditor.selection.setRng(rng);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\teditor.on('KeyDown', function() {\n\t\t\t\tfixSelection();\n\t\t\t});\n\n\t\t\teditor.on('MouseDown', function(e) {\n\t\t\t\tif (e.button != 2) {\n\t\t\t\t\tfixSelection();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Delete table if all cells are selected.\n\t\t */\n\t\tfunction deleteTable() {\n\t\t\tfunction placeCaretInCell(cell) {\n\t\t\t\teditor.selection.select(cell, true);\n\t\t\t\teditor.selection.collapse(true);\n\t\t\t}\n\n\t\t\tfunction clearCell(cell) {\n\t\t\t\teditor.$(cell).empty();\n\t\t\t\tUtils.paddCell(cell);\n\t\t\t}\n\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tif ((e.keyCode == VK.DELETE || e.keyCode == VK.BACKSPACE) && !e.isDefaultPrevented()) {\n\t\t\t\t\tvar table, tableCells, selectedTableCells, cell;\n\n\t\t\t\t\ttable = editor.dom.getParent(editor.selection.getStart(), 'table');\n\t\t\t\t\tif (table) {\n\t\t\t\t\t\ttableCells = editor.dom.select('td,th', table);\n\t\t\t\t\t\tselectedTableCells = Tools.grep(tableCells, function(cell) {\n\t\t\t\t\t\t\treturn !!editor.dom.getAttrib(cell, 'data-mce-selected');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (selectedTableCells.length === 0) {\n\t\t\t\t\t\t\t// If caret is within an empty table cell then empty it for real\n\t\t\t\t\t\t\tcell = editor.dom.getParent(editor.selection.getStart(), 'td,th');\n\t\t\t\t\t\t\tif (editor.selection.isCollapsed() && cell && editor.dom.isEmpty(cell)) {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\tclearCell(cell);\n\t\t\t\t\t\t\t\tplaceCaretInCell(cell);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\teditor.undoManager.transact(function() {\n\t\t\t\t\t\t\tif (tableCells.length == selectedTableCells.length) {\n\t\t\t\t\t\t\t\teditor.execCommand('mceTableDelete');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tTools.each(selectedTableCells, clearCell);\n\t\t\t\t\t\t\t\tplaceCaretInCell(selectedTableCells[0]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tdeleteTable();\n\n\t\tif (Env.webkit) {\n\t\t\tmoveWebKitSelection();\n\t\t\tfixTableCellSelection();\n\t\t}\n\n\t\tif (Env.gecko) {\n\t\t\tfixBeforeTableCaretBug();\n\t\t\tfixTableCaretPos();\n\t\t}\n\n\t\tif (Env.ie > 9) {\n\t\t\tfixBeforeTableCaretBug();\n\t\t\tfixTableCaretPos();\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/plugins/table/classes/CellSelection.js\n\n/**\n * CellSelection.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles table cell selection by faking it using a css class that gets applied\n * to cells when dragging the mouse from one cell to another.\n *\n * @class tinymce.tableplugin.CellSelection\n * @private\n */\ndefine(\"tinymce/tableplugin/CellSelection\", [\n\t\"tinymce/tableplugin/TableGrid\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/util/Tools\"\n], function(TableGrid, TreeWalker, Tools) {\n\treturn function(editor, selectionChange) {\n\t\tvar dom = editor.dom, tableGrid, startCell, startTable, lastMouseOverTarget, hasCellSelection = true, resizing, dragging;\n\n\t\tfunction clear(force) {\n\t\t\t// Restore selection possibilities\n\t\t\teditor.getBody().style.webkitUserSelect = '';\n\n\t\t\tif (force || hasCellSelection) {\n\t\t\t\teditor.$('td[data-mce-selected],th[data-mce-selected]').removeAttr('data-mce-selected');\n\t\t\t\thasCellSelection = false;\n\t\t\t}\n\t\t}\n\n\t\tvar endSelection = function () {\n\t\t\tstartCell = tableGrid = startTable = lastMouseOverTarget = null;\n\t\t\tselectionChange(false);\n\t\t};\n\n\t\tfunction isCellInTable(table, cell) {\n\t\t\tif (!table || !cell) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn table === dom.getParent(cell, 'table');\n\t\t}\n\n\t\tfunction cellSelectionHandler(e) {\n\t\t\tvar sel, target = e.target, currentCell;\n\n\t\t\tif (resizing || dragging) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Fake mouse enter by keeping track of last mouse over\n\t\t\tif (target === lastMouseOverTarget) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlastMouseOverTarget = target;\n\n\t\t\tif (startTable && startCell) {\n\t\t\t\tcurrentCell = dom.getParent(target, 'td,th');\n\n\t\t\t\tif (!isCellInTable(startTable, currentCell)) {\n\t\t\t\t\tcurrentCell = dom.getParent(startTable, 'td,th');\n\t\t\t\t}\n\n\t\t\t\t// Selection inside first cell is normal until we have expanted\n\t\t\t\tif (startCell === currentCell && !hasCellSelection) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tselectionChange(true);\n\n\t\t\t\tif (isCellInTable(startTable, currentCell)) {\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tif (!tableGrid) {\n\t\t\t\t\t\ttableGrid = new TableGrid(editor, startTable, startCell);\n\t\t\t\t\t\teditor.getBody().style.webkitUserSelect = 'none';\n\t\t\t\t\t}\n\n\t\t\t\t\ttableGrid.setEndCell(currentCell);\n\t\t\t\t\thasCellSelection = true;\n\n\t\t\t\t\t// Remove current selection\n\t\t\t\t\tsel = editor.selection.getSel();\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (sel.removeAllRanges) {\n\t\t\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsel.empty();\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// IE9 might throw errors here\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\teditor.on('SelectionChange', function(e) {\n\t\t\tif (hasCellSelection) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t}\n\t\t}, true);\n\n\t\t// Add cell selection logic\n\t\teditor.on('MouseDown', function(e) {\n\t\t\tif (e.button != 2 && !resizing && !dragging) {\n\t\t\t\tclear();\n\n\t\t\t\tstartCell = dom.getParent(e.target, 'td,th');\n\t\t\t\tstartTable = dom.getParent(startCell, 'table');\n\t\t\t}\n\t\t});\n\n\t\teditor.on('mouseover', cellSelectionHandler);\n\n\t\teditor.on('remove', function() {\n\t\t\tdom.unbind(editor.getDoc(), 'mouseover', cellSelectionHandler);\n\t\t\tclear();\n\t\t});\n\n\t\teditor.on('MouseUp', function() {\n\t\t\tvar rng, sel = editor.selection, selectedCells, walker, node, lastNode;\n\n\t\t\tfunction setPoint(node, start) {\n\t\t\t\tvar walker = new TreeWalker(node, node);\n\n\t\t\t\tdo {\n\t\t\t\t\t// Text node\n\t\t\t\t\tif (node.nodeType == 3 && Tools.trim(node.nodeValue).length !== 0) {\n\t\t\t\t\t\tif (start) {\n\t\t\t\t\t\t\trng.setStart(node, 0);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setEnd(node, node.nodeValue.length);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// BR element\n\t\t\t\t\tif (node.nodeName == 'BR') {\n\t\t\t\t\t\tif (start) {\n\t\t\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setEndBefore(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} while ((node = (start ? walker.next() : walker.prev())));\n\t\t\t}\n\n\t\t\t// Move selection to startCell\n\t\t\tif (startCell) {\n\t\t\t\tif (tableGrid) {\n\t\t\t\t\teditor.getBody().style.webkitUserSelect = '';\n\t\t\t\t}\n\n\t\t\t\t// Try to expand text selection as much as we can only Gecko supports cell selection\n\t\t\t\tselectedCells = dom.select('td[data-mce-selected],th[data-mce-selected]');\n\t\t\t\tif (selectedCells.length > 0) {\n\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\tnode = selectedCells[0];\n\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\trng.setEndAfter(node);\n\n\t\t\t\t\tsetPoint(node, 1);\n\t\t\t\t\twalker = new TreeWalker(node, dom.getParent(selectedCells[0], 'table'));\n\n\t\t\t\t\tdo {\n\t\t\t\t\t\tif (node.nodeName == 'TD' || node.nodeName == 'TH') {\n\t\t\t\t\t\t\tif (!dom.getAttrib(node, 'data-mce-selected')) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlastNode = node;\n\t\t\t\t\t\t}\n\t\t\t\t\t} while ((node = walker.next()));\n\n\t\t\t\t\tsetPoint(lastNode);\n\n\t\t\t\t\tsel.setRng(rng);\n\t\t\t\t}\n\n\t\t\t\teditor.nodeChanged();\n\t\t\t\tendSelection();\n\t\t\t}\n\t\t});\n\n\t\teditor.on('KeyUp Drop SetContent', function(e) {\n\t\t\tclear(e.type == 'setcontent');\n\t\t\tendSelection();\n\t\t\tresizing = false;\n\t\t});\n\n\t\teditor.on('ObjectResizeStart ObjectResized', function(e) {\n\t\t\tresizing = e.type != 'objectresized';\n\t\t});\n\n\t\teditor.on('dragstart', function () {\n\t\t\tdragging = true;\n\t\t});\n\n\t\teditor.on('drop dragend', function () {\n\t\t\tdragging = false;\n\t\t});\n\n\t\treturn {\n\t\t\tclear: clear\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/plugins/table/classes/Dialogs.js\n\n/**\n * Dialogs.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*eslint dot-notation:0*/\n\n/**\n * ...\n *\n * @class tinymce.tableplugin.Dialogs\n * @private\n */\ndefine(\"tinymce/tableplugin/Dialogs\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/Env\"\n], function(Tools, Env) {\n\tvar each = Tools.each;\n\n\treturn function(editor) {\n\t\tvar self = this;\n\n\t\tfunction createColorPickAction() {\n\t\t\tvar colorPickerCallback = editor.settings.color_picker_callback;\n\n\t\t\tif (colorPickerCallback) {\n\t\t\t\treturn function() {\n\t\t\t\t\tvar self = this;\n\n\t\t\t\t\tcolorPickerCallback.call(\n\t\t\t\t\t\teditor,\n\t\t\t\t\t\tfunction(value) {\n\t\t\t\t\t\t\tself.value(value).fire('change');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tself.value()\n\t\t\t\t\t);\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tfunction createStyleForm(dom) {\n\t\t\treturn {\n\t\t\t\ttitle: 'Advanced',\n\t\t\t\ttype: 'form',\n\t\t\t\tdefaults: {\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tupdateStyle(dom, this.parents().reverse()[0], this.name() == \"style\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Style',\n\t\t\t\t\t\tname: 'style',\n\t\t\t\t\t\ttype: 'textbox'\n\t\t\t\t\t},\n\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'form',\n\t\t\t\t\t\tpadding: 0,\n\t\t\t\t\t\tformItemDefaults: {\n\t\t\t\t\t\t\tlayout: 'grid',\n\t\t\t\t\t\t\talignH: ['start', 'right']\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdefaults: {\n\t\t\t\t\t\t\tsize: 7\n\t\t\t\t\t\t},\n\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: 'Border color',\n\t\t\t\t\t\t\t\ttype: 'colorbox',\n\t\t\t\t\t\t\t\tname: 'borderColor',\n\t\t\t\t\t\t\t\tonaction: createColorPickAction()\n\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: 'Background color',\n\t\t\t\t\t\t\t\ttype: 'colorbox',\n\t\t\t\t\t\t\t\tname: 'backgroundColor',\n\t\t\t\t\t\t\t\tonaction: createColorPickAction()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\t\t}\n\n\t\tfunction removePxSuffix(size) {\n\t\t\treturn size ? size.replace(/px$/, '') : \"\";\n\t\t}\n\n\t\tfunction addSizeSuffix(size) {\n\t\t\tif (/^[0-9]+$/.test(size)) {\n\t\t\t\tsize += \"px\";\n\t\t\t}\n\n\t\t\treturn size;\n\t\t}\n\n\t\tfunction unApplyAlign(elm) {\n\t\t\teach('left center right'.split(' '), function(name) {\n\t\t\t\teditor.formatter.remove('align' + name, {}, elm);\n\t\t\t});\n\t\t}\n\n\t\tfunction unApplyVAlign(elm) {\n\t\t\teach('top middle bottom'.split(' '), function(name) {\n\t\t\t\teditor.formatter.remove('valign' + name, {}, elm);\n\t\t\t});\n\t\t}\n\n\t\tfunction buildListItems(inputList, itemCallback, startItems) {\n\t\t\tfunction appendItems(values, output) {\n\t\t\t\toutput = output || [];\n\n\t\t\t\tTools.each(values, function(item) {\n\t\t\t\t\tvar menuItem = {text: item.text || item.title};\n\n\t\t\t\t\tif (item.menu) {\n\t\t\t\t\t\tmenuItem.menu = appendItems(item.menu);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmenuItem.value = item.value;\n\n\t\t\t\t\t\tif (itemCallback) {\n\t\t\t\t\t\t\titemCallback(menuItem);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(menuItem);\n\t\t\t\t});\n\n\t\t\t\treturn output;\n\t\t\t}\n\n\t\t\treturn appendItems(inputList, startItems || []);\n\t\t}\n\n\t\tfunction updateStyle(dom, win, isStyleCtrl) {\n\t\t\tvar data = win.toJSON();\n\t\t\tvar css = dom.parseStyle(data.style);\n\n\t\t\tif (isStyleCtrl) {\n\t\t\t\twin.find('#borderColor').value(css[\"border-color\"] || '')[0].fire('change');\n\t\t\t\twin.find('#backgroundColor').value(css[\"background-color\"] || '')[0].fire('change');\n\t\t\t} else {\n\t\t\t\tcss[\"border-color\"] = data.borderColor;\n\t\t\t\tcss[\"background-color\"] = data.backgroundColor;\n\t\t\t}\n\n\t\t\twin.find('#style').value(dom.serializeStyle(dom.parseStyle(dom.serializeStyle(css))));\n\t\t}\n\n\t\tfunction appendStylesToData(dom, data, elm) {\n\t\t\tvar css = dom.parseStyle(dom.getAttrib(elm, 'style'));\n\n\t\t\tif (css[\"border-color\"]) {\n\t\t\t\tdata.borderColor = css[\"border-color\"];\n\t\t\t}\n\n\t\t\tif (css[\"background-color\"]) {\n\t\t\t\tdata.backgroundColor = css[\"background-color\"];\n\t\t\t}\n\n\t\t\tdata.style = dom.serializeStyle(css);\n\t\t}\n\n\t\tfunction mergeStyles(dom, elm, styles) {\n\t\t\tvar css = dom.parseStyle(dom.getAttrib(elm, 'style'));\n\n\t\t\teach(styles, function(style) {\n\t\t\t\tcss[style.name] = style.value;\n\t\t\t});\n\n\t\t\tdom.setAttrib(elm, 'style', dom.serializeStyle(dom.parseStyle(dom.serializeStyle(css))));\n\t\t}\n\n\t\tself.tableProps = function() {\n\t\t\tself.table(true);\n\t\t};\n\n\t\tself.table = function(isProps) {\n\t\t\tvar dom = editor.dom, tableElm, colsCtrl, rowsCtrl, classListCtrl, data = {}, generalTableForm, stylesToMerge;\n\n\t\t\tfunction onSubmitTableForm() {\n\n\t\t\t\t//Explore the layers of the table till we find the first layer of tds or ths\n\t\t\t\tfunction styleTDTH(elm, name, value) {\n\t\t\t\t\tif (elm.tagName === \"TD\" || elm.tagName === \"TH\") {\n\t\t\t\t\t\tdom.setStyle(elm, name, value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (elm.children) {\n\t\t\t\t\t\t\tfor (var i = 0; i < elm.children.length; i++) {\n\t\t\t\t\t\t\t\tstyleTDTH(elm.children[i], name, value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar captionElm;\n\n\t\t\t\tupdateStyle(dom, this);\n\t\t\t\tdata = Tools.extend(data, this.toJSON());\n\n\t\t\t\tif (data[\"class\"] === false) {\n\t\t\t\t\tdelete data[\"class\"];\n\t\t\t\t}\n\n\t\t\t\teditor.undoManager.transact(function() {\n\t\t\t\t\tif (!tableElm) {\n\t\t\t\t\t\ttableElm = editor.plugins.table.insertTable(data.cols || 1, data.rows || 1);\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.dom.setAttribs(tableElm, {\n\t\t\t\t\t\tstyle: data.style,\n\t\t\t\t\t\t'class': data['class']\n\t\t\t\t\t});\n\n\t\t\t\t\tif (editor.settings.table_style_by_css) {\n\t\t\t\t\t\tstylesToMerge = [];\n\t\t\t\t\t\tstylesToMerge.push({name: 'border', value: data.border});\n\t\t\t\t\t\tstylesToMerge.push({name: 'border-spacing', value: addSizeSuffix(data.cellspacing)});\n\t\t\t\t\t\tmergeStyles(dom, tableElm, stylesToMerge);\n\t\t\t\t\t\tdom.setAttribs(tableElm, {\n\t\t\t\t\t\t\t'data-mce-border-color': data.borderColor,\n\t\t\t\t\t\t\t'data-mce-cell-padding': data.cellpadding,\n\t\t\t\t\t\t\t'data-mce-border': data.border\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (tableElm.children) {\n\t\t\t\t\t\t\tfor (var i = 0; i < tableElm.children.length; i++) {\n\t\t\t\t\t\t\t\tstyleTDTH(tableElm.children[i], 'border', data.border);\n\t\t\t\t\t\t\t\tstyleTDTH(tableElm.children[i], 'padding', addSizeSuffix(data.cellpadding));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.dom.setAttribs(tableElm, {\n\t\t\t\t\t\t\tborder: data.border,\n\t\t\t\t\t\t\tcellpadding: data.cellpadding,\n\t\t\t\t\t\t\tcellspacing: data.cellspacing\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dom.getAttrib(tableElm, 'width') && !editor.settings.table_style_by_css) {\n\t\t\t\t\t\tdom.setAttrib(tableElm, 'width', removePxSuffix(data.width));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdom.setStyle(tableElm, 'width', addSizeSuffix(data.width));\n\t\t\t\t\t}\n\n\t\t\t\t\tdom.setStyle(tableElm, 'height', addSizeSuffix(data.height));\n\n\t\t\t\t\t// Toggle caption on/off\n\t\t\t\t\tcaptionElm = dom.select('caption', tableElm)[0];\n\n\t\t\t\t\tif (captionElm && !data.caption) {\n\t\t\t\t\t\tdom.remove(captionElm);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!captionElm && data.caption) {\n\t\t\t\t\t\tcaptionElm = dom.create('caption');\n\t\t\t\t\t\tcaptionElm.innerHTML = !Env.ie ? '<br data-mce-bogus=\"1\"/>' : '\\u00a0';\n\t\t\t\t\t\ttableElm.insertBefore(captionElm, tableElm.firstChild);\n\t\t\t\t\t}\n\t\t\t\t\tunApplyAlign(tableElm);\n\t\t\t\t\tif (data.align) {\n\t\t\t\t\t\teditor.formatter.apply('align' + data.align, {}, tableElm);\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.focus();\n\t\t\t\t\teditor.addVisual();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction getTDTHOverallStyle(elm, name) {\n\t\t\t\tvar cells = editor.dom.select(\"td,th\", elm), firstChildStyle;\n\n\t\t\t\tfunction checkChildren(firstChildStyle, elms) {\n\n\t\t\t\t\tfor (var i = 0; i < elms.length; i++) {\n\t\t\t\t\t\tvar currentStyle = dom.getStyle(elms[i], name);\n\t\t\t\t\t\tif (typeof firstChildStyle === \"undefined\") {\n\t\t\t\t\t\t\tfirstChildStyle = currentStyle;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (firstChildStyle != currentStyle) {\n\t\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn firstChildStyle;\n\n\t\t\t\t}\n\n\t\t\t\tfirstChildStyle = checkChildren(firstChildStyle, cells);\n\n\t\t\t\treturn firstChildStyle;\n\t\t\t}\n\n\t\t\tif (isProps === true) {\n\t\t\t\ttableElm = dom.getParent(editor.selection.getStart(), 'table');\n\n\t\t\t\tif (tableElm) {\n\t\t\t\t\tdata = {\n\t\t\t\t\t\twidth: removePxSuffix(dom.getStyle(tableElm, 'width') || dom.getAttrib(tableElm, 'width')),\n\t\t\t\t\t\theight: removePxSuffix(dom.getStyle(tableElm, 'height') || dom.getAttrib(tableElm, 'height')),\n\t\t\t\t\t\tcellspacing: removePxSuffix(dom.getStyle(tableElm, 'border-spacing') ||\n\t\t\t\t\t\t\tdom.getAttrib(tableElm, 'cellspacing')),\n\t\t\t\t\t\tcellpadding: dom.getAttrib(tableElm, 'data-mce-cell-padding') || dom.getAttrib(tableElm, 'cellpadding') ||\n\t\t\t\t\t\t\tgetTDTHOverallStyle(tableElm, 'padding'),\n\t\t\t\t\t\tborder: dom.getAttrib(tableElm, 'data-mce-border') || dom.getAttrib(tableElm, 'border') ||\n\t\t\t\t\t\t\tgetTDTHOverallStyle(tableElm, 'border'),\n\t\t\t\t\t\tborderColor: dom.getAttrib(tableElm, 'data-mce-border-color'),\n\t\t\t\t\t\tcaption: !!dom.select('caption', tableElm)[0],\n\t\t\t\t\t\t'class': dom.getAttrib(tableElm, 'class')\n\t\t\t\t\t};\n\n\t\t\t\t\teach('left center right'.split(' '), function(name) {\n\t\t\t\t\t\tif (editor.formatter.matchNode(tableElm, 'align' + name)) {\n\t\t\t\t\t\t\tdata.align = name;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcolsCtrl = {label: 'Cols', name: 'cols'};\n\t\t\t\trowsCtrl = {label: 'Rows', name: 'rows'};\n\t\t\t}\n\n\t\t\tif (editor.settings.table_class_list) {\n\t\t\t\tif (data[\"class\"]) {\n\t\t\t\t\tdata[\"class\"] = data[\"class\"].replace(/\\s*mce\\-item\\-table\\s*/g, '');\n\t\t\t\t}\n\n\t\t\t\tclassListCtrl = {\n\t\t\t\t\tname: 'class',\n\t\t\t\t\ttype: 'listbox',\n\t\t\t\t\tlabel: 'Class',\n\t\t\t\t\tvalues: buildListItems(\n\t\t\t\t\t\teditor.settings.table_class_list,\n\t\t\t\t\t\tfunction(item) {\n\t\t\t\t\t\t\tif (item.value) {\n\t\t\t\t\t\t\t\titem.textStyle = function() {\n\t\t\t\t\t\t\t\t\treturn editor.formatter.getCssText({block: 'table', classes: [item.value]});\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tgeneralTableForm = {\n\t\t\t\ttype: 'form',\n\t\t\t\tlayout: 'flex',\n\t\t\t\tdirection: 'column',\n\t\t\t\tlabelGapCalc: 'children',\n\t\t\t\tpadding: 0,\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'form',\n\t\t\t\t\t\tlabelGapCalc: false,\n\t\t\t\t\t\tpadding: 0,\n\t\t\t\t\t\tlayout: 'grid',\n\t\t\t\t\t\tcolumns: 2,\n\t\t\t\t\t\tdefaults: {\n\t\t\t\t\t\t\ttype: 'textbox',\n\t\t\t\t\t\t\tmaxWidth: 50\n\t\t\t\t\t\t},\n\t\t\t\t\t\titems: (editor.settings.table_appearance_options !== false) ? [\n\t\t\t\t\t\t\tcolsCtrl,\n\t\t\t\t\t\t\trowsCtrl,\n\t\t\t\t\t\t\t{label: 'Width', name: 'width'},\n\t\t\t\t\t\t\t{label: 'Height', name: 'height'},\n\t\t\t\t\t\t\t{label: 'Cell spacing', name: 'cellspacing'},\n\t\t\t\t\t\t\t{label: 'Cell padding', name: 'cellpadding'},\n\t\t\t\t\t\t\t{label: 'Border', name: 'border'},\n\t\t\t\t\t\t\t{label: 'Caption', name: 'caption', type: 'checkbox'}\n\t\t\t\t\t\t] : [\n\t\t\t\t\t\t\tcolsCtrl,\n\t\t\t\t\t\t\trowsCtrl,\n\t\t\t\t\t\t\t{label: 'Width', name: 'width'},\n\t\t\t\t\t\t\t{label: 'Height', name: 'height'}\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Alignment',\n\t\t\t\t\t\tname: 'align',\n\t\t\t\t\t\ttype: 'listbox',\n\t\t\t\t\t\ttext: 'None',\n\t\t\t\t\t\tvalues: [\n\t\t\t\t\t\t\t{text: 'None', value: ''},\n\t\t\t\t\t\t\t{text: 'Left', value: 'left'},\n\t\t\t\t\t\t\t{text: 'Center', value: 'center'},\n\t\t\t\t\t\t\t{text: 'Right', value: 'right'}\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\n\t\t\t\t\tclassListCtrl\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tif (editor.settings.table_advtab !== false) {\n\t\t\t\tappendStylesToData(dom, data, tableElm);\n\n\t\t\t\teditor.windowManager.open({\n\t\t\t\t\ttitle: \"Table properties\",\n\t\t\t\t\tdata: data,\n\t\t\t\t\tbodyType: 'tabpanel',\n\t\t\t\t\tbody: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: 'General',\n\t\t\t\t\t\t\ttype: 'form',\n\t\t\t\t\t\t\titems: generalTableForm\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcreateStyleForm(dom)\n\t\t\t\t\t],\n\n\t\t\t\t\tonsubmit: onSubmitTableForm\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\teditor.windowManager.open({\n\t\t\t\t\ttitle: \"Table properties\",\n\t\t\t\t\tdata: data,\n\t\t\t\t\tbody: generalTableForm,\n\t\t\t\t\tonsubmit: onSubmitTableForm\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tself.merge = function(grid, cell) {\n\t\t\teditor.windowManager.open({\n\t\t\t\ttitle: \"Merge cells\",\n\t\t\t\tbody: [\n\t\t\t\t\t{label: 'Cols', name: 'cols', type: 'textbox', value: '1', size: 10},\n\t\t\t\t\t{label: 'Rows', name: 'rows', type: 'textbox', value: '1', size: 10}\n\t\t\t\t],\n\t\t\t\tonsubmit: function() {\n\t\t\t\t\tvar data = this.toJSON();\n\n\t\t\t\t\teditor.undoManager.transact(function() {\n\t\t\t\t\t\tgrid.merge(cell, data.cols, data.rows);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tself.cell = function() {\n\t\t\tvar dom = editor.dom, cellElm, data, classListCtrl, cells = [];\n\n\t\t\tfunction onSubmitCellForm() {\n\t\t\t\tupdateStyle(dom, this);\n\t\t\t\tdata = Tools.extend(data, this.toJSON());\n\n\t\t\t\teditor.undoManager.transact(function() {\n\t\t\t\t\teach(cells, function(cellElm) {\n\t\t\t\t\t\teditor.dom.setAttribs(cellElm, {\n\t\t\t\t\t\t\tscope: data.scope,\n\t\t\t\t\t\t\tstyle: data.style,\n\t\t\t\t\t\t\t'class': data['class']\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\teditor.dom.setStyles(cellElm, {\n\t\t\t\t\t\t\twidth: addSizeSuffix(data.width),\n\t\t\t\t\t\t\theight: addSizeSuffix(data.height)\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Switch cell type\n\t\t\t\t\t\tif (data.type && cellElm.nodeName.toLowerCase() != data.type) {\n\t\t\t\t\t\t\tcellElm = dom.rename(cellElm, data.type);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Apply/remove alignment\n\t\t\t\t\t\tunApplyAlign(cellElm);\n\t\t\t\t\t\tif (data.align) {\n\t\t\t\t\t\t\teditor.formatter.apply('align' + data.align, {}, cellElm);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Apply/remove vertical alignment\n\t\t\t\t\t\tunApplyVAlign(cellElm);\n\t\t\t\t\t\tif (data.valign) {\n\t\t\t\t\t\t\teditor.formatter.apply('valign' + data.valign, {}, cellElm);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\teditor.focus();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Get selected cells or the current cell\n\t\t\tcells = editor.dom.select('td[data-mce-selected],th[data-mce-selected]');\n\t\t\tcellElm = editor.dom.getParent(editor.selection.getStart(), 'td,th');\n\t\t\tif (!cells.length && cellElm) {\n\t\t\t\tcells.push(cellElm);\n\t\t\t}\n\n\t\t\tcellElm = cellElm || cells[0];\n\n\t\t\tif (!cellElm) {\n\t\t\t\t// If this element is null, return now to avoid crashing.\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdata = {\n\t\t\t\twidth: removePxSuffix(dom.getStyle(cellElm, 'width') || dom.getAttrib(cellElm, 'width')),\n\t\t\t\theight: removePxSuffix(dom.getStyle(cellElm, 'height') || dom.getAttrib(cellElm, 'height')),\n\t\t\t\tscope: dom.getAttrib(cellElm, 'scope'),\n\t\t\t\t'class': dom.getAttrib(cellElm, 'class')\n\t\t\t};\n\n\t\t\tdata.type = cellElm.nodeName.toLowerCase();\n\n\t\t\teach('left center right'.split(' '), function(name) {\n\t\t\t\tif (editor.formatter.matchNode(cellElm, 'align' + name)) {\n\t\t\t\t\tdata.align = name;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teach('top middle bottom'.split(' '), function(name) {\n\t\t\t\tif (editor.formatter.matchNode(cellElm, 'valign' + name)) {\n\t\t\t\t\tdata.valign = name;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (editor.settings.table_cell_class_list) {\n\t\t\t\tclassListCtrl = {\n\t\t\t\t\tname: 'class',\n\t\t\t\t\ttype: 'listbox',\n\t\t\t\t\tlabel: 'Class',\n\t\t\t\t\tvalues: buildListItems(\n\t\t\t\t\t\teditor.settings.table_cell_class_list,\n\t\t\t\t\t\tfunction(item) {\n\t\t\t\t\t\t\tif (item.value) {\n\t\t\t\t\t\t\t\titem.textStyle = function() {\n\t\t\t\t\t\t\t\t\treturn editor.formatter.getCssText({block: 'td', classes: [item.value]});\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tvar generalCellForm = {\n\t\t\t\ttype: 'form',\n\t\t\t\tlayout: 'flex',\n\t\t\t\tdirection: 'column',\n\t\t\t\tlabelGapCalc: 'children',\n\t\t\t\tpadding: 0,\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'form',\n\t\t\t\t\t\tlayout: 'grid',\n\t\t\t\t\t\tcolumns: 2,\n\t\t\t\t\t\tlabelGapCalc: false,\n\t\t\t\t\t\tpadding: 0,\n\t\t\t\t\t\tdefaults: {\n\t\t\t\t\t\t\ttype: 'textbox',\n\t\t\t\t\t\t\tmaxWidth: 50\n\t\t\t\t\t\t},\n\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t{label: 'Width', name: 'width'},\n\t\t\t\t\t\t\t{label: 'Height', name: 'height'},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: 'Cell type',\n\t\t\t\t\t\t\t\tname: 'type',\n\t\t\t\t\t\t\t\ttype: 'listbox',\n\t\t\t\t\t\t\t\ttext: 'None',\n\t\t\t\t\t\t\t\tminWidth: 90,\n\t\t\t\t\t\t\t\tmaxWidth: null,\n\t\t\t\t\t\t\t\tvalues: [\n\t\t\t\t\t\t\t\t\t{text: 'Cell', value: 'td'},\n\t\t\t\t\t\t\t\t\t{text: 'Header cell', value: 'th'}\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: 'Scope',\n\t\t\t\t\t\t\t\tname: 'scope',\n\t\t\t\t\t\t\t\ttype: 'listbox',\n\t\t\t\t\t\t\t\ttext: 'None',\n\t\t\t\t\t\t\t\tminWidth: 90,\n\t\t\t\t\t\t\t\tmaxWidth: null,\n\t\t\t\t\t\t\t\tvalues: [\n\t\t\t\t\t\t\t\t\t{text: 'None', value: ''},\n\t\t\t\t\t\t\t\t\t{text: 'Row', value: 'row'},\n\t\t\t\t\t\t\t\t\t{text: 'Column', value: 'col'},\n\t\t\t\t\t\t\t\t\t{text: 'Row group', value: 'rowgroup'},\n\t\t\t\t\t\t\t\t\t{text: 'Column group', value: 'colgroup'}\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: 'H Align',\n\t\t\t\t\t\t\t\tname: 'align',\n\t\t\t\t\t\t\t\ttype: 'listbox',\n\t\t\t\t\t\t\t\ttext: 'None',\n\t\t\t\t\t\t\t\tminWidth: 90,\n\t\t\t\t\t\t\t\tmaxWidth: null,\n\t\t\t\t\t\t\t\tvalues: [\n\t\t\t\t\t\t\t\t\t{text: 'None', value: ''},\n\t\t\t\t\t\t\t\t\t{text: 'Left', value: 'left'},\n\t\t\t\t\t\t\t\t\t{text: 'Center', value: 'center'},\n\t\t\t\t\t\t\t\t\t{text: 'Right', value: 'right'}\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: 'V Align',\n\t\t\t\t\t\t\t\tname: 'valign',\n\t\t\t\t\t\t\t\ttype: 'listbox',\n\t\t\t\t\t\t\t\ttext: 'None',\n\t\t\t\t\t\t\t\tminWidth: 90,\n\t\t\t\t\t\t\t\tmaxWidth: null,\n\t\t\t\t\t\t\t\tvalues: [\n\t\t\t\t\t\t\t\t\t{text: 'None', value: ''},\n\t\t\t\t\t\t\t\t\t{text: 'Top', value: 'top'},\n\t\t\t\t\t\t\t\t\t{text: 'Middle', value: 'middle'},\n\t\t\t\t\t\t\t\t\t{text: 'Bottom', value: 'bottom'}\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\n\t\t\t\t\tclassListCtrl\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tif (editor.settings.table_cell_advtab !== false) {\n\t\t\t\tappendStylesToData(dom, data, cellElm);\n\n\t\t\t\teditor.windowManager.open({\n\t\t\t\t\ttitle: \"Cell properties\",\n\t\t\t\t\tbodyType: 'tabpanel',\n\t\t\t\t\tdata: data,\n\t\t\t\t\tbody: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: 'General',\n\t\t\t\t\t\t\ttype: 'form',\n\t\t\t\t\t\t\titems: generalCellForm\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\tcreateStyleForm(dom)\n\t\t\t\t\t],\n\n\t\t\t\t\tonsubmit: onSubmitCellForm\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\teditor.windowManager.open({\n\t\t\t\t\ttitle: \"Cell properties\",\n\t\t\t\t\tdata: data,\n\t\t\t\t\tbody: generalCellForm,\n\t\t\t\t\tonsubmit: onSubmitCellForm\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tself.row = function() {\n\t\t\tvar dom = editor.dom, tableElm, cellElm, rowElm, classListCtrl, data, rows = [], generalRowForm;\n\n\t\t\tfunction onSubmitRowForm() {\n\t\t\t\tvar tableElm, oldParentElm, parentElm;\n\n\t\t\t\tupdateStyle(dom, this);\n\t\t\t\tdata = Tools.extend(data, this.toJSON());\n\n\t\t\t\teditor.undoManager.transact(function() {\n\t\t\t\t\tvar toType = data.type;\n\n\t\t\t\t\teach(rows, function(rowElm) {\n\t\t\t\t\t\teditor.dom.setAttribs(rowElm, {\n\t\t\t\t\t\t\tscope: data.scope,\n\t\t\t\t\t\t\tstyle: data.style,\n\t\t\t\t\t\t\t'class': data['class']\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\teditor.dom.setStyles(rowElm, {\n\t\t\t\t\t\t\theight: addSizeSuffix(data.height)\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (toType != rowElm.parentNode.nodeName.toLowerCase()) {\n\t\t\t\t\t\t\ttableElm = dom.getParent(rowElm, 'table');\n\n\t\t\t\t\t\t\toldParentElm = rowElm.parentNode;\n\t\t\t\t\t\t\tparentElm = dom.select(toType, tableElm)[0];\n\t\t\t\t\t\t\tif (!parentElm) {\n\t\t\t\t\t\t\t\tparentElm = dom.create(toType);\n\t\t\t\t\t\t\t\tif (tableElm.firstChild) {\n\t\t\t\t\t\t\t\t\ttableElm.insertBefore(parentElm, tableElm.firstChild);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttableElm.appendChild(parentElm);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tparentElm.appendChild(rowElm);\n\n\t\t\t\t\t\t\tif (!oldParentElm.hasChildNodes()) {\n\t\t\t\t\t\t\t\tdom.remove(oldParentElm);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Apply/remove alignment\n\t\t\t\t\t\tunApplyAlign(rowElm);\n\t\t\t\t\t\tif (data.align) {\n\t\t\t\t\t\t\teditor.formatter.apply('align' + data.align, {}, rowElm);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\teditor.focus();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttableElm = editor.dom.getParent(editor.selection.getStart(), 'table');\n\t\t\tcellElm = editor.dom.getParent(editor.selection.getStart(), 'td,th');\n\n\t\t\teach(tableElm.rows, function(row) {\n\t\t\t\teach(row.cells, function(cell) {\n\t\t\t\t\tif (dom.getAttrib(cell, 'data-mce-selected') || cell == cellElm) {\n\t\t\t\t\t\trows.push(row);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\trowElm = rows[0];\n\t\t\tif (!rowElm) {\n\t\t\t\t// If this element is null, return now to avoid crashing.\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdata = {\n\t\t\t\theight: removePxSuffix(dom.getStyle(rowElm, 'height') || dom.getAttrib(rowElm, 'height')),\n\t\t\t\tscope: dom.getAttrib(rowElm, 'scope'),\n\t\t\t\t'class': dom.getAttrib(rowElm, 'class')\n\t\t\t};\n\n\t\t\tdata.type = rowElm.parentNode.nodeName.toLowerCase();\n\n\t\t\teach('left center right'.split(' '), function(name) {\n\t\t\t\tif (editor.formatter.matchNode(rowElm, 'align' + name)) {\n\t\t\t\t\tdata.align = name;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (editor.settings.table_row_class_list) {\n\t\t\t\tclassListCtrl = {\n\t\t\t\t\tname: 'class',\n\t\t\t\t\ttype: 'listbox',\n\t\t\t\t\tlabel: 'Class',\n\t\t\t\t\tvalues: buildListItems(\n\t\t\t\t\t\teditor.settings.table_row_class_list,\n\t\t\t\t\t\tfunction(item) {\n\t\t\t\t\t\t\tif (item.value) {\n\t\t\t\t\t\t\t\titem.textStyle = function() {\n\t\t\t\t\t\t\t\t\treturn editor.formatter.getCssText({block: 'tr', classes: [item.value]});\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tgeneralRowForm = {\n\t\t\t\ttype: 'form',\n\t\t\t\tcolumns: 2,\n\t\t\t\tpadding: 0,\n\t\t\t\tdefaults: {\n\t\t\t\t\ttype: 'textbox'\n\t\t\t\t},\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'listbox',\n\t\t\t\t\t\tname: 'type',\n\t\t\t\t\t\tlabel: 'Row type',\n\t\t\t\t\t\ttext: 'None',\n\t\t\t\t\t\tmaxWidth: null,\n\t\t\t\t\t\tvalues: [\n\t\t\t\t\t\t\t{text: 'Header', value: 'thead'},\n\t\t\t\t\t\t\t{text: 'Body', value: 'tbody'},\n\t\t\t\t\t\t\t{text: 'Footer', value: 'tfoot'}\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'listbox',\n\t\t\t\t\t\tname: 'align',\n\t\t\t\t\t\tlabel: 'Alignment',\n\t\t\t\t\t\ttext: 'None',\n\t\t\t\t\t\tmaxWidth: null,\n\t\t\t\t\t\tvalues: [\n\t\t\t\t\t\t\t{text: 'None', value: ''},\n\t\t\t\t\t\t\t{text: 'Left', value: 'left'},\n\t\t\t\t\t\t\t{text: 'Center', value: 'center'},\n\t\t\t\t\t\t\t{text: 'Right', value: 'right'}\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\t\t\t\t\t{label: 'Height', name: 'height'},\n\t\t\t\t\tclassListCtrl\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tif (editor.settings.table_row_advtab !== false) {\n\t\t\t\tappendStylesToData(dom, data, rowElm);\n\n\t\t\t\teditor.windowManager.open({\n\t\t\t\t\ttitle: \"Row properties\",\n\t\t\t\t\tdata: data,\n\t\t\t\t\tbodyType: 'tabpanel',\n\t\t\t\t\tbody: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: 'General',\n\t\t\t\t\t\t\ttype: 'form',\n\t\t\t\t\t\t\titems: generalRowForm\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcreateStyleForm(dom)\n\t\t\t\t\t],\n\n\t\t\t\t\tonsubmit: onSubmitRowForm\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\teditor.windowManager.open({\n\t\t\t\t\ttitle: \"Row properties\",\n\t\t\t\t\tdata: data,\n\t\t\t\t\tbody: generalRowForm,\n\t\t\t\t\tonsubmit: onSubmitRowForm\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/plugins/table/classes/ResizeBars.js\n\n/**\n * ResizeBars.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles table column and row resizing by adding divs over the columns and rows of the table.\n * These divs are then manipulated using mouse events to resize the underlying table.\n *\n * @class tinymce.tableplugin.ResizeBars\n * @private\n */\ndefine(\"tinymce/tableplugin/ResizeBars\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/VK\"\n], function(Tools, VK) {\n\tvar hoverTable;\n\n\treturn function(editor) {\n\t\tvar RESIZE_BAR_CLASS = 'mce-resize-bar',\n\t\t\tRESIZE_BAR_ROW_CLASS = 'mce-resize-bar-row',\n\t\t\tRESIZE_BAR_ROW_CURSOR_STYLE = 'row-resize',\n\t\t\tRESIZE_BAR_ROW_DATA_ATTRIBUTE = 'data-row',\n\t\t\tRESIZE_BAR_ROW_DATA_INITIAL_TOP_ATTRIBUTE = 'data-initial-top',\n\t\t\tRESIZE_BAR_COL_CLASS = 'mce-resize-bar-col',\n\t\t\tRESIZE_BAR_COL_CURSOR_STYLE = 'col-resize',\n\t\t\tRESIZE_BAR_COL_DATA_ATTRIBUTE = 'data-col',\n\t\t\tRESIZE_BAR_COL_DATA_INITIAL_LEFT_ATTRIBUTE = 'data-initial-left',\n\t\t\tRESIZE_BAR_THICKNESS = 4,\n\t\t\tRESIZE_MINIMUM_WIDTH = 10,\n\t\t\tRESIZE_MINIMUM_HEIGHT = 10,\n\t\t\tRESIZE_BAR_DRAGGING_CLASS = 'mce-resize-bar-dragging';\n\n\t\tvar percentageBasedSizeRegex = new RegExp(/(\\d+(\\.\\d+)?%)/),\n\t\t\tpixelBasedSizeRegex = new RegExp(/px|em/);\n\n\t\tvar delayDrop, dragging, blockerElement, dragBar, lastX, lastY;\n\n\t\t// Get the absolute position's top edge.\n\t\tfunction getTopEdge(index, row) {\n\t\t\treturn {\n\t\t\t\tindex: index,\n\t\t\t\ty: editor.dom.getPos(row).y\n\t\t\t};\n\t\t}\n\n\t\t// Get the absolute position's bottom edge.\n\t\tfunction getBottomEdge(index, row) {\n\t\t\treturn {\n\t\t\t\tindex: index,\n\t\t\t\ty: editor.dom.getPos(row).y + row.offsetHeight\n\t\t\t};\n\t\t}\n\n\t\t// Get the absolute position's left edge.\n\t\tfunction getLeftEdge(index, cell) {\n\t\t\treturn {\n\t\t\t\tindex: index,\n\t\t\t\tx: editor.dom.getPos(cell).x\n\t\t\t};\n\t\t}\n\n\t\t// Get the absolute position's right edge.\n\t\tfunction getRightEdge(index, cell) {\n\t\t\treturn {\n\t\t\t\tindex: index,\n\t\t\t\tx: editor.dom.getPos(cell).x + cell.offsetWidth\n\t\t\t};\n\t\t}\n\n\t\tfunction isRtl() {\n\t\t\tvar dir = editor.getBody().dir;\n\t\t\treturn dir === 'rtl';\n\t\t}\n\n\t\tfunction isInline() {\n\t\t\treturn editor.inline;\n\t\t}\n\n\t\tfunction getBody() {\n\t\t\treturn isInline ? editor.getBody().ownerDocument.body : editor.getBody();\n\t\t}\n\n\t\tfunction getInnerEdge(index, cell) {\n\t\t\treturn isRtl() ? getRightEdge(index, cell) : getLeftEdge(index, cell);\n\t\t}\n\n\t\tfunction getOuterEdge(index, cell) {\n\t\t\treturn isRtl() ? getLeftEdge(index, cell) : getRightEdge(index, cell);\n\t\t}\n\n\t\tfunction getPercentageWidthFallback(element, table) {\n\t\t\treturn getComputedStyleSize(element, 'width') / getComputedStyleSize(table, 'width') * 100;\n\t\t}\n\n\t\tfunction getComputedStyleSize(element, property) {\n\t\t\tvar widthString = editor.dom.getStyle(element, property, true);\n\t\t\tvar width = parseInt(widthString, 10);\n\t\t\treturn width;\n\t\t}\n\n\t\tfunction getCurrentTablePercentWidth(table) {\n\t\t\tvar tableWidth = getComputedStyleSize(table, 'width');\n\t\t\tvar tableParentWidth = getComputedStyleSize(table.parentElement, 'width');\n\t\t\treturn tableWidth / tableParentWidth * 100;\n\t\t}\n\n\t\tfunction getCellPercentDelta(table, delta) {\n\t\t\tvar tableWidth = getComputedStyleSize(table, 'width');\n\t\t\treturn delta / tableWidth * 100;\n\t\t}\n\n\t\tfunction getTablePercentDelta(table, delta) {\n\t\t\tvar tableParentWidth = getComputedStyleSize(table.parentElement, 'width');\n\t\t\treturn delta / tableParentWidth * 100;\n\t\t}\n\n\t\t// Find the left/right (ltr/rtl) or top side locations of the cells to measure.\n\t\t// This is the location of the borders we need to draw over.\n\t\tfunction findPositions(getInner, getOuter, thingsToMeasure) {\n\t\t\tvar tablePositions = [];\n\n\t\t\t// Skip the first item in the array = no left (LTR), right (RTL) or top bars\n\t\t\tfor (var i = 1; i < thingsToMeasure.length; i++) {\n\t\t\t\t// Get the element from the details\n\t\t\t\tvar item = thingsToMeasure[i].element;\n\n\t\t\t\t// We need to zero index this again\n\t\t\t\ttablePositions.push(getInner(i - 1, item));\n\t\t\t}\n\n\t\t\tvar lastTableLineToMake = thingsToMeasure[thingsToMeasure.length - 1];\n\t\t\ttablePositions.push(getOuter(thingsToMeasure.length - 1, lastTableLineToMake.element));\n\n\t\t\treturn tablePositions;\n\t\t}\n\n\t\t// Clear the bars.\n\t\tfunction clearBars() {\n\t\t\tvar bars = editor.dom.select('.' + RESIZE_BAR_CLASS, getBody());\n\t\t\tTools.each(bars, function(bar) {\n\t\t\t\teditor.dom.remove(bar);\n\t\t\t});\n\t\t}\n\n\t\t// Refresh the bars.\n\t\tfunction refreshBars(tableElement) {\n\t\t\tclearBars();\n\t\t\tdrawBars(tableElement);\n\t\t}\n\n\t\t// Generates a resize bar object for the editor to add.\n\t\tfunction generateBar(classToAdd, cursor, left, top, height, width, indexAttr, index) {\n\t\t\tvar bar = {\n\t\t\t\t'data-mce-bogus': 'all',\n\t\t\t\t'class': RESIZE_BAR_CLASS + ' ' + classToAdd,\n\t\t\t\t'unselectable': 'on',\n\t\t\t\t'data-mce-resize': false,\n\t\t\t\tstyle: 'cursor: ' + cursor + '; ' +\n\t\t\t\t\t'margin: 0; ' +\n\t\t\t\t\t'padding: 0; ' +\n\t\t\t\t\t'position: absolute; ' +\n\t\t\t\t\t'left: ' + left + 'px; ' +\n\t\t\t\t\t'top: ' + top + 'px; ' +\n\t\t\t\t\t'height: ' + height + 'px; ' +\n\t\t\t\t\t'width: ' + width + 'px; '\n\t\t\t};\n\n\t\t\tbar[indexAttr] = index;\n\n\t\t\treturn bar;\n\t\t}\n\n\t\t// Draw the row bars over the row borders.\n\t\tfunction drawRows(rowPositions, tableWidth, tablePosition) {\n\t\t\tTools.each(rowPositions, function(rowPosition) {\n\t\t\t\tvar left = tablePosition.x,\n\t\t\t\t\ttop = rowPosition.y - RESIZE_BAR_THICKNESS / 2,\n\t\t\t\t\theight = RESIZE_BAR_THICKNESS,\n\t\t\t\t\twidth = tableWidth;\n\n\t\t\t\teditor.dom.add(getBody(), 'div',\n\t\t\t\t\tgenerateBar(RESIZE_BAR_ROW_CLASS, RESIZE_BAR_ROW_CURSOR_STYLE,\n\t\t\t\t\t\tleft, top, height, width, RESIZE_BAR_ROW_DATA_ATTRIBUTE, rowPosition.index));\n\t\t\t});\n\t\t}\n\n\t\t// Draw the column bars over the column borders.\n\t\tfunction drawCols(cellPositions, tableHeight, tablePosition) {\n\t\t\tTools.each(cellPositions, function(cellPosition) {\n\t\t\t\tvar left = cellPosition.x - RESIZE_BAR_THICKNESS / 2,\n\t\t\t\t\ttop = tablePosition.y,\n\t\t\t\t\theight = tableHeight,\n\t\t\t\t\twidth = RESIZE_BAR_THICKNESS;\n\n\t\t\t\teditor.dom.add(getBody(), 'div',\n\t\t\t\t\tgenerateBar(RESIZE_BAR_COL_CLASS, RESIZE_BAR_COL_CURSOR_STYLE,\n\t\t\t\t\t\tleft, top, height, width, RESIZE_BAR_COL_DATA_ATTRIBUTE, cellPosition.index));\n\t\t\t});\n\t\t}\n\n\t\t// Get a matrix of the cells in each row and the rows in the table.\n\t\tfunction getTableDetails(table) {\n\t\t\treturn Tools.map(table.rows, function(row) {\n\n\t\t\t\tvar cells = Tools.map(row.cells, function(cell) {\n\n\t\t\t\t\tvar rowspan = cell.hasAttribute('rowspan') ? parseInt(cell.getAttribute('rowspan'), 10) : 1;\n\t\t\t\t\tvar colspan = cell.hasAttribute('colspan') ? parseInt(cell.getAttribute('colspan'), 10) : 1;\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\telement: cell,\n\t\t\t\t\t\trowspan: rowspan,\n\t\t\t\t\t\tcolspan: colspan\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\treturn {\n\t\t\t\t\telement: row,\n\t\t\t\t\tcells: cells\n\t\t\t\t};\n\n\t\t\t});\n\n\t\t}\n\n\t\t// Get a grid model of the table.\n\t\tfunction getTableGrid(tableDetails) {\n\t\t\tfunction key(rowIndex, colIndex) {\n\t\t\t\treturn rowIndex + ',' + colIndex;\n\t\t\t}\n\n\t\t\tfunction getAt(rowIndex, colIndex) {\n\t\t\t\treturn access[key(rowIndex, colIndex)];\n\t\t\t}\n\n\t\t\tfunction getAllCells() {\n\t\t\t\tvar allCells = [];\n\t\t\t\tTools.each(rows, function(row) {\n\t\t\t\t\tallCells = allCells.concat(row.cells);\n\t\t\t\t});\n\t\t\t\treturn allCells;\n\t\t\t}\n\n\t\t\tfunction getAllRows() {\n\t\t\t\treturn rows;\n\t\t\t}\n\n\t\t\tvar access = {};\n\t\t\tvar rows = [];\n\n\t\t\tvar maxRows = 0;\n\t\t\tvar maxCols = 0;\n\n\t\t\tTools.each(tableDetails, function(row, rowIndex) {\n\t\t\t\tvar currentRow = [];\n\n\t\t\t\tTools.each(row.cells, function(cell) {\n\n\t\t\t\t\tvar start = 0;\n\n\t\t\t\t\twhile (access[key(rowIndex, start)] !== undefined) {\n\t\t\t\t\t\tstart++;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar current = {\n\t\t\t\t\t\telement: cell.element,\n\t\t\t\t\t\tcolspan: cell.colspan,\n\t\t\t\t\t\trowspan: cell.rowspan,\n\t\t\t\t\t\trowIndex: rowIndex,\n\t\t\t\t\t\tcolIndex: start\n\t\t\t\t\t};\n\n\t\t\t\t\tfor (var i = 0; i < cell.colspan; i++) {\n\t\t\t\t\t\tfor (var j = 0; j < cell.rowspan; j++) {\n\t\t\t\t\t\t\tvar cr = rowIndex + j;\n\t\t\t\t\t\t\tvar cc = start + i;\n\t\t\t\t\t\t\taccess[key(cr, cc)] = current;\n\t\t\t\t\t\t\tmaxRows = Math.max(maxRows, cr + 1);\n\t\t\t\t\t\t\tmaxCols = Math.max(maxCols, cc + 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tcurrentRow.push(current);\n\t\t\t\t});\n\n\t\t\t\trows.push({\n\t\t\t\t\telement: row.element,\n\t\t\t\t\tcells: currentRow\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\tgrid: {\n\t\t\t\t\tmaxRows: maxRows,\n\t\t\t\t\tmaxCols: maxCols\n\t\t\t\t},\n\t\t\t\tgetAt: getAt,\n\t\t\t\tgetAllCells: getAllCells,\n\t\t\t\tgetAllRows: getAllRows\n\t\t\t};\n\t\t}\n\n\t\tfunction range(start, end) {\n\t\t\tvar r = [];\n\n\t\t\tfor (var i = start; i < end; i++) {\n\t\t\t\tr.push(i);\n\t\t\t}\n\n\t\t\treturn r;\n\t\t}\n\n\t\t// Attempt to get a representative single block for this column.\n\t\t// If we can't find a single block, all blocks in this row/column are spanned\n\t\t// and we'll need to fallback to getting the first cell in the row/column.\n\t\tfunction decide(getBlock, isSingle, getFallback) {\n\t\t\tvar inBlock = getBlock();\n\t\t\tvar singleInBlock;\n\n\t\t\tfor (var i = 0; i < inBlock.length; i++) {\n\t\t\t\tif (isSingle(inBlock[i])) {\n\t\t\t\t\tsingleInBlock = inBlock[i];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn singleInBlock ? singleInBlock : getFallback();\n\t\t}\n\n\t\t// Attempt to get representative blocks for the width of each column.\n\t\tfunction getColumnBlocks(tableGrid) {\n\t\t\tvar cols = range(0, tableGrid.grid.maxCols);\n\t\t\tvar rows = range(0, tableGrid.grid.maxRows);\n\n\t\t\treturn Tools.map(cols, function(col) {\n\t\t\t\tfunction getBlock() {\n\t\t\t\t\tvar details = [];\n\t\t\t\t\tfor (var i = 0; i < rows.length; i++) {\n\t\t\t\t\t\tvar detail = tableGrid.getAt(i, col);\n\t\t\t\t\t\tif (detail && detail.colIndex === col) {\n\t\t\t\t\t\t\tdetails.push(detail);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn details;\n\t\t\t\t}\n\n\t\t\t\tfunction isSingle(detail) {\n\t\t\t\t\treturn detail.colspan === 1;\n\t\t\t\t}\n\n\t\t\t\tfunction getFallback() {\n\t\t\t\t\tvar item;\n\n\t\t\t\t\tfor (var i = 0; i < rows.length; i++) {\n\t\t\t\t\t\titem = tableGrid.getAt(i, col);\n\t\t\t\t\t\tif (item) {\n\t\t\t\t\t\t\treturn item;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\treturn decide(getBlock, isSingle, getFallback);\n\t\t\t});\n\t\t}\n\n\t\t// Attempt to get representative blocks for the height of each row.\n\t\tfunction getRowBlocks(tableGrid) {\n\t\t\tvar cols = range(0, tableGrid.grid.maxCols);\n\t\t\tvar rows = range(0, tableGrid.grid.maxRows);\n\n\t\t\treturn Tools.map(rows, function(row) {\n\t\t\t\tfunction getBlock() {\n\t\t\t\t\tvar details = [];\n\t\t\t\t\tfor (var i = 0; i < cols.length; i++) {\n\t\t\t\t\t\tvar detail = tableGrid.getAt(row, i);\n\t\t\t\t\t\tif (detail && detail.rowIndex === row) {\n\t\t\t\t\t\t\tdetails.push(detail);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn details;\n\t\t\t\t}\n\n\t\t\t\tfunction isSingle(detail) {\n\t\t\t\t\treturn detail.rowspan === 1;\n\t\t\t\t}\n\n\t\t\t\tfunction getFallback() {\n\t\t\t\t\treturn tableGrid.getAt(row, 0);\n\t\t\t\t}\n\n\t\t\t\treturn decide(getBlock, isSingle, getFallback);\n\t\t\t});\n\t\t}\n\n\t\t// Draw resize bars over the left/right (ltr/rtl) or top side locations of the cells to measure.\n\t\t// This is the location of the borders we need to draw over.\n\t\tfunction drawBars(table) {\n\t\t\tvar tableDetails = getTableDetails(table);\n\t\t\tvar tableGrid = getTableGrid(tableDetails);\n\t\t\tvar rows = getRowBlocks(tableGrid);\n\t\t\tvar cols = getColumnBlocks(tableGrid);\n\n\t\t\tvar tablePosition = editor.dom.getPos(table);\n\t\t\tvar rowPositions = rows.length > 0 ? findPositions(getTopEdge, getBottomEdge, rows) : [];\n\t\t\tvar colPositions = cols.length > 0 ? findPositions(getInnerEdge, getOuterEdge, cols) : [];\n\n\t\t\tdrawRows(rowPositions, table.offsetWidth, tablePosition);\n\t\t\tdrawCols(colPositions, table.offsetHeight, tablePosition);\n\t\t}\n\n\t\t// Attempt to deduce the width/height of a column/row that has more than one cell spanned.\n\t\tfunction deduceSize(deducables, index, isPercentageBased, table) {\n\t\t\tif (index < 0 || index >= deducables.length - 1) {\n\t\t\t\treturn \"\";\n\t\t\t}\n\n\t\t\tvar current = deducables[index];\n\n\t\t\tif (current) {\n\t\t\t\tcurrent = {\n\t\t\t\t\tvalue: current,\n\t\t\t\t\tdelta: 0\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tvar reversedUpToIndex = deducables.slice(0, index).reverse();\n\t\t\t\tfor (var i = 0; i < reversedUpToIndex.length; i++) {\n\t\t\t\t\tif (reversedUpToIndex[i]) {\n\t\t\t\t\t\tcurrent = {\n\t\t\t\t\t\t\tvalue: reversedUpToIndex[i],\n\t\t\t\t\t\t\tdelta: i + 1\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar next = deducables[index + 1];\n\n\t\t\tif (next) {\n\t\t\t\tnext = {\n\t\t\t\t\tvalue: next,\n\t\t\t\t\tdelta: 1\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tvar rest = deducables.slice(index + 1);\n\t\t\t\tfor (var j = 0; j < rest.length; j++) {\n\t\t\t\t\tif (rest[j]) {\n\t\t\t\t\t\tnext = {\n\t\t\t\t\t\t\tvalue: rest[j],\n\t\t\t\t\t\t\tdelta: j + 1\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar extras = next.delta - current.delta;\n\t\t\tvar pixelWidth = Math.abs(next.value - current.value) / extras;\n\t\t\treturn isPercentageBased ? pixelWidth / getComputedStyleSize(table, 'width') * 100 : pixelWidth;\n\t\t}\n\n\t\tfunction getStyleOrAttrib(element, property) {\n\t\t\tvar sizeString = editor.dom.getStyle(element, property);\n\t\t\tif (!sizeString) {\n\t\t\t\tsizeString = editor.dom.getAttrib(element, property);\n\t\t\t}\n\t\t\tif (!sizeString) {\n\t\t\t\tsizeString = editor.dom.getStyle(element, property, true);\n\t\t\t}\n\t\t\treturn sizeString;\n\t\t}\n\n\t\tfunction getWidth(element, isPercentageBased, table) {\n\t\t\tvar widthString = getStyleOrAttrib(element, 'width');\n\n\t\t\tvar widthNumber = parseInt(widthString, 10);\n\n\t\t\tvar getWidthFallback = isPercentageBased ? getPercentageWidthFallback(element, table) : getComputedStyleSize(element, 'width');\n\n\t\t\t// If this is percentage based table, but this cell isn't percentage based.\n\t\t\t// Or if this is a pixel based table, but this cell isn't pixel based.\n\t\t\tif (isPercentageBased && !isPercentageBasedSize(widthString) ||\n\t\t\t!isPercentageBased && !isPixelBasedSize(widthString)) {\n\t\t\t\t// set the widthnumber to 0\n\t\t\t\twidthNumber = 0;\n\t\t\t}\n\n\t\t\treturn !isNaN(widthNumber) && widthNumber > 0 ?\n\t\t\t\twidthNumber : getWidthFallback;\n\t\t}\n\n\t\t// Attempt to get the css width from column representative cells.\n\t\tfunction getWidths(tableGrid, isPercentageBased, table) {\n\n\t\t\tvar cols = getColumnBlocks(tableGrid);\n\n\t\t\tvar backups = Tools.map(cols, function(col) {\n\t\t\t\treturn getInnerEdge(col.colIndex, col.element).x;\n\t\t\t});\n\n\t\t\tvar widths = [];\n\n\t\t\tfor (var i = 0; i < cols.length; i++) {\n\t\t\t\tvar span = cols[i].element.hasAttribute('colspan') ? parseInt(cols[i].element.getAttribute('colspan'), 10) : 1;\n\t\t\t\t// Deduce if the column has colspan of more than 1\n\t\t\t\tvar width = span > 1 ? deduceSize(backups, i) : getWidth(cols[i].element, isPercentageBased, table);\n\t\t\t\t// If everything's failed and we still don't have a width\n\t\t\t\twidth = width ? width : RESIZE_MINIMUM_WIDTH;\n\t\t\t\twidths.push(width);\n\t\t\t}\n\n\t\t\treturn widths;\n\t\t}\n\n\t\t// Attempt to get the pixel height from a cell.\n\t\tfunction getPixelHeight(element) {\n\n\t\t\tvar heightString = getStyleOrAttrib(element, 'height');\n\n\t\t\tvar heightNumber = parseInt(heightString, 10);\n\n\t\t\tif (isPercentageBasedSize(heightString)) {\n\t\t\t\theightNumber = 0;\n\t\t\t}\n\n\t\t\treturn !isNaN(heightNumber) && heightNumber > 0 ?\n\t\t\t\t\t\t\theightNumber : getComputedStyleSize(element, 'height');\n\t\t}\n\n\t\t// Attempt to get the css height from row representative cells.\n\t\tfunction getPixelHeights(tableGrid) {\n\n\t\t\tvar rows = getRowBlocks(tableGrid);\n\n\t\t\tvar backups = Tools.map(rows, function(row) {\n\t\t\t\treturn getTopEdge(row.rowIndex, row.element).y;\n\t\t\t});\n\n\t\t\tvar heights = [];\n\n\t\t\tfor (var i = 0; i < rows.length; i++) {\n\t\t\t\tvar span = rows[i].element.hasAttribute('rowspan') ? parseInt(rows[i].element.getAttribute('rowspan'), 10) : 1;\n\n\t\t\t\tvar height = span > 1 ? deduceSize(backups, i) : getPixelHeight(rows[i].element);\n\n\t\t\t\theight = height ? height : RESIZE_MINIMUM_HEIGHT;\n\t\t\t\theights.push(height);\n\t\t\t}\n\n\t\t\treturn heights;\n\t\t}\n\n\t\t// Determine how much each column's css width will need to change.\n\t\t// Sizes = result = pixels widths OR percentage based widths\n\t\tfunction determineDeltas(sizes, column, step, min, isPercentageBased) {\n\n\t\t\tvar result = sizes.slice(0);\n\n\t\t\tfunction generateZeros(array) {\n\t\t\t\treturn Tools.map(array, function() {\n\t\t\t\t\treturn 0;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onOneColumn() {\n\t\t\t\tvar deltas;\n\t\t\t\tif (isPercentageBased) {\n\t\t\t\t\t// If we have one column in a percent based table, that column should be 100% of the width of the table.\n\t\t\t\t\tdeltas = [100 - result[0]];\n\t\t\t\t} else {\n\t\t\t\t\tvar newNext = Math.max(min, result[0] + step);\n\t\t\t\t\tdeltas = [newNext - result[0]];\n\t\t\t\t}\n\t\t\t\treturn deltas;\n\t\t\t}\n\n\t\t\tfunction onLeftOrMiddle(index, next) {\n\n\t\t\t\tvar startZeros = generateZeros(result.slice(0, index));\n\t\t\t\tvar endZeros = generateZeros(result.slice(next + 1));\n\t\t\t\tvar deltas;\n\n\t\t\t\tif (step >= 0) {\n\t\t\t\t\tvar newNext = Math.max(min, result[next] - step);\n\t\t\t\t\tdeltas = startZeros.concat([step, newNext - result[next]]).concat(endZeros);\n\t\t\t\t} else {\n\t\t\t\t\tvar newThis = Math.max(min, result[index] + step);\n\t\t\t\t\tvar diffx = result[index] - newThis;\n\t\t\t\t\tdeltas = startZeros.concat([newThis - result[index], diffx]).concat(endZeros);\n\t\t\t\t}\n\n\t\t\t\treturn deltas;\n\t\t\t}\n\n\t\t\tfunction onRight(previous, index) {\n\t\t\t\tvar startZeros = generateZeros(result.slice(0, index));\n\t\t\t\tvar deltas;\n\n\t\t\t\tif (step >= 0) {\n\t\t\t\t\tdeltas = startZeros.concat([step]);\n\t\t\t\t} else {\n\t\t\t\t\tvar size = Math.max(min, result[index] + step);\n\t\t\t\t\tdeltas = startZeros.concat([size - result[index]]);\n\t\t\t\t}\n\n\t\t\t\treturn deltas;\n\n\t\t\t}\n\n\t\t\tvar deltas;\n\n\t\t\tif (sizes.length === 0) { // No Columns\n\t\t\t\tdeltas = [];\n\t\t\t} else if (sizes.length === 1) { // One Column\n\t\t\t\tdeltas = onOneColumn();\n\t\t\t} else if (column === 0) { // Left Column\n\t\t\t\tdeltas = onLeftOrMiddle(0, 1);\n\t\t\t} else if (column > 0 && column < sizes.length - 1) { // Middle Column\n\t\t\t\tdeltas = onLeftOrMiddle(column, column + 1);\n\t\t\t} else if (column === sizes.length - 1) { // Right Column\n\t\t\t\tdeltas = onRight(column - 1, column);\n\t\t\t} else {\n\t\t\t\tdeltas = [];\n\t\t\t}\n\n\t\t\treturn deltas;\n\t\t}\n\n\t\tfunction total(start, end, measures) {\n\t\t\tvar r = 0;\n\t\t\tfor (var i = start; i < end; i++) {\n\t\t\t\tr += measures[i];\n\t\t\t}\n\t\t\treturn r;\n\t\t}\n\n\t\t// Combine cell's css widths to determine widths of colspan'd cells.\n\t\tfunction recalculateWidths(tableGrid, widths) {\n\t\t\tvar allCells = tableGrid.getAllCells();\n\t\t\treturn Tools.map(allCells, function(cell) {\n\t\t\t\tvar width = total(cell.colIndex, cell.colIndex + cell.colspan, widths);\n\t\t\t\treturn {\n\t\t\t\t\telement: cell.element,\n\t\t\t\t\twidth: width,\n\t\t\t\t\tcolspan: cell.colspan\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\t// Combine cell's css heights to determine heights of rowspan'd cells.\n\t\tfunction recalculateCellHeights(tableGrid, heights) {\n\t\t\tvar allCells = tableGrid.getAllCells();\n\t\t\treturn Tools.map(allCells, function(cell) {\n\t\t\t\tvar height = total(cell.rowIndex, cell.rowIndex + cell.rowspan, heights);\n\t\t\t\treturn {\n\t\t\t\t\telement: cell.element,\n\t\t\t\t\theight: height,\n\t\t\t\t\trowspan: cell.rowspan\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\t// Calculate row heights.\n\t\tfunction recalculateRowHeights(tableGrid, heights) {\n\t\t\tvar allRows = tableGrid.getAllRows();\n\t\t\treturn Tools.map(allRows, function(row, i) {\n\t\t\t\treturn {\n\t\t\t\t\telement: row.element,\n\t\t\t\t\theight: heights[i]\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tfunction isPercentageBasedSize(size) {\n\t\t\treturn percentageBasedSizeRegex.test(size);\n\t\t}\n\n\t\tfunction isPixelBasedSize(size) {\n\t\t\treturn pixelBasedSizeRegex.test(size);\n\t\t}\n\n\t\t// Adjust the width of the column of table at index, with delta.\n\t\tfunction adjustWidth(table, delta, index) {\n\t\t\tvar tableDetails = getTableDetails(table);\n\t\t\tvar tableGrid = getTableGrid(tableDetails);\n\n\t\t\tfunction setSizes(newSizes, styleExtension) {\n\t\t\t\tTools.each(newSizes, function(cell) {\n\t\t\t\t\teditor.dom.setStyle(cell.element, 'width', cell.width + styleExtension);\n\t\t\t\t\teditor.dom.setAttrib(cell.element, 'width', null);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction getNewTablePercentWidth() {\n\t\t\t\treturn index < tableGrid.grid.maxCols - 1 ? getCurrentTablePercentWidth(table) :\n\t\t\t\t\tgetCurrentTablePercentWidth(table) + getTablePercentDelta(table, delta);\n\t\t\t}\n\n\t\t\tfunction getNewTablePixelWidth() {\n\t\t\t\treturn index < tableGrid.grid.maxCols - 1 ? getComputedStyleSize(table, 'width') :\n\t\t\t\t\tgetComputedStyleSize(table, 'width') + delta;\n\t\t\t}\n\n\t\t\tfunction setTableSize(newTableWidth, styleExtension, isPercentBased) {\n\t\t\t\tif (index == tableGrid.grid.maxCols - 1 || !isPercentBased) {\n\t\t\t\t\teditor.dom.setStyle(table, 'width', newTableWidth + styleExtension);\n\t\t\t\t\teditor.dom.setAttrib(table, 'width', null);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar percentageBased = isPercentageBasedSize(table.width) ||\n\t\t\t\tisPercentageBasedSize(table.style.width);\n\n\t\t\tvar widths = getWidths(tableGrid, percentageBased, table);\n\n\t\t\tvar step = percentageBased ? getCellPercentDelta(table, delta) : delta;\n\t\t\t// TODO: change the min for percentage maybe?\n\t\t\tvar deltas = determineDeltas(widths, index, step, RESIZE_MINIMUM_WIDTH, percentageBased, table);\n\t\t\tvar newWidths = [];\n\n\t\t\tfor (var i = 0; i < deltas.length; i++) {\n\t\t\t\tnewWidths.push(deltas[i] + widths[i]);\n\t\t\t}\n\n\t\t\tvar newSizes = recalculateWidths(tableGrid, newWidths);\n\t\t\tvar styleExtension = percentageBased ? '%' : 'px';\n\t\t\tvar newTableWidth = percentageBased ? getNewTablePercentWidth() :\n\t\t\t\tgetNewTablePixelWidth();\n\n\t\t\teditor.undoManager.transact(function() {\n\t\t\t\tsetSizes(newSizes, styleExtension);\n\t\t\t\tsetTableSize(newTableWidth, styleExtension, percentageBased);\n\t\t\t});\n\t\t}\n\n\t\t// Adjust the height of the row of table at index, with delta.\n\t\tfunction adjustHeight(table, delta, index) {\n\t\t\tvar tableDetails = getTableDetails(table);\n\t\t\tvar tableGrid = getTableGrid(tableDetails);\n\n\t\t\tvar heights = getPixelHeights(tableGrid);\n\n\t\t\tvar newHeights = [], newTotalHeight = 0;\n\n\t\t\tfor (var i = 0; i < heights.length; i++) {\n\t\t\t\tnewHeights.push(i === index ? delta + heights[i] : heights[i]);\n\t\t\t\tnewTotalHeight += newTotalHeight[i];\n\t\t\t}\n\n\t\t\tvar newCellSizes = recalculateCellHeights(tableGrid, newHeights);\n\t\t\tvar newRowSizes = recalculateRowHeights(tableGrid, newHeights);\n\n\t\t\teditor.undoManager.transact(function() {\n\n\t\t\t\tTools.each(newRowSizes, function(row) {\n\t\t\t\t\teditor.dom.setStyle(row.element, 'height', row.height + 'px');\n\t\t\t\t\teditor.dom.setAttrib(row.element, 'height', null);\n\t\t\t\t});\n\n\t\t\t\tTools.each(newCellSizes, function(cell) {\n\t\t\t\t\teditor.dom.setStyle(cell.element, 'height', cell.height + 'px');\n\t\t\t\t\teditor.dom.setAttrib(cell.element, 'height', null);\n\t\t\t\t});\n\n\t\t\t\teditor.dom.setStyle(table, 'height', newTotalHeight + 'px');\n\t\t\t\teditor.dom.setAttrib(table, 'height', null);\n\t\t\t});\n\t\t}\n\n\t\tfunction scheduleDelayedDropEvent() {\n\t\t\tdelayDrop = setTimeout(function() {\n\t\t\t\tdrop();\n\t\t\t}, 200);\n\t\t}\n\n\t\tfunction cancelDelayedDropEvent() {\n\t\t\tclearTimeout(delayDrop);\n\t\t}\n\n\t\tfunction getBlockerElement() {\n\t\t\tvar blocker = document.createElement('div');\n\n\t\t\tblocker.setAttribute('style', 'margin: 0; ' +\n\t\t\t\t\t\t'padding: 0; ' +\n\t\t\t\t\t\t'position: fixed; ' +\n\t\t\t\t\t\t'left: 0px; ' +\n\t\t\t\t\t\t'top: 0px; ' +\n\t\t\t\t\t\t'height: 100%; ' +\n\t\t\t\t\t\t'width: 100%;');\n\t\t\tblocker.setAttribute('data-mce-bogus', 'all');\n\n\t\t\treturn blocker;\n\t\t}\n\n\t\tfunction bindBlockerEvents(blocker, dragHandler) {\n\t\t\teditor.dom.bind(blocker, 'mouseup', function() {\n\t\t\t\tdrop();\n\t\t\t});\n\n\t\t\teditor.dom.bind(blocker, 'mousemove', function(e) {\n\t\t\t\tcancelDelayedDropEvent();\n\n\t\t\t\tif (dragging) {\n\t\t\t\t\tdragHandler(e);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.dom.bind(blocker, 'mouseout', function() {\n\t\t\t\tscheduleDelayedDropEvent();\n\t\t\t});\n\n\t\t}\n\n\t\tfunction drop() {\n\t\t\teditor.dom.remove(blockerElement);\n\n\t\t\tif (dragging) {\n\t\t\t\teditor.dom.removeClass(dragBar, RESIZE_BAR_DRAGGING_CLASS);\n\t\t\t\tdragging = false;\n\n\t\t\t\tvar index, delta;\n\n\t\t\t\tif (isCol(dragBar)) {\n\t\t\t\t\tvar initialLeft = parseInt(editor.dom.getAttrib(dragBar, RESIZE_BAR_COL_DATA_INITIAL_LEFT_ATTRIBUTE), 10);\n\t\t\t\t\tvar newLeft = editor.dom.getPos(dragBar).x;\n\t\t\t\t\tindex = parseInt(editor.dom.getAttrib(dragBar, RESIZE_BAR_COL_DATA_ATTRIBUTE), 10);\n\t\t\t\t\tdelta = isRtl() ? initialLeft - newLeft : newLeft - initialLeft;\n\t\t\t\t\tadjustWidth(hoverTable, delta, index);\n\t\t\t\t} else if (isRow(dragBar)) {\n\t\t\t\t\tvar initialTop = parseInt(editor.dom.getAttrib(dragBar, RESIZE_BAR_ROW_DATA_INITIAL_TOP_ATTRIBUTE), 10);\n\t\t\t\t\tvar newTop = editor.dom.getPos(dragBar).y;\n\t\t\t\t\tindex = parseInt(editor.dom.getAttrib(dragBar, RESIZE_BAR_ROW_DATA_ATTRIBUTE), 10);\n\t\t\t\t\tdelta = newTop - initialTop;\n\t\t\t\t\tadjustHeight(hoverTable, delta, index);\n\t\t\t\t}\n\t\t\t\trefreshBars(hoverTable);\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\t\t}\n\n\t\tfunction setupBaseDrag(bar, dragHandler) {\n\t\t\tblockerElement = blockerElement ? blockerElement : getBlockerElement();\n\t\t\tdragging = true;\n\t\t\teditor.dom.addClass(bar, RESIZE_BAR_DRAGGING_CLASS);\n\t\t\tdragBar = bar;\n\t\t\tbindBlockerEvents(blockerElement, dragHandler);\n\t\t\teditor.dom.add(getBody(), blockerElement);\n\t\t}\n\n\t\tfunction isCol(target) {\n\t\t\treturn editor.dom.hasClass(target, RESIZE_BAR_COL_CLASS);\n\t\t}\n\n\t\tfunction isRow(target) {\n\t\t\treturn editor.dom.hasClass(target, RESIZE_BAR_ROW_CLASS);\n\t\t}\n\n\t\tfunction colDragHandler(event) {\n\t\t\tlastX = lastX !== undefined ? lastX : event.clientX; // we need a firstX\n\t\t\tvar deltaX = event.clientX - lastX;\n\t\t\tlastX = event.clientX;\n\t\t\tvar oldLeft = editor.dom.getPos(dragBar).x;\n\t\t\teditor.dom.setStyle(dragBar, 'left', oldLeft + deltaX + 'px');\n\t\t}\n\n\t\tfunction rowDragHandler(event) {\n\t\t\tlastY = lastY !== undefined ? lastY : event.clientY;\n\t\t\tvar deltaY = event.clientY - lastY;\n\t\t\tlastY = event.clientY;\n\t\t\tvar oldTop = editor.dom.getPos(dragBar).y;\n\t\t\teditor.dom.setStyle(dragBar, 'top', oldTop + deltaY + 'px');\n\t\t}\n\n\t\tfunction setupColDrag(bar) {\n\t\t\tlastX = undefined;\n\t\t\tsetupBaseDrag(bar, colDragHandler);\n\t\t}\n\n\t\tfunction setupRowDrag(bar) {\n\t\t\tlastY = undefined;\n\t\t\tsetupBaseDrag(bar, rowDragHandler);\n\t\t}\n\n\t\tfunction mouseDownHandler(e) {\n\t\t\tvar target = e.target, body = editor.getBody();\n\n\t\t\t// Since this code is working on global events we need to work on a global hoverTable state\n\t\t\t// and make sure that the state is correct according to the events fired\n\t\t\tif (!editor.$.contains(body, hoverTable) && hoverTable !== body) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (isCol(target)) {\n\t\t\t\te.preventDefault();\n\t\t\t\tvar initialLeft = editor.dom.getPos(target).x;\n\t\t\t\teditor.dom.setAttrib(target, RESIZE_BAR_COL_DATA_INITIAL_LEFT_ATTRIBUTE, initialLeft);\n\t\t\t\tsetupColDrag(target);\n\t\t\t} else if (isRow(target)) {\n\t\t\t\te.preventDefault();\n\t\t\t\tvar initialTop = editor.dom.getPos(target).y;\n\t\t\t\teditor.dom.setAttrib(target, RESIZE_BAR_ROW_DATA_INITIAL_TOP_ATTRIBUTE, initialTop);\n\t\t\t\tsetupRowDrag(target);\n\t\t\t} else {\n\t\t\t\tclearBars();\n\t\t\t}\n\t\t}\n\n\t\teditor.on('init', function() {\n\t\t\t// Needs to be like this for inline mode, editor.on does not bind to elements in the document body otherwise\n\t\t\teditor.dom.bind(getBody(), 'mousedown', mouseDownHandler);\n\t\t});\n\n\t\t// If we're updating the table width via the old mechanic, we need to update the constituent cells' widths/heights too.\n\t\teditor.on('ObjectResized', function(e) {\n\t\t\tvar table = e.target;\n\t\t\tif (table.nodeName === 'TABLE') {\n\t\t\t\tvar newCellSizes = [];\n\t\t\t\tTools.each(table.rows, function(row) {\n\t\t\t\t\tTools.each(row.cells, function(cell) {\n\t\t\t\t\t\tvar width = editor.dom.getStyle(cell, 'width', true);\n\t\t\t\t\t\tnewCellSizes.push({\n\t\t\t\t\t\t\tcell: cell,\n\t\t\t\t\t\t\twidth: width\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tTools.each(newCellSizes, function(newCellSize) {\n\t\t\t\t\teditor.dom.setStyle(newCellSize.cell, 'width', newCellSize.width);\n\t\t\t\t\teditor.dom.setAttrib(newCellSize.cell, 'width', null);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\teditor.on('mouseover', function(e) {\n\t\t\tif (!dragging) {\n\t\t\t\tvar tableElement = editor.dom.getParent(e.target, 'table');\n\n\t\t\t\tif (e.target.nodeName === 'TABLE' || tableElement) {\n\t\t\t\t\thoverTable = tableElement;\n\t\t\t\t\trefreshBars(tableElement);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Prevents the user from moving the caret inside the resize bars on Chrome\n\t\t// Only does it on arrow keys since clearBars might be an epxensive operation\n\t\t// since it's querying the DOM\n\t\teditor.on('keydown', function(e) {\n\t\t\tswitch (e.keyCode) {\n\t\t\t\tcase VK.LEFT:\n\t\t\t\tcase VK.RIGHT:\n\t\t\t\tcase VK.UP:\n\t\t\t\tcase VK.DOWN:\n\t\t\t\t\tclearBars();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\teditor.on('remove', function() {\n\t\t\tclearBars();\n\t\t\teditor.dom.unbind(getBody(), 'mousedown', mouseDownHandler);\n\t\t});\n\n\t\treturn {\n\t\t\tadjustWidth: adjustWidth,\n\t\t\tadjustHeight: adjustHeight,\n\t\t\tclearBars: clearBars,\n\t\t\tdrawBars: drawBars,\n\t\t\tdetermineDeltas: determineDeltas,\n\t\t\tgetTableGrid: getTableGrid,\n\t\t\tgetTableDetails: getTableDetails,\n\t\t\tgetWidths: getWidths,\n\t\t\tgetPixelHeights: getPixelHeights,\n\t\t\tisPercentageBasedSize: isPercentageBasedSize,\n\t\t\tisPixelBasedSize: isPixelBasedSize,\n\t\t\trecalculateWidths: recalculateWidths,\n\t\t\trecalculateCellHeights: recalculateCellHeights,\n\t\t\trecalculateRowHeights: recalculateRowHeights\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/plugins/table/classes/Plugin.js\n\n/**\n * Plugin.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains all core logic for the table plugin.\n *\n * @class tinymce.tableplugin.Plugin\n * @private\n */\ndefine(\"tinymce/tableplugin/Plugin\", [\n\t\"tinymce/tableplugin/TableGrid\",\n\t\"tinymce/tableplugin/Quirks\",\n\t\"tinymce/tableplugin/CellSelection\",\n\t\"tinymce/tableplugin/Dialogs\",\n\t\"tinymce/tableplugin/ResizeBars\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/Env\",\n\t\"tinymce/PluginManager\"\n], function(TableGrid, Quirks, CellSelection, Dialogs, ResizeBars, Tools, TreeWalker, Env, PluginManager) {\n\tvar each = Tools.each;\n\n\tfunction Plugin(editor) {\n\t\tvar clipboardRows, self = this, dialogs = new Dialogs(editor), resizeBars;\n\n\t\tif (editor.settings.object_resizing && editor.settings.table_resize_bars !== false &&\n\t\t\t(editor.settings.object_resizing === true || editor.settings.object_resizing === 'table')) {\n\t\t\tresizeBars = ResizeBars(editor);\n\t\t}\n\n\t\tfunction cmd(command) {\n\t\t\treturn function() {\n\t\t\t\teditor.execCommand(command);\n\t\t\t};\n\t\t}\n\n\t\tfunction insertTable(cols, rows) {\n\t\t\tvar y, x, html, tableElm;\n\n\t\t\thtml = '<table id=\"__mce\"><tbody>';\n\n\t\t\tfor (y = 0; y < rows; y++) {\n\t\t\t\thtml += '<tr>';\n\n\t\t\t\tfor (x = 0; x < cols; x++) {\n\t\t\t\t\thtml += '<td>' + (Env.ie && Env.ie < 10 ? '&nbsp;' : '<br>') + '</td>';\n\t\t\t\t}\n\n\t\t\t\thtml += '</tr>';\n\t\t\t}\n\n\t\t\thtml += '</tbody></table>';\n\n\t\t\teditor.undoManager.transact(function() {\n\t\t\t\teditor.insertContent(html);\n\n\t\t\t\ttableElm = editor.dom.get('__mce');\n\t\t\t\teditor.dom.setAttrib(tableElm, 'id', null);\n\n\t\t\t\teditor.$('tr', tableElm).each(function(index, row) {\n\t\t\t\t\teditor.fire('newrow', {\n\t\t\t\t\t\tnode: row\n\t\t\t\t\t});\n\n\t\t\t\t\teditor.$('th,td', row).each(function(index, cell) {\n\t\t\t\t\t\teditor.fire('newcell', {\n\t\t\t\t\t\t\tnode: cell\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\teditor.dom.setAttribs(tableElm, editor.settings.table_default_attributes || {});\n\t\t\t\teditor.dom.setStyles(tableElm, editor.settings.table_default_styles || {});\n\t\t\t});\n\n\t\t\treturn tableElm;\n\t\t}\n\n\t\tfunction handleDisabledState(ctrl, selector, sameParts) {\n\t\t\tfunction bindStateListener() {\n\t\t\t\tvar selectedElm, selectedCells, parts = {}, sum = 0, state;\n\n\t\t\t\tselectedCells = editor.dom.select('td[data-mce-selected],th[data-mce-selected]');\n\t\t\t\tselectedElm = selectedCells[0];\n\t\t\t\tif (!selectedElm) {\n\t\t\t\t\tselectedElm = editor.selection.getStart();\n\t\t\t\t}\n\n\t\t\t\t// Make sure that we don't have a selection inside thead and tbody at the same time\n\t\t\t\tif (sameParts && selectedCells.length > 0) {\n\t\t\t\t\teach(selectedCells, function(cell) {\n\t\t\t\t\t\treturn parts[cell.parentNode.parentNode.nodeName] = 1;\n\t\t\t\t\t});\n\n\t\t\t\t\teach(parts, function(value) {\n\t\t\t\t\t\tsum += value;\n\t\t\t\t\t});\n\n\t\t\t\t\tstate = sum !== 1;\n\t\t\t\t} else {\n\t\t\t\t\tstate = !editor.dom.getParent(selectedElm, selector);\n\t\t\t\t}\n\n\t\t\t\tctrl.disabled(state);\n\n\t\t\t\teditor.selection.selectorChanged(selector, function(state) {\n\t\t\t\t\tctrl.disabled(!state);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (editor.initialized) {\n\t\t\t\tbindStateListener();\n\t\t\t} else {\n\t\t\t\teditor.on('init', bindStateListener);\n\t\t\t}\n\t\t}\n\n\t\tfunction postRender() {\n\t\t\t/*jshint validthis:true*/\n\t\t\thandleDisabledState(this, 'table');\n\t\t}\n\n\t\tfunction postRenderCell() {\n\t\t\t/*jshint validthis:true*/\n\t\t\thandleDisabledState(this, 'td,th');\n\t\t}\n\n\t\tfunction postRenderMergeCell() {\n\t\t\t/*jshint validthis:true*/\n\t\t\thandleDisabledState(this, 'td,th', true);\n\t\t}\n\n\t\tfunction generateTableGrid() {\n\t\t\tvar html = '';\n\n\t\t\thtml = '<table role=\"grid\" class=\"mce-grid mce-grid-border\" aria-readonly=\"true\">';\n\n\t\t\tfor (var y = 0; y < 10; y++) {\n\t\t\t\thtml += '<tr>';\n\n\t\t\t\tfor (var x = 0; x < 10; x++) {\n\t\t\t\t\thtml += '<td role=\"gridcell\" tabindex=\"-1\"><a id=\"mcegrid' + (y * 10 + x) + '\" href=\"#\" ' +\n\t\t\t\t\t\t'data-mce-x=\"' + x + '\" data-mce-y=\"' + y + '\"></a></td>';\n\t\t\t\t}\n\n\t\t\t\thtml += '</tr>';\n\t\t\t}\n\n\t\t\thtml += '</table>';\n\n\t\t\thtml += '<div class=\"mce-text-center\" role=\"presentation\">1 x 1</div>';\n\n\t\t\treturn html;\n\t\t}\n\n\t\tfunction selectGrid(tx, ty, control) {\n\t\t\tvar table = control.getEl().getElementsByTagName('table')[0];\n\t\t\tvar x, y, focusCell, cell, active;\n\t\t\tvar rtl = control.isRtl() || control.parent().rel == 'tl-tr';\n\n\t\t\ttable.nextSibling.innerHTML = (tx + 1) + ' x ' + (ty + 1);\n\n\t\t\tif (rtl) {\n\t\t\t\ttx = 9 - tx;\n\t\t\t}\n\n\t\t\tfor (y = 0; y < 10; y++) {\n\t\t\t\tfor (x = 0; x < 10; x++) {\n\t\t\t\t\tcell = table.rows[y].childNodes[x].firstChild;\n\t\t\t\t\tactive = (rtl ? x >= tx : x <= tx) && y <= ty;\n\n\t\t\t\t\teditor.dom.toggleClass(cell, 'mce-active', active);\n\n\t\t\t\t\tif (active) {\n\t\t\t\t\t\tfocusCell = cell;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn focusCell.parentNode;\n\t\t}\n\n\t\tif (editor.settings.table_grid === false) {\n\t\t\teditor.addMenuItem('inserttable', {\n\t\t\t\ttext: 'Insert table',\n\t\t\t\ticon: 'table',\n\t\t\t\tcontext: 'table',\n\t\t\t\tonclick: dialogs.table\n\t\t\t});\n\t\t} else {\n\t\t\teditor.addMenuItem('inserttable', {\n\t\t\t\ttext: 'Insert table',\n\t\t\t\ticon: 'table',\n\t\t\t\tcontext: 'table',\n\t\t\t\tariaHideMenu: true,\n\t\t\t\tonclick: function(e) {\n\t\t\t\t\tif (e.aria) {\n\t\t\t\t\t\tthis.parent().hideAll();\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\tdialogs.table();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonshow: function() {\n\t\t\t\t\tselectGrid(0, 0, this.menu.items()[0]);\n\t\t\t\t},\n\t\t\t\tonhide: function() {\n\t\t\t\t\tvar elements = this.menu.items()[0].getEl().getElementsByTagName('a');\n\t\t\t\t\teditor.dom.removeClass(elements, 'mce-active');\n\t\t\t\t\teditor.dom.addClass(elements[0], 'mce-active');\n\t\t\t\t},\n\t\t\t\tmenu: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'container',\n\t\t\t\t\t\thtml: generateTableGrid(),\n\n\t\t\t\t\t\tonPostRender: function() {\n\t\t\t\t\t\t\tthis.lastX = this.lastY = 0;\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\tonmousemove: function(e) {\n\t\t\t\t\t\t\tvar target = e.target, x, y;\n\n\t\t\t\t\t\t\tif (target.tagName.toUpperCase() == 'A') {\n\t\t\t\t\t\t\t\tx = parseInt(target.getAttribute('data-mce-x'), 10);\n\t\t\t\t\t\t\t\ty = parseInt(target.getAttribute('data-mce-y'), 10);\n\n\t\t\t\t\t\t\t\tif (this.isRtl() || this.parent().rel == 'tl-tr') {\n\t\t\t\t\t\t\t\t\tx = 9 - x;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (x !== this.lastX || y !== this.lastY) {\n\t\t\t\t\t\t\t\t\tselectGrid(x, y, e.control);\n\n\t\t\t\t\t\t\t\t\tthis.lastX = x;\n\t\t\t\t\t\t\t\t\tthis.lastY = y;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\tonclick: function(e) {\n\t\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\t\tif (e.target.tagName.toUpperCase() == 'A') {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\tself.parent().cancel();\n\n\t\t\t\t\t\t\t\teditor.undoManager.transact(function() {\n\t\t\t\t\t\t\t\t\tinsertTable(self.lastX + 1, self.lastY + 1);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\teditor.addVisual();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\n\t\teditor.addMenuItem('tableprops', {\n\t\t\ttext: 'Table properties',\n\t\t\tcontext: 'table',\n\t\t\tonPostRender: postRender,\n\t\t\tonclick: dialogs.tableProps\n\t\t});\n\n\t\teditor.addMenuItem('deletetable', {\n\t\t\ttext: 'Delete table',\n\t\t\tcontext: 'table',\n\t\t\tonPostRender: postRender,\n\t\t\tcmd: 'mceTableDelete'\n\t\t});\n\n\t\teditor.addMenuItem('cell', {\n\t\t\tseparator: 'before',\n\t\t\ttext: 'Cell',\n\t\t\tcontext: 'table',\n\t\t\tmenu: [\n\t\t\t\t{text: 'Cell properties', onclick: cmd('mceTableCellProps'), onPostRender: postRenderCell},\n\t\t\t\t{text: 'Merge cells', onclick: cmd('mceTableMergeCells'), onPostRender: postRenderMergeCell},\n\t\t\t\t{text: 'Split cell', onclick: cmd('mceTableSplitCells'), onPostRender: postRenderCell}\n\t\t\t]\n\t\t});\n\n\t\teditor.addMenuItem('row', {\n\t\t\ttext: 'Row',\n\t\t\tcontext: 'table',\n\t\t\tmenu: [\n\t\t\t\t{text: 'Insert row before', onclick: cmd('mceTableInsertRowBefore'), onPostRender: postRenderCell},\n\t\t\t\t{text: 'Insert row after', onclick: cmd('mceTableInsertRowAfter'), onPostRender: postRenderCell},\n\t\t\t\t{text: 'Delete row', onclick: cmd('mceTableDeleteRow'), onPostRender: postRenderCell},\n\t\t\t\t{text: 'Row properties', onclick: cmd('mceTableRowProps'), onPostRender: postRenderCell},\n\t\t\t\t{text: '-'},\n\t\t\t\t{text: 'Cut row', onclick: cmd('mceTableCutRow'), onPostRender: postRenderCell},\n\t\t\t\t{text: 'Copy row', onclick: cmd('mceTableCopyRow'), onPostRender: postRenderCell},\n\t\t\t\t{text: 'Paste row before', onclick: cmd('mceTablePasteRowBefore'), onPostRender: postRenderCell},\n\t\t\t\t{text: 'Paste row after', onclick: cmd('mceTablePasteRowAfter'), onPostRender: postRenderCell}\n\t\t\t]\n\t\t});\n\n\t\teditor.addMenuItem('column', {\n\t\t\ttext: 'Column',\n\t\t\tcontext: 'table',\n\t\t\tmenu: [\n\t\t\t\t{text: 'Insert column before', onclick: cmd('mceTableInsertColBefore'), onPostRender: postRenderCell},\n\t\t\t\t{text: 'Insert column after', onclick: cmd('mceTableInsertColAfter'), onPostRender: postRenderCell},\n\t\t\t\t{text: 'Delete column', onclick: cmd('mceTableDeleteCol'), onPostRender: postRenderCell}\n\t\t\t]\n\t\t});\n\n\t\tvar menuItems = [];\n\t\teach(\"inserttable tableprops deletetable | cell row column\".split(' '), function(name) {\n\t\t\tif (name == '|') {\n\t\t\t\tmenuItems.push({text: '-'});\n\t\t\t} else {\n\t\t\t\tmenuItems.push(editor.menuItems[name]);\n\t\t\t}\n\t\t});\n\n\t\teditor.addButton(\"table\", {\n\t\t\ttype: \"menubutton\",\n\t\t\ttitle: \"Table\",\n\t\t\tmenu: menuItems\n\t\t});\n\n\t\t// Select whole table is a table border is clicked\n\t\tif (!Env.isIE) {\n\t\t\teditor.on('click', function(e) {\n\t\t\t\te = e.target;\n\n\t\t\t\tif (e.nodeName === 'TABLE') {\n\t\t\t\t\teditor.selection.select(e);\n\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tself.quirks = new Quirks(editor);\n\n\t\teditor.on('Init', function() {\n\t\t\tself.cellSelection = new CellSelection(editor, function (selecting) {\n\t\t\t\tif (selecting) {\n\t\t\t\t\tresizeBars.clearBars();\n\t\t\t\t}\n\t\t\t});\n\t\t\tself.resizeBars = resizeBars;\n\t\t});\n\n\t\teditor.on('PreInit', function() {\n\t\t\t// Remove internal data attributes\n\t\t\teditor.serializer.addAttributeFilter(\n\t\t\t\t'data-mce-cell-padding,data-mce-border,data-mce-border-color',\n\t\t\t\tfunction(nodes, name) {\n\n\t\t\t\t\tvar i = nodes.length;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnodes[i].attr(name, null);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\n\t\t// Register action commands\n\t\teach({\n\t\t\tmceTableSplitCells: function(grid) {\n\t\t\t\tgrid.split();\n\t\t\t},\n\n\t\t\tmceTableMergeCells: function(grid) {\n\t\t\t\tvar cell;\n\n\t\t\t\tcell = editor.dom.getParent(editor.selection.getStart(), 'th,td');\n\n\t\t\t\tif (!editor.dom.select('td[data-mce-selected],th[data-mce-selected]').length) {\n\t\t\t\t\tdialogs.merge(grid, cell);\n\t\t\t\t} else {\n\t\t\t\t\tgrid.merge();\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tmceTableInsertRowBefore: function(grid) {\n\t\t\t\tgrid.insertRow(true);\n\t\t\t},\n\n\t\t\tmceTableInsertRowAfter: function(grid) {\n\t\t\t\tgrid.insertRow();\n\t\t\t},\n\n\t\t\tmceTableInsertColBefore: function(grid) {\n\t\t\t\tgrid.insertCol(true);\n\t\t\t},\n\n\t\t\tmceTableInsertColAfter: function(grid) {\n\t\t\t\tgrid.insertCol();\n\t\t\t},\n\n\t\t\tmceTableDeleteCol: function(grid) {\n\t\t\t\tgrid.deleteCols();\n\t\t\t},\n\n\t\t\tmceTableDeleteRow: function(grid) {\n\t\t\t\tgrid.deleteRows();\n\t\t\t},\n\n\t\t\tmceTableCutRow: function(grid) {\n\t\t\t\tclipboardRows = grid.cutRows();\n\t\t\t},\n\n\t\t\tmceTableCopyRow: function(grid) {\n\t\t\t\tclipboardRows = grid.copyRows();\n\t\t\t},\n\n\t\t\tmceTablePasteRowBefore: function(grid) {\n\t\t\t\tgrid.pasteRows(clipboardRows, true);\n\t\t\t},\n\n\t\t\tmceTablePasteRowAfter: function(grid) {\n\t\t\t\tgrid.pasteRows(clipboardRows);\n\t\t\t},\n\n\t\t\tmceSplitColsBefore: function(grid) {\n\t\t\t\tgrid.splitCols(true);\n\t\t\t},\n\n\t\t\tmceSplitColsAfter: function(grid) {\n\t\t\t\tgrid.splitCols(false);\n\t\t\t},\n\n\t\t\tmceTableDelete: function(grid) {\n\t\t\t\tif (resizeBars) {\n\t\t\t\t\tresizeBars.clearBars();\n\t\t\t\t}\n\t\t\t\tgrid.deleteTable();\n\t\t\t}\n\t\t}, function(func, name) {\n\t\t\teditor.addCommand(name, function() {\n\t\t\t\tvar grid = new TableGrid(editor);\n\n\t\t\t\tif (grid) {\n\t\t\t\t\tfunc(grid);\n\t\t\t\t\teditor.execCommand('mceRepaint');\n\t\t\t\t\tself.cellSelection.clear();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// Register dialog commands\n\t\teach({\n\t\t\tmceInsertTable: dialogs.table,\n\t\t\tmceTableProps: function() {\n\t\t\t\tdialogs.table(true);\n\t\t\t},\n\t\t\tmceTableRowProps: dialogs.row,\n\t\t\tmceTableCellProps: dialogs.cell\n\t\t}, function(func, name) {\n\t\t\teditor.addCommand(name, function(ui, val) {\n\t\t\t\tfunc(val);\n\t\t\t});\n\t\t});\n\n\t\tfunction addButtons() {\n\t\t\teditor.addButton('tableprops', {\n\t\t\t\ttitle: 'Table properties',\n\t\t\t\tonclick: dialogs.tableProps,\n\t\t\t\ticon: 'table'\n\t\t\t});\n\n\t\t\teditor.addButton('tabledelete', {\n\t\t\t\ttitle: 'Delete table',\n\t\t\t\tonclick: cmd('mceTableDelete')\n\t\t\t});\n\n\t\t\teditor.addButton('tablecellprops', {\n\t\t\t\ttitle: 'Cell properties',\n\t\t\t\tonclick: cmd('mceTableCellProps')\n\t\t\t});\n\n\t\t\teditor.addButton('tablemergecells', {\n\t\t\t\ttitle: 'Merge cells',\n\t\t\t\tonclick: cmd('mceTableMergeCells')\n\t\t\t});\n\n\t\t\teditor.addButton('tablesplitcells', {\n\t\t\t\ttitle: 'Split cell',\n\t\t\t\tonclick: cmd('mceTableSplitCells')\n\t\t\t});\n\n\t\t\teditor.addButton('tableinsertrowbefore', {\n\t\t\t\ttitle: 'Insert row before',\n\t\t\t\tonclick: cmd('mceTableInsertRowBefore')\n\t\t\t});\n\n\t\t\teditor.addButton('tableinsertrowafter', {\n\t\t\t\ttitle: 'Insert row after',\n\t\t\t\tonclick: cmd('mceTableInsertRowAfter')\n\t\t\t});\n\n\t\t\teditor.addButton('tabledeleterow', {\n\t\t\t\ttitle: 'Delete row',\n\t\t\t\tonclick: cmd('mceTableDeleteRow')\n\t\t\t});\n\n\t\t\teditor.addButton('tablerowprops', {\n\t\t\t\ttitle: 'Row properties',\n\t\t\t\tonclick: cmd('mceTableRowProps')\n\t\t\t});\n\n\t\t\teditor.addButton('tablecutrow', {\n\t\t\t\ttitle: 'Cut row',\n\t\t\t\tonclick: cmd('mceTableCutRow')\n\t\t\t});\n\n\t\t\teditor.addButton('tablecopyrow', {\n\t\t\t\ttitle: 'Copy row',\n\t\t\t\tonclick: cmd('mceTableCopyRow')\n\t\t\t});\n\n\t\t\teditor.addButton('tablepasterowbefore', {\n\t\t\t\ttitle: 'Paste row before',\n\t\t\t\tonclick: cmd('mceTablePasteRowBefore')\n\t\t\t});\n\n\t\t\teditor.addButton('tablepasterowafter', {\n\t\t\t\ttitle: 'Paste row after',\n\t\t\t\tonclick: cmd('mceTablePasteRowAfter')\n\t\t\t});\n\n\t\t\teditor.addButton('tableinsertcolbefore', {\n\t\t\t\ttitle: 'Insert column before',\n\t\t\t\tonclick: cmd('mceTableInsertColBefore')\n\t\t\t});\n\n\t\t\teditor.addButton('tableinsertcolafter', {\n\t\t\t\ttitle: 'Insert column after',\n\t\t\t\tonclick: cmd('mceTableInsertColAfter')\n\t\t\t});\n\n\t\t\teditor.addButton('tabledeletecol', {\n\t\t\t\ttitle: 'Delete column',\n\t\t\t\tonclick: cmd('mceTableDeleteCol')\n\t\t\t});\n\n\t\t}\n\n\t\tfunction isTable(table) {\n\n\t\t\tvar selectorMatched = editor.dom.is(table, 'table') && editor.getBody().contains(table);\n\n\t\t\treturn selectorMatched;\n\t\t}\n\n\t\tfunction addToolbars() {\n\t\t\tvar toolbarItems = editor.settings.table_toolbar;\n\n\t\t\tif (toolbarItems === '' || toolbarItems === false) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!toolbarItems) {\n\t\t\t\ttoolbarItems = 'tableprops tabledelete | ' +\n\t\t\t\t\t'tableinsertrowbefore tableinsertrowafter tabledeleterow | ' +\n\t\t\t\t\t'tableinsertcolbefore tableinsertcolafter tabledeletecol';\n\t\t\t}\n\n\t\t\teditor.addContextToolbar(\n\t\t\t\tisTable,\n\t\t\t\ttoolbarItems\n\t\t\t);\n\t\t}\n\n\t\tfunction getClipboardRows() {\n\t\t\treturn clipboardRows;\n\t\t}\n\n\t\tfunction setClipboardRows(rows) {\n\t\t\tclipboardRows = rows;\n\t\t}\n\n\t\taddButtons();\n\t\taddToolbars();\n\n\t\t// Enable tab key cell navigation\n\t\tif (editor.settings.table_tab_navigation !== false) {\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tvar cellElm, grid, delta;\n\n\t\t\t\tif (e.keyCode == 9) {\n\t\t\t\t\tcellElm = editor.dom.getParent(editor.selection.getStart(), 'th,td');\n\n\t\t\t\t\tif (cellElm) {\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tgrid = new TableGrid(editor);\n\t\t\t\t\t\tdelta = e.shiftKey ? -1 : 1;\n\n\t\t\t\t\t\teditor.undoManager.transact(function() {\n\t\t\t\t\t\t\tif (!grid.moveRelIdx(cellElm, delta) && delta > 0) {\n\t\t\t\t\t\t\t\tgrid.insertRow();\n\t\t\t\t\t\t\t\tgrid.refresh();\n\t\t\t\t\t\t\t\tgrid.moveRelIdx(cellElm, delta);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tself.insertTable = insertTable;\n\t\tself.setClipboardRows = setClipboardRows;\n\t\tself.getClipboardRows = getClipboardRows;\n\t}\n\n\tPluginManager.add('table', Plugin);\n});\n})(this);";
},768:function(t,n){t.exports="/**\n * theme.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*global tinymce:true */\n\ntinymce.ThemeManager.add('modern', function(editor) {\n\tvar self = this, settings = editor.settings, Factory = tinymce.ui.Factory,\n\t\teach = tinymce.each, DOM = tinymce.DOM, Rect = tinymce.geom.Rect, FloatPanel = tinymce.ui.FloatPanel;\n\n\t// Default menus\n\tvar defaultMenus = {\n\t\tfile: {title: 'File', items: 'newdocument'},\n\t\tedit: {title: 'Edit', items: 'undo redo | cut copy paste pastetext | selectall'},\n\t\tinsert: {title: 'Insert', items: '|'},\n\t\tview: {title: 'View', items: 'visualaid |'},\n\t\tformat: {title: 'Format', items: 'bold italic underline strikethrough superscript subscript | formats | removeformat'},\n\t\ttable: {title: 'Table'},\n\t\ttools: {title: 'Tools'}\n\t};\n\n\tvar defaultToolbar = \"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | \" +\n\t\t\"bullist numlist outdent indent | link image\";\n\n\tfunction createToolbar(items, size) {\n\t\tvar toolbarItems = [], buttonGroup;\n\n\t\tif (!items) {\n\t\t\treturn;\n\t\t}\n\n\t\teach(items.split(/[ ,]/), function(item) {\n\t\t\tvar itemName;\n\n\t\t\tfunction bindSelectorChanged() {\n\t\t\t\tvar selection = editor.selection;\n\n\t\t\t\tfunction setActiveItem(name) {\n\t\t\t\t\treturn function(state, args) {\n\t\t\t\t\t\tvar nodeName, i = args.parents.length;\n\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tnodeName = args.parents[i].nodeName;\n\t\t\t\t\t\t\tif (nodeName == \"OL\" || nodeName == \"UL\") {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\titem.active(state && nodeName == name);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (itemName == \"bullist\") {\n\t\t\t\t\tselection.selectorChanged('ul > li', setActiveItem(\"UL\"));\n\t\t\t\t}\n\n\t\t\t\tif (itemName == \"numlist\") {\n\t\t\t\t\tselection.selectorChanged('ol > li', setActiveItem(\"OL\"));\n\t\t\t\t}\n\n\t\t\t\tif (item.settings.stateSelector) {\n\t\t\t\t\tselection.selectorChanged(item.settings.stateSelector, function(state) {\n\t\t\t\t\t\titem.active(state);\n\t\t\t\t\t}, true);\n\t\t\t\t}\n\n\t\t\t\tif (item.settings.disabledStateSelector) {\n\t\t\t\t\tselection.selectorChanged(item.settings.disabledStateSelector, function(state) {\n\t\t\t\t\t\titem.disabled(state);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (item == \"|\") {\n\t\t\t\tbuttonGroup = null;\n\t\t\t} else {\n\t\t\t\tif (Factory.has(item)) {\n\t\t\t\t\titem = {type: item, size: size};\n\t\t\t\t\ttoolbarItems.push(item);\n\t\t\t\t\tbuttonGroup = null;\n\t\t\t\t} else {\n\t\t\t\t\tif (!buttonGroup) {\n\t\t\t\t\t\tbuttonGroup = {type: 'buttongroup', items: []};\n\t\t\t\t\t\ttoolbarItems.push(buttonGroup);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (editor.buttons[item]) {\n\t\t\t\t\t\t// TODO: Move control creation to some UI class\n\t\t\t\t\t\titemName = item;\n\t\t\t\t\t\titem = editor.buttons[itemName];\n\n\t\t\t\t\t\tif (typeof item == \"function\") {\n\t\t\t\t\t\t\titem = item();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\titem.type = item.type || 'button';\n\t\t\t\t\t\titem.size = size;\n\n\t\t\t\t\t\titem = Factory.create(item);\n\t\t\t\t\t\tbuttonGroup.items.push(item);\n\n\t\t\t\t\t\tif (editor.initialized) {\n\t\t\t\t\t\t\tbindSelectorChanged();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\teditor.on('init', bindSelectorChanged);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\ttype: 'toolbar',\n\t\t\tlayout: 'flow',\n\t\t\titems: toolbarItems\n\t\t};\n\t}\n\n\t/**\n\t * Creates the toolbars from config and returns a toolbar array.\n\t *\n\t * @param {String} size Optional toolbar item size.\n\t * @return {Array} Array with toolbars.\n\t */\n\tfunction createToolbars(size) {\n\t\tvar toolbars = [];\n\n\t\tfunction addToolbar(items) {\n\t\t\tif (items) {\n\t\t\t\ttoolbars.push(createToolbar(items, size));\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\t// Convert toolbar array to multiple options\n\t\tif (tinymce.isArray(settings.toolbar)) {\n\t\t\t// Empty toolbar array is the same as a disabled toolbar\n\t\t\tif (settings.toolbar.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttinymce.each(settings.toolbar, function(toolbar, i) {\n\t\t\t\tsettings[\"toolbar\" + (i + 1)] = toolbar;\n\t\t\t});\n\n\t\t\tdelete settings.toolbar;\n\t\t}\n\n\t\t// Generate toolbar<n>\n\t\tfor (var i = 1; i < 10; i++) {\n\t\t\tif (!addToolbar(settings[\"toolbar\" + i])) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Generate toolbar or default toolbar unless it's disabled\n\t\tif (!toolbars.length && settings.toolbar !== false) {\n\t\t\taddToolbar(settings.toolbar || defaultToolbar);\n\t\t}\n\n\t\tif (toolbars.length) {\n\t\t\treturn {\n\t\t\t\ttype: 'panel',\n\t\t\t\tlayout: 'stack',\n\t\t\t\tclasses: \"toolbar-grp\",\n\t\t\t\tariaRoot: true,\n\t\t\t\tariaRemember: true,\n\t\t\t\titems: toolbars\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Creates the menu buttons based on config.\n\t *\n\t * @return {Array} Menu buttons array.\n\t */\n\tfunction createMenuButtons() {\n\t\tvar name, menuButtons = [];\n\n\t\tfunction createMenuItem(name) {\n\t\t\tvar menuItem;\n\n\t\t\tif (name == '|') {\n\t\t\t\treturn {text: '|'};\n\t\t\t}\n\n\t\t\tmenuItem = editor.menuItems[name];\n\n\t\t\treturn menuItem;\n\t\t}\n\n\t\tfunction createMenu(context) {\n\t\t\tvar menuButton, menu, menuItems, isUserDefined, removedMenuItems;\n\n\t\t\tremovedMenuItems = tinymce.makeMap((settings.removed_menuitems || '').split(/[ ,]/));\n\n\t\t\t// User defined menu\n\t\t\tif (settings.menu) {\n\t\t\t\tmenu = settings.menu[context];\n\t\t\t\tisUserDefined = true;\n\t\t\t} else {\n\t\t\t\tmenu = defaultMenus[context];\n\t\t\t}\n\n\t\t\tif (menu) {\n\t\t\t\tmenuButton = {text: menu.title};\n\t\t\t\tmenuItems = [];\n\n\t\t\t\t// Default/user defined items\n\t\t\t\teach((menu.items || '').split(/[ ,]/), function(item) {\n\t\t\t\t\tvar menuItem = createMenuItem(item);\n\n\t\t\t\t\tif (menuItem && !removedMenuItems[item]) {\n\t\t\t\t\t\tmenuItems.push(createMenuItem(item));\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Added though context\n\t\t\t\tif (!isUserDefined) {\n\t\t\t\t\teach(editor.menuItems, function(menuItem) {\n\t\t\t\t\t\tif (menuItem.context == context) {\n\t\t\t\t\t\t\tif (menuItem.separator == 'before') {\n\t\t\t\t\t\t\t\tmenuItems.push({text: '|'});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (menuItem.prependToContext) {\n\t\t\t\t\t\t\t\tmenuItems.unshift(menuItem);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tmenuItems.push(menuItem);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (menuItem.separator == 'after') {\n\t\t\t\t\t\t\t\tmenuItems.push({text: '|'});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0; i < menuItems.length; i++) {\n\t\t\t\t\tif (menuItems[i].text == '|') {\n\t\t\t\t\t\tif (i === 0 || i == menuItems.length - 1) {\n\t\t\t\t\t\t\tmenuItems.splice(i, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tmenuButton.menu = menuItems;\n\n\t\t\t\tif (!menuButton.menu.length) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn menuButton;\n\t\t}\n\n\t\tvar defaultMenuBar = [];\n\t\tif (settings.menu) {\n\t\t\tfor (name in settings.menu) {\n\t\t\t\tdefaultMenuBar.push(name);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (name in defaultMenus) {\n\t\t\t\tdefaultMenuBar.push(name);\n\t\t\t}\n\t\t}\n\n\t\tvar enabledMenuNames = typeof settings.menubar == \"string\" ? settings.menubar.split(/[ ,]/) : defaultMenuBar;\n\t\tfor (var i = 0; i < enabledMenuNames.length; i++) {\n\t\t\tvar menu = enabledMenuNames[i];\n\t\t\tmenu = createMenu(menu);\n\n\t\t\tif (menu) {\n\t\t\t\tmenuButtons.push(menu);\n\t\t\t}\n\t\t}\n\n\t\treturn menuButtons;\n\t}\n\n\t/**\n\t * Adds accessibility shortcut keys to panel.\n\t *\n\t * @param {tinymce.ui.Panel} panel Panel to add focus to.\n\t */\n\tfunction addAccessibilityKeys(panel) {\n\t\tfunction focus(type) {\n\t\t\tvar item = panel.find(type)[0];\n\n\t\t\tif (item) {\n\t\t\t\titem.focus(true);\n\t\t\t}\n\t\t}\n\n\t\teditor.shortcuts.add('Alt+F9', '', function() {\n\t\t\tfocus('menubar');\n\t\t});\n\n\t\teditor.shortcuts.add('Alt+F10', '', function() {\n\t\t\tfocus('toolbar');\n\t\t});\n\n\t\teditor.shortcuts.add('Alt+F11', '', function() {\n\t\t\tfocus('elementpath');\n\t\t});\n\n\t\tpanel.on('cancel', function() {\n\t\t\teditor.focus();\n\t\t});\n\t}\n\n\t/**\n\t * Resizes the editor to the specified width, height.\n\t */\n\tfunction resizeTo(width, height) {\n\t\tvar containerElm, iframeElm, containerSize, iframeSize;\n\n\t\tfunction getSize(elm) {\n\t\t\treturn {\n\t\t\t\twidth: elm.clientWidth,\n\t\t\t\theight: elm.clientHeight\n\t\t\t};\n\t\t}\n\n\t\tcontainerElm = editor.getContainer();\n\t\tiframeElm = editor.getContentAreaContainer().firstChild;\n\t\tcontainerSize = getSize(containerElm);\n\t\tiframeSize = getSize(iframeElm);\n\n\t\tif (width !== null) {\n\t\t\twidth = Math.max(settings.min_width || 100, width);\n\t\t\twidth = Math.min(settings.max_width || 0xFFFF, width);\n\n\t\t\tDOM.setStyle(containerElm, 'width', width + (containerSize.width - iframeSize.width));\n\t\t\tDOM.setStyle(iframeElm, 'width', width);\n\t\t}\n\n\t\theight = Math.max(settings.min_height || 100, height);\n\t\theight = Math.min(settings.max_height || 0xFFFF, height);\n\t\tDOM.setStyle(iframeElm, 'height', height);\n\n\t\teditor.fire('ResizeEditor');\n\t}\n\n\tfunction resizeBy(dw, dh) {\n\t\tvar elm = editor.getContentAreaContainer();\n\t\tself.resizeTo(elm.clientWidth + dw, elm.clientHeight + dh);\n\t}\n\n\t/**\n\t * Handles contextual toolbars.\n\t */\n\tfunction addContextualToolbars() {\n\t\tvar scrollContainer;\n\n\t\tfunction getContextToolbars() {\n\t\t\treturn editor.contextToolbars || [];\n\t\t}\n\n\t\tfunction getElementRect(elm) {\n\t\t\tvar pos, targetRect, root;\n\n\t\t\tpos = tinymce.DOM.getPos(editor.getContentAreaContainer());\n\t\t\ttargetRect = editor.dom.getRect(elm);\n\t\t\troot = editor.dom.getRoot();\n\n\t\t\t// Adjust targetPos for scrolling in the editor\n\t\t\tif (root.nodeName == 'BODY') {\n\t\t\t\ttargetRect.x -= root.ownerDocument.documentElement.scrollLeft || root.scrollLeft;\n\t\t\t\ttargetRect.y -= root.ownerDocument.documentElement.scrollTop || root.scrollTop;\n\t\t\t}\n\n\t\t\ttargetRect.x += pos.x;\n\t\t\ttargetRect.y += pos.y;\n\n\t\t\treturn targetRect;\n\t\t}\n\n\t\tfunction hideAllFloatingPanels() {\n\t\t\teach(editor.contextToolbars, function(toolbar) {\n\t\t\t\tif (toolbar.panel) {\n\t\t\t\t\ttoolbar.panel.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction togglePositionClass(panel, relPos, predicate) {\n\t\t\trelPos = relPos ? relPos.substr(0, 2) : '';\n\n\t\t\teach({\n\t\t\t\tt: 'down',\n\t\t\t\tb: 'up'\n\t\t\t}, function(cls, pos) {\n\t\t\t\tpanel.classes.toggle('arrow-' + cls, predicate(pos, relPos.substr(0, 1)));\n\t\t\t});\n\n\t\t\teach({\n\t\t\t\tl: 'left',\n\t\t\t\tr: 'right'\n\t\t\t}, function(cls, pos) {\n\t\t\t\tpanel.classes.toggle('arrow-' + cls, predicate(pos, relPos.substr(1, 1)));\n\t\t\t});\n\t\t}\n\n\t\tfunction toClientRect(geomRect) {\n\t\t\treturn {\n\t\t\t\tleft: geomRect.x,\n\t\t\t\ttop: geomRect.y,\n\t\t\t\twidth: geomRect.w,\n\t\t\t\theight: geomRect.h,\n\t\t\t\tright: geomRect.x + geomRect.w,\n\t\t\t\tbottom: geomRect.y + geomRect.h\n\t\t\t};\n\t\t}\n\n\t\tfunction userConstrain(x, y, elementRect, contentAreaRect, panelRect) {\n\t\t\t\tpanelRect = toClientRect({x: x, y: y, w: panelRect.w, h: panelRect.h});\n\n\t\t\t\tif (settings.inline_toolbar_position_handler) {\n\t\t\t\t\tpanelRect = settings.inline_toolbar_position_handler({\n\t\t\t\t\t\telementRect: toClientRect(elementRect),\n\t\t\t\t\t\tcontentAreaRect: toClientRect(contentAreaRect),\n\t\t\t\t\t\tpanelRect: panelRect\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn panelRect;\n\t\t}\n\n\t\tfunction movePanelTo(panel, pos) {\n\t\t\tpanel.moveTo(pos.left, pos.top);\n\t\t}\n\n\t\tfunction reposition(match) {\n\t\t\tvar relPos, panelRect, elementRect, contentAreaRect, panel, relRect, testPositions, smallElementWidthThreshold;\n\n\t\t\tif (editor.removed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!match || !match.toolbar.panel) {\n\t\t\t\thideAllFloatingPanels();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttestPositions = [\n\t\t\t\t'bc-tc', 'tc-bc',\n\t\t\t\t'tl-bl', 'bl-tl',\n\t\t\t\t'tr-br', 'br-tr'\n\t\t\t];\n\n\t\t\tpanel = match.toolbar.panel;\n\t\t\tpanel.show();\n\n\t\t\telementRect = getElementRect(match.element);\n\t\t\tpanelRect = tinymce.DOM.getRect(panel.getEl());\n\t\t\tcontentAreaRect = tinymce.DOM.getRect(editor.getContentAreaContainer() || editor.getBody());\n\t\t\tsmallElementWidthThreshold = 25;\n\n\t\t\t// We need to use these instead of the rect values since the style\n\t\t\t// size properites might not be the same as the real size for a table\n\t\t\telementRect.w = match.element.clientWidth;\n\t\t\telementRect.h = match.element.clientHeight;\n\n\t\t\tif (!editor.inline) {\n\t\t\t\tcontentAreaRect.w = editor.getDoc().documentElement.offsetWidth;\n\t\t\t}\n\n\t\t\t// Inflate the elementRect so it doesn't get placed above resize handles\n\t\t\tif (editor.selection.controlSelection.isResizable(match.element) && elementRect.w < smallElementWidthThreshold) {\n\t\t\t\telementRect = Rect.inflate(elementRect, 0, 8);\n\t\t\t}\n\n\t\t\trelPos = Rect.findBestRelativePosition(panelRect, elementRect, contentAreaRect, testPositions);\n\t\t\telementRect = Rect.clamp(elementRect, contentAreaRect);\n\n\t\t\tif (relPos) {\n\t\t\t\trelRect = Rect.relativePosition(panelRect, elementRect, relPos);\n\t\t\t\tmovePanelTo(panel, userConstrain(relRect.x, relRect.y, elementRect, contentAreaRect, panelRect));\n\t\t\t} else {\n\t\t\t\t// Allow overflow below the editor to avoid placing toolbars ontop of tables\n\t\t\t\tcontentAreaRect.h += panelRect.h;\n\n\t\t\t\telementRect = Rect.intersect(contentAreaRect, elementRect);\n\t\t\t\tif (elementRect) {\n\t\t\t\t\trelPos = Rect.findBestRelativePosition(panelRect, elementRect, contentAreaRect, [\n\t\t\t\t\t\t'bc-tc', 'bl-tl', 'br-tr'\n\t\t\t\t\t]);\n\n\t\t\t\t\tif (relPos) {\n\t\t\t\t\t\trelRect = Rect.relativePosition(panelRect, elementRect, relPos);\n\t\t\t\t\t\tmovePanelTo(panel, userConstrain(relRect.x, relRect.y, elementRect, contentAreaRect, panelRect));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmovePanelTo(panel, userConstrain(elementRect.x, elementRect.y, elementRect, contentAreaRect, panelRect));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tpanel.hide();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttogglePositionClass(panel, relPos, function(pos1, pos2) {\n\t\t\t\treturn pos1 === pos2;\n\t\t\t});\n\n\t\t\t//drawRect(contentAreaRect, 'blue');\n\t\t\t//drawRect(elementRect, 'red');\n\t\t\t//drawRect(panelRect, 'green');\n\t\t}\n\n\t\tfunction repositionHandler() {\n\t\t\tfunction execute() {\n\t\t\t\tif (editor.selection) {\n\t\t\t\t\treposition(findFrontMostMatch(editor.selection.getNode()));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttinymce.util.Delay.requestAnimationFrame(execute);\n\t\t}\n\n\t\tfunction bindScrollEvent() {\n\t\t\tif (!scrollContainer) {\n\t\t\t\tscrollContainer = editor.selection.getScrollContainer() || editor.getWin();\n\t\t\t\ttinymce.$(scrollContainer).on('scroll', repositionHandler);\n\n\t\t\t\teditor.on('remove', function() {\n\t\t\t\t\ttinymce.$(scrollContainer).off('scroll');\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction showContextToolbar(match) {\n\t\t\tvar panel;\n\n\t\t\tif (match.toolbar.panel) {\n\t\t\t\tmatch.toolbar.panel.show();\n\t\t\t\treposition(match);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbindScrollEvent();\n\n\t\t\tpanel = Factory.create({\n\t\t\t\ttype: 'floatpanel',\n\t\t\t\trole: 'dialog',\n\t\t\t\tclasses: 'tinymce tinymce-inline arrow',\n\t\t\t\tariaLabel: 'Inline toolbar',\n\t\t\t\tlayout: 'flex',\n\t\t\t\tdirection: 'column',\n\t\t\t\talign: 'stretch',\n\t\t\t\tautohide: false,\n\t\t\t\tautofix: true,\n\t\t\t\tfixed: true,\n\t\t\t\tborder: 1,\n\t\t\t\titems: createToolbar(match.toolbar.items),\n\t\t\t\toncancel: function() {\n\t\t\t\t\teditor.focus();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tmatch.toolbar.panel = panel;\n\t\t\tpanel.renderTo(document.body).reflow();\n\t\t\treposition(match);\n\t\t}\n\n\t\tfunction hideAllContextToolbars() {\n\t\t\ttinymce.each(getContextToolbars(), function(toolbar) {\n\t\t\t\tif (toolbar.panel) {\n\t\t\t\t\ttoolbar.panel.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction findFrontMostMatch(targetElm) {\n\t\t\tvar i, y, parentsAndSelf, toolbars = getContextToolbars();\n\n\t\t\tparentsAndSelf = editor.$(targetElm).parents().add(targetElm);\n\t\t\tfor (i = parentsAndSelf.length - 1; i >= 0; i--) {\n\t\t\t\tfor (y = toolbars.length - 1; y >= 0; y--) {\n\t\t\t\t\tif (toolbars[y].predicate(parentsAndSelf[i])) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttoolbar: toolbars[y],\n\t\t\t\t\t\t\telement: parentsAndSelf[i]\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\teditor.on('click keyup setContent', function(e) {\n\t\t\t// Only act on partial inserts\n\t\t\tif (e.type == 'setcontent' && !e.selection) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Needs to be delayed to avoid Chrome img focus out bug\n\t\t\ttinymce.util.Delay.setEditorTimeout(editor, function() {\n\t\t\t\tvar match;\n\n\t\t\t\tmatch = findFrontMostMatch(editor.selection.getNode());\n\t\t\t\tif (match) {\n\t\t\t\t\thideAllContextToolbars();\n\t\t\t\t\tshowContextToolbar(match);\n\t\t\t\t} else {\n\t\t\t\t\thideAllContextToolbars();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\teditor.on('blur hide', hideAllContextToolbars);\n\n\t\teditor.on('ObjectResizeStart', function() {\n\t\t\tvar match = findFrontMostMatch(editor.selection.getNode());\n\n\t\t\tif (match && match.toolbar.panel) {\n\t\t\t\tmatch.toolbar.panel.hide();\n\t\t\t}\n\t\t});\n\n\t\teditor.on('nodeChange ResizeEditor ResizeWindow', repositionHandler);\n\n\t\teditor.on('remove', function() {\n\t\t\ttinymce.each(getContextToolbars(), function(toolbar) {\n\t\t\t\tif (toolbar.panel) {\n\t\t\t\t\ttoolbar.panel.remove();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.contextToolbars = {};\n\t\t});\n\n\t\teditor.shortcuts.add('ctrl+shift+e > ctrl+shift+p', '', function() {\n\t\t\tvar match = findFrontMostMatch(editor.selection.getNode());\n\t\t\tif (match && match.toolbar.panel) {\n\t\t\t\tmatch.toolbar.panel.items()[0].focus();\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction fireSkinLoaded(editor) {\n\t\treturn function() {\n\t\t\tif (editor.initialized) {\n\t\t\t\teditor.fire('SkinLoaded');\n\t\t\t} else {\n\t\t\t\teditor.on('init', function() {\n\t\t\t\t\teditor.fire('SkinLoaded');\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Renders the inline editor UI.\n\t *\n\t * @return {Object} Name/value object with theme data.\n\t */\n\tfunction renderInlineUI(args) {\n\t\tvar panel, inlineToolbarContainer;\n\n\t\tif (settings.fixed_toolbar_container) {\n\t\t\tinlineToolbarContainer = DOM.select(settings.fixed_toolbar_container)[0];\n\t\t}\n\n\t\tfunction reposition() {\n\t\t\tif (panel && panel.moveRel && panel.visible() && !panel._fixed) {\n\t\t\t\t// TODO: This is kind of ugly and doesn't handle multiple scrollable elements\n\t\t\t\tvar scrollContainer = editor.selection.getScrollContainer(), body = editor.getBody();\n\t\t\t\tvar deltaX = 0, deltaY = 0;\n\n\t\t\t\tif (scrollContainer) {\n\t\t\t\t\tvar bodyPos = DOM.getPos(body), scrollContainerPos = DOM.getPos(scrollContainer);\n\n\t\t\t\t\tdeltaX = Math.max(0, scrollContainerPos.x - bodyPos.x);\n\t\t\t\t\tdeltaY = Math.max(0, scrollContainerPos.y - bodyPos.y);\n\t\t\t\t}\n\n\t\t\t\tpanel.fixed(false).moveRel(body, editor.rtl ? ['tr-br', 'br-tr'] : ['tl-bl', 'bl-tl', 'tr-br']).moveBy(deltaX, deltaY);\n\t\t\t}\n\t\t}\n\n\t\tfunction show() {\n\t\t\tif (panel) {\n\t\t\t\tpanel.show();\n\t\t\t\treposition();\n\t\t\t\tDOM.addClass(editor.getBody(), 'mce-edit-focus');\n\t\t\t}\n\t\t}\n\n\t\tfunction hide() {\n\t\t\tif (panel) {\n\t\t\t\t// We require two events as the inline float panel based toolbar does not have autohide=true\n\t\t\t\tpanel.hide();\n\n\t\t\t\t// All other autohidden float panels will be closed below.\n\t\t\t\tFloatPanel.hideAll();\n\n\t\t\t\tDOM.removeClass(editor.getBody(), 'mce-edit-focus');\n\t\t\t}\n\t\t}\n\n\t\tfunction render() {\n\t\t\tif (panel) {\n\t\t\t\tif (!panel.visible()) {\n\t\t\t\t\tshow();\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Render a plain panel inside the inlineToolbarContainer if it's defined\n\t\t\tpanel = self.panel = Factory.create({\n\t\t\t\ttype: inlineToolbarContainer ? 'panel' : 'floatpanel',\n\t\t\t\trole: 'application',\n\t\t\t\tclasses: 'tinymce tinymce-inline',\n\t\t\t\tlayout: 'flex',\n\t\t\t\tdirection: 'column',\n\t\t\t\talign: 'stretch',\n\t\t\t\tautohide: false,\n\t\t\t\tautofix: true,\n\t\t\t\tfixed: !!inlineToolbarContainer,\n\t\t\t\tborder: 1,\n\t\t\t\titems: [\n\t\t\t\t\tsettings.menubar === false ? null : {type: 'menubar', border: '0 0 1 0', items: createMenuButtons()},\n\t\t\t\t\tcreateToolbars(settings.toolbar_items_size)\n\t\t\t\t]\n\t\t\t});\n\n\t\t\t// Add statusbar\n\t\t\t/*if (settings.statusbar !== false) {\n\t\t\t\tpanel.add({type: 'panel', classes: 'statusbar', layout: 'flow', border: '1 0 0 0', items: [\n\t\t\t\t\t{type: 'elementpath'}\n\t\t\t\t]});\n\t\t\t}*/\n\n\t\t\teditor.fire('BeforeRenderUI');\n\t\t\tpanel.renderTo(inlineToolbarContainer || document.body).reflow();\n\n\t\t\taddAccessibilityKeys(panel);\n\t\t\tshow();\n\t\t\taddContextualToolbars();\n\n\t\t\teditor.on('nodeChange', reposition);\n\t\t\teditor.on('activate', show);\n\t\t\teditor.on('deactivate', hide);\n\n\t\t\teditor.nodeChanged();\n\t\t}\n\n\t\tsettings.content_editable = true;\n\n\t\teditor.on('focus', function() {\n\t\t\t// Render only when the CSS file has been loaded\n\t\t\tif (args.skinUiCss) {\n\t\t\t\ttinymce.DOM.styleSheetLoader.load(args.skinUiCss, render, render);\n\t\t\t} else {\n\t\t\t\trender();\n\t\t\t}\n\t\t});\n\n\t\teditor.on('blur hide', hide);\n\n\t\t// Remove the panel when the editor is removed\n\t\teditor.on('remove', function() {\n\t\t\tif (panel) {\n\t\t\t\tpanel.remove();\n\t\t\t\tpanel = null;\n\t\t\t}\n\t\t});\n\n\t\t// Preload skin css\n\t\tif (args.skinUiCss) {\n\t\t\ttinymce.DOM.styleSheetLoader.load(args.skinUiCss, fireSkinLoaded(editor));\n\t\t}\n\n\t\treturn {};\n\t}\n\n\t/**\n\t * Renders the iframe editor UI.\n\t *\n\t * @param {Object} args Details about target element etc.\n\t * @return {Object} Name/value object with theme data.\n\t */\n\tfunction renderIframeUI(args) {\n\t\tvar panel, resizeHandleCtrl, startSize;\n\n\t\tfunction switchMode() {\n\t\t\treturn function(e) {\n\t\t\t\tif (e.mode == 'readonly') {\n\t\t\t\t\tpanel.find('*').disabled(true);\n\t\t\t\t} else {\n\t\t\t\t\tpanel.find('*').disabled(false);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (args.skinUiCss) {\n\t\t\ttinymce.DOM.styleSheetLoader.load(args.skinUiCss, fireSkinLoaded(editor));\n\t\t}\n\n\t\t// Basic UI layout\n\t\tpanel = self.panel = Factory.create({\n\t\t\ttype: 'panel',\n\t\t\trole: 'application',\n\t\t\tclasses: 'tinymce',\n\t\t\tstyle: 'visibility: hidden',\n\t\t\tlayout: 'stack',\n\t\t\tborder: 1,\n\t\t\titems: [\n\t\t\t\tsettings.menubar === false ? null : {type: 'menubar', border: '0 0 1 0', items: createMenuButtons()},\n\t\t\t\tcreateToolbars(settings.toolbar_items_size),\n\t\t\t\t{type: 'panel', name: 'iframe', layout: 'stack', classes: 'edit-area', html: '', border: '1 0 0 0'}\n\t\t\t]\n\t\t});\n\n\t\tif (settings.resize !== false) {\n\t\t\tresizeHandleCtrl = {\n\t\t\t\ttype: 'resizehandle',\n\t\t\t\tdirection: settings.resize,\n\n\t\t\t\tonResizeStart: function() {\n\t\t\t\t\tvar elm = editor.getContentAreaContainer().firstChild;\n\n\t\t\t\t\tstartSize = {\n\t\t\t\t\t\twidth: elm.clientWidth,\n\t\t\t\t\t\theight: elm.clientHeight\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tonResize: function(e) {\n\t\t\t\t\tif (settings.resize == 'both') {\n\t\t\t\t\t\tresizeTo(startSize.width + e.deltaX, startSize.height + e.deltaY);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresizeTo(null, startSize.height + e.deltaY);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t// Add statusbar if needed\n\t\tif (settings.statusbar !== false) {\n\t\t\tpanel.add({type: 'panel', name: 'statusbar', classes: 'statusbar', layout: 'flow', border: '1 0 0 0', ariaRoot: true, items: [\n\t\t\t\t{type: 'elementpath', editor: editor},\n\t\t\t\tresizeHandleCtrl\n\t\t\t]});\n\t\t}\n\n\t\teditor.fire('BeforeRenderUI');\n\t\teditor.on('SwitchMode', switchMode());\n\t\tpanel.renderBefore(args.targetNode).reflow();\n\n\t\tif (settings.readonly) {\n\t\t\teditor.setMode('readonly');\n\t\t}\n\n\t\tif (settings.width) {\n\t\t\ttinymce.DOM.setStyle(panel.getEl(), 'width', settings.width);\n\t\t}\n\n\t\t// Remove the panel when the editor is removed\n\t\teditor.on('remove', function() {\n\t\t\tpanel.remove();\n\t\t\tpanel = null;\n\t\t});\n\n\t\t// Add accesibility shortcuts\n\t\taddAccessibilityKeys(panel);\n\t\taddContextualToolbars();\n\n\t\treturn {\n\t\t\tiframeContainer: panel.find('#iframe')[0].getEl(),\n\t\t\teditorContainer: panel.getEl()\n\t\t};\n\t}\n\n\t/**\n\t * Renders the UI for the theme. This gets called by the editor.\n\t *\n\t * @param {Object} args Details about target element etc.\n\t * @return {Object} Theme UI data items.\n\t */\n\tself.renderUI = function(args) {\n\t\tvar skin = settings.skin !== false ? settings.skin || 'lightgray' : false;\n\n\t\tif (skin) {\n\t\t\tvar skinUrl = settings.skin_url;\n\n\t\t\tif (skinUrl) {\n\t\t\t\tskinUrl = editor.documentBaseURI.toAbsolute(skinUrl);\n\t\t\t} else {\n\t\t\t\tskinUrl = tinymce.baseURL + '/skins/' + skin;\n\t\t\t}\n\n\t\t\t// Load special skin for IE7\n\t\t\t// TODO: Remove this when we drop IE7 support\n\t\t\tif (tinymce.Env.documentMode <= 7) {\n\t\t\t\targs.skinUiCss = skinUrl + '/skin.ie7.min.css';\n\t\t\t} else {\n\t\t\t\targs.skinUiCss = skinUrl + '/skin.min.css';\n\t\t\t}\n\n\t\t\t// Load content.min.css or content.inline.min.css\n\t\t\teditor.contentCSS.push(skinUrl + '/content' + (editor.inline ? '.inline' : '') + '.min.css');\n\t\t}\n\n\t\t// Handle editor setProgressState change\n\t\teditor.on('ProgressState', function(e) {\n\t\t\tself.throbber = self.throbber || new tinymce.ui.Throbber(self.panel.getEl('body'));\n\n\t\t\tif (e.state) {\n\t\t\t\tself.throbber.show(e.time);\n\t\t\t} else {\n\t\t\t\tself.throbber.hide();\n\t\t\t}\n\t\t});\n\n\t\tif (settings.inline) {\n\t\t\treturn renderInlineUI(args);\n\t\t}\n\n\t\treturn renderIframeUI(args);\n\t};\n\n\tself.resizeTo = resizeTo;\n\tself.resizeBy = resizeBy;\n});\n"},769:function(t,n){t.exports="window.console && console.log('Use tinymce.js instead of tinymce.jquery.js.');\n// 4.4.3 (2016-09-01)\n\n/**\n * Compiled inline version. (Library mode)\n */\n\n/*jshint smarttabs:true, undef:true, latedef:true, curly:true, bitwise:true, camelcase:true */\n/*globals $code */\n\n(function(exports, undefined) {\n\t\"use strict\";\n\n\tvar modules = {};\n\n\tfunction require(ids, callback) {\n\t\tvar module, defs = [];\n\n\t\tfor (var i = 0; i < ids.length; ++i) {\n\t\t\tmodule = modules[ids[i]] || resolve(ids[i]);\n\t\t\tif (!module) {\n\t\t\t\tthrow 'module definition dependecy not found: ' + ids[i];\n\t\t\t}\n\n\t\t\tdefs.push(module);\n\t\t}\n\n\t\tcallback.apply(null, defs);\n\t}\n\n\tfunction define(id, dependencies, definition) {\n\t\tif (typeof id !== 'string') {\n\t\t\tthrow 'invalid module definition, module id must be defined and be a string';\n\t\t}\n\n\t\tif (dependencies === undefined) {\n\t\t\tthrow 'invalid module definition, dependencies must be specified';\n\t\t}\n\n\t\tif (definition === undefined) {\n\t\t\tthrow 'invalid module definition, definition function must be specified';\n\t\t}\n\n\t\trequire(dependencies, function() {\n\t\t\tmodules[id] = definition.apply(null, arguments);\n\t\t});\n\t}\n\n\tfunction defined(id) {\n\t\treturn !!modules[id];\n\t}\n\n\tfunction resolve(id) {\n\t\tvar target = exports;\n\t\tvar fragments = id.split(/[.\\/]/);\n\n\t\tfor (var fi = 0; fi < fragments.length; ++fi) {\n\t\t\tif (!target[fragments[fi]]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttarget = target[fragments[fi]];\n\t\t}\n\n\t\treturn target;\n\t}\n\n\tfunction expose(ids) {\n\t\tvar i, target, id, fragments, privateModules;\n\n\t\tfor (i = 0; i < ids.length; i++) {\n\t\t\ttarget = exports;\n\t\t\tid = ids[i];\n\t\t\tfragments = id.split(/[.\\/]/);\n\n\t\t\tfor (var fi = 0; fi < fragments.length - 1; ++fi) {\n\t\t\t\tif (target[fragments[fi]] === undefined) {\n\t\t\t\t\ttarget[fragments[fi]] = {};\n\t\t\t\t}\n\n\t\t\t\ttarget = target[fragments[fi]];\n\t\t\t}\n\n\t\t\ttarget[fragments[fragments.length - 1]] = modules[id];\n\t\t}\n\t\t\n\t\t// Expose private modules for unit tests\n\t\tif (exports.AMDLC_TESTS) {\n\t\t\tprivateModules = exports.privateModules || {};\n\n\t\t\tfor (id in modules) {\n\t\t\t\tprivateModules[id] = modules[id];\n\t\t\t}\n\n\t\t\tfor (i = 0; i < ids.length; i++) {\n\t\t\t\tdelete privateModules[ids[i]];\n\t\t\t}\n\n\t\t\texports.privateModules = privateModules;\n\t\t}\n\t}\n\n// Included from: js/tinymce/classes/geom/Rect.js\n\n/**\n * Rect.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Contains various tools for rect/position calculation.\n *\n * @class tinymce.geom.Rect\n */\ndefine(\"tinymce/geom/Rect\", [\n], function() {\n\t\"use strict\";\n\n\tvar min = Math.min, max = Math.max, round = Math.round;\n\n\t/**\n\t * Returns the rect positioned based on the relative position name\n\t * to the target rect.\n\t *\n\t * @method relativePosition\n\t * @param {Rect} rect Source rect to modify into a new rect.\n\t * @param {Rect} targetRect Rect to move relative to based on the rel option.\n\t * @param {String} rel Relative position. For example: tr-bl.\n\t */\n\tfunction relativePosition(rect, targetRect, rel) {\n\t\tvar x, y, w, h, targetW, targetH;\n\n\t\tx = targetRect.x;\n\t\ty = targetRect.y;\n\t\tw = rect.w;\n\t\th = rect.h;\n\t\ttargetW = targetRect.w;\n\t\ttargetH = targetRect.h;\n\n\t\trel = (rel || '').split('');\n\n\t\tif (rel[0] === 'b') {\n\t\t\ty += targetH;\n\t\t}\n\n\t\tif (rel[1] === 'r') {\n\t\t\tx += targetW;\n\t\t}\n\n\t\tif (rel[0] === 'c') {\n\t\t\ty += round(targetH / 2);\n\t\t}\n\n\t\tif (rel[1] === 'c') {\n\t\t\tx += round(targetW / 2);\n\t\t}\n\n\t\tif (rel[3] === 'b') {\n\t\t\ty -= h;\n\t\t}\n\n\t\tif (rel[4] === 'r') {\n\t\t\tx -= w;\n\t\t}\n\n\t\tif (rel[3] === 'c') {\n\t\t\ty -= round(h / 2);\n\t\t}\n\n\t\tif (rel[4] === 'c') {\n\t\t\tx -= round(w / 2);\n\t\t}\n\n\t\treturn create(x, y, w, h);\n\t}\n\n\t/**\n\t * Tests various positions to get the most suitable one.\n\t *\n\t * @method findBestRelativePosition\n\t * @param {Rect} rect Rect to use as source.\n\t * @param {Rect} targetRect Rect to move relative to.\n\t * @param {Rect} constrainRect Rect to constrain within.\n\t * @param {Array} rels Array of relative positions to test against.\n\t */\n\tfunction findBestRelativePosition(rect, targetRect, constrainRect, rels) {\n\t\tvar pos, i;\n\n\t\tfor (i = 0; i < rels.length; i++) {\n\t\t\tpos = relativePosition(rect, targetRect, rels[i]);\n\n\t\t\tif (pos.x >= constrainRect.x && pos.x + pos.w <= constrainRect.w + constrainRect.x &&\n\t\t\t\tpos.y >= constrainRect.y && pos.y + pos.h <= constrainRect.h + constrainRect.y) {\n\t\t\t\treturn rels[i];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Inflates the rect in all directions.\n\t *\n\t * @method inflate\n\t * @param {Rect} rect Rect to expand.\n\t * @param {Number} w Relative width to expand by.\n\t * @param {Number} h Relative height to expand by.\n\t * @return {Rect} New expanded rect.\n\t */\n\tfunction inflate(rect, w, h) {\n\t\treturn create(rect.x - w, rect.y - h, rect.w + w * 2, rect.h + h * 2);\n\t}\n\n\t/**\n\t * Returns the intersection of the specified rectangles.\n\t *\n\t * @method intersect\n\t * @param {Rect} rect The first rectangle to compare.\n\t * @param {Rect} cropRect The second rectangle to compare.\n\t * @return {Rect} The intersection of the two rectangles or null if they don't intersect.\n\t */\n\tfunction intersect(rect, cropRect) {\n\t\tvar x1, y1, x2, y2;\n\n\t\tx1 = max(rect.x, cropRect.x);\n\t\ty1 = max(rect.y, cropRect.y);\n\t\tx2 = min(rect.x + rect.w, cropRect.x + cropRect.w);\n\t\ty2 = min(rect.y + rect.h, cropRect.y + cropRect.h);\n\n\t\tif (x2 - x1 < 0 || y2 - y1 < 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn create(x1, y1, x2 - x1, y2 - y1);\n\t}\n\n\t/**\n\t * Returns a rect clamped within the specified clamp rect. This forces the\n\t * rect to be inside the clamp rect.\n\t *\n\t * @method clamp\n\t * @param {Rect} rect Rectangle to force within clamp rect.\n\t * @param {Rect} clampRect Rectable to force within.\n\t * @param {Boolean} fixedSize True/false if size should be fixed.\n\t * @return {Rect} Clamped rect.\n\t */\n\tfunction clamp(rect, clampRect, fixedSize) {\n\t\tvar underflowX1, underflowY1, overflowX2, overflowY2,\n\t\t\tx1, y1, x2, y2, cx2, cy2;\n\n\t\tx1 = rect.x;\n\t\ty1 = rect.y;\n\t\tx2 = rect.x + rect.w;\n\t\ty2 = rect.y + rect.h;\n\t\tcx2 = clampRect.x + clampRect.w;\n\t\tcy2 = clampRect.y + clampRect.h;\n\n\t\tunderflowX1 = max(0, clampRect.x - x1);\n\t\tunderflowY1 = max(0, clampRect.y - y1);\n\t\toverflowX2 = max(0, x2 - cx2);\n\t\toverflowY2 = max(0, y2 - cy2);\n\n\t\tx1 += underflowX1;\n\t\ty1 += underflowY1;\n\n\t\tif (fixedSize) {\n\t\t\tx2 += underflowX1;\n\t\t\ty2 += underflowY1;\n\t\t\tx1 -= overflowX2;\n\t\t\ty1 -= overflowY2;\n\t\t}\n\n\t\tx2 -= overflowX2;\n\t\ty2 -= overflowY2;\n\n\t\treturn create(x1, y1, x2 - x1, y2 - y1);\n\t}\n\n\t/**\n\t * Creates a new rectangle object.\n\t *\n\t * @method create\n\t * @param {Number} x Rectangle x location.\n\t * @param {Number} y Rectangle y location.\n\t * @param {Number} w Rectangle width.\n\t * @param {Number} h Rectangle height.\n\t * @return {Rect} New rectangle object.\n\t */\n\tfunction create(x, y, w, h) {\n\t\treturn {x: x, y: y, w: w, h: h};\n\t}\n\n\t/**\n\t * Creates a new rectangle object form a clientRects object.\n\t *\n\t * @method fromClientRect\n\t * @param {ClientRect} clientRect DOM ClientRect object.\n\t * @return {Rect} New rectangle object.\n\t */\n\tfunction fromClientRect(clientRect) {\n\t\treturn create(clientRect.left, clientRect.top, clientRect.width, clientRect.height);\n\t}\n\n\treturn {\n\t\tinflate: inflate,\n\t\trelativePosition: relativePosition,\n\t\tfindBestRelativePosition: findBestRelativePosition,\n\t\tintersect: intersect,\n\t\tclamp: clamp,\n\t\tcreate: create,\n\t\tfromClientRect: fromClientRect\n\t};\n});\n\n// Included from: js/tinymce/classes/util/Promise.js\n\n/**\n * Promise.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * Promise polyfill under MIT license: https://github.com/taylorhakes/promise-polyfill\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/* eslint-disable */\n/* jshint ignore:start */\n\n/**\n * Modifed to be a feature fill and wrapped as tinymce module.\n */\ndefine(\"tinymce/util/Promise\", [], function() {\n\tif (window.Promise) {\n\t\treturn window.Promise;\n\t}\n\n\t// Use polyfill for setImmediate for performance gains\n\tvar asap = Promise.immediateFn || (typeof setImmediate === 'function' && setImmediate) ||\n\t\tfunction(fn) { setTimeout(fn, 1); };\n\n\t// Polyfill for Function.prototype.bind\n\tfunction bind(fn, thisArg) {\n\t\treturn function() {\n\t\t\tfn.apply(thisArg, arguments);\n\t\t};\n\t}\n\n\tvar isArray = Array.isArray || function(value) { return Object.prototype.toString.call(value) === \"[object Array]\"; };\n\n\tfunction Promise(fn) {\n\t\tif (typeof this !== 'object') throw new TypeError('Promises must be constructed via new');\n\t\tif (typeof fn !== 'function') throw new TypeError('not a function');\n\t\tthis._state = null;\n\t\tthis._value = null;\n\t\tthis._deferreds = [];\n\n\t\tdoResolve(fn, bind(resolve, this), bind(reject, this));\n\t}\n\n\tfunction handle(deferred) {\n\t\tvar me = this;\n\t\tif (this._state === null) {\n\t\t\tthis._deferreds.push(deferred);\n\t\t\treturn;\n\t\t}\n\t\tasap(function() {\n\t\t\tvar cb = me._state ? deferred.onFulfilled : deferred.onRejected;\n\t\t\tif (cb === null) {\n\t\t\t\t(me._state ? deferred.resolve : deferred.reject)(me._value);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar ret;\n\t\t\ttry {\n\t\t\t\tret = cb(me._value);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tdeferred.reject(e);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdeferred.resolve(ret);\n\t\t});\n\t}\n\n\tfunction resolve(newValue) {\n\t\ttry { //Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n\t\t\tif (newValue === this) throw new TypeError('A promise cannot be resolved with itself.');\n\t\t\tif (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n\t\t\t\tvar then = newValue.then;\n\t\t\t\tif (typeof then === 'function') {\n\t\t\t\t\tdoResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._state = true;\n\t\t\tthis._value = newValue;\n\t\t\tfinale.call(this);\n\t\t} catch (e) { reject.call(this, e); }\n\t}\n\n\tfunction reject(newValue) {\n\t\tthis._state = false;\n\t\tthis._value = newValue;\n\t\tfinale.call(this);\n\t}\n\n\tfunction finale() {\n\t\tfor (var i = 0, len = this._deferreds.length; i < len; i++) {\n\t\t\thandle.call(this, this._deferreds[i]);\n\t\t}\n\t\tthis._deferreds = null;\n\t}\n\n\tfunction Handler(onFulfilled, onRejected, resolve, reject){\n\t\tthis.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n\t\tthis.onRejected = typeof onRejected === 'function' ? onRejected : null;\n\t\tthis.resolve = resolve;\n\t\tthis.reject = reject;\n\t}\n\n\t/**\n\t * Take a potentially misbehaving resolver function and make sure\n\t * onFulfilled and onRejected are only called once.\n\t *\n\t * Makes no guarantees about asynchrony.\n\t */\n\tfunction doResolve(fn, onFulfilled, onRejected) {\n\t\tvar done = false;\n\t\ttry {\n\t\t\tfn(function (value) {\n\t\t\t\tif (done) return;\n\t\t\t\tdone = true;\n\t\t\t\tonFulfilled(value);\n\t\t\t}, function (reason) {\n\t\t\t\tif (done) return;\n\t\t\t\tdone = true;\n\t\t\t\tonRejected(reason);\n\t\t\t});\n\t\t} catch (ex) {\n\t\t\tif (done) return;\n\t\t\tdone = true;\n\t\t\tonRejected(ex);\n\t\t}\n\t}\n\n\tPromise.prototype['catch'] = function (onRejected) {\n\t\treturn this.then(null, onRejected);\n\t};\n\n\tPromise.prototype.then = function(onFulfilled, onRejected) {\n\t\tvar me = this;\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\thandle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));\n\t\t});\n\t};\n\n\tPromise.all = function () {\n\t\tvar args = Array.prototype.slice.call(arguments.length === 1 && isArray(arguments[0]) ? arguments[0] : arguments);\n\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tif (args.length === 0) return resolve([]);\n\t\t\tvar remaining = args.length;\n\t\t\tfunction res(i, val) {\n\t\t\t\ttry {\n\t\t\t\t\tif (val && (typeof val === 'object' || typeof val === 'function')) {\n\t\t\t\t\t\tvar then = val.then;\n\t\t\t\t\t\tif (typeof then === 'function') {\n\t\t\t\t\t\t\tthen.call(val, function (val) { res(i, val); }, reject);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\targs[i] = val;\n\t\t\t\t\tif (--remaining === 0) {\n\t\t\t\t\t\tresolve(args);\n\t\t\t\t\t}\n\t\t\t\t} catch (ex) {\n\t\t\t\t\treject(ex);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var i = 0; i < args.length; i++) {\n\t\t\t\tres(i, args[i]);\n\t\t\t}\n\t\t});\n\t};\n\n\tPromise.resolve = function (value) {\n\t\tif (value && typeof value === 'object' && value.constructor === Promise) {\n\t\t\treturn value;\n\t\t}\n\n\t\treturn new Promise(function (resolve) {\n\t\t\tresolve(value);\n\t\t});\n\t};\n\n\tPromise.reject = function (value) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\treject(value);\n\t\t});\n\t};\n\n\tPromise.race = function (values) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tfor(var i = 0, len = values.length; i < len; i++) {\n\t\t\t\tvalues[i].then(resolve, reject);\n\t\t\t}\n\t\t});\n\t};\n\n\treturn Promise;\n});\n\n/* jshint ignore:end */\n/* eslint-enable */\n\n// Included from: js/tinymce/classes/util/Delay.js\n\n/**\n * Delay.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility class for working with delayed actions like setTimeout.\n *\n * @class tinymce.util.Delay\n */\ndefine(\"tinymce/util/Delay\", [\n\t\"tinymce/util/Promise\"\n], function(Promise) {\n\tvar requestAnimationFramePromise;\n\n\tfunction requestAnimationFrame(callback, element) {\n\t\tvar i, requestAnimationFrameFunc = window.requestAnimationFrame, vendors = ['ms', 'moz', 'webkit'];\n\n\t\tfunction featurefill(callback) {\n\t\t\twindow.setTimeout(callback, 0);\n\t\t}\n\n\t\tfor (i = 0; i < vendors.length && !requestAnimationFrameFunc; i++) {\n\t\t\trequestAnimationFrameFunc = window[vendors[i] + 'RequestAnimationFrame'];\n\t\t}\n\n\t\tif (!requestAnimationFrameFunc) {\n\t\t\trequestAnimationFrameFunc = featurefill;\n\t\t}\n\n\t\trequestAnimationFrameFunc(callback, element);\n\t}\n\n\tfunction wrappedSetTimeout(callback, time) {\n\t\tif (typeof time != 'number') {\n\t\t\ttime = 0;\n\t\t}\n\n\t\treturn setTimeout(callback, time);\n\t}\n\n\tfunction wrappedSetInterval(callback, time) {\n\t\tif (typeof time != 'number') {\n\t\t\ttime = 1; // IE 8 needs it to be > 0\n\t\t}\n\n\t\treturn setInterval(callback, time);\n\t}\n\n\tfunction wrappedClearTimeout(id) {\n\t\treturn clearTimeout(id);\n\t}\n\n\tfunction wrappedClearInterval(id) {\n\t\treturn clearInterval(id);\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Requests an animation frame and fallbacks to a timeout on older browsers.\n\t\t *\n\t\t * @method requestAnimationFrame\n\t\t * @param {function} callback Callback to execute when a new frame is available.\n\t\t * @param {DOMElement} element Optional element to scope it to.\n\t\t */\n\t\trequestAnimationFrame: function(callback, element) {\n\t\t\tif (requestAnimationFramePromise) {\n\t\t\t\trequestAnimationFramePromise.then(callback);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trequestAnimationFramePromise = new Promise(function(resolve) {\n\t\t\t\tif (!element) {\n\t\t\t\t\telement = document.body;\n\t\t\t\t}\n\n\t\t\t\trequestAnimationFrame(resolve, element);\n\t\t\t}).then(callback);\n\t\t},\n\n\t\t/**\n\t\t * Sets a timer in ms and executes the specified callback when the timer runs out.\n\t\t *\n\t\t * @method setTimeout\n\t\t * @param {function} callback Callback to execute when timer runs out.\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\n\t\t * @return {Number} Timeout id number.\n\t\t */\n\t\tsetTimeout: wrappedSetTimeout,\n\n\t\t/**\n\t\t * Sets an interval timer in ms and executes the specified callback at every interval of that time.\n\t\t *\n\t\t * @method setInterval\n\t\t * @param {function} callback Callback to execute when interval time runs out.\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\n\t\t * @return {Number} Timeout id number.\n\t\t */\n\t\tsetInterval: wrappedSetInterval,\n\n\t\t/**\n\t\t * Sets an editor timeout it's similar to setTimeout except that it checks if the editor instance is\n\t\t * still alive when the callback gets executed.\n\t\t *\n\t\t * @method setEditorTimeout\n\t\t * @param {tinymce.Editor} editor Editor instance to check the removed state on.\n\t\t * @param {function} callback Callback to execute when timer runs out.\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\n\t\t * @return {Number} Timeout id number.\n\t\t */\n\t\tsetEditorTimeout: function(editor, callback, time) {\n\t\t\treturn wrappedSetTimeout(function() {\n\t\t\t\tif (!editor.removed) {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t}, time);\n\t\t},\n\n\t\t/**\n\t\t * Sets an interval timer it's similar to setInterval except that it checks if the editor instance is\n\t\t * still alive when the callback gets executed.\n\t\t *\n\t\t * @method setEditorInterval\n\t\t * @param {function} callback Callback to execute when interval time runs out.\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\n\t\t * @return {Number} Timeout id number.\n\t\t */\n\t\tsetEditorInterval: function(editor, callback, time) {\n\t\t\tvar timer;\n\n\t\t\ttimer = wrappedSetInterval(function() {\n\t\t\t\tif (!editor.removed) {\n\t\t\t\t\tcallback();\n\t\t\t\t} else {\n\t\t\t\t\tclearInterval(timer);\n\t\t\t\t}\n\t\t\t}, time);\n\n\t\t\treturn timer;\n\t\t},\n\n\t\t/**\n\t\t * Creates throttled callback function that only gets executed once within the specified time.\n\t\t *\n\t\t * @method throttle\n\t\t * @param {function} callback Callback to execute when timer finishes.\n\t\t * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.\n\t\t * @return {Function} Throttled function callback.\n\t\t */\n\t\tthrottle: function(callback, time) {\n\t\t\tvar timer, func;\n\n\t\t\tfunc = function() {\n\t\t\t\tvar args = arguments;\n\n\t\t\t\tclearTimeout(timer);\n\n\t\t\t\ttimer = wrappedSetTimeout(function() {\n\t\t\t\t\tcallback.apply(this, args);\n\t\t\t\t}, time);\n\t\t\t};\n\n\t\t\tfunc.stop = function() {\n\t\t\t\tclearTimeout(timer);\n\t\t\t};\n\n\t\t\treturn func;\n\t\t},\n\n\t\t/**\n\t\t * Clears an interval timer so it won't execute.\n\t\t *\n\t\t * @method clearInterval\n\t\t * @param {Number} Interval timer id number.\n\t\t */\n\t\tclearInterval: wrappedClearInterval,\n\n\t\t/**\n\t\t * Clears an timeout timer so it won't execute.\n\t\t *\n\t\t * @method clearTimeout\n\t\t * @param {Number} Timeout timer id number.\n\t\t */\n\t\tclearTimeout: wrappedClearTimeout\n\t};\n});\n\n// Included from: js/tinymce/classes/Env.js\n\n/**\n * Env.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains various environment constants like browser versions etc.\n * Normally you don't want to sniff specific browser versions but sometimes you have\n * to when it's impossible to feature detect. So use this with care.\n *\n * @class tinymce.Env\n * @static\n */\ndefine(\"tinymce/Env\", [], function() {\n\tvar nav = navigator, userAgent = nav.userAgent;\n\tvar opera, webkit, ie, ie11, ie12, gecko, mac, iDevice, android, fileApi, phone, tablet, windowsPhone;\n\n\tfunction matchMediaQuery(query) {\n\t\treturn \"matchMedia\" in window ? matchMedia(query).matches : false;\n\t}\n\n\topera = window.opera && window.opera.buildNumber;\n\tandroid = /Android/.test(userAgent);\n\twebkit = /WebKit/.test(userAgent);\n\tie = !webkit && !opera && (/MSIE/gi).test(userAgent) && (/Explorer/gi).test(nav.appName);\n\tie = ie && /MSIE (\\w+)\\./.exec(userAgent)[1];\n\tie11 = userAgent.indexOf('Trident/') != -1 && (userAgent.indexOf('rv:') != -1 || nav.appName.indexOf('Netscape') != -1) ? 11 : false;\n\tie12 = (userAgent.indexOf('Edge/') != -1 && !ie && !ie11) ? 12 : false;\n\tie = ie || ie11 || ie12;\n\tgecko = !webkit && !ie11 && /Gecko/.test(userAgent);\n\tmac = userAgent.indexOf('Mac') != -1;\n\tiDevice = /(iPad|iPhone)/.test(userAgent);\n\tfileApi = \"FormData\" in window && \"FileReader\" in window && \"URL\" in window && !!URL.createObjectURL;\n\tphone = matchMediaQuery(\"only screen and (max-device-width: 480px)\") && (android || iDevice);\n\ttablet = matchMediaQuery(\"only screen and (min-width: 800px)\") && (android || iDevice);\n\twindowsPhone = userAgent.indexOf('Windows Phone') != -1;\n\n\tif (ie12) {\n\t\twebkit = false;\n\t}\n\n\t// Is a iPad/iPhone and not on iOS5 sniff the WebKit version since older iOS WebKit versions\n\t// says it has contentEditable support but there is no visible caret.\n\tvar contentEditable = !iDevice || fileApi || userAgent.match(/AppleWebKit\\/(\\d*)/)[1] >= 534;\n\n\treturn {\n\t\t/**\n\t\t * Constant that is true if the browser is Opera.\n\t\t *\n\t\t * @property opera\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\topera: opera,\n\n\t\t/**\n\t\t * Constant that is true if the browser is WebKit (Safari/Chrome).\n\t\t *\n\t\t * @property webKit\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\twebkit: webkit,\n\n\t\t/**\n\t\t * Constant that is more than zero if the browser is IE.\n\t\t *\n\t\t * @property ie\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tie: ie,\n\n\t\t/**\n\t\t * Constant that is true if the browser is Gecko.\n\t\t *\n\t\t * @property gecko\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tgecko: gecko,\n\n\t\t/**\n\t\t * Constant that is true if the os is Mac OS.\n\t\t *\n\t\t * @property mac\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tmac: mac,\n\n\t\t/**\n\t\t * Constant that is true if the os is iOS.\n\t\t *\n\t\t * @property iOS\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tiOS: iDevice,\n\n\t\t/**\n\t\t * Constant that is true if the os is android.\n\t\t *\n\t\t * @property android\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tandroid: android,\n\n\t\t/**\n\t\t * Constant that is true if the browser supports editing.\n\t\t *\n\t\t * @property contentEditable\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tcontentEditable: contentEditable,\n\n\t\t/**\n\t\t * Transparent image data url.\n\t\t *\n\t\t * @property transparentSrc\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\ttransparentSrc: \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\",\n\n\t\t/**\n\t\t * Returns true/false if the browser can or can't place the caret after a inline block like an image.\n\t\t *\n\t\t * @property noCaretAfter\n\t\t * @type Boolean\n\t\t * @final\n\t\t */\n\t\tcaretAfter: ie != 8,\n\n\t\t/**\n\t\t * Constant that is true if the browser supports native DOM Ranges. IE 9+.\n\t\t *\n\t\t * @property range\n\t\t * @type Boolean\n\t\t */\n\t\trange: window.getSelection && \"Range\" in window,\n\n\t\t/**\n\t\t * Returns the IE document mode for non IE browsers this will fake IE 10.\n\t\t *\n\t\t * @property documentMode\n\t\t * @type Number\n\t\t */\n\t\tdocumentMode: ie && !ie12 ? (document.documentMode || 7) : 10,\n\n\t\t/**\n\t\t * Constant that is true if the browser has a modern file api.\n\t\t *\n\t\t * @property fileApi\n\t\t * @type Boolean\n\t\t */\n\t\tfileApi: fileApi,\n\n\t\t/**\n\t\t * Constant that is true if the browser supports contentEditable=false regions.\n\t\t *\n\t\t * @property ceFalse\n\t\t * @type Boolean\n\t\t */\n\t\tceFalse: (ie === false || ie > 8),\n\n\t\t/**\n\t\t * Constant if CSP mode is possible or not. Meaning we can't use script urls for the iframe.\n\t\t */\n\t\tcanHaveCSP: (ie === false || ie > 11),\n\n\t\tdesktop: !phone && !tablet,\n\t\twindowsPhone: windowsPhone\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/EventUtils.js\n\n/**\n * EventUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*jshint loopfunc:true*/\n/*eslint no-loop-func:0 */\n\n/**\n * This class wraps the browsers native event logic with more convenient methods.\n *\n * @class tinymce.dom.EventUtils\n */\ndefine(\"tinymce/dom/EventUtils\", [\n\t\"tinymce/util/Delay\",\n\t\"tinymce/Env\"\n], function(Delay, Env) {\n\t\"use strict\";\n\n\tvar eventExpandoPrefix = \"mce-data-\";\n\tvar mouseEventRe = /^(?:mouse|contextmenu)|click/;\n\tvar deprecated = {\n\t\tkeyLocation: 1, layerX: 1, layerY: 1, returnValue: 1,\n\t\twebkitMovementX: 1, webkitMovementY: 1, keyIdentifier: 1\n\t};\n\n\t/**\n\t * Binds a native event to a callback on the speified target.\n\t */\n\tfunction addEvent(target, name, callback, capture) {\n\t\tif (target.addEventListener) {\n\t\t\ttarget.addEventListener(name, callback, capture || false);\n\t\t} else if (target.attachEvent) {\n\t\t\ttarget.attachEvent('on' + name, callback);\n\t\t}\n\t}\n\n\t/**\n\t * Unbinds a native event callback on the specified target.\n\t */\n\tfunction removeEvent(target, name, callback, capture) {\n\t\tif (target.removeEventListener) {\n\t\t\ttarget.removeEventListener(name, callback, capture || false);\n\t\t} else if (target.detachEvent) {\n\t\t\ttarget.detachEvent('on' + name, callback);\n\t\t}\n\t}\n\n\t/**\n\t * Gets the event target based on shadow dom properties like path and deepPath.\n\t */\n\tfunction getTargetFromShadowDom(event, defaultTarget) {\n\t\tvar path, target = defaultTarget;\n\n\t\t// When target element is inside Shadow DOM we need to take first element from path\n\t\t// otherwise we'll get Shadow Root parent, not actual target element\n\n\t\t// Normalize target for WebComponents v0 implementation (in Chrome)\n\t\tpath = event.path;\n\t\tif (path && path.length > 0) {\n\t\t\ttarget = path[0];\n\t\t}\n\n\t\t// Normalize target for WebComponents v1 implementation (standard)\n\t\tif (event.deepPath) {\n\t\t\tpath = event.deepPath();\n\t\t\tif (path && path.length > 0) {\n\t\t\t\ttarget = path[0];\n\t\t\t}\n\t\t}\n\n\t\treturn target;\n\t}\n\n\t/**\n\t * Normalizes a native event object or just adds the event specific methods on a custom event.\n\t */\n\tfunction fix(originalEvent, data) {\n\t\tvar name, event = data || {}, undef;\n\n\t\t// Dummy function that gets replaced on the delegation state functions\n\t\tfunction returnFalse() {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Dummy function that gets replaced on the delegation state functions\n\t\tfunction returnTrue() {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Copy all properties from the original event\n\t\tfor (name in originalEvent) {\n\t\t\t// layerX/layerY is deprecated in Chrome and produces a warning\n\t\t\tif (!deprecated[name]) {\n\t\t\t\tevent[name] = originalEvent[name];\n\t\t\t}\n\t\t}\n\n\t\t// Normalize target IE uses srcElement\n\t\tif (!event.target) {\n\t\t\tevent.target = event.srcElement || document;\n\t\t}\n\n\t\t// Experimental shadow dom support\n\t\tif (Env.experimentalShadowDom) {\n\t\t\tevent.target = getTargetFromShadowDom(originalEvent, event.target);\n\t\t}\n\n\t\t// Calculate pageX/Y if missing and clientX/Y available\n\t\tif (originalEvent && mouseEventRe.test(originalEvent.type) && originalEvent.pageX === undef && originalEvent.clientX !== undef) {\n\t\t\tvar eventDoc = event.target.ownerDocument || document;\n\t\t\tvar doc = eventDoc.documentElement;\n\t\t\tvar body = eventDoc.body;\n\n\t\t\tevent.pageX = originalEvent.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) -\n\t\t\t\t(doc && doc.clientLeft || body && body.clientLeft || 0);\n\n\t\t\tevent.pageY = originalEvent.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) -\n\t\t\t\t(doc && doc.clientTop || body && body.clientTop || 0);\n\t\t}\n\n\t\t// Add preventDefault method\n\t\tevent.preventDefault = function() {\n\t\t\tevent.isDefaultPrevented = returnTrue;\n\n\t\t\t// Execute preventDefault on the original event object\n\t\t\tif (originalEvent) {\n\t\t\t\tif (originalEvent.preventDefault) {\n\t\t\t\t\toriginalEvent.preventDefault();\n\t\t\t\t} else {\n\t\t\t\t\toriginalEvent.returnValue = false; // IE\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Add stopPropagation\n\t\tevent.stopPropagation = function() {\n\t\t\tevent.isPropagationStopped = returnTrue;\n\n\t\t\t// Execute stopPropagation on the original event object\n\t\t\tif (originalEvent) {\n\t\t\t\tif (originalEvent.stopPropagation) {\n\t\t\t\t\toriginalEvent.stopPropagation();\n\t\t\t\t} else {\n\t\t\t\t\toriginalEvent.cancelBubble = true; // IE\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Add stopImmediatePropagation\n\t\tevent.stopImmediatePropagation = function() {\n\t\t\tevent.isImmediatePropagationStopped = returnTrue;\n\t\t\tevent.stopPropagation();\n\t\t};\n\n\t\t// Add event delegation states\n\t\tif (!event.isDefaultPrevented) {\n\t\t\tevent.isDefaultPrevented = returnFalse;\n\t\t\tevent.isPropagationStopped = returnFalse;\n\t\t\tevent.isImmediatePropagationStopped = returnFalse;\n\t\t}\n\n\t\t// Add missing metaKey for IE 8\n\t\tif (typeof event.metaKey == 'undefined') {\n\t\t\tevent.metaKey = false;\n\t\t}\n\n\t\treturn event;\n\t}\n\n\t/**\n\t * Bind a DOMContentLoaded event across browsers and executes the callback once the page DOM is initialized.\n\t * It will also set/check the domLoaded state of the event_utils instance so ready isn't called multiple times.\n\t */\n\tfunction bindOnReady(win, callback, eventUtils) {\n\t\tvar doc = win.document, event = {type: 'ready'};\n\n\t\tif (eventUtils.domLoaded) {\n\t\t\tcallback(event);\n\t\t\treturn;\n\t\t}\n\n\t\t// Gets called when the DOM is ready\n\t\tfunction readyHandler() {\n\t\t\tif (!eventUtils.domLoaded) {\n\t\t\t\teventUtils.domLoaded = true;\n\t\t\t\tcallback(event);\n\t\t\t}\n\t\t}\n\n\t\tfunction waitForDomLoaded() {\n\t\t\t// Check complete or interactive state if there is a body\n\t\t\t// element on some iframes IE 8 will produce a null body\n\t\t\tif (doc.readyState === \"complete\" || (doc.readyState === \"interactive\" && doc.body)) {\n\t\t\t\tremoveEvent(doc, \"readystatechange\", waitForDomLoaded);\n\t\t\t\treadyHandler();\n\t\t\t}\n\t\t}\n\n\t\tfunction tryScroll() {\n\t\t\ttry {\n\t\t\t\t// If IE is used, use the trick by Diego Perini licensed under MIT by request to the author.\n\t\t\t\t// http://javascript.nwbox.com/IEContentLoaded/\n\t\t\t\tdoc.documentElement.doScroll(\"left\");\n\t\t\t} catch (ex) {\n\t\t\t\tDelay.setTimeout(tryScroll);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treadyHandler();\n\t\t}\n\n\t\t// Use W3C method\n\t\tif (doc.addEventListener) {\n\t\t\tif (doc.readyState === \"complete\") {\n\t\t\t\treadyHandler();\n\t\t\t} else {\n\t\t\t\taddEvent(win, 'DOMContentLoaded', readyHandler);\n\t\t\t}\n\t\t} else {\n\t\t\t// Use IE method\n\t\t\taddEvent(doc, \"readystatechange\", waitForDomLoaded);\n\n\t\t\t// Wait until we can scroll, when we can the DOM is initialized\n\t\t\tif (doc.documentElement.doScroll && win.self === win.top) {\n\t\t\t\ttryScroll();\n\t\t\t}\n\t\t}\n\n\t\t// Fallback if any of the above methods should fail for some odd reason\n\t\taddEvent(win, 'load', readyHandler);\n\t}\n\n\t/**\n\t * This class enables you to bind/unbind native events to elements and normalize it's behavior across browsers.\n\t */\n\tfunction EventUtils() {\n\t\tvar self = this, events = {}, count, expando, hasFocusIn, hasMouseEnterLeave, mouseEnterLeave;\n\n\t\texpando = eventExpandoPrefix + (+new Date()).toString(32);\n\t\thasMouseEnterLeave = \"onmouseenter\" in document.documentElement;\n\t\thasFocusIn = \"onfocusin\" in document.documentElement;\n\t\tmouseEnterLeave = {mouseenter: 'mouseover', mouseleave: 'mouseout'};\n\t\tcount = 1;\n\n\t\t// State if the DOMContentLoaded was executed or not\n\t\tself.domLoaded = false;\n\t\tself.events = events;\n\n\t\t/**\n\t\t * Executes all event handler callbacks for a specific event.\n\t\t *\n\t\t * @private\n\t\t * @param {Event} evt Event object.\n\t\t * @param {String} id Expando id value to look for.\n\t\t */\n\t\tfunction executeHandlers(evt, id) {\n\t\t\tvar callbackList, i, l, callback, container = events[id];\n\n\t\t\tcallbackList = container && container[evt.type];\n\t\t\tif (callbackList) {\n\t\t\t\tfor (i = 0, l = callbackList.length; i < l; i++) {\n\t\t\t\t\tcallback = callbackList[i];\n\n\t\t\t\t\t// Check if callback exists might be removed if a unbind is called inside the callback\n\t\t\t\t\tif (callback && callback.func.call(callback.scope, evt) === false) {\n\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Should we stop propagation to immediate listeners\n\t\t\t\t\tif (evt.isImmediatePropagationStopped()) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Binds a callback to an event on the specified target.\n\t\t *\n\t\t * @method bind\n\t\t * @param {Object} target Target node/window or custom object.\n\t\t * @param {String} names Name of the event to bind.\n\t\t * @param {function} callback Callback function to execute when the event occurs.\n\t\t * @param {Object} scope Scope to call the callback function on, defaults to target.\n\t\t * @return {function} Callback function that got bound.\n\t\t */\n\t\tself.bind = function(target, names, callback, scope) {\n\t\t\tvar id, callbackList, i, name, fakeName, nativeHandler, capture, win = window;\n\n\t\t\t// Native event handler function patches the event and executes the callbacks for the expando\n\t\t\tfunction defaultNativeHandler(evt) {\n\t\t\t\texecuteHandlers(fix(evt || win.event), id);\n\t\t\t}\n\n\t\t\t// Don't bind to text nodes or comments\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Create or get events id for the target\n\t\t\tif (!target[expando]) {\n\t\t\t\tid = count++;\n\t\t\t\ttarget[expando] = id;\n\t\t\t\tevents[id] = {};\n\t\t\t} else {\n\t\t\t\tid = target[expando];\n\t\t\t}\n\n\t\t\t// Setup the specified scope or use the target as a default\n\t\t\tscope = scope || target;\n\n\t\t\t// Split names and bind each event, enables you to bind multiple events with one call\n\t\t\tnames = names.split(' ');\n\t\t\ti = names.length;\n\t\t\twhile (i--) {\n\t\t\t\tname = names[i];\n\t\t\t\tnativeHandler = defaultNativeHandler;\n\t\t\t\tfakeName = capture = false;\n\n\t\t\t\t// Use ready instead of DOMContentLoaded\n\t\t\t\tif (name === \"DOMContentLoaded\") {\n\t\t\t\t\tname = \"ready\";\n\t\t\t\t}\n\n\t\t\t\t// DOM is already ready\n\t\t\t\tif (self.domLoaded && name === \"ready\" && target.readyState == 'complete') {\n\t\t\t\t\tcallback.call(scope, fix({type: name}));\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Handle mouseenter/mouseleaver\n\t\t\t\tif (!hasMouseEnterLeave) {\n\t\t\t\t\tfakeName = mouseEnterLeave[name];\n\n\t\t\t\t\tif (fakeName) {\n\t\t\t\t\t\tnativeHandler = function(evt) {\n\t\t\t\t\t\t\tvar current, related;\n\n\t\t\t\t\t\t\tcurrent = evt.currentTarget;\n\t\t\t\t\t\t\trelated = evt.relatedTarget;\n\n\t\t\t\t\t\t\t// Check if related is inside the current target if it's not then the event should\n\t\t\t\t\t\t\t// be ignored since it's a mouseover/mouseout inside the element\n\t\t\t\t\t\t\tif (related && current.contains) {\n\t\t\t\t\t\t\t\t// Use contains for performance\n\t\t\t\t\t\t\t\trelated = current.contains(related);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\twhile (related && related !== current) {\n\t\t\t\t\t\t\t\t\trelated = related.parentNode;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Fire fake event\n\t\t\t\t\t\t\tif (!related) {\n\t\t\t\t\t\t\t\tevt = fix(evt || win.event);\n\t\t\t\t\t\t\t\tevt.type = evt.type === 'mouseout' ? 'mouseleave' : 'mouseenter';\n\t\t\t\t\t\t\t\tevt.target = current;\n\t\t\t\t\t\t\t\texecuteHandlers(evt, id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Fake bubbling of focusin/focusout\n\t\t\t\tif (!hasFocusIn && (name === \"focusin\" || name === \"focusout\")) {\n\t\t\t\t\tcapture = true;\n\t\t\t\t\tfakeName = name === \"focusin\" ? \"focus\" : \"blur\";\n\t\t\t\t\tnativeHandler = function(evt) {\n\t\t\t\t\t\tevt = fix(evt || win.event);\n\t\t\t\t\t\tevt.type = evt.type === 'focus' ? 'focusin' : 'focusout';\n\t\t\t\t\t\texecuteHandlers(evt, id);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Setup callback list and bind native event\n\t\t\t\tcallbackList = events[id][name];\n\t\t\t\tif (!callbackList) {\n\t\t\t\t\tevents[id][name] = callbackList = [{func: callback, scope: scope}];\n\t\t\t\t\tcallbackList.fakeName = fakeName;\n\t\t\t\t\tcallbackList.capture = capture;\n\t\t\t\t\t//callbackList.callback = callback;\n\n\t\t\t\t\t// Add the nativeHandler to the callback list so that we can later unbind it\n\t\t\t\t\tcallbackList.nativeHandler = nativeHandler;\n\n\t\t\t\t\t// Check if the target has native events support\n\n\t\t\t\t\tif (name === \"ready\") {\n\t\t\t\t\t\tbindOnReady(target, nativeHandler, self);\n\t\t\t\t\t} else {\n\t\t\t\t\t\taddEvent(target, fakeName || name, nativeHandler, capture);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (name === \"ready\" && self.domLoaded) {\n\t\t\t\t\t\tcallback({type: name});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If it already has an native handler then just push the callback\n\t\t\t\t\t\tcallbackList.push({func: callback, scope: scope});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttarget = callbackList = 0; // Clean memory for IE\n\n\t\t\treturn callback;\n\t\t};\n\n\t\t/**\n\t\t * Unbinds the specified event by name, name and callback or all events on the target.\n\t\t *\n\t\t * @method unbind\n\t\t * @param {Object} target Target node/window or custom object.\n\t\t * @param {String} names Optional event name to unbind.\n\t\t * @param {function} callback Optional callback function to unbind.\n\t\t * @return {EventUtils} Event utils instance.\n\t\t */\n\t\tself.unbind = function(target, names, callback) {\n\t\t\tvar id, callbackList, i, ci, name, eventMap;\n\n\t\t\t// Don't bind to text nodes or comments\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\t// Unbind event or events if the target has the expando\n\t\t\tid = target[expando];\n\t\t\tif (id) {\n\t\t\t\teventMap = events[id];\n\n\t\t\t\t// Specific callback\n\t\t\t\tif (names) {\n\t\t\t\t\tnames = names.split(' ');\n\t\t\t\t\ti = names.length;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tname = names[i];\n\t\t\t\t\t\tcallbackList = eventMap[name];\n\n\t\t\t\t\t\t// Unbind the event if it exists in the map\n\t\t\t\t\t\tif (callbackList) {\n\t\t\t\t\t\t\t// Remove specified callback\n\t\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\t\tci = callbackList.length;\n\t\t\t\t\t\t\t\twhile (ci--) {\n\t\t\t\t\t\t\t\t\tif (callbackList[ci].func === callback) {\n\t\t\t\t\t\t\t\t\t\tvar nativeHandler = callbackList.nativeHandler;\n\t\t\t\t\t\t\t\t\t\tvar fakeName = callbackList.fakeName, capture = callbackList.capture;\n\n\t\t\t\t\t\t\t\t\t\t// Clone callbackList since unbind inside a callback would otherwise break the handlers loop\n\t\t\t\t\t\t\t\t\t\tcallbackList = callbackList.slice(0, ci).concat(callbackList.slice(ci + 1));\n\t\t\t\t\t\t\t\t\t\tcallbackList.nativeHandler = nativeHandler;\n\t\t\t\t\t\t\t\t\t\tcallbackList.fakeName = fakeName;\n\t\t\t\t\t\t\t\t\t\tcallbackList.capture = capture;\n\n\t\t\t\t\t\t\t\t\t\teventMap[name] = callbackList;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Remove all callbacks if there isn't a specified callback or there is no callbacks left\n\t\t\t\t\t\t\tif (!callback || callbackList.length === 0) {\n\t\t\t\t\t\t\t\tdelete eventMap[name];\n\t\t\t\t\t\t\t\tremoveEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// All events for a specific element\n\t\t\t\t\tfor (name in eventMap) {\n\t\t\t\t\t\tcallbackList = eventMap[name];\n\t\t\t\t\t\tremoveEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\n\t\t\t\t\t}\n\n\t\t\t\t\teventMap = {};\n\t\t\t\t}\n\n\t\t\t\t// Check if object is empty, if it isn't then we won't remove the expando map\n\t\t\t\tfor (name in eventMap) {\n\t\t\t\t\treturn self;\n\t\t\t\t}\n\n\t\t\t\t// Delete event object\n\t\t\t\tdelete events[id];\n\n\t\t\t\t// Remove expando from target\n\t\t\t\ttry {\n\t\t\t\t\t// IE will fail here since it can't delete properties from window\n\t\t\t\t\tdelete target[expando];\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// IE will set it to null\n\t\t\t\t\ttarget[expando] = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self;\n\t\t};\n\n\t\t/**\n\t\t * Fires the specified event on the specified target.\n\t\t *\n\t\t * @method fire\n\t\t * @param {Object} target Target node/window or custom object.\n\t\t * @param {String} name Event name to fire.\n\t\t * @param {Object} args Optional arguments to send to the observers.\n\t\t * @return {EventUtils} Event utils instance.\n\t\t */\n\t\tself.fire = function(target, name, args) {\n\t\t\tvar id;\n\n\t\t\t// Don't bind to text nodes or comments\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\t// Build event object by patching the args\n\t\t\targs = fix(null, args);\n\t\t\targs.type = name;\n\t\t\targs.target = target;\n\n\t\t\tdo {\n\t\t\t\t// Found an expando that means there is listeners to execute\n\t\t\t\tid = target[expando];\n\t\t\t\tif (id) {\n\t\t\t\t\texecuteHandlers(args, id);\n\t\t\t\t}\n\n\t\t\t\t// Walk up the DOM\n\t\t\t\ttarget = target.parentNode || target.ownerDocument || target.defaultView || target.parentWindow;\n\t\t\t} while (target && !args.isPropagationStopped());\n\n\t\t\treturn self;\n\t\t};\n\n\t\t/**\n\t\t * Removes all bound event listeners for the specified target. This will also remove any bound\n\t\t * listeners to child nodes within that target.\n\t\t *\n\t\t * @method clean\n\t\t * @param {Object} target Target node/window object.\n\t\t * @return {EventUtils} Event utils instance.\n\t\t */\n\t\tself.clean = function(target) {\n\t\t\tvar i, children, unbind = self.unbind;\n\n\t\t\t// Don't bind to text nodes or comments\n\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\t// Unbind any element on the specified target\n\t\t\tif (target[expando]) {\n\t\t\t\tunbind(target);\n\t\t\t}\n\n\t\t\t// Target doesn't have getElementsByTagName it's probably a window object then use it's document to find the children\n\t\t\tif (!target.getElementsByTagName) {\n\t\t\t\ttarget = target.document;\n\t\t\t}\n\n\t\t\t// Remove events from each child element\n\t\t\tif (target && target.getElementsByTagName) {\n\t\t\t\tunbind(target);\n\n\t\t\t\tchildren = target.getElementsByTagName('*');\n\t\t\t\ti = children.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\ttarget = children[i];\n\n\t\t\t\t\tif (target[expando]) {\n\t\t\t\t\t\tunbind(target);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self;\n\t\t};\n\n\t\t/**\n\t\t * Destroys the event object. Call this on IE to remove memory leaks.\n\t\t */\n\t\tself.destroy = function() {\n\t\t\tevents = {};\n\t\t};\n\n\t\t// Legacy function for canceling events\n\t\tself.cancel = function(e) {\n\t\t\tif (e) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t}\n\n\tEventUtils.Event = new EventUtils();\n\tEventUtils.Event.bind(window, 'ready', function() {});\n\n\treturn EventUtils;\n});\n\n// Included from: js/tinymce/classes/dom/Sizzle.js\n\n/**\n * Sizzle.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n *\n * @ignore-file\n */\n\n/*jshint bitwise:false, expr:true, noempty:false, sub:true, eqnull:true, latedef:false, maxlen:255 */\n/*eslint-disable */\n\n/**\n * Sizzle CSS Selector Engine v@VERSION\n * http://sizzlejs.com/\n *\n * Copyright 2008, 2014 jQuery Foundation, Inc. and other contributors\n * Released under the MIT license\n * http://jquery.org/license\n *\n * Date: @DATE\n */\ndefine(\"tinymce/dom/Sizzle\", [], function() {\nvar i,\n\tsupport,\n\tExpr,\n\tgetText,\n\tisXML,\n\ttokenize,\n\tcompile,\n\tselect,\n\toutermostContext,\n\tsortInput,\n\thasDuplicate,\n\n\t// Local document vars\n\tsetDocument,\n\tdocument,\n\tdocElem,\n\tdocumentIsHTML,\n\trbuggyQSA,\n\trbuggyMatches,\n\tmatches,\n\tcontains,\n\n\t// Instance-specific data\n\texpando = \"sizzle\" + -(new Date()),\n\tpreferredDoc = window.document,\n\tdirruns = 0,\n\tdone = 0,\n\tclassCache = createCache(),\n\ttokenCache = createCache(),\n\tcompilerCache = createCache(),\n\tsortOrder = function( a, b ) {\n\t\tif ( a === b ) {\n\t\t\thasDuplicate = true;\n\t\t}\n\t\treturn 0;\n\t},\n\n\t// General-purpose constants\n\tstrundefined = typeof undefined,\n\tMAX_NEGATIVE = 1 << 31,\n\n\t// Instance methods\n\thasOwn = ({}).hasOwnProperty,\n\tarr = [],\n\tpop = arr.pop,\n\tpush_native = arr.push,\n\tpush = arr.push,\n\tslice = arr.slice,\n\t// Use a stripped-down indexOf if we can't use a native one\n\tindexOf = arr.indexOf || function( elem ) {\n\t\tvar i = 0,\n\t\t\tlen = this.length;\n\t\tfor ( ; i < len; i++ ) {\n\t\t\tif ( this[i] === elem ) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t},\n\n\tbooleans = \"checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped\",\n\n\t// Regular expressions\n\n\t// http://www.w3.org/TR/css3-selectors/#whitespace\n\twhitespace = \"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",\n\n\t// http://www.w3.org/TR/CSS21/syndata.html#value-def-identifier\n\tidentifier = \"(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+\",\n\n\t// Attribute selectors: http://www.w3.org/TR/selectors/#attribute-selectors\n\tattributes = \"\\\\[\" + whitespace + \"*(\" + identifier + \")(?:\" + whitespace +\n\t\t// Operator (capture 2)\n\t\t\"*([*^$|!~]?=)\" + whitespace +\n\t\t// \"Attribute values must be CSS identifiers [capture 5] or strings [capture 3 or capture 4]\"\n\t\t\"*(?:'((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\"|(\" + identifier + \"))|)\" + whitespace +\n\t\t\"*\\\\]\",\n\n\tpseudos = \":(\" + identifier + \")(?:\\\\((\" +\n\t\t// To reduce the number of selectors needing tokenize in the preFilter, prefer arguments:\n\t\t// 1. quoted (capture 3; capture 4 or capture 5)\n\t\t\"('((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\")|\" +\n\t\t// 2. simple (capture 6)\n\t\t\"((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\" + attributes + \")*)|\" +\n\t\t// 3. anything else (capture 2)\n\t\t\".*\" +\n\t\t\")\\\\)|)\",\n\n\t// Leading and non-escaped trailing whitespace, capturing some non-whitespace characters preceding the latter\n\trtrim = new RegExp( \"^\" + whitespace + \"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\" + whitespace + \"+$\", \"g\" ),\n\n\trcomma = new RegExp( \"^\" + whitespace + \"*,\" + whitespace + \"*\" ),\n\trcombinators = new RegExp( \"^\" + whitespace + \"*([>+~]|\" + whitespace + \")\" + whitespace + \"*\" ),\n\n\trattributeQuotes = new RegExp( \"=\" + whitespace + \"*([^\\\\]'\\\"]*?)\" + whitespace + \"*\\\\]\", \"g\" ),\n\n\trpseudo = new RegExp( pseudos ),\n\tridentifier = new RegExp( \"^\" + identifier + \"$\" ),\n\n\tmatchExpr = {\n\t\t\"ID\": new RegExp( \"^#(\" + identifier + \")\" ),\n\t\t\"CLASS\": new RegExp( \"^\\\\.(\" + identifier + \")\" ),\n\t\t\"TAG\": new RegExp( \"^(\" + identifier + \"|[*])\" ),\n\t\t\"ATTR\": new RegExp( \"^\" + attributes ),\n\t\t\"PSEUDO\": new RegExp( \"^\" + pseudos ),\n\t\t\"CHILD\": new RegExp( \"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\" + whitespace +\n\t\t\t\"*(even|odd|(([+-]|)(\\\\d*)n|)\" + whitespace + \"*(?:([+-]|)\" + whitespace +\n\t\t\t\"*(\\\\d+)|))\" + whitespace + \"*\\\\)|)\", \"i\" ),\n\t\t\"bool\": new RegExp( \"^(?:\" + booleans + \")$\", \"i\" ),\n\t\t// For use in libraries implementing .is()\n\t\t// We use this for POS matching in `select`\n\t\t\"needsContext\": new RegExp( \"^\" + whitespace + \"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\" +\n\t\t\twhitespace + \"*((?:-\\\\d)?\\\\d*)\" + whitespace + \"*\\\\)|)(?=[^-]|$)\", \"i\" )\n\t},\n\n\trinputs = /^(?:input|select|textarea|button)$/i,\n\trheader = /^h\\d$/i,\n\n\trnative = /^[^{]+\\{\\s*\\[native \\w/,\n\n\t// Easily-parseable/retrievable ID or TAG or CLASS selectors\n\trquickExpr = /^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,\n\n\trsibling = /[+~]/,\n\trescape = /'|\\\\/g,\n\n\t// CSS escapes http://www.w3.org/TR/CSS21/syndata.html#escaped-characters\n\trunescape = new RegExp( \"\\\\\\\\([\\\\da-f]{1,6}\" + whitespace + \"?|(\" + whitespace + \")|.)\", \"ig\" ),\n\tfunescape = function( _, escaped, escapedWhitespace ) {\n\t\tvar high = \"0x\" + escaped - 0x10000;\n\t\t// NaN means non-codepoint\n\t\t// Support: Firefox<24\n\t\t// Workaround erroneous numeric interpretation of +\"0x\"\n\t\treturn high !== high || escapedWhitespace ?\n\t\t\tescaped :\n\t\t\thigh < 0 ?\n\t\t\t\t// BMP codepoint\n\t\t\t\tString.fromCharCode( high + 0x10000 ) :\n\t\t\t\t// Supplemental Plane codepoint (surrogate pair)\n\t\t\t\tString.fromCharCode( high >> 10 | 0xD800, high & 0x3FF | 0xDC00 );\n\t};\n\n// Optimize for push.apply( _, NodeList )\ntry {\n\tpush.apply(\n\t\t(arr = slice.call( preferredDoc.childNodes )),\n\t\tpreferredDoc.childNodes\n\t);\n\t// Support: Android<4.0\n\t// Detect silently failing push.apply\n\tarr[ preferredDoc.childNodes.length ].nodeType;\n} catch ( e ) {\n\tpush = { apply: arr.length ?\n\n\t\t// Leverage slice if possible\n\t\tfunction( target, els ) {\n\t\t\tpush_native.apply( target, slice.call(els) );\n\t\t} :\n\n\t\t// Support: IE<9\n\t\t// Otherwise append directly\n\t\tfunction( target, els ) {\n\t\t\tvar j = target.length,\n\t\t\t\ti = 0;\n\t\t\t// Can't trust NodeList.length\n\t\t\twhile ( (target[j++] = els[i++]) ) {}\n\t\t\ttarget.length = j - 1;\n\t\t}\n\t};\n}\n\nfunction Sizzle( selector, context, results, seed ) {\n\tvar match, elem, m, nodeType,\n\t\t// QSA vars\n\t\ti, groups, old, nid, newContext, newSelector;\n\n\tif ( ( context ? context.ownerDocument || context : preferredDoc ) !== document ) {\n\t\tsetDocument( context );\n\t}\n\n\tcontext = context || document;\n\tresults = results || [];\n\n\tif ( !selector || typeof selector !== \"string\" ) {\n\t\treturn results;\n\t}\n\n\tif ( (nodeType = context.nodeType) !== 1 && nodeType !== 9 ) {\n\t\treturn [];\n\t}\n\n\tif ( documentIsHTML && !seed ) {\n\n\t\t// Shortcuts\n\t\tif ( (match = rquickExpr.exec( selector )) ) {\n\t\t\t// Speed-up: Sizzle(\"#ID\")\n\t\t\tif ( (m = match[1]) ) {\n\t\t\t\tif ( nodeType === 9 ) {\n\t\t\t\t\telem = context.getElementById( m );\n\t\t\t\t\t// Check parentNode to catch when Blackberry 4.6 returns\n\t\t\t\t\t// nodes that are no longer in the document (jQuery #6963)\n\t\t\t\t\tif ( elem && elem.parentNode ) {\n\t\t\t\t\t\t// Handle the case where IE, Opera, and Webkit return items\n\t\t\t\t\t\t// by name instead of ID\n\t\t\t\t\t\tif ( elem.id === m ) {\n\t\t\t\t\t\t\tresults.push( elem );\n\t\t\t\t\t\t\treturn results;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Context is not a document\n\t\t\t\t\tif ( context.ownerDocument && (elem = context.ownerDocument.getElementById( m )) &&\n\t\t\t\t\t\tcontains( context, elem ) && elem.id === m ) {\n\t\t\t\t\t\tresults.push( elem );\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t// Speed-up: Sizzle(\"TAG\")\n\t\t\t} else if ( match[2] ) {\n\t\t\t\tpush.apply( results, context.getElementsByTagName( selector ) );\n\t\t\t\treturn results;\n\n\t\t\t// Speed-up: Sizzle(\".CLASS\")\n\t\t\t} else if ( (m = match[3]) && support.getElementsByClassName ) {\n\t\t\t\tpush.apply( results, context.getElementsByClassName( m ) );\n\t\t\t\treturn results;\n\t\t\t}\n\t\t}\n\n\t\t// QSA path\n\t\tif ( support.qsa && (!rbuggyQSA || !rbuggyQSA.test( selector )) ) {\n\t\t\tnid = old = expando;\n\t\t\tnewContext = context;\n\t\t\tnewSelector = nodeType === 9 && selector;\n\n\t\t\t// qSA works strangely on Element-rooted queries\n\t\t\t// We can work around this by specifying an extra ID on the root\n\t\t\t// and working up from there (Thanks to Andrew Dupont for the technique)\n\t\t\t// IE 8 doesn't work on object elements\n\t\t\tif ( nodeType === 1 && context.nodeName.toLowerCase() !== \"object\" ) {\n\t\t\t\tgroups = tokenize( selector );\n\n\t\t\t\tif ( (old = context.getAttribute(\"id\")) ) {\n\t\t\t\t\tnid = old.replace( rescape, \"\\\\$&\" );\n\t\t\t\t} else {\n\t\t\t\t\tcontext.setAttribute( \"id\", nid );\n\t\t\t\t}\n\t\t\t\tnid = \"[id='\" + nid + \"'] \";\n\n\t\t\t\ti = groups.length;\n\t\t\t\twhile ( i-- ) {\n\t\t\t\t\tgroups[i] = nid + toSelector( groups[i] );\n\t\t\t\t}\n\t\t\t\tnewContext = rsibling.test( selector ) && testContext( context.parentNode ) || context;\n\t\t\t\tnewSelector = groups.join(\",\");\n\t\t\t}\n\n\t\t\tif ( newSelector ) {\n\t\t\t\ttry {\n\t\t\t\t\tpush.apply( results,\n\t\t\t\t\t\tnewContext.querySelectorAll( newSelector )\n\t\t\t\t\t);\n\t\t\t\t\treturn results;\n\t\t\t\t} catch(qsaError) {\n\t\t\t\t} finally {\n\t\t\t\t\tif ( !old ) {\n\t\t\t\t\t\tcontext.removeAttribute(\"id\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// All others\n\treturn select( selector.replace( rtrim, \"$1\" ), context, results, seed );\n}\n\n/**\n * Create key-value caches of limited size\n * @returns {Function(string, Object)} Returns the Object data after storing it on itself with\n *\tproperty name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)\n *\tdeleting the oldest entry\n */\nfunction createCache() {\n\tvar keys = [];\n\n\tfunction cache( key, value ) {\n\t\t// Use (key + \" \") to avoid collision with native prototype properties (see Issue #157)\n\t\tif ( keys.push( key + \" \" ) > Expr.cacheLength ) {\n\t\t\t// Only keep the most recent entries\n\t\t\tdelete cache[ keys.shift() ];\n\t\t}\n\t\treturn (cache[ key + \" \" ] = value);\n\t}\n\treturn cache;\n}\n\n/**\n * Mark a function for special use by Sizzle\n * @param {Function} fn The function to mark\n */\nfunction markFunction( fn ) {\n\tfn[ expando ] = true;\n\treturn fn;\n}\n\n/**\n * Support testing using an element\n * @param {Function} fn Passed the created div and expects a boolean result\n */\nfunction assert( fn ) {\n\tvar div = document.createElement(\"div\");\n\n\ttry {\n\t\treturn !!fn( div );\n\t} catch (e) {\n\t\treturn false;\n\t} finally {\n\t\t// Remove from its parent by default\n\t\tif ( div.parentNode ) {\n\t\t\tdiv.parentNode.removeChild( div );\n\t\t}\n\t\t// release memory in IE\n\t\tdiv = null;\n\t}\n}\n\n/**\n * Adds the same handler for all of the specified attrs\n * @param {String} attrs Pipe-separated list of attributes\n * @param {Function} handler The method that will be applied\n */\nfunction addHandle( attrs, handler ) {\n\tvar arr = attrs.split(\"|\"),\n\t\ti = attrs.length;\n\n\twhile ( i-- ) {\n\t\tExpr.attrHandle[ arr[i] ] = handler;\n\t}\n}\n\n/**\n * Checks document order of two siblings\n * @param {Element} a\n * @param {Element} b\n * @returns {Number} Returns less than 0 if a precedes b, greater than 0 if a follows b\n */\nfunction siblingCheck( a, b ) {\n\tvar cur = b && a,\n\t\tdiff = cur && a.nodeType === 1 && b.nodeType === 1 &&\n\t\t\t( ~b.sourceIndex || MAX_NEGATIVE ) -\n\t\t\t( ~a.sourceIndex || MAX_NEGATIVE );\n\n\t// Use IE sourceIndex if available on both nodes\n\tif ( diff ) {\n\t\treturn diff;\n\t}\n\n\t// Check if b follows a\n\tif ( cur ) {\n\t\twhile ( (cur = cur.nextSibling) ) {\n\t\t\tif ( cur === b ) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn a ? 1 : -1;\n}\n\n/**\n * Returns a function to use in pseudos for input types\n * @param {String} type\n */\nfunction createInputPseudo( type ) {\n\treturn function( elem ) {\n\t\tvar name = elem.nodeName.toLowerCase();\n\t\treturn name === \"input\" && elem.type === type;\n\t};\n}\n\n/**\n * Returns a function to use in pseudos for buttons\n * @param {String} type\n */\nfunction createButtonPseudo( type ) {\n\treturn function( elem ) {\n\t\tvar name = elem.nodeName.toLowerCase();\n\t\treturn (name === \"input\" || name === \"button\") && elem.type === type;\n\t};\n}\n\n/**\n * Returns a function to use in pseudos for positionals\n * @param {Function} fn\n */\nfunction createPositionalPseudo( fn ) {\n\treturn markFunction(function( argument ) {\n\t\targument = +argument;\n\t\treturn markFunction(function( seed, matches ) {\n\t\t\tvar j,\n\t\t\t\tmatchIndexes = fn( [], seed.length, argument ),\n\t\t\t\ti = matchIndexes.length;\n\n\t\t\t// Match elements found at the specified indexes\n\t\t\twhile ( i-- ) {\n\t\t\t\tif ( seed[ (j = matchIndexes[i]) ] ) {\n\t\t\t\t\tseed[j] = !(matches[j] = seed[j]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n}\n\n/**\n * Checks a node for validity as a Sizzle context\n * @param {Element|Object=} context\n * @returns {Element|Object|Boolean} The input node if acceptable, otherwise a falsy value\n */\nfunction testContext( context ) {\n\treturn context && typeof context.getElementsByTagName !== strundefined && context;\n}\n\n// Expose support vars for convenience\nsupport = Sizzle.support = {};\n\n/**\n * Detects XML nodes\n * @param {Element|Object} elem An element or a document\n * @returns {Boolean} True iff elem is a non-HTML XML node\n */\nisXML = Sizzle.isXML = function( elem ) {\n\t// documentElement is verified for cases where it doesn't yet exist\n\t// (such as loading iframes in IE - #4833)\n\tvar documentElement = elem && (elem.ownerDocument || elem).documentElement;\n\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\n};\n\n/**\n * Sets document-related variables once based on the current document\n * @param {Element|Object} [doc] An element or document object to use to set the document\n * @returns {Object} Returns the current document\n */\nsetDocument = Sizzle.setDocument = function( node ) {\n\tvar hasCompare,\n\t\tdoc = node ? node.ownerDocument || node : preferredDoc,\n\t\tparent = doc.defaultView;\n\n\tfunction getTop(win) {\n\t\t// Edge throws a lovely Object expected if you try to get top on a detached reference see #2642\n\t\ttry {\n\t\t\treturn win.top;\n\t\t} catch (ex) {\n\t\t\t// Ignore\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t// If no document and documentElement is available, return\n\tif ( doc === document || doc.nodeType !== 9 || !doc.documentElement ) {\n\t\treturn document;\n\t}\n\n\t// Set our document\n\tdocument = doc;\n\tdocElem = doc.documentElement;\n\n\t// Support tests\n\tdocumentIsHTML = !isXML( doc );\n\n\t// Support: IE>8\n\t// If iframe document is assigned to \"document\" variable and if iframe has been reloaded,\n\t// IE will throw \"permission denied\" error when accessing \"document\" variable, see jQuery #13936\n\t// IE6-8 do not support the defaultView property so parent will be undefined\n\tif ( parent && parent !== getTop(parent) ) {\n\t\t// IE11 does not have attachEvent, so all must suffer\n\t\tif ( parent.addEventListener ) {\n\t\t\tparent.addEventListener( \"unload\", function() {\n\t\t\t\tsetDocument();\n\t\t\t}, false );\n\t\t} else if ( parent.attachEvent ) {\n\t\t\tparent.attachEvent( \"onunload\", function() {\n\t\t\t\tsetDocument();\n\t\t\t});\n\t\t}\n\t}\n\n\t/* Attributes\n\t---------------------------------------------------------------------- */\n\n\t// Support: IE<8\n\t// Verify that getAttribute really returns attributes and not properties (excepting IE8 booleans)\n\tsupport.attributes = assert(function( div ) {\n\t\tdiv.className = \"i\";\n\t\treturn !div.getAttribute(\"className\");\n\t});\n\n\t/* getElement(s)By*\n\t---------------------------------------------------------------------- */\n\n\t// Check if getElementsByTagName(\"*\") returns only elements\n\tsupport.getElementsByTagName = assert(function( div ) {\n\t\tdiv.appendChild( doc.createComment(\"\") );\n\t\treturn !div.getElementsByTagName(\"*\").length;\n\t});\n\n\t// Support: IE<9\n\tsupport.getElementsByClassName = rnative.test( doc.getElementsByClassName );\n\n\t// Support: IE<10\n\t// Check if getElementById returns elements by name\n\t// The broken getElementById methods don't pick up programatically-set names,\n\t// so use a roundabout getElementsByName test\n\tsupport.getById = assert(function( div ) {\n\t\tdocElem.appendChild( div ).id = expando;\n\t\treturn !doc.getElementsByName || !doc.getElementsByName( expando ).length;\n\t});\n\n\t// ID find and filter\n\tif ( support.getById ) {\n\t\tExpr.find[\"ID\"] = function( id, context ) {\n\t\t\tif ( typeof context.getElementById !== strundefined && documentIsHTML ) {\n\t\t\t\tvar m = context.getElementById( id );\n\t\t\t\t// Check parentNode to catch when Blackberry 4.6 returns\n\t\t\t\t// nodes that are no longer in the document #6963\n\t\t\t\treturn m && m.parentNode ? [ m ] : [];\n\t\t\t}\n\t\t};\n\t\tExpr.filter[\"ID\"] = function( id ) {\n\t\t\tvar attrId = id.replace( runescape, funescape );\n\t\t\treturn function( elem ) {\n\t\t\t\treturn elem.getAttribute(\"id\") === attrId;\n\t\t\t};\n\t\t};\n\t} else {\n\t\t// Support: IE6/7\n\t\t// getElementById is not reliable as a find shortcut\n\t\tdelete Expr.find[\"ID\"];\n\n\t\tExpr.filter[\"ID\"] =  function( id ) {\n\t\t\tvar attrId = id.replace( runescape, funescape );\n\t\t\treturn function( elem ) {\n\t\t\t\tvar node = typeof elem.getAttributeNode !== strundefined && elem.getAttributeNode(\"id\");\n\t\t\t\treturn node && node.value === attrId;\n\t\t\t};\n\t\t};\n\t}\n\n\t// Tag\n\tExpr.find[\"TAG\"] = support.getElementsByTagName ?\n\t\tfunction( tag, context ) {\n\t\t\tif ( typeof context.getElementsByTagName !== strundefined ) {\n\t\t\t\treturn context.getElementsByTagName( tag );\n\t\t\t}\n\t\t} :\n\t\tfunction( tag, context ) {\n\t\t\tvar elem,\n\t\t\t\ttmp = [],\n\t\t\t\ti = 0,\n\t\t\t\tresults = context.getElementsByTagName( tag );\n\n\t\t\t// Filter out possible comments\n\t\t\tif ( tag === \"*\" ) {\n\t\t\t\twhile ( (elem = results[i++]) ) {\n\t\t\t\t\tif ( elem.nodeType === 1 ) {\n\t\t\t\t\t\ttmp.push( elem );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn tmp;\n\t\t\t}\n\t\t\treturn results;\n\t\t};\n\n\t// Class\n\tExpr.find[\"CLASS\"] = support.getElementsByClassName && function( className, context ) {\n\t\tif ( documentIsHTML ) {\n\t\t\treturn context.getElementsByClassName( className );\n\t\t}\n\t};\n\n\t/* QSA/matchesSelector\n\t---------------------------------------------------------------------- */\n\n\t// QSA and matchesSelector support\n\n\t// matchesSelector(:active) reports false when true (IE9/Opera 11.5)\n\trbuggyMatches = [];\n\n\t// qSa(:focus) reports false when true (Chrome 21)\n\t// We allow this because of a bug in IE8/9 that throws an error\n\t// whenever `document.activeElement` is accessed on an iframe\n\t// So, we allow :focus to pass through QSA all the time to avoid the IE error\n\t// See http://bugs.jquery.com/ticket/13378\n\trbuggyQSA = [];\n\n\tif ( (support.qsa = rnative.test( doc.querySelectorAll )) ) {\n\t\t// Build QSA regex\n\t\t// Regex strategy adopted from Diego Perini\n\t\tassert(function( div ) {\n\t\t\t// Select is set to empty string on purpose\n\t\t\t// This is to test IE's treatment of not explicitly\n\t\t\t// setting a boolean content attribute,\n\t\t\t// since its presence should be enough\n\t\t\t// http://bugs.jquery.com/ticket/12359\n\t\t\tdiv.innerHTML = \"<select msallowcapture=''><option selected=''></option></select>\";\n\n\t\t\t// Support: IE8, Opera 11-12.16\n\t\t\t// Nothing should be selected when empty strings follow ^= or $= or *=\n\t\t\t// The test attribute must be unknown in Opera but \"safe\" for WinRT\n\t\t\t// http://msdn.microsoft.com/en-us/library/ie/hh465388.aspx#attribute_section\n\t\t\tif ( div.querySelectorAll(\"[msallowcapture^='']\").length ) {\n\t\t\t\trbuggyQSA.push( \"[*^$]=\" + whitespace + \"*(?:''|\\\"\\\")\" );\n\t\t\t}\n\n\t\t\t// Support: IE8\n\t\t\t// Boolean attributes and \"value\" are not treated correctly\n\t\t\tif ( !div.querySelectorAll(\"[selected]\").length ) {\n\t\t\t\trbuggyQSA.push( \"\\\\[\" + whitespace + \"*(?:value|\" + booleans + \")\" );\n\t\t\t}\n\n\t\t\t// Webkit/Opera - :checked should return selected option elements\n\t\t\t// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked\n\t\t\t// IE8 throws error here and will not see later tests\n\t\t\tif ( !div.querySelectorAll(\":checked\").length ) {\n\t\t\t\trbuggyQSA.push(\":checked\");\n\t\t\t}\n\t\t});\n\n\t\tassert(function( div ) {\n\t\t\t// Support: Windows 8 Native Apps\n\t\t\t// The type and name attributes are restricted during .innerHTML assignment\n\t\t\tvar input = doc.createElement(\"input\");\n\t\t\tinput.setAttribute( \"type\", \"hidden\" );\n\t\t\tdiv.appendChild( input ).setAttribute( \"name\", \"D\" );\n\n\t\t\t// Support: IE8\n\t\t\t// Enforce case-sensitivity of name attribute\n\t\t\tif ( div.querySelectorAll(\"[name=d]\").length ) {\n\t\t\t\trbuggyQSA.push( \"name\" + whitespace + \"*[*^$|!~]?=\" );\n\t\t\t}\n\n\t\t\t// FF 3.5 - :enabled/:disabled and hidden elements (hidden elements are still enabled)\n\t\t\t// IE8 throws error here and will not see later tests\n\t\t\tif ( !div.querySelectorAll(\":enabled\").length ) {\n\t\t\t\trbuggyQSA.push( \":enabled\", \":disabled\" );\n\t\t\t}\n\n\t\t\t// Opera 10-11 does not throw on post-comma invalid pseudos\n\t\t\tdiv.querySelectorAll(\"*,:x\");\n\t\t\trbuggyQSA.push(\",.*:\");\n\t\t});\n\t}\n\n\tif ( (support.matchesSelector = rnative.test( (matches = docElem.matches ||\n\t\tdocElem.webkitMatchesSelector ||\n\t\tdocElem.mozMatchesSelector ||\n\t\tdocElem.oMatchesSelector ||\n\t\tdocElem.msMatchesSelector) )) ) {\n\n\t\tassert(function( div ) {\n\t\t\t// Check to see if it's possible to do matchesSelector\n\t\t\t// on a disconnected node (IE 9)\n\t\t\tsupport.disconnectedMatch = matches.call( div, \"div\" );\n\n\t\t\t// This should fail with an exception\n\t\t\t// Gecko does not error, returns false instead\n\t\t\tmatches.call( div, \"[s!='']:x\" );\n\t\t\trbuggyMatches.push( \"!=\", pseudos );\n\t\t});\n\t}\n\n\trbuggyQSA = rbuggyQSA.length && new RegExp( rbuggyQSA.join(\"|\") );\n\trbuggyMatches = rbuggyMatches.length && new RegExp( rbuggyMatches.join(\"|\") );\n\n\t/* Contains\n\t---------------------------------------------------------------------- */\n\thasCompare = rnative.test( docElem.compareDocumentPosition );\n\n\t// Element contains another\n\t// Purposefully does not implement inclusive descendent\n\t// As in, an element does not contain itself\n\tcontains = hasCompare || rnative.test( docElem.contains ) ?\n\t\tfunction( a, b ) {\n\t\t\tvar adown = a.nodeType === 9 ? a.documentElement : a,\n\t\t\t\tbup = b && b.parentNode;\n\t\t\treturn a === bup || !!( bup && bup.nodeType === 1 && (\n\t\t\t\tadown.contains ?\n\t\t\t\t\tadown.contains( bup ) :\n\t\t\t\t\ta.compareDocumentPosition && a.compareDocumentPosition( bup ) & 16\n\t\t\t));\n\t\t} :\n\t\tfunction( a, b ) {\n\t\t\tif ( b ) {\n\t\t\t\twhile ( (b = b.parentNode) ) {\n\t\t\t\t\tif ( b === a ) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\n\t/* Sorting\n\t---------------------------------------------------------------------- */\n\n\t// Document order sorting\n\tsortOrder = hasCompare ?\n\tfunction( a, b ) {\n\n\t\t// Flag for duplicate removal\n\t\tif ( a === b ) {\n\t\t\thasDuplicate = true;\n\t\t\treturn 0;\n\t\t}\n\n\t\t// Sort on method existence if only one input has compareDocumentPosition\n\t\tvar compare = !a.compareDocumentPosition - !b.compareDocumentPosition;\n\t\tif ( compare ) {\n\t\t\treturn compare;\n\t\t}\n\n\t\t// Calculate position if both inputs belong to the same document\n\t\tcompare = ( a.ownerDocument || a ) === ( b.ownerDocument || b ) ?\n\t\t\ta.compareDocumentPosition( b ) :\n\n\t\t\t// Otherwise we know they are disconnected\n\t\t\t1;\n\n\t\t// Disconnected nodes\n\t\tif ( compare & 1 ||\n\t\t\t(!support.sortDetached && b.compareDocumentPosition( a ) === compare) ) {\n\n\t\t\t// Choose the first element that is related to our preferred document\n\t\t\tif ( a === doc || a.ownerDocument === preferredDoc && contains(preferredDoc, a) ) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif ( b === doc || b.ownerDocument === preferredDoc && contains(preferredDoc, b) ) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\t// Maintain original order\n\t\t\treturn sortInput ?\n\t\t\t\t( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :\n\t\t\t\t0;\n\t\t}\n\n\t\treturn compare & 4 ? -1 : 1;\n\t} :\n\tfunction( a, b ) {\n\t\t// Exit early if the nodes are identical\n\t\tif ( a === b ) {\n\t\t\thasDuplicate = true;\n\t\t\treturn 0;\n\t\t}\n\n\t\tvar cur,\n\t\t\ti = 0,\n\t\t\taup = a.parentNode,\n\t\t\tbup = b.parentNode,\n\t\t\tap = [ a ],\n\t\t\tbp = [ b ];\n\n\t\t// Parentless nodes are either documents or disconnected\n\t\tif ( !aup || !bup ) {\n\t\t\treturn a === doc ? -1 :\n\t\t\t\tb === doc ? 1 :\n\t\t\t\taup ? -1 :\n\t\t\t\tbup ? 1 :\n\t\t\t\tsortInput ?\n\t\t\t\t( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :\n\t\t\t\t0;\n\n\t\t// If the nodes are siblings, we can do a quick check\n\t\t} else if ( aup === bup ) {\n\t\t\treturn siblingCheck( a, b );\n\t\t}\n\n\t\t// Otherwise we need full lists of their ancestors for comparison\n\t\tcur = a;\n\t\twhile ( (cur = cur.parentNode) ) {\n\t\t\tap.unshift( cur );\n\t\t}\n\t\tcur = b;\n\t\twhile ( (cur = cur.parentNode) ) {\n\t\t\tbp.unshift( cur );\n\t\t}\n\n\t\t// Walk down the tree looking for a discrepancy\n\t\twhile ( ap[i] === bp[i] ) {\n\t\t\ti++;\n\t\t}\n\n\t\treturn i ?\n\t\t\t// Do a sibling check if the nodes have a common ancestor\n\t\t\tsiblingCheck( ap[i], bp[i] ) :\n\n\t\t\t// Otherwise nodes in our document sort first\n\t\t\tap[i] === preferredDoc ? -1 :\n\t\t\tbp[i] === preferredDoc ? 1 :\n\t\t\t0;\n\t};\n\n\treturn doc;\n};\n\nSizzle.matches = function( expr, elements ) {\n\treturn Sizzle( expr, null, null, elements );\n};\n\nSizzle.matchesSelector = function( elem, expr ) {\n\t// Set document vars if needed\n\tif ( ( elem.ownerDocument || elem ) !== document ) {\n\t\tsetDocument( elem );\n\t}\n\n\t// Make sure that attribute selectors are quoted\n\texpr = expr.replace( rattributeQuotes, \"='$1']\" );\n\n\tif ( support.matchesSelector && documentIsHTML &&\n\t\t( !rbuggyMatches || !rbuggyMatches.test( expr ) ) &&\n\t\t( !rbuggyQSA     || !rbuggyQSA.test( expr ) ) ) {\n\n\t\ttry {\n\t\t\tvar ret = matches.call( elem, expr );\n\n\t\t\t// IE 9's matchesSelector returns false on disconnected nodes\n\t\t\tif ( ret || support.disconnectedMatch ||\n\t\t\t\t\t// As well, disconnected nodes are said to be in a document\n\t\t\t\t\t// fragment in IE 9\n\t\t\t\t\telem.document && elem.document.nodeType !== 11 ) {\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t} catch(e) {}\n\t}\n\n\treturn Sizzle( expr, document, null, [ elem ] ).length > 0;\n};\n\nSizzle.contains = function( context, elem ) {\n\t// Set document vars if needed\n\tif ( ( context.ownerDocument || context ) !== document ) {\n\t\tsetDocument( context );\n\t}\n\treturn contains( context, elem );\n};\n\nSizzle.attr = function( elem, name ) {\n\t// Set document vars if needed\n\tif ( ( elem.ownerDocument || elem ) !== document ) {\n\t\tsetDocument( elem );\n\t}\n\n\tvar fn = Expr.attrHandle[ name.toLowerCase() ],\n\t\t// Don't get fooled by Object.prototype properties (jQuery #13807)\n\t\tval = fn && hasOwn.call( Expr.attrHandle, name.toLowerCase() ) ?\n\t\t\tfn( elem, name, !documentIsHTML ) :\n\t\t\tundefined;\n\n\treturn val !== undefined ?\n\t\tval :\n\t\tsupport.attributes || !documentIsHTML ?\n\t\t\telem.getAttribute( name ) :\n\t\t\t(val = elem.getAttributeNode(name)) && val.specified ?\n\t\t\t\tval.value :\n\t\t\t\tnull;\n};\n\nSizzle.error = function( msg ) {\n\tthrow new Error( \"Syntax error, unrecognized expression: \" + msg );\n};\n\n/**\n * Document sorting and removing duplicates\n * @param {ArrayLike} results\n */\nSizzle.uniqueSort = function( results ) {\n\tvar elem,\n\t\tduplicates = [],\n\t\tj = 0,\n\t\ti = 0;\n\n\t// Unless we *know* we can detect duplicates, assume their presence\n\thasDuplicate = !support.detectDuplicates;\n\tsortInput = !support.sortStable && results.slice( 0 );\n\tresults.sort( sortOrder );\n\n\tif ( hasDuplicate ) {\n\t\twhile ( (elem = results[i++]) ) {\n\t\t\tif ( elem === results[ i ] ) {\n\t\t\t\tj = duplicates.push( i );\n\t\t\t}\n\t\t}\n\t\twhile ( j-- ) {\n\t\t\tresults.splice( duplicates[ j ], 1 );\n\t\t}\n\t}\n\n\t// Clear input after sorting to release objects\n\t// See https://github.com/jquery/sizzle/pull/225\n\tsortInput = null;\n\n\treturn results;\n};\n\n/**\n * Utility function for retrieving the text value of an array of DOM nodes\n * @param {Array|Element} elem\n */\ngetText = Sizzle.getText = function( elem ) {\n\tvar node,\n\t\tret = \"\",\n\t\ti = 0,\n\t\tnodeType = elem.nodeType;\n\n\tif ( !nodeType ) {\n\t\t// If no nodeType, this is expected to be an array\n\t\twhile ( (node = elem[i++]) ) {\n\t\t\t// Do not traverse comment nodes\n\t\t\tret += getText( node );\n\t\t}\n\t} else if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {\n\t\t// Use textContent for elements\n\t\t// innerText usage removed for consistency of new lines (jQuery #11153)\n\t\tif ( typeof elem.textContent === \"string\" ) {\n\t\t\treturn elem.textContent;\n\t\t} else {\n\t\t\t// Traverse its children\n\t\t\tfor ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {\n\t\t\t\tret += getText( elem );\n\t\t\t}\n\t\t}\n\t} else if ( nodeType === 3 || nodeType === 4 ) {\n\t\treturn elem.nodeValue;\n\t}\n\t// Do not include comment or processing instruction nodes\n\n\treturn ret;\n};\n\nExpr = Sizzle.selectors = {\n\n\t// Can be adjusted by the user\n\tcacheLength: 50,\n\n\tcreatePseudo: markFunction,\n\n\tmatch: matchExpr,\n\n\tattrHandle: {},\n\n\tfind: {},\n\n\trelative: {\n\t\t\">\": { dir: \"parentNode\", first: true },\n\t\t\" \": { dir: \"parentNode\" },\n\t\t\"+\": { dir: \"previousSibling\", first: true },\n\t\t\"~\": { dir: \"previousSibling\" }\n\t},\n\n\tpreFilter: {\n\t\t\"ATTR\": function( match ) {\n\t\t\tmatch[1] = match[1].replace( runescape, funescape );\n\n\t\t\t// Move the given value to match[3] whether quoted or unquoted\n\t\t\tmatch[3] = ( match[3] || match[4] || match[5] || \"\" ).replace( runescape, funescape );\n\n\t\t\tif ( match[2] === \"~=\" ) {\n\t\t\t\tmatch[3] = \" \" + match[3] + \" \";\n\t\t\t}\n\n\t\t\treturn match.slice( 0, 4 );\n\t\t},\n\n\t\t\"CHILD\": function( match ) {\n\t\t\t/* matches from matchExpr[\"CHILD\"]\n\t\t\t\t1 type (only|nth|...)\n\t\t\t\t2 what (child|of-type)\n\t\t\t\t3 argument (even|odd|\\d*|\\d*n([+-]\\d+)?|...)\n\t\t\t\t4 xn-component of xn+y argument ([+-]?\\d*n|)\n\t\t\t\t5 sign of xn-component\n\t\t\t\t6 x of xn-component\n\t\t\t\t7 sign of y-component\n\t\t\t\t8 y of y-component\n\t\t\t*/\n\t\t\tmatch[1] = match[1].toLowerCase();\n\n\t\t\tif ( match[1].slice( 0, 3 ) === \"nth\" ) {\n\t\t\t\t// nth-* requires argument\n\t\t\t\tif ( !match[3] ) {\n\t\t\t\t\tSizzle.error( match[0] );\n\t\t\t\t}\n\n\t\t\t\t// numeric x and y parameters for Expr.filter.CHILD\n\t\t\t\t// remember that false/true cast respectively to 0/1\n\t\t\t\tmatch[4] = +( match[4] ? match[5] + (match[6] || 1) : 2 * ( match[3] === \"even\" || match[3] === \"odd\" ) );\n\t\t\t\tmatch[5] = +( ( match[7] + match[8] ) || match[3] === \"odd\" );\n\n\t\t\t// other types prohibit arguments\n\t\t\t} else if ( match[3] ) {\n\t\t\t\tSizzle.error( match[0] );\n\t\t\t}\n\n\t\t\treturn match;\n\t\t},\n\n\t\t\"PSEUDO\": function( match ) {\n\t\t\tvar excess,\n\t\t\t\tunquoted = !match[6] && match[2];\n\n\t\t\tif ( matchExpr[\"CHILD\"].test( match[0] ) ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Accept quoted arguments as-is\n\t\t\tif ( match[3] ) {\n\t\t\t\tmatch[2] = match[4] || match[5] || \"\";\n\n\t\t\t// Strip excess characters from unquoted arguments\n\t\t\t} else if ( unquoted && rpseudo.test( unquoted ) &&\n\t\t\t\t// Get excess from tokenize (recursively)\n\t\t\t\t(excess = tokenize( unquoted, true )) &&\n\t\t\t\t// advance to the next closing parenthesis\n\t\t\t\t(excess = unquoted.indexOf( \")\", unquoted.length - excess ) - unquoted.length) ) {\n\n\t\t\t\t// excess is a negative index\n\t\t\t\tmatch[0] = match[0].slice( 0, excess );\n\t\t\t\tmatch[2] = unquoted.slice( 0, excess );\n\t\t\t}\n\n\t\t\t// Return only captures needed by the pseudo filter method (type and argument)\n\t\t\treturn match.slice( 0, 3 );\n\t\t}\n\t},\n\n\tfilter: {\n\n\t\t\"TAG\": function( nodeNameSelector ) {\n\t\t\tvar nodeName = nodeNameSelector.replace( runescape, funescape ).toLowerCase();\n\t\t\treturn nodeNameSelector === \"*\" ?\n\t\t\t\tfunction() { return true; } :\n\t\t\t\tfunction( elem ) {\n\t\t\t\t\treturn elem.nodeName && elem.nodeName.toLowerCase() === nodeName;\n\t\t\t\t};\n\t\t},\n\n\t\t\"CLASS\": function( className ) {\n\t\t\tvar pattern = classCache[ className + \" \" ];\n\n\t\t\treturn pattern ||\n\t\t\t\t(pattern = new RegExp( \"(^|\" + whitespace + \")\" + className + \"(\" + whitespace + \"|$)\" )) &&\n\t\t\t\tclassCache( className, function( elem ) {\n\t\t\t\t\treturn pattern.test( typeof elem.className === \"string\" && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute(\"class\") || \"\" );\n\t\t\t\t});\n\t\t},\n\n\t\t\"ATTR\": function( name, operator, check ) {\n\t\t\treturn function( elem ) {\n\t\t\t\tvar result = Sizzle.attr( elem, name );\n\n\t\t\t\tif ( result == null ) {\n\t\t\t\t\treturn operator === \"!=\";\n\t\t\t\t}\n\t\t\t\tif ( !operator ) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tresult += \"\";\n\n\t\t\t\treturn operator === \"=\" ? result === check :\n\t\t\t\t\toperator === \"!=\" ? result !== check :\n\t\t\t\t\toperator === \"^=\" ? check && result.indexOf( check ) === 0 :\n\t\t\t\t\toperator === \"*=\" ? check && result.indexOf( check ) > -1 :\n\t\t\t\t\toperator === \"$=\" ? check && result.slice( -check.length ) === check :\n\t\t\t\t\toperator === \"~=\" ? ( \" \" + result + \" \" ).indexOf( check ) > -1 :\n\t\t\t\t\toperator === \"|=\" ? result === check || result.slice( 0, check.length + 1 ) === check + \"-\" :\n\t\t\t\t\tfalse;\n\t\t\t};\n\t\t},\n\n\t\t\"CHILD\": function( type, what, argument, first, last ) {\n\t\t\tvar simple = type.slice( 0, 3 ) !== \"nth\",\n\t\t\t\tforward = type.slice( -4 ) !== \"last\",\n\t\t\t\tofType = what === \"of-type\";\n\n\t\t\treturn first === 1 && last === 0 ?\n\n\t\t\t\t// Shortcut for :nth-*(n)\n\t\t\t\tfunction( elem ) {\n\t\t\t\t\treturn !!elem.parentNode;\n\t\t\t\t} :\n\n\t\t\t\tfunction( elem, context, xml ) {\n\t\t\t\t\tvar cache, outerCache, node, diff, nodeIndex, start,\n\t\t\t\t\t\tdir = simple !== forward ? \"nextSibling\" : \"previousSibling\",\n\t\t\t\t\t\tparent = elem.parentNode,\n\t\t\t\t\t\tname = ofType && elem.nodeName.toLowerCase(),\n\t\t\t\t\t\tuseCache = !xml && !ofType;\n\n\t\t\t\t\tif ( parent ) {\n\n\t\t\t\t\t\t// :(first|last|only)-(child|of-type)\n\t\t\t\t\t\tif ( simple ) {\n\t\t\t\t\t\t\twhile ( dir ) {\n\t\t\t\t\t\t\t\tnode = elem;\n\t\t\t\t\t\t\t\twhile ( (node = node[ dir ]) ) {\n\t\t\t\t\t\t\t\t\tif ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) {\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Reverse direction for :only-* (if we haven't yet done so)\n\t\t\t\t\t\t\t\tstart = dir = type === \"only\" && !start && \"nextSibling\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstart = [ forward ? parent.firstChild : parent.lastChild ];\n\n\t\t\t\t\t\t// non-xml :nth-child(...) stores cache data on `parent`\n\t\t\t\t\t\tif ( forward && useCache ) {\n\t\t\t\t\t\t\t// Seek `elem` from a previously-cached index\n\t\t\t\t\t\t\touterCache = parent[ expando ] || (parent[ expando ] = {});\n\t\t\t\t\t\t\tcache = outerCache[ type ] || [];\n\t\t\t\t\t\t\tnodeIndex = cache[0] === dirruns && cache[1];\n\t\t\t\t\t\t\tdiff = cache[0] === dirruns && cache[2];\n\t\t\t\t\t\t\tnode = nodeIndex && parent.childNodes[ nodeIndex ];\n\n\t\t\t\t\t\t\twhile ( (node = ++nodeIndex && node && node[ dir ] ||\n\n\t\t\t\t\t\t\t\t// Fallback to seeking `elem` from the start\n\t\t\t\t\t\t\t\t(diff = nodeIndex = 0) || start.pop()) ) {\n\n\t\t\t\t\t\t\t\t// When found, cache indexes on `parent` and break\n\t\t\t\t\t\t\t\tif ( node.nodeType === 1 && ++diff && node === elem ) {\n\t\t\t\t\t\t\t\t\touterCache[ type ] = [ dirruns, nodeIndex, diff ];\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Use previously-cached element index if available\n\t\t\t\t\t\t} else if ( useCache && (cache = (elem[ expando ] || (elem[ expando ] = {}))[ type ]) && cache[0] === dirruns ) {\n\t\t\t\t\t\t\tdiff = cache[1];\n\n\t\t\t\t\t\t// xml :nth-child(...) or :nth-last-child(...) or :nth(-last)?-of-type(...)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Use the same loop as above to seek `elem` from the start\n\t\t\t\t\t\t\twhile ( (node = ++nodeIndex && node && node[ dir ] ||\n\t\t\t\t\t\t\t\t(diff = nodeIndex = 0) || start.pop()) ) {\n\n\t\t\t\t\t\t\t\tif ( ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) && ++diff ) {\n\t\t\t\t\t\t\t\t\t// Cache the index of each encountered element\n\t\t\t\t\t\t\t\t\tif ( useCache ) {\n\t\t\t\t\t\t\t\t\t\t(node[ expando ] || (node[ expando ] = {}))[ type ] = [ dirruns, diff ];\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif ( node === elem ) {\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Incorporate the offset, then check against cycle size\n\t\t\t\t\t\tdiff -= last;\n\t\t\t\t\t\treturn diff === first || ( diff % first === 0 && diff / first >= 0 );\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t},\n\n\t\t\"PSEUDO\": function( pseudo, argument ) {\n\t\t\t// pseudo-class names are case-insensitive\n\t\t\t// http://www.w3.org/TR/selectors/#pseudo-classes\n\t\t\t// Prioritize by case sensitivity in case custom pseudos are added with uppercase letters\n\t\t\t// Remember that setFilters inherits from pseudos\n\t\t\tvar args,\n\t\t\t\tfn = Expr.pseudos[ pseudo ] || Expr.setFilters[ pseudo.toLowerCase() ] ||\n\t\t\t\t\tSizzle.error( \"unsupported pseudo: \" + pseudo );\n\n\t\t\t// The user may use createPseudo to indicate that\n\t\t\t// arguments are needed to create the filter function\n\t\t\t// just as Sizzle does\n\t\t\tif ( fn[ expando ] ) {\n\t\t\t\treturn fn( argument );\n\t\t\t}\n\n\t\t\t// But maintain support for old signatures\n\t\t\tif ( fn.length > 1 ) {\n\t\t\t\targs = [ pseudo, pseudo, \"\", argument ];\n\t\t\t\treturn Expr.setFilters.hasOwnProperty( pseudo.toLowerCase() ) ?\n\t\t\t\t\tmarkFunction(function( seed, matches ) {\n\t\t\t\t\t\tvar idx,\n\t\t\t\t\t\t\tmatched = fn( seed, argument ),\n\t\t\t\t\t\t\ti = matched.length;\n\t\t\t\t\t\twhile ( i-- ) {\n\t\t\t\t\t\t\tidx = indexOf.call( seed, matched[i] );\n\t\t\t\t\t\t\tseed[ idx ] = !( matches[ idx ] = matched[i] );\n\t\t\t\t\t\t}\n\t\t\t\t\t}) :\n\t\t\t\t\tfunction( elem ) {\n\t\t\t\t\t\treturn fn( elem, 0, args );\n\t\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn fn;\n\t\t}\n\t},\n\n\tpseudos: {\n\t\t// Potentially complex pseudos\n\t\t\"not\": markFunction(function( selector ) {\n\t\t\t// Trim the selector passed to compile\n\t\t\t// to avoid treating leading and trailing\n\t\t\t// spaces as combinators\n\t\t\tvar input = [],\n\t\t\t\tresults = [],\n\t\t\t\tmatcher = compile( selector.replace( rtrim, \"$1\" ) );\n\n\t\t\treturn matcher[ expando ] ?\n\t\t\t\tmarkFunction(function( seed, matches, context, xml ) {\n\t\t\t\t\tvar elem,\n\t\t\t\t\t\tunmatched = matcher( seed, null, xml, [] ),\n\t\t\t\t\t\ti = seed.length;\n\n\t\t\t\t\t// Match elements unmatched by `matcher`\n\t\t\t\t\twhile ( i-- ) {\n\t\t\t\t\t\tif ( (elem = unmatched[i]) ) {\n\t\t\t\t\t\t\tseed[i] = !(matches[i] = elem);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}) :\n\t\t\t\tfunction( elem, context, xml ) {\n\t\t\t\t\tinput[0] = elem;\n\t\t\t\t\tmatcher( input, null, xml, results );\n\t\t\t\t\treturn !results.pop();\n\t\t\t\t};\n\t\t}),\n\n\t\t\"has\": markFunction(function( selector ) {\n\t\t\treturn function( elem ) {\n\t\t\t\treturn Sizzle( selector, elem ).length > 0;\n\t\t\t};\n\t\t}),\n\n\t\t\"contains\": markFunction(function( text ) {\n\t\t\ttext = text.replace( runescape, funescape );\n\t\t\treturn function( elem ) {\n\t\t\t\treturn ( elem.textContent || elem.innerText || getText( elem ) ).indexOf( text ) > -1;\n\t\t\t};\n\t\t}),\n\n\t\t// \"Whether an element is represented by a :lang() selector\n\t\t// is based solely on the element's language value\n\t\t// being equal to the identifier C,\n\t\t// or beginning with the identifier C immediately followed by \"-\".\n\t\t// The matching of C against the element's language value is performed case-insensitively.\n\t\t// The identifier C does not have to be a valid language name.\"\n\t\t// http://www.w3.org/TR/selectors/#lang-pseudo\n\t\t\"lang\": markFunction( function( lang ) {\n\t\t\t// lang value must be a valid identifier\n\t\t\tif ( !ridentifier.test(lang || \"\") ) {\n\t\t\t\tSizzle.error( \"unsupported lang: \" + lang );\n\t\t\t}\n\t\t\tlang = lang.replace( runescape, funescape ).toLowerCase();\n\t\t\treturn function( elem ) {\n\t\t\t\tvar elemLang;\n\t\t\t\tdo {\n\t\t\t\t\tif ( (elemLang = documentIsHTML ?\n\t\t\t\t\t\telem.lang :\n\t\t\t\t\t\telem.getAttribute(\"xml:lang\") || elem.getAttribute(\"lang\")) ) {\n\n\t\t\t\t\t\telemLang = elemLang.toLowerCase();\n\t\t\t\t\t\treturn elemLang === lang || elemLang.indexOf( lang + \"-\" ) === 0;\n\t\t\t\t\t}\n\t\t\t\t} while ( (elem = elem.parentNode) && elem.nodeType === 1 );\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}),\n\n\t\t// Miscellaneous\n\t\t\"target\": function( elem ) {\n\t\t\tvar hash = window.location && window.location.hash;\n\t\t\treturn hash && hash.slice( 1 ) === elem.id;\n\t\t},\n\n\t\t\"root\": function( elem ) {\n\t\t\treturn elem === docElem;\n\t\t},\n\n\t\t\"focus\": function( elem ) {\n\t\t\treturn elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);\n\t\t},\n\n\t\t// Boolean properties\n\t\t\"enabled\": function( elem ) {\n\t\t\treturn elem.disabled === false;\n\t\t},\n\n\t\t\"disabled\": function( elem ) {\n\t\t\treturn elem.disabled === true;\n\t\t},\n\n\t\t\"checked\": function( elem ) {\n\t\t\t// In CSS3, :checked should return both checked and selected elements\n\t\t\t// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked\n\t\t\tvar nodeName = elem.nodeName.toLowerCase();\n\t\t\treturn (nodeName === \"input\" && !!elem.checked) || (nodeName === \"option\" && !!elem.selected);\n\t\t},\n\n\t\t\"selected\": function( elem ) {\n\t\t\t// Accessing this property makes selected-by-default\n\t\t\t// options in Safari work properly\n\t\t\tif ( elem.parentNode ) {\n\t\t\t\telem.parentNode.selectedIndex;\n\t\t\t}\n\n\t\t\treturn elem.selected === true;\n\t\t},\n\n\t\t// Contents\n\t\t\"empty\": function( elem ) {\n\t\t\t// http://www.w3.org/TR/selectors/#empty-pseudo\n\t\t\t// :empty is negated by element (1) or content nodes (text: 3; cdata: 4; entity ref: 5),\n\t\t\t//   but not by others (comment: 8; processing instruction: 7; etc.)\n\t\t\t// nodeType < 6 works because attributes (2) do not appear as children\n\t\t\tfor ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {\n\t\t\t\tif ( elem.nodeType < 6 ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\n\t\t\"parent\": function( elem ) {\n\t\t\treturn !Expr.pseudos[\"empty\"]( elem );\n\t\t},\n\n\t\t// Element/input types\n\t\t\"header\": function( elem ) {\n\t\t\treturn rheader.test( elem.nodeName );\n\t\t},\n\n\t\t\"input\": function( elem ) {\n\t\t\treturn rinputs.test( elem.nodeName );\n\t\t},\n\n\t\t\"button\": function( elem ) {\n\t\t\tvar name = elem.nodeName.toLowerCase();\n\t\t\treturn name === \"input\" && elem.type === \"button\" || name === \"button\";\n\t\t},\n\n\t\t\"text\": function( elem ) {\n\t\t\tvar attr;\n\t\t\treturn elem.nodeName.toLowerCase() === \"input\" &&\n\t\t\t\telem.type === \"text\" &&\n\n\t\t\t\t// Support: IE<8\n\t\t\t\t// New HTML5 attribute values (e.g., \"search\") appear with elem.type === \"text\"\n\t\t\t\t( (attr = elem.getAttribute(\"type\")) == null || attr.toLowerCase() === \"text\" );\n\t\t},\n\n\t\t// Position-in-collection\n\t\t\"first\": createPositionalPseudo(function() {\n\t\t\treturn [ 0 ];\n\t\t}),\n\n\t\t\"last\": createPositionalPseudo(function( matchIndexes, length ) {\n\t\t\treturn [ length - 1 ];\n\t\t}),\n\n\t\t\"eq\": createPositionalPseudo(function( matchIndexes, length, argument ) {\n\t\t\treturn [ argument < 0 ? argument + length : argument ];\n\t\t}),\n\n\t\t\"even\": createPositionalPseudo(function( matchIndexes, length ) {\n\t\t\tvar i = 0;\n\t\t\tfor ( ; i < length; i += 2 ) {\n\t\t\t\tmatchIndexes.push( i );\n\t\t\t}\n\t\t\treturn matchIndexes;\n\t\t}),\n\n\t\t\"odd\": createPositionalPseudo(function( matchIndexes, length ) {\n\t\t\tvar i = 1;\n\t\t\tfor ( ; i < length; i += 2 ) {\n\t\t\t\tmatchIndexes.push( i );\n\t\t\t}\n\t\t\treturn matchIndexes;\n\t\t}),\n\n\t\t\"lt\": createPositionalPseudo(function( matchIndexes, length, argument ) {\n\t\t\tvar i = argument < 0 ? argument + length : argument;\n\t\t\tfor ( ; --i >= 0; ) {\n\t\t\t\tmatchIndexes.push( i );\n\t\t\t}\n\t\t\treturn matchIndexes;\n\t\t}),\n\n\t\t\"gt\": createPositionalPseudo(function( matchIndexes, length, argument ) {\n\t\t\tvar i = argument < 0 ? argument + length : argument;\n\t\t\tfor ( ; ++i < length; ) {\n\t\t\t\tmatchIndexes.push( i );\n\t\t\t}\n\t\t\treturn matchIndexes;\n\t\t})\n\t}\n};\n\nExpr.pseudos[\"nth\"] = Expr.pseudos[\"eq\"];\n\n// Add button/input type pseudos\nfor ( i in { radio: true, checkbox: true, file: true, password: true, image: true } ) {\n\tExpr.pseudos[ i ] = createInputPseudo( i );\n}\nfor ( i in { submit: true, reset: true } ) {\n\tExpr.pseudos[ i ] = createButtonPseudo( i );\n}\n\n// Easy API for creating new setFilters\nfunction setFilters() {}\nsetFilters.prototype = Expr.filters = Expr.pseudos;\nExpr.setFilters = new setFilters();\n\ntokenize = Sizzle.tokenize = function( selector, parseOnly ) {\n\tvar matched, match, tokens, type,\n\t\tsoFar, groups, preFilters,\n\t\tcached = tokenCache[ selector + \" \" ];\n\n\tif ( cached ) {\n\t\treturn parseOnly ? 0 : cached.slice( 0 );\n\t}\n\n\tsoFar = selector;\n\tgroups = [];\n\tpreFilters = Expr.preFilter;\n\n\twhile ( soFar ) {\n\n\t\t// Comma and first run\n\t\tif ( !matched || (match = rcomma.exec( soFar )) ) {\n\t\t\tif ( match ) {\n\t\t\t\t// Don't consume trailing commas as valid\n\t\t\t\tsoFar = soFar.slice( match[0].length ) || soFar;\n\t\t\t}\n\t\t\tgroups.push( (tokens = []) );\n\t\t}\n\n\t\tmatched = false;\n\n\t\t// Combinators\n\t\tif ( (match = rcombinators.exec( soFar )) ) {\n\t\t\tmatched = match.shift();\n\t\t\ttokens.push({\n\t\t\t\tvalue: matched,\n\t\t\t\t// Cast descendant combinators to space\n\t\t\t\ttype: match[0].replace( rtrim, \" \" )\n\t\t\t});\n\t\t\tsoFar = soFar.slice( matched.length );\n\t\t}\n\n\t\t// Filters\n\t\tfor ( type in Expr.filter ) {\n\t\t\tif ( (match = matchExpr[ type ].exec( soFar )) && (!preFilters[ type ] ||\n\t\t\t\t(match = preFilters[ type ]( match ))) ) {\n\t\t\t\tmatched = match.shift();\n\t\t\t\ttokens.push({\n\t\t\t\t\tvalue: matched,\n\t\t\t\t\ttype: type,\n\t\t\t\t\tmatches: match\n\t\t\t\t});\n\t\t\t\tsoFar = soFar.slice( matched.length );\n\t\t\t}\n\t\t}\n\n\t\tif ( !matched ) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t// Return the length of the invalid excess\n\t// if we're just parsing\n\t// Otherwise, throw an error or return tokens\n\treturn parseOnly ?\n\t\tsoFar.length :\n\t\tsoFar ?\n\t\t\tSizzle.error( selector ) :\n\t\t\t// Cache the tokens\n\t\t\ttokenCache( selector, groups ).slice( 0 );\n};\n\nfunction toSelector( tokens ) {\n\tvar i = 0,\n\t\tlen = tokens.length,\n\t\tselector = \"\";\n\tfor ( ; i < len; i++ ) {\n\t\tselector += tokens[i].value;\n\t}\n\treturn selector;\n}\n\nfunction addCombinator( matcher, combinator, base ) {\n\tvar dir = combinator.dir,\n\t\tcheckNonElements = base && dir === \"parentNode\",\n\t\tdoneName = done++;\n\n\treturn combinator.first ?\n\t\t// Check against closest ancestor/preceding element\n\t\tfunction( elem, context, xml ) {\n\t\t\twhile ( (elem = elem[ dir ]) ) {\n\t\t\t\tif ( elem.nodeType === 1 || checkNonElements ) {\n\t\t\t\t\treturn matcher( elem, context, xml );\n\t\t\t\t}\n\t\t\t}\n\t\t} :\n\n\t\t// Check against all ancestor/preceding elements\n\t\tfunction( elem, context, xml ) {\n\t\t\tvar oldCache, outerCache,\n\t\t\t\tnewCache = [ dirruns, doneName ];\n\n\t\t\t// We can't set arbitrary data on XML nodes, so they don't benefit from dir caching\n\t\t\tif ( xml ) {\n\t\t\t\twhile ( (elem = elem[ dir ]) ) {\n\t\t\t\t\tif ( elem.nodeType === 1 || checkNonElements ) {\n\t\t\t\t\t\tif ( matcher( elem, context, xml ) ) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twhile ( (elem = elem[ dir ]) ) {\n\t\t\t\t\tif ( elem.nodeType === 1 || checkNonElements ) {\n\t\t\t\t\t\touterCache = elem[ expando ] || (elem[ expando ] = {});\n\t\t\t\t\t\tif ( (oldCache = outerCache[ dir ]) &&\n\t\t\t\t\t\t\toldCache[ 0 ] === dirruns && oldCache[ 1 ] === doneName ) {\n\n\t\t\t\t\t\t\t// Assign to newCache so results back-propagate to previous elements\n\t\t\t\t\t\t\treturn (newCache[ 2 ] = oldCache[ 2 ]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Reuse newcache so results back-propagate to previous elements\n\t\t\t\t\t\t\touterCache[ dir ] = newCache;\n\n\t\t\t\t\t\t\t// A match means we're done; a fail means we have to keep checking\n\t\t\t\t\t\t\tif ( (newCache[ 2 ] = matcher( elem, context, xml )) ) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n}\n\nfunction elementMatcher( matchers ) {\n\treturn matchers.length > 1 ?\n\t\tfunction( elem, context, xml ) {\n\t\t\tvar i = matchers.length;\n\t\t\twhile ( i-- ) {\n\t\t\t\tif ( !matchers[i]( elem, context, xml ) ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t} :\n\t\tmatchers[0];\n}\n\nfunction multipleContexts( selector, contexts, results ) {\n\tvar i = 0,\n\t\tlen = contexts.length;\n\tfor ( ; i < len; i++ ) {\n\t\tSizzle( selector, contexts[i], results );\n\t}\n\treturn results;\n}\n\nfunction condense( unmatched, map, filter, context, xml ) {\n\tvar elem,\n\t\tnewUnmatched = [],\n\t\ti = 0,\n\t\tlen = unmatched.length,\n\t\tmapped = map != null;\n\n\tfor ( ; i < len; i++ ) {\n\t\tif ( (elem = unmatched[i]) ) {\n\t\t\tif ( !filter || filter( elem, context, xml ) ) {\n\t\t\t\tnewUnmatched.push( elem );\n\t\t\t\tif ( mapped ) {\n\t\t\t\t\tmap.push( i );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn newUnmatched;\n}\n\nfunction setMatcher( preFilter, selector, matcher, postFilter, postFinder, postSelector ) {\n\tif ( postFilter && !postFilter[ expando ] ) {\n\t\tpostFilter = setMatcher( postFilter );\n\t}\n\tif ( postFinder && !postFinder[ expando ] ) {\n\t\tpostFinder = setMatcher( postFinder, postSelector );\n\t}\n\treturn markFunction(function( seed, results, context, xml ) {\n\t\tvar temp, i, elem,\n\t\t\tpreMap = [],\n\t\t\tpostMap = [],\n\t\t\tpreexisting = results.length,\n\n\t\t\t// Get initial elements from seed or context\n\t\t\telems = seed || multipleContexts( selector || \"*\", context.nodeType ? [ context ] : context, [] ),\n\n\t\t\t// Prefilter to get matcher input, preserving a map for seed-results synchronization\n\t\t\tmatcherIn = preFilter && ( seed || !selector ) ?\n\t\t\t\tcondense( elems, preMap, preFilter, context, xml ) :\n\t\t\t\telems,\n\n\t\t\tmatcherOut = matcher ?\n\t\t\t\t// If we have a postFinder, or filtered seed, or non-seed postFilter or preexisting results,\n\t\t\t\tpostFinder || ( seed ? preFilter : preexisting || postFilter ) ?\n\n\t\t\t\t\t// ...intermediate processing is necessary\n\t\t\t\t\t[] :\n\n\t\t\t\t\t// ...otherwise use results directly\n\t\t\t\t\tresults :\n\t\t\t\tmatcherIn;\n\n\t\t// Find primary matches\n\t\tif ( matcher ) {\n\t\t\tmatcher( matcherIn, matcherOut, context, xml );\n\t\t}\n\n\t\t// Apply postFilter\n\t\tif ( postFilter ) {\n\t\t\ttemp = condense( matcherOut, postMap );\n\t\t\tpostFilter( temp, [], context, xml );\n\n\t\t\t// Un-match failing elements by moving them back to matcherIn\n\t\t\ti = temp.length;\n\t\t\twhile ( i-- ) {\n\t\t\t\tif ( (elem = temp[i]) ) {\n\t\t\t\t\tmatcherOut[ postMap[i] ] = !(matcherIn[ postMap[i] ] = elem);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( seed ) {\n\t\t\tif ( postFinder || preFilter ) {\n\t\t\t\tif ( postFinder ) {\n\t\t\t\t\t// Get the final matcherOut by condensing this intermediate into postFinder contexts\n\t\t\t\t\ttemp = [];\n\t\t\t\t\ti = matcherOut.length;\n\t\t\t\t\twhile ( i-- ) {\n\t\t\t\t\t\tif ( (elem = matcherOut[i]) ) {\n\t\t\t\t\t\t\t// Restore matcherIn since elem is not yet a final match\n\t\t\t\t\t\t\ttemp.push( (matcherIn[i] = elem) );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tpostFinder( null, (matcherOut = []), temp, xml );\n\t\t\t\t}\n\n\t\t\t\t// Move matched elements from seed to results to keep them synchronized\n\t\t\t\ti = matcherOut.length;\n\t\t\t\twhile ( i-- ) {\n\t\t\t\t\tif ( (elem = matcherOut[i]) &&\n\t\t\t\t\t\t(temp = postFinder ? indexOf.call( seed, elem ) : preMap[i]) > -1 ) {\n\n\t\t\t\t\t\tseed[temp] = !(results[temp] = elem);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t// Add elements to results, through postFinder if defined\n\t\t} else {\n\t\t\tmatcherOut = condense(\n\t\t\t\tmatcherOut === results ?\n\t\t\t\t\tmatcherOut.splice( preexisting, matcherOut.length ) :\n\t\t\t\t\tmatcherOut\n\t\t\t);\n\t\t\tif ( postFinder ) {\n\t\t\t\tpostFinder( null, results, matcherOut, xml );\n\t\t\t} else {\n\t\t\t\tpush.apply( results, matcherOut );\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction matcherFromTokens( tokens ) {\n\tvar checkContext, matcher, j,\n\t\tlen = tokens.length,\n\t\tleadingRelative = Expr.relative[ tokens[0].type ],\n\t\timplicitRelative = leadingRelative || Expr.relative[\" \"],\n\t\ti = leadingRelative ? 1 : 0,\n\n\t\t// The foundational matcher ensures that elements are reachable from top-level context(s)\n\t\tmatchContext = addCombinator( function( elem ) {\n\t\t\treturn elem === checkContext;\n\t\t}, implicitRelative, true ),\n\t\tmatchAnyContext = addCombinator( function( elem ) {\n\t\t\treturn indexOf.call( checkContext, elem ) > -1;\n\t\t}, implicitRelative, true ),\n\t\tmatchers = [ function( elem, context, xml ) {\n\t\t\treturn ( !leadingRelative && ( xml || context !== outermostContext ) ) || (\n\t\t\t\t(checkContext = context).nodeType ?\n\t\t\t\t\tmatchContext( elem, context, xml ) :\n\t\t\t\t\tmatchAnyContext( elem, context, xml ) );\n\t\t} ];\n\n\tfor ( ; i < len; i++ ) {\n\t\tif ( (matcher = Expr.relative[ tokens[i].type ]) ) {\n\t\t\tmatchers = [ addCombinator(elementMatcher( matchers ), matcher) ];\n\t\t} else {\n\t\t\tmatcher = Expr.filter[ tokens[i].type ].apply( null, tokens[i].matches );\n\n\t\t\t// Return special upon seeing a positional matcher\n\t\t\tif ( matcher[ expando ] ) {\n\t\t\t\t// Find the next relative operator (if any) for proper handling\n\t\t\t\tj = ++i;\n\t\t\t\tfor ( ; j < len; j++ ) {\n\t\t\t\t\tif ( Expr.relative[ tokens[j].type ] ) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn setMatcher(\n\t\t\t\t\ti > 1 && elementMatcher( matchers ),\n\t\t\t\t\ti > 1 && toSelector(\n\t\t\t\t\t\t// If the preceding token was a descendant combinator, insert an implicit any-element `*`\n\t\t\t\t\t\ttokens.slice( 0, i - 1 ).concat({ value: tokens[ i - 2 ].type === \" \" ? \"*\" : \"\" })\n\t\t\t\t\t).replace( rtrim, \"$1\" ),\n\t\t\t\t\tmatcher,\n\t\t\t\t\ti < j && matcherFromTokens( tokens.slice( i, j ) ),\n\t\t\t\t\tj < len && matcherFromTokens( (tokens = tokens.slice( j )) ),\n\t\t\t\t\tj < len && toSelector( tokens )\n\t\t\t\t);\n\t\t\t}\n\t\t\tmatchers.push( matcher );\n\t\t}\n\t}\n\n\treturn elementMatcher( matchers );\n}\n\nfunction matcherFromGroupMatchers( elementMatchers, setMatchers ) {\n\tvar bySet = setMatchers.length > 0,\n\t\tbyElement = elementMatchers.length > 0,\n\t\tsuperMatcher = function( seed, context, xml, results, outermost ) {\n\t\t\tvar elem, j, matcher,\n\t\t\t\tmatchedCount = 0,\n\t\t\t\ti = \"0\",\n\t\t\t\tunmatched = seed && [],\n\t\t\t\tsetMatched = [],\n\t\t\t\tcontextBackup = outermostContext,\n\t\t\t\t// We must always have either seed elements or outermost context\n\t\t\t\telems = seed || byElement && Expr.find[\"TAG\"]( \"*\", outermost ),\n\t\t\t\t// Use integer dirruns iff this is the outermost matcher\n\t\t\t\tdirrunsUnique = (dirruns += contextBackup == null ? 1 : Math.random() || 0.1),\n\t\t\t\tlen = elems.length;\n\n\t\t\tif ( outermost ) {\n\t\t\t\toutermostContext = context !== document && context;\n\t\t\t}\n\n\t\t\t// Add elements passing elementMatchers directly to results\n\t\t\t// Keep `i` a string if there are no elements so `matchedCount` will be \"00\" below\n\t\t\t// Support: IE<9, Safari\n\t\t\t// Tolerate NodeList properties (IE: \"length\"; Safari: <number>) matching elements by id\n\t\t\tfor ( ; i !== len && (elem = elems[i]) != null; i++ ) {\n\t\t\t\tif ( byElement && elem ) {\n\t\t\t\t\tj = 0;\n\t\t\t\t\twhile ( (matcher = elementMatchers[j++]) ) {\n\t\t\t\t\t\tif ( matcher( elem, context, xml ) ) {\n\t\t\t\t\t\t\tresults.push( elem );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif ( outermost ) {\n\t\t\t\t\t\tdirruns = dirrunsUnique;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Track unmatched elements for set filters\n\t\t\t\tif ( bySet ) {\n\t\t\t\t\t// They will have gone through all possible matchers\n\t\t\t\t\tif ( (elem = !matcher && elem) ) {\n\t\t\t\t\t\tmatchedCount--;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Lengthen the array for every element, matched or not\n\t\t\t\t\tif ( seed ) {\n\t\t\t\t\t\tunmatched.push( elem );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Apply set filters to unmatched elements\n\t\t\tmatchedCount += i;\n\t\t\tif ( bySet && i !== matchedCount ) {\n\t\t\t\tj = 0;\n\t\t\t\twhile ( (matcher = setMatchers[j++]) ) {\n\t\t\t\t\tmatcher( unmatched, setMatched, context, xml );\n\t\t\t\t}\n\n\t\t\t\tif ( seed ) {\n\t\t\t\t\t// Reintegrate element matches to eliminate the need for sorting\n\t\t\t\t\tif ( matchedCount > 0 ) {\n\t\t\t\t\t\twhile ( i-- ) {\n\t\t\t\t\t\t\tif ( !(unmatched[i] || setMatched[i]) ) {\n\t\t\t\t\t\t\t\tsetMatched[i] = pop.call( results );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Discard index placeholder values to get only actual matches\n\t\t\t\t\tsetMatched = condense( setMatched );\n\t\t\t\t}\n\n\t\t\t\t// Add matches to results\n\t\t\t\tpush.apply( results, setMatched );\n\n\t\t\t\t// Seedless set matches succeeding multiple successful matchers stipulate sorting\n\t\t\t\tif ( outermost && !seed && setMatched.length > 0 &&\n\t\t\t\t\t( matchedCount + setMatchers.length ) > 1 ) {\n\n\t\t\t\t\tSizzle.uniqueSort( results );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Override manipulation of globals by nested matchers\n\t\t\tif ( outermost ) {\n\t\t\t\tdirruns = dirrunsUnique;\n\t\t\t\toutermostContext = contextBackup;\n\t\t\t}\n\n\t\t\treturn unmatched;\n\t\t};\n\n\treturn bySet ?\n\t\tmarkFunction( superMatcher ) :\n\t\tsuperMatcher;\n}\n\ncompile = Sizzle.compile = function( selector, match /* Internal Use Only */ ) {\n\tvar i,\n\t\tsetMatchers = [],\n\t\telementMatchers = [],\n\t\tcached = compilerCache[ selector + \" \" ];\n\n\tif ( !cached ) {\n\t\t// Generate a function of recursive functions that can be used to check each element\n\t\tif ( !match ) {\n\t\t\tmatch = tokenize( selector );\n\t\t}\n\t\ti = match.length;\n\t\twhile ( i-- ) {\n\t\t\tcached = matcherFromTokens( match[i] );\n\t\t\tif ( cached[ expando ] ) {\n\t\t\t\tsetMatchers.push( cached );\n\t\t\t} else {\n\t\t\t\telementMatchers.push( cached );\n\t\t\t}\n\t\t}\n\n\t\t// Cache the compiled function\n\t\tcached = compilerCache( selector, matcherFromGroupMatchers( elementMatchers, setMatchers ) );\n\n\t\t// Save selector and tokenization\n\t\tcached.selector = selector;\n\t}\n\treturn cached;\n};\n\n/**\n * A low-level selection function that works with Sizzle's compiled\n *  selector functions\n * @param {String|Function} selector A selector or a pre-compiled\n *  selector function built with Sizzle.compile\n * @param {Element} context\n * @param {Array} [results]\n * @param {Array} [seed] A set of elements to match against\n */\nselect = Sizzle.select = function( selector, context, results, seed ) {\n\tvar i, tokens, token, type, find,\n\t\tcompiled = typeof selector === \"function\" && selector,\n\t\tmatch = !seed && tokenize( (selector = compiled.selector || selector) );\n\n\tresults = results || [];\n\n\t// Try to minimize operations if there is no seed and only one group\n\tif ( match.length === 1 ) {\n\n\t\t// Take a shortcut and set the context if the root selector is an ID\n\t\ttokens = match[0] = match[0].slice( 0 );\n\t\tif ( tokens.length > 2 && (token = tokens[0]).type === \"ID\" &&\n\t\t\t\tsupport.getById && context.nodeType === 9 && documentIsHTML &&\n\t\t\t\tExpr.relative[ tokens[1].type ] ) {\n\n\t\t\tcontext = ( Expr.find[\"ID\"]( token.matches[0].replace(runescape, funescape), context ) || [] )[0];\n\t\t\tif ( !context ) {\n\t\t\t\treturn results;\n\n\t\t\t// Precompiled matchers will still verify ancestry, so step up a level\n\t\t\t} else if ( compiled ) {\n\t\t\t\tcontext = context.parentNode;\n\t\t\t}\n\n\t\t\tselector = selector.slice( tokens.shift().value.length );\n\t\t}\n\n\t\t// Fetch a seed set for right-to-left matching\n\t\ti = matchExpr[\"needsContext\"].test( selector ) ? 0 : tokens.length;\n\t\twhile ( i-- ) {\n\t\t\ttoken = tokens[i];\n\n\t\t\t// Abort if we hit a combinator\n\t\t\tif ( Expr.relative[ (type = token.type) ] ) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif ( (find = Expr.find[ type ]) ) {\n\t\t\t\t// Search, expanding context for leading sibling combinators\n\t\t\t\tif ( (seed = find(\n\t\t\t\t\ttoken.matches[0].replace( runescape, funescape ),\n\t\t\t\t\trsibling.test( tokens[0].type ) && testContext( context.parentNode ) || context\n\t\t\t\t)) ) {\n\n\t\t\t\t\t// If seed is empty or no tokens remain, we can return early\n\t\t\t\t\ttokens.splice( i, 1 );\n\t\t\t\t\tselector = seed.length && toSelector( tokens );\n\t\t\t\t\tif ( !selector ) {\n\t\t\t\t\t\tpush.apply( results, seed );\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Compile and execute a filtering function if one is not provided\n\t// Provide `match` to avoid retokenization if we modified the selector above\n\t( compiled || compile( selector, match ) )(\n\t\tseed,\n\t\tcontext,\n\t\t!documentIsHTML,\n\t\tresults,\n\t\trsibling.test( selector ) && testContext( context.parentNode ) || context\n\t);\n\treturn results;\n};\n\n// One-time assignments\n\n// Sort stability\nsupport.sortStable = expando.split(\"\").sort( sortOrder ).join(\"\") === expando;\n\n// Support: Chrome 14-35+\n// Always assume duplicates if they aren't passed to the comparison function\nsupport.detectDuplicates = !!hasDuplicate;\n\n// Initialize against the default document\nsetDocument();\n\n// Support: Webkit<537.32 - Safari 6.0.3/Chrome 25 (fixed in Chrome 27)\n// Detached nodes confoundingly follow *each other*\nsupport.sortDetached = assert(function( div1 ) {\n\t// Should return 1, but returns 4 (following)\n\treturn div1.compareDocumentPosition( document.createElement(\"div\") ) & 1;\n});\n\n// Support: IE<8\n// Prevent attribute/property \"interpolation\"\n// http://msdn.microsoft.com/en-us/library/ms536429%28VS.85%29.aspx\nif ( !assert(function( div ) {\n\tdiv.innerHTML = \"<a href='#'></a>\";\n\treturn div.firstChild.getAttribute(\"href\") === \"#\" ;\n}) ) {\n\taddHandle( \"type|href|height|width\", function( elem, name, isXML ) {\n\t\tif ( !isXML ) {\n\t\t\treturn elem.getAttribute( name, name.toLowerCase() === \"type\" ? 1 : 2 );\n\t\t}\n\t});\n}\n\n// Support: IE<9\n// Use defaultValue in place of getAttribute(\"value\")\nif ( !support.attributes || !assert(function( div ) {\n\tdiv.innerHTML = \"<input/>\";\n\tdiv.firstChild.setAttribute( \"value\", \"\" );\n\treturn div.firstChild.getAttribute( \"value\" ) === \"\";\n}) ) {\n\taddHandle( \"value\", function( elem, name, isXML ) {\n\t\tif ( !isXML && elem.nodeName.toLowerCase() === \"input\" ) {\n\t\t\treturn elem.defaultValue;\n\t\t}\n\t});\n}\n\n// Support: IE<9\n// Use getAttributeNode to fetch booleans when getAttribute lies\nif ( !assert(function( div ) {\n\treturn div.getAttribute(\"disabled\") == null;\n}) ) {\n\taddHandle( booleans, function( elem, name, isXML ) {\n\t\tvar val;\n\t\tif ( !isXML ) {\n\t\t\treturn elem[ name ] === true ? name.toLowerCase() :\n\t\t\t\t\t(val = elem.getAttributeNode( name )) && val.specified ?\n\t\t\t\t\tval.value :\n\t\t\t\tnull;\n\t\t}\n\t});\n}\n\n// EXPOSE\nreturn Sizzle;\n});\n\n/*eslint-enable */\n\n// Included from: js/tinymce/classes/util/Arr.js\n\n/**\n * Arr.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Array utility class.\n *\n * @private\n * @class tinymce.util.Arr\n */\ndefine(\"tinymce/util/Arr\", [], function() {\n\tvar isArray = Array.isArray || function(obj) {\n\t\treturn Object.prototype.toString.call(obj) === \"[object Array]\";\n\t};\n\n\tfunction toArray(obj) {\n\t\tvar array = obj, i, l;\n\n\t\tif (!isArray(obj)) {\n\t\t\tarray = [];\n\t\t\tfor (i = 0, l = obj.length; i < l; i++) {\n\t\t\t\tarray[i] = obj[i];\n\t\t\t}\n\t\t}\n\n\t\treturn array;\n\t}\n\n\tfunction each(o, cb, s) {\n\t\tvar n, l;\n\n\t\tif (!o) {\n\t\t\treturn 0;\n\t\t}\n\n\t\ts = s || o;\n\n\t\tif (o.length !== undefined) {\n\t\t\t// Indexed arrays, needed for Safari\n\t\t\tfor (n = 0, l = o.length; n < l; n++) {\n\t\t\t\tif (cb.call(s, o[n], n, o) === false) {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Hashtables\n\t\t\tfor (n in o) {\n\t\t\t\tif (o.hasOwnProperty(n)) {\n\t\t\t\t\tif (cb.call(s, o[n], n, o) === false) {\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn 1;\n\t}\n\n\tfunction map(array, callback) {\n\t\tvar out = [];\n\n\t\teach(array, function(item, index) {\n\t\t\tout.push(callback(item, index, array));\n\t\t});\n\n\t\treturn out;\n\t}\n\n\tfunction filter(a, f) {\n\t\tvar o = [];\n\n\t\teach(a, function(v, index) {\n\t\t\tif (!f || f(v, index, a)) {\n\t\t\t\to.push(v);\n\t\t\t}\n\t\t});\n\n\t\treturn o;\n\t}\n\n\tfunction indexOf(a, v) {\n\t\tvar i, l;\n\n\t\tif (a) {\n\t\t\tfor (i = 0, l = a.length; i < l; i++) {\n\t\t\t\tif (a[i] === v) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\tfunction reduce(collection, iteratee, accumulator, thisArg) {\n\t\tvar i = 0;\n\n\t\tif (arguments.length < 3) {\n\t\t\taccumulator = collection[0];\n\t\t}\n\n\t\tfor (; i < collection.length; i++) {\n\t\t\taccumulator = iteratee.call(thisArg, accumulator, collection[i], i);\n\t\t}\n\n\t\treturn accumulator;\n\t}\n\n\tfunction findIndex(array, predicate, thisArg) {\n\t\tvar i, l;\n\n\t\tfor (i = 0, l = array.length; i < l; i++) {\n\t\t\tif (predicate.call(thisArg, array[i], i, array)) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\tfunction find(array, predicate, thisArg) {\n\t\tvar idx = findIndex(array, predicate, thisArg);\n\n\t\tif (idx !== -1) {\n\t\t\treturn array[idx];\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tfunction last(collection) {\n\t\treturn collection[collection.length - 1];\n\t}\n\n\treturn {\n\t\tisArray: isArray,\n\t\ttoArray: toArray,\n\t\teach: each,\n\t\tmap: map,\n\t\tfilter: filter,\n\t\tindexOf: indexOf,\n\t\treduce: reduce,\n\t\tfindIndex: findIndex,\n\t\tfind: find,\n\t\tlast: last\n\t};\n});\n\n// Included from: js/tinymce/classes/util/Tools.js\n\n/**\n * Tools.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains various utlity functions. These are also exposed\n * directly on the tinymce namespace.\n *\n * @class tinymce.util.Tools\n */\ndefine(\"tinymce/util/Tools\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Arr\"\n], function(Env, Arr) {\n\t/**\n\t * Removes whitespace from the beginning and end of a string.\n\t *\n\t * @method trim\n\t * @param {String} s String to remove whitespace from.\n\t * @return {String} New string with removed whitespace.\n\t */\n\tvar whiteSpaceRegExp = /^\\s*|\\s*$/g;\n\n\tfunction trim(str) {\n\t\treturn (str === null || str === undefined) ? '' : (\"\" + str).replace(whiteSpaceRegExp, '');\n\t}\n\n\t/**\n\t * Checks if a object is of a specific type for example an array.\n\t *\n\t * @method is\n\t * @param {Object} obj Object to check type of.\n\t * @param {string} type Optional type to check for.\n\t * @return {Boolean} true/false if the object is of the specified type.\n\t */\n\tfunction is(obj, type) {\n\t\tif (!type) {\n\t\t\treturn obj !== undefined;\n\t\t}\n\n\t\tif (type == 'array' && Arr.isArray(obj)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn typeof obj == type;\n\t}\n\n\t/**\n\t * Makes a name/object map out of an array with names.\n\t *\n\t * @method makeMap\n\t * @param {Array/String} items Items to make map out of.\n\t * @param {String} delim Optional delimiter to split string by.\n\t * @param {Object} map Optional map to add items to.\n\t * @return {Object} Name/value map of items.\n\t */\n\tfunction makeMap(items, delim, map) {\n\t\tvar i;\n\n\t\titems = items || [];\n\t\tdelim = delim || ',';\n\n\t\tif (typeof items == \"string\") {\n\t\t\titems = items.split(delim);\n\t\t}\n\n\t\tmap = map || {};\n\n\t\ti = items.length;\n\t\twhile (i--) {\n\t\t\tmap[items[i]] = {};\n\t\t}\n\n\t\treturn map;\n\t}\n\n\t/**\n\t * Creates a class, subclass or static singleton.\n\t * More details on this method can be found in the Wiki.\n\t *\n\t * @method create\n\t * @param {String} s Class name, inheritance and prefix.\n\t * @param {Object} p Collection of methods to add to the class.\n\t * @param {Object} root Optional root object defaults to the global window object.\n\t * @example\n\t * // Creates a basic class\n\t * tinymce.create('tinymce.somepackage.SomeClass', {\n\t *     SomeClass: function() {\n\t *         // Class constructor\n\t *     },\n\t *\n\t *     method: function() {\n\t *         // Some method\n\t *     }\n\t * });\n\t *\n\t * // Creates a basic subclass class\n\t * tinymce.create('tinymce.somepackage.SomeSubClass:tinymce.somepackage.SomeClass', {\n\t *     SomeSubClass: function() {\n\t *         // Class constructor\n\t *         this.parent(); // Call parent constructor\n\t *     },\n\t *\n\t *     method: function() {\n\t *         // Some method\n\t *         this.parent(); // Call parent method\n\t *     },\n\t *\n\t *     'static': {\n\t *         staticMethod: function() {\n\t *             // Static method\n\t *         }\n\t *     }\n\t * });\n\t *\n\t * // Creates a singleton/static class\n\t * tinymce.create('static tinymce.somepackage.SomeSingletonClass', {\n\t *     method: function() {\n\t *         // Some method\n\t *     }\n\t * });\n\t */\n\tfunction create(s, p, root) {\n\t\tvar self = this, sp, ns, cn, scn, c, de = 0;\n\n\t\t// Parse : <prefix> <class>:<super class>\n\t\ts = /^((static) )?([\\w.]+)(:([\\w.]+))?/.exec(s);\n\t\tcn = s[3].match(/(^|\\.)(\\w+)$/i)[2]; // Class name\n\n\t\t// Create namespace for new class\n\t\tns = self.createNS(s[3].replace(/\\.\\w+$/, ''), root);\n\n\t\t// Class already exists\n\t\tif (ns[cn]) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Make pure static class\n\t\tif (s[2] == 'static') {\n\t\t\tns[cn] = p;\n\n\t\t\tif (this.onCreate) {\n\t\t\t\tthis.onCreate(s[2], s[3], ns[cn]);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Create default constructor\n\t\tif (!p[cn]) {\n\t\t\tp[cn] = function() {};\n\t\t\tde = 1;\n\t\t}\n\n\t\t// Add constructor and methods\n\t\tns[cn] = p[cn];\n\t\tself.extend(ns[cn].prototype, p);\n\n\t\t// Extend\n\t\tif (s[5]) {\n\t\t\tsp = self.resolve(s[5]).prototype;\n\t\t\tscn = s[5].match(/\\.(\\w+)$/i)[1]; // Class name\n\n\t\t\t// Extend constructor\n\t\t\tc = ns[cn];\n\t\t\tif (de) {\n\t\t\t\t// Add passthrough constructor\n\t\t\t\tns[cn] = function() {\n\t\t\t\t\treturn sp[scn].apply(this, arguments);\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// Add inherit constructor\n\t\t\t\tns[cn] = function() {\n\t\t\t\t\tthis.parent = sp[scn];\n\t\t\t\t\treturn c.apply(this, arguments);\n\t\t\t\t};\n\t\t\t}\n\t\t\tns[cn].prototype[cn] = ns[cn];\n\n\t\t\t// Add super methods\n\t\t\tself.each(sp, function(f, n) {\n\t\t\t\tns[cn].prototype[n] = sp[n];\n\t\t\t});\n\n\t\t\t// Add overridden methods\n\t\t\tself.each(p, function(f, n) {\n\t\t\t\t// Extend methods if needed\n\t\t\t\tif (sp[n]) {\n\t\t\t\t\tns[cn].prototype[n] = function() {\n\t\t\t\t\t\tthis.parent = sp[n];\n\t\t\t\t\t\treturn f.apply(this, arguments);\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tif (n != cn) {\n\t\t\t\t\t\tns[cn].prototype[n] = f;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Add static methods\n\t\t/*jshint sub:true*/\n\t\t/*eslint dot-notation:0*/\n\t\tself.each(p['static'], function(f, n) {\n\t\t\tns[cn][n] = f;\n\t\t});\n\t}\n\n\tfunction extend(obj, ext) {\n\t\tvar i, l, name, args = arguments, value;\n\n\t\tfor (i = 1, l = args.length; i < l; i++) {\n\t\t\text = args[i];\n\t\t\tfor (name in ext) {\n\t\t\t\tif (ext.hasOwnProperty(name)) {\n\t\t\t\t\tvalue = ext[name];\n\n\t\t\t\t\tif (value !== undefined) {\n\t\t\t\t\t\tobj[name] = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\t/**\n\t * Executed the specified function for each item in a object tree.\n\t *\n\t * @method walk\n\t * @param {Object} o Object tree to walk though.\n\t * @param {function} f Function to call for each item.\n\t * @param {String} n Optional name of collection inside the objects to walk for example childNodes.\n\t * @param {String} s Optional scope to execute the function in.\n\t */\n\tfunction walk(o, f, n, s) {\n\t\ts = s || this;\n\n\t\tif (o) {\n\t\t\tif (n) {\n\t\t\t\to = o[n];\n\t\t\t}\n\n\t\t\tArr.each(o, function(o, i) {\n\t\t\t\tif (f.call(s, o, i, n) === false) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\twalk(o, f, n, s);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Creates a namespace on a specific object.\n\t *\n\t * @method createNS\n\t * @param {String} n Namespace to create for example a.b.c.d.\n\t * @param {Object} o Optional object to add namespace to, defaults to window.\n\t * @return {Object} New namespace object the last item in path.\n\t * @example\n\t * // Create some namespace\n\t * tinymce.createNS('tinymce.somepackage.subpackage');\n\t *\n\t * // Add a singleton\n\t * var tinymce.somepackage.subpackage.SomeSingleton = {\n\t *     method: function() {\n\t *         // Some method\n\t *     }\n\t * };\n\t */\n\tfunction createNS(n, o) {\n\t\tvar i, v;\n\n\t\to = o || window;\n\n\t\tn = n.split('.');\n\t\tfor (i = 0; i < n.length; i++) {\n\t\t\tv = n[i];\n\n\t\t\tif (!o[v]) {\n\t\t\t\to[v] = {};\n\t\t\t}\n\n\t\t\to = o[v];\n\t\t}\n\n\t\treturn o;\n\t}\n\n\t/**\n\t * Resolves a string and returns the object from a specific structure.\n\t *\n\t * @method resolve\n\t * @param {String} n Path to resolve for example a.b.c.d.\n\t * @param {Object} o Optional object to search though, defaults to window.\n\t * @return {Object} Last object in path or null if it couldn't be resolved.\n\t * @example\n\t * // Resolve a path into an object reference\n\t * var obj = tinymce.resolve('a.b.c.d');\n\t */\n\tfunction resolve(n, o) {\n\t\tvar i, l;\n\n\t\to = o || window;\n\n\t\tn = n.split('.');\n\t\tfor (i = 0, l = n.length; i < l; i++) {\n\t\t\to = o[n[i]];\n\n\t\t\tif (!o) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn o;\n\t}\n\n\t/**\n\t * Splits a string but removes the whitespace before and after each value.\n\t *\n\t * @method explode\n\t * @param {string} s String to split.\n\t * @param {string} d Delimiter to split by.\n\t * @example\n\t * // Split a string into an array with a,b,c\n\t * var arr = tinymce.explode('a, b,   c');\n\t */\n\tfunction explode(s, d) {\n\t\tif (!s || is(s, 'array')) {\n\t\t\treturn s;\n\t\t}\n\n\t\treturn Arr.map(s.split(d || ','), trim);\n\t}\n\n\tfunction _addCacheSuffix(url) {\n\t\tvar cacheSuffix = Env.cacheSuffix;\n\n\t\tif (cacheSuffix) {\n\t\t\turl += (url.indexOf('?') === -1 ? '?' : '&') + cacheSuffix;\n\t\t}\n\n\t\treturn url;\n\t}\n\n\treturn {\n\t\ttrim: trim,\n\n\t\t/**\n\t\t * Returns true/false if the object is an array or not.\n\t\t *\n\t\t * @method isArray\n\t\t * @param {Object} obj Object to check.\n\t\t * @return {boolean} true/false state if the object is an array or not.\n\t\t */\n\t\tisArray: Arr.isArray,\n\n\t\tis: is,\n\n\t\t/**\n\t\t * Converts the specified object into a real JavaScript array.\n\t\t *\n\t\t * @method toArray\n\t\t * @param {Object} obj Object to convert into array.\n\t\t * @return {Array} Array object based in input.\n\t\t */\n\t\ttoArray: Arr.toArray,\n\t\tmakeMap: makeMap,\n\n\t\t/**\n\t\t * Performs an iteration of all items in a collection such as an object or array. This method will execure the\n\t\t * callback function for each item in the collection, if the callback returns false the iteration will terminate.\n\t\t * The callback has the following format: cb(value, key_or_index).\n\t\t *\n\t\t * @method each\n\t\t * @param {Object} o Collection to iterate.\n\t\t * @param {function} cb Callback function to execute for each item.\n\t\t * @param {Object} s Optional scope to execute the callback in.\n\t\t * @example\n\t\t * // Iterate an array\n\t\t * tinymce.each([1,2,3], function(v, i) {\n\t\t *     console.debug(\"Value: \" + v + \", Index: \" + i);\n\t\t * });\n\t\t *\n\t\t * // Iterate an object\n\t\t * tinymce.each({a: 1, b: 2, c: 3], function(v, k) {\n\t\t *     console.debug(\"Value: \" + v + \", Key: \" + k);\n\t\t * });\n\t\t */\n\t\teach: Arr.each,\n\n\t\t/**\n\t\t * Creates a new array by the return value of each iteration function call. This enables you to convert\n\t\t * one array list into another.\n\t\t *\n\t\t * @method map\n\t\t * @param {Array} array Array of items to iterate.\n\t\t * @param {function} callback Function to call for each item. It's return value will be the new value.\n\t\t * @return {Array} Array with new values based on function return values.\n\t\t */\n\t\tmap: Arr.map,\n\n\t\t/**\n\t\t * Filters out items from the input array by calling the specified function for each item.\n\t\t * If the function returns false the item will be excluded if it returns true it will be included.\n\t\t *\n\t\t * @method grep\n\t\t * @param {Array} a Array of items to loop though.\n\t\t * @param {function} f Function to call for each item. Include/exclude depends on it's return value.\n\t\t * @return {Array} New array with values imported and filtered based in input.\n\t\t * @example\n\t\t * // Filter out some items, this will return an array with 4 and 5\n\t\t * var items = tinymce.grep([1,2,3,4,5], function(v) {return v > 3;});\n\t\t */\n\t\tgrep: Arr.filter,\n\n\t\t/**\n\t\t * Returns true/false if the object is an array or not.\n\t\t *\n\t\t * @method isArray\n\t\t * @param {Object} obj Object to check.\n\t\t * @return {boolean} true/false state if the object is an array or not.\n\t\t */\n\t\tinArray: Arr.indexOf,\n\n\t\textend: extend,\n\t\tcreate: create,\n\t\twalk: walk,\n\t\tcreateNS: createNS,\n\t\tresolve: resolve,\n\t\texplode: explode,\n\t\t_addCacheSuffix: _addCacheSuffix\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/DomQuery.js\n\n/**\n * DomQuery.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class mimics most of the jQuery API:\n *\n * This is whats currently implemented:\n * - Utility functions\n * - DOM traversial\n * - DOM manipulation\n * - Event binding\n *\n * This is not currently implemented:\n * - Dimension\n * - Ajax\n * - Animation\n * - Advanced chaining\n *\n * @example\n * var $ = tinymce.dom.DomQuery;\n * $('p').attr('attr', 'value').addClass('class');\n *\n * @class tinymce.dom.DomQuery\n */\ndefine(\"tinymce/dom/DomQuery\", [\n\t\"tinymce/dom/EventUtils\",\n\t\"tinymce/dom/Sizzle\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/Env\"\n], function(EventUtils, Sizzle, Tools, Env) {\n\tvar doc = document, push = Array.prototype.push, slice = Array.prototype.slice;\n\tvar rquickExpr = /^(?:[^#<]*(<[\\w\\W]+>)[^>]*$|#([\\w\\-]*)$)/;\n\tvar Event = EventUtils.Event, undef;\n\tvar skipUniques = Tools.makeMap('children,contents,next,prev');\n\n\tfunction isDefined(obj) {\n\t\treturn typeof obj !== 'undefined';\n\t}\n\n\tfunction isString(obj) {\n\t\treturn typeof obj === 'string';\n\t}\n\n\tfunction isWindow(obj) {\n\t\treturn obj && obj == obj.window;\n\t}\n\n\tfunction createFragment(html, fragDoc) {\n\t\tvar frag, node, container;\n\n\t\tfragDoc = fragDoc || doc;\n\t\tcontainer = fragDoc.createElement('div');\n\t\tfrag = fragDoc.createDocumentFragment();\n\t\tcontainer.innerHTML = html;\n\n\t\twhile ((node = container.firstChild)) {\n\t\t\tfrag.appendChild(node);\n\t\t}\n\n\t\treturn frag;\n\t}\n\n\tfunction domManipulate(targetNodes, sourceItem, callback, reverse) {\n\t\tvar i;\n\n\t\tif (isString(sourceItem)) {\n\t\t\tsourceItem = createFragment(sourceItem, getElementDocument(targetNodes[0]));\n\t\t} else if (sourceItem.length && !sourceItem.nodeType) {\n\t\t\tsourceItem = DomQuery.makeArray(sourceItem);\n\n\t\t\tif (reverse) {\n\t\t\t\tfor (i = sourceItem.length - 1; i >= 0; i--) {\n\t\t\t\t\tdomManipulate(targetNodes, sourceItem[i], callback, reverse);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (i = 0; i < sourceItem.length; i++) {\n\t\t\t\t\tdomManipulate(targetNodes, sourceItem[i], callback, reverse);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn targetNodes;\n\t\t}\n\n\t\tif (sourceItem.nodeType) {\n\t\t\ti = targetNodes.length;\n\t\t\twhile (i--) {\n\t\t\t\tcallback.call(targetNodes[i], sourceItem);\n\t\t\t}\n\t\t}\n\n\t\treturn targetNodes;\n\t}\n\n\tfunction hasClass(node, className) {\n\t\treturn node && className && (' ' + node.className + ' ').indexOf(' ' + className + ' ') !== -1;\n\t}\n\n\tfunction wrap(elements, wrapper, all) {\n\t\tvar lastParent, newWrapper;\n\n\t\twrapper = DomQuery(wrapper)[0];\n\n\t\telements.each(function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!all || lastParent != self.parentNode) {\n\t\t\t\tlastParent = self.parentNode;\n\t\t\t\tnewWrapper = wrapper.cloneNode(false);\n\t\t\t\tself.parentNode.insertBefore(newWrapper, self);\n\t\t\t\tnewWrapper.appendChild(self);\n\t\t\t} else {\n\t\t\t\tnewWrapper.appendChild(self);\n\t\t\t}\n\t\t});\n\n\t\treturn elements;\n\t}\n\n\tvar numericCssMap = Tools.makeMap('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom', ' ');\n\tvar booleanMap = Tools.makeMap('checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected', ' ');\n\tvar propFix = {\n\t\t'for': 'htmlFor',\n\t\t'class': 'className',\n\t\t'readonly': 'readOnly'\n\t};\n\tvar cssFix = {\n\t\t'float': 'cssFloat'\n\t};\n\n\tvar attrHooks = {}, cssHooks = {};\n\n\tfunction DomQuery(selector, context) {\n\t\t/*eslint new-cap:0 */\n\t\treturn new DomQuery.fn.init(selector, context);\n\t}\n\n\tfunction inArray(item, array) {\n\t\tvar i;\n\n\t\tif (array.indexOf) {\n\t\t\treturn array.indexOf(item);\n\t\t}\n\n\t\ti = array.length;\n\t\twhile (i--) {\n\t\t\tif (array[i] === item) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\tvar whiteSpaceRegExp = /^\\s*|\\s*$/g;\n\n\tfunction trim(str) {\n\t\treturn (str === null || str === undef) ? '' : (\"\" + str).replace(whiteSpaceRegExp, '');\n\t}\n\n\tfunction each(obj, callback) {\n\t\tvar length, key, i, undef, value;\n\n\t\tif (obj) {\n\t\t\tlength = obj.length;\n\n\t\t\tif (length === undef) {\n\t\t\t\t// Loop object items\n\t\t\t\tfor (key in obj) {\n\t\t\t\t\tif (obj.hasOwnProperty(key)) {\n\t\t\t\t\t\tvalue = obj[key];\n\t\t\t\t\t\tif (callback.call(value, key, value) === false) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Loop array items\n\t\t\t\tfor (i = 0; i < length; i++) {\n\t\t\t\t\tvalue = obj[i];\n\t\t\t\t\tif (callback.call(value, i, value) === false) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\tfunction grep(array, callback) {\n\t\tvar out = [];\n\n\t\teach(array, function(i, item) {\n\t\t\tif (callback(item, i)) {\n\t\t\t\tout.push(item);\n\t\t\t}\n\t\t});\n\n\t\treturn out;\n\t}\n\n\tfunction getElementDocument(element) {\n\t\tif (!element) {\n\t\t\treturn doc;\n\t\t}\n\n\t\tif (element.nodeType == 9) {\n\t\t\treturn element;\n\t\t}\n\n\t\treturn element.ownerDocument;\n\t}\n\n\tDomQuery.fn = DomQuery.prototype = {\n\t\tconstructor: DomQuery,\n\n\t\t/**\n\t\t * Selector for the current set.\n\t\t *\n\t\t * @property selector\n\t\t * @type String\n\t\t */\n\t\tselector: \"\",\n\n\t\t/**\n\t\t * Context used to create the set.\n\t\t *\n\t\t * @property context\n\t\t * @type Element\n\t\t */\n\t\tcontext: null,\n\n\t\t/**\n\t\t * Number of items in the current set.\n\t\t *\n\t\t * @property length\n\t\t * @type Number\n\t\t */\n\t\tlength: 0,\n\n\t\t/**\n\t\t * Constructs a new DomQuery instance with the specified selector or context.\n\t\t *\n\t\t * @constructor\n\t\t * @method init\n\t\t * @param {String/Array/DomQuery} selector Optional CSS selector/Array or array like object or HTML string.\n\t\t * @param {Document/Element} context Optional context to search in.\n\t\t */\n\t\tinit: function(selector, context) {\n\t\t\tvar self = this, match, node;\n\n\t\t\tif (!selector) {\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\tif (selector.nodeType) {\n\t\t\t\tself.context = self[0] = selector;\n\t\t\t\tself.length = 1;\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\tif (context && context.nodeType) {\n\t\t\t\tself.context = context;\n\t\t\t} else {\n\t\t\t\tif (context) {\n\t\t\t\t\treturn DomQuery(selector).attr(context);\n\t\t\t\t}\n\n\t\t\t\tself.context = context = document;\n\t\t\t}\n\n\t\t\tif (isString(selector)) {\n\t\t\t\tself.selector = selector;\n\n\t\t\t\tif (selector.charAt(0) === \"<\" && selector.charAt(selector.length - 1) === \">\" && selector.length >= 3) {\n\t\t\t\t\tmatch = [null, selector, null];\n\t\t\t\t} else {\n\t\t\t\t\tmatch = rquickExpr.exec(selector);\n\t\t\t\t}\n\n\t\t\t\tif (match) {\n\t\t\t\t\tif (match[1]) {\n\t\t\t\t\t\tnode = createFragment(selector, getElementDocument(context)).firstChild;\n\n\t\t\t\t\t\twhile (node) {\n\t\t\t\t\t\t\tpush.call(self, node);\n\t\t\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnode = getElementDocument(context).getElementById(match[2]);\n\n\t\t\t\t\t\tif (!node) {\n\t\t\t\t\t\t\treturn self;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (node.id !== match[2]) {\n\t\t\t\t\t\t\treturn self.find(selector);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself.length = 1;\n\t\t\t\t\t\tself[0] = node;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn DomQuery(context).find(selector);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.add(selector, false);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Converts the current set to an array.\n\t\t *\n\t\t * @method toArray\n\t\t * @return {Array} Array of all nodes in set.\n\t\t */\n\t\ttoArray: function() {\n\t\t\treturn Tools.toArray(this);\n\t\t},\n\n\t\t/**\n\t\t * Adds new nodes to the set.\n\t\t *\n\t\t * @method add\n\t\t * @param {Array/tinymce.dom.DomQuery} items Array of all nodes to add to set.\n\t\t * @param {Boolean} sort Optional sort flag that enables sorting of elements.\n\t\t * @return {tinymce.dom.DomQuery} New instance with nodes added.\n\t\t */\n\t\tadd: function(items, sort) {\n\t\t\tvar self = this, nodes, i;\n\n\t\t\tif (isString(items)) {\n\t\t\t\treturn self.add(DomQuery(items));\n\t\t\t}\n\n\t\t\tif (sort !== false) {\n\t\t\t\tnodes = DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items)));\n\t\t\t\tself.length = nodes.length;\n\t\t\t\tfor (i = 0; i < nodes.length; i++) {\n\t\t\t\t\tself[i] = nodes[i];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpush.apply(self, DomQuery.makeArray(items));\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets attributes on the elements in the current set.\n\t\t *\n\t\t * @method attr\n\t\t * @param {String/Object} name Name of attribute to get or an object with attributes to set.\n\t\t * @param {String} value Optional value to set.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the specified attribute when only the name is specified.\n\t\t */\n\t\tattr: function(name, value) {\n\t\t\tvar self = this, hook;\n\n\t\t\tif (typeof name === \"object\") {\n\t\t\t\teach(name, function(name, value) {\n\t\t\t\t\tself.attr(name, value);\n\t\t\t\t});\n\t\t\t} else if (isDefined(value)) {\n\t\t\t\tthis.each(function() {\n\t\t\t\t\tvar hook;\n\n\t\t\t\t\tif (this.nodeType === 1) {\n\t\t\t\t\t\thook = attrHooks[name];\n\t\t\t\t\t\tif (hook && hook.set) {\n\t\t\t\t\t\t\thook.set(this, value);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\t\tthis.removeAttribute(name, 2);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.setAttribute(name, value, 2);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (self[0] && self[0].nodeType === 1) {\n\t\t\t\t\thook = attrHooks[name];\n\t\t\t\t\tif (hook && hook.get) {\n\t\t\t\t\t\treturn hook.get(self[0], name);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (booleanMap[name]) {\n\t\t\t\t\t\treturn self.prop(name) ? name : undef;\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = self[0].getAttribute(name, 2);\n\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tvalue = undef;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Removes attributse on the elements in the current set.\n\t\t *\n\t\t * @method removeAttr\n\t\t * @param {String/Object} name Name of attribute to remove.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set.\n\t\t */\n\t\tremoveAttr: function(name) {\n\t\t\treturn this.attr(name, null);\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets properties on the elements in the current set.\n\t\t *\n\t\t * @method attr\n\t\t * @param {String/Object} name Name of property to get or an object with properties to set.\n\t\t * @param {String} value Optional value to set.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the specified property when only the name is specified.\n\t\t */\n\t\tprop: function(name, value) {\n\t\t\tvar self = this;\n\n\t\t\tname = propFix[name] || name;\n\n\t\t\tif (typeof name === \"object\") {\n\t\t\t\teach(name, function(name, value) {\n\t\t\t\t\tself.prop(name, value);\n\t\t\t\t});\n\t\t\t} else if (isDefined(value)) {\n\t\t\t\tthis.each(function() {\n\t\t\t\t\tif (this.nodeType == 1) {\n\t\t\t\t\t\tthis[name] = value;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (self[0] && self[0].nodeType && name in self[0]) {\n\t\t\t\t\treturn self[0][name];\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets styles on the elements in the current set.\n\t\t *\n\t\t * @method css\n\t\t * @param {String/Object} name Name of style to get or an object with styles to set.\n\t\t * @param {String} value Optional value to set.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the specified style when only the name is specified.\n\t\t */\n\t\tcss: function(name, value) {\n\t\t\tvar self = this, elm, hook;\n\n\t\t\tfunction camel(name) {\n\t\t\t\treturn name.replace(/-(\\D)/g, function(a, b) {\n\t\t\t\t\treturn b.toUpperCase();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction dashed(name) {\n\t\t\t\treturn name.replace(/[A-Z]/g, function(a) {\n\t\t\t\t\treturn '-' + a;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (typeof name === \"object\") {\n\t\t\t\teach(name, function(name, value) {\n\t\t\t\t\tself.css(name, value);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (isDefined(value)) {\n\t\t\t\t\tname = camel(name);\n\n\t\t\t\t\t// Default px suffix on these\n\t\t\t\t\tif (typeof value === 'number' && !numericCssMap[name]) {\n\t\t\t\t\t\tvalue += 'px';\n\t\t\t\t\t}\n\n\t\t\t\t\tself.each(function() {\n\t\t\t\t\t\tvar style = this.style;\n\n\t\t\t\t\t\thook = cssHooks[name];\n\t\t\t\t\t\tif (hook && hook.set) {\n\t\t\t\t\t\t\thook.set(this, value);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.style[cssFix[name] || name] = value;\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\t// Ignore\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (value === null || value === '') {\n\t\t\t\t\t\t\tif (style.removeProperty) {\n\t\t\t\t\t\t\t\tstyle.removeProperty(dashed(name));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tstyle.removeAttribute(name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\telm = self[0];\n\n\t\t\t\t\thook = cssHooks[name];\n\t\t\t\t\tif (hook && hook.get) {\n\t\t\t\t\t\treturn hook.get(elm);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (elm.ownerDocument.defaultView) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\treturn elm.ownerDocument.defaultView.getComputedStyle(elm, null).getPropertyValue(dashed(name));\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\treturn undef;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (elm.currentStyle) {\n\t\t\t\t\t\treturn elm.currentStyle[camel(name)];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Removes all nodes in set from the document.\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.dom.DomQuery} Current set with the removed nodes.\n\t\t */\n\t\tremove: function() {\n\t\t\tvar self = this, node, i = this.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = self[i];\n\t\t\t\tEvent.clean(node);\n\n\t\t\t\tif (node.parentNode) {\n\t\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Empties all elements in set.\n\t\t *\n\t\t * @method empty\n\t\t * @return {tinymce.dom.DomQuery} Current set with the empty nodes.\n\t\t */\n\t\tempty: function() {\n\t\t\tvar self = this, node, i = this.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = self[i];\n\t\t\t\twhile (node.firstChild) {\n\t\t\t\t\tnode.removeChild(node.firstChild);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Sets or gets the HTML of the current set or first set node.\n\t\t *\n\t\t * @method html\n\t\t * @param {String} value Optional innerHTML value to set on each element.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the innerHTML of the first element.\n\t\t */\n\t\thtml: function(value) {\n\t\t\tvar self = this, i;\n\n\t\t\tif (isDefined(value)) {\n\t\t\t\ti = self.length;\n\n\t\t\t\ttry {\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tself[i].innerHTML = value;\n\t\t\t\t\t}\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Workaround for \"Unknown runtime error\" when DIV is added to P on IE\n\t\t\t\t\tDomQuery(self[i]).empty().append(value);\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\treturn self[0] ? self[0].innerHTML : '';\n\t\t},\n\n\t\t/**\n\t\t * Sets or gets the text of the current set or first set node.\n\t\t *\n\t\t * @method text\n\t\t * @param {String} value Optional innerText value to set on each element.\n\t\t * @return {tinymce.dom.DomQuery/String} Current set or the innerText of the first element.\n\t\t */\n\t\ttext: function(value) {\n\t\t\tvar self = this, i;\n\n\t\t\tif (isDefined(value)) {\n\t\t\t\ti = self.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tif (\"innerText\" in self[i]) {\n\t\t\t\t\t\tself[i].innerText = value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself[0].textContent = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\treturn self[0] ? (self[0].innerText || self[0].textContent) : '';\n\t\t},\n\n\t\t/**\n\t\t * Appends the specified node/html or node set to the current set nodes.\n\t\t *\n\t\t * @method append\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to append to each element in set.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tappend: function() {\n\t\t\treturn domManipulate(this, arguments, function(node) {\n\t\t\t\t// Either element or Shadow Root\n\t\t\t\tif (this.nodeType === 1 || (this.host && this.host.nodeType === 1)) {\n\t\t\t\t\tthis.appendChild(node);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Prepends the specified node/html or node set to the current set nodes.\n\t\t *\n\t\t * @method prepend\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to prepend to each element in set.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tprepend: function() {\n\t\t\treturn domManipulate(this, arguments, function(node) {\n\t\t\t\t// Either element or Shadow Root\n\t\t\t\tif (this.nodeType === 1 || (this.host && this.host.nodeType === 1)) {\n\t\t\t\t\tthis.insertBefore(node, this.firstChild);\n\t\t\t\t}\n\t\t\t}, true);\n\t\t},\n\n\t\t/**\n\t\t * Adds the specified elements before current set nodes.\n\t\t *\n\t\t * @method before\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to add before to each element in set.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tbefore: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self[0] && self[0].parentNode) {\n\t\t\t\treturn domManipulate(self, arguments, function(node) {\n\t\t\t\t\tthis.parentNode.insertBefore(node, this);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Adds the specified elements after current set nodes.\n\t\t *\n\t\t * @method after\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to add after to each element in set.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tafter: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self[0] && self[0].parentNode) {\n\t\t\t\treturn domManipulate(self, arguments, function(node) {\n\t\t\t\t\tthis.parentNode.insertBefore(node, this.nextSibling);\n\t\t\t\t}, true);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Appends the specified set nodes to the specified selector/instance.\n\t\t *\n\t\t * @method appendTo\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} val Item to append the current set to.\n\t\t * @return {tinymce.dom.DomQuery} Current set with the appended nodes.\n\t\t */\n\t\tappendTo: function(val) {\n\t\t\tDomQuery(val).append(this);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Prepends the specified set nodes to the specified selector/instance.\n\t\t *\n\t\t * @method prependTo\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} val Item to prepend the current set to.\n\t\t * @return {tinymce.dom.DomQuery} Current set with the prepended nodes.\n\t\t */\n\t\tprependTo: function(val) {\n\t\t\tDomQuery(val).prepend(this);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Replaces the nodes in set with the specified content.\n\t\t *\n\t\t * @method replaceWith\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to replace nodes with.\n\t\t * @return {tinymce.dom.DomQuery} Set with replaced nodes.\n\t\t */\n\t\treplaceWith: function(content) {\n\t\t\treturn this.before(content).remove();\n\t\t},\n\n\t\t/**\n\t\t * Wraps all elements in set with the specified wrapper.\n\t\t *\n\t\t * @method wrap\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to wrap nodes with.\n\t\t * @return {tinymce.dom.DomQuery} Set with wrapped nodes.\n\t\t */\n\t\twrap: function(content) {\n\t\t\treturn wrap(this, content);\n\t\t},\n\n\t\t/**\n\t\t * Wraps all nodes in set with the specified wrapper. If the nodes are siblings all of them\n\t\t * will be wrapped in the same wrapper.\n\t\t *\n\t\t * @method wrapAll\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to wrap nodes with.\n\t\t * @return {tinymce.dom.DomQuery} Set with wrapped nodes.\n\t\t */\n\t\twrapAll: function(content) {\n\t\t\treturn wrap(this, content, true);\n\t\t},\n\n\t\t/**\n\t\t * Wraps all elements inner contents in set with the specified wrapper.\n\t\t *\n\t\t * @method wrapInner\n\t\t * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to wrap nodes with.\n\t\t * @return {tinymce.dom.DomQuery} Set with wrapped nodes.\n\t\t */\n\t\twrapInner: function(content) {\n\t\t\tthis.each(function() {\n\t\t\t\tDomQuery(this).contents().wrapAll(content);\n\t\t\t});\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Unwraps all elements by removing the parent element of each item in set.\n\t\t *\n\t\t * @method unwrap\n\t\t * @return {tinymce.dom.DomQuery} Set with unwrapped nodes.\n\t\t */\n\t\tunwrap: function() {\n\t\t\treturn this.parent().each(function() {\n\t\t\t\tDomQuery(this).replaceWith(this.childNodes);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Clones all nodes in set.\n\t\t *\n\t\t * @method clone\n\t\t * @return {tinymce.dom.DomQuery} Set with cloned nodes.\n\t\t */\n\t\tclone: function() {\n\t\t\tvar result = [];\n\n\t\t\tthis.each(function() {\n\t\t\t\tresult.push(this.cloneNode(true));\n\t\t\t});\n\n\t\t\treturn DomQuery(result);\n\t\t},\n\n\t\t/**\n\t\t * Adds the specified class name to the current set elements.\n\t\t *\n\t\t * @method addClass\n\t\t * @param {String} className Class name to add.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\taddClass: function(className) {\n\t\t\treturn this.toggleClass(className, true);\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified class name to the current set elements.\n\t\t *\n\t\t * @method removeClass\n\t\t * @param {String} className Class name to remove.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tremoveClass: function(className) {\n\t\t\treturn this.toggleClass(className, false);\n\t\t},\n\n\t\t/**\n\t\t * Toggles the specified class name on the current set elements.\n\t\t *\n\t\t * @method toggleClass\n\t\t * @param {String} className Class name to add/remove.\n\t\t * @param {Boolean} state Optional state to toggle on/off.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\ttoggleClass: function(className, state) {\n\t\t\tvar self = this;\n\n\t\t\t// Functions are not supported\n\t\t\tif (typeof className != 'string') {\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\tif (className.indexOf(' ') !== -1) {\n\t\t\t\teach(className.split(' '), function() {\n\t\t\t\t\tself.toggleClass(this, state);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tself.each(function(index, node) {\n\t\t\t\t\tvar existingClassName, classState;\n\n\t\t\t\t\tclassState = hasClass(node, className);\n\t\t\t\t\tif (classState !== state) {\n\t\t\t\t\t\texistingClassName = node.className;\n\n\t\t\t\t\t\tif (classState) {\n\t\t\t\t\t\t\tnode.className = trim((\" \" + existingClassName + \" \").replace(' ' + className + ' ', ' '));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.className += existingClassName ? ' ' + className : className;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the first item in set has the specified class.\n\t\t *\n\t\t * @method hasClass\n\t\t * @param {String} className Class name to check for.\n\t\t * @return {Boolean} True/false if the set has the specified class.\n\t\t */\n\t\thasClass: function(className) {\n\t\t\treturn hasClass(this[0], className);\n\t\t},\n\n\t\t/**\n\t\t * Executes the callback function for each item DomQuery collection. If you return false in the\n\t\t * callback it will break the loop.\n\t\t *\n\t\t * @method each\n\t\t * @param {function} callback Callback function to execute for each item.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\teach: function(callback) {\n\t\t\treturn each(this, callback);\n\t\t},\n\n\t\t/**\n\t\t * Binds an event with callback function to the elements in set.\n\t\t *\n\t\t * @method on\n\t\t * @param {String} name Name of the event to bind.\n\t\t * @param {function} callback Callback function to execute when the event occurs.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\ton: function(name, callback) {\n\t\t\treturn this.each(function() {\n\t\t\t\tEvent.bind(this, name, callback);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Unbinds an event with callback function to the elements in set.\n\t\t *\n\t\t * @method off\n\t\t * @param {String} name Optional name of the event to bind.\n\t\t * @param {function} callback Optional callback function to execute when the event occurs.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\toff: function(name, callback) {\n\t\t\treturn this.each(function() {\n\t\t\t\tEvent.unbind(this, name, callback);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Triggers the specified event by name or event object.\n\t\t *\n\t\t * @method trigger\n\t\t * @param {String/Object} name Name of the event to trigger or event object.\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\ttrigger: function(name) {\n\t\t\treturn this.each(function() {\n\t\t\t\tif (typeof name == 'object') {\n\t\t\t\t\tEvent.fire(this, name.type, name);\n\t\t\t\t} else {\n\t\t\t\t\tEvent.fire(this, name);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Shows all elements in set.\n\t\t *\n\t\t * @method show\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\tshow: function() {\n\t\t\treturn this.css('display', '');\n\t\t},\n\n\t\t/**\n\t\t * Hides all elements in set.\n\t\t *\n\t\t * @method hide\n\t\t * @return {tinymce.dom.DomQuery} Current set.\n\t\t */\n\t\thide: function() {\n\t\t\treturn this.css('display', 'none');\n\t\t},\n\n\t\t/**\n\t\t * Slices the current set.\n\t\t *\n\t\t * @method slice\n\t\t * @param {Number} start Start index to slice at.\n\t\t * @param {Number} end Optional end index to end slice at.\n\t\t * @return {tinymce.dom.DomQuery} Sliced set.\n\t\t */\n\t\tslice: function() {\n\t\t\treturn new DomQuery(slice.apply(this, arguments));\n\t\t},\n\n\t\t/**\n\t\t * Makes the set equal to the specified index.\n\t\t *\n\t\t * @method eq\n\t\t * @param {Number} index Index to set it equal to.\n\t\t * @return {tinymce.dom.DomQuery} Single item set.\n\t\t */\n\t\teq: function(index) {\n\t\t\treturn index === -1 ? this.slice(index) : this.slice(index, +index + 1);\n\t\t},\n\n\t\t/**\n\t\t * Makes the set equal to first element in set.\n\t\t *\n\t\t * @method first\n\t\t * @return {tinymce.dom.DomQuery} Single item set.\n\t\t */\n\t\tfirst: function() {\n\t\t\treturn this.eq(0);\n\t\t},\n\n\t\t/**\n\t\t * Makes the set equal to last element in set.\n\t\t *\n\t\t * @method last\n\t\t * @return {tinymce.dom.DomQuery} Single item set.\n\t\t */\n\t\tlast: function() {\n\t\t\treturn this.eq(-1);\n\t\t},\n\n\t\t/**\n\t\t * Finds elements by the specified selector for each element in set.\n\t\t *\n\t\t * @method find\n\t\t * @param {String} selector Selector to find elements by.\n\t\t * @return {tinymce.dom.DomQuery} Set with matches elements.\n\t\t */\n\t\tfind: function(selector) {\n\t\t\tvar i, l, ret = [];\n\n\t\t\tfor (i = 0, l = this.length; i < l; i++) {\n\t\t\t\tDomQuery.find(selector, this[i], ret);\n\t\t\t}\n\n\t\t\treturn DomQuery(ret);\n\t\t},\n\n\t\t/**\n\t\t * Filters the current set with the specified selector.\n\t\t *\n\t\t * @method filter\n\t\t * @param {String/function} selector Selector to filter elements by.\n\t\t * @return {tinymce.dom.DomQuery} Set with filtered elements.\n\t\t */\n\t\tfilter: function(selector) {\n\t\t\tif (typeof selector == 'function') {\n\t\t\t\treturn DomQuery(grep(this.toArray(), function(item, i) {\n\t\t\t\t\treturn selector(i, item);\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\treturn DomQuery(DomQuery.filter(selector, this.toArray()));\n\t\t},\n\n\t\t/**\n\t\t * Gets the current node or any parent matching the specified selector.\n\t\t *\n\t\t * @method closest\n\t\t * @param {String/Element/tinymce.dom.DomQuery} selector Selector or element to find.\n\t\t * @return {tinymce.dom.DomQuery} Set with closest elements.\n\t\t */\n\t\tclosest: function(selector) {\n\t\t\tvar result = [];\n\n\t\t\tif (selector instanceof DomQuery) {\n\t\t\t\tselector = selector[0];\n\t\t\t}\n\n\t\t\tthis.each(function(i, node) {\n\t\t\t\twhile (node) {\n\t\t\t\t\tif (typeof selector == 'string' && DomQuery(node).is(selector)) {\n\t\t\t\t\t\tresult.push(node);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else if (node == selector) {\n\t\t\t\t\t\tresult.push(node);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn DomQuery(result);\n\t\t},\n\n\t\t/**\n\t\t * Returns the offset of the first element in set or sets the top/left css properties of all elements in set.\n\t\t *\n\t\t * @method offset\n\t\t * @param {Object} offset Optional offset object to set on each item.\n\t\t * @return {Object/tinymce.dom.DomQuery} Returns the first element offset or the current set if you specified an offset.\n\t\t */\n\t\toffset: function(offset) {\n\t\t\tvar elm, doc, docElm;\n\t\t\tvar x = 0, y = 0, pos;\n\n\t\t\tif (!offset) {\n\t\t\t\telm = this[0];\n\n\t\t\t\tif (elm) {\n\t\t\t\t\tdoc = elm.ownerDocument;\n\t\t\t\t\tdocElm = doc.documentElement;\n\n\t\t\t\t\tif (elm.getBoundingClientRect) {\n\t\t\t\t\t\tpos = elm.getBoundingClientRect();\n\t\t\t\t\t\tx = pos.left + (docElm.scrollLeft || doc.body.scrollLeft) - docElm.clientLeft;\n\t\t\t\t\t\ty = pos.top + (docElm.scrollTop || doc.body.scrollTop) - docElm.clientTop;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tleft: x,\n\t\t\t\t\ttop: y\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn this.css(offset);\n\t\t},\n\n\t\tpush: push,\n\t\tsort: [].sort,\n\t\tsplice: [].splice\n\t};\n\n\t// Static members\n\tTools.extend(DomQuery, {\n\t\t/**\n\t\t * Extends the specified object with one or more objects.\n\t\t *\n\t\t * @static\n\t\t * @method extend\n\t\t * @param {Object} target Target object to extend with new items.\n\t\t * @param {Object..} object Object to extend the target with.\n\t\t * @return {Object} Extended input object.\n\t\t */\n\t\textend: Tools.extend,\n\n\t\t/**\n\t\t * Creates an array out of an array like object.\n\t\t *\n\t\t * @static\n\t\t * @method makeArray\n\t\t * @param {Object} object Object to convert to array.\n\t\t * @return {Array} Array produced from object.\n\t\t */\n\t\tmakeArray: function(object) {\n\t\t\tif (isWindow(object) || object.nodeType) {\n\t\t\t\treturn [object];\n\t\t\t}\n\n\t\t\treturn Tools.toArray(object);\n\t\t},\n\n\t\t/**\n\t\t * Returns the index of the specified item inside the array.\n\t\t *\n\t\t * @static\n\t\t * @method inArray\n\t\t * @param {Object} item Item to look for.\n\t\t * @param {Array} array Array to look for item in.\n\t\t * @return {Number} Index of the item or -1.\n\t\t */\n\t\tinArray: inArray,\n\n\t\t/**\n\t\t * Returns true/false if the specified object is an array or not.\n\t\t *\n\t\t * @static\n\t\t * @method isArray\n\t\t * @param {Object} array Object to check if it's an array or not.\n\t\t * @return {Boolean} True/false if the object is an array.\n\t\t */\n\t\tisArray: Tools.isArray,\n\n\t\t/**\n\t\t * Executes the callback function for each item in array/object. If you return false in the\n\t\t * callback it will break the loop.\n\t\t *\n\t\t * @static\n\t\t * @method each\n\t\t * @param {Object} obj Object to iterate.\n\t\t * @param {function} callback Callback function to execute for each item.\n\t\t */\n\t\teach: each,\n\n\t\t/**\n\t\t * Removes whitespace from the beginning and end of a string.\n\t\t *\n\t\t * @static\n\t\t * @method trim\n\t\t * @param {String} str String to remove whitespace from.\n\t\t * @return {String} New string with removed whitespace.\n\t\t */\n\t\ttrim: trim,\n\n\t\t/**\n\t\t * Filters out items from the input array by calling the specified function for each item.\n\t\t * If the function returns false the item will be excluded if it returns true it will be included.\n\t\t *\n\t\t * @static\n\t\t * @method grep\n\t\t * @param {Array} array Array of items to loop though.\n\t\t * @param {function} callback Function to call for each item. Include/exclude depends on it's return value.\n\t\t * @return {Array} New array with values imported and filtered based in input.\n\t\t * @example\n\t\t * // Filter out some items, this will return an array with 4 and 5\n\t\t * var items = DomQuery.grep([1, 2, 3, 4, 5], function(v) {return v > 3;});\n\t\t */\n\t\tgrep: grep,\n\n\t\t// Sizzle\n\t\tfind: Sizzle,\n\t\texpr: Sizzle.selectors,\n\t\tunique: Sizzle.uniqueSort,\n\t\ttext: Sizzle.getText,\n\t\tcontains: Sizzle.contains,\n\t\tfilter: function(expr, elems, not) {\n\t\t\tvar i = elems.length;\n\n\t\t\tif (not) {\n\t\t\t\texpr = \":not(\" + expr + \")\";\n\t\t\t}\n\n\t\t\twhile (i--) {\n\t\t\t\tif (elems[i].nodeType != 1) {\n\t\t\t\t\telems.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (elems.length === 1) {\n\t\t\t\telems = DomQuery.find.matchesSelector(elems[0], expr) ? [elems[0]] : [];\n\t\t\t} else {\n\t\t\t\telems = DomQuery.find.matches(expr, elems);\n\t\t\t}\n\n\t\t\treturn elems;\n\t\t}\n\t});\n\n\tfunction dir(el, prop, until) {\n\t\tvar matched = [], cur = el[prop];\n\n\t\tif (typeof until != 'string' && until instanceof DomQuery) {\n\t\t\tuntil = until[0];\n\t\t}\n\n\t\twhile (cur && cur.nodeType !== 9) {\n\t\t\tif (until !== undefined) {\n\t\t\t\tif (cur === until) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (typeof until == 'string' && DomQuery(cur).is(until)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (cur.nodeType === 1) {\n\t\t\t\tmatched.push(cur);\n\t\t\t}\n\n\t\t\tcur = cur[prop];\n\t\t}\n\n\t\treturn matched;\n\t}\n\n\tfunction sibling(node, siblingName, nodeType, until) {\n\t\tvar result = [];\n\n\t\tif (until instanceof DomQuery) {\n\t\t\tuntil = until[0];\n\t\t}\n\n\t\tfor (; node; node = node[siblingName]) {\n\t\t\tif (nodeType && node.nodeType !== nodeType) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (until !== undefined) {\n\t\t\t\tif (node === until) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (typeof until == 'string' && DomQuery(node).is(until)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.push(node);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfunction firstSibling(node, siblingName, nodeType) {\n\t\tfor (node = node[siblingName]; node; node = node[siblingName]) {\n\t\t\tif (node.nodeType == nodeType) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\teach({\n\t\t/**\n\t\t * Returns a new collection with the parent of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method parent\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match parents against.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching parents.\n\t\t */\n\t\tparent: function(node) {\n\t\t\tvar parent = node.parentNode;\n\n\t\t\treturn parent && parent.nodeType !== 11 ? parent : null;\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection with the all the parents of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method parents\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match parents against.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching parents.\n\t\t */\n\t\tparents: function(node) {\n\t\t\treturn dir(node, \"parentNode\");\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection with next sibling of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method next\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match the next element against.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tnext: function(node) {\n\t\t\treturn firstSibling(node, 'nextSibling', 1);\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection with previous sibling of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method prev\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match the previous element against.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tprev: function(node) {\n\t\t\treturn firstSibling(node, 'previousSibling', 1);\n\t\t},\n\n\t\t/**\n\t\t * Returns all child elements matching the optional selector.\n\t\t *\n\t\t * @method children\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to match the elements against.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tchildren: function(node) {\n\t\t\treturn sibling(node.firstChild, 'nextSibling', 1);\n\t\t},\n\n\t\t/**\n\t\t * Returns all child nodes matching the optional selector.\n\t\t *\n\t\t * @method contents\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to get the contents of.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tcontents: function(node) {\n\t\t\treturn Tools.toArray((node.nodeName === \"iframe\" ? node.contentDocument || node.contentWindow.document : node).childNodes);\n\t\t}\n\t}, function(name, fn) {\n\t\tDomQuery.fn[name] = function(selector) {\n\t\t\tvar self = this, result = [];\n\n\t\t\tself.each(function() {\n\t\t\t\tvar nodes = fn.call(result, this, selector, result);\n\n\t\t\t\tif (nodes) {\n\t\t\t\t\tif (DomQuery.isArray(nodes)) {\n\t\t\t\t\t\tresult.push.apply(result, nodes);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.push(nodes);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// If traversing on multiple elements we might get the same elements twice\n\t\t\tif (this.length > 1) {\n\t\t\t\tif (!skipUniques[name]) {\n\t\t\t\t\tresult = DomQuery.unique(result);\n\t\t\t\t}\n\n\t\t\t\tif (name.indexOf('parents') === 0) {\n\t\t\t\t\tresult = result.reverse();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult = DomQuery(result);\n\n\t\t\tif (selector) {\n\t\t\t\treturn result.filter(selector);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t};\n\t});\n\n\teach({\n\t\t/**\n\t\t * Returns a new collection with the all the parents until the matching selector/element\n\t\t * of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method parentsUntil\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to find parent of.\n\t\t * @param {String/Element/tinymce.dom.DomQuery} until Until the matching selector or element.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching parents.\n\t\t */\n\t\tparentsUntil: function(node, until) {\n\t\t\treturn dir(node, \"parentNode\", until);\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection with all next siblings of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method nextUntil\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to find next siblings on.\n\t\t * @param {String/Element/tinymce.dom.DomQuery} until Until the matching selector or element.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tnextUntil: function(node, until) {\n\t\t\treturn sibling(node, 'nextSibling', 1, until).slice(1);\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection with all previous siblings of each item in current collection matching the optional selector.\n\t\t *\n\t\t * @method prevUntil\n\t\t * @param {Element/tinymce.dom.DomQuery} node Node to find previous siblings on.\n\t\t * @param {String/Element/tinymce.dom.DomQuery} until Until the matching selector or element.\n\t\t * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.\n\t\t */\n\t\tprevUntil: function(node, until) {\n\t\t\treturn sibling(node, 'previousSibling', 1, until).slice(1);\n\t\t}\n\t}, function(name, fn) {\n\t\tDomQuery.fn[name] = function(selector, filter) {\n\t\t\tvar self = this, result = [];\n\n\t\t\tself.each(function() {\n\t\t\t\tvar nodes = fn.call(result, this, selector, result);\n\n\t\t\t\tif (nodes) {\n\t\t\t\t\tif (DomQuery.isArray(nodes)) {\n\t\t\t\t\t\tresult.push.apply(result, nodes);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.push(nodes);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// If traversing on multiple elements we might get the same elements twice\n\t\t\tif (this.length > 1) {\n\t\t\t\tresult = DomQuery.unique(result);\n\n\t\t\t\tif (name.indexOf('parents') === 0 || name === 'prevUntil') {\n\t\t\t\t\tresult = result.reverse();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult = DomQuery(result);\n\n\t\t\tif (filter) {\n\t\t\t\treturn result.filter(filter);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t};\n\t});\n\n\t/**\n\t * Returns true/false if the current set items matches the selector.\n\t *\n\t * @method is\n\t * @param {String} selector Selector to match the elements against.\n\t * @return {Boolean} True/false if the current set matches the selector.\n\t */\n\tDomQuery.fn.is = function(selector) {\n\t\treturn !!selector && this.filter(selector).length > 0;\n\t};\n\n\tDomQuery.fn.init.prototype = DomQuery.fn;\n\n\tDomQuery.overrideDefaults = function(callback) {\n\t\tvar defaults;\n\n\t\tfunction sub(selector, context) {\n\t\t\tdefaults = defaults || callback();\n\n\t\t\tif (arguments.length === 0) {\n\t\t\t\tselector = defaults.element;\n\t\t\t}\n\n\t\t\tif (!context) {\n\t\t\t\tcontext = defaults.context;\n\t\t\t}\n\n\t\t\treturn new sub.fn.init(selector, context);\n\t\t}\n\n\t\tDomQuery.extend(sub, this);\n\n\t\treturn sub;\n\t};\n\n\tfunction appendHooks(targetHooks, prop, hooks) {\n\t\teach(hooks, function(name, func) {\n\t\t\ttargetHooks[name] = targetHooks[name] || {};\n\t\t\ttargetHooks[name][prop] = func;\n\t\t});\n\t}\n\n\tif (Env.ie && Env.ie < 8) {\n\t\tappendHooks(attrHooks, 'get', {\n\t\t\tmaxlength: function(elm) {\n\t\t\t\tvar value = elm.maxLength;\n\n\t\t\t\tif (value === 0x7fffffff) {\n\t\t\t\t\treturn undef;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t},\n\n\t\t\tsize: function(elm) {\n\t\t\t\tvar value = elm.size;\n\n\t\t\t\tif (value === 20) {\n\t\t\t\t\treturn undef;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t},\n\n\t\t\t'class': function(elm) {\n\t\t\t\treturn elm.className;\n\t\t\t},\n\n\t\t\tstyle: function(elm) {\n\t\t\t\tvar value = elm.style.cssText;\n\n\t\t\t\tif (value.length === 0) {\n\t\t\t\t\treturn undef;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\t\t});\n\n\t\tappendHooks(attrHooks, 'set', {\n\t\t\t'class': function(elm, value) {\n\t\t\t\telm.className = value;\n\t\t\t},\n\n\t\t\tstyle: function(elm, value) {\n\t\t\t\telm.style.cssText = value;\n\t\t\t}\n\t\t});\n\t}\n\n\tif (Env.ie && Env.ie < 9) {\n\t\t/*jshint sub:true */\n\t\t/*eslint dot-notation: 0*/\n\t\tcssFix['float'] = 'styleFloat';\n\n\t\tappendHooks(cssHooks, 'set', {\n\t\t\topacity: function(elm, value) {\n\t\t\t\tvar style = elm.style;\n\n\t\t\t\tif (value === null || value === '') {\n\t\t\t\t\tstyle.removeAttribute('filter');\n\t\t\t\t} else {\n\t\t\t\t\tstyle.zoom = 1;\n\t\t\t\t\tstyle.filter = 'alpha(opacity=' + (value * 100) + ')';\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tDomQuery.attrHooks = attrHooks;\n\tDomQuery.cssHooks = cssHooks;\n\n\treturn DomQuery;\n});\n\n// Included from: js/tinymce/classes/html/Styles.js\n\n/**\n * Styles.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to parse CSS styles it also compresses styles to reduce the output size.\n *\n * @example\n * var Styles = new tinymce.html.Styles({\n *    url_converter: function(url) {\n *       return url;\n *    }\n * });\n *\n * styles = Styles.parse('border: 1px solid red');\n * styles.color = 'red';\n *\n * console.log(new tinymce.html.StyleSerializer().serialize(styles));\n *\n * @class tinymce.html.Styles\n * @version 3.4\n */\ndefine(\"tinymce/html/Styles\", [], function() {\n\treturn function(settings, schema) {\n\t\t/*jshint maxlen:255 */\n\t\t/*eslint max-len:0 */\n\t\tvar rgbRegExp = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*\\)/gi,\n\t\t\turlOrStrRegExp = /(?:url(?:(?:\\(\\s*\\\"([^\\\"]+)\\\"\\s*\\))|(?:\\(\\s*\\'([^\\']+)\\'\\s*\\))|(?:\\(\\s*([^)\\s]+)\\s*\\))))|(?:\\'([^\\']+)\\')|(?:\\\"([^\\\"]+)\\\")/gi,\n\t\t\tstyleRegExp = /\\s*([^:]+):\\s*([^;]+);?/g,\n\t\t\ttrimRightRegExp = /\\s+$/,\n\t\t\tundef, i, encodingLookup = {}, encodingItems, validStyles, invalidStyles, invisibleChar = '\\uFEFF';\n\n\t\tsettings = settings || {};\n\n\t\tif (schema) {\n\t\t\tvalidStyles = schema.getValidStyles();\n\t\t\tinvalidStyles = schema.getInvalidStyles();\n\t\t}\n\n\t\tencodingItems = ('\\\\\" \\\\\\' \\\\; \\\\: ; : ' + invisibleChar).split(' ');\n\t\tfor (i = 0; i < encodingItems.length; i++) {\n\t\t\tencodingLookup[encodingItems[i]] = invisibleChar + i;\n\t\t\tencodingLookup[invisibleChar + i] = encodingItems[i];\n\t\t}\n\n\t\tfunction toHex(match, r, g, b) {\n\t\t\tfunction hex(val) {\n\t\t\t\tval = parseInt(val, 10).toString(16);\n\n\t\t\t\treturn val.length > 1 ? val : '0' + val; // 0 -> 00\n\t\t\t}\n\n\t\t\treturn '#' + hex(r) + hex(g) + hex(b);\n\t\t}\n\n\t\treturn {\n\t\t\t/**\n\t\t\t * Parses the specified RGB color value and returns a hex version of that color.\n\t\t\t *\n\t\t\t * @method toHex\n\t\t\t * @param {String} color RGB string value like rgb(1,2,3)\n\t\t\t * @return {String} Hex version of that RGB value like #FF00FF.\n\t\t\t */\n\t\t\ttoHex: function(color) {\n\t\t\t\treturn color.replace(rgbRegExp, toHex);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Parses the specified style value into an object collection. This parser will also\n\t\t\t * merge and remove any redundant items that browsers might have added. It will also convert non hex\n\t\t\t * colors to hex values. Urls inside the styles will also be converted to absolute/relative based on settings.\n\t\t\t *\n\t\t\t * @method parse\n\t\t\t * @param {String} css Style value to parse for example: border:1px solid red;.\n\t\t\t * @return {Object} Object representation of that style like {border: '1px solid red'}\n\t\t\t */\n\t\t\tparse: function(css) {\n\t\t\t\tvar styles = {}, matches, name, value, isEncoded, urlConverter = settings.url_converter;\n\t\t\t\tvar urlConverterScope = settings.url_converter_scope || this;\n\n\t\t\t\tfunction compress(prefix, suffix, noJoin) {\n\t\t\t\t\tvar top, right, bottom, left;\n\n\t\t\t\t\ttop = styles[prefix + '-top' + suffix];\n\t\t\t\t\tif (!top) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tright = styles[prefix + '-right' + suffix];\n\t\t\t\t\tif (!right) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tbottom = styles[prefix + '-bottom' + suffix];\n\t\t\t\t\tif (!bottom) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tleft = styles[prefix + '-left' + suffix];\n\t\t\t\t\tif (!left) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar box = [top, right, bottom, left];\n\t\t\t\t\ti = box.length - 1;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (box[i] !== box[i + 1]) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (i > -1 && noJoin) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tstyles[prefix + suffix] = i == -1 ? box[0] : box.join(' ');\n\t\t\t\t\tdelete styles[prefix + '-top' + suffix];\n\t\t\t\t\tdelete styles[prefix + '-right' + suffix];\n\t\t\t\t\tdelete styles[prefix + '-bottom' + suffix];\n\t\t\t\t\tdelete styles[prefix + '-left' + suffix];\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * Checks if the specific style can be compressed in other words if all border-width are equal.\n\t\t\t\t */\n\t\t\t\tfunction canCompress(key) {\n\t\t\t\t\tvar value = styles[key], i;\n\n\t\t\t\t\tif (!value) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = value.split(' ');\n\t\t\t\t\ti = value.length;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (value[i] !== value[0]) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstyles[key] = value[0];\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * Compresses multiple styles into one style.\n\t\t\t\t */\n\t\t\t\tfunction compress2(target, a, b, c) {\n\t\t\t\t\tif (!canCompress(a)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!canCompress(b)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!canCompress(c)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Compress\n\t\t\t\t\tstyles[target] = styles[a] + ' ' + styles[b] + ' ' + styles[c];\n\t\t\t\t\tdelete styles[a];\n\t\t\t\t\tdelete styles[b];\n\t\t\t\t\tdelete styles[c];\n\t\t\t\t}\n\n\t\t\t\t// Encodes the specified string by replacing all \\\" \\' ; : with _<num>\n\t\t\t\tfunction encode(str) {\n\t\t\t\t\tisEncoded = true;\n\n\t\t\t\t\treturn encodingLookup[str];\n\t\t\t\t}\n\n\t\t\t\t// Decodes the specified string by replacing all _<num> with it's original value \\\" \\' etc\n\t\t\t\t// It will also decode the \\\" \\' if keep_slashes is set to fale or omitted\n\t\t\t\tfunction decode(str, keep_slashes) {\n\t\t\t\t\tif (isEncoded) {\n\t\t\t\t\t\tstr = str.replace(/\\uFEFF[0-9]/g, function(str) {\n\t\t\t\t\t\t\treturn encodingLookup[str];\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!keep_slashes) {\n\t\t\t\t\t\tstr = str.replace(/\\\\([\\'\\\";:])/g, \"$1\");\n\t\t\t\t\t}\n\n\t\t\t\t\treturn str;\n\t\t\t\t}\n\n\t\t\t\tfunction processUrl(match, url, url2, url3, str, str2) {\n\t\t\t\t\tstr = str || str2;\n\n\t\t\t\t\tif (str) {\n\t\t\t\t\t\tstr = decode(str);\n\n\t\t\t\t\t\t// Force strings into single quote format\n\t\t\t\t\t\treturn \"'\" + str.replace(/\\'/g, \"\\\\'\") + \"'\";\n\t\t\t\t\t}\n\n\t\t\t\t\turl = decode(url || url2 || url3);\n\n\t\t\t\t\tif (!settings.allow_script_urls) {\n\t\t\t\t\t\tvar scriptUrl = url.replace(/[\\s\\r\\n]+/, '');\n\n\t\t\t\t\t\tif (/(java|vb)script:/i.test(scriptUrl)) {\n\t\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!settings.allow_svg_data_urls && /^data:image\\/svg/i.test(scriptUrl)) {\n\t\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert the URL to relative/absolute depending on config\n\t\t\t\t\tif (urlConverter) {\n\t\t\t\t\t\turl = urlConverter.call(urlConverterScope, url, 'style');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Output new URL format\n\t\t\t\t\treturn \"url('\" + url.replace(/\\'/g, \"\\\\'\") + \"')\";\n\t\t\t\t}\n\n\t\t\t\tif (css) {\n\t\t\t\t\tcss = css.replace(/[\\u0000-\\u001F]/g, '');\n\n\t\t\t\t\t// Encode \\\" \\' % and ; and : inside strings so they don't interfere with the style parsing\n\t\t\t\t\tcss = css.replace(/\\\\[\\\"\\';:\\uFEFF]/g, encode).replace(/\\\"[^\\\"]+\\\"|\\'[^\\']+\\'/g, function(str) {\n\t\t\t\t\t\treturn str.replace(/[;:]/g, encode);\n\t\t\t\t\t});\n\n\t\t\t\t\t// Parse styles\n\t\t\t\t\twhile ((matches = styleRegExp.exec(css))) {\n\t\t\t\t\t\tname = matches[1].replace(trimRightRegExp, '').toLowerCase();\n\t\t\t\t\t\tvalue = matches[2].replace(trimRightRegExp, '');\n\n\t\t\t\t\t\t// Decode escaped sequences like \\65 -> e\n\t\t\t\t\t\t/*jshint loopfunc:true*/\n\t\t\t\t\t\t/*eslint no-loop-func:0 */\n\t\t\t\t\t\tvalue = value.replace(/\\\\[0-9a-f]+/g, function(e) {\n\t\t\t\t\t\t\treturn String.fromCharCode(parseInt(e.substr(1), 16));\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (name && value.length > 0) {\n\t\t\t\t\t\t\t// Don't allow behavior name or expression/comments within the values\n\t\t\t\t\t\t\tif (!settings.allow_script_urls && (name == \"behavior\" || /expression\\s*\\(|\\/\\*|\\*\\//.test(value))) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Opera will produce 700 instead of bold in their style values\n\t\t\t\t\t\t\tif (name === 'font-weight' && value === '700') {\n\t\t\t\t\t\t\t\tvalue = 'bold';\n\t\t\t\t\t\t\t} else if (name === 'color' || name === 'background-color') { // Lowercase colors like RED\n\t\t\t\t\t\t\t\tvalue = value.toLowerCase();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Convert RGB colors to HEX\n\t\t\t\t\t\t\tvalue = value.replace(rgbRegExp, toHex);\n\n\t\t\t\t\t\t\t// Convert URLs and force them into url('value') format\n\t\t\t\t\t\t\tvalue = value.replace(urlOrStrRegExp, processUrl);\n\t\t\t\t\t\t\tstyles[name] = isEncoded ? decode(value, true) : value;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstyleRegExp.lastIndex = matches.index + matches[0].length;\n\t\t\t\t\t}\n\t\t\t\t\t// Compress the styles to reduce it's size for example IE will expand styles\n\t\t\t\t\tcompress(\"border\", \"\", true);\n\t\t\t\t\tcompress(\"border\", \"-width\");\n\t\t\t\t\tcompress(\"border\", \"-color\");\n\t\t\t\t\tcompress(\"border\", \"-style\");\n\t\t\t\t\tcompress(\"padding\", \"\");\n\t\t\t\t\tcompress(\"margin\", \"\");\n\t\t\t\t\tcompress2('border', 'border-width', 'border-style', 'border-color');\n\n\t\t\t\t\t// Remove pointless border, IE produces these\n\t\t\t\t\tif (styles.border === 'medium none') {\n\t\t\t\t\t\tdelete styles.border;\n\t\t\t\t\t}\n\n\t\t\t\t\t// IE 11 will produce a border-image: none when getting the style attribute from <p style=\"border: 1px solid red\"></p>\n\t\t\t\t\t// So let us assume it shouldn't be there\n\t\t\t\t\tif (styles['border-image'] === 'none') {\n\t\t\t\t\t\tdelete styles['border-image'];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn styles;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Serializes the specified style object into a string.\n\t\t\t *\n\t\t\t * @method serialize\n\t\t\t * @param {Object} styles Object to serialize as string for example: {border: '1px solid red'}\n\t\t\t * @param {String} elementName Optional element name, if specified only the styles that matches the schema will be serialized.\n\t\t\t * @return {String} String representation of the style object for example: border: 1px solid red.\n\t\t\t */\n\t\t\tserialize: function(styles, elementName) {\n\t\t\t\tvar css = '', name, value;\n\n\t\t\t\tfunction serializeStyles(name) {\n\t\t\t\t\tvar styleList, i, l, value;\n\n\t\t\t\t\tstyleList = validStyles[name];\n\t\t\t\t\tif (styleList) {\n\t\t\t\t\t\tfor (i = 0, l = styleList.length; i < l; i++) {\n\t\t\t\t\t\t\tname = styleList[i];\n\t\t\t\t\t\t\tvalue = styles[name];\n\n\t\t\t\t\t\t\tif (value !== undef && value.length > 0) {\n\t\t\t\t\t\t\t\tcss += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction isValid(name, elementName) {\n\t\t\t\t\tvar styleMap;\n\n\t\t\t\t\tstyleMap = invalidStyles['*'];\n\t\t\t\t\tif (styleMap && styleMap[name]) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tstyleMap = invalidStyles[elementName];\n\t\t\t\t\tif (styleMap && styleMap[name]) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Serialize styles according to schema\n\t\t\t\tif (elementName && validStyles) {\n\t\t\t\t\t// Serialize global styles and element specific styles\n\t\t\t\t\tserializeStyles('*');\n\t\t\t\t\tserializeStyles(elementName);\n\t\t\t\t} else {\n\t\t\t\t\t// Output the styles in the order they are inside the object\n\t\t\t\t\tfor (name in styles) {\n\t\t\t\t\t\tvalue = styles[name];\n\n\t\t\t\t\t\tif (value !== undef && value.length > 0) {\n\t\t\t\t\t\t\tif (!invalidStyles || isValid(name, elementName)) {\n\t\t\t\t\t\t\t\tcss += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn css;\n\t\t\t}\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/TreeWalker.js\n\n/**\n * TreeWalker.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * TreeWalker class enables you to walk the DOM in a linear manner.\n *\n * @class tinymce.dom.TreeWalker\n * @example\n * var walker = new tinymce.dom.TreeWalker(startNode);\n *\n * do {\n *     console.log(walker.current());\n * } while (walker.next());\n */\ndefine(\"tinymce/dom/TreeWalker\", [], function() {\n\t/**\n\t * Constructs a new TreeWalker instance.\n\t *\n\t * @constructor\n\t * @method TreeWalker\n\t * @param {Node} startNode Node to start walking from.\n\t * @param {node} rootNode Optional root node to never walk out of.\n\t */\n\treturn function(startNode, rootNode) {\n\t\tvar node = startNode;\n\n\t\tfunction findSibling(node, startName, siblingName, shallow) {\n\t\t\tvar sibling, parent;\n\n\t\t\tif (node) {\n\t\t\t\t// Walk into nodes if it has a start\n\t\t\t\tif (!shallow && node[startName]) {\n\t\t\t\t\treturn node[startName];\n\t\t\t\t}\n\n\t\t\t\t// Return the sibling if it has one\n\t\t\t\tif (node != rootNode) {\n\t\t\t\t\tsibling = node[siblingName];\n\t\t\t\t\tif (sibling) {\n\t\t\t\t\t\treturn sibling;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Walk up the parents to look for siblings\n\t\t\t\t\tfor (parent = node.parentNode; parent && parent != rootNode; parent = parent.parentNode) {\n\t\t\t\t\t\tsibling = parent[siblingName];\n\t\t\t\t\t\tif (sibling) {\n\t\t\t\t\t\t\treturn sibling;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction findPreviousNode(node, startName, siblingName, shallow) {\n\t\t\tvar sibling, parent, child;\n\n\t\t\tif (node) {\n\t\t\t\tsibling = node[siblingName];\n\t\t\t\tif (rootNode && sibling === rootNode) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (sibling) {\n\t\t\t\t\tif (!shallow) {\n\t\t\t\t\t\t// Walk up the parents to look for siblings\n\t\t\t\t\t\tfor (child = sibling[startName]; child; child = child[startName]) {\n\t\t\t\t\t\t\tif (!child[startName]) {\n\t\t\t\t\t\t\t\treturn child;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\n\t\t\t\tparent = node.parentNode;\n\t\t\t\tif (parent && parent !== rootNode) {\n\t\t\t\t\treturn parent;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Returns the current node.\n\t\t *\n\t\t * @method current\n\t\t * @return {Node} Current node where the walker is.\n\t\t */\n\t\tthis.current = function() {\n\t\t\treturn node;\n\t\t};\n\n\t\t/**\n\t\t * Walks to the next node in tree.\n\t\t *\n\t\t * @method next\n\t\t * @return {Node} Current node where the walker is after moving to the next node.\n\t\t */\n\t\tthis.next = function(shallow) {\n\t\t\tnode = findSibling(node, 'firstChild', 'nextSibling', shallow);\n\t\t\treturn node;\n\t\t};\n\n\t\t/**\n\t\t * Walks to the previous node in tree.\n\t\t *\n\t\t * @method prev\n\t\t * @return {Node} Current node where the walker is after moving to the previous node.\n\t\t */\n\t\tthis.prev = function(shallow) {\n\t\t\tnode = findSibling(node, 'lastChild', 'previousSibling', shallow);\n\t\t\treturn node;\n\t\t};\n\n\t\tthis.prev2 = function(shallow) {\n\t\t\tnode = findPreviousNode(node, 'lastChild', 'previousSibling', shallow);\n\t\t\treturn node;\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/Range.js\n\n/**\n * Range.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Old IE Range.\n *\n * @private\n * @class tinymce.dom.Range\n */\ndefine(\"tinymce/dom/Range\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\t// Range constructor\n\tfunction Range(dom) {\n\t\tvar self = this,\n\t\t\tdoc = dom.doc,\n\t\t\tEXTRACT = 0,\n\t\t\tCLONE = 1,\n\t\t\tDELETE = 2,\n\t\t\tTRUE = true,\n\t\t\tFALSE = false,\n\t\t\tSTART_OFFSET = 'startOffset',\n\t\t\tSTART_CONTAINER = 'startContainer',\n\t\t\tEND_CONTAINER = 'endContainer',\n\t\t\tEND_OFFSET = 'endOffset',\n\t\t\textend = Tools.extend,\n\t\t\tnodeIndex = dom.nodeIndex;\n\n\t\tfunction createDocumentFragment() {\n\t\t\treturn doc.createDocumentFragment();\n\t\t}\n\n\t\tfunction setStart(n, o) {\n\t\t\t_setEndPoint(TRUE, n, o);\n\t\t}\n\n\t\tfunction setEnd(n, o) {\n\t\t\t_setEndPoint(FALSE, n, o);\n\t\t}\n\n\t\tfunction setStartBefore(n) {\n\t\t\tsetStart(n.parentNode, nodeIndex(n));\n\t\t}\n\n\t\tfunction setStartAfter(n) {\n\t\t\tsetStart(n.parentNode, nodeIndex(n) + 1);\n\t\t}\n\n\t\tfunction setEndBefore(n) {\n\t\t\tsetEnd(n.parentNode, nodeIndex(n));\n\t\t}\n\n\t\tfunction setEndAfter(n) {\n\t\t\tsetEnd(n.parentNode, nodeIndex(n) + 1);\n\t\t}\n\n\t\tfunction collapse(ts) {\n\t\t\tif (ts) {\n\t\t\t\tself[END_CONTAINER] = self[START_CONTAINER];\n\t\t\t\tself[END_OFFSET] = self[START_OFFSET];\n\t\t\t} else {\n\t\t\t\tself[START_CONTAINER] = self[END_CONTAINER];\n\t\t\t\tself[START_OFFSET] = self[END_OFFSET];\n\t\t\t}\n\n\t\t\tself.collapsed = TRUE;\n\t\t}\n\n\t\tfunction selectNode(n) {\n\t\t\tsetStartBefore(n);\n\t\t\tsetEndAfter(n);\n\t\t}\n\n\t\tfunction selectNodeContents(n) {\n\t\t\tsetStart(n, 0);\n\t\t\tsetEnd(n, n.nodeType === 1 ? n.childNodes.length : n.nodeValue.length);\n\t\t}\n\n\t\tfunction compareBoundaryPoints(h, r) {\n\t\t\tvar sc = self[START_CONTAINER], so = self[START_OFFSET], ec = self[END_CONTAINER], eo = self[END_OFFSET],\n\t\t\trsc = r.startContainer, rso = r.startOffset, rec = r.endContainer, reo = r.endOffset;\n\n\t\t\t// Check START_TO_START\n\t\t\tif (h === 0) {\n\t\t\t\treturn _compareBoundaryPoints(sc, so, rsc, rso);\n\t\t\t}\n\n\t\t\t// Check START_TO_END\n\t\t\tif (h === 1) {\n\t\t\t\treturn _compareBoundaryPoints(ec, eo, rsc, rso);\n\t\t\t}\n\n\t\t\t// Check END_TO_END\n\t\t\tif (h === 2) {\n\t\t\t\treturn _compareBoundaryPoints(ec, eo, rec, reo);\n\t\t\t}\n\n\t\t\t// Check END_TO_START\n\t\t\tif (h === 3) {\n\t\t\t\treturn _compareBoundaryPoints(sc, so, rec, reo);\n\t\t\t}\n\t\t}\n\n\t\tfunction deleteContents() {\n\t\t\t_traverse(DELETE);\n\t\t}\n\n\t\tfunction extractContents() {\n\t\t\treturn _traverse(EXTRACT);\n\t\t}\n\n\t\tfunction cloneContents() {\n\t\t\treturn _traverse(CLONE);\n\t\t}\n\n\t\tfunction insertNode(n) {\n\t\t\tvar startContainer = this[START_CONTAINER],\n\t\t\t\tstartOffset = this[START_OFFSET], nn, o;\n\n\t\t\t// Node is TEXT_NODE or CDATA\n\t\t\tif ((startContainer.nodeType === 3 || startContainer.nodeType === 4) && startContainer.nodeValue) {\n\t\t\t\tif (!startOffset) {\n\t\t\t\t\t// At the start of text\n\t\t\t\t\tstartContainer.parentNode.insertBefore(n, startContainer);\n\t\t\t\t} else if (startOffset >= startContainer.nodeValue.length) {\n\t\t\t\t\t// At the end of text\n\t\t\t\t\tdom.insertAfter(n, startContainer);\n\t\t\t\t} else {\n\t\t\t\t\t// Middle, need to split\n\t\t\t\t\tnn = startContainer.splitText(startOffset);\n\t\t\t\t\tstartContainer.parentNode.insertBefore(n, nn);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Insert element node\n\t\t\t\tif (startContainer.childNodes.length > 0) {\n\t\t\t\t\to = startContainer.childNodes[startOffset];\n\t\t\t\t}\n\n\t\t\t\tif (o) {\n\t\t\t\t\tstartContainer.insertBefore(n, o);\n\t\t\t\t} else {\n\t\t\t\t\tif (startContainer.nodeType == 3) {\n\t\t\t\t\t\tdom.insertAfter(n, startContainer);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstartContainer.appendChild(n);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction surroundContents(n) {\n\t\t\tvar f = self.extractContents();\n\n\t\t\tself.insertNode(n);\n\t\t\tn.appendChild(f);\n\t\t\tself.selectNode(n);\n\t\t}\n\n\t\tfunction cloneRange() {\n\t\t\treturn extend(new Range(dom), {\n\t\t\t\tstartContainer: self[START_CONTAINER],\n\t\t\t\tstartOffset: self[START_OFFSET],\n\t\t\t\tendContainer: self[END_CONTAINER],\n\t\t\t\tendOffset: self[END_OFFSET],\n\t\t\t\tcollapsed: self.collapsed,\n\t\t\t\tcommonAncestorContainer: self.commonAncestorContainer\n\t\t\t});\n\t\t}\n\n\t\t// Private methods\n\n\t\tfunction _getSelectedNode(container, offset) {\n\t\t\tvar child;\n\n\t\t\t// TEXT_NODE\n\t\t\tif (container.nodeType == 3) {\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tif (offset < 0) {\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tchild = container.firstChild;\n\t\t\twhile (child && offset > 0) {\n\t\t\t\t--offset;\n\t\t\t\tchild = child.nextSibling;\n\t\t\t}\n\n\t\t\tif (child) {\n\t\t\t\treturn child;\n\t\t\t}\n\n\t\t\treturn container;\n\t\t}\n\n\t\tfunction _isCollapsed() {\n\t\t\treturn (self[START_CONTAINER] == self[END_CONTAINER] && self[START_OFFSET] == self[END_OFFSET]);\n\t\t}\n\n\t\tfunction _compareBoundaryPoints(containerA, offsetA, containerB, offsetB) {\n\t\t\tvar c, offsetC, n, cmnRoot, childA, childB;\n\n\t\t\t// In the first case the boundary-points have the same container. A is before B\n\t\t\t// if its offset is less than the offset of B, A is equal to B if its offset is\n\t\t\t// equal to the offset of B, and A is after B if its offset is greater than the\n\t\t\t// offset of B.\n\t\t\tif (containerA == containerB) {\n\t\t\t\tif (offsetA == offsetB) {\n\t\t\t\t\treturn 0; // equal\n\t\t\t\t}\n\n\t\t\t\tif (offsetA < offsetB) {\n\t\t\t\t\treturn -1; // before\n\t\t\t\t}\n\n\t\t\t\treturn 1; // after\n\t\t\t}\n\n\t\t\t// In the second case a child node C of the container of A is an ancestor\n\t\t\t// container of B. In this case, A is before B if the offset of A is less than or\n\t\t\t// equal to the index of the child node C and A is after B otherwise.\n\t\t\tc = containerB;\n\t\t\twhile (c && c.parentNode != containerA) {\n\t\t\t\tc = c.parentNode;\n\t\t\t}\n\n\t\t\tif (c) {\n\t\t\t\toffsetC = 0;\n\t\t\t\tn = containerA.firstChild;\n\n\t\t\t\twhile (n != c && offsetC < offsetA) {\n\t\t\t\t\toffsetC++;\n\t\t\t\t\tn = n.nextSibling;\n\t\t\t\t}\n\n\t\t\t\tif (offsetA <= offsetC) {\n\t\t\t\t\treturn -1; // before\n\t\t\t\t}\n\n\t\t\t\treturn 1; // after\n\t\t\t}\n\n\t\t\t// In the third case a child node C of the container of B is an ancestor container\n\t\t\t// of A. In this case, A is before B if the index of the child node C is less than\n\t\t\t// the offset of B and A is after B otherwise.\n\t\t\tc = containerA;\n\t\t\twhile (c && c.parentNode != containerB) {\n\t\t\t\tc = c.parentNode;\n\t\t\t}\n\n\t\t\tif (c) {\n\t\t\t\toffsetC = 0;\n\t\t\t\tn = containerB.firstChild;\n\n\t\t\t\twhile (n != c && offsetC < offsetB) {\n\t\t\t\t\toffsetC++;\n\t\t\t\t\tn = n.nextSibling;\n\t\t\t\t}\n\n\t\t\t\tif (offsetC < offsetB) {\n\t\t\t\t\treturn -1; // before\n\t\t\t\t}\n\n\t\t\t\treturn 1; // after\n\t\t\t}\n\n\t\t\t// In the fourth case, none of three other cases hold: the containers of A and B\n\t\t\t// are siblings or descendants of sibling nodes. In this case, A is before B if\n\t\t\t// the container of A is before the container of B in a pre-order traversal of the\n\t\t\t// Ranges' context tree and A is after B otherwise.\n\t\t\tcmnRoot = dom.findCommonAncestor(containerA, containerB);\n\t\t\tchildA = containerA;\n\n\t\t\twhile (childA && childA.parentNode != cmnRoot) {\n\t\t\t\tchildA = childA.parentNode;\n\t\t\t}\n\n\t\t\tif (!childA) {\n\t\t\t\tchildA = cmnRoot;\n\t\t\t}\n\n\t\t\tchildB = containerB;\n\t\t\twhile (childB && childB.parentNode != cmnRoot) {\n\t\t\t\tchildB = childB.parentNode;\n\t\t\t}\n\n\t\t\tif (!childB) {\n\t\t\t\tchildB = cmnRoot;\n\t\t\t}\n\n\t\t\tif (childA == childB) {\n\t\t\t\treturn 0; // equal\n\t\t\t}\n\n\t\t\tn = cmnRoot.firstChild;\n\t\t\twhile (n) {\n\t\t\t\tif (n == childA) {\n\t\t\t\t\treturn -1; // before\n\t\t\t\t}\n\n\t\t\t\tif (n == childB) {\n\t\t\t\t\treturn 1; // after\n\t\t\t\t}\n\n\t\t\t\tn = n.nextSibling;\n\t\t\t}\n\t\t}\n\n\t\tfunction _setEndPoint(st, n, o) {\n\t\t\tvar ec, sc;\n\n\t\t\tif (st) {\n\t\t\t\tself[START_CONTAINER] = n;\n\t\t\t\tself[START_OFFSET] = o;\n\t\t\t} else {\n\t\t\t\tself[END_CONTAINER] = n;\n\t\t\t\tself[END_OFFSET] = o;\n\t\t\t}\n\n\t\t\t// If one boundary-point of a Range is set to have a root container\n\t\t\t// other than the current one for the Range, the Range is collapsed to\n\t\t\t// the new position. This enforces the restriction that both boundary-\n\t\t\t// points of a Range must have the same root container.\n\t\t\tec = self[END_CONTAINER];\n\t\t\twhile (ec.parentNode) {\n\t\t\t\tec = ec.parentNode;\n\t\t\t}\n\n\t\t\tsc = self[START_CONTAINER];\n\t\t\twhile (sc.parentNode) {\n\t\t\t\tsc = sc.parentNode;\n\t\t\t}\n\n\t\t\tif (sc == ec) {\n\t\t\t\t// The start position of a Range is guaranteed to never be after the\n\t\t\t\t// end position. To enforce this restriction, if the start is set to\n\t\t\t\t// be at a position after the end, the Range is collapsed to that\n\t\t\t\t// position.\n\t\t\t\tif (_compareBoundaryPoints(self[START_CONTAINER], self[START_OFFSET], self[END_CONTAINER], self[END_OFFSET]) > 0) {\n\t\t\t\t\tself.collapse(st);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tself.collapse(st);\n\t\t\t}\n\n\t\t\tself.collapsed = _isCollapsed();\n\t\t\tself.commonAncestorContainer = dom.findCommonAncestor(self[START_CONTAINER], self[END_CONTAINER]);\n\t\t}\n\n\t\tfunction _traverse(how) {\n\t\t\tvar c, endContainerDepth = 0, startContainerDepth = 0, p, depthDiff, startNode, endNode, sp, ep;\n\n\t\t\tif (self[START_CONTAINER] == self[END_CONTAINER]) {\n\t\t\t\treturn _traverseSameContainer(how);\n\t\t\t}\n\n\t\t\tfor (c = self[END_CONTAINER], p = c.parentNode; p; c = p, p = p.parentNode) {\n\t\t\t\tif (p == self[START_CONTAINER]) {\n\t\t\t\t\treturn _traverseCommonStartContainer(c, how);\n\t\t\t\t}\n\n\t\t\t\t++endContainerDepth;\n\t\t\t}\n\n\t\t\tfor (c = self[START_CONTAINER], p = c.parentNode; p; c = p, p = p.parentNode) {\n\t\t\t\tif (p == self[END_CONTAINER]) {\n\t\t\t\t\treturn _traverseCommonEndContainer(c, how);\n\t\t\t\t}\n\n\t\t\t\t++startContainerDepth;\n\t\t\t}\n\n\t\t\tdepthDiff = startContainerDepth - endContainerDepth;\n\n\t\t\tstartNode = self[START_CONTAINER];\n\t\t\twhile (depthDiff > 0) {\n\t\t\t\tstartNode = startNode.parentNode;\n\t\t\t\tdepthDiff--;\n\t\t\t}\n\n\t\t\tendNode = self[END_CONTAINER];\n\t\t\twhile (depthDiff < 0) {\n\t\t\t\tendNode = endNode.parentNode;\n\t\t\t\tdepthDiff++;\n\t\t\t}\n\n\t\t\t// ascend the ancestor hierarchy until we have a common parent.\n\t\t\tfor (sp = startNode.parentNode, ep = endNode.parentNode; sp != ep; sp = sp.parentNode, ep = ep.parentNode) {\n\t\t\t\tstartNode = sp;\n\t\t\t\tendNode = ep;\n\t\t\t}\n\n\t\t\treturn _traverseCommonAncestors(startNode, endNode, how);\n\t\t}\n\n\t\tfunction _traverseSameContainer(how) {\n\t\t\tvar frag, s, sub, n, cnt, sibling, xferNode, start, len;\n\n\t\t\tif (how != DELETE) {\n\t\t\t\tfrag = createDocumentFragment();\n\t\t\t}\n\n\t\t\t// If selection is empty, just return the fragment\n\t\t\tif (self[START_OFFSET] == self[END_OFFSET]) {\n\t\t\t\treturn frag;\n\t\t\t}\n\n\t\t\t// Text node needs special case handling\n\t\t\tif (self[START_CONTAINER].nodeType == 3) { // TEXT_NODE\n\t\t\t\t// get the substring\n\t\t\t\ts = self[START_CONTAINER].nodeValue;\n\t\t\t\tsub = s.substring(self[START_OFFSET], self[END_OFFSET]);\n\n\t\t\t\t// set the original text node to its new value\n\t\t\t\tif (how != CLONE) {\n\t\t\t\t\tn = self[START_CONTAINER];\n\t\t\t\t\tstart = self[START_OFFSET];\n\t\t\t\t\tlen = self[END_OFFSET] - self[START_OFFSET];\n\n\t\t\t\t\tif (start === 0 && len >= n.nodeValue.length - 1) {\n\t\t\t\t\t\tn.parentNode.removeChild(n);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tn.deleteData(start, len);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Nothing is partially selected, so collapse to start point\n\t\t\t\t\tself.collapse(TRUE);\n\t\t\t\t}\n\n\t\t\t\tif (how == DELETE) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (sub.length > 0) {\n\t\t\t\t\tfrag.appendChild(doc.createTextNode(sub));\n\t\t\t\t}\n\n\t\t\t\treturn frag;\n\t\t\t}\n\n\t\t\t// Copy nodes between the start/end offsets.\n\t\t\tn = _getSelectedNode(self[START_CONTAINER], self[START_OFFSET]);\n\t\t\tcnt = self[END_OFFSET] - self[START_OFFSET];\n\n\t\t\twhile (n && cnt > 0) {\n\t\t\t\tsibling = n.nextSibling;\n\t\t\t\txferNode = _traverseFullySelected(n, how);\n\n\t\t\t\tif (frag) {\n\t\t\t\t\tfrag.appendChild(xferNode);\n\t\t\t\t}\n\n\t\t\t\t--cnt;\n\t\t\t\tn = sibling;\n\t\t\t}\n\n\t\t\t// Nothing is partially selected, so collapse to start point\n\t\t\tif (how != CLONE) {\n\t\t\t\tself.collapse(TRUE);\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t}\n\n\t\tfunction _traverseCommonStartContainer(endAncestor, how) {\n\t\t\tvar frag, n, endIdx, cnt, sibling, xferNode;\n\n\t\t\tif (how != DELETE) {\n\t\t\t\tfrag = createDocumentFragment();\n\t\t\t}\n\n\t\t\tn = _traverseRightBoundary(endAncestor, how);\n\n\t\t\tif (frag) {\n\t\t\t\tfrag.appendChild(n);\n\t\t\t}\n\n\t\t\tendIdx = nodeIndex(endAncestor);\n\t\t\tcnt = endIdx - self[START_OFFSET];\n\n\t\t\tif (cnt <= 0) {\n\t\t\t\t// Collapse to just before the endAncestor, which\n\t\t\t\t// is partially selected.\n\t\t\t\tif (how != CLONE) {\n\t\t\t\t\tself.setEndBefore(endAncestor);\n\t\t\t\t\tself.collapse(FALSE);\n\t\t\t\t}\n\n\t\t\t\treturn frag;\n\t\t\t}\n\n\t\t\tn = endAncestor.previousSibling;\n\t\t\twhile (cnt > 0) {\n\t\t\t\tsibling = n.previousSibling;\n\t\t\t\txferNode = _traverseFullySelected(n, how);\n\n\t\t\t\tif (frag) {\n\t\t\t\t\tfrag.insertBefore(xferNode, frag.firstChild);\n\t\t\t\t}\n\n\t\t\t\t--cnt;\n\t\t\t\tn = sibling;\n\t\t\t}\n\n\t\t\t// Collapse to just before the endAncestor, which\n\t\t\t// is partially selected.\n\t\t\tif (how != CLONE) {\n\t\t\t\tself.setEndBefore(endAncestor);\n\t\t\t\tself.collapse(FALSE);\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t}\n\n\t\tfunction _traverseCommonEndContainer(startAncestor, how) {\n\t\t\tvar frag, startIdx, n, cnt, sibling, xferNode;\n\n\t\t\tif (how != DELETE) {\n\t\t\t\tfrag = createDocumentFragment();\n\t\t\t}\n\n\t\t\tn = _traverseLeftBoundary(startAncestor, how);\n\t\t\tif (frag) {\n\t\t\t\tfrag.appendChild(n);\n\t\t\t}\n\n\t\t\tstartIdx = nodeIndex(startAncestor);\n\t\t\t++startIdx; // Because we already traversed it\n\n\t\t\tcnt = self[END_OFFSET] - startIdx;\n\t\t\tn = startAncestor.nextSibling;\n\t\t\twhile (n && cnt > 0) {\n\t\t\t\tsibling = n.nextSibling;\n\t\t\t\txferNode = _traverseFullySelected(n, how);\n\n\t\t\t\tif (frag) {\n\t\t\t\t\tfrag.appendChild(xferNode);\n\t\t\t\t}\n\n\t\t\t\t--cnt;\n\t\t\t\tn = sibling;\n\t\t\t}\n\n\t\t\tif (how != CLONE) {\n\t\t\t\tself.setStartAfter(startAncestor);\n\t\t\t\tself.collapse(TRUE);\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t}\n\n\t\tfunction _traverseCommonAncestors(startAncestor, endAncestor, how) {\n\t\t\tvar n, frag, startOffset, endOffset, cnt, sibling, nextSibling;\n\n\t\t\tif (how != DELETE) {\n\t\t\t\tfrag = createDocumentFragment();\n\t\t\t}\n\n\t\t\tn = _traverseLeftBoundary(startAncestor, how);\n\t\t\tif (frag) {\n\t\t\t\tfrag.appendChild(n);\n\t\t\t}\n\n\t\t\tstartOffset = nodeIndex(startAncestor);\n\t\t\tendOffset = nodeIndex(endAncestor);\n\t\t\t++startOffset;\n\n\t\t\tcnt = endOffset - startOffset;\n\t\t\tsibling = startAncestor.nextSibling;\n\n\t\t\twhile (cnt > 0) {\n\t\t\t\tnextSibling = sibling.nextSibling;\n\t\t\t\tn = _traverseFullySelected(sibling, how);\n\n\t\t\t\tif (frag) {\n\t\t\t\t\tfrag.appendChild(n);\n\t\t\t\t}\n\n\t\t\t\tsibling = nextSibling;\n\t\t\t\t--cnt;\n\t\t\t}\n\n\t\t\tn = _traverseRightBoundary(endAncestor, how);\n\n\t\t\tif (frag) {\n\t\t\t\tfrag.appendChild(n);\n\t\t\t}\n\n\t\t\tif (how != CLONE) {\n\t\t\t\tself.setStartAfter(startAncestor);\n\t\t\t\tself.collapse(TRUE);\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t}\n\n\t\tfunction _traverseRightBoundary(root, how) {\n\t\t\tvar next = _getSelectedNode(self[END_CONTAINER], self[END_OFFSET] - 1), parent, clonedParent;\n\t\t\tvar prevSibling, clonedChild, clonedGrandParent, isFullySelected = next != self[END_CONTAINER];\n\n\t\t\tif (next == root) {\n\t\t\t\treturn _traverseNode(next, isFullySelected, FALSE, how);\n\t\t\t}\n\n\t\t\tparent = next.parentNode;\n\t\t\tclonedParent = _traverseNode(parent, FALSE, FALSE, how);\n\n\t\t\twhile (parent) {\n\t\t\t\twhile (next) {\n\t\t\t\t\tprevSibling = next.previousSibling;\n\t\t\t\t\tclonedChild = _traverseNode(next, isFullySelected, FALSE, how);\n\n\t\t\t\t\tif (how != DELETE) {\n\t\t\t\t\t\tclonedParent.insertBefore(clonedChild, clonedParent.firstChild);\n\t\t\t\t\t}\n\n\t\t\t\t\tisFullySelected = TRUE;\n\t\t\t\t\tnext = prevSibling;\n\t\t\t\t}\n\n\t\t\t\tif (parent == root) {\n\t\t\t\t\treturn clonedParent;\n\t\t\t\t}\n\n\t\t\t\tnext = parent.previousSibling;\n\t\t\t\tparent = parent.parentNode;\n\n\t\t\t\tclonedGrandParent = _traverseNode(parent, FALSE, FALSE, how);\n\n\t\t\t\tif (how != DELETE) {\n\t\t\t\t\tclonedGrandParent.appendChild(clonedParent);\n\t\t\t\t}\n\n\t\t\t\tclonedParent = clonedGrandParent;\n\t\t\t}\n\t\t}\n\n\t\tfunction _traverseLeftBoundary(root, how) {\n\t\t\tvar next = _getSelectedNode(self[START_CONTAINER], self[START_OFFSET]), isFullySelected = next != self[START_CONTAINER];\n\t\t\tvar parent, clonedParent, nextSibling, clonedChild, clonedGrandParent;\n\n\t\t\tif (next == root) {\n\t\t\t\treturn _traverseNode(next, isFullySelected, TRUE, how);\n\t\t\t}\n\n\t\t\tparent = next.parentNode;\n\t\t\tclonedParent = _traverseNode(parent, FALSE, TRUE, how);\n\n\t\t\twhile (parent) {\n\t\t\t\twhile (next) {\n\t\t\t\t\tnextSibling = next.nextSibling;\n\t\t\t\t\tclonedChild = _traverseNode(next, isFullySelected, TRUE, how);\n\n\t\t\t\t\tif (how != DELETE) {\n\t\t\t\t\t\tclonedParent.appendChild(clonedChild);\n\t\t\t\t\t}\n\n\t\t\t\t\tisFullySelected = TRUE;\n\t\t\t\t\tnext = nextSibling;\n\t\t\t\t}\n\n\t\t\t\tif (parent == root) {\n\t\t\t\t\treturn clonedParent;\n\t\t\t\t}\n\n\t\t\t\tnext = parent.nextSibling;\n\t\t\t\tparent = parent.parentNode;\n\n\t\t\t\tclonedGrandParent = _traverseNode(parent, FALSE, TRUE, how);\n\n\t\t\t\tif (how != DELETE) {\n\t\t\t\t\tclonedGrandParent.appendChild(clonedParent);\n\t\t\t\t}\n\n\t\t\t\tclonedParent = clonedGrandParent;\n\t\t\t}\n\t\t}\n\n\t\tfunction _traverseNode(n, isFullySelected, isLeft, how) {\n\t\t\tvar txtValue, newNodeValue, oldNodeValue, offset, newNode;\n\n\t\t\tif (isFullySelected) {\n\t\t\t\treturn _traverseFullySelected(n, how);\n\t\t\t}\n\n\t\t\t// TEXT_NODE\n\t\t\tif (n.nodeType == 3) {\n\t\t\t\ttxtValue = n.nodeValue;\n\n\t\t\t\tif (isLeft) {\n\t\t\t\t\toffset = self[START_OFFSET];\n\t\t\t\t\tnewNodeValue = txtValue.substring(offset);\n\t\t\t\t\toldNodeValue = txtValue.substring(0, offset);\n\t\t\t\t} else {\n\t\t\t\t\toffset = self[END_OFFSET];\n\t\t\t\t\tnewNodeValue = txtValue.substring(0, offset);\n\t\t\t\t\toldNodeValue = txtValue.substring(offset);\n\t\t\t\t}\n\n\t\t\t\tif (how != CLONE) {\n\t\t\t\t\tn.nodeValue = oldNodeValue;\n\t\t\t\t}\n\n\t\t\t\tif (how == DELETE) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tnewNode = dom.clone(n, FALSE);\n\t\t\t\tnewNode.nodeValue = newNodeValue;\n\n\t\t\t\treturn newNode;\n\t\t\t}\n\n\t\t\tif (how == DELETE) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn dom.clone(n, FALSE);\n\t\t}\n\n\t\tfunction _traverseFullySelected(n, how) {\n\t\t\tif (how != DELETE) {\n\t\t\t\treturn how == CLONE ? dom.clone(n, TRUE) : n;\n\t\t\t}\n\n\t\t\tn.parentNode.removeChild(n);\n\t\t}\n\n\t\tfunction toStringIE() {\n\t\t\treturn dom.create('body', null, cloneContents()).outerText;\n\t\t}\n\n\t\textend(self, {\n\t\t\t// Initial states\n\t\t\tstartContainer: doc,\n\t\t\tstartOffset: 0,\n\t\t\tendContainer: doc,\n\t\t\tendOffset: 0,\n\t\t\tcollapsed: TRUE,\n\t\t\tcommonAncestorContainer: doc,\n\n\t\t\t// Range constants\n\t\t\tSTART_TO_START: 0,\n\t\t\tSTART_TO_END: 1,\n\t\t\tEND_TO_END: 2,\n\t\t\tEND_TO_START: 3,\n\n\t\t\t// Public methods\n\t\t\tsetStart: setStart,\n\t\t\tsetEnd: setEnd,\n\t\t\tsetStartBefore: setStartBefore,\n\t\t\tsetStartAfter: setStartAfter,\n\t\t\tsetEndBefore: setEndBefore,\n\t\t\tsetEndAfter: setEndAfter,\n\t\t\tcollapse: collapse,\n\t\t\tselectNode: selectNode,\n\t\t\tselectNodeContents: selectNodeContents,\n\t\t\tcompareBoundaryPoints: compareBoundaryPoints,\n\t\t\tdeleteContents: deleteContents,\n\t\t\textractContents: extractContents,\n\t\t\tcloneContents: cloneContents,\n\t\t\tinsertNode: insertNode,\n\t\t\tsurroundContents: surroundContents,\n\t\t\tcloneRange: cloneRange,\n\t\t\ttoStringIE: toStringIE\n\t\t});\n\n\t\treturn self;\n\t}\n\n\t// Older IE versions doesn't let you override toString by it's constructor so we have to stick it in the prototype\n\tRange.prototype.toString = function() {\n\t\treturn this.toStringIE();\n\t};\n\n\treturn Range;\n});\n\n// Included from: js/tinymce/classes/html/Entities.js\n\n/**\n * Entities.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*jshint bitwise:false */\n/*eslint no-bitwise:0 */\n\n/**\n * Entity encoder class.\n *\n * @class tinymce.html.Entities\n * @static\n * @version 3.4\n */\ndefine(\"tinymce/html/Entities\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar makeMap = Tools.makeMap;\n\n\tvar namedEntities, baseEntities, reverseEntities,\n\t\tattrsCharsRegExp = /[&<>\\\"\\u0060\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g,\n\t\ttextCharsRegExp = /[<>&\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g,\n\t\trawCharsRegExp = /[<>&\\\"\\']/g,\n\t\tentityRegExp = /&#([a-z0-9]+);?|&([a-z0-9]+);/gi,\n\t\tasciiMap = {\n\t\t\t128: \"\\u20AC\", 130: \"\\u201A\", 131: \"\\u0192\", 132: \"\\u201E\", 133: \"\\u2026\", 134: \"\\u2020\",\n\t\t\t135: \"\\u2021\", 136: \"\\u02C6\", 137: \"\\u2030\", 138: \"\\u0160\", 139: \"\\u2039\", 140: \"\\u0152\",\n\t\t\t142: \"\\u017D\", 145: \"\\u2018\", 146: \"\\u2019\", 147: \"\\u201C\", 148: \"\\u201D\", 149: \"\\u2022\",\n\t\t\t150: \"\\u2013\", 151: \"\\u2014\", 152: \"\\u02DC\", 153: \"\\u2122\", 154: \"\\u0161\", 155: \"\\u203A\",\n\t\t\t156: \"\\u0153\", 158: \"\\u017E\", 159: \"\\u0178\"\n\t\t};\n\n\t// Raw entities\n\tbaseEntities = {\n\t\t'\\\"': '&quot;', // Needs to be escaped since the YUI compressor would otherwise break the code\n\t\t\"'\": '&#39;',\n\t\t'<': '&lt;',\n\t\t'>': '&gt;',\n\t\t'&': '&amp;',\n\t\t'\\u0060': '&#96;'\n\t};\n\n\t// Reverse lookup table for raw entities\n\treverseEntities = {\n\t\t'&lt;': '<',\n\t\t'&gt;': '>',\n\t\t'&amp;': '&',\n\t\t'&quot;': '\"',\n\t\t'&apos;': \"'\"\n\t};\n\n\t// Decodes text by using the browser\n\tfunction nativeDecode(text) {\n\t\tvar elm;\n\n\t\telm = document.createElement(\"div\");\n\t\telm.innerHTML = text;\n\n\t\treturn elm.textContent || elm.innerText || text;\n\t}\n\n\t// Build a two way lookup table for the entities\n\tfunction buildEntitiesLookup(items, radix) {\n\t\tvar i, chr, entity, lookup = {};\n\n\t\tif (items) {\n\t\t\titems = items.split(',');\n\t\t\tradix = radix || 10;\n\n\t\t\t// Build entities lookup table\n\t\t\tfor (i = 0; i < items.length; i += 2) {\n\t\t\t\tchr = String.fromCharCode(parseInt(items[i], radix));\n\n\t\t\t\t// Only add non base entities\n\t\t\t\tif (!baseEntities[chr]) {\n\t\t\t\t\tentity = '&' + items[i + 1] + ';';\n\t\t\t\t\tlookup[chr] = entity;\n\t\t\t\t\tlookup[entity] = chr;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn lookup;\n\t\t}\n\t}\n\n\t// Unpack entities lookup where the numbers are in radix 32 to reduce the size\n\tnamedEntities = buildEntitiesLookup(\n\t\t'50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' +\n\t\t'5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' +\n\t\t'5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' +\n\t\t'5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' +\n\t\t'68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' +\n\t\t'6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' +\n\t\t'6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' +\n\t\t'75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' +\n\t\t'7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' +\n\t\t'7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' +\n\t\t'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' +\n\t\t'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' +\n\t\t't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' +\n\t\t'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' +\n\t\t'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' +\n\t\t'81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' +\n\t\t'8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' +\n\t\t'8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' +\n\t\t'8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' +\n\t\t'8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' +\n\t\t'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' +\n\t\t'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' +\n\t\t'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' +\n\t\t'80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' +\n\t\t'811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\n\n\tvar Entities = {\n\t\t/**\n\t\t * Encodes the specified string using raw entities. This means only the required XML base entities will be encoded.\n\t\t *\n\t\t * @method encodeRaw\n\t\t * @param {String} text Text to encode.\n\t\t * @param {Boolean} attr Optional flag to specify if the text is attribute contents.\n\t\t * @return {String} Entity encoded text.\n\t\t */\n\t\tencodeRaw: function(text, attr) {\n\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\n\t\t\t\treturn baseEntities[chr] || chr;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Encoded the specified text with both the attributes and text entities. This function will produce larger text contents\n\t\t * since it doesn't know if the context is within a attribute or text node. This was added for compatibility\n\t\t * and is exposed as the DOMUtils.encode function.\n\t\t *\n\t\t * @method encodeAllRaw\n\t\t * @param {String} text Text to encode.\n\t\t * @return {String} Entity encoded text.\n\t\t */\n\t\tencodeAllRaw: function(text) {\n\t\t\treturn ('' + text).replace(rawCharsRegExp, function(chr) {\n\t\t\t\treturn baseEntities[chr] || chr;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Encodes the specified string using numeric entities. The core entities will be\n\t\t * encoded as named ones but all non lower ascii characters will be encoded into numeric entities.\n\t\t *\n\t\t * @method encodeNumeric\n\t\t * @param {String} text Text to encode.\n\t\t * @param {Boolean} attr Optional flag to specify if the text is attribute contents.\n\t\t * @return {String} Entity encoded text.\n\t\t */\n\t\tencodeNumeric: function(text, attr) {\n\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\n\t\t\t\t// Multi byte sequence convert it to a single entity\n\t\t\t\tif (chr.length > 1) {\n\t\t\t\t\treturn '&#' + (((chr.charCodeAt(0) - 0xD800) * 0x400) + (chr.charCodeAt(1) - 0xDC00) + 0x10000) + ';';\n\t\t\t\t}\n\n\t\t\t\treturn baseEntities[chr] || '&#' + chr.charCodeAt(0) + ';';\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Encodes the specified string using named entities. The core entities will be encoded\n\t\t * as named ones but all non lower ascii characters will be encoded into named entities.\n\t\t *\n\t\t * @method encodeNamed\n\t\t * @param {String} text Text to encode.\n\t\t * @param {Boolean} attr Optional flag to specify if the text is attribute contents.\n\t\t * @param {Object} entities Optional parameter with entities to use.\n\t\t * @return {String} Entity encoded text.\n\t\t */\n\t\tencodeNamed: function(text, attr, entities) {\n\t\t\tentities = entities || namedEntities;\n\n\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\n\t\t\t\treturn baseEntities[chr] || entities[chr] || chr;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns an encode function based on the name(s) and it's optional entities.\n\t\t *\n\t\t * @method getEncodeFunc\n\t\t * @param {String} name Comma separated list of encoders for example named,numeric.\n\t\t * @param {String} entities Optional parameter with entities to use instead of the built in set.\n\t\t * @return {function} Encode function to be used.\n\t\t */\n\t\tgetEncodeFunc: function(name, entities) {\n\t\t\tentities = buildEntitiesLookup(entities) || namedEntities;\n\n\t\t\tfunction encodeNamedAndNumeric(text, attr) {\n\t\t\t\treturn text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function(chr) {\n\t\t\t\t\treturn baseEntities[chr] || entities[chr] || '&#' + chr.charCodeAt(0) + ';' || chr;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction encodeCustomNamed(text, attr) {\n\t\t\t\treturn Entities.encodeNamed(text, attr, entities);\n\t\t\t}\n\n\t\t\t// Replace + with , to be compatible with previous TinyMCE versions\n\t\t\tname = makeMap(name.replace(/\\+/g, ','));\n\n\t\t\t// Named and numeric encoder\n\t\t\tif (name.named && name.numeric) {\n\t\t\t\treturn encodeNamedAndNumeric;\n\t\t\t}\n\n\t\t\t// Named encoder\n\t\t\tif (name.named) {\n\t\t\t\t// Custom names\n\t\t\t\tif (entities) {\n\t\t\t\t\treturn encodeCustomNamed;\n\t\t\t\t}\n\n\t\t\t\treturn Entities.encodeNamed;\n\t\t\t}\n\n\t\t\t// Numeric\n\t\t\tif (name.numeric) {\n\t\t\t\treturn Entities.encodeNumeric;\n\t\t\t}\n\n\t\t\t// Raw encoder\n\t\t\treturn Entities.encodeRaw;\n\t\t},\n\n\t\t/**\n\t\t * Decodes the specified string, this will replace entities with raw UTF characters.\n\t\t *\n\t\t * @method decode\n\t\t * @param {String} text Text to entity decode.\n\t\t * @return {String} Entity decoded string.\n\t\t */\n\t\tdecode: function(text) {\n\t\t\treturn text.replace(entityRegExp, function(all, numeric) {\n\t\t\t\tif (numeric) {\n\t\t\t\t\tif (numeric.charAt(0).toLowerCase() === 'x') {\n\t\t\t\t\t\tnumeric = parseInt(numeric.substr(1), 16);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnumeric = parseInt(numeric, 10);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Support upper UTF\n\t\t\t\t\tif (numeric > 0xFFFF) {\n\t\t\t\t\t\tnumeric -= 0x10000;\n\n\t\t\t\t\t\treturn String.fromCharCode(0xD800 + (numeric >> 10), 0xDC00 + (numeric & 0x3FF));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn asciiMap[numeric] || String.fromCharCode(numeric);\n\t\t\t\t}\n\n\t\t\t\treturn reverseEntities[all] || namedEntities[all] || nativeDecode(all);\n\t\t\t});\n\t\t}\n\t};\n\n\treturn Entities;\n});\n\n// Included from: js/tinymce/classes/dom/StyleSheetLoader.js\n\n/**\n * StyleSheetLoader.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles loading of external stylesheets and fires events when these are loaded.\n *\n * @class tinymce.dom.StyleSheetLoader\n * @private\n */\ndefine(\"tinymce/dom/StyleSheetLoader\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Delay\"\n], function(Tools, Delay) {\n\t\"use strict\";\n\n\treturn function(document, settings) {\n\t\tvar idCount = 0, loadedStates = {}, maxLoadTime;\n\n\t\tsettings = settings || {};\n\t\tmaxLoadTime = settings.maxLoadTime || 5000;\n\n\t\tfunction appendToHead(node) {\n\t\t\tdocument.getElementsByTagName('head')[0].appendChild(node);\n\t\t}\n\n\t\t/**\n\t\t * Loads the specified css style sheet file and call the loadedCallback once it's finished loading.\n\t\t *\n\t\t * @method load\n\t\t * @param {String} url Url to be loaded.\n\t\t * @param {Function} loadedCallback Callback to be executed when loaded.\n\t\t * @param {Function} errorCallback Callback to be executed when failed loading.\n\t\t */\n\t\tfunction load(url, loadedCallback, errorCallback) {\n\t\t\tvar link, style, startTime, state;\n\n\t\t\tfunction passed() {\n\t\t\t\tvar callbacks = state.passed, i = callbacks.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tcallbacks[i]();\n\t\t\t\t}\n\n\t\t\t\tstate.status = 2;\n\t\t\t\tstate.passed = [];\n\t\t\t\tstate.failed = [];\n\t\t\t}\n\n\t\t\tfunction failed() {\n\t\t\t\tvar callbacks = state.failed, i = callbacks.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tcallbacks[i]();\n\t\t\t\t}\n\n\t\t\t\tstate.status = 3;\n\t\t\t\tstate.passed = [];\n\t\t\t\tstate.failed = [];\n\t\t\t}\n\n\t\t\t// Sniffs for older WebKit versions that have the link.onload but a broken one\n\t\t\tfunction isOldWebKit() {\n\t\t\t\tvar webKitChunks = navigator.userAgent.match(/WebKit\\/(\\d*)/);\n\t\t\t\treturn !!(webKitChunks && webKitChunks[1] < 536);\n\t\t\t}\n\n\t\t\t// Calls the waitCallback until the test returns true or the timeout occurs\n\t\t\tfunction wait(testCallback, waitCallback) {\n\t\t\t\tif (!testCallback()) {\n\t\t\t\t\t// Wait for timeout\n\t\t\t\t\tif ((new Date().getTime()) - startTime < maxLoadTime) {\n\t\t\t\t\t\tDelay.setTimeout(waitCallback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfailed();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Workaround for WebKit that doesn't properly support the onload event for link elements\n\t\t\t// Or WebKit that fires the onload event before the StyleSheet is added to the document\n\t\t\tfunction waitForWebKitLinkLoaded() {\n\t\t\t\twait(function() {\n\t\t\t\t\tvar styleSheets = document.styleSheets, styleSheet, i = styleSheets.length, owner;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tstyleSheet = styleSheets[i];\n\t\t\t\t\t\towner = styleSheet.ownerNode ? styleSheet.ownerNode : styleSheet.owningElement;\n\t\t\t\t\t\tif (owner && owner.id === link.id) {\n\t\t\t\t\t\t\tpassed();\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, waitForWebKitLinkLoaded);\n\t\t\t}\n\n\t\t\t// Workaround for older Geckos that doesn't have any onload event for StyleSheets\n\t\t\tfunction waitForGeckoLinkLoaded() {\n\t\t\t\twait(function() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Accessing the cssRules will throw an exception until the CSS file is loaded\n\t\t\t\t\t\tvar cssRules = style.sheet.cssRules;\n\t\t\t\t\t\tpassed();\n\t\t\t\t\t\treturn !!cssRules;\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// Ignore\n\t\t\t\t\t}\n\t\t\t\t}, waitForGeckoLinkLoaded);\n\t\t\t}\n\n\t\t\turl = Tools._addCacheSuffix(url);\n\n\t\t\tif (!loadedStates[url]) {\n\t\t\t\tstate = {\n\t\t\t\t\tpassed: [],\n\t\t\t\t\tfailed: []\n\t\t\t\t};\n\n\t\t\t\tloadedStates[url] = state;\n\t\t\t} else {\n\t\t\t\tstate = loadedStates[url];\n\t\t\t}\n\n\t\t\tif (loadedCallback) {\n\t\t\t\tstate.passed.push(loadedCallback);\n\t\t\t}\n\n\t\t\tif (errorCallback) {\n\t\t\t\tstate.failed.push(errorCallback);\n\t\t\t}\n\n\t\t\t// Is loading wait for it to pass\n\t\t\tif (state.status == 1) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Has finished loading and was success\n\t\t\tif (state.status == 2) {\n\t\t\t\tpassed();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Has finished loading and was a failure\n\t\t\tif (state.status == 3) {\n\t\t\t\tfailed();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Start loading\n\t\t\tstate.status = 1;\n\t\t\tlink = document.createElement('link');\n\t\t\tlink.rel = 'stylesheet';\n\t\t\tlink.type = 'text/css';\n\t\t\tlink.id = 'u' + (idCount++);\n\t\t\tlink.async = false;\n\t\t\tlink.defer = false;\n\t\t\tstartTime = new Date().getTime();\n\n\t\t\t// Feature detect onload on link element and sniff older webkits since it has an broken onload event\n\t\t\tif (\"onload\" in link && !isOldWebKit()) {\n\t\t\t\tlink.onload = waitForWebKitLinkLoaded;\n\t\t\t\tlink.onerror = failed;\n\t\t\t} else {\n\t\t\t\t// Sniff for old Firefox that doesn't support the onload event on link elements\n\t\t\t\t// TODO: Remove this in the future when everyone uses modern browsers\n\t\t\t\tif (navigator.userAgent.indexOf(\"Firefox\") > 0) {\n\t\t\t\t\tstyle = document.createElement('style');\n\t\t\t\t\tstyle.textContent = '@import \"' + url + '\"';\n\t\t\t\t\twaitForGeckoLinkLoaded();\n\t\t\t\t\tappendToHead(style);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Use the id owner on older webkits\n\t\t\t\twaitForWebKitLinkLoaded();\n\t\t\t}\n\n\t\t\tappendToHead(link);\n\t\t\tlink.href = url;\n\t\t}\n\n\t\tthis.load = load;\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/DOMUtils.js\n\n/**\n * DOMUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility class for various DOM manipulation and retrieval functions.\n *\n * @class tinymce.dom.DOMUtils\n * @example\n * // Add a class to an element by id in the page\n * tinymce.DOM.addClass('someid', 'someclass');\n *\n * // Add a class to an element by id inside the editor\n * tinymce.activeEditor.dom.addClass('someid', 'someclass');\n */\ndefine(\"tinymce/dom/DOMUtils\", [\n\t\"tinymce/dom/Sizzle\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/html/Styles\",\n\t\"tinymce/dom/EventUtils\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/Range\",\n\t\"tinymce/html/Entities\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/StyleSheetLoader\"\n], function(Sizzle, $, Styles, EventUtils, TreeWalker, Range, Entities, Env, Tools, StyleSheetLoader) {\n\t// Shorten names\n\tvar each = Tools.each, is = Tools.is, grep = Tools.grep, trim = Tools.trim;\n\tvar isIE = Env.ie;\n\tvar simpleSelectorRe = /^([a-z0-9],?)+$/i;\n\tvar whiteSpaceRegExp = /^[ \\t\\r\\n]*$/;\n\n\tfunction setupAttrHooks(domUtils, settings) {\n\t\tvar attrHooks = {}, keepValues = settings.keep_values, keepUrlHook;\n\n\t\tkeepUrlHook = {\n\t\t\tset: function($elm, value, name) {\n\t\t\t\tif (settings.url_converter) {\n\t\t\t\t\tvalue = settings.url_converter.call(settings.url_converter_scope || domUtils, value, name, $elm[0]);\n\t\t\t\t}\n\n\t\t\t\t$elm.attr('data-mce-' + name, value).attr(name, value);\n\t\t\t},\n\n\t\t\tget: function($elm, name) {\n\t\t\t\treturn $elm.attr('data-mce-' + name) || $elm.attr(name);\n\t\t\t}\n\t\t};\n\n\t\tattrHooks = {\n\t\t\tstyle: {\n\t\t\t\tset: function($elm, value) {\n\t\t\t\t\tif (value !== null && typeof value === 'object') {\n\t\t\t\t\t\t$elm.css(value);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (keepValues) {\n\t\t\t\t\t\t$elm.attr('data-mce-style', value);\n\t\t\t\t\t}\n\n\t\t\t\t\t$elm.attr('style', value);\n\t\t\t\t},\n\n\t\t\t\tget: function($elm) {\n\t\t\t\t\tvar value = $elm.attr('data-mce-style') || $elm.attr('style');\n\n\t\t\t\t\tvalue = domUtils.serializeStyle(domUtils.parseStyle(value), $elm[0].nodeName);\n\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (keepValues) {\n\t\t\tattrHooks.href = attrHooks.src = keepUrlHook;\n\t\t}\n\n\t\treturn attrHooks;\n\t}\n\n\tfunction updateInternalStyleAttr(domUtils, $elm) {\n\t\tvar value = $elm.attr('style');\n\n\t\tvalue = domUtils.serializeStyle(domUtils.parseStyle(value), $elm[0].nodeName);\n\n\t\tif (!value) {\n\t\t\tvalue = null;\n\t\t}\n\n\t\t$elm.attr('data-mce-style', value);\n\t}\n\n\tfunction nodeIndex(node, normalized) {\n\t\tvar idx = 0, lastNodeType, nodeType;\n\n\t\tif (node) {\n\t\t\tfor (lastNodeType = node.nodeType, node = node.previousSibling; node; node = node.previousSibling) {\n\t\t\t\tnodeType = node.nodeType;\n\n\t\t\t\t// Normalize text nodes\n\t\t\t\tif (normalized && nodeType == 3) {\n\t\t\t\t\tif (nodeType == lastNodeType || !node.nodeValue.length) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tidx++;\n\t\t\t\tlastNodeType = nodeType;\n\t\t\t}\n\t\t}\n\n\t\treturn idx;\n\t}\n\n\t/**\n\t * Constructs a new DOMUtils instance. Consult the Wiki for more details on settings etc for this class.\n\t *\n\t * @constructor\n\t * @method DOMUtils\n\t * @param {Document} doc Document reference to bind the utility class to.\n\t * @param {settings} settings Optional settings collection.\n\t */\n\tfunction DOMUtils(doc, settings) {\n\t\tvar self = this, blockElementsMap;\n\n\t\tself.doc = doc;\n\t\tself.win = window;\n\t\tself.files = {};\n\t\tself.counter = 0;\n\t\tself.stdMode = !isIE || doc.documentMode >= 8;\n\t\tself.boxModel = !isIE || doc.compatMode == \"CSS1Compat\" || self.stdMode;\n\t\tself.styleSheetLoader = new StyleSheetLoader(doc);\n\t\tself.boundEvents = [];\n\t\tself.settings = settings = settings || {};\n\t\tself.schema = settings.schema;\n\t\tself.styles = new Styles({\n\t\t\turl_converter: settings.url_converter,\n\t\t\turl_converter_scope: settings.url_converter_scope\n\t\t}, settings.schema);\n\n\t\tself.fixDoc(doc);\n\t\tself.events = settings.ownEvents ? new EventUtils(settings.proxy) : EventUtils.Event;\n\t\tself.attrHooks = setupAttrHooks(self, settings);\n\t\tblockElementsMap = settings.schema ? settings.schema.getBlockElements() : {};\n\t\tself.$ = $.overrideDefaults(function() {\n\t\t\treturn {\n\t\t\t\tcontext: doc,\n\t\t\t\telement: self.getRoot()\n\t\t\t};\n\t\t});\n\n\t\t/**\n\t\t * Returns true/false if the specified element is a block element or not.\n\t\t *\n\t\t * @method isBlock\n\t\t * @param {Node/String} node Element/Node to check.\n\t\t * @return {Boolean} True/False state if the node is a block element or not.\n\t\t */\n\t\tself.isBlock = function(node) {\n\t\t\t// Fix for #5446\n\t\t\tif (!node) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// This function is called in module pattern style since it might be executed with the wrong this scope\n\t\t\tvar type = node.nodeType;\n\n\t\t\t// If it's a node then check the type and use the nodeName\n\t\t\tif (type) {\n\t\t\t\treturn !!(type === 1 && blockElementsMap[node.nodeName]);\n\t\t\t}\n\n\t\t\treturn !!blockElementsMap[node];\n\t\t};\n\t}\n\n\tDOMUtils.prototype = {\n\t\t$$: function(elm) {\n\t\t\tif (typeof elm == 'string') {\n\t\t\t\telm = this.get(elm);\n\t\t\t}\n\n\t\t\treturn this.$(elm);\n\t\t},\n\n\t\troot: null,\n\n\t\tfixDoc: function(doc) {\n\t\t\tvar settings = this.settings, name;\n\n\t\t\tif (isIE && settings.schema) {\n\t\t\t\t// Add missing HTML 4/5 elements to IE\n\t\t\t\t('abbr article aside audio canvas ' +\n\t\t\t\t'details figcaption figure footer ' +\n\t\t\t\t'header hgroup mark menu meter nav ' +\n\t\t\t\t'output progress section summary ' +\n\t\t\t\t'time video').replace(/\\w+/g, function(name) {\n\t\t\t\t\tdoc.createElement(name);\n\t\t\t\t});\n\n\t\t\t\t// Create all custom elements\n\t\t\t\tfor (name in settings.schema.getCustomElements()) {\n\t\t\t\t\tdoc.createElement(name);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tclone: function(node, deep) {\n\t\t\tvar self = this, clone, doc;\n\n\t\t\t// TODO: Add feature detection here in the future\n\t\t\tif (!isIE || node.nodeType !== 1 || deep) {\n\t\t\t\treturn node.cloneNode(deep);\n\t\t\t}\n\n\t\t\tdoc = self.doc;\n\n\t\t\t// Make a HTML5 safe shallow copy\n\t\t\tif (!deep) {\n\t\t\t\tclone = doc.createElement(node.nodeName);\n\n\t\t\t\t// Copy attribs\n\t\t\t\teach(self.getAttribs(node), function(attr) {\n\t\t\t\t\tself.setAttrib(clone, attr.nodeName, self.getAttrib(node, attr.nodeName));\n\t\t\t\t});\n\n\t\t\t\treturn clone;\n\t\t\t}\n\n\t\t\treturn clone.firstChild;\n\t\t},\n\n\t\t/**\n\t\t * Returns the root node of the document. This is normally the body but might be a DIV. Parents like getParent will not\n\t\t * go above the point of this root node.\n\t\t *\n\t\t * @method getRoot\n\t\t * @return {Element} Root element for the utility class.\n\t\t */\n\t\tgetRoot: function() {\n\t\t\tvar self = this;\n\n\t\t\treturn self.settings.root_element || self.doc.body;\n\t\t},\n\n\t\t/**\n\t\t * Returns the viewport of the window.\n\t\t *\n\t\t * @method getViewPort\n\t\t * @param {Window} win Optional window to get viewport of.\n\t\t * @return {Object} Viewport object with fields x, y, w and h.\n\t\t */\n\t\tgetViewPort: function(win) {\n\t\t\tvar doc, rootElm;\n\n\t\t\twin = !win ? this.win : win;\n\t\t\tdoc = win.document;\n\t\t\trootElm = this.boxModel ? doc.documentElement : doc.body;\n\n\t\t\t// Returns viewport size excluding scrollbars\n\t\t\treturn {\n\t\t\t\tx: win.pageXOffset || rootElm.scrollLeft,\n\t\t\t\ty: win.pageYOffset || rootElm.scrollTop,\n\t\t\t\tw: win.innerWidth || rootElm.clientWidth,\n\t\t\t\th: win.innerHeight || rootElm.clientHeight\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns the rectangle for a specific element.\n\t\t *\n\t\t * @method getRect\n\t\t * @param {Element/String} elm Element object or element ID to get rectangle from.\n\t\t * @return {object} Rectangle for specified element object with x, y, w, h fields.\n\t\t */\n\t\tgetRect: function(elm) {\n\t\t\tvar self = this, pos, size;\n\n\t\t\telm = self.get(elm);\n\t\t\tpos = self.getPos(elm);\n\t\t\tsize = self.getSize(elm);\n\n\t\t\treturn {\n\t\t\t\tx: pos.x, y: pos.y,\n\t\t\t\tw: size.w, h: size.h\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns the size dimensions of the specified element.\n\t\t *\n\t\t * @method getSize\n\t\t * @param {Element/String} elm Element object or element ID to get rectangle from.\n\t\t * @return {object} Rectangle for specified element object with w, h fields.\n\t\t */\n\t\tgetSize: function(elm) {\n\t\t\tvar self = this, w, h;\n\n\t\t\telm = self.get(elm);\n\t\t\tw = self.getStyle(elm, 'width');\n\t\t\th = self.getStyle(elm, 'height');\n\n\t\t\t// Non pixel value, then force offset/clientWidth\n\t\t\tif (w.indexOf('px') === -1) {\n\t\t\t\tw = 0;\n\t\t\t}\n\n\t\t\t// Non pixel value, then force offset/clientWidth\n\t\t\tif (h.indexOf('px') === -1) {\n\t\t\t\th = 0;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tw: parseInt(w, 10) || elm.offsetWidth || elm.clientWidth,\n\t\t\t\th: parseInt(h, 10) || elm.offsetHeight || elm.clientHeight\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Returns a node by the specified selector function. This function will\n\t\t * loop through all parent nodes and call the specified function for each node.\n\t\t * If the function then returns true indicating that it has found what it was looking for, the loop execution will then end\n\t\t * and the node it found will be returned.\n\t\t *\n\t\t * @method getParent\n\t\t * @param {Node/String} node DOM node to search parents on or ID string.\n\t\t * @param {function} selector Selection function or CSS selector to execute on each node.\n\t\t * @param {Node} root Optional root element, never go below this point.\n\t\t * @return {Node} DOM Node or null if it wasn't found.\n\t\t */\n\t\tgetParent: function(node, selector, root) {\n\t\t\treturn this.getParents(node, selector, root, false);\n\t\t},\n\n\t\t/**\n\t\t * Returns a node list of all parents matching the specified selector function or pattern.\n\t\t * If the function then returns true indicating that it has found what it was looking for and that node will be collected.\n\t\t *\n\t\t * @method getParents\n\t\t * @param {Node/String} node DOM node to search parents on or ID string.\n\t\t * @param {function} selector Selection function to execute on each node or CSS pattern.\n\t\t * @param {Node} root Optional root element, never go below this point.\n\t\t * @return {Array} Array of nodes or null if it wasn't found.\n\t\t */\n\t\tgetParents: function(node, selector, root, collect) {\n\t\t\tvar self = this, selectorVal, result = [];\n\n\t\t\tnode = self.get(node);\n\t\t\tcollect = collect === undefined;\n\n\t\t\t// Default root on inline mode\n\t\t\troot = root || (self.getRoot().nodeName != 'BODY' ? self.getRoot().parentNode : null);\n\n\t\t\t// Wrap node name as func\n\t\t\tif (is(selector, 'string')) {\n\t\t\t\tselectorVal = selector;\n\n\t\t\t\tif (selector === '*') {\n\t\t\t\t\tselector = function(node) {\n\t\t\t\t\t\treturn node.nodeType == 1;\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tselector = function(node) {\n\t\t\t\t\t\treturn self.is(node, selectorVal);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (node) {\n\t\t\t\tif (node == root || !node.nodeType || node.nodeType === 9) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!selector || selector(node)) {\n\t\t\t\t\tif (collect) {\n\t\t\t\t\t\tresult.push(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\treturn collect ? result : null;\n\t\t},\n\n\t\t/**\n\t\t * Returns the specified element by ID or the input element if it isn't a string.\n\t\t *\n\t\t * @method get\n\t\t * @param {String/Element} n Element id to look for or element to just pass though.\n\t\t * @return {Element} Element matching the specified id or null if it wasn't found.\n\t\t */\n\t\tget: function(elm) {\n\t\t\tvar name;\n\n\t\t\tif (elm && this.doc && typeof elm == 'string') {\n\t\t\t\tname = elm;\n\t\t\t\telm = this.doc.getElementById(elm);\n\n\t\t\t\t// IE and Opera returns meta elements when they match the specified input ID, but getElementsByName seems to do the trick\n\t\t\t\tif (elm && elm.id !== name) {\n\t\t\t\t\treturn this.doc.getElementsByName(name)[1];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn elm;\n\t\t},\n\n\t\t/**\n\t\t * Returns the next node that matches selector or function\n\t\t *\n\t\t * @method getNext\n\t\t * @param {Node} node Node to find siblings from.\n\t\t * @param {String/function} selector Selector CSS expression or function.\n\t\t * @return {Node} Next node item matching the selector or null if it wasn't found.\n\t\t */\n\t\tgetNext: function(node, selector) {\n\t\t\treturn this._findSib(node, selector, 'nextSibling');\n\t\t},\n\n\t\t/**\n\t\t * Returns the previous node that matches selector or function\n\t\t *\n\t\t * @method getPrev\n\t\t * @param {Node} node Node to find siblings from.\n\t\t * @param {String/function} selector Selector CSS expression or function.\n\t\t * @return {Node} Previous node item matching the selector or null if it wasn't found.\n\t\t */\n\t\tgetPrev: function(node, selector) {\n\t\t\treturn this._findSib(node, selector, 'previousSibling');\n\t\t},\n\n\t\t// #ifndef jquery\n\n\t\t/**\n\t\t * Selects specific elements by a CSS level 3 pattern. For example \"div#a1 p.test\".\n\t\t * This function is optimized for the most common patterns needed in TinyMCE but it also performs well enough\n\t\t * on more complex patterns.\n\t\t *\n\t\t * @method select\n\t\t * @param {String} selector CSS level 3 pattern to select/find elements by.\n\t\t * @param {Object} scope Optional root element/scope element to search in.\n\t\t * @return {Array} Array with all matched elements.\n\t\t * @example\n\t\t * // Adds a class to all paragraphs in the currently active editor\n\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'someclass');\n\t\t *\n\t\t * // Adds a class to all spans that have the test class in the currently active editor\n\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('span.test'), 'someclass')\n\t\t */\n\t\tselect: function(selector, scope) {\n\t\t\tvar self = this;\n\n\t\t\t/*eslint new-cap:0 */\n\t\t\treturn Sizzle(selector, self.get(scope) || self.settings.root_element || self.doc, []);\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the specified element matches the specified css pattern.\n\t\t *\n\t\t * @method is\n\t\t * @param {Node/NodeList} elm DOM node to match or an array of nodes to match.\n\t\t * @param {String} selector CSS pattern to match the element against.\n\t\t */\n\t\tis: function(elm, selector) {\n\t\t\tvar i;\n\n\t\t\t// If it isn't an array then try to do some simple selectors instead of Sizzle for to boost performance\n\t\t\tif (elm.length === undefined) {\n\t\t\t\t// Simple all selector\n\t\t\t\tif (selector === '*') {\n\t\t\t\t\treturn elm.nodeType == 1;\n\t\t\t\t}\n\n\t\t\t\t// Simple selector just elements\n\t\t\t\tif (simpleSelectorRe.test(selector)) {\n\t\t\t\t\tselector = selector.toLowerCase().split(/,/);\n\t\t\t\t\telm = elm.nodeName.toLowerCase();\n\n\t\t\t\t\tfor (i = selector.length - 1; i >= 0; i--) {\n\t\t\t\t\t\tif (selector[i] == elm) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Is non element\n\t\t\tif (elm.nodeType && elm.nodeType != 1) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar elms = elm.nodeType ? [elm] : elm;\n\n\t\t\t/*eslint new-cap:0 */\n\t\t\treturn Sizzle(selector, elms[0].ownerDocument || elms[0], null, elms).length > 0;\n\t\t},\n\n\t\t// #endif\n\n\t\t/**\n\t\t * Adds the specified element to another element or elements.\n\t\t *\n\t\t * @method add\n\t\t * @param {String/Element/Array} parentElm Element id string, DOM node element or array of ids or elements to add to.\n\t\t * @param {String/Element} name Name of new element to add or existing element to add.\n\t\t * @param {Object} attrs Optional object collection with arguments to add to the new element(s).\n\t\t * @param {String} html Optional inner HTML contents to add for each element.\n\t\t * @param {Boolean} create Optional flag if the element should be created or added.\n\t\t * @return {Element/Array} Element that got created, or an array of created elements if multiple input elements\n\t\t * were passed in.\n\t\t * @example\n\t\t * // Adds a new paragraph to the end of the active editor\n\t\t * tinymce.activeEditor.dom.add(tinymce.activeEditor.getBody(), 'p', {title: 'my title'}, 'Some content');\n\t\t */\n\t\tadd: function(parentElm, name, attrs, html, create) {\n\t\t\tvar self = this;\n\n\t\t\treturn this.run(parentElm, function(parentElm) {\n\t\t\t\tvar newElm;\n\n\t\t\t\tnewElm = is(name, 'string') ? self.doc.createElement(name) : name;\n\t\t\t\tself.setAttribs(newElm, attrs);\n\n\t\t\t\tif (html) {\n\t\t\t\t\tif (html.nodeType) {\n\t\t\t\t\t\tnewElm.appendChild(html);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.setHTML(newElm, html);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn !create ? parentElm.appendChild(newElm) : newElm;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Creates a new element.\n\t\t *\n\t\t * @method create\n\t\t * @param {String} name Name of new element.\n\t\t * @param {Object} attrs Optional object name/value collection with element attributes.\n\t\t * @param {String} html Optional HTML string to set as inner HTML of the element.\n\t\t * @return {Element} HTML DOM node element that got created.\n\t\t * @example\n\t\t * // Adds an element where the caret/selection is in the active editor\n\t\t * var el = tinymce.activeEditor.dom.create('div', {id: 'test', 'class': 'myclass'}, 'some content');\n\t\t * tinymce.activeEditor.selection.setNode(el);\n\t\t */\n\t\tcreate: function(name, attrs, html) {\n\t\t\treturn this.add(this.doc.createElement(name), name, attrs, html, 1);\n\t\t},\n\n\t\t/**\n\t\t * Creates HTML string for element. The element will be closed unless an empty inner HTML string is passed in.\n\t\t *\n\t\t * @method createHTML\n\t\t * @param {String} name Name of new element.\n\t\t * @param {Object} attrs Optional object name/value collection with element attributes.\n\t\t * @param {String} html Optional HTML string to set as inner HTML of the element.\n\t\t * @return {String} String with new HTML element, for example: <a href=\"#\">test</a>.\n\t\t * @example\n\t\t * // Creates a html chunk and inserts it at the current selection/caret location\n\t\t * tinymce.activeEditor.selection.setContent(tinymce.activeEditor.dom.createHTML('a', {href: 'test.html'}, 'some line'));\n\t\t */\n\t\tcreateHTML: function(name, attrs, html) {\n\t\t\tvar outHtml = '', key;\n\n\t\t\toutHtml += '<' + name;\n\n\t\t\tfor (key in attrs) {\n\t\t\t\tif (attrs.hasOwnProperty(key) && attrs[key] !== null && typeof attrs[key] != 'undefined') {\n\t\t\t\t\toutHtml += ' ' + key + '=\"' + this.encode(attrs[key]) + '\"';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// A call to tinymce.is doesn't work for some odd reason on IE9 possible bug inside their JS runtime\n\t\t\tif (typeof html != \"undefined\") {\n\t\t\t\treturn outHtml + '>' + html + '</' + name + '>';\n\t\t\t}\n\n\t\t\treturn outHtml + ' />';\n\t\t},\n\n\t\t/**\n\t\t * Creates a document fragment out of the specified HTML string.\n\t\t *\n\t\t * @method createFragment\n\t\t * @param {String} html Html string to create fragment from.\n\t\t * @return {DocumentFragment} Document fragment node.\n\t\t */\n\t\tcreateFragment: function(html) {\n\t\t\tvar frag, node, doc = this.doc, container;\n\n\t\t\tcontainer = doc.createElement(\"div\");\n\t\t\tfrag = doc.createDocumentFragment();\n\n\t\t\tif (html) {\n\t\t\t\tcontainer.innerHTML = html;\n\t\t\t}\n\n\t\t\twhile ((node = container.firstChild)) {\n\t\t\t\tfrag.appendChild(node);\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t},\n\n\t\t/**\n\t\t * Removes/deletes the specified element(s) from the DOM.\n\t\t *\n\t\t * @method remove\n\t\t * @param {String/Element/Array} node ID of element or DOM element object or array containing multiple elements/ids.\n\t\t * @param {Boolean} keepChildren Optional state to keep children or not. If set to true all children will be\n\t\t * placed at the location of the removed element.\n\t\t * @return {Element/Array} HTML DOM element that got removed, or an array of removed elements if multiple input elements\n\t\t * were passed in.\n\t\t * @example\n\t\t * // Removes all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.remove(tinymce.activeEditor.dom.select('p'));\n\t\t *\n\t\t * // Removes an element by id in the document\n\t\t * tinymce.DOM.remove('mydiv');\n\t\t */\n\t\tremove: function(node, keepChildren) {\n\t\t\tnode = this.$$(node);\n\n\t\t\tif (keepChildren) {\n\t\t\t\tnode.each(function() {\n\t\t\t\t\tvar child;\n\n\t\t\t\t\twhile ((child = this.firstChild)) {\n\t\t\t\t\t\tif (child.nodeType == 3 && child.data.length === 0) {\n\t\t\t\t\t\t\tthis.removeChild(child);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.parentNode.insertBefore(child, this);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).remove();\n\t\t\t} else {\n\t\t\t\tnode.remove();\n\t\t\t}\n\n\t\t\treturn node.length > 1 ? node.toArray() : node[0];\n\t\t},\n\n\t\t/**\n\t\t * Sets the CSS style value on a HTML element. The name can be a camelcase string\n\t\t * or the CSS style name like background-color.\n\t\t *\n\t\t * @method setStyle\n\t\t * @param {String/Element/Array} elm HTML element/Array of elements to set CSS style value on.\n\t\t * @param {String} name Name of the style value to set.\n\t\t * @param {String} value Value to set on the style.\n\t\t * @example\n\t\t * // Sets a style value on all paragraphs in the currently active editor\n\t\t * tinymce.activeEditor.dom.setStyle(tinymce.activeEditor.dom.select('p'), 'background-color', 'red');\n\t\t *\n\t\t * // Sets a style value to an element by id in the current document\n\t\t * tinymce.DOM.setStyle('mydiv', 'background-color', 'red');\n\t\t */\n\t\tsetStyle: function(elm, name, value) {\n\t\t\telm = this.$$(elm).css(name, value);\n\n\t\t\tif (this.settings.update_styles) {\n\t\t\t\tupdateInternalStyleAttr(this, elm);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the current style or runtime/computed value of an element.\n\t\t *\n\t\t * @method getStyle\n\t\t * @param {String/Element} elm HTML element or element id string to get style from.\n\t\t * @param {String} name Style name to return.\n\t\t * @param {Boolean} computed Computed style.\n\t\t * @return {String} Current style or computed style value of an element.\n\t\t */\n\t\tgetStyle: function(elm, name, computed) {\n\t\t\telm = this.$$(elm);\n\n\t\t\tif (computed) {\n\t\t\t\treturn elm.css(name);\n\t\t\t}\n\n\t\t\t// Camelcase it, if needed\n\t\t\tname = name.replace(/-(\\D)/g, function(a, b) {\n\t\t\t\treturn b.toUpperCase();\n\t\t\t});\n\n\t\t\tif (name == 'float') {\n\t\t\t\tname = Env.ie && Env.ie < 12 ? 'styleFloat' : 'cssFloat';\n\t\t\t}\n\n\t\t\treturn elm[0] && elm[0].style ? elm[0].style[name] : undefined;\n\t\t},\n\n\t\t/**\n\t\t * Sets multiple styles on the specified element(s).\n\t\t *\n\t\t * @method setStyles\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set styles on.\n\t\t * @param {Object} styles Name/Value collection of style items to add to the element(s).\n\t\t * @example\n\t\t * // Sets styles on all paragraphs in the currently active editor\n\t\t * tinymce.activeEditor.dom.setStyles(tinymce.activeEditor.dom.select('p'), {'background-color': 'red', 'color': 'green'});\n\t\t *\n\t\t * // Sets styles to an element by id in the current document\n\t\t * tinymce.DOM.setStyles('mydiv', {'background-color': 'red', 'color': 'green'});\n\t\t */\n\t\tsetStyles: function(elm, styles) {\n\t\t\telm = this.$$(elm).css(styles);\n\n\t\t\tif (this.settings.update_styles) {\n\t\t\t\tupdateInternalStyleAttr(this, elm);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Removes all attributes from an element or elements.\n\t\t *\n\t\t * @method removeAllAttribs\n\t\t * @param {Element/String/Array} e DOM element, element id string or array of elements/ids to remove attributes from.\n\t\t */\n\t\tremoveAllAttribs: function(e) {\n\t\t\treturn this.run(e, function(e) {\n\t\t\t\tvar i, attrs = e.attributes;\n\t\t\t\tfor (i = attrs.length - 1; i >= 0; i--) {\n\t\t\t\t\te.removeAttributeNode(attrs.item(i));\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Sets the specified attribute of an element or elements.\n\t\t *\n\t\t * @method setAttrib\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set attribute on.\n\t\t * @param {String} name Name of attribute to set.\n\t\t * @param {String} value Value to set on the attribute - if this value is falsy like null, 0 or '' it will remove\n\t\t * the attribute instead.\n\t\t * @example\n\t\t * // Sets class attribute on all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.setAttrib(tinymce.activeEditor.dom.select('p'), 'class', 'myclass');\n\t\t *\n\t\t * // Sets class attribute on a specific element in the current page\n\t\t * tinymce.dom.setAttrib('mydiv', 'class', 'myclass');\n\t\t */\n\t\tsetAttrib: function(elm, name, value) {\n\t\t\tvar self = this, originalValue, hook, settings = self.settings;\n\n\t\t\tif (value === '') {\n\t\t\t\tvalue = null;\n\t\t\t}\n\n\t\t\telm = self.$$(elm);\n\t\t\toriginalValue = elm.attr(name);\n\n\t\t\tif (!elm.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thook = self.attrHooks[name];\n\t\t\tif (hook && hook.set) {\n\t\t\t\thook.set(elm, value, name);\n\t\t\t} else {\n\t\t\t\telm.attr(name, value);\n\t\t\t}\n\n\t\t\tif (originalValue != value && settings.onSetAttrib) {\n\t\t\t\tsettings.onSetAttrib({\n\t\t\t\t\tattrElm: elm,\n\t\t\t\t\tattrName: name,\n\t\t\t\t\tattrValue: value\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets two or more specified attributes of an element or elements.\n\t\t *\n\t\t * @method setAttribs\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set attributes on.\n\t\t * @param {Object} attrs Name/Value collection of attribute items to add to the element(s).\n\t\t * @example\n\t\t * // Sets class and title attributes on all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.setAttribs(tinymce.activeEditor.dom.select('p'), {'class': 'myclass', title: 'some title'});\n\t\t *\n\t\t * // Sets class and title attributes on a specific element in the current page\n\t\t * tinymce.DOM.setAttribs('mydiv', {'class': 'myclass', title: 'some title'});\n\t\t */\n\t\tsetAttribs: function(elm, attrs) {\n\t\t\tvar self = this;\n\n\t\t\tself.$$(elm).each(function(i, node) {\n\t\t\t\teach(attrs, function(value, name) {\n\t\t\t\t\tself.setAttrib(node, name, value);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns the specified attribute by name.\n\t\t *\n\t\t * @method getAttrib\n\t\t * @param {String/Element} elm Element string id or DOM element to get attribute from.\n\t\t * @param {String} name Name of attribute to get.\n\t\t * @param {String} defaultVal Optional default value to return if the attribute didn't exist.\n\t\t * @return {String} Attribute value string, default value or null if the attribute wasn't found.\n\t\t */\n\t\tgetAttrib: function(elm, name, defaultVal) {\n\t\t\tvar self = this, hook, value;\n\n\t\t\telm = self.$$(elm);\n\n\t\t\tif (elm.length) {\n\t\t\t\thook = self.attrHooks[name];\n\n\t\t\t\tif (hook && hook.get) {\n\t\t\t\t\tvalue = hook.get(elm, name);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = elm.attr(name);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (typeof value == 'undefined') {\n\t\t\t\tvalue = defaultVal || '';\n\t\t\t}\n\n\t\t\treturn value;\n\t\t},\n\n\t\t/**\n\t\t * Returns the absolute x, y position of a node. The position will be returned in an object with x, y fields.\n\t\t *\n\t\t * @method getPos\n\t\t * @param {Element/String} elm HTML element or element id to get x, y position from.\n\t\t * @param {Element} rootElm Optional root element to stop calculations at.\n\t\t * @return {object} Absolute position of the specified element object with x, y fields.\n\t\t */\n\t\tgetPos: function(elm, rootElm) {\n\t\t\tvar self = this, x = 0, y = 0, offsetParent, doc = self.doc, body = doc.body, pos;\n\n\t\t\telm = self.get(elm);\n\t\t\trootElm = rootElm || body;\n\n\t\t\tif (elm) {\n\t\t\t\t// Use getBoundingClientRect if it exists since it's faster than looping offset nodes\n\t\t\t\t// Fallback to offsetParent calculations if the body isn't static better since it stops at the body root\n\t\t\t\tif (rootElm === body && elm.getBoundingClientRect && $(body).css('position') === 'static') {\n\t\t\t\t\tpos = elm.getBoundingClientRect();\n\t\t\t\t\trootElm = self.boxModel ? doc.documentElement : body;\n\n\t\t\t\t\t// Add scroll offsets from documentElement or body since IE with the wrong box model will use d.body and so do WebKit\n\t\t\t\t\t// Also remove the body/documentelement clientTop/clientLeft on IE 6, 7 since they offset the position\n\t\t\t\t\tx = pos.left + (doc.documentElement.scrollLeft || body.scrollLeft) - rootElm.clientLeft;\n\t\t\t\t\ty = pos.top + (doc.documentElement.scrollTop || body.scrollTop) - rootElm.clientTop;\n\n\t\t\t\t\treturn {x: x, y: y};\n\t\t\t\t}\n\n\t\t\t\toffsetParent = elm;\n\t\t\t\twhile (offsetParent && offsetParent != rootElm && offsetParent.nodeType) {\n\t\t\t\t\tx += offsetParent.offsetLeft || 0;\n\t\t\t\t\ty += offsetParent.offsetTop || 0;\n\t\t\t\t\toffsetParent = offsetParent.offsetParent;\n\t\t\t\t}\n\n\t\t\t\toffsetParent = elm.parentNode;\n\t\t\t\twhile (offsetParent && offsetParent != rootElm && offsetParent.nodeType) {\n\t\t\t\t\tx -= offsetParent.scrollLeft || 0;\n\t\t\t\t\ty -= offsetParent.scrollTop || 0;\n\t\t\t\t\toffsetParent = offsetParent.parentNode;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {x: x, y: y};\n\t\t},\n\n\t\t/**\n\t\t * Parses the specified style value into an object collection. This parser will also\n\t\t * merge and remove any redundant items that browsers might have added. It will also convert non-hex\n\t\t * colors to hex values. Urls inside the styles will also be converted to absolute/relative based on settings.\n\t\t *\n\t\t * @method parseStyle\n\t\t * @param {String} cssText Style value to parse, for example: border:1px solid red;.\n\t\t * @return {Object} Object representation of that style, for example: {border: '1px solid red'}\n\t\t */\n\t\tparseStyle: function(cssText) {\n\t\t\treturn this.styles.parse(cssText);\n\t\t},\n\n\t\t/**\n\t\t * Serializes the specified style object into a string.\n\t\t *\n\t\t * @method serializeStyle\n\t\t * @param {Object} styles Object to serialize as string, for example: {border: '1px solid red'}\n\t\t * @param {String} name Optional element name.\n\t\t * @return {String} String representation of the style object, for example: border: 1px solid red.\n\t\t */\n\t\tserializeStyle: function(styles, name) {\n\t\t\treturn this.styles.serialize(styles, name);\n\t\t},\n\n\t\t/**\n\t\t * Adds a style element at the top of the document with the specified cssText content.\n\t\t *\n\t\t * @method addStyle\n\t\t * @param {String} cssText CSS Text style to add to top of head of document.\n\t\t */\n\t\taddStyle: function(cssText) {\n\t\t\tvar self = this, doc = self.doc, head, styleElm;\n\n\t\t\t// Prevent inline from loading the same styles twice\n\t\t\tif (self !== DOMUtils.DOM && doc === document) {\n\t\t\t\tvar addedStyles = DOMUtils.DOM.addedStyles;\n\n\t\t\t\taddedStyles = addedStyles || [];\n\t\t\t\tif (addedStyles[cssText]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\taddedStyles[cssText] = true;\n\t\t\t\tDOMUtils.DOM.addedStyles = addedStyles;\n\t\t\t}\n\n\t\t\t// Create style element if needed\n\t\t\tstyleElm = doc.getElementById('mceDefaultStyles');\n\t\t\tif (!styleElm) {\n\t\t\t\tstyleElm = doc.createElement('style');\n\t\t\t\tstyleElm.id = 'mceDefaultStyles';\n\t\t\t\tstyleElm.type = 'text/css';\n\n\t\t\t\thead = doc.getElementsByTagName('head')[0];\n\t\t\t\tif (head.firstChild) {\n\t\t\t\t\thead.insertBefore(styleElm, head.firstChild);\n\t\t\t\t} else {\n\t\t\t\t\thead.appendChild(styleElm);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Append style data to old or new style element\n\t\t\tif (styleElm.styleSheet) {\n\t\t\t\tstyleElm.styleSheet.cssText += cssText;\n\t\t\t} else {\n\t\t\t\tstyleElm.appendChild(doc.createTextNode(cssText));\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Imports/loads the specified CSS file into the document bound to the class.\n\t\t *\n\t\t * @method loadCSS\n\t\t * @param {String} url URL to CSS file to load.\n\t\t * @example\n\t\t * // Loads a CSS file dynamically into the current document\n\t\t * tinymce.DOM.loadCSS('somepath/some.css');\n\t\t *\n\t\t * // Loads a CSS file into the currently active editor instance\n\t\t * tinymce.activeEditor.dom.loadCSS('somepath/some.css');\n\t\t *\n\t\t * // Loads a CSS file into an editor instance by id\n\t\t * tinymce.get('someid').dom.loadCSS('somepath/some.css');\n\t\t *\n\t\t * // Loads multiple CSS files into the current document\n\t\t * tinymce.DOM.loadCSS('somepath/some.css,somepath/someother.css');\n\t\t */\n\t\tloadCSS: function(url) {\n\t\t\tvar self = this, doc = self.doc, head;\n\n\t\t\t// Prevent inline from loading the same CSS file twice\n\t\t\tif (self !== DOMUtils.DOM && doc === document) {\n\t\t\t\tDOMUtils.DOM.loadCSS(url);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!url) {\n\t\t\t\turl = '';\n\t\t\t}\n\n\t\t\thead = doc.getElementsByTagName('head')[0];\n\n\t\t\teach(url.split(','), function(url) {\n\t\t\t\tvar link;\n\n\t\t\t\turl = Tools._addCacheSuffix(url);\n\n\t\t\t\tif (self.files[url]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tself.files[url] = true;\n\t\t\t\tlink = self.create('link', {rel: 'stylesheet', href: url});\n\n\t\t\t\t// IE 8 has a bug where dynamically loading stylesheets would produce a 1 item remaining bug\n\t\t\t\t// This fix seems to resolve that issue by recalcing the document once a stylesheet finishes loading\n\t\t\t\t// It's ugly but it seems to work fine.\n\t\t\t\tif (isIE && doc.documentMode && doc.recalc) {\n\t\t\t\t\tlink.onload = function() {\n\t\t\t\t\t\tif (doc.recalc) {\n\t\t\t\t\t\t\tdoc.recalc();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlink.onload = null;\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\thead.appendChild(link);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Adds a class to the specified element or elements.\n\t\t *\n\t\t * @method addClass\n\t\t * @param {String/Element/Array} elm Element ID string or DOM element or array with elements or IDs.\n\t\t * @param {String} cls Class name to add to each element.\n\t\t * @return {String/Array} String with new class value or array with new class values for all elements.\n\t\t * @example\n\t\t * // Adds a class to all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'myclass');\n\t\t *\n\t\t * // Adds a class to a specific element in the current page\n\t\t * tinymce.DOM.addClass('mydiv', 'myclass');\n\t\t */\n\t\taddClass: function(elm, cls) {\n\t\t\tthis.$$(elm).addClass(cls);\n\t\t},\n\n\t\t/**\n\t\t * Removes a class from the specified element or elements.\n\t\t *\n\t\t * @method removeClass\n\t\t * @param {String/Element/Array} elm Element ID string or DOM element or array with elements or IDs.\n\t\t * @param {String} cls Class name to remove from each element.\n\t\t * @return {String/Array} String of remaining class name(s), or an array of strings if multiple input elements\n\t\t * were passed in.\n\t\t * @example\n\t\t * // Removes a class from all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.removeClass(tinymce.activeEditor.dom.select('p'), 'myclass');\n\t\t *\n\t\t * // Removes a class from a specific element in the current page\n\t\t * tinymce.DOM.removeClass('mydiv', 'myclass');\n\t\t */\n\t\tremoveClass: function(elm, cls) {\n\t\t\tthis.toggleClass(elm, cls, false);\n\t\t},\n\n\t\t/**\n\t\t * Returns true if the specified element has the specified class.\n\t\t *\n\t\t * @method hasClass\n\t\t * @param {String/Element} elm HTML element or element id string to check CSS class on.\n\t\t * @param {String} cls CSS class to check for.\n\t\t * @return {Boolean} true/false if the specified element has the specified class.\n\t\t */\n\t\thasClass: function(elm, cls) {\n\t\t\treturn this.$$(elm).hasClass(cls);\n\t\t},\n\n\t\t/**\n\t\t * Toggles the specified class on/off.\n\t\t *\n\t\t * @method toggleClass\n\t\t * @param {Element} elm Element to toggle class on.\n\t\t * @param {[type]} cls Class to toggle on/off.\n\t\t * @param {[type]} state Optional state to set.\n\t\t */\n\t\ttoggleClass: function(elm, cls, state) {\n\t\t\tthis.$$(elm).toggleClass(cls, state).each(function() {\n\t\t\t\tif (this.className === '') {\n\t\t\t\t\t$(this).attr('class', null);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Shows the specified element(s) by ID by setting the \"display\" style.\n\t\t *\n\t\t * @method show\n\t\t * @param {String/Element/Array} elm ID of DOM element or DOM element or array with elements or IDs to show.\n\t\t */\n\t\tshow: function(elm) {\n\t\t\tthis.$$(elm).show();\n\t\t},\n\n\t\t/**\n\t\t * Hides the specified element(s) by ID by setting the \"display\" style.\n\t\t *\n\t\t * @method hide\n\t\t * @param {String/Element/Array} elm ID of DOM element or DOM element or array with elements or IDs to hide.\n\t\t * @example\n\t\t * // Hides an element by id in the document\n\t\t * tinymce.DOM.hide('myid');\n\t\t */\n\t\thide: function(elm) {\n\t\t\tthis.$$(elm).hide();\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the element is hidden or not by checking the \"display\" style.\n\t\t *\n\t\t * @method isHidden\n\t\t * @param {String/Element} elm Id or element to check display state on.\n\t\t * @return {Boolean} true/false if the element is hidden or not.\n\t\t */\n\t\tisHidden: function(elm) {\n\t\t\treturn this.$$(elm).css('display') == 'none';\n\t\t},\n\n\t\t/**\n\t\t * Returns a unique id. This can be useful when generating elements on the fly.\n\t\t * This method will not check if the element already exists.\n\t\t *\n\t\t * @method uniqueId\n\t\t * @param {String} prefix Optional prefix to add in front of all ids - defaults to \"mce_\".\n\t\t * @return {String} Unique id.\n\t\t */\n\t\tuniqueId: function(prefix) {\n\t\t\treturn (!prefix ? 'mce_' : prefix) + (this.counter++);\n\t\t},\n\n\t\t/**\n\t\t * Sets the specified HTML content inside the element or elements. The HTML will first be processed. This means\n\t\t * URLs will get converted, hex color values fixed etc. Check processHTML for details.\n\t\t *\n\t\t * @method setHTML\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set HTML inside of.\n\t\t * @param {String} html HTML content to set as inner HTML of the element.\n\t\t * @example\n\t\t * // Sets the inner HTML of all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.setHTML(tinymce.activeEditor.dom.select('p'), 'some inner html');\n\t\t *\n\t\t * // Sets the inner HTML of an element by id in the document\n\t\t * tinymce.DOM.setHTML('mydiv', 'some inner html');\n\t\t */\n\t\tsetHTML: function(elm, html) {\n\t\t\telm = this.$$(elm);\n\n\t\t\tif (isIE) {\n\t\t\t\telm.each(function(i, target) {\n\t\t\t\t\tif (target.canHaveHTML === false) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove all child nodes, IE keeps empty text nodes in DOM\n\t\t\t\t\twhile (target.firstChild) {\n\t\t\t\t\t\ttarget.removeChild(target.firstChild);\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// IE will remove comments from the beginning\n\t\t\t\t\t\t// unless you padd the contents with something\n\t\t\t\t\t\ttarget.innerHTML = '<br>' + html;\n\t\t\t\t\t\ttarget.removeChild(target.firstChild);\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// IE sometimes produces an unknown runtime error on innerHTML if it's a div inside a p\n\t\t\t\t\t\t$('<div>').html('<br>' + html).contents().slice(1).appendTo(target);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\telm.html(html);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the outer HTML of an element.\n\t\t *\n\t\t * @method getOuterHTML\n\t\t * @param {String/Element} elm Element ID or element object to get outer HTML from.\n\t\t * @return {String} Outer HTML string.\n\t\t * @example\n\t\t * tinymce.DOM.getOuterHTML(editorElement);\n\t\t * tinymce.activeEditor.getOuterHTML(tinymce.activeEditor.getBody());\n\t\t */\n\t\tgetOuterHTML: function(elm) {\n\t\t\telm = this.get(elm);\n\n\t\t\t// Older FF doesn't have outerHTML 3.6 is still used by some orgaizations\n\t\t\treturn elm.nodeType == 1 && \"outerHTML\" in elm ? elm.outerHTML : $('<div>').append($(elm).clone()).html();\n\t\t},\n\n\t\t/**\n\t\t * Sets the specified outer HTML on an element or elements.\n\t\t *\n\t\t * @method setOuterHTML\n\t\t * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set outer HTML on.\n\t\t * @param {Object} html HTML code to set as outer value for the element.\n\t\t * @example\n\t\t * // Sets the outer HTML of all paragraphs in the active editor\n\t\t * tinymce.activeEditor.dom.setOuterHTML(tinymce.activeEditor.dom.select('p'), '<div>some html</div>');\n\t\t *\n\t\t * // Sets the outer HTML of an element by id in the document\n\t\t * tinymce.DOM.setOuterHTML('mydiv', '<div>some html</div>');\n\t\t */\n\t\tsetOuterHTML: function(elm, html) {\n\t\t\tvar self = this;\n\n\t\t\tself.$$(elm).each(function() {\n\t\t\t\ttry {\n\t\t\t\t\t// Older FF doesn't have outerHTML 3.6 is still used by some organizations\n\t\t\t\t\tif (\"outerHTML\" in this) {\n\t\t\t\t\t\tthis.outerHTML = html;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Ignore\n\t\t\t\t}\n\n\t\t\t\t// OuterHTML for IE it sometimes produces an \"unknown runtime error\"\n\t\t\t\tself.remove($(this).html(html), true);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Entity decodes a string. This method decodes any HTML entities, such as &aring;.\n\t\t *\n\t\t * @method decode\n\t\t * @param {String} s String to decode entities on.\n\t\t * @return {String} Entity decoded string.\n\t\t */\n\t\tdecode: Entities.decode,\n\n\t\t/**\n\t\t * Entity encodes a string. This method encodes the most common entities, such as <>\"&.\n\t\t *\n\t\t * @method encode\n\t\t * @param {String} text String to encode with entities.\n\t\t * @return {String} Entity encoded string.\n\t\t */\n\t\tencode: Entities.encodeAllRaw,\n\n\t\t/**\n\t\t * Inserts an element after the reference element.\n\t\t *\n\t\t * @method insertAfter\n\t\t * @param {Element} node Element to insert after the reference.\n\t\t * @param {Element/String/Array} referenceNode Reference element, element id or array of elements to insert after.\n\t\t * @return {Element/Array} Element that got added or an array with elements.\n\t\t */\n\t\tinsertAfter: function(node, referenceNode) {\n\t\t\treferenceNode = this.get(referenceNode);\n\n\t\t\treturn this.run(node, function(node) {\n\t\t\t\tvar parent, nextSibling;\n\n\t\t\t\tparent = referenceNode.parentNode;\n\t\t\t\tnextSibling = referenceNode.nextSibling;\n\n\t\t\t\tif (nextSibling) {\n\t\t\t\t\tparent.insertBefore(node, nextSibling);\n\t\t\t\t} else {\n\t\t\t\t\tparent.appendChild(node);\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Replaces the specified element or elements with the new element specified. The new element will\n\t\t * be cloned if multiple input elements are passed in.\n\t\t *\n\t\t * @method replace\n\t\t * @param {Element} newElm New element to replace old ones with.\n\t\t * @param {Element/String/Array} oldElm Element DOM node, element id or array of elements or ids to replace.\n\t\t * @param {Boolean} keepChildren Optional keep children state, if set to true child nodes from the old object will be added\n\t\t * to new ones.\n\t\t */\n\t\treplace: function(newElm, oldElm, keepChildren) {\n\t\t\tvar self = this;\n\n\t\t\treturn self.run(oldElm, function(oldElm) {\n\t\t\t\tif (is(oldElm, 'array')) {\n\t\t\t\t\tnewElm = newElm.cloneNode(true);\n\t\t\t\t}\n\n\t\t\t\tif (keepChildren) {\n\t\t\t\t\teach(grep(oldElm.childNodes), function(node) {\n\t\t\t\t\t\tnewElm.appendChild(node);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn oldElm.parentNode.replaceChild(newElm, oldElm);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Renames the specified element and keeps its attributes and children.\n\t\t *\n\t\t * @method rename\n\t\t * @param {Element} elm Element to rename.\n\t\t * @param {String} name Name of the new element.\n\t\t * @return {Element} New element or the old element if it needed renaming.\n\t\t */\n\t\trename: function(elm, name) {\n\t\t\tvar self = this, newElm;\n\n\t\t\tif (elm.nodeName != name.toUpperCase()) {\n\t\t\t\t// Rename block element\n\t\t\t\tnewElm = self.create(name);\n\n\t\t\t\t// Copy attribs to new block\n\t\t\t\teach(self.getAttribs(elm), function(attrNode) {\n\t\t\t\t\tself.setAttrib(newElm, attrNode.nodeName, self.getAttrib(elm, attrNode.nodeName));\n\t\t\t\t});\n\n\t\t\t\t// Replace block\n\t\t\t\tself.replace(newElm, elm, 1);\n\t\t\t}\n\n\t\t\treturn newElm || elm;\n\t\t},\n\n\t\t/**\n\t\t * Find the common ancestor of two elements. This is a shorter method than using the DOM Range logic.\n\t\t *\n\t\t * @method findCommonAncestor\n\t\t * @param {Element} a Element to find common ancestor of.\n\t\t * @param {Element} b Element to find common ancestor of.\n\t\t * @return {Element} Common ancestor element of the two input elements.\n\t\t */\n\t\tfindCommonAncestor: function(a, b) {\n\t\t\tvar ps = a, pe;\n\n\t\t\twhile (ps) {\n\t\t\t\tpe = b;\n\n\t\t\t\twhile (pe && ps != pe) {\n\t\t\t\t\tpe = pe.parentNode;\n\t\t\t\t}\n\n\t\t\t\tif (ps == pe) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tps = ps.parentNode;\n\t\t\t}\n\n\t\t\tif (!ps && a.ownerDocument) {\n\t\t\t\treturn a.ownerDocument.documentElement;\n\t\t\t}\n\n\t\t\treturn ps;\n\t\t},\n\n\t\t/**\n\t\t * Parses the specified RGB color value and returns a hex version of that color.\n\t\t *\n\t\t * @method toHex\n\t\t * @param {String} rgbVal RGB string value like rgb(1,2,3)\n\t\t * @return {String} Hex version of that RGB value like #FF00FF.\n\t\t */\n\t\ttoHex: function(rgbVal) {\n\t\t\treturn this.styles.toHex(Tools.trim(rgbVal));\n\t\t},\n\n\t\t/**\n\t\t * Executes the specified function on the element by id or dom element node or array of elements/id.\n\t\t *\n\t\t * @method run\n\t\t * @param {String/Element/Array} elm ID or DOM element object or array with ids or elements.\n\t\t * @param {function} func Function to execute for each item.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t * @return {Object/Array} Single object, or an array of objects if multiple input elements were passed in.\n\t\t */\n\t\trun: function(elm, func, scope) {\n\t\t\tvar self = this, result;\n\n\t\t\tif (typeof elm === 'string') {\n\t\t\t\telm = self.get(elm);\n\t\t\t}\n\n\t\t\tif (!elm) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tscope = scope || this;\n\t\t\tif (!elm.nodeType && (elm.length || elm.length === 0)) {\n\t\t\t\tresult = [];\n\n\t\t\t\teach(elm, function(elm, i) {\n\t\t\t\t\tif (elm) {\n\t\t\t\t\t\tif (typeof elm == 'string') {\n\t\t\t\t\t\t\telm = self.get(elm);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult.push(func.call(scope, elm, i));\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\treturn func.call(scope, elm);\n\t\t},\n\n\t\t/**\n\t\t * Returns a NodeList with attributes for the element.\n\t\t *\n\t\t * @method getAttribs\n\t\t * @param {HTMLElement/string} elm Element node or string id to get attributes from.\n\t\t * @return {NodeList} NodeList with attributes.\n\t\t */\n\t\tgetAttribs: function(elm) {\n\t\t\tvar attrs;\n\n\t\t\telm = this.get(elm);\n\n\t\t\tif (!elm) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tif (isIE) {\n\t\t\t\tattrs = [];\n\n\t\t\t\t// Object will throw exception in IE\n\t\t\t\tif (elm.nodeName == 'OBJECT') {\n\t\t\t\t\treturn elm.attributes;\n\t\t\t\t}\n\n\t\t\t\t// IE doesn't keep the selected attribute if you clone option elements\n\t\t\t\tif (elm.nodeName === 'OPTION' && this.getAttrib(elm, 'selected')) {\n\t\t\t\t\tattrs.push({specified: 1, nodeName: 'selected'});\n\t\t\t\t}\n\n\t\t\t\t// It's crazy that this is faster in IE but it's because it returns all attributes all the time\n\t\t\t\tvar attrRegExp = /<\\/?[\\w:\\-]+ ?|=[\\\"][^\\\"]+\\\"|=\\'[^\\']+\\'|=[\\w\\-]+|>/gi;\n\t\t\t\telm.cloneNode(false).outerHTML.replace(attrRegExp, '').replace(/[\\w:\\-]+/gi, function(a) {\n\t\t\t\t\tattrs.push({specified: 1, nodeName: a});\n\t\t\t\t});\n\n\t\t\t\treturn attrs;\n\t\t\t}\n\n\t\t\treturn elm.attributes;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the specified node is to be considered empty or not.\n\t\t *\n\t\t * @example\n\t\t * tinymce.DOM.isEmpty(node, {img: true});\n\t\t * @method isEmpty\n\t\t * @param {Object} elements Optional name/value object with elements that are automatically treated as non-empty elements.\n\t\t * @return {Boolean} true/false if the node is empty or not.\n\t\t */\n\t\tisEmpty: function(node, elements) {\n\t\t\tvar self = this, i, attributes, type, walker, name, brCount = 0;\n\n\t\t\tnode = node.firstChild;\n\t\t\tif (node) {\n\t\t\t\twalker = new TreeWalker(node, node.parentNode);\n\t\t\t\telements = elements || (self.schema ? self.schema.getNonEmptyElements() : null);\n\n\t\t\t\tdo {\n\t\t\t\t\ttype = node.nodeType;\n\n\t\t\t\t\tif (type === 1) {\n\t\t\t\t\t\t// Ignore bogus elements\n\t\t\t\t\t\tif (node.getAttribute('data-mce-bogus')) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Keep empty elements like <img />\n\t\t\t\t\t\tname = node.nodeName.toLowerCase();\n\t\t\t\t\t\tif (elements && elements[name]) {\n\t\t\t\t\t\t\t// Ignore single BR elements in blocks like <p><br /></p> or <p><span><br /></span></p>\n\t\t\t\t\t\t\tif (name === 'br') {\n\t\t\t\t\t\t\t\tbrCount++;\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Keep elements with data-bookmark attributes or name attribute like <a name=\"1\"></a>\n\t\t\t\t\t\tattributes = self.getAttribs(node);\n\t\t\t\t\t\ti = attributes.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tname = attributes[i].nodeName;\n\t\t\t\t\t\t\tif (name === \"name\" || name === 'data-mce-bookmark') {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Keep comment nodes\n\t\t\t\t\tif (type == 8) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Keep non whitespace text nodes\n\t\t\t\t\tif ((type === 3 && !whiteSpaceRegExp.test(node.nodeValue))) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} while ((node = walker.next()));\n\t\t\t}\n\n\t\t\treturn brCount <= 1;\n\t\t},\n\n\t\t/**\n\t\t * Creates a new DOM Range object. This will use the native DOM Range API if it's\n\t\t * available. If it's not, it will fall back to the custom TinyMCE implementation.\n\t\t *\n\t\t * @method createRng\n\t\t * @return {DOMRange} DOM Range object.\n\t\t * @example\n\t\t * var rng = tinymce.DOM.createRng();\n\t\t * alert(rng.startContainer + \",\" + rng.startOffset);\n\t\t */\n\t\tcreateRng: function() {\n\t\t\tvar doc = this.doc;\n\n\t\t\treturn doc.createRange ? doc.createRange() : new Range(this);\n\t\t},\n\n\t\t/**\n\t\t * Returns the index of the specified node within its parent.\n\t\t *\n\t\t * @method nodeIndex\n\t\t * @param {Node} node Node to look for.\n\t\t * @param {boolean} normalized Optional true/false state if the index is what it would be after a normalization.\n\t\t * @return {Number} Index of the specified node.\n\t\t */\n\t\tnodeIndex: nodeIndex,\n\n\t\t/**\n\t\t * Splits an element into two new elements and places the specified split\n\t\t * element or elements between the new ones. For example splitting the paragraph at the bold element in\n\t\t * this example <p>abc<b>abc</b>123</p> would produce <p>abc</p><b>abc</b><p>123</p>.\n\t\t *\n\t\t * @method split\n\t\t * @param {Element} parentElm Parent element to split.\n\t\t * @param {Element} splitElm Element to split at.\n\t\t * @param {Element} replacementElm Optional replacement element to replace the split element with.\n\t\t * @return {Element} Returns the split element or the replacement element if that is specified.\n\t\t */\n\t\tsplit: function(parentElm, splitElm, replacementElm) {\n\t\t\tvar self = this, r = self.createRng(), bef, aft, pa;\n\n\t\t\t// W3C valid browsers tend to leave empty nodes to the left/right side of the contents - this makes sense\n\t\t\t// but we don't want that in our code since it serves no purpose for the end user\n\t\t\t// For example splitting this html at the bold element:\n\t\t\t//   <p>text 1<span><b>CHOP</b></span>text 2</p>\n\t\t\t// would produce:\n\t\t\t//   <p>text 1<span></span></p><b>CHOP</b><p><span></span>text 2</p>\n\t\t\t// this function will then trim off empty edges and produce:\n\t\t\t//   <p>text 1</p><b>CHOP</b><p>text 2</p>\n\t\t\tfunction trimNode(node) {\n\t\t\t\tvar i, children = node.childNodes, type = node.nodeType;\n\n\t\t\t\tfunction surroundedBySpans(node) {\n\t\t\t\t\tvar previousIsSpan = node.previousSibling && node.previousSibling.nodeName == 'SPAN';\n\t\t\t\t\tvar nextIsSpan = node.nextSibling && node.nextSibling.nodeName == 'SPAN';\n\t\t\t\t\treturn previousIsSpan && nextIsSpan;\n\t\t\t\t}\n\n\t\t\t\tif (type == 1 && node.getAttribute('data-mce-type') == 'bookmark') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfor (i = children.length - 1; i >= 0; i--) {\n\t\t\t\t\ttrimNode(children[i]);\n\t\t\t\t}\n\n\t\t\t\tif (type != 9) {\n\t\t\t\t\t// Keep non whitespace text nodes\n\t\t\t\t\tif (type == 3 && node.nodeValue.length > 0) {\n\t\t\t\t\t\t// If parent element isn't a block or there isn't any useful contents for example \"<p>   </p>\"\n\t\t\t\t\t\t// Also keep text nodes with only spaces if surrounded by spans.\n\t\t\t\t\t\t// eg. \"<p><span>a</span> <span>b</span></p>\" should keep space between a and b\n\t\t\t\t\t\tvar trimmedLength = trim(node.nodeValue).length;\n\t\t\t\t\t\tif (!self.isBlock(node.parentNode) || trimmedLength > 0 || trimmedLength === 0 && surroundedBySpans(node)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (type == 1) {\n\t\t\t\t\t\t// If the only child is a bookmark then move it up\n\t\t\t\t\t\tchildren = node.childNodes;\n\n\t\t\t\t\t\t// TODO fix this complex if\n\t\t\t\t\t\tif (children.length == 1 && children[0] && children[0].nodeType == 1 &&\n\t\t\t\t\t\t\tchildren[0].getAttribute('data-mce-type') == 'bookmark') {\n\t\t\t\t\t\t\tnode.parentNode.insertBefore(children[0], node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Keep non empty elements or img, hr etc\n\t\t\t\t\t\tif (children.length || /^(br|hr|input|img)$/i.test(node.nodeName)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tself.remove(node);\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tif (parentElm && splitElm) {\n\t\t\t\t// Get before chunk\n\t\t\t\tr.setStart(parentElm.parentNode, self.nodeIndex(parentElm));\n\t\t\t\tr.setEnd(splitElm.parentNode, self.nodeIndex(splitElm));\n\t\t\t\tbef = r.extractContents();\n\n\t\t\t\t// Get after chunk\n\t\t\t\tr = self.createRng();\n\t\t\t\tr.setStart(splitElm.parentNode, self.nodeIndex(splitElm) + 1);\n\t\t\t\tr.setEnd(parentElm.parentNode, self.nodeIndex(parentElm) + 1);\n\t\t\t\taft = r.extractContents();\n\n\t\t\t\t// Insert before chunk\n\t\t\t\tpa = parentElm.parentNode;\n\t\t\t\tpa.insertBefore(trimNode(bef), parentElm);\n\n\t\t\t\t// Insert middle chunk\n\t\t\t\tif (replacementElm) {\n\t\t\t\t\tpa.insertBefore(replacementElm, parentElm);\n\t\t\t\t\t//pa.replaceChild(replacementElm, splitElm);\n\t\t\t\t} else {\n\t\t\t\t\tpa.insertBefore(splitElm, parentElm);\n\t\t\t\t}\n\n\t\t\t\t// Insert after chunk\n\t\t\t\tpa.insertBefore(trimNode(aft), parentElm);\n\t\t\t\tself.remove(parentElm);\n\n\t\t\t\treturn replacementElm || splitElm;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Adds an event handler to the specified object.\n\t\t *\n\t\t * @method bind\n\t\t * @param {Element/Document/Window/Array} target Target element to bind events to.\n\t\t * handler to or an array of elements/ids/documents.\n\t\t * @param {String} name Name of event handler to add, for example: click.\n\t\t * @param {function} func Function to execute when the event occurs.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t * @return {function} Function callback handler the same as the one passed in.\n\t\t */\n\t\tbind: function(target, name, func, scope) {\n\t\t\tvar self = this;\n\n\t\t\tif (Tools.isArray(target)) {\n\t\t\t\tvar i = target.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\ttarget[i] = self.bind(target[i], name, func, scope);\n\t\t\t\t}\n\n\t\t\t\treturn target;\n\t\t\t}\n\n\t\t\t// Collect all window/document events bound by editor instance\n\t\t\tif (self.settings.collect && (target === self.doc || target === self.win)) {\n\t\t\t\tself.boundEvents.push([target, name, func, scope]);\n\t\t\t}\n\n\t\t\treturn self.events.bind(target, name, func, scope || self);\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified event handler by name and function from an element or collection of elements.\n\t\t *\n\t\t * @method unbind\n\t\t * @param {Element/Document/Window/Array} target Target element to unbind events on.\n\t\t * @param {String} name Event handler name, for example: \"click\"\n\t\t * @param {function} func Function to remove.\n\t\t * @return {bool/Array} Bool state of true if the handler was removed, or an array of states if multiple input elements\n\t\t * were passed in.\n\t\t */\n\t\tunbind: function(target, name, func) {\n\t\t\tvar self = this, i;\n\n\t\t\tif (Tools.isArray(target)) {\n\t\t\t\ti = target.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\ttarget[i] = self.unbind(target[i], name, func);\n\t\t\t\t}\n\n\t\t\t\treturn target;\n\t\t\t}\n\n\t\t\t// Remove any bound events matching the input\n\t\t\tif (self.boundEvents && (target === self.doc || target === self.win)) {\n\t\t\t\ti = self.boundEvents.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tvar item = self.boundEvents[i];\n\n\t\t\t\t\tif (target == item[0] && (!name || name == item[1]) && (!func || func == item[2])) {\n\t\t\t\t\t\tthis.events.unbind(item[0], item[1], item[2]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this.events.unbind(target, name, func);\n\t\t},\n\n\t\t/**\n\t\t * Fires the specified event name with object on target.\n\t\t *\n\t\t * @method fire\n\t\t * @param {Node/Document/Window} target Target element or object to fire event on.\n\t\t * @param {String} name Name of the event to fire.\n\t\t * @param {Object} evt Event object to send.\n\t\t * @return {Event} Event object.\n\t\t */\n\t\tfire: function(target, name, evt) {\n\t\t\treturn this.events.fire(target, name, evt);\n\t\t},\n\n\t\t// Returns the content editable state of a node\n\t\tgetContentEditable: function(node) {\n\t\t\tvar contentEditable;\n\n\t\t\t// Check type\n\t\t\tif (!node || node.nodeType != 1) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Check for fake content editable\n\t\t\tcontentEditable = node.getAttribute(\"data-mce-contenteditable\");\n\t\t\tif (contentEditable && contentEditable !== \"inherit\") {\n\t\t\t\treturn contentEditable;\n\t\t\t}\n\n\t\t\t// Check for real content editable\n\t\t\treturn node.contentEditable !== \"inherit\" ? node.contentEditable : null;\n\t\t},\n\n\t\tgetContentEditableParent: function(node) {\n\t\t\tvar root = this.getRoot(), state = null;\n\n\t\t\tfor (; node && node !== root; node = node.parentNode) {\n\t\t\t\tstate = this.getContentEditable(node);\n\n\t\t\t\tif (state !== null) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn state;\n\t\t},\n\n\t\t/**\n\t\t * Destroys all internal references to the DOM to solve IE leak issues.\n\t\t *\n\t\t * @method destroy\n\t\t */\n\t\tdestroy: function() {\n\t\t\tvar self = this;\n\n\t\t\t// Unbind all events bound to window/document by editor instance\n\t\t\tif (self.boundEvents) {\n\t\t\t\tvar i = self.boundEvents.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tvar item = self.boundEvents[i];\n\t\t\t\t\tthis.events.unbind(item[0], item[1], item[2]);\n\t\t\t\t}\n\n\t\t\t\tself.boundEvents = null;\n\t\t\t}\n\n\t\t\t// Restore sizzle document to window.document\n\t\t\t// Since the current document might be removed producing \"Permission denied\" on IE see #6325\n\t\t\tif (Sizzle.setDocument) {\n\t\t\t\tSizzle.setDocument();\n\t\t\t}\n\n\t\t\tself.win = self.doc = self.root = self.events = self.frag = null;\n\t\t},\n\n\t\tisChildOf: function(node, parent) {\n\t\t\twhile (node) {\n\t\t\t\tif (parent === node) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t// #ifdef debug\n\n\t\tdumpRng: function(r) {\n\t\t\treturn (\n\t\t\t\t'startContainer: ' + r.startContainer.nodeName +\n\t\t\t\t', startOffset: ' + r.startOffset +\n\t\t\t\t', endContainer: ' + r.endContainer.nodeName +\n\t\t\t\t', endOffset: ' + r.endOffset\n\t\t\t);\n\t\t},\n\n\t\t// #endif\n\n\t\t_findSib: function(node, selector, name) {\n\t\t\tvar self = this, func = selector;\n\n\t\t\tif (node) {\n\t\t\t\t// If expression make a function of it using is\n\t\t\t\tif (typeof func == 'string') {\n\t\t\t\t\tfunc = function(node) {\n\t\t\t\t\t\treturn self.is(node, selector);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Loop all siblings\n\t\t\t\tfor (node = node[name]; node; node = node[name]) {\n\t\t\t\t\tif (func(node)) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\t};\n\n\t/**\n\t * Instance of DOMUtils for the current document.\n\t *\n\t * @static\n\t * @property DOM\n\t * @type tinymce.dom.DOMUtils\n\t * @example\n\t * // Example of how to add a class to some element by id\n\t * tinymce.DOM.addClass('someid', 'someclass');\n\t */\n\tDOMUtils.DOM = new DOMUtils(document);\n\tDOMUtils.nodeIndex = nodeIndex;\n\n\treturn DOMUtils;\n});\n\n// Included from: js/tinymce/classes/dom/ScriptLoader.js\n\n/**\n * ScriptLoader.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*globals console*/\n\n/**\n * This class handles asynchronous/synchronous loading of JavaScript files it will execute callbacks\n * when various items gets loaded. This class is useful to load external JavaScript files.\n *\n * @class tinymce.dom.ScriptLoader\n * @example\n * // Load a script from a specific URL using the global script loader\n * tinymce.ScriptLoader.load('somescript.js');\n *\n * // Load a script using a unique instance of the script loader\n * var scriptLoader = new tinymce.dom.ScriptLoader();\n *\n * scriptLoader.load('somescript.js');\n *\n * // Load multiple scripts\n * var scriptLoader = new tinymce.dom.ScriptLoader();\n *\n * scriptLoader.add('somescript1.js');\n * scriptLoader.add('somescript2.js');\n * scriptLoader.add('somescript3.js');\n *\n * scriptLoader.loadQueue(function() {\n *    alert('All scripts are now loaded.');\n * });\n */\ndefine(\"tinymce/dom/ScriptLoader\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/util/Tools\"\n], function(DOMUtils, Tools) {\n\tvar DOM = DOMUtils.DOM;\n\tvar each = Tools.each, grep = Tools.grep;\n\n\tfunction ScriptLoader() {\n\t\tvar QUEUED = 0,\n\t\t\tLOADING = 1,\n\t\t\tLOADED = 2,\n\t\t\tstates = {},\n\t\t\tqueue = [],\n\t\t\tscriptLoadedCallbacks = {},\n\t\t\tqueueLoadedCallbacks = [],\n\t\t\tloading = 0,\n\t\t\tundef;\n\n\t\t/**\n\t\t * Loads a specific script directly without adding it to the load queue.\n\t\t *\n\t\t * @method load\n\t\t * @param {String} url Absolute URL to script to add.\n\t\t * @param {function} callback Optional callback function to execute ones this script gets loaded.\n\t\t */\n\t\tfunction loadScript(url, callback) {\n\t\t\tvar dom = DOM, elm, id;\n\n\t\t\t// Execute callback when script is loaded\n\t\t\tfunction done() {\n\t\t\t\tdom.remove(id);\n\n\t\t\t\tif (elm) {\n\t\t\t\t\telm.onreadystatechange = elm.onload = elm = null;\n\t\t\t\t}\n\n\t\t\t\tcallback();\n\t\t\t}\n\n\t\t\tfunction error() {\n\t\t\t\t/*eslint no-console:0 */\n\n\t\t\t\t// Report the error so it's easier for people to spot loading errors\n\t\t\t\tif (typeof console !== \"undefined\" && console.log) {\n\t\t\t\t\tconsole.log(\"Failed to load: \" + url);\n\t\t\t\t}\n\n\t\t\t\t// We can't mark it as done if there is a load error since\n\t\t\t\t// A) We don't want to produce 404 errors on the server and\n\t\t\t\t// B) the onerror event won't fire on all browsers.\n\t\t\t\t// done();\n\t\t\t}\n\n\t\t\tid = dom.uniqueId();\n\n\t\t\t// Create new script element\n\t\t\telm = document.createElement('script');\n\t\t\telm.id = id;\n\t\t\telm.type = 'text/javascript';\n\t\t\telm.src = Tools._addCacheSuffix(url);\n\n\t\t\t// Seems that onreadystatechange works better on IE 10 onload seems to fire incorrectly\n\t\t\tif (\"onreadystatechange\" in elm) {\n\t\t\t\telm.onreadystatechange = function() {\n\t\t\t\t\tif (/loaded|complete/.test(elm.readyState)) {\n\t\t\t\t\t\tdone();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\telm.onload = done;\n\t\t\t}\n\n\t\t\t// Add onerror event will get fired on some browsers but not all of them\n\t\t\telm.onerror = error;\n\n\t\t\t// Add script to document\n\t\t\t(document.getElementsByTagName('head')[0] || document.body).appendChild(elm);\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if a script has been loaded or not.\n\t\t *\n\t\t * @method isDone\n\t\t * @param {String} url URL to check for.\n\t\t * @return {Boolean} true/false if the URL is loaded.\n\t\t */\n\t\tthis.isDone = function(url) {\n\t\t\treturn states[url] == LOADED;\n\t\t};\n\n\t\t/**\n\t\t * Marks a specific script to be loaded. This can be useful if a script got loaded outside\n\t\t * the script loader or to skip it from loading some script.\n\t\t *\n\t\t * @method markDone\n\t\t * @param {string} url Absolute URL to the script to mark as loaded.\n\t\t */\n\t\tthis.markDone = function(url) {\n\t\t\tstates[url] = LOADED;\n\t\t};\n\n\t\t/**\n\t\t * Adds a specific script to the load queue of the script loader.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} url Absolute URL to script to add.\n\t\t * @param {function} callback Optional callback function to execute ones this script gets loaded.\n\t\t * @param {Object} scope Optional scope to execute callback in.\n\t\t */\n\t\tthis.add = this.load = function(url, callback, scope) {\n\t\t\tvar state = states[url];\n\n\t\t\t// Add url to load queue\n\t\t\tif (state == undef) {\n\t\t\t\tqueue.push(url);\n\t\t\t\tstates[url] = QUEUED;\n\t\t\t}\n\n\t\t\tif (callback) {\n\t\t\t\t// Store away callback for later execution\n\t\t\t\tif (!scriptLoadedCallbacks[url]) {\n\t\t\t\t\tscriptLoadedCallbacks[url] = [];\n\t\t\t\t}\n\n\t\t\t\tscriptLoadedCallbacks[url].push({\n\t\t\t\t\tfunc: callback,\n\t\t\t\t\tscope: scope || this\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tthis.remove = function(url) {\n\t\t\tdelete states[url];\n\t\t\tdelete scriptLoadedCallbacks[url];\n\t\t};\n\n\t\t/**\n\t\t * Starts the loading of the queue.\n\t\t *\n\t\t * @method loadQueue\n\t\t * @param {function} callback Optional callback to execute when all queued items are loaded.\n\t\t * @param {Object} scope Optional scope to execute the callback in.\n\t\t */\n\t\tthis.loadQueue = function(callback, scope) {\n\t\t\tthis.loadScripts(queue, callback, scope);\n\t\t};\n\n\t\t/**\n\t\t * Loads the specified queue of files and executes the callback ones they are loaded.\n\t\t * This method is generally not used outside this class but it might be useful in some scenarios.\n\t\t *\n\t\t * @method loadScripts\n\t\t * @param {Array} scripts Array of queue items to load.\n\t\t * @param {function} callback Optional callback to execute ones all items are loaded.\n\t\t * @param {Object} scope Optional scope to execute callback in.\n\t\t */\n\t\tthis.loadScripts = function(scripts, callback, scope) {\n\t\t\tvar loadScripts;\n\n\t\t\tfunction execScriptLoadedCallbacks(url) {\n\t\t\t\t// Execute URL callback functions\n\t\t\t\teach(scriptLoadedCallbacks[url], function(callback) {\n\t\t\t\t\tcallback.func.call(callback.scope);\n\t\t\t\t});\n\n\t\t\t\tscriptLoadedCallbacks[url] = undef;\n\t\t\t}\n\n\t\t\tqueueLoadedCallbacks.push({\n\t\t\t\tfunc: callback,\n\t\t\t\tscope: scope || this\n\t\t\t});\n\n\t\t\tloadScripts = function() {\n\t\t\t\tvar loadingScripts = grep(scripts);\n\n\t\t\t\t// Current scripts has been handled\n\t\t\t\tscripts.length = 0;\n\n\t\t\t\t// Load scripts that needs to be loaded\n\t\t\t\teach(loadingScripts, function(url) {\n\t\t\t\t\t// Script is already loaded then execute script callbacks directly\n\t\t\t\t\tif (states[url] == LOADED) {\n\t\t\t\t\t\texecScriptLoadedCallbacks(url);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Is script not loading then start loading it\n\t\t\t\t\tif (states[url] != LOADING) {\n\t\t\t\t\t\tstates[url] = LOADING;\n\t\t\t\t\t\tloading++;\n\n\t\t\t\t\t\tloadScript(url, function() {\n\t\t\t\t\t\t\tstates[url] = LOADED;\n\t\t\t\t\t\t\tloading--;\n\n\t\t\t\t\t\t\texecScriptLoadedCallbacks(url);\n\n\t\t\t\t\t\t\t// Load more scripts if they where added by the recently loaded script\n\t\t\t\t\t\t\tloadScripts();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// No scripts are currently loading then execute all pending queue loaded callbacks\n\t\t\t\tif (!loading) {\n\t\t\t\t\teach(queueLoadedCallbacks, function(callback) {\n\t\t\t\t\t\tcallback.func.call(callback.scope);\n\t\t\t\t\t});\n\n\t\t\t\t\tqueueLoadedCallbacks.length = 0;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tloadScripts();\n\t\t};\n\t}\n\n\tScriptLoader.ScriptLoader = new ScriptLoader();\n\n\treturn ScriptLoader;\n});\n\n// Included from: js/tinymce/classes/AddOnManager.js\n\n/**\n * AddOnManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles the loading of themes/plugins or other add-ons and their language packs.\n *\n * @class tinymce.AddOnManager\n */\ndefine(\"tinymce/AddOnManager\", [\n\t\"tinymce/dom/ScriptLoader\",\n\t\"tinymce/util/Tools\"\n], function(ScriptLoader, Tools) {\n\tvar each = Tools.each;\n\n\tfunction AddOnManager() {\n\t\tvar self = this;\n\n\t\tself.items = [];\n\t\tself.urls = {};\n\t\tself.lookup = {};\n\t}\n\n\tAddOnManager.prototype = {\n\t\t/**\n\t\t * Returns the specified add on by the short name.\n\t\t *\n\t\t * @method get\n\t\t * @param {String} name Add-on to look for.\n\t\t * @return {tinymce.Theme/tinymce.Plugin} Theme or plugin add-on instance or undefined.\n\t\t */\n\t\tget: function(name) {\n\t\t\tif (this.lookup[name]) {\n\t\t\t\treturn this.lookup[name].instance;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t},\n\n\t\tdependencies: function(name) {\n\t\t\tvar result;\n\n\t\t\tif (this.lookup[name]) {\n\t\t\t\tresult = this.lookup[name].dependencies;\n\t\t\t}\n\n\t\t\treturn result || [];\n\t\t},\n\n\t\t/**\n\t\t * Loads a language pack for the specified add-on.\n\t\t *\n\t\t * @method requireLangPack\n\t\t * @param {String} name Short name of the add-on.\n\t\t * @param {String} languages Optional comma or space separated list of languages to check if it matches the name.\n\t\t */\n\t\trequireLangPack: function(name, languages) {\n\t\t\tvar language = AddOnManager.language;\n\n\t\t\tif (language && AddOnManager.languageLoad !== false) {\n\t\t\t\tif (languages) {\n\t\t\t\t\tlanguages = ',' + languages + ',';\n\n\t\t\t\t\t// Load short form sv.js or long form sv_SE.js\n\t\t\t\t\tif (languages.indexOf(',' + language.substr(0, 2) + ',') != -1) {\n\t\t\t\t\t\tlanguage = language.substr(0, 2);\n\t\t\t\t\t} else if (languages.indexOf(',' + language + ',') == -1) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tScriptLoader.ScriptLoader.add(this.urls[name] + '/langs/' + language + '.js');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Adds a instance of the add-on by it's short name.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} id Short name/id for the add-on.\n\t\t * @param {tinymce.Theme/tinymce.Plugin} addOn Theme or plugin to add.\n\t\t * @return {tinymce.Theme/tinymce.Plugin} The same theme or plugin instance that got passed in.\n\t\t * @example\n\t\t * // Create a simple plugin\n\t\t * tinymce.create('tinymce.plugins.TestPlugin', {\n\t\t *   TestPlugin: function(ed, url) {\n\t\t *   ed.on('click', function(e) {\n\t\t *      ed.windowManager.alert('Hello World!');\n\t\t *   });\n\t\t *   }\n\t\t * });\n\t\t *\n\t\t * // Register plugin using the add method\n\t\t * tinymce.PluginManager.add('test', tinymce.plugins.TestPlugin);\n\t\t *\n\t\t * // Initialize TinyMCE\n\t\t * tinymce.init({\n\t\t *  ...\n\t\t *  plugins: '-test' // Init the plugin but don't try to load it\n\t\t * });\n\t\t */\n\t\tadd: function(id, addOn, dependencies) {\n\t\t\tthis.items.push(addOn);\n\t\t\tthis.lookup[id] = {instance: addOn, dependencies: dependencies};\n\n\t\t\treturn addOn;\n\t\t},\n\n\t\tremove: function(name) {\n\t\t\tdelete this.urls[name];\n\t\t\tdelete this.lookup[name];\n\t\t},\n\n\t\tcreateUrl: function(baseUrl, dep) {\n\t\t\tif (typeof dep === \"object\") {\n\t\t\t\treturn dep;\n\t\t\t}\n\n\t\t\treturn {prefix: baseUrl.prefix, resource: dep, suffix: baseUrl.suffix};\n\t\t},\n\n\t\t/**\n\t\t * Add a set of components that will make up the add-on. Using the url of the add-on name as the base url.\n\t\t * This should be used in development mode.  A new compressor/javascript munger process will ensure that the\n\t\t * components are put together into the plugin.js file and compressed correctly.\n\t\t *\n\t\t * @method addComponents\n\t\t * @param {String} pluginName name of the plugin to load scripts from (will be used to get the base url for the plugins).\n\t\t * @param {Array} scripts Array containing the names of the scripts to load.\n\t\t */\n\t\taddComponents: function(pluginName, scripts) {\n\t\t\tvar pluginUrl = this.urls[pluginName];\n\n\t\t\teach(scripts, function(script) {\n\t\t\t\tScriptLoader.ScriptLoader.add(pluginUrl + \"/\" + script);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Loads an add-on from a specific url.\n\t\t *\n\t\t * @method load\n\t\t * @param {String} name Short name of the add-on that gets loaded.\n\t\t * @param {String} addOnUrl URL to the add-on that will get loaded.\n\t\t * @param {function} callback Optional callback to execute ones the add-on is loaded.\n\t\t * @param {Object} scope Optional scope to execute the callback in.\n\t\t * @example\n\t\t * // Loads a plugin from an external URL\n\t\t * tinymce.PluginManager.load('myplugin', '/some/dir/someplugin/plugin.js');\n\t\t *\n\t\t * // Initialize TinyMCE\n\t\t * tinymce.init({\n\t\t *  ...\n\t\t *  plugins: '-myplugin' // Don't try to load it again\n\t\t * });\n\t\t */\n\t\tload: function(name, addOnUrl, callback, scope) {\n\t\t\tvar self = this, url = addOnUrl;\n\n\t\t\tfunction loadDependencies() {\n\t\t\t\tvar dependencies = self.dependencies(name);\n\n\t\t\t\teach(dependencies, function(dep) {\n\t\t\t\t\tvar newUrl = self.createUrl(addOnUrl, dep);\n\n\t\t\t\t\tself.load(newUrl.resource, newUrl, undefined, undefined);\n\t\t\t\t});\n\n\t\t\t\tif (callback) {\n\t\t\t\t\tif (scope) {\n\t\t\t\t\t\tcallback.call(scope);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback.call(ScriptLoader);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (self.urls[name]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (typeof addOnUrl === \"object\") {\n\t\t\t\turl = addOnUrl.prefix + addOnUrl.resource + addOnUrl.suffix;\n\t\t\t}\n\n\t\t\tif (url.indexOf('/') !== 0 && url.indexOf('://') == -1) {\n\t\t\t\turl = AddOnManager.baseURL + '/' + url;\n\t\t\t}\n\n\t\t\tself.urls[name] = url.substring(0, url.lastIndexOf('/'));\n\n\t\t\tif (self.lookup[name]) {\n\t\t\t\tloadDependencies();\n\t\t\t} else {\n\t\t\t\tScriptLoader.ScriptLoader.add(url, loadDependencies, scope);\n\t\t\t}\n\t\t}\n\t};\n\n\tAddOnManager.PluginManager = new AddOnManager();\n\tAddOnManager.ThemeManager = new AddOnManager();\n\n\treturn AddOnManager;\n});\n\n/**\n * TinyMCE theme class.\n *\n * @class tinymce.Theme\n */\n\n/**\n * This method is responsible for rendering/generating the overall user interface with toolbars, buttons, iframe containers etc.\n *\n * @method renderUI\n * @param {Object} obj Object parameter containing the targetNode DOM node that will be replaced visually with an editor instance.\n * @return {Object} an object with items like iframeContainer, editorContainer, sizeContainer, deltaWidth, deltaHeight.\n */\n\n/**\n * Plugin base class, this is a pseudo class that describes how a plugin is to be created for TinyMCE. The methods below are all optional.\n *\n * @class tinymce.Plugin\n * @example\n * tinymce.PluginManager.add('example', function(editor, url) {\n *     // Add a button that opens a window\n *     editor.addButton('example', {\n *         text: 'My button',\n *         icon: false,\n *         onclick: function() {\n *             // Open window\n *             editor.windowManager.open({\n *                 title: 'Example plugin',\n *                 body: [\n *                     {type: 'textbox', name: 'title', label: 'Title'}\n *                 ],\n *                 onsubmit: function(e) {\n *                     // Insert content when the window form is submitted\n *                     editor.insertContent('Title: ' + e.data.title);\n *                 }\n *             });\n *         }\n *     });\n *\n *     // Adds a menu item to the tools menu\n *     editor.addMenuItem('example', {\n *         text: 'Example plugin',\n *         context: 'tools',\n *         onclick: function() {\n *             // Open window with a specific url\n *             editor.windowManager.open({\n *                 title: 'TinyMCE site',\n *                 url: 'http://www.tinymce.com',\n *                 width: 800,\n *                 height: 600,\n *                 buttons: [{\n *                     text: 'Close',\n *                     onclick: 'close'\n *                 }]\n *             });\n *         }\n *     });\n * });\n */\n\n// Included from: js/tinymce/classes/dom/NodeType.js\n\n/**\n * NodeType.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Contains various node validation functions.\n *\n * @private\n * @class tinymce.dom.NodeType\n */\ndefine(\"tinymce/dom/NodeType\", [], function() {\n\tfunction isNodeType(type) {\n\t\treturn function(node) {\n\t\t\treturn !!node && node.nodeType == type;\n\t\t};\n\t}\n\n\tvar isElement = isNodeType(1);\n\n\tfunction matchNodeNames(names) {\n\t\tnames = names.toLowerCase().split(' ');\n\n\t\treturn function(node) {\n\t\t\tvar i, name;\n\n\t\t\tif (node && node.nodeType) {\n\t\t\t\tname = node.nodeName.toLowerCase();\n\n\t\t\t\tfor (i = 0; i < names.length; i++) {\n\t\t\t\t\tif (name === names[i]) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t}\n\n\tfunction matchStyleValues(name, values) {\n\t\tvalues = values.toLowerCase().split(' ');\n\n\t\treturn function(node) {\n\t\t\tvar i, cssValue;\n\n\t\t\tif (isElement(node)) {\n\t\t\t\tfor (i = 0; i < values.length; i++) {\n\t\t\t\t\tcssValue = getComputedStyle(node, null).getPropertyValue(name);\n\t\t\t\t\tif (cssValue === values[i]) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t}\n\n\tfunction hasPropValue(propName, propValue) {\n\t\treturn function(node) {\n\t\t\treturn isElement(node) && node[propName] === propValue;\n\t\t};\n\t}\n\n\tfunction hasAttributeValue(attrName, attrValue) {\n\t\treturn function(node) {\n\t\t\treturn isElement(node) && node.getAttribute(attrName) === attrValue;\n\t\t};\n\t}\n\n\tfunction isBogus(node) {\n\t\treturn isElement(node) && node.hasAttribute('data-mce-bogus');\n\t}\n\n\tfunction hasContentEditableState(value) {\n\t\treturn function(node) {\n\t\t\tif (isElement(node)) {\n\t\t\t\tif (node.contentEditable === value) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (node.getAttribute('data-mce-contenteditable') === value) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t}\n\n\treturn {\n\t\tisText: isNodeType(3),\n\t\tisElement: isElement,\n\t\tisComment: isNodeType(8),\n\t\tisBr: matchNodeNames('br'),\n\t\tisContentEditableTrue: hasContentEditableState('true'),\n\t\tisContentEditableFalse: hasContentEditableState('false'),\n\t\tmatchNodeNames: matchNodeNames,\n\t\thasPropValue: hasPropValue,\n\t\thasAttributeValue: hasAttributeValue,\n\t\tmatchStyleValues: matchStyleValues,\n\t\tisBogus: isBogus\n\t};\n});\n\n// Included from: js/tinymce/classes/text/Zwsp.js\n\n/**\n * Zwsp.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility functions for working with zero width space\n * characters used as character containers etc.\n *\n * @private\n * @class tinymce.text.Zwsp\n * @example\n * var isZwsp = Zwsp.isZwsp('\\uFEFF');\n * var abc = Zwsp.trim('a\\uFEFFc');\n */\ndefine(\"tinymce/text/Zwsp\", [], function() {\n\tvar ZWSP = '\\uFEFF';\n\n\tfunction isZwsp(chr) {\n\t\treturn chr == ZWSP;\n\t}\n\n\tfunction trim(str) {\n\t\treturn str.replace(new RegExp(ZWSP, 'g'), '');\n\t}\n\n\treturn {\n\t\tisZwsp: isZwsp,\n\t\tZWSP: ZWSP,\n\t\ttrim: trim\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/CaretContainer.js\n\n/**\n * CaretContainer.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module handles caret containers. A caret container is a node that\n * holds the caret for positional purposes.\n *\n * @private\n * @class tinymce.caret.CaretContainer\n */\ndefine(\"tinymce/caret/CaretContainer\", [\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/text/Zwsp\"\n], function(NodeType, Zwsp) {\n\tvar isElement = NodeType.isElement,\n\t\tisText = NodeType.isText;\n\n\tfunction isCaretContainerBlock(node) {\n\t\tif (isText(node)) {\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn isElement(node) && node.hasAttribute('data-mce-caret');\n\t}\n\n\tfunction isCaretContainerInline(node) {\n\t\treturn isText(node) && Zwsp.isZwsp(node.data);\n\t}\n\n\tfunction isCaretContainer(node) {\n\t\treturn isCaretContainerBlock(node) || isCaretContainerInline(node);\n\t}\n\n\tfunction removeNode(node) {\n\t\tvar parentNode = node.parentNode;\n\t\tif (parentNode) {\n\t\t\tparentNode.removeChild(node);\n\t\t}\n\t}\n\n\tfunction getNodeValue(node) {\n\t\ttry {\n\t\t\treturn node.nodeValue;\n\t\t} catch (ex) {\n\t\t\t// IE sometimes produces \"Invalid argument\" on nodes\n\t\t\treturn \"\";\n\t\t}\n\t}\n\n\tfunction setNodeValue(node, text) {\n\t\tif (text.length === 0) {\n\t\t\tremoveNode(node);\n\t\t} else {\n\t\t\tnode.nodeValue = text;\n\t\t}\n\t}\n\n\tfunction insertInline(node, before) {\n\t\tvar doc, sibling, textNode, parentNode;\n\n\t\tdoc = node.ownerDocument;\n\t\ttextNode = doc.createTextNode(Zwsp.ZWSP);\n\t\tparentNode = node.parentNode;\n\n\t\tif (!before) {\n\t\t\tsibling = node.nextSibling;\n\t\t\tif (isText(sibling)) {\n\t\t\t\tif (isCaretContainer(sibling)) {\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\n\t\t\t\tif (startsWithCaretContainer(sibling)) {\n\t\t\t\t\tsibling.splitText(1);\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (node.nextSibling) {\n\t\t\t\tparentNode.insertBefore(textNode, node.nextSibling);\n\t\t\t} else {\n\t\t\t\tparentNode.appendChild(textNode);\n\t\t\t}\n\t\t} else {\n\t\t\tsibling = node.previousSibling;\n\t\t\tif (isText(sibling)) {\n\t\t\t\tif (isCaretContainer(sibling)) {\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\n\t\t\t\tif (endsWithCaretContainer(sibling)) {\n\t\t\t\t\treturn sibling.splitText(sibling.data.length - 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tparentNode.insertBefore(textNode, node);\n\t\t}\n\n\t\treturn textNode;\n\t}\n\n\tfunction insertBlock(blockName, node, before) {\n\t\tvar doc, blockNode, parentNode;\n\n\t\tdoc = node.ownerDocument;\n\t\tblockNode = doc.createElement(blockName);\n\t\tblockNode.setAttribute('data-mce-caret', before ? 'before' : 'after');\n\t\tblockNode.setAttribute('data-mce-bogus', 'all');\n\t\tblockNode.appendChild(doc.createTextNode('\\u00a0'));\n\t\tparentNode = node.parentNode;\n\n\t\tif (!before) {\n\t\t\tif (node.nextSibling) {\n\t\t\t\tparentNode.insertBefore(blockNode, node.nextSibling);\n\t\t\t} else {\n\t\t\t\tparentNode.appendChild(blockNode);\n\t\t\t}\n\t\t} else {\n\t\t\tparentNode.insertBefore(blockNode, node);\n\t\t}\n\n\t\treturn blockNode;\n\t}\n\n\tfunction remove(caretContainerNode) {\n\t\tif (isElement(caretContainerNode) && isCaretContainer(caretContainerNode)) {\n\t\t\tif (caretContainerNode.innerHTML != '&nbsp;') {\n\t\t\t\tcaretContainerNode.removeAttribute('data-mce-caret');\n\t\t\t} else {\n\t\t\t\tremoveNode(caretContainerNode);\n\t\t\t}\n\t\t}\n\n\t\tif (isText(caretContainerNode)) {\n\t\t\tvar text = Zwsp.trim(getNodeValue(caretContainerNode));\n\t\t\tsetNodeValue(caretContainerNode, text);\n\t\t}\n\t}\n\n\tfunction startsWithCaretContainer(node) {\n\t\treturn isText(node) && node.data[0] == Zwsp.ZWSP;\n\t}\n\n\tfunction endsWithCaretContainer(node) {\n\t\treturn isText(node) && node.data[node.data.length - 1] == Zwsp.ZWSP;\n\t}\n\n\treturn {\n\t\tisCaretContainer: isCaretContainer,\n\t\tisCaretContainerBlock: isCaretContainerBlock,\n\t\tisCaretContainerInline: isCaretContainerInline,\n\t\tinsertInline: insertInline,\n\t\tinsertBlock: insertBlock,\n\t\tremove: remove,\n\t\tstartsWithCaretContainer: startsWithCaretContainer,\n\t\tendsWithCaretContainer: endsWithCaretContainer\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/RangeUtils.js\n\n/**\n * RangeUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains a few utility methods for ranges.\n *\n * @class tinymce.dom.RangeUtils\n */\ndefine(\"tinymce/dom/RangeUtils\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/Range\",\n\t\"tinymce/caret/CaretContainer\"\n], function(Tools, TreeWalker, NodeType, Range, CaretContainer) {\n\tvar each = Tools.each,\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisCaretContainer = CaretContainer.isCaretContainer;\n\n\tfunction getEndChild(container, index) {\n\t\tvar childNodes = container.childNodes;\n\n\t\tindex--;\n\n\t\tif (index > childNodes.length - 1) {\n\t\t\tindex = childNodes.length - 1;\n\t\t} else if (index < 0) {\n\t\t\tindex = 0;\n\t\t}\n\n\t\treturn childNodes[index] || container;\n\t}\n\n\tfunction RangeUtils(dom) {\n\t\t/**\n\t\t * Walks the specified range like object and executes the callback for each sibling collection it finds.\n\t\t *\n\t\t * @private\n\t\t * @method walk\n\t\t * @param {Object} rng Range like object.\n\t\t * @param {function} callback Callback function to execute for each sibling collection.\n\t\t */\n\t\tthis.walk = function(rng, callback) {\n\t\t\tvar startContainer = rng.startContainer,\n\t\t\t\tstartOffset = rng.startOffset,\n\t\t\t\tendContainer = rng.endContainer,\n\t\t\t\tendOffset = rng.endOffset,\n\t\t\t\tancestor, startPoint,\n\t\t\t\tendPoint, node, parent, siblings, nodes;\n\n\t\t\t// Handle table cell selection the table plugin enables\n\t\t\t// you to fake select table cells and perform formatting actions on them\n\t\t\tnodes = dom.select('td[data-mce-selected],th[data-mce-selected]');\n\t\t\tif (nodes.length > 0) {\n\t\t\t\teach(nodes, function(node) {\n\t\t\t\t\tcallback([node]);\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Excludes start/end text node if they are out side the range\n\t\t\t *\n\t\t\t * @private\n\t\t\t * @param {Array} nodes Nodes to exclude items from.\n\t\t\t * @return {Array} Array with nodes excluding the start/end container if needed.\n\t\t\t */\n\t\t\tfunction exclude(nodes) {\n\t\t\t\tvar node;\n\n\t\t\t\t// First node is excluded\n\t\t\t\tnode = nodes[0];\n\t\t\t\tif (node.nodeType === 3 && node === startContainer && startOffset >= node.nodeValue.length) {\n\t\t\t\t\tnodes.splice(0, 1);\n\t\t\t\t}\n\n\t\t\t\t// Last node is excluded\n\t\t\t\tnode = nodes[nodes.length - 1];\n\t\t\t\tif (endOffset === 0 && nodes.length > 0 && node === endContainer && node.nodeType === 3) {\n\t\t\t\t\tnodes.splice(nodes.length - 1, 1);\n\t\t\t\t}\n\n\t\t\t\treturn nodes;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Collects siblings\n\t\t\t *\n\t\t\t * @private\n\t\t\t * @param {Node} node Node to collect siblings from.\n\t\t\t * @param {String} name Name of the sibling to check for.\n\t\t\t * @param {Node} end_node\n\t\t\t * @return {Array} Array of collected siblings.\n\t\t\t */\n\t\t\tfunction collectSiblings(node, name, end_node) {\n\t\t\t\tvar siblings = [];\n\n\t\t\t\tfor (; node && node != end_node; node = node[name]) {\n\t\t\t\t\tsiblings.push(node);\n\t\t\t\t}\n\n\t\t\t\treturn siblings;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Find an end point this is the node just before the common ancestor root.\n\t\t\t *\n\t\t\t * @private\n\t\t\t * @param {Node} node Node to start at.\n\t\t\t * @param {Node} root Root/ancestor element to stop just before.\n\t\t\t * @return {Node} Node just before the root element.\n\t\t\t */\n\t\t\tfunction findEndPoint(node, root) {\n\t\t\t\tdo {\n\t\t\t\t\tif (node.parentNode == root) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t} while (node);\n\t\t\t}\n\n\t\t\tfunction walkBoundary(start_node, end_node, next) {\n\t\t\t\tvar siblingName = next ? 'nextSibling' : 'previousSibling';\n\n\t\t\t\tfor (node = start_node, parent = node.parentNode; node && node != end_node; node = parent) {\n\t\t\t\t\tparent = node.parentNode;\n\t\t\t\t\tsiblings = collectSiblings(node == start_node ? node : node[siblingName], siblingName);\n\n\t\t\t\t\tif (siblings.length) {\n\t\t\t\t\t\tif (!next) {\n\t\t\t\t\t\t\tsiblings.reverse();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcallback(exclude(siblings));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If index based start position then resolve it\n\t\t\tif (startContainer.nodeType == 1 && startContainer.hasChildNodes()) {\n\t\t\t\tstartContainer = startContainer.childNodes[startOffset];\n\t\t\t}\n\n\t\t\t// If index based end position then resolve it\n\t\t\tif (endContainer.nodeType == 1 && endContainer.hasChildNodes()) {\n\t\t\t\tendContainer = getEndChild(endContainer, endOffset);\n\t\t\t}\n\n\t\t\t// Same container\n\t\t\tif (startContainer == endContainer) {\n\t\t\t\treturn callback(exclude([startContainer]));\n\t\t\t}\n\n\t\t\t// Find common ancestor and end points\n\t\t\tancestor = dom.findCommonAncestor(startContainer, endContainer);\n\n\t\t\t// Process left side\n\t\t\tfor (node = startContainer; node; node = node.parentNode) {\n\t\t\t\tif (node === endContainer) {\n\t\t\t\t\treturn walkBoundary(startContainer, ancestor, true);\n\t\t\t\t}\n\n\t\t\t\tif (node === ancestor) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Process right side\n\t\t\tfor (node = endContainer; node; node = node.parentNode) {\n\t\t\t\tif (node === startContainer) {\n\t\t\t\t\treturn walkBoundary(endContainer, ancestor);\n\t\t\t\t}\n\n\t\t\t\tif (node === ancestor) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Find start/end point\n\t\t\tstartPoint = findEndPoint(startContainer, ancestor) || startContainer;\n\t\t\tendPoint = findEndPoint(endContainer, ancestor) || endContainer;\n\n\t\t\t// Walk left leaf\n\t\t\twalkBoundary(startContainer, startPoint, true);\n\n\t\t\t// Walk the middle from start to end point\n\t\t\tsiblings = collectSiblings(\n\t\t\t\tstartPoint == startContainer ? startPoint : startPoint.nextSibling,\n\t\t\t\t'nextSibling',\n\t\t\t\tendPoint == endContainer ? endPoint.nextSibling : endPoint\n\t\t\t);\n\n\t\t\tif (siblings.length) {\n\t\t\t\tcallback(exclude(siblings));\n\t\t\t}\n\n\t\t\t// Walk right leaf\n\t\t\twalkBoundary(endContainer, endPoint);\n\t\t};\n\n\t\t/**\n\t\t * Splits the specified range at it's start/end points.\n\t\t *\n\t\t * @private\n\t\t * @param {Range/RangeObject} rng Range to split.\n\t\t * @return {Object} Range position object.\n\t\t */\n\t\tthis.split = function(rng) {\n\t\t\tvar startContainer = rng.startContainer,\n\t\t\t\tstartOffset = rng.startOffset,\n\t\t\t\tendContainer = rng.endContainer,\n\t\t\t\tendOffset = rng.endOffset;\n\n\t\t\tfunction splitText(node, offset) {\n\t\t\t\treturn node.splitText(offset);\n\t\t\t}\n\n\t\t\t// Handle single text node\n\t\t\tif (startContainer == endContainer && startContainer.nodeType == 3) {\n\t\t\t\tif (startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n\t\t\t\t\tendContainer = splitText(startContainer, startOffset);\n\t\t\t\t\tstartContainer = endContainer.previousSibling;\n\n\t\t\t\t\tif (endOffset > startOffset) {\n\t\t\t\t\t\tendOffset = endOffset - startOffset;\n\t\t\t\t\t\tstartContainer = endContainer = splitText(endContainer, endOffset).previousSibling;\n\t\t\t\t\t\tendOffset = endContainer.nodeValue.length;\n\t\t\t\t\t\tstartOffset = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tendOffset = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Split startContainer text node if needed\n\t\t\t\tif (startContainer.nodeType == 3 && startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n\t\t\t\t\tstartContainer = splitText(startContainer, startOffset);\n\t\t\t\t\tstartOffset = 0;\n\t\t\t\t}\n\n\t\t\t\t// Split endContainer text node if needed\n\t\t\t\tif (endContainer.nodeType == 3 && endOffset > 0 && endOffset < endContainer.nodeValue.length) {\n\t\t\t\t\tendContainer = splitText(endContainer, endOffset).previousSibling;\n\t\t\t\t\tendOffset = endContainer.nodeValue.length;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tstartContainer: startContainer,\n\t\t\t\tstartOffset: startOffset,\n\t\t\t\tendContainer: endContainer,\n\t\t\t\tendOffset: endOffset\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t\t * Normalizes the specified range by finding the closest best suitable caret location.\n\t\t *\n\t\t * @private\n\t\t * @param {Range} rng Range to normalize.\n\t\t * @return {Boolean} True/false if the specified range was normalized or not.\n\t\t */\n\t\tthis.normalize = function(rng) {\n\t\t\tvar normalized, collapsed;\n\n\t\t\tfunction normalizeEndPoint(start) {\n\t\t\t\tvar container, offset, walker, body = dom.getRoot(), node, nonEmptyElementsMap;\n\t\t\t\tvar directionLeft, isAfterNode;\n\n\t\t\t\tfunction isTableCell(node) {\n\t\t\t\t\treturn node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n\t\t\t\t}\n\n\t\t\t\tfunction hasBrBeforeAfter(node, left) {\n\t\t\t\t\tvar walker = new TreeWalker(node, dom.getParent(node.parentNode, dom.isBlock) || body);\n\n\t\t\t\t\twhile ((node = walker[left ? 'prev' : 'next']())) {\n\t\t\t\t\t\tif (node.nodeName === \"BR\") {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction hasContentEditableFalseParent(node) {\n\t\t\t\t\twhile (node && node != body) {\n\t\t\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tfunction isPrevNode(node, name) {\n\t\t\t\t\treturn node.previousSibling && node.previousSibling.nodeName == name;\n\t\t\t\t}\n\n\t\t\t\t// Walks the dom left/right to find a suitable text node to move the endpoint into\n\t\t\t\t// It will only walk within the current parent block or body and will stop if it hits a block or a BR/IMG\n\t\t\t\tfunction findTextNodeRelative(left, startNode) {\n\t\t\t\t\tvar walker, lastInlineElement, parentBlockContainer;\n\n\t\t\t\t\tstartNode = startNode || container;\n\t\t\t\t\tparentBlockContainer = dom.getParent(startNode.parentNode, dom.isBlock) || body;\n\n\t\t\t\t\t// Lean left before the BR element if it's the only BR within a block element. Gecko bug: #6680\n\t\t\t\t\t// This: <p><br>|</p> becomes <p>|<br></p>\n\t\t\t\t\tif (left && startNode.nodeName == 'BR' && isAfterNode && dom.isEmpty(parentBlockContainer)) {\n\t\t\t\t\t\tcontainer = startNode.parentNode;\n\t\t\t\t\t\toffset = dom.nodeIndex(startNode);\n\t\t\t\t\t\tnormalized = true;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Walk left until we hit a text node we can move to or a block/br/img\n\t\t\t\t\twalker = new TreeWalker(startNode, parentBlockContainer);\n\t\t\t\t\twhile ((node = walker[left ? 'prev' : 'next']())) {\n\t\t\t\t\t\t// Break if we hit a non content editable node\n\t\t\t\t\t\tif (dom.getContentEditableParent(node) === \"false\" || isCaretContainer(node)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Found text node that has a length\n\t\t\t\t\t\tif (node.nodeType === 3 && node.nodeValue.length > 0) {\n\t\t\t\t\t\t\tcontainer = node;\n\t\t\t\t\t\t\toffset = left ? node.nodeValue.length : 0;\n\t\t\t\t\t\t\tnormalized = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Break if we find a block or a BR/IMG/INPUT etc\n\t\t\t\t\t\tif (dom.isBlock(node) || nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlastInlineElement = node;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Only fetch the last inline element when in caret mode for now\n\t\t\t\t\tif (collapsed && lastInlineElement) {\n\t\t\t\t\t\tcontainer = lastInlineElement;\n\t\t\t\t\t\tnormalized = true;\n\t\t\t\t\t\toffset = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcontainer = rng[(start ? 'start' : 'end') + 'Container'];\n\t\t\t\toffset = rng[(start ? 'start' : 'end') + 'Offset'];\n\t\t\t\tisAfterNode = container.nodeType == 1 && offset === container.childNodes.length;\n\t\t\t\tnonEmptyElementsMap = dom.schema.getNonEmptyElements();\n\t\t\t\tdirectionLeft = start;\n\n\t\t\t\tif (isCaretContainer(container)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (container.nodeType == 1 && offset > container.childNodes.length - 1) {\n\t\t\t\t\tdirectionLeft = false;\n\t\t\t\t}\n\n\t\t\t\t// If the container is a document move it to the body element\n\t\t\t\tif (container.nodeType === 9) {\n\t\t\t\t\tcontainer = dom.getRoot();\n\t\t\t\t\toffset = 0;\n\t\t\t\t}\n\n\t\t\t\t// If the container is body try move it into the closest text node or position\n\t\t\t\tif (container === body) {\n\t\t\t\t\t// If start is before/after a image, table etc\n\t\t\t\t\tif (directionLeft) {\n\t\t\t\t\t\tnode = container.childNodes[offset > 0 ? offset - 1 : 0];\n\t\t\t\t\t\tif (node) {\n\t\t\t\t\t\t\tif (isCaretContainer(node)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName] || node.nodeName == \"TABLE\") {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Resolve the index\n\t\t\t\t\tif (container.hasChildNodes()) {\n\t\t\t\t\t\toffset = Math.min(!directionLeft && offset > 0 ? offset - 1 : offset, container.childNodes.length - 1);\n\t\t\t\t\t\tcontainer = container.childNodes[offset];\n\t\t\t\t\t\toffset = 0;\n\n\t\t\t\t\t\t// Don't normalize non collapsed selections like <p>[a</p><table></table>]\n\t\t\t\t\t\tif (!collapsed && container === body.lastChild && container.nodeName === 'TABLE') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (hasContentEditableFalseParent(container) || isCaretContainer(container)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Don't walk into elements that doesn't have any child nodes like a IMG\n\t\t\t\t\t\tif (container.hasChildNodes() && !/TABLE/.test(container.nodeName)) {\n\t\t\t\t\t\t\t// Walk the DOM to find a text node to place the caret at or a BR\n\t\t\t\t\t\t\tnode = container;\n\t\t\t\t\t\t\twalker = new TreeWalker(container, body);\n\n\t\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\t\tif (isContentEditableFalse(node) || isCaretContainer(node)) {\n\t\t\t\t\t\t\t\t\tnormalized = false;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Found a text node use that position\n\t\t\t\t\t\t\t\tif (node.nodeType === 3 && node.nodeValue.length > 0) {\n\t\t\t\t\t\t\t\t\toffset = directionLeft ? 0 : node.nodeValue.length;\n\t\t\t\t\t\t\t\t\tcontainer = node;\n\t\t\t\t\t\t\t\t\tnormalized = true;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Found a BR/IMG element that we can place the caret before\n\t\t\t\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName.toLowerCase()] && !isTableCell(node)) {\n\t\t\t\t\t\t\t\t\toffset = dom.nodeIndex(node);\n\t\t\t\t\t\t\t\t\tcontainer = node.parentNode;\n\n\t\t\t\t\t\t\t\t\t// Put caret after image when moving the end point\n\t\t\t\t\t\t\t\t\tif (node.nodeName == \"IMG\" && !directionLeft) {\n\t\t\t\t\t\t\t\t\t\toffset++;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tnormalized = true;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} while ((node = (directionLeft ? walker.next() : walker.prev())));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Lean the caret to the left if possible\n\t\t\t\tif (collapsed) {\n\t\t\t\t\t// So this: <b>x</b><i>|x</i>\n\t\t\t\t\t// Becomes: <b>x|</b><i>x</i>\n\t\t\t\t\t// Seems that only gecko has issues with this\n\t\t\t\t\tif (container.nodeType === 3 && offset === 0) {\n\t\t\t\t\t\tfindTextNodeRelative(true);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Lean left into empty inline elements when the caret is before a BR\n\t\t\t\t\t// So this: <i><b></b><i>|<br></i>\n\t\t\t\t\t// Becomes: <i><b>|</b><i><br></i>\n\t\t\t\t\t// Seems that only gecko has issues with this.\n\t\t\t\t\t// Special edge case for <p><a>x</a>|<br></p> since we don't want <p><a>x|</a><br></p>\n\t\t\t\t\tif (container.nodeType === 1) {\n\t\t\t\t\t\tnode = container.childNodes[offset];\n\n\t\t\t\t\t\t// Offset is after the containers last child\n\t\t\t\t\t\t// then use the previous child for normalization\n\t\t\t\t\t\tif (!node) {\n\t\t\t\t\t\t\tnode = container.childNodes[offset - 1];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (node && node.nodeName === 'BR' && !isPrevNode(node, 'A') &&\n\t\t\t\t\t\t\t!hasBrBeforeAfter(node) && !hasBrBeforeAfter(node, true)) {\n\t\t\t\t\t\t\tfindTextNodeRelative(true, node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Lean the start of the selection right if possible\n\t\t\t\t// So this: x[<b>x]</b>\n\t\t\t\t// Becomes: x<b>[x]</b>\n\t\t\t\tif (directionLeft && !collapsed && container.nodeType === 3 && offset === container.nodeValue.length) {\n\t\t\t\t\tfindTextNodeRelative(false);\n\t\t\t\t}\n\n\t\t\t\t// Set endpoint if it was normalized\n\t\t\t\tif (normalized) {\n\t\t\t\t\trng['set' + (start ? 'Start' : 'End')](container, offset);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcollapsed = rng.collapsed;\n\n\t\t\tnormalizeEndPoint(true);\n\n\t\t\tif (!collapsed) {\n\t\t\t\tnormalizeEndPoint();\n\t\t\t}\n\n\t\t\t// If it was collapsed then make sure it still is\n\t\t\tif (normalized && collapsed) {\n\t\t\t\trng.collapse(true);\n\t\t\t}\n\n\t\t\treturn normalized;\n\t\t};\n\t}\n\n\t/**\n\t * Compares two ranges and checks if they are equal.\n\t *\n\t * @static\n\t * @method compareRanges\n\t * @param {DOMRange} rng1 First range to compare.\n\t * @param {DOMRange} rng2 First range to compare.\n\t * @return {Boolean} true/false if the ranges are equal.\n\t */\n\tRangeUtils.compareRanges = function(rng1, rng2) {\n\t\tif (rng1 && rng2) {\n\t\t\t// Compare native IE ranges\n\t\t\tif (rng1.item || rng1.duplicate) {\n\t\t\t\t// Both are control ranges and the selected element matches\n\t\t\t\tif (rng1.item && rng2.item && rng1.item(0) === rng2.item(0)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Both are text ranges and the range matches\n\t\t\t\tif (rng1.isEqual && rng2.isEqual && rng2.isEqual(rng1)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Compare w3c ranges\n\t\t\t\treturn rng1.startContainer == rng2.startContainer && rng1.startOffset == rng2.startOffset;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\t/**\n\t * Finds the closest selection rect tries to get the range from that.\n\t */\n\tfunction findClosestIeRange(clientX, clientY, doc) {\n\t\tvar element, rng, rects;\n\n\t\telement = doc.elementFromPoint(clientX, clientY);\n\t\trng = doc.body.createTextRange();\n\n\t\tif (!element || element.tagName == 'HTML') {\n\t\t\telement = doc.body;\n\t\t}\n\n\t\trng.moveToElementText(element);\n\t\trects = Tools.toArray(rng.getClientRects());\n\n\t\trects = rects.sort(function(a, b) {\n\t\t\ta = Math.abs(Math.max(a.top - clientY, a.bottom - clientY));\n\t\t\tb = Math.abs(Math.max(b.top - clientY, b.bottom - clientY));\n\n\t\t\treturn a - b;\n\t\t});\n\n\t\tif (rects.length > 0) {\n\t\t\tclientY = (rects[0].bottom + rects[0].top) / 2;\n\n\t\t\ttry {\n\t\t\t\trng.moveToPoint(clientX, clientY);\n\t\t\t\trng.collapse(true);\n\n\t\t\t\treturn rng;\n\t\t\t} catch (ex) {\n\t\t\t\t// At least we tried\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Gets the caret range for the given x/y location.\n\t *\n\t * @static\n\t * @method getCaretRangeFromPoint\n\t * @param {Number} clientX X coordinate for range\n\t * @param {Number} clientY Y coordinate for range\n\t * @param {Document} doc Document that x/y are relative to\n\t * @returns {Range} caret range\n\t */\n\tRangeUtils.getCaretRangeFromPoint = function(clientX, clientY, doc) {\n\t\tvar rng, point;\n\n\t\tif (doc.caretPositionFromPoint) {\n\t\t\tpoint = doc.caretPositionFromPoint(clientX, clientY);\n\t\t\trng = doc.createRange();\n\t\t\trng.setStart(point.offsetNode, point.offset);\n\t\t\trng.collapse(true);\n\t\t} else if (doc.caretRangeFromPoint) {\n\t\t\trng = doc.caretRangeFromPoint(clientX, clientY);\n\t\t} else if (doc.body.createTextRange) {\n\t\t\trng = doc.body.createTextRange();\n\n\t\t\ttry {\n\t\t\t\trng.moveToPoint(clientX, clientY);\n\t\t\t\trng.collapse(true);\n\t\t\t} catch (ex) {\n\t\t\t\trng = findClosestIeRange(clientX, clientY, doc);\n\t\t\t}\n\t\t}\n\n\t\treturn rng;\n\t};\n\n\tRangeUtils.getSelectedNode = function(range) {\n\t\tvar startContainer = range.startContainer,\n\t\t\tstartOffset = range.startOffset;\n\n\t\tif (startContainer.hasChildNodes() && range.endOffset == startOffset + 1) {\n\t\t\treturn startContainer.childNodes[startOffset];\n\t\t}\n\n\t\treturn null;\n\t};\n\n\tRangeUtils.getNode = function(container, offset) {\n\t\tif (container.nodeType == 1 && container.hasChildNodes()) {\n\t\t\tif (offset >= container.childNodes.length) {\n\t\t\t\toffset = container.childNodes.length - 1;\n\t\t\t}\n\n\t\t\tcontainer = container.childNodes[offset];\n\t\t}\n\n\t\treturn container;\n\t};\n\n\treturn RangeUtils;\n});\n\n// Included from: js/tinymce/classes/NodeChange.js\n\n/**\n * NodeChange.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles the nodechange event dispatching both manual and through selection change events.\n *\n * @class tinymce.NodeChange\n * @private\n */\ndefine(\"tinymce/NodeChange\", [\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Delay\"\n], function(RangeUtils, Env, Delay) {\n\treturn function(editor) {\n\t\tvar lastRng, lastPath = [];\n\n\t\t/**\n\t\t * Returns true/false if the current element path has been changed or not.\n\t\t *\n\t\t * @private\n\t\t * @return {Boolean} True if the element path is the same false if it's not.\n\t\t */\n\t\tfunction isSameElementPath(startElm) {\n\t\t\tvar i, currentPath;\n\n\t\t\tcurrentPath = editor.$(startElm).parentsUntil(editor.getBody()).add(startElm);\n\t\t\tif (currentPath.length === lastPath.length) {\n\t\t\t\tfor (i = currentPath.length; i >= 0; i--) {\n\t\t\t\t\tif (currentPath[i] !== lastPath[i]) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (i === -1) {\n\t\t\t\t\tlastPath = currentPath;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlastPath = currentPath;\n\n\t\t\treturn false;\n\t\t}\n\n\t\t// Gecko doesn't support the \"selectionchange\" event\n\t\tif (!('onselectionchange' in editor.getDoc())) {\n\t\t\teditor.on('NodeChange Click MouseUp KeyUp Focus', function(e) {\n\t\t\t\tvar nativeRng, fakeRng;\n\n\t\t\t\t// Since DOM Ranges mutate on modification\n\t\t\t\t// of the DOM we need to clone it's contents\n\t\t\t\tnativeRng = editor.selection.getRng();\n\t\t\t\tfakeRng = {\n\t\t\t\t\tstartContainer: nativeRng.startContainer,\n\t\t\t\t\tstartOffset: nativeRng.startOffset,\n\t\t\t\t\tendContainer: nativeRng.endContainer,\n\t\t\t\t\tendOffset: nativeRng.endOffset\n\t\t\t\t};\n\n\t\t\t\t// Always treat nodechange as a selectionchange since applying\n\t\t\t\t// formatting to the current range wouldn't update the range but it's parent\n\t\t\t\tif (e.type == 'nodechange' || !RangeUtils.compareRanges(fakeRng, lastRng)) {\n\t\t\t\t\teditor.fire('SelectionChange');\n\t\t\t\t}\n\n\t\t\t\tlastRng = fakeRng;\n\t\t\t});\n\t\t}\n\n\t\t// IE has a bug where it fires a selectionchange on right click that has a range at the start of the body\n\t\t// When the contextmenu event fires the selection is located at the right location\n\t\teditor.on('contextmenu', function() {\n\t\t\teditor.fire('SelectionChange');\n\t\t});\n\n\t\t// Selection change is delayed ~200ms on IE when you click inside the current range\n\t\teditor.on('SelectionChange', function() {\n\t\t\tvar startElm = editor.selection.getStart(true);\n\n\t\t\t// IE 8 will fire a selectionchange event with an incorrect selection\n\t\t\t// when focusing out of table cells. Click inside cell -> toolbar = Invalid SelectionChange event\n\t\t\tif (!Env.range && editor.selection.isCollapsed()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!isSameElementPath(startElm) && editor.dom.isChildOf(startElm, editor.getBody())) {\n\t\t\t\teditor.nodeChanged({selectionChange: true});\n\t\t\t}\n\t\t});\n\n\t\t// Fire an extra nodeChange on mouseup for compatibility reasons\n\t\teditor.on('MouseUp', function(e) {\n\t\t\tif (!e.isDefaultPrevented()) {\n\t\t\t\t// Delay nodeChanged call for WebKit edge case issue where the range\n\t\t\t\t// isn't updated until after you click outside a selected image\n\t\t\t\tif (editor.selection.getNode().nodeName == 'IMG') {\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Dispatches out a onNodeChange event to all observers. This method should be called when you\n\t\t * need to update the UI states or element path etc.\n\t\t *\n\t\t * @method nodeChanged\n\t\t * @param {Object} args Optional args to pass to NodeChange event handlers.\n\t\t */\n\t\tthis.nodeChanged = function(args) {\n\t\t\tvar selection = editor.selection, node, parents, root;\n\n\t\t\t// Fix for bug #1896577 it seems that this can not be fired while the editor is loading\n\t\t\tif (editor.initialized && selection && !editor.settings.disable_nodechange && !editor.readonly) {\n\t\t\t\t// Get start node\n\t\t\t\troot = editor.getBody();\n\t\t\t\tnode = selection.getStart() || root;\n\n\t\t\t\t// Make sure the node is within the editor root or is the editor root\n\t\t\t\tif (node.ownerDocument != editor.getDoc() || !editor.dom.isChildOf(node, root)) {\n\t\t\t\t\tnode = root;\n\t\t\t\t}\n\n\t\t\t\t// Edge case for <p>|<img></p>\n\t\t\t\tif (node.nodeName == 'IMG' && selection.isCollapsed()) {\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\t// Get parents and add them to object\n\t\t\t\tparents = [];\n\t\t\t\teditor.dom.getParent(node, function(node) {\n\t\t\t\t\tif (node === root) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tparents.push(node);\n\t\t\t\t});\n\n\t\t\t\targs = args || {};\n\t\t\t\targs.element = node;\n\t\t\t\targs.parents = parents;\n\n\t\t\t\teditor.fire('NodeChange', args);\n\t\t\t}\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/html/Node.js\n\n/**\n * Node.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is a minimalistic implementation of a DOM like node used by the DomParser class.\n *\n * @example\n * var node = new tinymce.html.Node('strong', 1);\n * someRoot.append(node);\n *\n * @class tinymce.html.Node\n * @version 3.4\n */\ndefine(\"tinymce/html/Node\", [], function() {\n\tvar whiteSpaceRegExp = /^[ \\t\\r\\n]*$/, typeLookup = {\n\t\t'#text': 3,\n\t\t'#comment': 8,\n\t\t'#cdata': 4,\n\t\t'#pi': 7,\n\t\t'#doctype': 10,\n\t\t'#document-fragment': 11\n\t};\n\n\t// Walks the tree left/right\n\tfunction walk(node, root_node, prev) {\n\t\tvar sibling, parent, startName = prev ? 'lastChild' : 'firstChild', siblingName = prev ? 'prev' : 'next';\n\n\t\t// Walk into nodes if it has a start\n\t\tif (node[startName]) {\n\t\t\treturn node[startName];\n\t\t}\n\n\t\t// Return the sibling if it has one\n\t\tif (node !== root_node) {\n\t\t\tsibling = node[siblingName];\n\n\t\t\tif (sibling) {\n\t\t\t\treturn sibling;\n\t\t\t}\n\n\t\t\t// Walk up the parents to look for siblings\n\t\t\tfor (parent = node.parent; parent && parent !== root_node; parent = parent.parent) {\n\t\t\t\tsibling = parent[siblingName];\n\n\t\t\t\tif (sibling) {\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Constructs a new Node instance.\n\t *\n\t * @constructor\n\t * @method Node\n\t * @param {String} name Name of the node type.\n\t * @param {Number} type Numeric type representing the node.\n\t */\n\tfunction Node(name, type) {\n\t\tthis.name = name;\n\t\tthis.type = type;\n\n\t\tif (type === 1) {\n\t\t\tthis.attributes = [];\n\t\t\tthis.attributes.map = {};\n\t\t}\n\t}\n\n\tNode.prototype = {\n\t\t/**\n\t\t * Replaces the current node with the specified one.\n\t\t *\n\t\t * @example\n\t\t * someNode.replace(someNewNode);\n\t\t *\n\t\t * @method replace\n\t\t * @param {tinymce.html.Node} node Node to replace the current node with.\n\t\t * @return {tinymce.html.Node} The old node that got replaced.\n\t\t */\n\t\treplace: function(node) {\n\t\t\tvar self = this;\n\n\t\t\tif (node.parent) {\n\t\t\t\tnode.remove();\n\t\t\t}\n\n\t\t\tself.insert(node, self);\n\t\t\tself.remove();\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Gets/sets or removes an attribute by name.\n\t\t *\n\t\t * @example\n\t\t * someNode.attr(\"name\", \"value\"); // Sets an attribute\n\t\t * console.log(someNode.attr(\"name\")); // Gets an attribute\n\t\t * someNode.attr(\"name\", null); // Removes an attribute\n\t\t *\n\t\t * @method attr\n\t\t * @param {String} name Attribute name to set or get.\n\t\t * @param {String} value Optional value to set.\n\t\t * @return {String/tinymce.html.Node} String or undefined on a get operation or the current node on a set operation.\n\t\t */\n\t\tattr: function(name, value) {\n\t\t\tvar self = this, attrs, i, undef;\n\n\t\t\tif (typeof name !== \"string\") {\n\t\t\t\tfor (i in name) {\n\t\t\t\t\tself.attr(i, name[i]);\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\tif ((attrs = self.attributes)) {\n\t\t\t\tif (value !== undef) {\n\t\t\t\t\t// Remove attribute\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tif (name in attrs.map) {\n\t\t\t\t\t\t\tdelete attrs.map[name];\n\n\t\t\t\t\t\t\ti = attrs.length;\n\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\tif (attrs[i].name === name) {\n\t\t\t\t\t\t\t\t\tattrs = attrs.splice(i, 1);\n\t\t\t\t\t\t\t\t\treturn self;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn self;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Set attribute\n\t\t\t\t\tif (name in attrs.map) {\n\t\t\t\t\t\t// Set attribute\n\t\t\t\t\t\ti = attrs.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tif (attrs[i].name === name) {\n\t\t\t\t\t\t\t\tattrs[i].value = value;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tattrs.push({name: name, value: value});\n\t\t\t\t\t}\n\n\t\t\t\t\tattrs.map[name] = value;\n\n\t\t\t\t\treturn self;\n\t\t\t\t}\n\n\t\t\t\treturn attrs.map[name];\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Does a shallow clones the node into a new node. It will also exclude id attributes since\n\t\t * there should only be one id per document.\n\t\t *\n\t\t * @example\n\t\t * var clonedNode = node.clone();\n\t\t *\n\t\t * @method clone\n\t\t * @return {tinymce.html.Node} New copy of the original node.\n\t\t */\n\t\tclone: function() {\n\t\t\tvar self = this, clone = new Node(self.name, self.type), i, l, selfAttrs, selfAttr, cloneAttrs;\n\n\t\t\t// Clone element attributes\n\t\t\tif ((selfAttrs = self.attributes)) {\n\t\t\t\tcloneAttrs = [];\n\t\t\t\tcloneAttrs.map = {};\n\n\t\t\t\tfor (i = 0, l = selfAttrs.length; i < l; i++) {\n\t\t\t\t\tselfAttr = selfAttrs[i];\n\n\t\t\t\t\t// Clone everything except id\n\t\t\t\t\tif (selfAttr.name !== 'id') {\n\t\t\t\t\t\tcloneAttrs[cloneAttrs.length] = {name: selfAttr.name, value: selfAttr.value};\n\t\t\t\t\t\tcloneAttrs.map[selfAttr.name] = selfAttr.value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tclone.attributes = cloneAttrs;\n\t\t\t}\n\n\t\t\tclone.value = self.value;\n\t\t\tclone.shortEnded = self.shortEnded;\n\n\t\t\treturn clone;\n\t\t},\n\n\t\t/**\n\t\t * Wraps the node in in another node.\n\t\t *\n\t\t * @example\n\t\t * node.wrap(wrapperNode);\n\t\t *\n\t\t * @method wrap\n\t\t */\n\t\twrap: function(wrapper) {\n\t\t\tvar self = this;\n\n\t\t\tself.parent.insert(wrapper, self);\n\t\t\twrapper.append(self);\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Unwraps the node in other words it removes the node but keeps the children.\n\t\t *\n\t\t * @example\n\t\t * node.unwrap();\n\t\t *\n\t\t * @method unwrap\n\t\t */\n\t\tunwrap: function() {\n\t\t\tvar self = this, node, next;\n\n\t\t\tfor (node = self.firstChild; node;) {\n\t\t\t\tnext = node.next;\n\t\t\t\tself.insert(node, self, true);\n\t\t\t\tnode = next;\n\t\t\t}\n\n\t\t\tself.remove();\n\t\t},\n\n\t\t/**\n\t\t * Removes the node from it's parent.\n\t\t *\n\t\t * @example\n\t\t * node.remove();\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.html.Node} Current node that got removed.\n\t\t */\n\t\tremove: function() {\n\t\t\tvar self = this, parent = self.parent, next = self.next, prev = self.prev;\n\n\t\t\tif (parent) {\n\t\t\t\tif (parent.firstChild === self) {\n\t\t\t\t\tparent.firstChild = next;\n\n\t\t\t\t\tif (next) {\n\t\t\t\t\t\tnext.prev = null;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tprev.next = next;\n\t\t\t\t}\n\n\t\t\t\tif (parent.lastChild === self) {\n\t\t\t\t\tparent.lastChild = prev;\n\n\t\t\t\t\tif (prev) {\n\t\t\t\t\t\tprev.next = null;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tnext.prev = prev;\n\t\t\t\t}\n\n\t\t\t\tself.parent = self.next = self.prev = null;\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Appends a new node as a child of the current node.\n\t\t *\n\t\t * @example\n\t\t * node.append(someNode);\n\t\t *\n\t\t * @method append\n\t\t * @param {tinymce.html.Node} node Node to append as a child of the current one.\n\t\t * @return {tinymce.html.Node} The node that got appended.\n\t\t */\n\t\tappend: function(node) {\n\t\t\tvar self = this, last;\n\n\t\t\tif (node.parent) {\n\t\t\t\tnode.remove();\n\t\t\t}\n\n\t\t\tlast = self.lastChild;\n\t\t\tif (last) {\n\t\t\t\tlast.next = node;\n\t\t\t\tnode.prev = last;\n\t\t\t\tself.lastChild = node;\n\t\t\t} else {\n\t\t\t\tself.lastChild = self.firstChild = node;\n\t\t\t}\n\n\t\t\tnode.parent = self;\n\n\t\t\treturn node;\n\t\t},\n\n\t\t/**\n\t\t * Inserts a node at a specific position as a child of the current node.\n\t\t *\n\t\t * @example\n\t\t * parentNode.insert(newChildNode, oldChildNode);\n\t\t *\n\t\t * @method insert\n\t\t * @param {tinymce.html.Node} node Node to insert as a child of the current node.\n\t\t * @param {tinymce.html.Node} ref_node Reference node to set node before/after.\n\t\t * @param {Boolean} before Optional state to insert the node before the reference node.\n\t\t * @return {tinymce.html.Node} The node that got inserted.\n\t\t */\n\t\tinsert: function(node, ref_node, before) {\n\t\t\tvar parent;\n\n\t\t\tif (node.parent) {\n\t\t\t\tnode.remove();\n\t\t\t}\n\n\t\t\tparent = ref_node.parent || this;\n\n\t\t\tif (before) {\n\t\t\t\tif (ref_node === parent.firstChild) {\n\t\t\t\t\tparent.firstChild = node;\n\t\t\t\t} else {\n\t\t\t\t\tref_node.prev.next = node;\n\t\t\t\t}\n\n\t\t\t\tnode.prev = ref_node.prev;\n\t\t\t\tnode.next = ref_node;\n\t\t\t\tref_node.prev = node;\n\t\t\t} else {\n\t\t\t\tif (ref_node === parent.lastChild) {\n\t\t\t\t\tparent.lastChild = node;\n\t\t\t\t} else {\n\t\t\t\t\tref_node.next.prev = node;\n\t\t\t\t}\n\n\t\t\t\tnode.next = ref_node.next;\n\t\t\t\tnode.prev = ref_node;\n\t\t\t\tref_node.next = node;\n\t\t\t}\n\n\t\t\tnode.parent = parent;\n\n\t\t\treturn node;\n\t\t},\n\n\t\t/**\n\t\t * Get all children by name.\n\t\t *\n\t\t * @method getAll\n\t\t * @param {String} name Name of the child nodes to collect.\n\t\t * @return {Array} Array with child nodes matchin the specified name.\n\t\t */\n\t\tgetAll: function(name) {\n\t\t\tvar self = this, node, collection = [];\n\n\t\t\tfor (node = self.firstChild; node; node = walk(node, self)) {\n\t\t\t\tif (node.name === name) {\n\t\t\t\t\tcollection.push(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn collection;\n\t\t},\n\n\t\t/**\n\t\t * Removes all children of the current node.\n\t\t *\n\t\t * @method empty\n\t\t * @return {tinymce.html.Node} The current node that got cleared.\n\t\t */\n\t\tempty: function() {\n\t\t\tvar self = this, nodes, i, node;\n\n\t\t\t// Remove all children\n\t\t\tif (self.firstChild) {\n\t\t\t\tnodes = [];\n\n\t\t\t\t// Collect the children\n\t\t\t\tfor (node = self.firstChild; node; node = walk(node, self)) {\n\t\t\t\t\tnodes.push(node);\n\t\t\t\t}\n\n\t\t\t\t// Remove the children\n\t\t\t\ti = nodes.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tnode.parent = node.firstChild = node.lastChild = node.next = node.prev = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.firstChild = self.lastChild = null;\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the node is to be considered empty or not.\n\t\t *\n\t\t * @example\n\t\t * node.isEmpty({img: true});\n\t\t * @method isEmpty\n\t\t * @param {Object} elements Name/value object with elements that are automatically treated as non empty elements.\n\t\t * @return {Boolean} true/false if the node is empty or not.\n\t\t */\n\t\tisEmpty: function(elements) {\n\t\t\tvar self = this, node = self.firstChild, i, name;\n\n\t\t\tif (node) {\n\t\t\t\tdo {\n\t\t\t\t\tif (node.type === 1) {\n\t\t\t\t\t\t// Ignore bogus elements\n\t\t\t\t\t\tif (node.attributes.map['data-mce-bogus']) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Keep empty elements like <img />\n\t\t\t\t\t\tif (elements[node.name]) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Keep bookmark nodes and name attribute like <a name=\"1\"></a>\n\t\t\t\t\t\ti = node.attributes.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tname = node.attributes[i].name;\n\t\t\t\t\t\t\tif (name === \"name\" || name.indexOf('data-mce-bookmark') === 0) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Keep comments\n\t\t\t\t\tif (node.type === 8) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Keep non whitespace text nodes\n\t\t\t\t\tif ((node.type === 3 && !whiteSpaceRegExp.test(node.value))) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} while ((node = walk(node, self)));\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\t/**\n\t\t * Walks to the next or previous node and returns that node or null if it wasn't found.\n\t\t *\n\t\t * @method walk\n\t\t * @param {Boolean} prev Optional previous node state defaults to false.\n\t\t * @return {tinymce.html.Node} Node that is next to or previous of the current node.\n\t\t */\n\t\twalk: function(prev) {\n\t\t\treturn walk(this, null, prev);\n\t\t}\n\t};\n\n\t/**\n\t * Creates a node of a specific type.\n\t *\n\t * @static\n\t * @method create\n\t * @param {String} name Name of the node type to create for example \"b\" or \"#text\".\n\t * @param {Object} attrs Name/value collection of attributes that will be applied to elements.\n\t */\n\tNode.create = function(name, attrs) {\n\t\tvar node, attrName;\n\n\t\t// Create node\n\t\tnode = new Node(name, typeLookup[name] || 1);\n\n\t\t// Add attributes if needed\n\t\tif (attrs) {\n\t\t\tfor (attrName in attrs) {\n\t\t\t\tnode.attr(attrName, attrs[attrName]);\n\t\t\t}\n\t\t}\n\n\t\treturn node;\n\t};\n\n\treturn Node;\n});\n\n// Included from: js/tinymce/classes/html/Schema.js\n\n/**\n * Schema.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Schema validator class.\n *\n * @class tinymce.html.Schema\n * @example\n *  if (tinymce.activeEditor.schema.isValidChild('p', 'span'))\n *    alert('span is valid child of p.');\n *\n *  if (tinymce.activeEditor.schema.getElementRule('p'))\n *    alert('P is a valid element.');\n *\n * @class tinymce.html.Schema\n * @version 3.4\n */\ndefine(\"tinymce/html/Schema\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar mapCache = {}, dummyObj = {};\n\tvar makeMap = Tools.makeMap, each = Tools.each, extend = Tools.extend, explode = Tools.explode, inArray = Tools.inArray;\n\n\tfunction split(items, delim) {\n\t\treturn items ? items.split(delim || ' ') : [];\n\t}\n\n\t/**\n\t * Builds a schema lookup table\n\t *\n\t * @private\n\t * @param {String} type html4, html5 or html5-strict schema type.\n\t * @return {Object} Schema lookup table.\n\t */\n\tfunction compileSchema(type) {\n\t\tvar schema = {}, globalAttributes, blockContent;\n\t\tvar phrasingContent, flowContent, html4BlockContent, html4PhrasingContent;\n\n\t\tfunction add(name, attributes, children) {\n\t\t\tvar ni, i, attributesOrder, args = arguments;\n\n\t\t\tfunction arrayToMap(array, obj) {\n\t\t\t\tvar map = {}, i, l;\n\n\t\t\t\tfor (i = 0, l = array.length; i < l; i++) {\n\t\t\t\t\tmap[array[i]] = obj || {};\n\t\t\t\t}\n\n\t\t\t\treturn map;\n\t\t\t}\n\n\t\t\tchildren = children || [];\n\t\t\tattributes = attributes || \"\";\n\n\t\t\tif (typeof children === \"string\") {\n\t\t\t\tchildren = split(children);\n\t\t\t}\n\n\t\t\t// Split string children\n\t\t\tfor (i = 3; i < args.length; i++) {\n\t\t\t\tif (typeof args[i] === \"string\") {\n\t\t\t\t\targs[i] = split(args[i]);\n\t\t\t\t}\n\n\t\t\t\tchildren.push.apply(children, args[i]);\n\t\t\t}\n\n\t\t\tname = split(name);\n\t\t\tni = name.length;\n\t\t\twhile (ni--) {\n\t\t\t\tattributesOrder = [].concat(globalAttributes, split(attributes));\n\t\t\t\tschema[name[ni]] = {\n\t\t\t\t\tattributes: arrayToMap(attributesOrder),\n\t\t\t\t\tattributesOrder: attributesOrder,\n\t\t\t\t\tchildren: arrayToMap(children, dummyObj)\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tfunction addAttrs(name, attributes) {\n\t\t\tvar ni, schemaItem, i, l;\n\n\t\t\tname = split(name);\n\t\t\tni = name.length;\n\t\t\tattributes = split(attributes);\n\t\t\twhile (ni--) {\n\t\t\t\tschemaItem = schema[name[ni]];\n\t\t\t\tfor (i = 0, l = attributes.length; i < l; i++) {\n\t\t\t\t\tschemaItem.attributes[attributes[i]] = {};\n\t\t\t\t\tschemaItem.attributesOrder.push(attributes[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Use cached schema\n\t\tif (mapCache[type]) {\n\t\t\treturn mapCache[type];\n\t\t}\n\n\t\t// Attributes present on all elements\n\t\tglobalAttributes = split(\"id accesskey class dir lang style tabindex title\");\n\n\t\t// Event attributes can be opt-in/opt-out\n\t\t/*eventAttributes = split(\"onabort onblur oncancel oncanplay oncanplaythrough onchange onclick onclose oncontextmenu oncuechange \" +\n\t\t\t\t\"ondblclick ondrag ondragend ondragenter ondragleave ondragover ondragstart ondrop ondurationchange onemptied onended \" +\n\t\t\t\t\"onerror onfocus oninput oninvalid onkeydown onkeypress onkeyup onload onloadeddata onloadedmetadata onloadstart \" +\n\t\t\t\t\"onmousedown onmousemove onmouseout onmouseover onmouseup onmousewheel onpause onplay onplaying onprogress onratechange \" +\n\t\t\t\t\"onreset onscroll onseeked onseeking onseeking onselect onshow onstalled onsubmit onsuspend ontimeupdate onvolumechange \" +\n\t\t\t\t\"onwaiting\"\n\t\t);*/\n\n\t\t// Block content elements\n\t\tblockContent = split(\n\t\t\t\"address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul\"\n\t\t);\n\n\t\t// Phrasing content elements from the HTML5 spec (inline)\n\t\tphrasingContent = split(\n\t\t\t\"a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd \" +\n\t\t\t\"label map noscript object q s samp script select small span strong sub sup \" +\n\t\t\t\"textarea u var #text #comment\"\n\t\t);\n\n\t\t// Add HTML5 items to globalAttributes, blockContent, phrasingContent\n\t\tif (type != \"html4\") {\n\t\t\tglobalAttributes.push.apply(globalAttributes, split(\"contenteditable contextmenu draggable dropzone \" +\n\t\t\t\t\"hidden spellcheck translate\"));\n\t\t\tblockContent.push.apply(blockContent, split(\"article aside details dialog figure header footer hgroup section nav\"));\n\t\t\tphrasingContent.push.apply(phrasingContent, split(\"audio canvas command datalist mark meter output picture \" +\n\t\t\t\t\"progress time wbr video ruby bdi keygen\"));\n\t\t}\n\n\t\t// Add HTML4 elements unless it's html5-strict\n\t\tif (type != \"html5-strict\") {\n\t\t\tglobalAttributes.push(\"xml:lang\");\n\n\t\t\thtml4PhrasingContent = split(\"acronym applet basefont big font strike tt\");\n\t\t\tphrasingContent.push.apply(phrasingContent, html4PhrasingContent);\n\n\t\t\teach(html4PhrasingContent, function(name) {\n\t\t\t\tadd(name, \"\", phrasingContent);\n\t\t\t});\n\n\t\t\thtml4BlockContent = split(\"center dir isindex noframes\");\n\t\t\tblockContent.push.apply(blockContent, html4BlockContent);\n\n\t\t\t// Flow content elements from the HTML5 spec (block+inline)\n\t\t\tflowContent = [].concat(blockContent, phrasingContent);\n\n\t\t\teach(html4BlockContent, function(name) {\n\t\t\t\tadd(name, \"\", flowContent);\n\t\t\t});\n\t\t}\n\n\t\t// Flow content elements from the HTML5 spec (block+inline)\n\t\tflowContent = flowContent || [].concat(blockContent, phrasingContent);\n\n\t\t// HTML4 base schema TODO: Move HTML5 specific attributes to HTML5 specific if statement\n\t\t// Schema items <element name>, <specific attributes>, <children ..>\n\t\tadd(\"html\", \"manifest\", \"head body\");\n\t\tadd(\"head\", \"\", \"base command link meta noscript script style title\");\n\t\tadd(\"title hr noscript br\");\n\t\tadd(\"base\", \"href target\");\n\t\tadd(\"link\", \"href rel media hreflang type sizes hreflang\");\n\t\tadd(\"meta\", \"name http-equiv content charset\");\n\t\tadd(\"style\", \"media type scoped\");\n\t\tadd(\"script\", \"src async defer type charset\");\n\t\tadd(\"body\", \"onafterprint onbeforeprint onbeforeunload onblur onerror onfocus \" +\n\t\t\t\t\"onhashchange onload onmessage onoffline ononline onpagehide onpageshow \" +\n\t\t\t\t\"onpopstate onresize onscroll onstorage onunload\", flowContent);\n\t\tadd(\"address dt dd div caption\", \"\", flowContent);\n\t\tadd(\"h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn\", \"\", phrasingContent);\n\t\tadd(\"blockquote\", \"cite\", flowContent);\n\t\tadd(\"ol\", \"reversed start type\", \"li\");\n\t\tadd(\"ul\", \"\", \"li\");\n\t\tadd(\"li\", \"value\", flowContent);\n\t\tadd(\"dl\", \"\", \"dt dd\");\n\t\tadd(\"a\", \"href target rel media hreflang type\", phrasingContent);\n\t\tadd(\"q\", \"cite\", phrasingContent);\n\t\tadd(\"ins del\", \"cite datetime\", flowContent);\n\t\tadd(\"img\", \"src sizes srcset alt usemap ismap width height\");\n\t\tadd(\"iframe\", \"src name width height\", flowContent);\n\t\tadd(\"embed\", \"src type width height\");\n\t\tadd(\"object\", \"data type typemustmatch name usemap form width height\", flowContent, \"param\");\n\t\tadd(\"param\", \"name value\");\n\t\tadd(\"map\", \"name\", flowContent, \"area\");\n\t\tadd(\"area\", \"alt coords shape href target rel media hreflang type\");\n\t\tadd(\"table\", \"border\", \"caption colgroup thead tfoot tbody tr\" + (type == \"html4\" ? \" col\" : \"\"));\n\t\tadd(\"colgroup\", \"span\", \"col\");\n\t\tadd(\"col\", \"span\");\n\t\tadd(\"tbody thead tfoot\", \"\", \"tr\");\n\t\tadd(\"tr\", \"\", \"td th\");\n\t\tadd(\"td\", \"colspan rowspan headers\", flowContent);\n\t\tadd(\"th\", \"colspan rowspan headers scope abbr\", flowContent);\n\t\tadd(\"form\", \"accept-charset action autocomplete enctype method name novalidate target\", flowContent);\n\t\tadd(\"fieldset\", \"disabled form name\", flowContent, \"legend\");\n\t\tadd(\"label\", \"form for\", phrasingContent);\n\t\tadd(\"input\", \"accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate \" +\n\t\t\t\t\"formtarget height list max maxlength min multiple name pattern readonly required size src step type value width\"\n\t\t);\n\t\tadd(\"button\", \"disabled form formaction formenctype formmethod formnovalidate formtarget name type value\",\n\t\t\ttype == \"html4\" ? flowContent : phrasingContent);\n\t\tadd(\"select\", \"disabled form multiple name required size\", \"option optgroup\");\n\t\tadd(\"optgroup\", \"disabled label\", \"option\");\n\t\tadd(\"option\", \"disabled label selected value\");\n\t\tadd(\"textarea\", \"cols dirname disabled form maxlength name readonly required rows wrap\");\n\t\tadd(\"menu\", \"type label\", flowContent, \"li\");\n\t\tadd(\"noscript\", \"\", flowContent);\n\n\t\t// Extend with HTML5 elements\n\t\tif (type != \"html4\") {\n\t\t\tadd(\"wbr\");\n\t\t\tadd(\"ruby\", \"\", phrasingContent, \"rt rp\");\n\t\t\tadd(\"figcaption\", \"\", flowContent);\n\t\t\tadd(\"mark rt rp summary bdi\", \"\", phrasingContent);\n\t\t\tadd(\"canvas\", \"width height\", flowContent);\n\t\t\tadd(\"video\", \"src crossorigin poster preload autoplay mediagroup loop \" +\n\t\t\t\t\"muted controls width height buffered\", flowContent, \"track source\");\n\t\t\tadd(\"audio\", \"src crossorigin preload autoplay mediagroup loop muted controls buffered volume\", flowContent, \"track source\");\n\t\t\tadd(\"picture\", \"\", \"img source\");\n\t\t\tadd(\"source\", \"src srcset type media sizes\");\n\t\t\tadd(\"track\", \"kind src srclang label default\");\n\t\t\tadd(\"datalist\", \"\", phrasingContent, \"option\");\n\t\t\tadd(\"article section nav aside header footer\", \"\", flowContent);\n\t\t\tadd(\"hgroup\", \"\", \"h1 h2 h3 h4 h5 h6\");\n\t\t\tadd(\"figure\", \"\", flowContent, \"figcaption\");\n\t\t\tadd(\"time\", \"datetime\", phrasingContent);\n\t\t\tadd(\"dialog\", \"open\", flowContent);\n\t\t\tadd(\"command\", \"type label icon disabled checked radiogroup command\");\n\t\t\tadd(\"output\", \"for form name\", phrasingContent);\n\t\t\tadd(\"progress\", \"value max\", phrasingContent);\n\t\t\tadd(\"meter\", \"value min max low high optimum\", phrasingContent);\n\t\t\tadd(\"details\", \"open\", flowContent, \"summary\");\n\t\t\tadd(\"keygen\", \"autofocus challenge disabled form keytype name\");\n\t\t}\n\n\t\t// Extend with HTML4 attributes unless it's html5-strict\n\t\tif (type != \"html5-strict\") {\n\t\t\taddAttrs(\"script\", \"language xml:space\");\n\t\t\taddAttrs(\"style\", \"xml:space\");\n\t\t\taddAttrs(\"object\", \"declare classid code codebase codetype archive standby align border hspace vspace\");\n\t\t\taddAttrs(\"embed\", \"align name hspace vspace\");\n\t\t\taddAttrs(\"param\", \"valuetype type\");\n\t\t\taddAttrs(\"a\", \"charset name rev shape coords\");\n\t\t\taddAttrs(\"br\", \"clear\");\n\t\t\taddAttrs(\"applet\", \"codebase archive code object alt name width height align hspace vspace\");\n\t\t\taddAttrs(\"img\", \"name longdesc align border hspace vspace\");\n\t\t\taddAttrs(\"iframe\", \"longdesc frameborder marginwidth marginheight scrolling align\");\n\t\t\taddAttrs(\"font basefont\", \"size color face\");\n\t\t\taddAttrs(\"input\", \"usemap align\");\n\t\t\taddAttrs(\"select\", \"onchange\");\n\t\t\taddAttrs(\"textarea\");\n\t\t\taddAttrs(\"h1 h2 h3 h4 h5 h6 div p legend caption\", \"align\");\n\t\t\taddAttrs(\"ul\", \"type compact\");\n\t\t\taddAttrs(\"li\", \"type\");\n\t\t\taddAttrs(\"ol dl menu dir\", \"compact\");\n\t\t\taddAttrs(\"pre\", \"width xml:space\");\n\t\t\taddAttrs(\"hr\", \"align noshade size width\");\n\t\t\taddAttrs(\"isindex\", \"prompt\");\n\t\t\taddAttrs(\"table\", \"summary width frame rules cellspacing cellpadding align bgcolor\");\n\t\t\taddAttrs(\"col\", \"width align char charoff valign\");\n\t\t\taddAttrs(\"colgroup\", \"width align char charoff valign\");\n\t\t\taddAttrs(\"thead\", \"align char charoff valign\");\n\t\t\taddAttrs(\"tr\", \"align char charoff valign bgcolor\");\n\t\t\taddAttrs(\"th\", \"axis align char charoff valign nowrap bgcolor width height\");\n\t\t\taddAttrs(\"form\", \"accept\");\n\t\t\taddAttrs(\"td\", \"abbr axis scope align char charoff valign nowrap bgcolor width height\");\n\t\t\taddAttrs(\"tfoot\", \"align char charoff valign\");\n\t\t\taddAttrs(\"tbody\", \"align char charoff valign\");\n\t\t\taddAttrs(\"area\", \"nohref\");\n\t\t\taddAttrs(\"body\", \"background bgcolor text link vlink alink\");\n\t\t}\n\n\t\t// Extend with HTML5 attributes unless it's html4\n\t\tif (type != \"html4\") {\n\t\t\taddAttrs(\"input button select textarea\", \"autofocus\");\n\t\t\taddAttrs(\"input textarea\", \"placeholder\");\n\t\t\taddAttrs(\"a\", \"download\");\n\t\t\taddAttrs(\"link script img\", \"crossorigin\");\n\t\t\taddAttrs(\"iframe\", \"sandbox seamless allowfullscreen\"); // Excluded: srcdoc\n\t\t}\n\n\t\t// Special: iframe, ruby, video, audio, label\n\n\t\t// Delete children of the same name from it's parent\n\t\t// For example: form can't have a child of the name form\n\t\teach(split('a form meter progress dfn'), function(name) {\n\t\t\tif (schema[name]) {\n\t\t\t\tdelete schema[name].children[name];\n\t\t\t}\n\t\t});\n\n\t\t// Delete header, footer, sectioning and heading content descendants\n\t\t/*each('dt th address', function(name) {\n\t\t\tdelete schema[name].children[name];\n\t\t});*/\n\n\t\t// Caption can't have tables\n\t\tdelete schema.caption.children.table;\n\n\t\t// Delete scripts by default due to possible XSS\n\t\tdelete schema.script;\n\n\t\t// TODO: LI:s can only have value if parent is OL\n\n\t\t// TODO: Handle transparent elements\n\t\t// a ins del canvas map\n\n\t\tmapCache[type] = schema;\n\n\t\treturn schema;\n\t}\n\n\tfunction compileElementMap(value, mode) {\n\t\tvar styles;\n\n\t\tif (value) {\n\t\t\tstyles = {};\n\n\t\t\tif (typeof value == 'string') {\n\t\t\t\tvalue = {\n\t\t\t\t\t'*': value\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Convert styles into a rule list\n\t\t\teach(value, function(value, key) {\n\t\t\t\tstyles[key] = styles[key.toUpperCase()] = mode == 'map' ? makeMap(value, /[, ]/) : explode(value, /[, ]/);\n\t\t\t});\n\t\t}\n\n\t\treturn styles;\n\t}\n\n\t/**\n\t * Constructs a new Schema instance.\n\t *\n\t * @constructor\n\t * @method Schema\n\t * @param {Object} settings Name/value settings object.\n\t */\n\treturn function(settings) {\n\t\tvar self = this, elements = {}, children = {}, patternElements = [], validStyles, invalidStyles, schemaItems;\n\t\tvar whiteSpaceElementsMap, selfClosingElementsMap, shortEndedElementsMap, boolAttrMap, validClasses;\n\t\tvar blockElementsMap, nonEmptyElementsMap, moveCaretBeforeOnEnterElementsMap, textBlockElementsMap, textInlineElementsMap;\n\t\tvar customElementsMap = {}, specialElements = {};\n\n\t\t// Creates an lookup table map object for the specified option or the default value\n\t\tfunction createLookupTable(option, default_value, extendWith) {\n\t\t\tvar value = settings[option];\n\n\t\t\tif (!value) {\n\t\t\t\t// Get cached default map or make it if needed\n\t\t\t\tvalue = mapCache[option];\n\n\t\t\t\tif (!value) {\n\t\t\t\t\tvalue = makeMap(default_value, ' ', makeMap(default_value.toUpperCase(), ' '));\n\t\t\t\t\tvalue = extend(value, extendWith);\n\n\t\t\t\t\tmapCache[option] = value;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Create custom map\n\t\t\t\tvalue = makeMap(value, /[, ]/, makeMap(value.toUpperCase(), /[, ]/));\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tsettings = settings || {};\n\t\tschemaItems = compileSchema(settings.schema);\n\n\t\t// Allow all elements and attributes if verify_html is set to false\n\t\tif (settings.verify_html === false) {\n\t\t\tsettings.valid_elements = '*[*]';\n\t\t}\n\n\t\tvalidStyles = compileElementMap(settings.valid_styles);\n\t\tinvalidStyles = compileElementMap(settings.invalid_styles, 'map');\n\t\tvalidClasses = compileElementMap(settings.valid_classes, 'map');\n\n\t\t// Setup map objects\n\t\twhiteSpaceElementsMap = createLookupTable('whitespace_elements', 'pre script noscript style textarea video audio iframe object');\n\t\tselfClosingElementsMap = createLookupTable('self_closing_elements', 'colgroup dd dt li option p td tfoot th thead tr');\n\t\tshortEndedElementsMap = createLookupTable('short_ended_elements', 'area base basefont br col frame hr img input isindex link ' +\n\t\t\t'meta param embed source wbr track');\n\t\tboolAttrMap = createLookupTable('boolean_attributes', 'checked compact declare defer disabled ismap multiple nohref noresize ' +\n\t\t\t'noshade nowrap readonly selected autoplay loop controls');\n\t\tnonEmptyElementsMap = createLookupTable('non_empty_elements', 'td th iframe video audio object script', shortEndedElementsMap);\n\t\tmoveCaretBeforeOnEnterElementsMap = createLookupTable('move_caret_before_on_enter_elements', 'table', nonEmptyElementsMap);\n\t\ttextBlockElementsMap = createLookupTable('text_block_elements', 'h1 h2 h3 h4 h5 h6 p div address pre form ' +\n\t\t\t\t\t\t'blockquote center dir fieldset header footer article section hgroup aside nav figure');\n\t\tblockElementsMap = createLookupTable('block_elements', 'hr table tbody thead tfoot ' +\n\t\t\t\t\t\t'th tr td li ol ul caption dl dt dd noscript menu isindex option ' +\n\t\t\t\t\t\t'datalist select optgroup figcaption', textBlockElementsMap);\n\t\ttextInlineElementsMap = createLookupTable('text_inline_elements', 'span strong b em i font strike u var cite ' +\n\t\t\t\t\t\t\t\t\t\t'dfn code mark q sup sub samp');\n\n\t\teach((settings.special || 'script noscript style textarea').split(' '), function(name) {\n\t\t\tspecialElements[name] = new RegExp('<\\/' + name + '[^>]*>', 'gi');\n\t\t});\n\n\t\t// Converts a wildcard expression string to a regexp for example *a will become /.*a/.\n\t\tfunction patternToRegExp(str) {\n\t\t\treturn new RegExp('^' + str.replace(/([?+*])/g, '.$1') + '$');\n\t\t}\n\n\t\t// Parses the specified valid_elements string and adds to the current rules\n\t\t// This function is a bit hard to read since it's heavily optimized for speed\n\t\tfunction addValidElements(validElements) {\n\t\t\tvar ei, el, ai, al, matches, element, attr, attrData, elementName, attrName, attrType, attributes, attributesOrder,\n\t\t\t\tprefix, outputName, globalAttributes, globalAttributesOrder, key, value,\n\t\t\t\telementRuleRegExp = /^([#+\\-])?([^\\[!\\/]+)(?:\\/([^\\[!]+))?(?:(!?)\\[([^\\]]+)\\])?$/,\n\t\t\t\tattrRuleRegExp = /^([!\\-])?(\\w+::\\w+|[^=:<]+)?(?:([=:<])(.*))?$/,\n\t\t\t\thasPatternsRegExp = /[*?+]/;\n\n\t\t\tif (validElements) {\n\t\t\t\t// Split valid elements into an array with rules\n\t\t\t\tvalidElements = split(validElements, ',');\n\n\t\t\t\tif (elements['@']) {\n\t\t\t\t\tglobalAttributes = elements['@'].attributes;\n\t\t\t\t\tglobalAttributesOrder = elements['@'].attributesOrder;\n\t\t\t\t}\n\n\t\t\t\t// Loop all rules\n\t\t\t\tfor (ei = 0, el = validElements.length; ei < el; ei++) {\n\t\t\t\t\t// Parse element rule\n\t\t\t\t\tmatches = elementRuleRegExp.exec(validElements[ei]);\n\t\t\t\t\tif (matches) {\n\t\t\t\t\t\t// Setup local names for matches\n\t\t\t\t\t\tprefix = matches[1];\n\t\t\t\t\t\telementName = matches[2];\n\t\t\t\t\t\toutputName = matches[3];\n\t\t\t\t\t\tattrData = matches[5];\n\n\t\t\t\t\t\t// Create new attributes and attributesOrder\n\t\t\t\t\t\tattributes = {};\n\t\t\t\t\t\tattributesOrder = [];\n\n\t\t\t\t\t\t// Create the new element\n\t\t\t\t\t\telement = {\n\t\t\t\t\t\t\tattributes: attributes,\n\t\t\t\t\t\t\tattributesOrder: attributesOrder\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Padd empty elements prefix\n\t\t\t\t\t\tif (prefix === '#') {\n\t\t\t\t\t\t\telement.paddEmpty = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Remove empty elements prefix\n\t\t\t\t\t\tif (prefix === '-') {\n\t\t\t\t\t\t\telement.removeEmpty = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (matches[4] === '!') {\n\t\t\t\t\t\t\telement.removeEmptyAttrs = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Copy attributes from global rule into current rule\n\t\t\t\t\t\tif (globalAttributes) {\n\t\t\t\t\t\t\tfor (key in globalAttributes) {\n\t\t\t\t\t\t\t\tattributes[key] = globalAttributes[key];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tattributesOrder.push.apply(attributesOrder, globalAttributesOrder);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Attributes defined\n\t\t\t\t\t\tif (attrData) {\n\t\t\t\t\t\t\tattrData = split(attrData, '|');\n\t\t\t\t\t\t\tfor (ai = 0, al = attrData.length; ai < al; ai++) {\n\t\t\t\t\t\t\t\tmatches = attrRuleRegExp.exec(attrData[ai]);\n\t\t\t\t\t\t\t\tif (matches) {\n\t\t\t\t\t\t\t\t\tattr = {};\n\t\t\t\t\t\t\t\t\tattrType = matches[1];\n\t\t\t\t\t\t\t\t\tattrName = matches[2].replace(/::/g, ':');\n\t\t\t\t\t\t\t\t\tprefix = matches[3];\n\t\t\t\t\t\t\t\t\tvalue = matches[4];\n\n\t\t\t\t\t\t\t\t\t// Required\n\t\t\t\t\t\t\t\t\tif (attrType === '!') {\n\t\t\t\t\t\t\t\t\t\telement.attributesRequired = element.attributesRequired || [];\n\t\t\t\t\t\t\t\t\t\telement.attributesRequired.push(attrName);\n\t\t\t\t\t\t\t\t\t\tattr.required = true;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Denied from global\n\t\t\t\t\t\t\t\t\tif (attrType === '-') {\n\t\t\t\t\t\t\t\t\t\tdelete attributes[attrName];\n\t\t\t\t\t\t\t\t\t\tattributesOrder.splice(inArray(attributesOrder, attrName), 1);\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Default value\n\t\t\t\t\t\t\t\t\tif (prefix) {\n\t\t\t\t\t\t\t\t\t\t// Default value\n\t\t\t\t\t\t\t\t\t\tif (prefix === '=') {\n\t\t\t\t\t\t\t\t\t\t\telement.attributesDefault = element.attributesDefault || [];\n\t\t\t\t\t\t\t\t\t\t\telement.attributesDefault.push({name: attrName, value: value});\n\t\t\t\t\t\t\t\t\t\t\tattr.defaultValue = value;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t// Forced value\n\t\t\t\t\t\t\t\t\t\tif (prefix === ':') {\n\t\t\t\t\t\t\t\t\t\t\telement.attributesForced = element.attributesForced || [];\n\t\t\t\t\t\t\t\t\t\t\telement.attributesForced.push({name: attrName, value: value});\n\t\t\t\t\t\t\t\t\t\t\tattr.forcedValue = value;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t// Required values\n\t\t\t\t\t\t\t\t\t\tif (prefix === '<') {\n\t\t\t\t\t\t\t\t\t\t\tattr.validValues = makeMap(value, '?');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Check for attribute patterns\n\t\t\t\t\t\t\t\t\tif (hasPatternsRegExp.test(attrName)) {\n\t\t\t\t\t\t\t\t\t\telement.attributePatterns = element.attributePatterns || [];\n\t\t\t\t\t\t\t\t\t\tattr.pattern = patternToRegExp(attrName);\n\t\t\t\t\t\t\t\t\t\telement.attributePatterns.push(attr);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t// Add attribute to order list if it doesn't already exist\n\t\t\t\t\t\t\t\t\t\tif (!attributes[attrName]) {\n\t\t\t\t\t\t\t\t\t\t\tattributesOrder.push(attrName);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tattributes[attrName] = attr;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Global rule, store away these for later usage\n\t\t\t\t\t\tif (!globalAttributes && elementName == '@') {\n\t\t\t\t\t\t\tglobalAttributes = attributes;\n\t\t\t\t\t\t\tglobalAttributesOrder = attributesOrder;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Handle substitute elements such as b/strong\n\t\t\t\t\t\tif (outputName) {\n\t\t\t\t\t\t\telement.outputName = elementName;\n\t\t\t\t\t\t\telements[outputName] = element;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Add pattern or exact element\n\t\t\t\t\t\tif (hasPatternsRegExp.test(elementName)) {\n\t\t\t\t\t\t\telement.pattern = patternToRegExp(elementName);\n\t\t\t\t\t\t\tpatternElements.push(element);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telements[elementName] = element;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction setValidElements(validElements) {\n\t\t\telements = {};\n\t\t\tpatternElements = [];\n\n\t\t\taddValidElements(validElements);\n\n\t\t\teach(schemaItems, function(element, name) {\n\t\t\t\tchildren[name] = element.children;\n\t\t\t});\n\t\t}\n\n\t\t// Adds custom non HTML elements to the schema\n\t\tfunction addCustomElements(customElements) {\n\t\t\tvar customElementRegExp = /^(~)?(.+)$/;\n\n\t\t\tif (customElements) {\n\t\t\t\t// Flush cached items since we are altering the default maps\n\t\t\t\tmapCache.text_block_elements = mapCache.block_elements = null;\n\n\t\t\t\teach(split(customElements, ','), function(rule) {\n\t\t\t\t\tvar matches = customElementRegExp.exec(rule),\n\t\t\t\t\t\tinline = matches[1] === '~',\n\t\t\t\t\t\tcloneName = inline ? 'span' : 'div',\n\t\t\t\t\t\tname = matches[2];\n\n\t\t\t\t\tchildren[name] = children[cloneName];\n\t\t\t\t\tcustomElementsMap[name] = cloneName;\n\n\t\t\t\t\t// If it's not marked as inline then add it to valid block elements\n\t\t\t\t\tif (!inline) {\n\t\t\t\t\t\tblockElementsMap[name.toUpperCase()] = {};\n\t\t\t\t\t\tblockElementsMap[name] = {};\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add elements clone if needed\n\t\t\t\t\tif (!elements[name]) {\n\t\t\t\t\t\tvar customRule = elements[cloneName];\n\n\t\t\t\t\t\tcustomRule = extend({}, customRule);\n\t\t\t\t\t\tdelete customRule.removeEmptyAttrs;\n\t\t\t\t\t\tdelete customRule.removeEmpty;\n\n\t\t\t\t\t\telements[name] = customRule;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add custom elements at span/div positions\n\t\t\t\t\teach(children, function(element, elmName) {\n\t\t\t\t\t\tif (element[cloneName]) {\n\t\t\t\t\t\t\tchildren[elmName] = element = extend({}, children[elmName]);\n\t\t\t\t\t\t\telement[name] = element[cloneName];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Adds valid children to the schema object\n\t\tfunction addValidChildren(validChildren) {\n\t\t\tvar childRuleRegExp = /^([+\\-]?)(\\w+)\\[([^\\]]+)\\]$/;\n\n\t\t\t// Invalidate the schema cache if the schema is mutated\n\t\t\tmapCache[settings.schema] = null;\n\n\t\t\tif (validChildren) {\n\t\t\t\teach(split(validChildren, ','), function(rule) {\n\t\t\t\t\tvar matches = childRuleRegExp.exec(rule), parent, prefix;\n\n\t\t\t\t\tif (matches) {\n\t\t\t\t\t\tprefix = matches[1];\n\n\t\t\t\t\t\t// Add/remove items from default\n\t\t\t\t\t\tif (prefix) {\n\t\t\t\t\t\t\tparent = children[matches[2]];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tparent = children[matches[2]] = {'#comment': {}};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tparent = children[matches[2]];\n\n\t\t\t\t\t\teach(split(matches[3], '|'), function(child) {\n\t\t\t\t\t\t\tif (prefix === '-') {\n\t\t\t\t\t\t\t\tdelete parent[child];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tparent[child] = {};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction getElementRule(name) {\n\t\t\tvar element = elements[name], i;\n\n\t\t\t// Exact match found\n\t\t\tif (element) {\n\t\t\t\treturn element;\n\t\t\t}\n\n\t\t\t// No exact match then try the patterns\n\t\t\ti = patternElements.length;\n\t\t\twhile (i--) {\n\t\t\t\telement = patternElements[i];\n\n\t\t\t\tif (element.pattern.test(name)) {\n\t\t\t\t\treturn element;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!settings.valid_elements) {\n\t\t\t// No valid elements defined then clone the elements from the schema spec\n\t\t\teach(schemaItems, function(element, name) {\n\t\t\t\telements[name] = {\n\t\t\t\t\tattributes: element.attributes,\n\t\t\t\t\tattributesOrder: element.attributesOrder\n\t\t\t\t};\n\n\t\t\t\tchildren[name] = element.children;\n\t\t\t});\n\n\t\t\t// Switch these on HTML4\n\t\t\tif (settings.schema != \"html5\") {\n\t\t\t\teach(split('strong/b em/i'), function(item) {\n\t\t\t\t\titem = split(item, '/');\n\t\t\t\t\telements[item[1]].outputName = item[0];\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Add default alt attribute for images, removed since alt=\"\" is treated as presentational.\n\t\t\t// elements.img.attributesDefault = [{name: 'alt', value: ''}];\n\n\t\t\t// Remove these if they are empty by default\n\t\t\teach(split('ol ul sub sup blockquote span font a table tbody tr strong em b i'), function(name) {\n\t\t\t\tif (elements[name]) {\n\t\t\t\t\telements[name].removeEmpty = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Padd these by default\n\t\t\teach(split('p h1 h2 h3 h4 h5 h6 th td pre div address caption'), function(name) {\n\t\t\t\telements[name].paddEmpty = true;\n\t\t\t});\n\n\t\t\t// Remove these if they have no attributes\n\t\t\teach(split('span'), function(name) {\n\t\t\t\telements[name].removeEmptyAttrs = true;\n\t\t\t});\n\n\t\t\t// Remove these by default\n\t\t\t// TODO: Reenable in 4.1\n\t\t\t/*each(split('script style'), function(name) {\n\t\t\t\tdelete elements[name];\n\t\t\t});*/\n\t\t} else {\n\t\t\tsetValidElements(settings.valid_elements);\n\t\t}\n\n\t\taddCustomElements(settings.custom_elements);\n\t\taddValidChildren(settings.valid_children);\n\t\taddValidElements(settings.extended_valid_elements);\n\n\t\t// Todo: Remove this when we fix list handling to be valid\n\t\taddValidChildren('+ol[ul|ol],+ul[ul|ol]');\n\n\t\t// Delete invalid elements\n\t\tif (settings.invalid_elements) {\n\t\t\teach(explode(settings.invalid_elements), function(item) {\n\t\t\t\tif (elements[item]) {\n\t\t\t\t\tdelete elements[item];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// If the user didn't allow span only allow internal spans\n\t\tif (!getElementRule('span')) {\n\t\t\taddValidElements('span[!data-mce-type|*]');\n\t\t}\n\n\t\t/**\n\t\t * Name/value map object with valid parents and children to those parents.\n\t\t *\n\t\t * @example\n\t\t * children = {\n\t\t *    div:{p:{}, h1:{}}\n\t\t * };\n\t\t * @field children\n\t\t * @type Object\n\t\t */\n\t\tself.children = children;\n\n\t\t/**\n\t\t * Name/value map object with valid styles for each element.\n\t\t *\n\t\t * @method getValidStyles\n\t\t * @type Object\n\t\t */\n\t\tself.getValidStyles = function() {\n\t\t\treturn validStyles;\n\t\t};\n\n\t\t/**\n\t\t * Name/value map object with valid styles for each element.\n\t\t *\n\t\t * @method getInvalidStyles\n\t\t * @type Object\n\t\t */\n\t\tself.getInvalidStyles = function() {\n\t\t\treturn invalidStyles;\n\t\t};\n\n\t\t/**\n\t\t * Name/value map object with valid classes for each element.\n\t\t *\n\t\t * @method getValidClasses\n\t\t * @type Object\n\t\t */\n\t\tself.getValidClasses = function() {\n\t\t\treturn validClasses;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with boolean attributes.\n\t\t *\n\t\t * @method getBoolAttrs\n\t\t * @return {Object} Name/value lookup map for boolean attributes.\n\t\t */\n\t\tself.getBoolAttrs = function() {\n\t\t\treturn boolAttrMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with block elements.\n\t\t *\n\t\t * @method getBlockElements\n\t\t * @return {Object} Name/value lookup map for block elements.\n\t\t */\n\t\tself.getBlockElements = function() {\n\t\t\treturn blockElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with text block elements. Such as: p,h1-h6,div,address\n\t\t *\n\t\t * @method getTextBlockElements\n\t\t * @return {Object} Name/value lookup map for block elements.\n\t\t */\n\t\tself.getTextBlockElements = function() {\n\t\t\treturn textBlockElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map of inline text format nodes for example strong/span or ins.\n\t\t *\n\t\t * @method getTextInlineElements\n\t\t * @return {Object} Name/value lookup map for text format elements.\n\t\t */\n\t\tself.getTextInlineElements = function() {\n\t\t\treturn textInlineElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with short ended elements such as BR or IMG.\n\t\t *\n\t\t * @method getShortEndedElements\n\t\t * @return {Object} Name/value lookup map for short ended elements.\n\t\t */\n\t\tself.getShortEndedElements = function() {\n\t\t\treturn shortEndedElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with self closing tags such as <li>.\n\t\t *\n\t\t * @method getSelfClosingElements\n\t\t * @return {Object} Name/value lookup map for self closing tags elements.\n\t\t */\n\t\tself.getSelfClosingElements = function() {\n\t\t\treturn selfClosingElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with elements that should be treated as contents regardless if it has text\n\t\t * content in them or not such as TD, VIDEO or IMG.\n\t\t *\n\t\t * @method getNonEmptyElements\n\t\t * @return {Object} Name/value lookup map for non empty elements.\n\t\t */\n\t\tself.getNonEmptyElements = function() {\n\t\t\treturn nonEmptyElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with elements that the caret should be moved in front of after enter is\n\t\t * pressed\n\t\t *\n\t\t * @method getMoveCaretBeforeOnEnterElements\n\t\t * @return {Object} Name/value lookup map for elements to place the caret in front of.\n\t\t */\n\t\tself.getMoveCaretBeforeOnEnterElements = function() {\n\t\t\treturn moveCaretBeforeOnEnterElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with elements where white space is to be preserved like PRE or SCRIPT.\n\t\t *\n\t\t * @method getWhiteSpaceElements\n\t\t * @return {Object} Name/value lookup map for white space elements.\n\t\t */\n\t\tself.getWhiteSpaceElements = function() {\n\t\t\treturn whiteSpaceElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Returns a map with special elements. These are elements that needs to be parsed\n\t\t * in a special way such as script, style, textarea etc. The map object values\n\t\t * are regexps used to find the end of the element.\n\t\t *\n\t\t * @method getSpecialElements\n\t\t * @return {Object} Name/value lookup map for special elements.\n\t\t */\n\t\tself.getSpecialElements = function() {\n\t\t\treturn specialElements;\n\t\t};\n\n\t\t/**\n\t\t * Returns true/false if the specified element and it's child is valid or not\n\t\t * according to the schema.\n\t\t *\n\t\t * @method isValidChild\n\t\t * @param {String} name Element name to check for.\n\t\t * @param {String} child Element child to verify.\n\t\t * @return {Boolean} True/false if the element is a valid child of the specified parent.\n\t\t */\n\t\tself.isValidChild = function(name, child) {\n\t\t\tvar parent = children[name];\n\n\t\t\treturn !!(parent && parent[child]);\n\t\t};\n\n\t\t/**\n\t\t * Returns true/false if the specified element name and optional attribute is\n\t\t * valid according to the schema.\n\t\t *\n\t\t * @method isValid\n\t\t * @param {String} name Name of element to check.\n\t\t * @param {String} attr Optional attribute name to check for.\n\t\t * @return {Boolean} True/false if the element and attribute is valid.\n\t\t */\n\t\tself.isValid = function(name, attr) {\n\t\t\tvar attrPatterns, i, rule = getElementRule(name);\n\n\t\t\t// Check if it's a valid element\n\t\t\tif (rule) {\n\t\t\t\tif (attr) {\n\t\t\t\t\t// Check if attribute name exists\n\t\t\t\t\tif (rule.attributes[attr]) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Check if attribute matches a regexp pattern\n\t\t\t\t\tattrPatterns = rule.attributePatterns;\n\t\t\t\t\tif (attrPatterns) {\n\t\t\t\t\t\ti = attrPatterns.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tif (attrPatterns[i].pattern.test(name)) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// No match\n\t\t\treturn false;\n\t\t};\n\n\t\t/**\n\t\t * Returns true/false if the specified element is valid or not\n\t\t * according to the schema.\n\t\t *\n\t\t * @method getElementRule\n\t\t * @param {String} name Element name to check for.\n\t\t * @return {Object} Element object or undefined if the element isn't valid.\n\t\t */\n\t\tself.getElementRule = getElementRule;\n\n\t\t/**\n\t\t * Returns an map object of all custom elements.\n\t\t *\n\t\t * @method getCustomElements\n\t\t * @return {Object} Name/value map object of all custom elements.\n\t\t */\n\t\tself.getCustomElements = function() {\n\t\t\treturn customElementsMap;\n\t\t};\n\n\t\t/**\n\t\t * Parses a valid elements string and adds it to the schema. The valid elements\n\t\t * format is for example \"element[attr=default|otherattr]\".\n\t\t * Existing rules will be replaced with the ones specified, so this extends the schema.\n\t\t *\n\t\t * @method addValidElements\n\t\t * @param {String} valid_elements String in the valid elements format to be parsed.\n\t\t */\n\t\tself.addValidElements = addValidElements;\n\n\t\t/**\n\t\t * Parses a valid elements string and sets it to the schema. The valid elements\n\t\t * format is for example \"element[attr=default|otherattr]\".\n\t\t * Existing rules will be replaced with the ones specified, so this extends the schema.\n\t\t *\n\t\t * @method setValidElements\n\t\t * @param {String} valid_elements String in the valid elements format to be parsed.\n\t\t */\n\t\tself.setValidElements = setValidElements;\n\n\t\t/**\n\t\t * Adds custom non HTML elements to the schema.\n\t\t *\n\t\t * @method addCustomElements\n\t\t * @param {String} custom_elements Comma separated list of custom elements to add.\n\t\t */\n\t\tself.addCustomElements = addCustomElements;\n\n\t\t/**\n\t\t * Parses a valid children string and adds them to the schema structure. The valid children\n\t\t * format is for example: \"element[child1|child2]\".\n\t\t *\n\t\t * @method addValidChildren\n\t\t * @param {String} valid_children Valid children elements string to parse\n\t\t */\n\t\tself.addValidChildren = addValidChildren;\n\n\t\tself.elements = elements;\n\t};\n});\n\n// Included from: js/tinymce/classes/html/SaxParser.js\n\n/**\n * SaxParser.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*eslint max-depth:[2, 9] */\n\n/**\n * This class parses HTML code using pure JavaScript and executes various events for each item it finds. It will\n * always execute the events in the right order for tag soup code like <b><p></b></p>. It will also remove elements\n * and attributes that doesn't fit the schema if the validate setting is enabled.\n *\n * @example\n * var parser = new tinymce.html.SaxParser({\n *     validate: true,\n *\n *     comment: function(text) {\n *         console.log('Comment:', text);\n *     },\n *\n *     cdata: function(text) {\n *         console.log('CDATA:', text);\n *     },\n *\n *     text: function(text, raw) {\n *         console.log('Text:', text, 'Raw:', raw);\n *     },\n *\n *     start: function(name, attrs, empty) {\n *         console.log('Start:', name, attrs, empty);\n *     },\n *\n *     end: function(name) {\n *         console.log('End:', name);\n *     },\n *\n *     pi: function(name, text) {\n *         console.log('PI:', name, text);\n *     },\n *\n *     doctype: function(text) {\n *         console.log('DocType:', text);\n *     }\n * }, schema);\n * @class tinymce.html.SaxParser\n * @version 3.4\n */\ndefine(\"tinymce/html/SaxParser\", [\n\t\"tinymce/html/Schema\",\n\t\"tinymce/html/Entities\",\n\t\"tinymce/util/Tools\"\n], function(Schema, Entities, Tools) {\n\tvar each = Tools.each;\n\n\t/**\n\t * Returns the index of the end tag for a specific start tag. This can be\n\t * used to skip all children of a parent element from being processed.\n\t *\n\t * @private\n\t * @method findEndTag\n\t * @param {tinymce.html.Schema} schema Schema instance to use to match short ended elements.\n\t * @param {String} html HTML string to find the end tag in.\n\t * @param {Number} startIndex Indext to start searching at should be after the start tag.\n\t * @return {Number} Index of the end tag.\n\t */\n\tfunction findEndTag(schema, html, startIndex) {\n\t\tvar count = 1, index, matches, tokenRegExp, shortEndedElements;\n\n\t\tshortEndedElements = schema.getShortEndedElements();\n\t\ttokenRegExp = /<([!?\\/])?([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\/|\\s+)>/g;\n\t\ttokenRegExp.lastIndex = index = startIndex;\n\n\t\twhile ((matches = tokenRegExp.exec(html))) {\n\t\t\tindex = tokenRegExp.lastIndex;\n\n\t\t\tif (matches[1] === '/') { // End element\n\t\t\t\tcount--;\n\t\t\t} else if (!matches[1]) { // Start element\n\t\t\t\tif (matches[2] in shortEndedElements) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tcount++;\n\t\t\t}\n\n\t\t\tif (count === 0) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn index;\n\t}\n\n\t/**\n\t * Constructs a new SaxParser instance.\n\t *\n\t * @constructor\n\t * @method SaxParser\n\t * @param {Object} settings Name/value collection of settings. comment, cdata, text, start and end are callbacks.\n\t * @param {tinymce.html.Schema} schema HTML Schema class to use when parsing.\n\t */\n\tfunction SaxParser(settings, schema) {\n\t\tvar self = this;\n\n\t\tfunction noop() {}\n\n\t\tsettings = settings || {};\n\t\tself.schema = schema = schema || new Schema();\n\n\t\tif (settings.fix_self_closing !== false) {\n\t\t\tsettings.fix_self_closing = true;\n\t\t}\n\n\t\t// Add handler functions from settings and setup default handlers\n\t\teach('comment cdata text start end pi doctype'.split(' '), function(name) {\n\t\t\tif (name) {\n\t\t\t\tself[name] = settings[name] || noop;\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Parses the specified HTML string and executes the callbacks for each item it finds.\n\t\t *\n\t\t * @example\n\t\t * new SaxParser({...}).parse('<b>text</b>');\n\t\t * @method parse\n\t\t * @param {String} html Html string to sax parse.\n\t\t */\n\t\tself.parse = function(html) {\n\t\t\tvar self = this, matches, index = 0, value, endRegExp, stack = [], attrList, i, text, name;\n\t\t\tvar isInternalElement, removeInternalElements, shortEndedElements, fillAttrsMap, isShortEnded;\n\t\t\tvar validate, elementRule, isValidElement, attr, attribsValue, validAttributesMap, validAttributePatterns;\n\t\t\tvar attributesRequired, attributesDefault, attributesForced;\n\t\t\tvar anyAttributesRequired, selfClosing, tokenRegExp, attrRegExp, specialElements, attrValue, idCount = 0;\n\t\t\tvar decode = Entities.decode, fixSelfClosing, filteredUrlAttrs = Tools.makeMap('src,href,data,background,formaction,poster');\n\t\t\tvar scriptUriRegExp = /((java|vb)script|mhtml):/i, dataUriRegExp = /^data:/i;\n\n\t\t\tfunction processEndTag(name) {\n\t\t\t\tvar pos, i;\n\n\t\t\t\t// Find position of parent of the same type\n\t\t\t\tpos = stack.length;\n\t\t\t\twhile (pos--) {\n\t\t\t\t\tif (stack[pos].name === name) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Found parent\n\t\t\t\tif (pos >= 0) {\n\t\t\t\t\t// Close all the open elements\n\t\t\t\t\tfor (i = stack.length - 1; i >= pos; i--) {\n\t\t\t\t\t\tname = stack[i];\n\n\t\t\t\t\t\tif (name.valid) {\n\t\t\t\t\t\t\tself.end(name.name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove the open elements from the stack\n\t\t\t\t\tstack.length = pos;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction parseAttribute(match, name, value, val2, val3) {\n\t\t\t\tvar attrRule, i, trimRegExp = /[\\s\\u0000-\\u001F]+/g;\n\n\t\t\t\tname = name.toLowerCase();\n\t\t\t\tvalue = name in fillAttrsMap ? name : decode(value || val2 || val3 || ''); // Handle boolean attribute than value attribute\n\n\t\t\t\t// Validate name and value pass through all data- attributes\n\t\t\t\tif (validate && !isInternalElement && name.indexOf('data-') !== 0) {\n\t\t\t\t\tattrRule = validAttributesMap[name];\n\n\t\t\t\t\t// Find rule by pattern matching\n\t\t\t\t\tif (!attrRule && validAttributePatterns) {\n\t\t\t\t\t\ti = validAttributePatterns.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tattrRule = validAttributePatterns[i];\n\t\t\t\t\t\t\tif (attrRule.pattern.test(name)) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// No rule matched\n\t\t\t\t\t\tif (i === -1) {\n\t\t\t\t\t\t\tattrRule = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// No attribute rule found\n\t\t\t\t\tif (!attrRule) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Validate value\n\t\t\t\t\tif (attrRule.validValues && !(value in attrRule.validValues)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Block any javascript: urls or non image data uris\n\t\t\t\tif (filteredUrlAttrs[name] && !settings.allow_script_urls) {\n\t\t\t\t\tvar uri = value.replace(trimRegExp, '');\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Might throw malformed URI sequence\n\t\t\t\t\t\turi = decodeURIComponent(uri);\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// Fallback to non UTF-8 decoder\n\t\t\t\t\t\turi = unescape(uri);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (scriptUriRegExp.test(uri)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!settings.allow_html_data_urls && dataUriRegExp.test(uri) && !/^data:image\\//i.test(uri)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Add attribute to list and map\n\t\t\t\tattrList.map[name] = value;\n\t\t\t\tattrList.push({\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Precompile RegExps and map objects\n\t\t\ttokenRegExp = new RegExp('<(?:' +\n\t\t\t\t'(?:!--([\\\\w\\\\W]*?)-->)|' + // Comment\n\t\t\t\t'(?:!\\\\[CDATA\\\\[([\\\\w\\\\W]*?)\\\\]\\\\]>)|' + // CDATA\n\t\t\t\t'(?:!DOCTYPE([\\\\w\\\\W]*?)>)|' + // DOCTYPE\n\t\t\t\t'(?:\\\\?([^\\\\s\\\\/<>]+) ?([\\\\w\\\\W]*?)[?/]>)|' + // PI\n\t\t\t\t'(?:\\\\/([^>]+)>)|' + // End element\n\t\t\t\t'(?:([A-Za-z0-9\\\\-_\\\\:\\\\.]+)((?:\\\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\\\/|\\\\s+)>)' + // Start element\n\t\t\t')', 'g');\n\n\t\t\tattrRegExp = /([\\w:\\-]+)(?:\\s*=\\s*(?:(?:\\\"((?:[^\\\"])*)\\\")|(?:\\'((?:[^\\'])*)\\')|([^>\\s]+)))?/g;\n\n\t\t\t// Setup lookup tables for empty elements and boolean attributes\n\t\t\tshortEndedElements = schema.getShortEndedElements();\n\t\t\tselfClosing = settings.self_closing_elements || schema.getSelfClosingElements();\n\t\t\tfillAttrsMap = schema.getBoolAttrs();\n\t\t\tvalidate = settings.validate;\n\t\t\tremoveInternalElements = settings.remove_internals;\n\t\t\tfixSelfClosing = settings.fix_self_closing;\n\t\t\tspecialElements = schema.getSpecialElements();\n\n\t\t\twhile ((matches = tokenRegExp.exec(html))) {\n\t\t\t\t// Text\n\t\t\t\tif (index < matches.index) {\n\t\t\t\t\tself.text(decode(html.substr(index, matches.index - index)));\n\t\t\t\t}\n\n\t\t\t\tif ((value = matches[6])) { // End element\n\t\t\t\t\tvalue = value.toLowerCase();\n\n\t\t\t\t\t// IE will add a \":\" in front of elements it doesn't understand like custom elements or HTML5 elements\n\t\t\t\t\tif (value.charAt(0) === ':') {\n\t\t\t\t\t\tvalue = value.substr(1);\n\t\t\t\t\t}\n\n\t\t\t\t\tprocessEndTag(value);\n\t\t\t\t} else if ((value = matches[7])) { // Start element\n\t\t\t\t\tvalue = value.toLowerCase();\n\n\t\t\t\t\t// IE will add a \":\" in front of elements it doesn't understand like custom elements or HTML5 elements\n\t\t\t\t\tif (value.charAt(0) === ':') {\n\t\t\t\t\t\tvalue = value.substr(1);\n\t\t\t\t\t}\n\n\t\t\t\t\tisShortEnded = value in shortEndedElements;\n\n\t\t\t\t\t// Is self closing tag for example an <li> after an open <li>\n\t\t\t\t\tif (fixSelfClosing && selfClosing[value] && stack.length > 0 && stack[stack.length - 1].name === value) {\n\t\t\t\t\t\tprocessEndTag(value);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Validate element\n\t\t\t\t\tif (!validate || (elementRule = schema.getElementRule(value))) {\n\t\t\t\t\t\tisValidElement = true;\n\n\t\t\t\t\t\t// Grab attributes map and patters when validation is enabled\n\t\t\t\t\t\tif (validate) {\n\t\t\t\t\t\t\tvalidAttributesMap = elementRule.attributes;\n\t\t\t\t\t\t\tvalidAttributePatterns = elementRule.attributePatterns;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Parse attributes\n\t\t\t\t\t\tif ((attribsValue = matches[8])) {\n\t\t\t\t\t\t\tisInternalElement = attribsValue.indexOf('data-mce-type') !== -1; // Check if the element is an internal element\n\n\t\t\t\t\t\t\t// If the element has internal attributes then remove it if we are told to do so\n\t\t\t\t\t\t\tif (isInternalElement && removeInternalElements) {\n\t\t\t\t\t\t\t\tisValidElement = false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tattrList = [];\n\t\t\t\t\t\t\tattrList.map = {};\n\n\t\t\t\t\t\t\tattribsValue.replace(attrRegExp, parseAttribute);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tattrList = [];\n\t\t\t\t\t\t\tattrList.map = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Process attributes if validation is enabled\n\t\t\t\t\t\tif (validate && !isInternalElement) {\n\t\t\t\t\t\t\tattributesRequired = elementRule.attributesRequired;\n\t\t\t\t\t\t\tattributesDefault = elementRule.attributesDefault;\n\t\t\t\t\t\t\tattributesForced = elementRule.attributesForced;\n\t\t\t\t\t\t\tanyAttributesRequired = elementRule.removeEmptyAttrs;\n\n\t\t\t\t\t\t\t// Check if any attribute exists\n\t\t\t\t\t\t\tif (anyAttributesRequired && !attrList.length) {\n\t\t\t\t\t\t\t\tisValidElement = false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Handle forced attributes\n\t\t\t\t\t\t\tif (attributesForced) {\n\t\t\t\t\t\t\t\ti = attributesForced.length;\n\t\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\t\tattr = attributesForced[i];\n\t\t\t\t\t\t\t\t\tname = attr.name;\n\t\t\t\t\t\t\t\t\tattrValue = attr.value;\n\n\t\t\t\t\t\t\t\t\tif (attrValue === '{$uid}') {\n\t\t\t\t\t\t\t\t\t\tattrValue = 'mce_' + idCount++;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tattrList.map[name] = attrValue;\n\t\t\t\t\t\t\t\t\tattrList.push({name: name, value: attrValue});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Handle default attributes\n\t\t\t\t\t\t\tif (attributesDefault) {\n\t\t\t\t\t\t\t\ti = attributesDefault.length;\n\t\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\t\tattr = attributesDefault[i];\n\t\t\t\t\t\t\t\t\tname = attr.name;\n\n\t\t\t\t\t\t\t\t\tif (!(name in attrList.map)) {\n\t\t\t\t\t\t\t\t\t\tattrValue = attr.value;\n\n\t\t\t\t\t\t\t\t\t\tif (attrValue === '{$uid}') {\n\t\t\t\t\t\t\t\t\t\t\tattrValue = 'mce_' + idCount++;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tattrList.map[name] = attrValue;\n\t\t\t\t\t\t\t\t\t\tattrList.push({name: name, value: attrValue});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Handle required attributes\n\t\t\t\t\t\t\tif (attributesRequired) {\n\t\t\t\t\t\t\t\ti = attributesRequired.length;\n\t\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\t\tif (attributesRequired[i] in attrList.map) {\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// None of the required attributes where found\n\t\t\t\t\t\t\t\tif (i === -1) {\n\t\t\t\t\t\t\t\t\tisValidElement = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Invalidate element if it's marked as bogus\n\t\t\t\t\t\t\tif ((attr = attrList.map['data-mce-bogus'])) {\n\t\t\t\t\t\t\t\tif (attr === 'all') {\n\t\t\t\t\t\t\t\t\tindex = findEndTag(schema, html, tokenRegExp.lastIndex);\n\t\t\t\t\t\t\t\t\ttokenRegExp.lastIndex = index;\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tisValidElement = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (isValidElement) {\n\t\t\t\t\t\t\tself.start(value, attrList, isShortEnded);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tisValidElement = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Treat script, noscript and style a bit different since they may include code that looks like elements\n\t\t\t\t\tif ((endRegExp = specialElements[value])) {\n\t\t\t\t\t\tendRegExp.lastIndex = index = matches.index + matches[0].length;\n\n\t\t\t\t\t\tif ((matches = endRegExp.exec(html))) {\n\t\t\t\t\t\t\tif (isValidElement) {\n\t\t\t\t\t\t\t\ttext = html.substr(index, matches.index - index);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tindex = matches.index + matches[0].length;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttext = html.substr(index);\n\t\t\t\t\t\t\tindex = html.length;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (isValidElement) {\n\t\t\t\t\t\t\tif (text.length > 0) {\n\t\t\t\t\t\t\t\tself.text(text, true);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tself.end(value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttokenRegExp.lastIndex = index;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Push value on to stack\n\t\t\t\t\tif (!isShortEnded) {\n\t\t\t\t\t\tif (!attribsValue || attribsValue.indexOf('/') != attribsValue.length - 1) {\n\t\t\t\t\t\t\tstack.push({name: value, valid: isValidElement});\n\t\t\t\t\t\t} else if (isValidElement) {\n\t\t\t\t\t\t\tself.end(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if ((value = matches[1])) { // Comment\n\t\t\t\t\t// Padd comment value to avoid browsers from parsing invalid comments as HTML\n\t\t\t\t\tif (value.charAt(0) === '>') {\n\t\t\t\t\t\tvalue = ' ' + value;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!settings.allow_conditional_comments && value.substr(0, 3) === '[if') {\n\t\t\t\t\t\tvalue = ' ' + value;\n\t\t\t\t\t}\n\n\t\t\t\t\tself.comment(value);\n\t\t\t\t} else if ((value = matches[2])) { // CDATA\n\t\t\t\t\tself.cdata(value);\n\t\t\t\t} else if ((value = matches[3])) { // DOCTYPE\n\t\t\t\t\tself.doctype(value);\n\t\t\t\t} else if ((value = matches[4])) { // PI\n\t\t\t\t\tself.pi(value, matches[5]);\n\t\t\t\t}\n\n\t\t\t\tindex = matches.index + matches[0].length;\n\t\t\t}\n\n\t\t\t// Text\n\t\t\tif (index < html.length) {\n\t\t\t\tself.text(decode(html.substr(index)));\n\t\t\t}\n\n\t\t\t// Close any open elements\n\t\t\tfor (i = stack.length - 1; i >= 0; i--) {\n\t\t\t\tvalue = stack[i];\n\n\t\t\t\tif (value.valid) {\n\t\t\t\t\tself.end(value.name);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tSaxParser.findEndTag = findEndTag;\n\n\treturn SaxParser;\n});\n\n// Included from: js/tinymce/classes/html/DomParser.js\n\n/**\n * DomParser.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class parses HTML code into a DOM like structure of nodes it will remove redundant whitespace and make\n * sure that the node tree is valid according to the specified schema.\n * So for example: <p>a<p>b</p>c</p> will become <p>a</p><p>b</p><p>c</p>\n *\n * @example\n * var parser = new tinymce.html.DomParser({validate: true}, schema);\n * var rootNode = parser.parse('<h1>content</h1>');\n *\n * @class tinymce.html.DomParser\n * @version 3.4\n */\ndefine(\"tinymce/html/DomParser\", [\n\t\"tinymce/html/Node\",\n\t\"tinymce/html/Schema\",\n\t\"tinymce/html/SaxParser\",\n\t\"tinymce/util/Tools\"\n], function(Node, Schema, SaxParser, Tools) {\n\tvar makeMap = Tools.makeMap, each = Tools.each, explode = Tools.explode, extend = Tools.extend;\n\n\t/**\n\t * Constructs a new DomParser instance.\n\t *\n\t * @constructor\n\t * @method DomParser\n\t * @param {Object} settings Name/value collection of settings. comment, cdata, text, start and end are callbacks.\n\t * @param {tinymce.html.Schema} schema HTML Schema class to use when parsing.\n\t */\n\treturn function(settings, schema) {\n\t\tvar self = this, nodeFilters = {}, attributeFilters = [], matchedNodes = {}, matchedAttributes = {};\n\n\t\tsettings = settings || {};\n\t\tsettings.validate = \"validate\" in settings ? settings.validate : true;\n\t\tsettings.root_name = settings.root_name || 'body';\n\t\tself.schema = schema = schema || new Schema();\n\n\t\tfunction fixInvalidChildren(nodes) {\n\t\t\tvar ni, node, parent, parents, newParent, currentNode, tempNode, childNode, i;\n\t\t\tvar nonEmptyElements, nonSplitableElements, textBlockElements, specialElements, sibling, nextNode;\n\n\t\t\tnonSplitableElements = makeMap('tr,td,th,tbody,thead,tfoot,table');\n\t\t\tnonEmptyElements = schema.getNonEmptyElements();\n\t\t\ttextBlockElements = schema.getTextBlockElements();\n\t\t\tspecialElements = schema.getSpecialElements();\n\n\t\t\tfor (ni = 0; ni < nodes.length; ni++) {\n\t\t\t\tnode = nodes[ni];\n\n\t\t\t\t// Already removed or fixed\n\t\t\t\tif (!node.parent || node.fixed) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// If the invalid element is a text block and the text block is within a parent LI element\n\t\t\t\t// Then unwrap the first text block and convert other sibling text blocks to LI elements similar to Word/Open Office\n\t\t\t\tif (textBlockElements[node.name] && node.parent.name == 'li') {\n\t\t\t\t\t// Move sibling text blocks after LI element\n\t\t\t\t\tsibling = node.next;\n\t\t\t\t\twhile (sibling) {\n\t\t\t\t\t\tif (textBlockElements[sibling.name]) {\n\t\t\t\t\t\t\tsibling.name = 'li';\n\t\t\t\t\t\t\tsibling.fixed = true;\n\t\t\t\t\t\t\tnode.parent.insert(sibling, node.parent);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = sibling.next;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Unwrap current text block\n\t\t\t\t\tnode.unwrap(node);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Get list of all parent nodes until we find a valid parent to stick the child into\n\t\t\t\tparents = [node];\n\t\t\t\tfor (parent = node.parent; parent && !schema.isValidChild(parent.name, node.name) &&\n\t\t\t\t\t!nonSplitableElements[parent.name]; parent = parent.parent) {\n\t\t\t\t\tparents.push(parent);\n\t\t\t\t}\n\n\t\t\t\t// Found a suitable parent\n\t\t\t\tif (parent && parents.length > 1) {\n\t\t\t\t\t// Reverse the array since it makes looping easier\n\t\t\t\t\tparents.reverse();\n\n\t\t\t\t\t// Clone the related parent and insert that after the moved node\n\t\t\t\t\tnewParent = currentNode = self.filterNode(parents[0].clone());\n\n\t\t\t\t\t// Start cloning and moving children on the left side of the target node\n\t\t\t\t\tfor (i = 0; i < parents.length - 1; i++) {\n\t\t\t\t\t\tif (schema.isValidChild(currentNode.name, parents[i].name)) {\n\t\t\t\t\t\t\ttempNode = self.filterNode(parents[i].clone());\n\t\t\t\t\t\t\tcurrentNode.append(tempNode);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttempNode = currentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (childNode = parents[i].firstChild; childNode && childNode != parents[i + 1];) {\n\t\t\t\t\t\t\tnextNode = childNode.next;\n\t\t\t\t\t\t\ttempNode.append(childNode);\n\t\t\t\t\t\t\tchildNode = nextNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcurrentNode = tempNode;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!newParent.isEmpty(nonEmptyElements)) {\n\t\t\t\t\t\tparent.insert(newParent, parents[0], true);\n\t\t\t\t\t\tparent.insert(node, newParent);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tparent.insert(node, parents[0], true);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Check if the element is empty by looking through it's contents and special treatment for <p><br /></p>\n\t\t\t\t\tparent = parents[0];\n\t\t\t\t\tif (parent.isEmpty(nonEmptyElements) || parent.firstChild === parent.lastChild && parent.firstChild.name === 'br') {\n\t\t\t\t\t\tparent.empty().remove();\n\t\t\t\t\t}\n\t\t\t\t} else if (node.parent) {\n\t\t\t\t\t// If it's an LI try to find a UL/OL for it or wrap it\n\t\t\t\t\tif (node.name === 'li') {\n\t\t\t\t\t\tsibling = node.prev;\n\t\t\t\t\t\tif (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\n\t\t\t\t\t\t\tsibling.append(node);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = node.next;\n\t\t\t\t\t\tif (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\n\t\t\t\t\t\t\tsibling.insert(node, sibling.firstChild, true);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode.wrap(self.filterNode(new Node('ul', 1)));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Try wrapping the element in a DIV\n\t\t\t\t\tif (schema.isValidChild(node.parent.name, 'div') && schema.isValidChild('div', node.name)) {\n\t\t\t\t\t\tnode.wrap(self.filterNode(new Node('div', 1)));\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We failed wrapping it, then remove or unwrap it\n\t\t\t\t\t\tif (specialElements[node.name]) {\n\t\t\t\t\t\t\tnode.empty().remove();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.unwrap();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Runs the specified node though the element and attributes filters.\n\t\t *\n\t\t * @method filterNode\n\t\t * @param {tinymce.html.Node} Node the node to run filters on.\n\t\t * @return {tinymce.html.Node} The passed in node.\n\t\t */\n\t\tself.filterNode = function(node) {\n\t\t\tvar i, name, list;\n\n\t\t\t// Run element filters\n\t\t\tif (name in nodeFilters) {\n\t\t\t\tlist = matchedNodes[name];\n\n\t\t\t\tif (list) {\n\t\t\t\t\tlist.push(node);\n\t\t\t\t} else {\n\t\t\t\t\tmatchedNodes[name] = [node];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Run attribute filters\n\t\t\ti = attributeFilters.length;\n\t\t\twhile (i--) {\n\t\t\t\tname = attributeFilters[i].name;\n\n\t\t\t\tif (name in node.attributes.map) {\n\t\t\t\t\tlist = matchedAttributes[name];\n\n\t\t\t\t\tif (list) {\n\t\t\t\t\t\tlist.push(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmatchedAttributes[name] = [node];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn node;\n\t\t};\n\n\t\t/**\n\t\t * Adds a node filter function to the parser, the parser will collect the specified nodes by name\n\t\t * and then execute the callback ones it has finished parsing the document.\n\t\t *\n\t\t * @example\n\t\t * parser.addNodeFilter('p,h1', function(nodes, name) {\n\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\n\t\t *\t\t\tconsole.log(nodes[i].name);\n\t\t *\t\t}\n\t\t * });\n\t\t * @method addNodeFilter\n\t\t * @method {String} name Comma separated list of nodes to collect.\n\t\t * @param {function} callback Callback function to execute once it has collected nodes.\n\t\t */\n\t\tself.addNodeFilter = function(name, callback) {\n\t\t\teach(explode(name), function(name) {\n\t\t\t\tvar list = nodeFilters[name];\n\n\t\t\t\tif (!list) {\n\t\t\t\t\tnodeFilters[name] = list = [];\n\t\t\t\t}\n\n\t\t\t\tlist.push(callback);\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Adds a attribute filter function to the parser, the parser will collect nodes that has the specified attributes\n\t\t * and then execute the callback ones it has finished parsing the document.\n\t\t *\n\t\t * @example\n\t\t * parser.addAttributeFilter('src,href', function(nodes, name) {\n\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\n\t\t *\t\t\tconsole.log(nodes[i].name);\n\t\t *\t\t}\n\t\t * });\n\t\t * @method addAttributeFilter\n\t\t * @method {String} name Comma separated list of nodes to collect.\n\t\t * @param {function} callback Callback function to execute once it has collected nodes.\n\t\t */\n\t\tself.addAttributeFilter = function(name, callback) {\n\t\t\teach(explode(name), function(name) {\n\t\t\t\tvar i;\n\n\t\t\t\tfor (i = 0; i < attributeFilters.length; i++) {\n\t\t\t\t\tif (attributeFilters[i].name === name) {\n\t\t\t\t\t\tattributeFilters[i].callbacks.push(callback);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tattributeFilters.push({name: name, callbacks: [callback]});\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Parses the specified HTML string into a DOM like node tree and returns the result.\n\t\t *\n\t\t * @example\n\t\t * var rootNode = new DomParser({...}).parse('<b>text</b>');\n\t\t * @method parse\n\t\t * @param {String} html Html string to sax parse.\n\t\t * @param {Object} args Optional args object that gets passed to all filter functions.\n\t\t * @return {tinymce.html.Node} Root node containing the tree.\n\t\t */\n\t\tself.parse = function(html, args) {\n\t\t\tvar parser, rootNode, node, nodes, i, l, fi, fl, list, name, validate;\n\t\t\tvar blockElements, startWhiteSpaceRegExp, invalidChildren = [], isInWhiteSpacePreservedElement;\n\t\t\tvar endWhiteSpaceRegExp, allWhiteSpaceRegExp, isAllWhiteSpaceRegExp, whiteSpaceElements;\n\t\t\tvar children, nonEmptyElements, rootBlockName;\n\n\t\t\targs = args || {};\n\t\t\tmatchedNodes = {};\n\t\t\tmatchedAttributes = {};\n\t\t\tblockElements = extend(makeMap('script,style,head,html,body,title,meta,param'), schema.getBlockElements());\n\t\t\tnonEmptyElements = schema.getNonEmptyElements();\n\t\t\tchildren = schema.children;\n\t\t\tvalidate = settings.validate;\n\t\t\trootBlockName = \"forced_root_block\" in args ? args.forced_root_block : settings.forced_root_block;\n\n\t\t\twhiteSpaceElements = schema.getWhiteSpaceElements();\n\t\t\tstartWhiteSpaceRegExp = /^[ \\t\\r\\n]+/;\n\t\t\tendWhiteSpaceRegExp = /[ \\t\\r\\n]+$/;\n\t\t\tallWhiteSpaceRegExp = /[ \\t\\r\\n]+/g;\n\t\t\tisAllWhiteSpaceRegExp = /^[ \\t\\r\\n]+$/;\n\n\t\t\tfunction addRootBlocks() {\n\t\t\t\tvar node = rootNode.firstChild, next, rootBlockNode;\n\n\t\t\t\t// Removes whitespace at beginning and end of block so:\n\t\t\t\t// <p> x </p> -> <p>x</p>\n\t\t\t\tfunction trim(rootBlockNode) {\n\t\t\t\t\tif (rootBlockNode) {\n\t\t\t\t\t\tnode = rootBlockNode.firstChild;\n\t\t\t\t\t\tif (node && node.type == 3) {\n\t\t\t\t\t\t\tnode.value = node.value.replace(startWhiteSpaceRegExp, '');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = rootBlockNode.lastChild;\n\t\t\t\t\t\tif (node && node.type == 3) {\n\t\t\t\t\t\t\tnode.value = node.value.replace(endWhiteSpaceRegExp, '');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Check if rootBlock is valid within rootNode for example if P is valid in H1 if H1 is the contentEditabe root\n\t\t\t\tif (!schema.isValidChild(rootNode.name, rootBlockName.toLowerCase())) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twhile (node) {\n\t\t\t\t\tnext = node.next;\n\n\t\t\t\t\tif (node.type == 3 || (node.type == 1 && node.name !== 'p' &&\n\t\t\t\t\t\t!blockElements[node.name] && !node.attr('data-mce-type'))) {\n\t\t\t\t\t\tif (!rootBlockNode) {\n\t\t\t\t\t\t\t// Create a new root block element\n\t\t\t\t\t\t\trootBlockNode = createNode(rootBlockName, 1);\n\t\t\t\t\t\t\trootBlockNode.attr(settings.forced_root_block_attrs);\n\t\t\t\t\t\t\trootNode.insert(rootBlockNode, node);\n\t\t\t\t\t\t\trootBlockNode.append(node);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trootBlockNode.append(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttrim(rootBlockNode);\n\t\t\t\t\t\trootBlockNode = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = next;\n\t\t\t\t}\n\n\t\t\t\ttrim(rootBlockNode);\n\t\t\t}\n\n\t\t\tfunction createNode(name, type) {\n\t\t\t\tvar node = new Node(name, type), list;\n\n\t\t\t\tif (name in nodeFilters) {\n\t\t\t\t\tlist = matchedNodes[name];\n\n\t\t\t\t\tif (list) {\n\t\t\t\t\t\tlist.push(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmatchedNodes[name] = [node];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tfunction removeWhitespaceBefore(node) {\n\t\t\t\tvar textNode, textNodeNext, textVal, sibling, blockElements = schema.getBlockElements();\n\n\t\t\t\tfor (textNode = node.prev; textNode && textNode.type === 3;) {\n\t\t\t\t\ttextVal = textNode.value.replace(endWhiteSpaceRegExp, '');\n\n\t\t\t\t\t// Found a text node with non whitespace then trim that and break\n\t\t\t\t\tif (textVal.length > 0) {\n\t\t\t\t\t\ttextNode.value = textVal;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttextNodeNext = textNode.next;\n\n\t\t\t\t\t// Fix for bug #7543 where bogus nodes would produce empty\n\t\t\t\t\t// text nodes and these would be removed if a nested list was before it\n\t\t\t\t\tif (textNodeNext) {\n\t\t\t\t\t\tif (textNodeNext.type == 3 && textNodeNext.value.length) {\n\t\t\t\t\t\t\ttextNode = textNode.prev;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!blockElements[textNodeNext.name] && textNodeNext.name != 'script' && textNodeNext.name != 'style') {\n\t\t\t\t\t\t\ttextNode = textNode.prev;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tsibling = textNode.prev;\n\t\t\t\t\ttextNode.remove();\n\t\t\t\t\ttextNode = sibling;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction cloneAndExcludeBlocks(input) {\n\t\t\t\tvar name, output = {};\n\n\t\t\t\tfor (name in input) {\n\t\t\t\t\tif (name !== 'li' && name != 'p') {\n\t\t\t\t\t\toutput[name] = input[name];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\n\t\t\tparser = new SaxParser({\n\t\t\t\tvalidate: validate,\n\t\t\t\tallow_script_urls: settings.allow_script_urls,\n\t\t\t\tallow_conditional_comments: settings.allow_conditional_comments,\n\n\t\t\t\t// Exclude P and LI from DOM parsing since it's treated better by the DOM parser\n\t\t\t\tself_closing_elements: cloneAndExcludeBlocks(schema.getSelfClosingElements()),\n\n\t\t\t\tcdata: function(text) {\n\t\t\t\t\tnode.append(createNode('#cdata', 4)).value = text;\n\t\t\t\t},\n\n\t\t\t\ttext: function(text, raw) {\n\t\t\t\t\tvar textNode;\n\n\t\t\t\t\t// Trim all redundant whitespace on non white space elements\n\t\t\t\t\tif (!isInWhiteSpacePreservedElement) {\n\t\t\t\t\t\ttext = text.replace(allWhiteSpaceRegExp, ' ');\n\n\t\t\t\t\t\tif (node.lastChild && blockElements[node.lastChild.name]) {\n\t\t\t\t\t\t\ttext = text.replace(startWhiteSpaceRegExp, '');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Do we need to create the node\n\t\t\t\t\tif (text.length !== 0) {\n\t\t\t\t\t\ttextNode = createNode('#text', 3);\n\t\t\t\t\t\ttextNode.raw = !!raw;\n\t\t\t\t\t\tnode.append(textNode).value = text;\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tcomment: function(text) {\n\t\t\t\t\tnode.append(createNode('#comment', 8)).value = text;\n\t\t\t\t},\n\n\t\t\t\tpi: function(name, text) {\n\t\t\t\t\tnode.append(createNode(name, 7)).value = text;\n\t\t\t\t\tremoveWhitespaceBefore(node);\n\t\t\t\t},\n\n\t\t\t\tdoctype: function(text) {\n\t\t\t\t\tvar newNode;\n\n\t\t\t\t\tnewNode = node.append(createNode('#doctype', 10));\n\t\t\t\t\tnewNode.value = text;\n\t\t\t\t\tremoveWhitespaceBefore(node);\n\t\t\t\t},\n\n\t\t\t\tstart: function(name, attrs, empty) {\n\t\t\t\t\tvar newNode, attrFiltersLen, elementRule, attrName, parent;\n\n\t\t\t\t\telementRule = validate ? schema.getElementRule(name) : {};\n\t\t\t\t\tif (elementRule) {\n\t\t\t\t\t\tnewNode = createNode(elementRule.outputName || name, 1);\n\t\t\t\t\t\tnewNode.attributes = attrs;\n\t\t\t\t\t\tnewNode.shortEnded = empty;\n\n\t\t\t\t\t\tnode.append(newNode);\n\n\t\t\t\t\t\t// Check if node is valid child of the parent node is the child is\n\t\t\t\t\t\t// unknown we don't collect it since it's probably a custom element\n\t\t\t\t\t\tparent = children[node.name];\n\t\t\t\t\t\tif (parent && children[newNode.name] && !parent[newNode.name]) {\n\t\t\t\t\t\t\tinvalidChildren.push(newNode);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tattrFiltersLen = attributeFilters.length;\n\t\t\t\t\t\twhile (attrFiltersLen--) {\n\t\t\t\t\t\t\tattrName = attributeFilters[attrFiltersLen].name;\n\n\t\t\t\t\t\t\tif (attrName in attrs.map) {\n\t\t\t\t\t\t\t\tlist = matchedAttributes[attrName];\n\n\t\t\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\t\t\tlist.push(newNode);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tmatchedAttributes[attrName] = [newNode];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Trim whitespace before block\n\t\t\t\t\t\tif (blockElements[name]) {\n\t\t\t\t\t\t\tremoveWhitespaceBefore(newNode);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Change current node if the element wasn't empty i.e not <br /> or <img />\n\t\t\t\t\t\tif (!empty) {\n\t\t\t\t\t\t\tnode = newNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Check if we are inside a whitespace preserved element\n\t\t\t\t\t\tif (!isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n\t\t\t\t\t\t\tisInWhiteSpacePreservedElement = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tend: function(name) {\n\t\t\t\t\tvar textNode, elementRule, text, sibling, tempNode;\n\n\t\t\t\t\telementRule = validate ? schema.getElementRule(name) : {};\n\t\t\t\t\tif (elementRule) {\n\t\t\t\t\t\tif (blockElements[name]) {\n\t\t\t\t\t\t\tif (!isInWhiteSpacePreservedElement) {\n\t\t\t\t\t\t\t\t// Trim whitespace of the first node in a block\n\t\t\t\t\t\t\t\ttextNode = node.firstChild;\n\t\t\t\t\t\t\t\tif (textNode && textNode.type === 3) {\n\t\t\t\t\t\t\t\t\ttext = textNode.value.replace(startWhiteSpaceRegExp, '');\n\n\t\t\t\t\t\t\t\t\t// Any characters left after trim or should we remove it\n\t\t\t\t\t\t\t\t\tif (text.length > 0) {\n\t\t\t\t\t\t\t\t\t\ttextNode.value = text;\n\t\t\t\t\t\t\t\t\t\ttextNode = textNode.next;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tsibling = textNode.next;\n\t\t\t\t\t\t\t\t\t\ttextNode.remove();\n\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\n\t\t\t\t\t\t\t\t\t\t// Remove any pure whitespace siblings\n\t\t\t\t\t\t\t\t\t\twhile (textNode && textNode.type === 3) {\n\t\t\t\t\t\t\t\t\t\t\ttext = textNode.value;\n\t\t\t\t\t\t\t\t\t\t\tsibling = textNode.next;\n\n\t\t\t\t\t\t\t\t\t\t\tif (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode.remove();\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Trim whitespace of the last node in a block\n\t\t\t\t\t\t\t\ttextNode = node.lastChild;\n\t\t\t\t\t\t\t\tif (textNode && textNode.type === 3) {\n\t\t\t\t\t\t\t\t\ttext = textNode.value.replace(endWhiteSpaceRegExp, '');\n\n\t\t\t\t\t\t\t\t\t// Any characters left after trim or should we remove it\n\t\t\t\t\t\t\t\t\tif (text.length > 0) {\n\t\t\t\t\t\t\t\t\t\ttextNode.value = text;\n\t\t\t\t\t\t\t\t\t\ttextNode = textNode.prev;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tsibling = textNode.prev;\n\t\t\t\t\t\t\t\t\t\ttextNode.remove();\n\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\n\t\t\t\t\t\t\t\t\t\t// Remove any pure whitespace siblings\n\t\t\t\t\t\t\t\t\t\twhile (textNode && textNode.type === 3) {\n\t\t\t\t\t\t\t\t\t\t\ttext = textNode.value;\n\t\t\t\t\t\t\t\t\t\t\tsibling = textNode.prev;\n\n\t\t\t\t\t\t\t\t\t\t\tif (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode.remove();\n\t\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\ttextNode = sibling;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Trim start white space\n\t\t\t\t\t\t\t// Removed due to: #5424\n\t\t\t\t\t\t\t/*textNode = node.prev;\n\t\t\t\t\t\t\tif (textNode && textNode.type === 3) {\n\t\t\t\t\t\t\t\ttext = textNode.value.replace(startWhiteSpaceRegExp, '');\n\n\t\t\t\t\t\t\t\tif (text.length > 0)\n\t\t\t\t\t\t\t\t\ttextNode.value = text;\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\ttextNode.remove();\n\t\t\t\t\t\t\t}*/\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Check if we exited a whitespace preserved element\n\t\t\t\t\t\tif (isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\n\t\t\t\t\t\t\tisInWhiteSpacePreservedElement = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Handle empty nodes\n\t\t\t\t\t\tif (elementRule.removeEmpty || elementRule.paddEmpty) {\n\t\t\t\t\t\t\tif (node.isEmpty(nonEmptyElements)) {\n\t\t\t\t\t\t\t\tif (elementRule.paddEmpty) {\n\t\t\t\t\t\t\t\t\tnode.empty().append(new Node('#text', '3')).value = '\\u00a0';\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// Leave nodes that have a name like <a name=\"name\">\n\t\t\t\t\t\t\t\t\tif (!node.attributes.map.name && !node.attributes.map.id) {\n\t\t\t\t\t\t\t\t\t\ttempNode = node.parent;\n\n\t\t\t\t\t\t\t\t\t\tif (blockElements[node.name]) {\n\t\t\t\t\t\t\t\t\t\t\tnode.empty().remove();\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tnode.unwrap();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tnode = tempNode;\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parent;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, schema);\n\n\t\t\trootNode = node = new Node(args.context || settings.root_name, 11);\n\n\t\t\tparser.parse(html);\n\n\t\t\t// Fix invalid children or report invalid children in a contextual parsing\n\t\t\tif (validate && invalidChildren.length) {\n\t\t\t\tif (!args.context) {\n\t\t\t\t\tfixInvalidChildren(invalidChildren);\n\t\t\t\t} else {\n\t\t\t\t\targs.invalid = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Wrap nodes in the root into block elements if the root is body\n\t\t\tif (rootBlockName && (rootNode.name == 'body' || args.isRootContent)) {\n\t\t\t\taddRootBlocks();\n\t\t\t}\n\n\t\t\t// Run filters only when the contents is valid\n\t\t\tif (!args.invalid) {\n\t\t\t\t// Run node filters\n\t\t\t\tfor (name in matchedNodes) {\n\t\t\t\t\tlist = nodeFilters[name];\n\t\t\t\t\tnodes = matchedNodes[name];\n\n\t\t\t\t\t// Remove already removed children\n\t\t\t\t\tfi = nodes.length;\n\t\t\t\t\twhile (fi--) {\n\t\t\t\t\t\tif (!nodes[fi].parent) {\n\t\t\t\t\t\t\tnodes.splice(fi, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (i = 0, l = list.length; i < l; i++) {\n\t\t\t\t\t\tlist[i](nodes, name, args);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Run attribute filters\n\t\t\t\tfor (i = 0, l = attributeFilters.length; i < l; i++) {\n\t\t\t\t\tlist = attributeFilters[i];\n\n\t\t\t\t\tif (list.name in matchedAttributes) {\n\t\t\t\t\t\tnodes = matchedAttributes[list.name];\n\n\t\t\t\t\t\t// Remove already removed children\n\t\t\t\t\t\tfi = nodes.length;\n\t\t\t\t\t\twhile (fi--) {\n\t\t\t\t\t\t\tif (!nodes[fi].parent) {\n\t\t\t\t\t\t\t\tnodes.splice(fi, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (fi = 0, fl = list.callbacks.length; fi < fl; fi++) {\n\t\t\t\t\t\t\tlist.callbacks[fi](nodes, list.name, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn rootNode;\n\t\t};\n\n\t\t// Remove <br> at end of block elements Gecko and WebKit injects BR elements to\n\t\t// make it possible to place the caret inside empty blocks. This logic tries to remove\n\t\t// these elements and keep br elements that where intended to be there intact\n\t\tif (settings.remove_trailing_brs) {\n\t\t\tself.addNodeFilter('br', function(nodes) {\n\t\t\t\tvar i, l = nodes.length, node, blockElements = extend({}, schema.getBlockElements());\n\t\t\t\tvar nonEmptyElements = schema.getNonEmptyElements(), parent, lastParent, prev, prevName;\n\t\t\t\tvar elementRule, textNode;\n\n\t\t\t\t// Remove brs from body element as well\n\t\t\t\tblockElements.body = 1;\n\n\t\t\t\t// Must loop forwards since it will otherwise remove all brs in <p>a<br><br><br></p>\n\t\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tparent = node.parent;\n\n\t\t\t\t\tif (blockElements[node.parent.name] && node === parent.lastChild) {\n\t\t\t\t\t\t// Loop all nodes to the left of the current node and check for other BR elements\n\t\t\t\t\t\t// excluding bookmarks since they are invisible\n\t\t\t\t\t\tprev = node.prev;\n\t\t\t\t\t\twhile (prev) {\n\t\t\t\t\t\t\tprevName = prev.name;\n\n\t\t\t\t\t\t\t// Ignore bookmarks\n\t\t\t\t\t\t\tif (prevName !== \"span\" || prev.attr('data-mce-type') !== 'bookmark') {\n\t\t\t\t\t\t\t\t// Found a non BR element\n\t\t\t\t\t\t\t\tif (prevName !== \"br\") {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Found another br it's a <br><br> structure then don't remove anything\n\t\t\t\t\t\t\t\tif (prevName === 'br') {\n\t\t\t\t\t\t\t\t\tnode = null;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tprev = prev.prev;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (node) {\n\t\t\t\t\t\t\tnode.remove();\n\n\t\t\t\t\t\t\t// Is the parent to be considered empty after we removed the BR\n\t\t\t\t\t\t\tif (parent.isEmpty(nonEmptyElements)) {\n\t\t\t\t\t\t\t\telementRule = schema.getElementRule(parent.name);\n\n\t\t\t\t\t\t\t\t// Remove or padd the element depending on schema rule\n\t\t\t\t\t\t\t\tif (elementRule) {\n\t\t\t\t\t\t\t\t\tif (elementRule.removeEmpty) {\n\t\t\t\t\t\t\t\t\t\tparent.remove();\n\t\t\t\t\t\t\t\t\t} else if (elementRule.paddEmpty) {\n\t\t\t\t\t\t\t\t\t\tparent.empty().append(new Node('#text', 3)).value = '\\u00a0';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Replaces BR elements inside inline elements like <p><b><i><br></i></b></p>\n\t\t\t\t\t\t// so they become <p><b><i>&nbsp;</i></b></p>\n\t\t\t\t\t\tlastParent = node;\n\t\t\t\t\t\twhile (parent && parent.firstChild === lastParent && parent.lastChild === lastParent) {\n\t\t\t\t\t\t\tlastParent = parent;\n\n\t\t\t\t\t\t\tif (blockElements[parent.name]) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tparent = parent.parent;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (lastParent === parent) {\n\t\t\t\t\t\t\ttextNode = new Node('#text', 3);\n\t\t\t\t\t\t\ttextNode.value = '\\u00a0';\n\t\t\t\t\t\t\tnode.replace(textNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Force anchor names closed, unless the setting \"allow_html_in_named_anchor\" is explicitly included.\n\t\tif (!settings.allow_html_in_named_anchor) {\n\t\t\tself.addAttributeFilter('id,name', function(nodes) {\n\t\t\t\tvar i = nodes.length, sibling, prevSibling, parent, node;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tif (node.name === 'a' && node.firstChild && !node.attr('href')) {\n\t\t\t\t\t\tparent = node.parent;\n\n\t\t\t\t\t\t// Move children after current node\n\t\t\t\t\t\tsibling = node.lastChild;\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\tprevSibling = sibling.prev;\n\t\t\t\t\t\t\tparent.insert(sibling, node);\n\t\t\t\t\t\t\tsibling = prevSibling;\n\t\t\t\t\t\t} while (sibling);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (settings.validate && schema.getValidClasses()) {\n\t\t\tself.addAttributeFilter('class', function(nodes) {\n\t\t\t\tvar i = nodes.length, node, classList, ci, className, classValue;\n\t\t\t\tvar validClasses = schema.getValidClasses(), validClassesMap, valid;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tclassList = node.attr('class').split(' ');\n\t\t\t\t\tclassValue = '';\n\n\t\t\t\t\tfor (ci = 0; ci < classList.length; ci++) {\n\t\t\t\t\t\tclassName = classList[ci];\n\t\t\t\t\t\tvalid = false;\n\n\t\t\t\t\t\tvalidClassesMap = validClasses['*'];\n\t\t\t\t\t\tif (validClassesMap && validClassesMap[className]) {\n\t\t\t\t\t\t\tvalid = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvalidClassesMap = validClasses[node.name];\n\t\t\t\t\t\tif (!valid && validClassesMap && validClassesMap[className]) {\n\t\t\t\t\t\t\tvalid = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (valid) {\n\t\t\t\t\t\t\tif (classValue) {\n\t\t\t\t\t\t\t\tclassValue += ' ';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tclassValue += className;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!classValue.length) {\n\t\t\t\t\t\tclassValue = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode.attr('class', classValue);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/html/Writer.js\n\n/**\n * Writer.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to write HTML tags out it can be used with the Serializer or the SaxParser.\n *\n * @class tinymce.html.Writer\n * @example\n * var writer = new tinymce.html.Writer({indent: true});\n * var parser = new tinymce.html.SaxParser(writer).parse('<p><br></p>');\n * console.log(writer.getContent());\n *\n * @class tinymce.html.Writer\n * @version 3.4\n */\ndefine(\"tinymce/html/Writer\", [\n\t\"tinymce/html/Entities\",\n\t\"tinymce/util/Tools\"\n], function(Entities, Tools) {\n\tvar makeMap = Tools.makeMap;\n\n\t/**\n\t * Constructs a new Writer instance.\n\t *\n\t * @constructor\n\t * @method Writer\n\t * @param {Object} settings Name/value settings object.\n\t */\n\treturn function(settings) {\n\t\tvar html = [], indent, indentBefore, indentAfter, encode, htmlOutput;\n\n\t\tsettings = settings || {};\n\t\tindent = settings.indent;\n\t\tindentBefore = makeMap(settings.indent_before || '');\n\t\tindentAfter = makeMap(settings.indent_after || '');\n\t\tencode = Entities.getEncodeFunc(settings.entity_encoding || 'raw', settings.entities);\n\t\thtmlOutput = settings.element_format == \"html\";\n\n\t\treturn {\n\t\t\t/**\n\t\t\t * Writes the a start element such as <p id=\"a\">.\n\t\t\t *\n\t\t\t * @method start\n\t\t\t * @param {String} name Name of the element.\n\t\t\t * @param {Array} attrs Optional attribute array or undefined if it hasn't any.\n\t\t\t * @param {Boolean} empty Optional empty state if the tag should end like <br />.\n\t\t\t */\n\t\t\tstart: function(name, attrs, empty) {\n\t\t\t\tvar i, l, attr, value;\n\n\t\t\t\tif (indent && indentBefore[name] && html.length > 0) {\n\t\t\t\t\tvalue = html[html.length - 1];\n\n\t\t\t\t\tif (value.length > 0 && value !== '\\n') {\n\t\t\t\t\t\thtml.push('\\n');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\thtml.push('<', name);\n\n\t\t\t\tif (attrs) {\n\t\t\t\t\tfor (i = 0, l = attrs.length; i < l; i++) {\n\t\t\t\t\t\tattr = attrs[i];\n\t\t\t\t\t\thtml.push(' ', attr.name, '=\"', encode(attr.value, true), '\"');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!empty || htmlOutput) {\n\t\t\t\t\thtml[html.length] = '>';\n\t\t\t\t} else {\n\t\t\t\t\thtml[html.length] = ' />';\n\t\t\t\t}\n\n\t\t\t\tif (empty && indent && indentAfter[name] && html.length > 0) {\n\t\t\t\t\tvalue = html[html.length - 1];\n\n\t\t\t\t\tif (value.length > 0 && value !== '\\n') {\n\t\t\t\t\t\thtml.push('\\n');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes the a end element such as </p>.\n\t\t\t *\n\t\t\t * @method end\n\t\t\t * @param {String} name Name of the element.\n\t\t\t */\n\t\t\tend: function(name) {\n\t\t\t\tvar value;\n\n\t\t\t\t/*if (indent && indentBefore[name] && html.length > 0) {\n\t\t\t\t\tvalue = html[html.length - 1];\n\n\t\t\t\t\tif (value.length > 0 && value !== '\\n')\n\t\t\t\t\t\thtml.push('\\n');\n\t\t\t\t}*/\n\n\t\t\t\thtml.push('</', name, '>');\n\n\t\t\t\tif (indent && indentAfter[name] && html.length > 0) {\n\t\t\t\t\tvalue = html[html.length - 1];\n\n\t\t\t\t\tif (value.length > 0 && value !== '\\n') {\n\t\t\t\t\t\thtml.push('\\n');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes a text node.\n\t\t\t *\n\t\t\t * @method text\n\t\t\t * @param {String} text String to write out.\n\t\t\t * @param {Boolean} raw Optional raw state if true the contents wont get encoded.\n\t\t\t */\n\t\t\ttext: function(text, raw) {\n\t\t\t\tif (text.length > 0) {\n\t\t\t\t\thtml[html.length] = raw ? text : encode(text);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes a cdata node such as <![CDATA[data]]>.\n\t\t\t *\n\t\t\t * @method cdata\n\t\t\t * @param {String} text String to write out inside the cdata.\n\t\t\t */\n\t\t\tcdata: function(text) {\n\t\t\t\thtml.push('<![CDATA[', text, ']]>');\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes a comment node such as <!-- Comment -->.\n\t\t\t *\n\t\t\t * @method cdata\n\t\t\t * @param {String} text String to write out inside the comment.\n\t\t\t */\n\t\t\tcomment: function(text) {\n\t\t\t\thtml.push('<!--', text, '-->');\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes a PI node such as <?xml attr=\"value\" ?>.\n\t\t\t *\n\t\t\t * @method pi\n\t\t\t * @param {String} name Name of the pi.\n\t\t\t * @param {String} text String to write out inside the pi.\n\t\t\t */\n\t\t\tpi: function(name, text) {\n\t\t\t\tif (text) {\n\t\t\t\t\thtml.push('<?', name, ' ', encode(text), '?>');\n\t\t\t\t} else {\n\t\t\t\t\thtml.push('<?', name, '?>');\n\t\t\t\t}\n\n\t\t\t\tif (indent) {\n\t\t\t\t\thtml.push('\\n');\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Writes a doctype node such as <!DOCTYPE data>.\n\t\t\t *\n\t\t\t * @method doctype\n\t\t\t * @param {String} text String to write out inside the doctype.\n\t\t\t */\n\t\t\tdoctype: function(text) {\n\t\t\t\thtml.push('<!DOCTYPE', text, '>', indent ? '\\n' : '');\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Resets the internal buffer if one wants to reuse the writer.\n\t\t\t *\n\t\t\t * @method reset\n\t\t\t */\n\t\t\treset: function() {\n\t\t\t\thtml.length = 0;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Returns the contents that got serialized.\n\t\t\t *\n\t\t\t * @method getContent\n\t\t\t * @return {String} HTML contents that got written down.\n\t\t\t */\n\t\t\tgetContent: function() {\n\t\t\t\treturn html.join('').replace(/\\n$/, '');\n\t\t\t}\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/html/Serializer.js\n\n/**\n * Serializer.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to serialize down the DOM tree into a string using a Writer instance.\n *\n *\n * @example\n * new tinymce.html.Serializer().serialize(new tinymce.html.DomParser().parse('<p>text</p>'));\n * @class tinymce.html.Serializer\n * @version 3.4\n */\ndefine(\"tinymce/html/Serializer\", [\n\t\"tinymce/html/Writer\",\n\t\"tinymce/html/Schema\"\n], function(Writer, Schema) {\n\t/**\n\t * Constructs a new Serializer instance.\n\t *\n\t * @constructor\n\t * @method Serializer\n\t * @param {Object} settings Name/value settings object.\n\t * @param {tinymce.html.Schema} schema Schema instance to use.\n\t */\n\treturn function(settings, schema) {\n\t\tvar self = this, writer = new Writer(settings);\n\n\t\tsettings = settings || {};\n\t\tsettings.validate = \"validate\" in settings ? settings.validate : true;\n\n\t\tself.schema = schema = schema || new Schema();\n\t\tself.writer = writer;\n\n\t\t/**\n\t\t * Serializes the specified node into a string.\n\t\t *\n\t\t * @example\n\t\t * new tinymce.html.Serializer().serialize(new tinymce.html.DomParser().parse('<p>text</p>'));\n\t\t * @method serialize\n\t\t * @param {tinymce.html.Node} node Node instance to serialize.\n\t\t * @return {String} String with HTML based on DOM tree.\n\t\t */\n\t\tself.serialize = function(node) {\n\t\t\tvar handlers, validate;\n\n\t\t\tvalidate = settings.validate;\n\n\t\t\thandlers = {\n\t\t\t\t// #text\n\t\t\t\t3: function(node) {\n\t\t\t\t\twriter.text(node.value, node.raw);\n\t\t\t\t},\n\n\t\t\t\t// #comment\n\t\t\t\t8: function(node) {\n\t\t\t\t\twriter.comment(node.value);\n\t\t\t\t},\n\n\t\t\t\t// Processing instruction\n\t\t\t\t7: function(node) {\n\t\t\t\t\twriter.pi(node.name, node.value);\n\t\t\t\t},\n\n\t\t\t\t// Doctype\n\t\t\t\t10: function(node) {\n\t\t\t\t\twriter.doctype(node.value);\n\t\t\t\t},\n\n\t\t\t\t// CDATA\n\t\t\t\t4: function(node) {\n\t\t\t\t\twriter.cdata(node.value);\n\t\t\t\t},\n\n\t\t\t\t// Document fragment\n\t\t\t\t11: function(node) {\n\t\t\t\t\tif ((node = node.firstChild)) {\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\twalk(node);\n\t\t\t\t\t\t} while ((node = node.next));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\twriter.reset();\n\n\t\t\tfunction walk(node) {\n\t\t\t\tvar handler = handlers[node.type], name, isEmpty, attrs, attrName, attrValue, sortedAttrs, i, l, elementRule;\n\n\t\t\t\tif (!handler) {\n\t\t\t\t\tname = node.name;\n\t\t\t\t\tisEmpty = node.shortEnded;\n\t\t\t\t\tattrs = node.attributes;\n\n\t\t\t\t\t// Sort attributes\n\t\t\t\t\tif (validate && attrs && attrs.length > 1) {\n\t\t\t\t\t\tsortedAttrs = [];\n\t\t\t\t\t\tsortedAttrs.map = {};\n\n\t\t\t\t\t\telementRule = schema.getElementRule(node.name);\n\t\t\t\t\t\tif (elementRule) {\n\t\t\t\t\t\t\tfor (i = 0, l = elementRule.attributesOrder.length; i < l; i++) {\n\t\t\t\t\t\t\t\tattrName = elementRule.attributesOrder[i];\n\n\t\t\t\t\t\t\t\tif (attrName in attrs.map) {\n\t\t\t\t\t\t\t\t\tattrValue = attrs.map[attrName];\n\t\t\t\t\t\t\t\t\tsortedAttrs.map[attrName] = attrValue;\n\t\t\t\t\t\t\t\t\tsortedAttrs.push({name: attrName, value: attrValue});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfor (i = 0, l = attrs.length; i < l; i++) {\n\t\t\t\t\t\t\t\tattrName = attrs[i].name;\n\n\t\t\t\t\t\t\t\tif (!(attrName in sortedAttrs.map)) {\n\t\t\t\t\t\t\t\t\tattrValue = attrs.map[attrName];\n\t\t\t\t\t\t\t\t\tsortedAttrs.map[attrName] = attrValue;\n\t\t\t\t\t\t\t\t\tsortedAttrs.push({name: attrName, value: attrValue});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tattrs = sortedAttrs;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\twriter.start(node.name, attrs, isEmpty);\n\n\t\t\t\t\tif (!isEmpty) {\n\t\t\t\t\t\tif ((node = node.firstChild)) {\n\t\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\t\twalk(node);\n\t\t\t\t\t\t\t} while ((node = node.next));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\twriter.end(name);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\thandler(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Serialize element and treat all non elements as fragments\n\t\t\tif (node.type == 1 && !settings.inner) {\n\t\t\t\twalk(node);\n\t\t\t} else {\n\t\t\t\thandlers[11](node);\n\t\t\t}\n\n\t\t\treturn writer.getContent();\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/Serializer.js\n\n/**\n * Serializer.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to serialize DOM trees into a string. Consult the TinyMCE Wiki API for\n * more details and examples on how to use this class.\n *\n * @class tinymce.dom.Serializer\n */\ndefine(\"tinymce/dom/Serializer\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/html/DomParser\",\n\t\"tinymce/html/SaxParser\",\n\t\"tinymce/html/Entities\",\n\t\"tinymce/html/Serializer\",\n\t\"tinymce/html/Node\",\n\t\"tinymce/html/Schema\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/text/Zwsp\"\n], function(DOMUtils, DomParser, SaxParser, Entities, Serializer, Node, Schema, Env, Tools, Zwsp) {\n\tvar each = Tools.each, trim = Tools.trim;\n\tvar DOM = DOMUtils.DOM, tempAttrs = [\"data-mce-selected\"];\n\n\t/**\n\t * IE 11 has a fantastic bug where it will produce two trailing BR elements to iframe bodies when\n\t * the iframe is hidden by display: none on a parent container. The DOM is actually out of sync\n\t * with innerHTML in this case. It's like IE adds shadow DOM BR elements that appears on innerHTML\n\t * but not as the lastChild of the body. So this fix simply removes the last two\n\t * BR elements at the end of the document.\n\t *\n\t * Example of what happens: <body>text</body> becomes <body>text<br><br></body>\n\t */\n\tfunction trimTrailingBr(rootNode) {\n\t\tvar brNode1, brNode2;\n\n\t\tfunction isBr(node) {\n\t\t\treturn node && node.name === 'br';\n\t\t}\n\n\t\tbrNode1 = rootNode.lastChild;\n\t\tif (isBr(brNode1)) {\n\t\t\tbrNode2 = brNode1.prev;\n\n\t\t\tif (isBr(brNode2)) {\n\t\t\t\tbrNode1.remove();\n\t\t\t\tbrNode2.remove();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Constructs a new DOM serializer class.\n\t *\n\t * @constructor\n\t * @method Serializer\n\t * @param {Object} settings Serializer settings object.\n\t * @param {tinymce.Editor} editor Optional editor to bind events to and get schema/dom from.\n\t */\n\treturn function(settings, editor) {\n\t\tvar dom, schema, htmlParser;\n\n\t\tif (editor) {\n\t\t\tdom = editor.dom;\n\t\t\tschema = editor.schema;\n\t\t}\n\n\t\tfunction trimHtml(html) {\n\t\t\tvar trimContentRegExp = new RegExp([\n\t\t\t\t'<span[^>]+data-mce-bogus[^>]+>[\\u200B\\uFEFF]+<\\\\/span>', // Trim bogus spans like caret containers\n\t\t\t\t'\\\\s?(' + tempAttrs.join('|') + ')=\"[^\"]+\"' // Trim temporaty data-mce prefixed attributes like data-mce-selected\n\t\t\t].join('|'), 'gi');\n\n\t\t\thtml = Zwsp.trim(html.replace(trimContentRegExp, ''));\n\n\t\t\treturn html;\n\t\t}\n\n\t\t/**\n\t\t * Returns a trimmed version of the editor contents to be used for the undo level. This\n\t\t * will remove any data-mce-bogus=\"all\" marked elements since these are used for UI it will also\n\t\t * remove the data-mce-selected attributes used for selection of objects and caret containers.\n\t\t * It will keep all data-mce-bogus=\"1\" elements since these can be used to place the caret etc and will\n\t\t * be removed by the serialization logic when you save.\n\t\t *\n\t\t * @private\n\t\t * @return {String} HTML contents of the editor excluding some internal bogus elements.\n\t\t */\n\t\tfunction getTrimmedContent() {\n\t\t\tvar content = editor.getBody().innerHTML;\n\t\t\tvar bogusAllRegExp = /<(\\w+) [^>]*data-mce-bogus=\"all\"[^>]*>/g;\n\t\t\tvar endTagIndex, index, matchLength, matches, shortEndedElements, schema = editor.schema;\n\n\t\t\tcontent = trimHtml(content);\n\t\t\tshortEndedElements = schema.getShortEndedElements();\n\n\t\t\t// Remove all bogus elements marked with \"all\"\n\t\t\twhile ((matches = bogusAllRegExp.exec(content))) {\n\t\t\t\tindex = bogusAllRegExp.lastIndex;\n\t\t\t\tmatchLength = matches[0].length;\n\n\t\t\t\tif (shortEndedElements[matches[1]]) {\n\t\t\t\t\tendTagIndex = index;\n\t\t\t\t} else {\n\t\t\t\t\tendTagIndex = SaxParser.findEndTag(schema, content, index);\n\t\t\t\t}\n\n\t\t\t\tcontent = content.substring(0, index - matchLength) + content.substring(endTagIndex);\n\t\t\t\tbogusAllRegExp.lastIndex = index - matchLength;\n\t\t\t}\n\n\t\t\treturn trim(content);\n\t\t}\n\n\t\tfunction addTempAttr(name) {\n\t\t\tif (Tools.inArray(tempAttrs, name) === -1) {\n\t\t\t\thtmlParser.addAttributeFilter(name, function(nodes, name) {\n\t\t\t\t\tvar i = nodes.length;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnodes[i].attr(name, null);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\ttempAttrs.push(name);\n\t\t\t}\n\t\t}\n\n\t\t// Default DOM and Schema if they are undefined\n\t\tdom = dom || DOM;\n\t\tschema = schema || new Schema(settings);\n\t\tsettings.entity_encoding = settings.entity_encoding || 'named';\n\t\tsettings.remove_trailing_brs = \"remove_trailing_brs\" in settings ? settings.remove_trailing_brs : true;\n\n\t\thtmlParser = new DomParser(settings, schema);\n\n\t\t// Convert tabindex back to elements when serializing contents\n\t\thtmlParser.addAttributeFilter('data-mce-tabindex', function(nodes, name) {\n\t\t\tvar i = nodes.length, node;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\t\t\t\tnode.attr('tabindex', node.attributes.map['data-mce-tabindex']);\n\t\t\t\tnode.attr(name, null);\n\t\t\t}\n\t\t});\n\n\t\t// Convert move data-mce-src, data-mce-href and data-mce-style into nodes or process them if needed\n\t\thtmlParser.addAttributeFilter('src,href,style', function(nodes, name) {\n\t\t\tvar i = nodes.length, node, value, internalName = 'data-mce-' + name;\n\t\t\tvar urlConverter = settings.url_converter, urlConverterScope = settings.url_converter_scope, undef;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\n\t\t\t\tvalue = node.attributes.map[internalName];\n\t\t\t\tif (value !== undef) {\n\t\t\t\t\t// Set external name to internal value and remove internal\n\t\t\t\t\tnode.attr(name, value.length > 0 ? value : null);\n\t\t\t\t\tnode.attr(internalName, null);\n\t\t\t\t} else {\n\t\t\t\t\t// No internal attribute found then convert the value we have in the DOM\n\t\t\t\t\tvalue = node.attributes.map[name];\n\n\t\t\t\t\tif (name === \"style\") {\n\t\t\t\t\t\tvalue = dom.serializeStyle(dom.parseStyle(value), node.name);\n\t\t\t\t\t} else if (urlConverter) {\n\t\t\t\t\t\tvalue = urlConverter.call(urlConverterScope, value, name, node.name);\n\t\t\t\t\t}\n\n\t\t\t\t\tnode.attr(name, value.length > 0 ? value : null);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Remove internal classes mceItem<..> or mceSelected\n\t\thtmlParser.addAttributeFilter('class', function(nodes) {\n\t\t\tvar i = nodes.length, node, value;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\t\t\t\tvalue = node.attr('class');\n\n\t\t\t\tif (value) {\n\t\t\t\t\tvalue = node.attr('class').replace(/(?:^|\\s)mce-item-\\w+(?!\\S)/g, '');\n\t\t\t\t\tnode.attr('class', value.length > 0 ? value : null);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Remove bookmark elements\n\t\thtmlParser.addAttributeFilter('data-mce-type', function(nodes, name, args) {\n\t\t\tvar i = nodes.length, node;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\n\t\t\t\tif (node.attributes.map['data-mce-type'] === 'bookmark' && !args.cleanup) {\n\t\t\t\t\tnode.remove();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\thtmlParser.addNodeFilter('noscript', function(nodes) {\n\t\t\tvar i = nodes.length, node;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i].firstChild;\n\n\t\t\t\tif (node) {\n\t\t\t\t\tnode.value = Entities.decode(node.value);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Force script into CDATA sections and remove the mce- prefix also add comments around styles\n\t\thtmlParser.addNodeFilter('script,style', function(nodes, name) {\n\t\t\tvar i = nodes.length, node, value, type;\n\n\t\t\tfunction trim(value) {\n\t\t\t\t/*jshint maxlen:255 */\n\t\t\t\t/*eslint max-len:0 */\n\t\t\t\treturn value.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g, '\\n')\n\t\t\t\t\t\t.replace(/^[\\r\\n]*|[\\r\\n]*$/g, '')\n\t\t\t\t\t\t.replace(/^\\s*((<!--)?(\\s*\\/\\/)?\\s*<!\\[CDATA\\[|(<!--\\s*)?\\/\\*\\s*<!\\[CDATA\\[\\s*\\*\\/|(\\/\\/)?\\s*<!--|\\/\\*\\s*<!--\\s*\\*\\/)\\s*[\\r\\n]*/gi, '')\n\t\t\t\t\t\t.replace(/\\s*(\\/\\*\\s*\\]\\]>\\s*\\*\\/(-->)?|\\s*\\/\\/\\s*\\]\\]>(-->)?|\\/\\/\\s*(-->)?|\\]\\]>|\\/\\*\\s*-->\\s*\\*\\/|\\s*-->\\s*)\\s*$/g, '');\n\t\t\t}\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\t\t\t\tvalue = node.firstChild ? node.firstChild.value : '';\n\n\t\t\t\tif (name === \"script\") {\n\t\t\t\t\t// Remove mce- prefix from script elements and remove default type since the user specified\n\t\t\t\t\t// a script element without type attribute\n\t\t\t\t\ttype = node.attr('type');\n\t\t\t\t\tif (type) {\n\t\t\t\t\t\tnode.attr('type', type == 'mce-no/type' ? null : type.replace(/^mce\\-/, ''));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (value.length > 0) {\n\t\t\t\t\t\tnode.firstChild.value = '// <![CDATA[\\n' + trim(value) + '\\n// ]]>';\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (value.length > 0) {\n\t\t\t\t\t\tnode.firstChild.value = '<!--\\n' + trim(value) + '\\n-->';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Convert comments to cdata and handle protected comments\n\t\thtmlParser.addNodeFilter('#comment', function(nodes) {\n\t\t\tvar i = nodes.length, node;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\n\t\t\t\tif (node.value.indexOf('[CDATA[') === 0) {\n\t\t\t\t\tnode.name = '#cdata';\n\t\t\t\t\tnode.type = 4;\n\t\t\t\t\tnode.value = node.value.replace(/^\\[CDATA\\[|\\]\\]$/g, '');\n\t\t\t\t} else if (node.value.indexOf('mce:protected ') === 0) {\n\t\t\t\t\tnode.name = \"#text\";\n\t\t\t\t\tnode.type = 3;\n\t\t\t\t\tnode.raw = true;\n\t\t\t\t\tnode.value = unescape(node.value).substr(14);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\thtmlParser.addNodeFilter('xml:namespace,input', function(nodes, name) {\n\t\t\tvar i = nodes.length, node;\n\n\t\t\twhile (i--) {\n\t\t\t\tnode = nodes[i];\n\t\t\t\tif (node.type === 7) {\n\t\t\t\t\tnode.remove();\n\t\t\t\t} else if (node.type === 1) {\n\t\t\t\t\tif (name === \"input\" && !(\"type\" in node.attributes.map)) {\n\t\t\t\t\t\tnode.attr('type', 'text');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Fix list elements, TODO: Replace this later\n\t\tif (settings.fix_list_elements) {\n\t\t\thtmlParser.addNodeFilter('ul,ol', function(nodes) {\n\t\t\t\tvar i = nodes.length, node, parentNode;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tparentNode = node.parent;\n\n\t\t\t\t\tif (parentNode.name === 'ul' || parentNode.name === 'ol') {\n\t\t\t\t\t\tif (node.prev && node.prev.name === 'li') {\n\t\t\t\t\t\t\tnode.prev.append(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Remove internal data attributes\n\t\thtmlParser.addAttributeFilter(\n\t\t\t'data-mce-src,data-mce-href,data-mce-style,' +\n\t\t\t'data-mce-selected,data-mce-expando,' +\n\t\t\t'data-mce-type,data-mce-resize',\n\n\t\t\tfunction(nodes, name) {\n\t\t\t\tvar i = nodes.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnodes[i].attr(name, null);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\t// Return public methods\n\t\treturn {\n\t\t\t/**\n\t\t\t * Schema instance that was used to when the Serializer was constructed.\n\t\t\t *\n\t\t\t * @field {tinymce.html.Schema} schema\n\t\t\t */\n\t\t\tschema: schema,\n\n\t\t\t/**\n\t\t\t * Adds a node filter function to the parser used by the serializer, the parser will collect the specified nodes by name\n\t\t\t * and then execute the callback ones it has finished parsing the document.\n\t\t\t *\n\t\t\t * @example\n\t\t\t * parser.addNodeFilter('p,h1', function(nodes, name) {\n\t\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\n\t\t\t *\t\t\tconsole.log(nodes[i].name);\n\t\t\t *\t\t}\n\t\t\t * });\n\t\t\t * @method addNodeFilter\n\t\t\t * @method {String} name Comma separated list of nodes to collect.\n\t\t\t * @param {function} callback Callback function to execute once it has collected nodes.\n\t\t\t */\n\t\t\taddNodeFilter: htmlParser.addNodeFilter,\n\n\t\t\t/**\n\t\t\t * Adds a attribute filter function to the parser used by the serializer, the parser will\n\t\t\t * collect nodes that has the specified attributes\n\t\t\t * and then execute the callback ones it has finished parsing the document.\n\t\t\t *\n\t\t\t * @example\n\t\t\t * parser.addAttributeFilter('src,href', function(nodes, name) {\n\t\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\n\t\t\t *\t\t\tconsole.log(nodes[i].name);\n\t\t\t *\t\t}\n\t\t\t * });\n\t\t\t * @method addAttributeFilter\n\t\t\t * @method {String} name Comma separated list of nodes to collect.\n\t\t\t * @param {function} callback Callback function to execute once it has collected nodes.\n\t\t\t */\n\t\t\taddAttributeFilter: htmlParser.addAttributeFilter,\n\n\t\t\t/**\n\t\t\t * Serializes the specified browser DOM node into a HTML string.\n\t\t\t *\n\t\t\t * @method serialize\n\t\t\t * @param {DOMNode} node DOM node to serialize.\n\t\t\t * @param {Object} args Arguments option that gets passed to event handlers.\n\t\t\t */\n\t\t\tserialize: function(node, args) {\n\t\t\t\tvar self = this, impl, doc, oldDoc, htmlSerializer, content, rootNode;\n\n\t\t\t\t// Explorer won't clone contents of script and style and the\n\t\t\t\t// selected index of select elements are cleared on a clone operation.\n\t\t\t\tif (Env.ie && dom.select('script,style,select,map').length > 0) {\n\t\t\t\t\tcontent = node.innerHTML;\n\t\t\t\t\tnode = node.cloneNode(false);\n\t\t\t\t\tdom.setHTML(node, content);\n\t\t\t\t} else {\n\t\t\t\t\tnode = node.cloneNode(true);\n\t\t\t\t}\n\n\t\t\t\t// Nodes needs to be attached to something in WebKit/Opera\n\t\t\t\t// This fix will make DOM ranges and make Sizzle happy!\n\t\t\t\timpl = document.implementation;\n\t\t\t\tif (impl.createHTMLDocument) {\n\t\t\t\t\t// Create an empty HTML document\n\t\t\t\t\tdoc = impl.createHTMLDocument(\"\");\n\n\t\t\t\t\t// Add the element or it's children if it's a body element to the new document\n\t\t\t\t\teach(node.nodeName == 'BODY' ? node.childNodes : [node], function(node) {\n\t\t\t\t\t\tdoc.body.appendChild(doc.importNode(node, true));\n\t\t\t\t\t});\n\n\t\t\t\t\t// Grab first child or body element for serialization\n\t\t\t\t\tif (node.nodeName != 'BODY') {\n\t\t\t\t\t\tnode = doc.body.firstChild;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnode = doc.body;\n\t\t\t\t\t}\n\n\t\t\t\t\t// set the new document in DOMUtils so createElement etc works\n\t\t\t\t\toldDoc = dom.doc;\n\t\t\t\t\tdom.doc = doc;\n\t\t\t\t}\n\n\t\t\t\targs = args || {};\n\t\t\t\targs.format = args.format || 'html';\n\n\t\t\t\t// Don't wrap content if we want selected html\n\t\t\t\tif (args.selection) {\n\t\t\t\t\targs.forced_root_block = '';\n\t\t\t\t}\n\n\t\t\t\t// Pre process\n\t\t\t\tif (!args.no_events) {\n\t\t\t\t\targs.node = node;\n\t\t\t\t\tself.onPreProcess(args);\n\t\t\t\t}\n\n\t\t\t\t// Parse HTML\n\t\t\t\trootNode = htmlParser.parse(trim(args.getInner ? node.innerHTML : dom.getOuterHTML(node)), args);\n\t\t\t\ttrimTrailingBr(rootNode);\n\n\t\t\t\t// Serialize HTML\n\t\t\t\thtmlSerializer = new Serializer(settings, schema);\n\t\t\t\targs.content = htmlSerializer.serialize(rootNode);\n\n\t\t\t\t// Replace all BOM characters for now until we can find a better solution\n\t\t\t\tif (!args.cleanup) {\n\t\t\t\t\targs.content = Zwsp.trim(args.content);\n\t\t\t\t\targs.content = args.content.replace(/\\uFEFF/g, '');\n\t\t\t\t}\n\n\t\t\t\t// Post process\n\t\t\t\tif (!args.no_events) {\n\t\t\t\t\tself.onPostProcess(args);\n\t\t\t\t}\n\n\t\t\t\t// Restore the old document if it was changed\n\t\t\t\tif (oldDoc) {\n\t\t\t\t\tdom.doc = oldDoc;\n\t\t\t\t}\n\n\t\t\t\targs.node = null;\n\n\t\t\t\treturn args.content;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds valid elements rules to the serializers schema instance this enables you to specify things\n\t\t\t * like what elements should be outputted and what attributes specific elements might have.\n\t\t\t * Consult the Wiki for more details on this format.\n\t\t\t *\n\t\t\t * @method addRules\n\t\t\t * @param {String} rules Valid elements rules string to add to schema.\n\t\t\t */\n\t\t\taddRules: function(rules) {\n\t\t\t\tschema.addValidElements(rules);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Sets the valid elements rules to the serializers schema instance this enables you to specify things\n\t\t\t * like what elements should be outputted and what attributes specific elements might have.\n\t\t\t * Consult the Wiki for more details on this format.\n\t\t\t *\n\t\t\t * @method setRules\n\t\t\t * @param {String} rules Valid elements rules string.\n\t\t\t */\n\t\t\tsetRules: function(rules) {\n\t\t\t\tschema.setValidElements(rules);\n\t\t\t},\n\n\t\t\tonPreProcess: function(args) {\n\t\t\t\tif (editor) {\n\t\t\t\t\teditor.fire('PreProcess', args);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tonPostProcess: function(args) {\n\t\t\t\tif (editor) {\n\t\t\t\t\teditor.fire('PostProcess', args);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds a temporary internal attribute these attributes will get removed on undo and\n\t\t\t * when getting contents out of the editor.\n\t\t\t *\n\t\t\t * @method addTempAttr\n\t\t\t * @param {String} name string\n\t\t\t */\n\t\t\taddTempAttr: addTempAttr,\n\n\t\t\t// Internal\n\t\t\ttrimHtml: trimHtml,\n\t\t\tgetTrimmedContent: getTrimmedContent\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/TridentSelection.js\n\n/**\n * TridentSelection.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Selection class for old explorer versions. This one fakes the\n * native selection object available on modern browsers.\n *\n * @private\n * @class tinymce.dom.TridentSelection\n */\ndefine(\"tinymce/dom/TridentSelection\", [], function() {\n\tfunction Selection(selection) {\n\t\tvar self = this, dom = selection.dom, FALSE = false;\n\n\t\tfunction getPosition(rng, start) {\n\t\t\tvar checkRng, startIndex = 0, endIndex, inside,\n\t\t\t\tchildren, child, offset, index, position = -1, parent;\n\n\t\t\t// Setup test range, collapse it and get the parent\n\t\t\tcheckRng = rng.duplicate();\n\t\t\tcheckRng.collapse(start);\n\t\t\tparent = checkRng.parentElement();\n\n\t\t\t// Check if the selection is within the right document\n\t\t\tif (parent.ownerDocument !== selection.dom.doc) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// IE will report non editable elements as it's parent so look for an editable one\n\t\t\twhile (parent.contentEditable === \"false\") {\n\t\t\t\tparent = parent.parentNode;\n\t\t\t}\n\n\t\t\t// If parent doesn't have any children then return that we are inside the element\n\t\t\tif (!parent.hasChildNodes()) {\n\t\t\t\treturn {node: parent, inside: 1};\n\t\t\t}\n\n\t\t\t// Setup node list and endIndex\n\t\t\tchildren = parent.children;\n\t\t\tendIndex = children.length - 1;\n\n\t\t\t// Perform a binary search for the position\n\t\t\twhile (startIndex <= endIndex) {\n\t\t\t\tindex = Math.floor((startIndex + endIndex) / 2);\n\n\t\t\t\t// Move selection to node and compare the ranges\n\t\t\t\tchild = children[index];\n\t\t\t\tcheckRng.moveToElementText(child);\n\t\t\t\tposition = checkRng.compareEndPoints(start ? 'StartToStart' : 'EndToEnd', rng);\n\n\t\t\t\t// Before/after or an exact match\n\t\t\t\tif (position > 0) {\n\t\t\t\t\tendIndex = index - 1;\n\t\t\t\t} else if (position < 0) {\n\t\t\t\t\tstartIndex = index + 1;\n\t\t\t\t} else {\n\t\t\t\t\treturn {node: child};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Check if child position is before or we didn't find a position\n\t\t\tif (position < 0) {\n\t\t\t\t// No element child was found use the parent element and the offset inside that\n\t\t\t\tif (!child) {\n\t\t\t\t\tcheckRng.moveToElementText(parent);\n\t\t\t\t\tcheckRng.collapse(true);\n\t\t\t\t\tchild = parent;\n\t\t\t\t\tinside = true;\n\t\t\t\t} else {\n\t\t\t\t\tcheckRng.collapse(false);\n\t\t\t\t}\n\n\t\t\t\t// Walk character by character in text node until we hit the selected range endpoint,\n\t\t\t\t// hit the end of document or parent isn't the right one\n\t\t\t\t// We need to walk char by char since rng.text or rng.htmlText will trim line endings\n\t\t\t\toffset = 0;\n\t\t\t\twhile (checkRng.compareEndPoints(start ? 'StartToStart' : 'StartToEnd', rng) !== 0) {\n\t\t\t\t\tif (checkRng.move('character', 1) === 0 || parent != checkRng.parentElement()) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\toffset++;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Child position is after the selection endpoint\n\t\t\t\tcheckRng.collapse(true);\n\n\t\t\t\t// Walk character by character in text node until we hit the selected range endpoint, hit\n\t\t\t\t// the end of document or parent isn't the right one\n\t\t\t\toffset = 0;\n\t\t\t\twhile (checkRng.compareEndPoints(start ? 'StartToStart' : 'StartToEnd', rng) !== 0) {\n\t\t\t\t\tif (checkRng.move('character', -1) === 0 || parent != checkRng.parentElement()) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\toffset++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {node: child, position: position, offset: offset, inside: inside};\n\t\t}\n\n\t\t// Returns a W3C DOM compatible range object by using the IE Range API\n\t\tfunction getRange() {\n\t\t\tvar ieRange = selection.getRng(), domRange = dom.createRng(), element, collapsed, tmpRange, element2, bookmark;\n\n\t\t\t// If selection is outside the current document just return an empty range\n\t\t\telement = ieRange.item ? ieRange.item(0) : ieRange.parentElement();\n\t\t\tif (element.ownerDocument != dom.doc) {\n\t\t\t\treturn domRange;\n\t\t\t}\n\n\t\t\tcollapsed = selection.isCollapsed();\n\n\t\t\t// Handle control selection\n\t\t\tif (ieRange.item) {\n\t\t\t\tdomRange.setStart(element.parentNode, dom.nodeIndex(element));\n\t\t\t\tdomRange.setEnd(domRange.startContainer, domRange.startOffset + 1);\n\n\t\t\t\treturn domRange;\n\t\t\t}\n\n\t\t\tfunction findEndPoint(start) {\n\t\t\t\tvar endPoint = getPosition(ieRange, start), container, offset, textNodeOffset = 0, sibling, undef, nodeValue;\n\n\t\t\t\tcontainer = endPoint.node;\n\t\t\t\toffset = endPoint.offset;\n\n\t\t\t\tif (endPoint.inside && !container.hasChildNodes()) {\n\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](container, 0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (offset === undef) {\n\t\t\t\t\tdomRange[start ? 'setStartBefore' : 'setEndAfter'](container);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (endPoint.position < 0) {\n\t\t\t\t\tsibling = endPoint.inside ? container.firstChild : container.nextSibling;\n\n\t\t\t\t\tif (!sibling) {\n\t\t\t\t\t\tdomRange[start ? 'setStartAfter' : 'setEndAfter'](container);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!offset) {\n\t\t\t\t\t\tif (sibling.nodeType == 3) {\n\t\t\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](sibling, 0);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdomRange[start ? 'setStartBefore' : 'setEndBefore'](sibling);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Find the text node and offset\n\t\t\t\t\twhile (sibling) {\n\t\t\t\t\t\tif (sibling.nodeType == 3) {\n\t\t\t\t\t\t\tnodeValue = sibling.nodeValue;\n\t\t\t\t\t\t\ttextNodeOffset += nodeValue.length;\n\n\t\t\t\t\t\t\t// We are at or passed the position we where looking for\n\t\t\t\t\t\t\tif (textNodeOffset >= offset) {\n\t\t\t\t\t\t\t\tcontainer = sibling;\n\t\t\t\t\t\t\t\ttextNodeOffset -= offset;\n\t\t\t\t\t\t\t\ttextNodeOffset = nodeValue.length - textNodeOffset;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = sibling.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Find the text node and offset\n\t\t\t\t\tsibling = container.previousSibling;\n\n\t\t\t\t\tif (!sibling) {\n\t\t\t\t\t\treturn domRange[start ? 'setStartBefore' : 'setEndBefore'](container);\n\t\t\t\t\t}\n\n\t\t\t\t\t// If there isn't any text to loop then use the first position\n\t\t\t\t\tif (!offset) {\n\t\t\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](sibling, container.nodeValue.length);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdomRange[start ? 'setStartAfter' : 'setEndAfter'](sibling);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (sibling) {\n\t\t\t\t\t\tif (sibling.nodeType == 3) {\n\t\t\t\t\t\t\ttextNodeOffset += sibling.nodeValue.length;\n\n\t\t\t\t\t\t\t// We are at or passed the position we where looking for\n\t\t\t\t\t\t\tif (textNodeOffset >= offset) {\n\t\t\t\t\t\t\t\tcontainer = sibling;\n\t\t\t\t\t\t\t\ttextNodeOffset -= offset;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = sibling.previousSibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](container, textNodeOffset);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\t// Find start point\n\t\t\t\tfindEndPoint(true);\n\n\t\t\t\t// Find end point if needed\n\t\t\t\tif (!collapsed) {\n\t\t\t\t\tfindEndPoint();\n\t\t\t\t}\n\t\t\t} catch (ex) {\n\t\t\t\t// IE has a nasty bug where text nodes might throw \"invalid argument\" when you\n\t\t\t\t// access the nodeValue or other properties of text nodes. This seems to happen when\n\t\t\t\t// text nodes are split into two nodes by a delete/backspace call.\n\t\t\t\t// So let us detect and try to fix it.\n\t\t\t\tif (ex.number == -2147024809) {\n\t\t\t\t\t// Get the current selection\n\t\t\t\t\tbookmark = self.getBookmark(2);\n\n\t\t\t\t\t// Get start element\n\t\t\t\t\ttmpRange = ieRange.duplicate();\n\t\t\t\t\ttmpRange.collapse(true);\n\t\t\t\t\telement = tmpRange.parentElement();\n\n\t\t\t\t\t// Get end element\n\t\t\t\t\tif (!collapsed) {\n\t\t\t\t\t\ttmpRange = ieRange.duplicate();\n\t\t\t\t\t\ttmpRange.collapse(false);\n\t\t\t\t\t\telement2 = tmpRange.parentElement();\n\t\t\t\t\t\telement2.innerHTML = element2.innerHTML;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove the broken elements\n\t\t\t\t\telement.innerHTML = element.innerHTML;\n\n\t\t\t\t\t// Restore the selection\n\t\t\t\t\tself.moveToBookmark(bookmark);\n\n\t\t\t\t\t// Since the range has moved we need to re-get it\n\t\t\t\t\tieRange = selection.getRng();\n\n\t\t\t\t\t// Find start point\n\t\t\t\t\tfindEndPoint(true);\n\n\t\t\t\t\t// Find end point if needed\n\t\t\t\t\tif (!collapsed) {\n\t\t\t\t\t\tfindEndPoint();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthrow ex; // Throw other errors\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn domRange;\n\t\t}\n\n\t\tthis.getBookmark = function(type) {\n\t\t\tvar rng = selection.getRng(), bookmark = {};\n\n\t\t\tfunction getIndexes(node) {\n\t\t\t\tvar parent, root, children, i, indexes = [];\n\n\t\t\t\tparent = node.parentNode;\n\t\t\t\troot = dom.getRoot().parentNode;\n\n\t\t\t\twhile (parent != root && parent.nodeType !== 9) {\n\t\t\t\t\tchildren = parent.children;\n\n\t\t\t\t\ti = children.length;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (node === children[i]) {\n\t\t\t\t\t\t\tindexes.push(i);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = parent;\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn indexes;\n\t\t\t}\n\n\t\t\tfunction getBookmarkEndPoint(start) {\n\t\t\t\tvar position;\n\n\t\t\t\tposition = getPosition(rng, start);\n\t\t\t\tif (position) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tposition: position.position,\n\t\t\t\t\t\toffset: position.offset,\n\t\t\t\t\t\tindexes: getIndexes(position.node),\n\t\t\t\t\t\tinside: position.inside\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Non ubstructive bookmark\n\t\t\tif (type === 2) {\n\t\t\t\t// Handle text selection\n\t\t\t\tif (!rng.item) {\n\t\t\t\t\tbookmark.start = getBookmarkEndPoint(true);\n\n\t\t\t\t\tif (!selection.isCollapsed()) {\n\t\t\t\t\t\tbookmark.end = getBookmarkEndPoint();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tbookmark.start = {ctrl: true, indexes: getIndexes(rng.item(0))};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn bookmark;\n\t\t};\n\n\t\tthis.moveToBookmark = function(bookmark) {\n\t\t\tvar rng, body = dom.doc.body;\n\n\t\t\tfunction resolveIndexes(indexes) {\n\t\t\t\tvar node, i, idx, children;\n\n\t\t\t\tnode = dom.getRoot();\n\t\t\t\tfor (i = indexes.length - 1; i >= 0; i--) {\n\t\t\t\t\tchildren = node.children;\n\t\t\t\t\tidx = indexes[i];\n\n\t\t\t\t\tif (idx <= children.length - 1) {\n\t\t\t\t\t\tnode = children[idx];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tfunction setBookmarkEndPoint(start) {\n\t\t\t\tvar endPoint = bookmark[start ? 'start' : 'end'], moveLeft, moveRng, undef, offset;\n\n\t\t\t\tif (endPoint) {\n\t\t\t\t\tmoveLeft = endPoint.position > 0;\n\n\t\t\t\t\tmoveRng = body.createTextRange();\n\t\t\t\t\tmoveRng.moveToElementText(resolveIndexes(endPoint.indexes));\n\n\t\t\t\t\toffset = endPoint.offset;\n\t\t\t\t\tif (offset !== undef) {\n\t\t\t\t\t\tmoveRng.collapse(endPoint.inside || moveLeft);\n\t\t\t\t\t\tmoveRng.moveStart('character', moveLeft ? -offset : offset);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmoveRng.collapse(start);\n\t\t\t\t\t}\n\n\t\t\t\t\trng.setEndPoint(start ? 'StartToStart' : 'EndToStart', moveRng);\n\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\trng.collapse(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (bookmark.start) {\n\t\t\t\tif (bookmark.start.ctrl) {\n\t\t\t\t\trng = body.createControlRange();\n\t\t\t\t\trng.addElement(resolveIndexes(bookmark.start.indexes));\n\t\t\t\t\trng.select();\n\t\t\t\t} else {\n\t\t\t\t\trng = body.createTextRange();\n\t\t\t\t\tsetBookmarkEndPoint(true);\n\t\t\t\t\tsetBookmarkEndPoint();\n\t\t\t\t\trng.select();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.addRange = function(rng) {\n\t\t\tvar ieRng, ctrlRng, startContainer, startOffset, endContainer, endOffset, sibling,\n\t\t\t\tdoc = selection.dom.doc, body = doc.body, nativeRng, ctrlElm;\n\n\t\t\tfunction setEndPoint(start) {\n\t\t\t\tvar container, offset, marker, tmpRng, nodes;\n\n\t\t\t\tmarker = dom.create('a');\n\t\t\t\tcontainer = start ? startContainer : endContainer;\n\t\t\t\toffset = start ? startOffset : endOffset;\n\t\t\t\ttmpRng = ieRng.duplicate();\n\n\t\t\t\tif (container == doc || container == doc.documentElement) {\n\t\t\t\t\tcontainer = body;\n\t\t\t\t\toffset = 0;\n\t\t\t\t}\n\n\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\tcontainer.parentNode.insertBefore(marker, container);\n\t\t\t\t\ttmpRng.moveToElementText(marker);\n\t\t\t\t\ttmpRng.moveStart('character', offset);\n\t\t\t\t\tdom.remove(marker);\n\t\t\t\t\tieRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', tmpRng);\n\t\t\t\t} else {\n\t\t\t\t\tnodes = container.childNodes;\n\n\t\t\t\t\tif (nodes.length) {\n\t\t\t\t\t\tif (offset >= nodes.length) {\n\t\t\t\t\t\t\tdom.insertAfter(marker, nodes[nodes.length - 1]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcontainer.insertBefore(marker, nodes[offset]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttmpRng.moveToElementText(marker);\n\t\t\t\t\t} else if (container.canHaveHTML) {\n\t\t\t\t\t\t// Empty node selection for example <div>|</div>\n\t\t\t\t\t\t// Setting innerHTML with a span marker then remove that marker seems to keep empty block elements open\n\t\t\t\t\t\tcontainer.innerHTML = '<span>&#xFEFF;</span>';\n\t\t\t\t\t\tmarker = container.firstChild;\n\t\t\t\t\t\ttmpRng.moveToElementText(marker);\n\t\t\t\t\t\ttmpRng.collapse(FALSE); // Collapse false works better than true for some odd reason\n\t\t\t\t\t}\n\n\t\t\t\t\tieRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', tmpRng);\n\t\t\t\t\tdom.remove(marker);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Setup some shorter versions\n\t\t\tstartContainer = rng.startContainer;\n\t\t\tstartOffset = rng.startOffset;\n\t\t\tendContainer = rng.endContainer;\n\t\t\tendOffset = rng.endOffset;\n\t\t\tieRng = body.createTextRange();\n\n\t\t\t// If single element selection then try making a control selection out of it\n\t\t\tif (startContainer == endContainer && startContainer.nodeType == 1) {\n\t\t\t\t// Trick to place the caret inside an empty block element like <p></p>\n\t\t\t\tif (startOffset == endOffset && !startContainer.hasChildNodes()) {\n\t\t\t\t\tif (startContainer.canHaveHTML) {\n\t\t\t\t\t\t// Check if previous sibling is an empty block if it is then we need to render it\n\t\t\t\t\t\t// IE would otherwise move the caret into the sibling instead of the empty startContainer see: #5236\n\t\t\t\t\t\t// Example this: <p></p><p>|</p> would become this: <p>|</p><p></p>\n\t\t\t\t\t\tsibling = startContainer.previousSibling;\n\t\t\t\t\t\tif (sibling && !sibling.hasChildNodes() && dom.isBlock(sibling)) {\n\t\t\t\t\t\t\tsibling.innerHTML = '&#xFEFF;';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsibling = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstartContainer.innerHTML = '<span>&#xFEFF;</span><span>&#xFEFF;</span>';\n\t\t\t\t\t\tieRng.moveToElementText(startContainer.lastChild);\n\t\t\t\t\t\tieRng.select();\n\t\t\t\t\t\tdom.doc.selection.clear();\n\t\t\t\t\t\tstartContainer.innerHTML = '';\n\n\t\t\t\t\t\tif (sibling) {\n\t\t\t\t\t\t\tsibling.innerHTML = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tstartOffset = dom.nodeIndex(startContainer);\n\t\t\t\t\tstartContainer = startContainer.parentNode;\n\t\t\t\t}\n\n\t\t\t\tif (startOffset == endOffset - 1) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tctrlElm = startContainer.childNodes[startOffset];\n\t\t\t\t\t\tctrlRng = body.createControlRange();\n\t\t\t\t\t\tctrlRng.addElement(ctrlElm);\n\t\t\t\t\t\tctrlRng.select();\n\n\t\t\t\t\t\t// Check if the range produced is on the correct element and is a control range\n\t\t\t\t\t\t// On IE 8 it will select the parent contentEditable container if you select an inner element see: #5398\n\t\t\t\t\t\tnativeRng = selection.getRng();\n\t\t\t\t\t\tif (nativeRng.item && ctrlElm === nativeRng.item(0)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// Ignore\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Set start/end point of selection\n\t\t\tsetEndPoint(true);\n\t\t\tsetEndPoint();\n\n\t\t\t// Select the new range and scroll it into view\n\t\t\tieRng.select();\n\t\t};\n\n\t\t// Expose range method\n\t\tthis.getRangeAt = getRange;\n\t}\n\n\treturn Selection;\n});\n\n// Included from: js/tinymce/classes/util/VK.js\n\n/**\n * VK.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This file exposes a set of the common KeyCodes for use. Please grow it as needed.\n */\ndefine(\"tinymce/util/VK\", [\n\t\"tinymce/Env\"\n], function(Env) {\n\treturn {\n\t\tBACKSPACE: 8,\n\t\tDELETE: 46,\n\t\tDOWN: 40,\n\t\tENTER: 13,\n\t\tLEFT: 37,\n\t\tRIGHT: 39,\n\t\tSPACEBAR: 32,\n\t\tTAB: 9,\n\t\tUP: 38,\n\n\t\tmodifierPressed: function(e) {\n\t\t\treturn e.shiftKey || e.ctrlKey || e.altKey || this.metaKeyPressed(e);\n\t\t},\n\n\t\tmetaKeyPressed: function(e) {\n\t\t\t// Check if ctrl or meta key is pressed. Edge case for AltGr on Windows where it produces ctrlKey+altKey states\n\t\t\treturn (Env.mac ? e.metaKey : e.ctrlKey && !e.altKey);\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/ControlSelection.js\n\n/**\n * ControlSelection.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles control selection of elements. Controls are elements\n * that can be resized and needs to be selected as a whole. It adds custom resize handles\n * to all browser engines that support properly disabling the built in resize logic.\n *\n * @class tinymce.dom.ControlSelection\n */\ndefine(\"tinymce/dom/ControlSelection\", [\n\t\"tinymce/util/VK\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/Env\",\n\t\"tinymce/dom/NodeType\"\n], function(VK, Tools, Delay, Env, NodeType) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse;\n\tvar isContentEditableTrue = NodeType.isContentEditableTrue;\n\n\tfunction getContentEditableRoot(root, node) {\n\t\twhile (node && node != root) {\n\t\t\tif (isContentEditableTrue(node) || isContentEditableFalse(node)) {\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\treturn function(selection, editor) {\n\t\tvar dom = editor.dom, each = Tools.each;\n\t\tvar selectedElm, selectedElmGhost, resizeHelper, resizeHandles, selectedHandle, lastMouseDownEvent;\n\t\tvar startX, startY, selectedElmX, selectedElmY, startW, startH, ratio, resizeStarted;\n\t\tvar width, height, editableDoc = editor.getDoc(), rootDocument = document, isIE = Env.ie && Env.ie < 11;\n\t\tvar abs = Math.abs, round = Math.round, rootElement = editor.getBody(), startScrollWidth, startScrollHeight;\n\n\t\t// Details about each resize handle how to scale etc\n\t\tresizeHandles = {\n\t\t\t// Name: x multiplier, y multiplier, delta size x, delta size y\n\t\t\t/*n: [0.5, 0, 0, -1],\n\t\t\te: [1, 0.5, 1, 0],\n\t\t\ts: [0.5, 1, 0, 1],\n\t\t\tw: [0, 0.5, -1, 0],*/\n\t\t\tnw: [0, 0, -1, -1],\n\t\t\tne: [1, 0, 1, -1],\n\t\t\tse: [1, 1, 1, 1],\n\t\t\tsw: [0, 1, -1, 1]\n\t\t};\n\n\t\t// Add CSS for resize handles, cloned element and selected\n\t\tvar rootClass = '.mce-content-body';\n\t\teditor.contentStyles.push(\n\t\t\trootClass + ' div.mce-resizehandle {' +\n\t\t\t\t'position: absolute;' +\n\t\t\t\t'border: 1px solid black;' +\n\t\t\t\t'box-sizing: box-sizing;' +\n\t\t\t\t'background: #FFF;' +\n\t\t\t\t'width: 7px;' +\n\t\t\t\t'height: 7px;' +\n\t\t\t\t'z-index: 10000' +\n\t\t\t'}' +\n\t\t\trootClass + ' .mce-resizehandle:hover {' +\n\t\t\t\t'background: #000' +\n\t\t\t'}' +\n\t\t\trootClass + ' img[data-mce-selected],' + rootClass + ' hr[data-mce-selected] {' +\n\t\t\t\t'outline: 1px solid black;' +\n\t\t\t\t'resize: none' + // Have been talks about implementing this in browsers\n\t\t\t'}' +\n\t\t\trootClass + ' .mce-clonedresizable {' +\n\t\t\t\t'position: absolute;' +\n\t\t\t\t(Env.gecko ? '' : 'outline: 1px dashed black;') + // Gecko produces trails while resizing\n\t\t\t\t'opacity: .5;' +\n\t\t\t\t'filter: alpha(opacity=50);' +\n\t\t\t\t'z-index: 10000' +\n\t\t\t'}' +\n\t\t\trootClass + ' .mce-resize-helper {' +\n\t\t\t\t'background: #555;' +\n\t\t\t\t'background: rgba(0,0,0,0.75);' +\n\t\t\t\t'border-radius: 3px;' +\n\t\t\t\t'border: 1px;' +\n\t\t\t\t'color: white;' +\n\t\t\t\t'display: none;' +\n\t\t\t\t'font-family: sans-serif;' +\n\t\t\t\t'font-size: 12px;' +\n\t\t\t\t'white-space: nowrap;' +\n\t\t\t\t'line-height: 14px;' +\n\t\t\t\t'margin: 5px 10px;' +\n\t\t\t\t'padding: 5px;' +\n\t\t\t\t'position: absolute;' +\n\t\t\t\t'z-index: 10001' +\n\t\t\t'}'\n\t\t);\n\n\t\tfunction isResizable(elm) {\n\t\t\tvar selector = editor.settings.object_resizing;\n\n\t\t\tif (selector === false || Env.iOS) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (typeof selector != 'string') {\n\t\t\t\tselector = 'table,img,div';\n\t\t\t}\n\n\t\t\tif (elm.getAttribute('data-mce-resize') === 'false') {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (elm == editor.getBody()) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn editor.dom.is(elm, selector);\n\t\t}\n\n\t\tfunction resizeGhostElement(e) {\n\t\t\tvar deltaX, deltaY, proportional;\n\t\t\tvar resizeHelperX, resizeHelperY;\n\n\t\t\t// Calc new width/height\n\t\t\tdeltaX = e.screenX - startX;\n\t\t\tdeltaY = e.screenY - startY;\n\n\t\t\t// Calc new size\n\t\t\twidth = deltaX * selectedHandle[2] + startW;\n\t\t\theight = deltaY * selectedHandle[3] + startH;\n\n\t\t\t// Never scale down lower than 5 pixels\n\t\t\twidth = width < 5 ? 5 : width;\n\t\t\theight = height < 5 ? 5 : height;\n\n\t\t\tif (selectedElm.nodeName == \"IMG\" && editor.settings.resize_img_proportional !== false) {\n\t\t\t\tproportional = !VK.modifierPressed(e);\n\t\t\t} else {\n\t\t\t\tproportional = VK.modifierPressed(e) || (selectedElm.nodeName == \"IMG\" && selectedHandle[2] * selectedHandle[3] !== 0);\n\t\t\t}\n\n\t\t\t// Constrain proportions\n\t\t\tif (proportional) {\n\t\t\t\tif (abs(deltaX) > abs(deltaY)) {\n\t\t\t\t\theight = round(width * ratio);\n\t\t\t\t\twidth = round(height / ratio);\n\t\t\t\t} else {\n\t\t\t\t\twidth = round(height / ratio);\n\t\t\t\t\theight = round(width * ratio);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Update ghost size\n\t\t\tdom.setStyles(selectedElmGhost, {\n\t\t\t\twidth: width,\n\t\t\t\theight: height\n\t\t\t});\n\n\t\t\t// Update resize helper position\n\t\t\tresizeHelperX = selectedHandle.startPos.x + deltaX;\n\t\t\tresizeHelperY = selectedHandle.startPos.y + deltaY;\n\t\t\tresizeHelperX = resizeHelperX > 0 ? resizeHelperX : 0;\n\t\t\tresizeHelperY = resizeHelperY > 0 ? resizeHelperY : 0;\n\n\t\t\tdom.setStyles(resizeHelper, {\n\t\t\t\tleft: resizeHelperX,\n\t\t\t\ttop: resizeHelperY,\n\t\t\t\tdisplay: 'block'\n\t\t\t});\n\n\t\t\tresizeHelper.innerHTML = width + ' &times; ' + height;\n\n\t\t\t// Update ghost X position if needed\n\t\t\tif (selectedHandle[2] < 0 && selectedElmGhost.clientWidth <= width) {\n\t\t\t\tdom.setStyle(selectedElmGhost, 'left', selectedElmX + (startW - width));\n\t\t\t}\n\n\t\t\t// Update ghost Y position if needed\n\t\t\tif (selectedHandle[3] < 0 && selectedElmGhost.clientHeight <= height) {\n\t\t\t\tdom.setStyle(selectedElmGhost, 'top', selectedElmY + (startH - height));\n\t\t\t}\n\n\t\t\t// Calculate how must overflow we got\n\t\t\tdeltaX = rootElement.scrollWidth - startScrollWidth;\n\t\t\tdeltaY = rootElement.scrollHeight - startScrollHeight;\n\n\t\t\t// Re-position the resize helper based on the overflow\n\t\t\tif (deltaX + deltaY !== 0) {\n\t\t\t\tdom.setStyles(resizeHelper, {\n\t\t\t\t\tleft: resizeHelperX - deltaX,\n\t\t\t\t\ttop: resizeHelperY - deltaY\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!resizeStarted) {\n\t\t\t\teditor.fire('ObjectResizeStart', {target: selectedElm, width: startW, height: startH});\n\t\t\t\tresizeStarted = true;\n\t\t\t}\n\t\t}\n\n\t\tfunction endGhostResize() {\n\t\t\tresizeStarted = false;\n\n\t\t\tfunction setSizeProp(name, value) {\n\t\t\t\tif (value) {\n\t\t\t\t\t// Resize by using style or attribute\n\t\t\t\t\tif (selectedElm.style[name] || !editor.schema.isValid(selectedElm.nodeName.toLowerCase(), name)) {\n\t\t\t\t\t\tdom.setStyle(selectedElm, name, value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdom.setAttrib(selectedElm, name, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Set width/height properties\n\t\t\tsetSizeProp('width', width);\n\t\t\tsetSizeProp('height', height);\n\n\t\t\tdom.unbind(editableDoc, 'mousemove', resizeGhostElement);\n\t\t\tdom.unbind(editableDoc, 'mouseup', endGhostResize);\n\n\t\t\tif (rootDocument != editableDoc) {\n\t\t\t\tdom.unbind(rootDocument, 'mousemove', resizeGhostElement);\n\t\t\t\tdom.unbind(rootDocument, 'mouseup', endGhostResize);\n\t\t\t}\n\n\t\t\t// Remove ghost/helper and update resize handle positions\n\t\t\tdom.remove(selectedElmGhost);\n\t\t\tdom.remove(resizeHelper);\n\n\t\t\tif (!isIE || selectedElm.nodeName == \"TABLE\") {\n\t\t\t\tshowResizeRect(selectedElm);\n\t\t\t}\n\n\t\t\teditor.fire('ObjectResized', {target: selectedElm, width: width, height: height});\n\t\t\tdom.setAttrib(selectedElm, 'style', dom.getAttrib(selectedElm, 'style'));\n\t\t\teditor.nodeChanged();\n\t\t}\n\n\t\tfunction showResizeRect(targetElm, mouseDownHandleName, mouseDownEvent) {\n\t\t\tvar position, targetWidth, targetHeight, e, rect;\n\n\t\t\thideResizeRect();\n\t\t\tunbindResizeHandleEvents();\n\n\t\t\t// Get position and size of target\n\t\t\tposition = dom.getPos(targetElm, rootElement);\n\t\t\tselectedElmX = position.x;\n\t\t\tselectedElmY = position.y;\n\t\t\trect = targetElm.getBoundingClientRect(); // Fix for Gecko offsetHeight for table with caption\n\t\t\ttargetWidth = rect.width || (rect.right - rect.left);\n\t\t\ttargetHeight = rect.height || (rect.bottom - rect.top);\n\n\t\t\t// Reset width/height if user selects a new image/table\n\t\t\tif (selectedElm != targetElm) {\n\t\t\t\tdetachResizeStartListener();\n\t\t\t\tselectedElm = targetElm;\n\t\t\t\twidth = height = 0;\n\t\t\t}\n\n\t\t\t// Makes it possible to disable resizing\n\t\t\te = editor.fire('ObjectSelected', {target: targetElm});\n\n\t\t\tif (isResizable(targetElm) && !e.isDefaultPrevented()) {\n\t\t\t\teach(resizeHandles, function(handle, name) {\n\t\t\t\t\tvar handleElm;\n\n\t\t\t\t\tfunction startDrag(e) {\n\t\t\t\t\t\tstartX = e.screenX;\n\t\t\t\t\t\tstartY = e.screenY;\n\t\t\t\t\t\tstartW = selectedElm.clientWidth;\n\t\t\t\t\t\tstartH = selectedElm.clientHeight;\n\t\t\t\t\t\tratio = startH / startW;\n\t\t\t\t\t\tselectedHandle = handle;\n\n\t\t\t\t\t\thandle.startPos = {\n\t\t\t\t\t\t\tx: targetWidth * handle[0] + selectedElmX,\n\t\t\t\t\t\t\ty: targetHeight * handle[1] + selectedElmY\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tstartScrollWidth = rootElement.scrollWidth;\n\t\t\t\t\t\tstartScrollHeight = rootElement.scrollHeight;\n\n\t\t\t\t\t\tselectedElmGhost = selectedElm.cloneNode(true);\n\t\t\t\t\t\tdom.addClass(selectedElmGhost, 'mce-clonedresizable');\n\t\t\t\t\t\tdom.setAttrib(selectedElmGhost, 'data-mce-bogus', 'all');\n\t\t\t\t\t\tselectedElmGhost.contentEditable = false; // Hides IE move layer cursor\n\t\t\t\t\t\tselectedElmGhost.unSelectabe = true;\n\t\t\t\t\t\tdom.setStyles(selectedElmGhost, {\n\t\t\t\t\t\t\tleft: selectedElmX,\n\t\t\t\t\t\t\ttop: selectedElmY,\n\t\t\t\t\t\t\tmargin: 0\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tselectedElmGhost.removeAttribute('data-mce-selected');\n\t\t\t\t\t\trootElement.appendChild(selectedElmGhost);\n\n\t\t\t\t\t\tdom.bind(editableDoc, 'mousemove', resizeGhostElement);\n\t\t\t\t\t\tdom.bind(editableDoc, 'mouseup', endGhostResize);\n\n\t\t\t\t\t\tif (rootDocument != editableDoc) {\n\t\t\t\t\t\t\tdom.bind(rootDocument, 'mousemove', resizeGhostElement);\n\t\t\t\t\t\t\tdom.bind(rootDocument, 'mouseup', endGhostResize);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresizeHelper = dom.add(rootElement, 'div', {\n\t\t\t\t\t\t\t'class': 'mce-resize-helper',\n\t\t\t\t\t\t\t'data-mce-bogus': 'all'\n\t\t\t\t\t\t}, startW + ' &times; ' + startH);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (mouseDownHandleName) {\n\t\t\t\t\t\t// Drag started by IE native resizestart\n\t\t\t\t\t\tif (name == mouseDownHandleName) {\n\t\t\t\t\t\t\tstartDrag(mouseDownEvent);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Get existing or render resize handle\n\t\t\t\t\thandleElm = dom.get('mceResizeHandle' + name);\n\t\t\t\t\tif (handleElm) {\n\t\t\t\t\t\tdom.remove(handleElm);\n\t\t\t\t\t}\n\n\t\t\t\t\thandleElm = dom.add(rootElement, 'div', {\n\t\t\t\t\t\tid: 'mceResizeHandle' + name,\n\t\t\t\t\t\t'data-mce-bogus': 'all',\n\t\t\t\t\t\t'class': 'mce-resizehandle',\n\t\t\t\t\t\tunselectable: true,\n\t\t\t\t\t\tstyle: 'cursor:' + name + '-resize; margin:0; padding:0'\n\t\t\t\t\t});\n\n\t\t\t\t\t// Hides IE move layer cursor\n\t\t\t\t\t// If we set it on Chrome we get this wounderful bug: #6725\n\t\t\t\t\tif (Env.ie) {\n\t\t\t\t\t\thandleElm.contentEditable = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tdom.bind(handleElm, 'mousedown', function(e) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tstartDrag(e);\n\t\t\t\t\t});\n\n\t\t\t\t\thandle.elm = handleElm;\n\n\t\t\t\t\t// Position element\n\t\t\t\t\tdom.setStyles(handleElm, {\n\t\t\t\t\t\tleft: (targetWidth * handle[0] + selectedElmX) - (handleElm.offsetWidth / 2),\n\t\t\t\t\t\ttop: (targetHeight * handle[1] + selectedElmY) - (handleElm.offsetHeight / 2)\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\thideResizeRect();\n\t\t\t}\n\n\t\t\tselectedElm.setAttribute('data-mce-selected', '1');\n\t\t}\n\n\t\tfunction hideResizeRect() {\n\t\t\tvar name, handleElm;\n\n\t\t\tunbindResizeHandleEvents();\n\n\t\t\tif (selectedElm) {\n\t\t\t\tselectedElm.removeAttribute('data-mce-selected');\n\t\t\t}\n\n\t\t\tfor (name in resizeHandles) {\n\t\t\t\thandleElm = dom.get('mceResizeHandle' + name);\n\t\t\t\tif (handleElm) {\n\t\t\t\t\tdom.unbind(handleElm);\n\t\t\t\t\tdom.remove(handleElm);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction updateResizeRect(e) {\n\t\t\tvar startElm, controlElm;\n\n\t\t\tfunction isChildOrEqual(node, parent) {\n\t\t\t\tif (node) {\n\t\t\t\t\tdo {\n\t\t\t\t\t\tif (node === parent) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} while ((node = node.parentNode));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Ignore all events while resizing or if the editor instance was removed\n\t\t\tif (resizeStarted || editor.removed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Remove data-mce-selected from all elements since they might have been copied using Ctrl+c/v\n\t\t\teach(dom.select('img[data-mce-selected],hr[data-mce-selected]'), function(img) {\n\t\t\t\timg.removeAttribute('data-mce-selected');\n\t\t\t});\n\n\t\t\tcontrolElm = e.type == 'mousedown' ? e.target : selection.getNode();\n\t\t\tcontrolElm = dom.$(controlElm).closest(isIE ? 'table' : 'table,img,hr')[0];\n\n\t\t\tif (isChildOrEqual(controlElm, rootElement)) {\n\t\t\t\tdisableGeckoResize();\n\t\t\t\tstartElm = selection.getStart(true);\n\n\t\t\t\tif (isChildOrEqual(startElm, controlElm) && isChildOrEqual(selection.getEnd(true), controlElm)) {\n\t\t\t\t\tif (!isIE || (controlElm != startElm && startElm.nodeName !== 'IMG')) {\n\t\t\t\t\t\tshowResizeRect(controlElm);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thideResizeRect();\n\t\t}\n\n\t\tfunction attachEvent(elm, name, func) {\n\t\t\tif (elm && elm.attachEvent) {\n\t\t\t\telm.attachEvent('on' + name, func);\n\t\t\t}\n\t\t}\n\n\t\tfunction detachEvent(elm, name, func) {\n\t\t\tif (elm && elm.detachEvent) {\n\t\t\t\telm.detachEvent('on' + name, func);\n\t\t\t}\n\t\t}\n\n\t\tfunction resizeNativeStart(e) {\n\t\t\tvar target = e.srcElement, pos, name, corner, cornerX, cornerY, relativeX, relativeY;\n\n\t\t\tpos = target.getBoundingClientRect();\n\t\t\trelativeX = lastMouseDownEvent.clientX - pos.left;\n\t\t\trelativeY = lastMouseDownEvent.clientY - pos.top;\n\n\t\t\t// Figure out what corner we are draging on\n\t\t\tfor (name in resizeHandles) {\n\t\t\t\tcorner = resizeHandles[name];\n\n\t\t\t\tcornerX = target.offsetWidth * corner[0];\n\t\t\t\tcornerY = target.offsetHeight * corner[1];\n\n\t\t\t\tif (abs(cornerX - relativeX) < 8 && abs(cornerY - relativeY) < 8) {\n\t\t\t\t\tselectedHandle = corner;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove native selection and let the magic begin\n\t\t\tresizeStarted = true;\n\t\t\teditor.fire('ObjectResizeStart', {\n\t\t\t\ttarget: selectedElm,\n\t\t\t\twidth: selectedElm.clientWidth,\n\t\t\t\theight: selectedElm.clientHeight\n\t\t\t});\n\t\t\teditor.getDoc().selection.empty();\n\t\t\tshowResizeRect(target, name, lastMouseDownEvent);\n\t\t}\n\n\t\tfunction preventDefault(e) {\n\t\t\tif (e.preventDefault) {\n\t\t\t\te.preventDefault();\n\t\t\t} else {\n\t\t\t\te.returnValue = false; // IE\n\t\t\t}\n\t\t}\n\n\t\tfunction isWithinContentEditableFalse(elm) {\n\t\t\treturn isContentEditableFalse(getContentEditableRoot(editor.getBody(), elm));\n\t\t}\n\n\t\tfunction nativeControlSelect(e) {\n\t\t\tvar target = e.srcElement;\n\n\t\t\tif (isWithinContentEditableFalse(target)) {\n\t\t\t\tpreventDefault(e);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (target != selectedElm) {\n\t\t\t\teditor.fire('ObjectSelected', {target: target});\n\t\t\t\tdetachResizeStartListener();\n\n\t\t\t\tif (target.id.indexOf('mceResizeHandle') === 0) {\n\t\t\t\t\te.returnValue = false;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (target.nodeName == 'IMG' || target.nodeName == 'TABLE') {\n\t\t\t\t\thideResizeRect();\n\t\t\t\t\tselectedElm = target;\n\t\t\t\t\tattachEvent(target, 'resizestart', resizeNativeStart);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction detachResizeStartListener() {\n\t\t\tdetachEvent(selectedElm, 'resizestart', resizeNativeStart);\n\t\t}\n\n\t\tfunction unbindResizeHandleEvents() {\n\t\t\tfor (var name in resizeHandles) {\n\t\t\t\tvar handle = resizeHandles[name];\n\n\t\t\t\tif (handle.elm) {\n\t\t\t\t\tdom.unbind(handle.elm);\n\t\t\t\t\tdelete handle.elm;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction disableGeckoResize() {\n\t\t\ttry {\n\t\t\t\t// Disable object resizing on Gecko\n\t\t\t\teditor.getDoc().execCommand('enableObjectResizing', false, false);\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore\n\t\t\t}\n\t\t}\n\n\t\tfunction controlSelect(elm) {\n\t\t\tvar ctrlRng;\n\n\t\t\tif (!isIE) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tctrlRng = editableDoc.body.createControlRange();\n\n\t\t\ttry {\n\t\t\t\tctrlRng.addElement(elm);\n\t\t\t\tctrlRng.select();\n\t\t\t\treturn true;\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore since the element can't be control selected for example a P tag\n\t\t\t}\n\t\t}\n\n\t\teditor.on('init', function() {\n\t\t\tif (isIE) {\n\t\t\t\t// Hide the resize rect on resize and reselect the image\n\t\t\t\teditor.on('ObjectResized', function(e) {\n\t\t\t\t\tif (e.target.nodeName != 'TABLE') {\n\t\t\t\t\t\thideResizeRect();\n\t\t\t\t\t\tcontrolSelect(e.target);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tattachEvent(rootElement, 'controlselect', nativeControlSelect);\n\n\t\t\t\teditor.on('mousedown', function(e) {\n\t\t\t\t\tlastMouseDownEvent = e;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tdisableGeckoResize();\n\n\t\t\t\t// Sniff sniff, hard to feature detect this stuff\n\t\t\t\tif (Env.ie >= 11) {\n\t\t\t\t\t// Needs to be mousedown for drag/drop to work on IE 11\n\t\t\t\t\t// Needs to be click on Edge to properly select images\n\t\t\t\t\teditor.on('mousedown click', function(e) {\n\t\t\t\t\t\tvar target = e.target, nodeName = target.nodeName;\n\n\t\t\t\t\t\tif (!resizeStarted && /^(TABLE|IMG|HR)$/.test(nodeName) && !isWithinContentEditableFalse(target)) {\n\t\t\t\t\t\t\teditor.selection.select(target, nodeName == 'TABLE');\n\n\t\t\t\t\t\t\t// Only fire once since nodeChange is expensive\n\t\t\t\t\t\t\tif (e.type == 'mousedown') {\n\t\t\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\teditor.dom.bind(rootElement, 'mscontrolselect', function(e) {\n\t\t\t\t\t\tfunction delayedSelect(node) {\n\t\t\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\t\t\teditor.selection.select(node);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (isWithinContentEditableFalse(e.target)) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tdelayedSelect(e.target);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (/^(TABLE|IMG|HR)$/.test(e.target.nodeName)) {\n\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t// This moves the selection from being a control selection to a text like selection like in WebKit #6753\n\t\t\t\t\t\t\t// TODO: Fix this the day IE works like other browsers without this nasty native ugly control selections.\n\t\t\t\t\t\t\tif (e.target.tagName == 'IMG') {\n\t\t\t\t\t\t\t\tdelayedSelect(e.target);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar throttledUpdateResizeRect = Delay.throttle(function(e) {\n\t\t\t\tif (!editor.composing) {\n\t\t\t\t\tupdateResizeRect(e);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('nodechange ResizeEditor ResizeWindow drop', throttledUpdateResizeRect);\n\n\t\t\t// Update resize rect while typing in a table\n\t\t\teditor.on('keyup compositionend', function(e) {\n\t\t\t\t// Don't update the resize rect while composing since it blows away the IME see: #2710\n\t\t\t\tif (selectedElm && selectedElm.nodeName == \"TABLE\") {\n\t\t\t\t\tthrottledUpdateResizeRect(e);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('hide blur', hideResizeRect);\n\n\t\t\t// Hide rect on focusout since it would float on top of windows otherwise\n\t\t\t//editor.on('focusout', hideResizeRect);\n\t\t});\n\n\t\teditor.on('remove', unbindResizeHandleEvents);\n\n\t\tfunction destroy() {\n\t\t\tselectedElm = selectedElmGhost = null;\n\n\t\t\tif (isIE) {\n\t\t\t\tdetachResizeStartListener();\n\t\t\t\tdetachEvent(rootElement, 'controlselect', nativeControlSelect);\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tisResizable: isResizable,\n\t\t\tshowResizeRect: showResizeRect,\n\t\t\thideResizeRect: hideResizeRect,\n\t\t\tupdateResizeRect: updateResizeRect,\n\t\t\tcontrolSelect: controlSelect,\n\t\t\tdestroy: destroy\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/util/Fun.js\n\n/**\n * Fun.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Functional utility class.\n *\n * @private\n * @class tinymce.util.Fun\n */\ndefine(\"tinymce/util/Fun\", [], function() {\n\tvar slice = [].slice;\n\n\tfunction constant(value) {\n\t\treturn function() {\n\t\t\treturn value;\n\t\t};\n\t}\n\n\tfunction negate(predicate) {\n\t\treturn function(x) {\n\t\t\treturn !predicate(x);\n\t\t};\n\t}\n\n\tfunction compose(f, g) {\n\t\treturn function(x) {\n\t\t\treturn f(g(x));\n\t\t};\n\t}\n\n\tfunction or() {\n\t\tvar args = slice.call(arguments);\n\n\t\treturn function(x) {\n\t\t\tfor (var i = 0; i < args.length; i++) {\n\t\t\t\tif (args[i](x)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t}\n\n\tfunction and() {\n\t\tvar args = slice.call(arguments);\n\n\t\treturn function(x) {\n\t\t\tfor (var i = 0; i < args.length; i++) {\n\t\t\t\tif (!args[i](x)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t};\n\t}\n\n\tfunction curry(fn) {\n\t\tvar args = slice.call(arguments);\n\n\t\tif (args.length - 1 >= fn.length) {\n\t\t\treturn fn.apply(this, args.slice(1));\n\t\t}\n\n\t\treturn function() {\n\t\t\tvar tempArgs = args.concat([].slice.call(arguments));\n\t\t\treturn curry.apply(this, tempArgs);\n\t\t};\n\t}\n\n\treturn {\n\t\tconstant: constant,\n\t\tnegate: negate,\n\t\tand: and,\n\t\tor: or,\n\t\tcurry: curry,\n\t\tcompose: compose\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/CaretCandidate.js\n\n/**\n * CaretCandidate.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic for handling caret candidates. A caret candidate is\n * for example text nodes, images, input elements, cE=false elements etc.\n *\n * @private\n * @class tinymce.caret.CaretCandidate\n */\ndefine(\"tinymce/caret/CaretCandidate\", [\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/caret/CaretContainer\"\n], function(NodeType, Arr, CaretContainer) {\n\tvar isContentEditableTrue = NodeType.isContentEditableTrue,\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisBr = NodeType.isBr,\n\t\tisText = NodeType.isText,\n\t\tisInvalidTextElement = NodeType.matchNodeNames('script style textarea'),\n\t\tisAtomicInline = NodeType.matchNodeNames('img input textarea hr iframe video audio object'),\n\t\tisTable = NodeType.matchNodeNames('table'),\n\t\tisCaretContainer = CaretContainer.isCaretContainer;\n\n\tfunction isCaretCandidate(node) {\n\t\tif (isCaretContainer(node)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (isText(node)) {\n\t\t\tif (isInvalidTextElement(node.parentNode)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn isAtomicInline(node) || isBr(node) || isTable(node) || isContentEditableFalse(node);\n\t}\n\n\tfunction isInEditable(node, rootNode) {\n\t\tfor (node = node.parentNode; node && node != rootNode; node = node.parentNode) {\n\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (isContentEditableTrue(node)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfunction isAtomicContentEditableFalse(node) {\n\t\tif (!isContentEditableFalse(node)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn Arr.reduce(node.getElementsByTagName('*'), function(result, elm) {\n\t\t\treturn result || isContentEditableTrue(elm);\n\t\t}, false) !== true;\n\t}\n\n\tfunction isAtomic(node) {\n\t\treturn isAtomicInline(node) || isAtomicContentEditableFalse(node);\n\t}\n\n\tfunction isEditableCaretCandidate(node, rootNode) {\n\t\treturn isCaretCandidate(node) && isInEditable(node, rootNode);\n\t}\n\n\treturn {\n\t\tisCaretCandidate: isCaretCandidate,\n\t\tisInEditable: isInEditable,\n\t\tisAtomic: isAtomic,\n\t\tisEditableCaretCandidate: isEditableCaretCandidate\n\t};\n});\n\n// Included from: js/tinymce/classes/geom/ClientRect.js\n\n/**\n * ClientRect.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility functions for working with client rects.\n *\n * @private\n * @class tinymce.geom.ClientRect\n */\ndefine(\"tinymce/geom/ClientRect\", [], function() {\n\tvar round = Math.round;\n\n\tfunction clone(rect) {\n\t\tif (!rect) {\n\t\t\treturn {left: 0, top: 0, bottom: 0, right: 0, width: 0, height: 0};\n\t\t}\n\n\t\treturn {\n\t\t\tleft: round(rect.left),\n\t\t\ttop: round(rect.top),\n\t\t\tbottom: round(rect.bottom),\n\t\t\tright: round(rect.right),\n\t\t\twidth: round(rect.width),\n\t\t\theight: round(rect.height)\n\t\t};\n\t}\n\n\tfunction collapse(clientRect, toStart) {\n\t\tclientRect = clone(clientRect);\n\n\t\tif (toStart) {\n\t\t\tclientRect.right = clientRect.left;\n\t\t} else {\n\t\t\tclientRect.left = clientRect.left + clientRect.width;\n\t\t\tclientRect.right = clientRect.left;\n\t\t}\n\n\t\tclientRect.width = 0;\n\n\t\treturn clientRect;\n\t}\n\n\tfunction isEqual(rect1, rect2) {\n\t\treturn (\n\t\t\trect1.left === rect2.left &&\n\t\t\trect1.top === rect2.top &&\n\t\t\trect1.bottom === rect2.bottom &&\n\t\t\trect1.right === rect2.right\n\t\t);\n\t}\n\n\tfunction isValidOverflow(overflowY, clientRect1, clientRect2) {\n\t\treturn overflowY >= 0 && overflowY <= Math.min(clientRect1.height, clientRect2.height) / 2;\n\n\t}\n\n\tfunction isAbove(clientRect1, clientRect2) {\n\t\tif (clientRect1.bottom < clientRect2.top) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (clientRect1.top > clientRect2.bottom) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn isValidOverflow(clientRect2.top - clientRect1.bottom, clientRect1, clientRect2);\n\t}\n\n\tfunction isBelow(clientRect1, clientRect2) {\n\t\tif (clientRect1.top > clientRect2.bottom) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (clientRect1.bottom < clientRect2.top) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn isValidOverflow(clientRect2.bottom - clientRect1.top, clientRect1, clientRect2);\n\t}\n\n\tfunction isLeft(clientRect1, clientRect2) {\n\t\treturn clientRect1.left < clientRect2.left;\n\t}\n\n\tfunction isRight(clientRect1, clientRect2) {\n\t\treturn clientRect1.right > clientRect2.right;\n\t}\n\n\tfunction compare(clientRect1, clientRect2) {\n\t\tif (isAbove(clientRect1, clientRect2)) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tif (isBelow(clientRect1, clientRect2)) {\n\t\t\treturn 1;\n\t\t}\n\n\t\tif (isLeft(clientRect1, clientRect2)) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tif (isRight(clientRect1, clientRect2)) {\n\t\t\treturn 1;\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\tfunction containsXY(clientRect, clientX, clientY) {\n\t\treturn (\n\t\t\tclientX >= clientRect.left &&\n\t\t\tclientX <= clientRect.right &&\n\t\t\tclientY >= clientRect.top &&\n\t\t\tclientY <= clientRect.bottom\n\t\t);\n\t}\n\n\treturn {\n\t\tclone: clone,\n\t\tcollapse: collapse,\n\t\tisEqual: isEqual,\n\t\tisAbove: isAbove,\n\t\tisBelow: isBelow,\n\t\tisLeft: isLeft,\n\t\tisRight: isRight,\n\t\tcompare: compare,\n\t\tcontainsXY: containsXY\n\t};\n});\n\n// Included from: js/tinymce/classes/text/ExtendingChar.js\n\n/**\n * ExtendingChar.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class contains logic for detecting extending characters.\n *\n * @private\n * @class tinymce.text.ExtendingChar\n * @example\n * var isExtending = ExtendingChar.isExtendingChar('a');\n */\ndefine(\"tinymce/text/ExtendingChar\", [], function() {\n\t// Generated from: http://www.unicode.org/Public/UNIDATA/DerivedCoreProperties.txt\n\t// Only includes the characters in that fit into UCS-2 16 bit\n\tvar extendingChars = new RegExp(\n\t\t\"[\\u0300-\\u036F\\u0483-\\u0487\\u0488-\\u0489\\u0591-\\u05BD\\u05BF\\u05C1-\\u05C2\\u05C4-\\u05C5\\u05C7\\u0610-\\u061A\" +\n\t\t\"\\u064B-\\u065F\\u0670\\u06D6-\\u06DC\\u06DF-\\u06E4\\u06E7-\\u06E8\\u06EA-\\u06ED\\u0711\\u0730-\\u074A\\u07A6-\\u07B0\" +\n\t\t\"\\u07EB-\\u07F3\\u0816-\\u0819\\u081B-\\u0823\\u0825-\\u0827\\u0829-\\u082D\\u0859-\\u085B\\u08E3-\\u0902\\u093A\\u093C\" +\n\t\t\"\\u0941-\\u0948\\u094D\\u0951-\\u0957\\u0962-\\u0963\\u0981\\u09BC\\u09BE\\u09C1-\\u09C4\\u09CD\\u09D7\\u09E2-\\u09E3\" +\n\t\t\"\\u0A01-\\u0A02\\u0A3C\\u0A41-\\u0A42\\u0A47-\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A70-\\u0A71\\u0A75\\u0A81-\\u0A82\\u0ABC\" +\n\t\t\"\\u0AC1-\\u0AC5\\u0AC7-\\u0AC8\\u0ACD\\u0AE2-\\u0AE3\\u0B01\\u0B3C\\u0B3E\\u0B3F\\u0B41-\\u0B44\\u0B4D\\u0B56\\u0B57\" +\n\t\t\"\\u0B62-\\u0B63\\u0B82\\u0BBE\\u0BC0\\u0BCD\\u0BD7\\u0C00\\u0C3E-\\u0C40\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55-\\u0C56\" +\n\t\t\"\\u0C62-\\u0C63\\u0C81\\u0CBC\\u0CBF\\u0CC2\\u0CC6\\u0CCC-\\u0CCD\\u0CD5-\\u0CD6\\u0CE2-\\u0CE3\\u0D01\\u0D3E\\u0D41-\\u0D44\" +\n\t\t\"\\u0D4D\\u0D57\\u0D62-\\u0D63\\u0DCA\\u0DCF\\u0DD2-\\u0DD4\\u0DD6\\u0DDF\\u0E31\\u0E34-\\u0E3A\\u0E47-\\u0E4E\\u0EB1\\u0EB4-\\u0EB9\" +\n\t\t\"\\u0EBB-\\u0EBC\\u0EC8-\\u0ECD\\u0F18-\\u0F19\\u0F35\\u0F37\\u0F39\\u0F71-\\u0F7E\\u0F80-\\u0F84\\u0F86-\\u0F87\\u0F8D-\\u0F97\" +\n\t\t\"\\u0F99-\\u0FBC\\u0FC6\\u102D-\\u1030\\u1032-\\u1037\\u1039-\\u103A\\u103D-\\u103E\\u1058-\\u1059\\u105E-\\u1060\\u1071-\\u1074\" +\n\t\t\"\\u1082\\u1085-\\u1086\\u108D\\u109D\\u135D-\\u135F\\u1712-\\u1714\\u1732-\\u1734\\u1752-\\u1753\\u1772-\\u1773\\u17B4-\\u17B5\" +\n\t\t\"\\u17B7-\\u17BD\\u17C6\\u17C9-\\u17D3\\u17DD\\u180B-\\u180D\\u18A9\\u1920-\\u1922\\u1927-\\u1928\\u1932\\u1939-\\u193B\\u1A17-\\u1A18\" +\n\t\t\"\\u1A1B\\u1A56\\u1A58-\\u1A5E\\u1A60\\u1A62\\u1A65-\\u1A6C\\u1A73-\\u1A7C\\u1A7F\\u1AB0-\\u1ABD\\u1ABE\\u1B00-\\u1B03\\u1B34\" +\n\t\t\"\\u1B36-\\u1B3A\\u1B3C\\u1B42\\u1B6B-\\u1B73\\u1B80-\\u1B81\\u1BA2-\\u1BA5\\u1BA8-\\u1BA9\\u1BAB-\\u1BAD\\u1BE6\\u1BE8-\\u1BE9\" +\n\t\t\"\\u1BED\\u1BEF-\\u1BF1\\u1C2C-\\u1C33\\u1C36-\\u1C37\\u1CD0-\\u1CD2\\u1CD4-\\u1CE0\\u1CE2-\\u1CE8\\u1CED\\u1CF4\\u1CF8-\\u1CF9\" +\n\t\t\"\\u1DC0-\\u1DF5\\u1DFC-\\u1DFF\\u200C-\\u200D\\u20D0-\\u20DC\\u20DD-\\u20E0\\u20E1\\u20E2-\\u20E4\\u20E5-\\u20F0\\u2CEF-\\u2CF1\" +\n\t\t\"\\u2D7F\\u2DE0-\\u2DFF\\u302A-\\u302D\\u302E-\\u302F\\u3099-\\u309A\\uA66F\\uA670-\\uA672\\uA674-\\uA67D\\uA69E-\\uA69F\\uA6F0-\\uA6F1\" +\n\t\t\"\\uA802\\uA806\\uA80B\\uA825-\\uA826\\uA8C4\\uA8E0-\\uA8F1\\uA926-\\uA92D\\uA947-\\uA951\\uA980-\\uA982\\uA9B3\\uA9B6-\\uA9B9\\uA9BC\" +\n\t\t\"\\uA9E5\\uAA29-\\uAA2E\\uAA31-\\uAA32\\uAA35-\\uAA36\\uAA43\\uAA4C\\uAA7C\\uAAB0\\uAAB2-\\uAAB4\\uAAB7-\\uAAB8\\uAABE-\\uAABF\\uAAC1\" +\n\t\t\"\\uAAEC-\\uAAED\\uAAF6\\uABE5\\uABE8\\uABED\\uFB1E\\uFE00-\\uFE0F\\uFE20-\\uFE2F\\uFF9E-\\uFF9F]\"\n\t);\n\n\tfunction isExtendingChar(ch) {\n\t\treturn typeof ch == \"string\" && ch.charCodeAt(0) >= 768 && extendingChars.test(ch);\n\t}\n\n\treturn {\n\t\tisExtendingChar: isExtendingChar\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/CaretPosition.js\n\n/**\n * CaretPosition.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic for creating caret positions within a document a caretposition\n * is similar to a DOMRange object but it doesn't have two endpoints and is also more lightweight\n * since it's now updated live when the DOM changes.\n *\n * @private\n * @class tinymce.caret.CaretPosition\n * @example\n * var caretPos1 = new CaretPosition(container, offset);\n * var caretPos2 = CaretPosition.fromRangeStart(someRange);\n */\ndefine(\"tinymce/caret/CaretPosition\", [\n\t\"tinymce/util/Fun\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/caret/CaretCandidate\",\n\t\"tinymce/geom/ClientRect\",\n\t\"tinymce/text/ExtendingChar\"\n], function(Fun, NodeType, DOMUtils, RangeUtils, CaretCandidate, ClientRect, ExtendingChar) {\n\tvar isElement = NodeType.isElement,\n\t\tisCaretCandidate = CaretCandidate.isCaretCandidate,\n\t\tisBlock = NodeType.matchStyleValues('display', 'block table'),\n\t\tisFloated = NodeType.matchStyleValues('float', 'left right'),\n\t\tisValidElementCaretCandidate = Fun.and(isElement, isCaretCandidate, Fun.negate(isFloated)),\n\t\tisNotPre = Fun.negate(NodeType.matchStyleValues('white-space', 'pre pre-line pre-wrap')),\n\t\tisText = NodeType.isText,\n\t\tisBr = NodeType.isBr,\n\t\tnodeIndex = DOMUtils.nodeIndex,\n\t\tresolveIndex = RangeUtils.getNode;\n\n\tfunction createRange(doc) {\n\t\treturn \"createRange\" in doc ? doc.createRange() : DOMUtils.DOM.createRng();\n\t}\n\n\tfunction isWhiteSpace(chr) {\n\t\treturn chr && /[\\r\\n\\t ]/.test(chr);\n\t}\n\n\tfunction isHiddenWhiteSpaceRange(range) {\n\t\tvar container = range.startContainer,\n\t\t\toffset = range.startOffset,\n\t\t\ttext;\n\n\t\tif (isWhiteSpace(range.toString()) && isNotPre(container.parentNode)) {\n\t\t\ttext = container.data;\n\n\t\t\tif (isWhiteSpace(text[offset - 1]) || isWhiteSpace(text[offset + 1])) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tfunction getCaretPositionClientRects(caretPosition) {\n\t\tvar clientRects = [], beforeNode, node;\n\n\t\t// Hack for older WebKit versions that doesn't\n\t\t// support getBoundingClientRect on BR elements\n\t\tfunction getBrClientRect(brNode) {\n\t\t\tvar doc = brNode.ownerDocument,\n\t\t\t\trng = createRange(doc),\n\t\t\t\tnbsp = doc.createTextNode('\\u00a0'),\n\t\t\t\tparentNode = brNode.parentNode,\n\t\t\t\tclientRect;\n\n\t\t\tparentNode.insertBefore(nbsp, brNode);\n\t\t\trng.setStart(nbsp, 0);\n\t\t\trng.setEnd(nbsp, 1);\n\t\t\tclientRect = ClientRect.clone(rng.getBoundingClientRect());\n\t\t\tparentNode.removeChild(nbsp);\n\n\t\t\treturn clientRect;\n\t\t}\n\n\t\tfunction getBoundingClientRect(item) {\n\t\t\tvar clientRect, clientRects;\n\n\t\t\tclientRects = item.getClientRects();\n\t\t\tif (clientRects.length > 0) {\n\t\t\t\tclientRect = ClientRect.clone(clientRects[0]);\n\t\t\t} else {\n\t\t\t\tclientRect = ClientRect.clone(item.getBoundingClientRect());\n\t\t\t}\n\n\t\t\tif (isBr(item) && clientRect.left === 0) {\n\t\t\t\treturn getBrClientRect(item);\n\t\t\t}\n\n\t\t\treturn clientRect;\n\t\t}\n\n\t\tfunction collapseAndInflateWidth(clientRect, toStart) {\n\t\t\tclientRect = ClientRect.collapse(clientRect, toStart);\n\t\t\tclientRect.width = 1;\n\t\t\tclientRect.right = clientRect.left + 1;\n\n\t\t\treturn clientRect;\n\t\t}\n\n\t\tfunction addUniqueAndValidRect(clientRect) {\n\t\t\tif (clientRect.height === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (clientRects.length > 0) {\n\t\t\t\tif (ClientRect.isEqual(clientRect, clientRects[clientRects.length - 1])) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tclientRects.push(clientRect);\n\t\t}\n\n\t\tfunction addCharacterOffset(container, offset) {\n\t\t\tvar range = createRange(container.ownerDocument);\n\n\t\t\tif (offset < container.data.length) {\n\t\t\t\tif (ExtendingChar.isExtendingChar(container.data[offset])) {\n\t\t\t\t\treturn clientRects;\n\t\t\t\t}\n\n\t\t\t\t// WebKit returns two client rects for a position after an extending\n\t\t\t\t// character a\\uxxx|b so expand on \"b\" and collapse to start of \"b\" box\n\t\t\t\tif (ExtendingChar.isExtendingChar(container.data[offset - 1])) {\n\t\t\t\t\trange.setStart(container, offset);\n\t\t\t\t\trange.setEnd(container, offset + 1);\n\n\t\t\t\t\tif (!isHiddenWhiteSpaceRange(range)) {\n\t\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n\t\t\t\t\t\treturn clientRects;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (offset > 0) {\n\t\t\t\trange.setStart(container, offset - 1);\n\t\t\t\trange.setEnd(container, offset);\n\n\t\t\t\tif (!isHiddenWhiteSpaceRange(range)) {\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (offset < container.data.length) {\n\t\t\t\trange.setStart(container, offset);\n\t\t\t\trange.setEnd(container, offset + 1);\n\n\t\t\t\tif (!isHiddenWhiteSpaceRange(range)) {\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), true));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (isText(caretPosition.container())) {\n\t\t\taddCharacterOffset(caretPosition.container(), caretPosition.offset());\n\t\t\treturn clientRects;\n\t\t}\n\n\t\tif (isElement(caretPosition.container())) {\n\t\t\tif (caretPosition.isAtEnd()) {\n\t\t\t\tnode = resolveIndex(caretPosition.container(), caretPosition.offset());\n\t\t\t\tif (isText(node)) {\n\t\t\t\t\taddCharacterOffset(node, node.data.length);\n\t\t\t\t}\n\n\t\t\t\tif (isValidElementCaretCandidate(node) && !isBr(node)) {\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnode = resolveIndex(caretPosition.container(), caretPosition.offset());\n\t\t\t\tif (isText(node)) {\n\t\t\t\t\taddCharacterOffset(node, 0);\n\t\t\t\t}\n\n\t\t\t\tif (isValidElementCaretCandidate(node) && caretPosition.isAtEnd()) {\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\n\t\t\t\t\treturn clientRects;\n\t\t\t\t}\n\n\t\t\t\tbeforeNode = resolveIndex(caretPosition.container(), caretPosition.offset() - 1);\n\t\t\t\tif (isValidElementCaretCandidate(beforeNode) && !isBr(beforeNode)) {\n\t\t\t\t\tif (isBlock(beforeNode) || isBlock(node) || !isValidElementCaretCandidate(node)) {\n\t\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode), false));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (isValidElementCaretCandidate(node)) {\n\t\t\t\t\taddUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), true));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn clientRects;\n\t}\n\n\t/**\n\t * Represents a location within the document by a container and an offset.\n\t *\n\t * @constructor\n\t * @param {Node} container Container node.\n\t * @param {Number} offset Offset within that container node.\n\t * @param {Array} clientRects Optional client rects array for the position.\n\t */\n\tfunction CaretPosition(container, offset, clientRects) {\n\t\tfunction isAtStart() {\n\t\t\tif (isText(container)) {\n\t\t\t\treturn offset === 0;\n\t\t\t}\n\n\t\t\treturn offset === 0;\n\t\t}\n\n\t\tfunction isAtEnd() {\n\t\t\tif (isText(container)) {\n\t\t\t\treturn offset >= container.data.length;\n\t\t\t}\n\n\t\t\treturn offset >= container.childNodes.length;\n\t\t}\n\n\t\tfunction toRange() {\n\t\t\tvar range;\n\n\t\t\trange = createRange(container.ownerDocument);\n\t\t\trange.setStart(container, offset);\n\t\t\trange.setEnd(container, offset);\n\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction getClientRects() {\n\t\t\tif (!clientRects) {\n\t\t\t\tclientRects = getCaretPositionClientRects(new CaretPosition(container, offset));\n\t\t\t}\n\n\t\t\treturn clientRects;\n\t\t}\n\n\t\tfunction isVisible() {\n\t\t\treturn getClientRects().length > 0;\n\t\t}\n\n\t\tfunction isEqual(caretPosition) {\n\t\t\treturn caretPosition && container === caretPosition.container() && offset === caretPosition.offset();\n\t\t}\n\n\t\tfunction getNode(before) {\n\t\t\treturn resolveIndex(container, before ? offset - 1 : offset);\n\t\t}\n\n\t\treturn {\n\t\t\t/**\n\t\t\t * Returns the container node.\n\t\t\t *\n\t\t\t * @method container\n\t\t\t * @return {Node} Container node.\n\t\t\t */\n\t\t\tcontainer: Fun.constant(container),\n\n\t\t\t/**\n\t\t\t * Returns the offset within the container node.\n\t\t\t *\n\t\t\t * @method offset\n\t\t\t * @return {Number} Offset within the container node.\n\t\t\t */\n\t\t\toffset: Fun.constant(offset),\n\n\t\t\t/**\n\t\t\t * Returns a range out of a the caret position.\n\t\t\t *\n\t\t\t * @method toRange\n\t\t\t * @return {DOMRange} range for the caret position.\n\t\t\t */\n\t\t\ttoRange: toRange,\n\n\t\t\t/**\n\t\t\t * Returns the client rects for the caret position. Might be multiple rects between\n\t\t\t * block elements.\n\t\t\t *\n\t\t\t * @method getClientRects\n\t\t\t * @return {Array} Array of client rects.\n\t\t\t */\n\t\t\tgetClientRects: getClientRects,\n\n\t\t\t/**\n\t\t\t * Returns true if the caret location is visible/displayed on screen.\n\t\t\t *\n\t\t\t * @method isVisible\n\t\t\t * @return {Boolean} true/false if the position is visible or not.\n\t\t\t */\n\t\t\tisVisible: isVisible,\n\n\t\t\t/**\n\t\t\t * Returns true if the caret location is at the beginning of text node or container.\n\t\t\t *\n\t\t\t * @method isVisible\n\t\t\t * @return {Boolean} true/false if the position is at the beginning.\n\t\t\t */\n\t\t\tisAtStart: isAtStart,\n\n\t\t\t/**\n\t\t\t * Returns true if the caret location is at the end of text node or container.\n\t\t\t *\n\t\t\t * @method isVisible\n\t\t\t * @return {Boolean} true/false if the position is at the end.\n\t\t\t */\n\t\t\tisAtEnd: isAtEnd,\n\n\t\t\t/**\n\t\t\t * Compares the caret position to another caret position. This will only compare the\n\t\t\t * container and offset not it's visual position.\n\t\t\t *\n\t\t\t * @method isEqual\n\t\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position to compare with.\n\t\t\t * @return {Boolean} true if the caret positions are equal.\n\t\t\t */\n\t\t\tisEqual: isEqual,\n\n\t\t\t/**\n\t\t\t * Returns the closest resolved node from a node index. That means if you have an offset after the\n\t\t\t * last node in a container it will return that last node.\n\t\t\t *\n\t\t\t * @method getNode\n\t\t\t * @return {Node} Node that is closest to the index.\n\t\t\t */\n\t\t\tgetNode: getNode\n\t\t};\n\t}\n\n\t/**\n\t * Creates a caret position from the start of a range.\n\t *\n\t * @method fromRangeStart\n\t * @param {DOMRange} range DOM Range to create caret position from.\n\t * @return {tinymce.caret.CaretPosition} Caret position from the start of DOM range.\n\t */\n\tCaretPosition.fromRangeStart = function(range) {\n\t\treturn new CaretPosition(range.startContainer, range.startOffset);\n\t};\n\n\t/**\n\t * Creates a caret position from the end of a range.\n\t *\n\t * @method fromRangeEnd\n\t * @param {DOMRange} range DOM Range to create caret position from.\n\t * @return {tinymce.caret.CaretPosition} Caret position from the end of DOM range.\n\t */\n\tCaretPosition.fromRangeEnd = function(range) {\n\t\treturn new CaretPosition(range.endContainer, range.endOffset);\n\t};\n\n\t/**\n\t * Creates a caret position from a node and places the offset after it.\n\t *\n\t * @method after\n\t * @param {Node} node Node to get caret position from.\n\t * @return {tinymce.caret.CaretPosition} Caret position from the node.\n\t */\n\tCaretPosition.after = function(node) {\n\t\treturn new CaretPosition(node.parentNode, nodeIndex(node) + 1);\n\t};\n\n\t/**\n\t * Creates a caret position from a node and places the offset before it.\n\t *\n\t * @method before\n\t * @param {Node} node Node to get caret position from.\n\t * @return {tinymce.caret.CaretPosition} Caret position from the node.\n\t */\n\tCaretPosition.before = function(node) {\n\t\treturn new CaretPosition(node.parentNode, nodeIndex(node));\n\t};\n\n\treturn CaretPosition;\n});\n\n// Included from: js/tinymce/classes/caret/CaretBookmark.js\n\n/**\n * CaretBookmark.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module creates or resolves xpath like string representation of a CaretPositions.\n *\n * The format is a / separated list of chunks with:\n * <element|text()>[index|after|before]\n *\n * For example:\n *  p[0]/b[0]/text()[0],1 = <p><b>a|c</b></p>\n *  p[0]/img[0],before = <p>|<img></p>\n *  p[0]/img[0],after = <p><img>|</p>\n *\n * @private\n * @static\n * @class tinymce.caret.CaretBookmark\n * @example\n * var bookmark = CaretBookmark.create(rootElm, CaretPosition.before(rootElm.firstChild));\n * var caretPosition = CaretBookmark.resolve(bookmark);\n */\ndefine('tinymce/caret/CaretBookmark', [\n\t'tinymce/dom/NodeType',\n\t'tinymce/dom/DOMUtils',\n\t'tinymce/util/Fun',\n\t'tinymce/util/Arr',\n\t'tinymce/caret/CaretPosition'\n], function(NodeType, DomUtils, Fun, Arr, CaretPosition) {\n\tvar isText = NodeType.isText,\n\t\tisBogus = NodeType.isBogus,\n\t\tnodeIndex = DomUtils.nodeIndex;\n\n\tfunction normalizedParent(node) {\n\t\tvar parentNode = node.parentNode;\n\n\t\tif (isBogus(parentNode)) {\n\t\t\treturn normalizedParent(parentNode);\n\t\t}\n\n\t\treturn parentNode;\n\t}\n\n\tfunction getChildNodes(node) {\n\t\tif (!node) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn Arr.reduce(node.childNodes, function(result, node) {\n\t\t\tif (isBogus(node) && node.nodeName != 'BR') {\n\t\t\t\tresult = result.concat(getChildNodes(node));\n\t\t\t} else {\n\t\t\t\tresult.push(node);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}, []);\n\t}\n\n\tfunction normalizedTextOffset(textNode, offset) {\n\t\twhile ((textNode = textNode.previousSibling)) {\n\t\t\tif (!isText(textNode)) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\toffset += textNode.data.length;\n\t\t}\n\n\t\treturn offset;\n\t}\n\n\tfunction equal(targetValue) {\n\t\treturn function(value) {\n\t\t\treturn targetValue === value;\n\t\t};\n\t}\n\n\tfunction normalizedNodeIndex(node) {\n\t\tvar nodes, index, numTextFragments;\n\n\t\tnodes = getChildNodes(normalizedParent(node));\n\t\tindex = Arr.findIndex(nodes, equal(node), node);\n\t\tnodes = nodes.slice(0, index + 1);\n\t\tnumTextFragments = Arr.reduce(nodes, function(result, node, i) {\n\t\t\tif (isText(node) && isText(nodes[i - 1])) {\n\t\t\t\tresult++;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}, 0);\n\n\t\tnodes = Arr.filter(nodes, NodeType.matchNodeNames(node.nodeName));\n\t\tindex = Arr.findIndex(nodes, equal(node), node);\n\n\t\treturn index - numTextFragments;\n\t}\n\n\tfunction createPathItem(node) {\n\t\tvar name;\n\n\t\tif (isText(node)) {\n\t\t\tname = 'text()';\n\t\t} else {\n\t\t\tname = node.nodeName.toLowerCase();\n\t\t}\n\n\t\treturn name + '[' + normalizedNodeIndex(node) + ']';\n\t}\n\n\tfunction parentsUntil(rootNode, node, predicate) {\n\t\tvar parents = [];\n\n\t\tfor (node = node.parentNode; node != rootNode; node = node.parentNode) {\n\t\t\tif (predicate && predicate(node)) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tparents.push(node);\n\t\t}\n\n\t\treturn parents;\n\t}\n\n\tfunction create(rootNode, caretPosition) {\n\t\tvar container, offset, path = [],\n\t\t\toutputOffset, childNodes, parents;\n\n\t\tcontainer = caretPosition.container();\n\t\toffset = caretPosition.offset();\n\n\t\tif (isText(container)) {\n\t\t\toutputOffset = normalizedTextOffset(container, offset);\n\t\t} else {\n\t\t\tchildNodes = container.childNodes;\n\t\t\tif (offset >= childNodes.length) {\n\t\t\t\toutputOffset = 'after';\n\t\t\t\toffset = childNodes.length - 1;\n\t\t\t} else {\n\t\t\t\toutputOffset = 'before';\n\t\t\t}\n\n\t\t\tcontainer = childNodes[offset];\n\t\t}\n\n\t\tpath.push(createPathItem(container));\n\t\tparents = parentsUntil(rootNode, container);\n\t\tparents = Arr.filter(parents, Fun.negate(NodeType.isBogus));\n\t\tpath = path.concat(Arr.map(parents, function(node) {\n\t\t\treturn createPathItem(node);\n\t\t}));\n\n\t\treturn path.reverse().join('/') + ',' + outputOffset;\n\t}\n\n\tfunction resolvePathItem(node, name, index) {\n\t\tvar nodes = getChildNodes(node);\n\n\t\tnodes = Arr.filter(nodes, function(node, index) {\n\t\t\treturn !isText(node) || !isText(nodes[index - 1]);\n\t\t});\n\n\t\tnodes = Arr.filter(nodes, NodeType.matchNodeNames(name));\n\t\treturn nodes[index];\n\t}\n\n\tfunction findTextPosition(container, offset) {\n\t\tvar node = container, targetOffset = 0, dataLen;\n\n\t\twhile (isText(node)) {\n\t\t\tdataLen = node.data.length;\n\n\t\t\tif (offset >= targetOffset && offset <= targetOffset + dataLen) {\n\t\t\t\tcontainer = node;\n\t\t\t\toffset = offset - targetOffset;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (!isText(node.nextSibling)) {\n\t\t\t\tcontainer = node;\n\t\t\t\toffset = dataLen;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ttargetOffset += dataLen;\n\t\t\tnode = node.nextSibling;\n\t\t}\n\n\t\tif (offset > container.data.length) {\n\t\t\toffset = container.data.length;\n\t\t}\n\n\t\treturn new CaretPosition(container, offset);\n\t}\n\n\tfunction resolve(rootNode, path) {\n\t\tvar parts, container, offset;\n\n\t\tif (!path) {\n\t\t\treturn null;\n\t\t}\n\n\t\tparts = path.split(',');\n\t\tpath = parts[0].split('/');\n\t\toffset = parts.length > 1 ? parts[1] : 'before';\n\n\t\tcontainer = Arr.reduce(path, function(result, value) {\n\t\t\tvalue = /([\\w\\-\\(\\)]+)\\[([0-9]+)\\]/.exec(value);\n\t\t\tif (!value) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (value[1] === 'text()') {\n\t\t\t\tvalue[1] = '#text';\n\t\t\t}\n\n\t\t\treturn resolvePathItem(result, value[1], parseInt(value[2], 10));\n\t\t}, rootNode);\n\n\t\tif (!container) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (!isText(container)) {\n\t\t\tif (offset === 'after') {\n\t\t\t\toffset = nodeIndex(container) + 1;\n\t\t\t} else {\n\t\t\t\toffset = nodeIndex(container);\n\t\t\t}\n\n\t\t\treturn new CaretPosition(container.parentNode, offset);\n\t\t}\n\n\t\treturn findTextPosition(container, parseInt(offset, 10));\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Create a xpath bookmark location for the specified caret position.\n\t\t *\n\t\t * @method create\n\t\t * @param {Node} rootNode Root node to create bookmark within.\n\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position within the root node.\n\t\t * @return {String} String xpath like location of caret position.\n\t\t */\n\t\tcreate: create,\n\n\t\t/**\n\t\t * Resolves a xpath like bookmark location to the a caret position.\n\t\t *\n\t\t * @method resolve\n\t\t * @param {Node} rootNode Root node to resolve xpath bookmark within.\n\t\t * @param {String} bookmark Bookmark string to resolve.\n\t\t * @return {tinymce.caret.CaretPosition} Caret position resolved from xpath like bookmark.\n\t\t */\n\t\tresolve: resolve\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/BookmarkManager.js\n\n/**\n * BookmarkManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles selection bookmarks.\n *\n * @class tinymce.dom.BookmarkManager\n */\ndefine(\"tinymce/dom/BookmarkManager\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/caret/CaretBookmark\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/dom/NodeType\"\n], function(Env, Tools, CaretContainer, CaretBookmark, CaretPosition, NodeType) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse;\n\n\t/**\n\t * Constructs a new BookmarkManager instance for a specific selection instance.\n\t *\n\t * @constructor\n\t * @method BookmarkManager\n\t * @param {tinymce.dom.Selection} selection Selection instance to handle bookmarks for.\n\t */\n\tfunction BookmarkManager(selection) {\n\t\tvar dom = selection.dom;\n\n\t\t/**\n\t\t * Returns a bookmark location for the current selection. This bookmark object\n\t\t * can then be used to restore the selection after some content modification to the document.\n\t\t *\n\t\t * @method getBookmark\n\t\t * @param {Number} type Optional state if the bookmark should be simple or not. Default is complex.\n\t\t * @param {Boolean} normalized Optional state that enables you to get a position that it would be after normalization.\n\t\t * @return {Object} Bookmark object, use moveToBookmark with this object to restore the selection.\n\t\t * @example\n\t\t * // Stores a bookmark of the current selection\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\n\t\t *\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\n\t\t *\n\t\t * // Restore the selection bookmark\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\n\t\t */\n\t\tthis.getBookmark = function(type, normalized) {\n\t\t\tvar rng, rng2, id, collapsed, name, element, chr = '&#xFEFF;', styles;\n\n\t\t\tfunction findIndex(name, element) {\n\t\t\t\tvar count = 0;\n\n\t\t\t\tTools.each(dom.select(name), function(node) {\n\t\t\t\t\tif (node.getAttribute('data-mce-bogus') === 'all') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node == element) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tcount++;\n\t\t\t\t});\n\n\t\t\t\treturn count;\n\t\t\t}\n\n\t\t\tfunction normalizeTableCellSelection(rng) {\n\t\t\t\tfunction moveEndPoint(start) {\n\t\t\t\t\tvar container, offset, childNodes, prefix = start ? 'start' : 'end';\n\n\t\t\t\t\tcontainer = rng[prefix + 'Container'];\n\t\t\t\t\toffset = rng[prefix + 'Offset'];\n\n\t\t\t\t\tif (container.nodeType == 1 && container.nodeName == \"TR\") {\n\t\t\t\t\t\tchildNodes = container.childNodes;\n\t\t\t\t\t\tcontainer = childNodes[Math.min(start ? offset : offset - 1, childNodes.length - 1)];\n\t\t\t\t\t\tif (container) {\n\t\t\t\t\t\t\toffset = start ? 0 : container.childNodes.length;\n\t\t\t\t\t\t\trng['set' + (start ? 'Start' : 'End')](container, offset);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tmoveEndPoint(true);\n\t\t\t\tmoveEndPoint();\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\tfunction getLocation(rng) {\n\t\t\t\tvar root = dom.getRoot(), bookmark = {};\n\n\t\t\t\tfunction getPoint(rng, start) {\n\t\t\t\t\tvar container = rng[start ? 'startContainer' : 'endContainer'],\n\t\t\t\t\t\toffset = rng[start ? 'startOffset' : 'endOffset'], point = [], node, childNodes, after = 0;\n\n\t\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\t\tif (normalized) {\n\t\t\t\t\t\t\tfor (node = container.previousSibling; node && node.nodeType == 3; node = node.previousSibling) {\n\t\t\t\t\t\t\t\toffset += node.nodeValue.length;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpoint.push(offset);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchildNodes = container.childNodes;\n\n\t\t\t\t\t\tif (offset >= childNodes.length && childNodes.length) {\n\t\t\t\t\t\t\tafter = 1;\n\t\t\t\t\t\t\toffset = Math.max(0, childNodes.length - 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpoint.push(dom.nodeIndex(childNodes[offset], normalized) + after);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (; container && container != root; container = container.parentNode) {\n\t\t\t\t\t\tpoint.push(dom.nodeIndex(container, normalized));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn point;\n\t\t\t\t}\n\n\t\t\t\tbookmark.start = getPoint(rng, true);\n\n\t\t\t\tif (!selection.isCollapsed()) {\n\t\t\t\t\tbookmark.end = getPoint(rng);\n\t\t\t\t}\n\n\t\t\t\treturn bookmark;\n\t\t\t}\n\n\t\t\tfunction findAdjacentContentEditableFalseElm(rng) {\n\t\t\t\tfunction findSibling(node) {\n\t\t\t\t\tvar sibling;\n\n\t\t\t\t\tif (CaretContainer.isCaretContainer(node)) {\n\t\t\t\t\t\tif (NodeType.isText(node) && CaretContainer.isCaretContainerBlock(node)) {\n\t\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = node.previousSibling;\n\t\t\t\t\t\tif (isContentEditableFalse(sibling)) {\n\t\t\t\t\t\t\treturn sibling;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsibling = node.nextSibling;\n\t\t\t\t\t\tif (isContentEditableFalse(sibling)) {\n\t\t\t\t\t\t\treturn sibling;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn findSibling(rng.startContainer) || findSibling(rng.endContainer);\n\t\t\t}\n\n\t\t\tif (type == 2) {\n\t\t\t\telement = selection.getNode();\n\t\t\t\tname = element ? element.nodeName : null;\n\t\t\t\trng = selection.getRng();\n\n\t\t\t\tif (isContentEditableFalse(element) || name == 'IMG') {\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\n\t\t\t\t}\n\n\t\t\t\tif (selection.tridentSel) {\n\t\t\t\t\treturn selection.tridentSel.getBookmark(type);\n\t\t\t\t}\n\n\t\t\t\telement = findAdjacentContentEditableFalseElm(rng);\n\t\t\t\tif (element) {\n\t\t\t\t\tname = element.tagName;\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\n\t\t\t\t}\n\n\t\t\t\treturn getLocation(rng);\n\t\t\t}\n\n\t\t\tif (type == 3) {\n\t\t\t\trng = selection.getRng();\n\n\t\t\t\treturn {\n\t\t\t\t\tstart: CaretBookmark.create(dom.getRoot(), CaretPosition.fromRangeStart(rng)),\n\t\t\t\t\tend: CaretBookmark.create(dom.getRoot(), CaretPosition.fromRangeEnd(rng))\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Handle simple range\n\t\t\tif (type) {\n\t\t\t\treturn {rng: selection.getRng()};\n\t\t\t}\n\n\t\t\trng = selection.getRng();\n\t\t\tid = dom.uniqueId();\n\t\t\tcollapsed = selection.isCollapsed();\n\t\t\tstyles = 'overflow:hidden;line-height:0px';\n\n\t\t\t// Explorer method\n\t\t\tif (rng.duplicate || rng.item) {\n\t\t\t\t// Text selection\n\t\t\t\tif (!rng.item) {\n\t\t\t\t\trng2 = rng.duplicate();\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Insert start marker\n\t\t\t\t\t\trng.collapse();\n\t\t\t\t\t\trng.pasteHTML('<span data-mce-type=\"bookmark\" id=\"' + id + '_start\" style=\"' + styles + '\">' + chr + '</span>');\n\n\t\t\t\t\t\t// Insert end marker\n\t\t\t\t\t\tif (!collapsed) {\n\t\t\t\t\t\t\trng2.collapse(false);\n\n\t\t\t\t\t\t\t// Detect the empty space after block elements in IE and move the\n\t\t\t\t\t\t\t// end back one character <p></p>] becomes <p>]</p>\n\t\t\t\t\t\t\trng.moveToElementText(rng2.parentElement());\n\t\t\t\t\t\t\tif (rng.compareEndPoints('StartToEnd', rng2) === 0) {\n\t\t\t\t\t\t\t\trng2.move('character', -1);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trng2.pasteHTML('<span data-mce-type=\"bookmark\" id=\"' + id + '_end\" style=\"' + styles + '\">' + chr + '</span>');\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// IE might throw unspecified error so lets ignore it\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Control selection\n\t\t\t\t\telement = rng.item(0);\n\t\t\t\t\tname = element.nodeName;\n\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\telement = selection.getNode();\n\t\t\t\tname = element.nodeName;\n\t\t\t\tif (name == 'IMG') {\n\t\t\t\t\treturn {name: name, index: findIndex(name, element)};\n\t\t\t\t}\n\n\t\t\t\t// W3C method\n\t\t\t\trng2 = normalizeTableCellSelection(rng.cloneRange());\n\n\t\t\t\t// Insert end marker\n\t\t\t\tif (!collapsed) {\n\t\t\t\t\trng2.collapse(false);\n\t\t\t\t\trng2.insertNode(dom.create('span', {'data-mce-type': \"bookmark\", id: id + '_end', style: styles}, chr));\n\t\t\t\t}\n\n\t\t\t\trng = normalizeTableCellSelection(rng);\n\t\t\t\trng.collapse(true);\n\t\t\t\trng.insertNode(dom.create('span', {'data-mce-type': \"bookmark\", id: id + '_start', style: styles}, chr));\n\t\t\t}\n\n\t\t\tselection.moveToBookmark({id: id, keep: 1});\n\n\t\t\treturn {id: id};\n\t\t};\n\n\t\t/**\n\t\t * Restores the selection to the specified bookmark.\n\t\t *\n\t\t * @method moveToBookmark\n\t\t * @param {Object} bookmark Bookmark to restore selection from.\n\t\t * @return {Boolean} true/false if it was successful or not.\n\t\t * @example\n\t\t * // Stores a bookmark of the current selection\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\n\t\t *\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\n\t\t *\n\t\t * // Restore the selection bookmark\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\n\t\t */\n\t\tthis.moveToBookmark = function(bookmark) {\n\t\t\tvar rng, root, startContainer, endContainer, startOffset, endOffset;\n\n\t\t\tfunction setEndPoint(start) {\n\t\t\t\tvar point = bookmark[start ? 'start' : 'end'], i, node, offset, children;\n\n\t\t\t\tif (point) {\n\t\t\t\t\toffset = point[0];\n\n\t\t\t\t\t// Find container node\n\t\t\t\t\tfor (node = root, i = point.length - 1; i >= 1; i--) {\n\t\t\t\t\t\tchildren = node.childNodes;\n\n\t\t\t\t\t\tif (point[i] > children.length - 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = children[point[i]];\n\t\t\t\t\t}\n\n\t\t\t\t\t// Move text offset to best suitable location\n\t\t\t\t\tif (node.nodeType === 3) {\n\t\t\t\t\t\toffset = Math.min(point[0], node.nodeValue.length);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Move element offset to best suitable location\n\t\t\t\t\tif (node.nodeType === 1) {\n\t\t\t\t\t\toffset = Math.min(point[0], node.childNodes.length);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Set offset within container node\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\trng.setStart(node, offset);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setEnd(node, offset);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tfunction restoreEndPoint(suffix) {\n\t\t\t\tvar marker = dom.get(bookmark.id + '_' + suffix), node, idx, next, prev, keep = bookmark.keep;\n\n\t\t\t\tif (marker) {\n\t\t\t\t\tnode = marker.parentNode;\n\n\t\t\t\t\tif (suffix == 'start') {\n\t\t\t\t\t\tif (!keep) {\n\t\t\t\t\t\t\tidx = dom.nodeIndex(marker);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode = marker.firstChild;\n\t\t\t\t\t\t\tidx = 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstartContainer = endContainer = node;\n\t\t\t\t\t\tstartOffset = endOffset = idx;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!keep) {\n\t\t\t\t\t\t\tidx = dom.nodeIndex(marker);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode = marker.firstChild;\n\t\t\t\t\t\t\tidx = 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tendContainer = node;\n\t\t\t\t\t\tendOffset = idx;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!keep) {\n\t\t\t\t\t\tprev = marker.previousSibling;\n\t\t\t\t\t\tnext = marker.nextSibling;\n\n\t\t\t\t\t\t// Remove all marker text nodes\n\t\t\t\t\t\tTools.each(Tools.grep(marker.childNodes), function(node) {\n\t\t\t\t\t\t\tif (node.nodeType == 3) {\n\t\t\t\t\t\t\t\tnode.nodeValue = node.nodeValue.replace(/\\uFEFF/g, '');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove marker but keep children if for example contents where inserted into the marker\n\t\t\t\t\t\t// Also remove duplicated instances of the marker for example by a\n\t\t\t\t\t\t// split operation or by WebKit auto split on paste feature\n\t\t\t\t\t\twhile ((marker = dom.get(bookmark.id + '_' + suffix))) {\n\t\t\t\t\t\t\tdom.remove(marker, 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// If siblings are text nodes then merge them unless it's Opera since it some how removes the node\n\t\t\t\t\t\t// and we are sniffing since adding a lot of detection code for a browser with 3% of the market\n\t\t\t\t\t\t// isn't worth the effort. Sorry, Opera but it's just a fact\n\t\t\t\t\t\tif (prev && next && prev.nodeType == next.nodeType && prev.nodeType == 3 && !Env.opera) {\n\t\t\t\t\t\t\tidx = prev.nodeValue.length;\n\t\t\t\t\t\t\tprev.appendData(next.nodeValue);\n\t\t\t\t\t\t\tdom.remove(next);\n\n\t\t\t\t\t\t\tif (suffix == 'start') {\n\t\t\t\t\t\t\t\tstartContainer = endContainer = prev;\n\t\t\t\t\t\t\t\tstartOffset = endOffset = idx;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tendContainer = prev;\n\t\t\t\t\t\t\t\tendOffset = idx;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction addBogus(node) {\n\t\t\t\t// Adds a bogus BR element for empty block elements\n\t\t\t\tif (dom.isBlock(node) && !node.innerHTML && !Env.ie) {\n\t\t\t\t\tnode.innerHTML = '<br data-mce-bogus=\"1\" />';\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tfunction resolveCaretPositionBookmark() {\n\t\t\t\tvar rng, pos;\n\n\t\t\t\trng = dom.createRng();\n\t\t\t\tpos = CaretBookmark.resolve(dom.getRoot(), bookmark.start);\n\t\t\t\trng.setStart(pos.container(), pos.offset());\n\n\t\t\t\tpos = CaretBookmark.resolve(dom.getRoot(), bookmark.end);\n\t\t\t\trng.setEnd(pos.container(), pos.offset());\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\tif (bookmark) {\n\t\t\t\tif (Tools.isArray(bookmark.start)) {\n\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\troot = dom.getRoot();\n\n\t\t\t\t\tif (selection.tridentSel) {\n\t\t\t\t\t\treturn selection.tridentSel.moveToBookmark(bookmark);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (setEndPoint(true) && setEndPoint()) {\n\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof bookmark.start == 'string') {\n\t\t\t\t\tselection.setRng(resolveCaretPositionBookmark(bookmark));\n\t\t\t\t} else if (bookmark.id) {\n\t\t\t\t\t// Restore start/end points\n\t\t\t\t\trestoreEndPoint('start');\n\t\t\t\t\trestoreEndPoint('end');\n\n\t\t\t\t\tif (startContainer) {\n\t\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\t\trng.setStart(addBogus(startContainer), startOffset);\n\t\t\t\t\t\trng.setEnd(addBogus(endContainer), endOffset);\n\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t}\n\t\t\t\t} else if (bookmark.name) {\n\t\t\t\t\tselection.select(dom.select(bookmark.name)[bookmark.index]);\n\t\t\t\t} else if (bookmark.rng) {\n\t\t\t\t\tselection.setRng(bookmark.rng);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Returns true/false if the specified node is a bookmark node or not.\n\t *\n\t * @static\n\t * @method isBookmarkNode\n\t * @param {DOMNode} node DOM Node to check if it's a bookmark node or not.\n\t * @return {Boolean} true/false if the node is a bookmark node or not.\n\t */\n\tBookmarkManager.isBookmarkNode = function(node) {\n\t\treturn node && node.tagName === 'SPAN' && node.getAttribute('data-mce-type') === 'bookmark';\n\t};\n\n\treturn BookmarkManager;\n});\n\n// Included from: js/tinymce/classes/dom/Selection.js\n\n/**\n * Selection.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles text and control selection it's an crossbrowser utility class.\n * Consult the TinyMCE Wiki API for more details and examples on how to use this class.\n *\n * @class tinymce.dom.Selection\n * @example\n * // Getting the currently selected node for the active editor\n * alert(tinymce.activeEditor.selection.getNode().nodeName);\n */\ndefine(\"tinymce/dom/Selection\", [\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/TridentSelection\",\n\t\"tinymce/dom/ControlSelection\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/dom/BookmarkManager\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/caret/CaretPosition\"\n], function(TreeWalker, TridentSelection, ControlSelection, RangeUtils, BookmarkManager, NodeType, Env, Tools, CaretPosition) {\n\tvar each = Tools.each, trim = Tools.trim;\n\tvar isIE = Env.ie;\n\n\t/**\n\t * Constructs a new selection instance.\n\t *\n\t * @constructor\n\t * @method Selection\n\t * @param {tinymce.dom.DOMUtils} dom DOMUtils object reference.\n\t * @param {Window} win Window to bind the selection object to.\n\t * @param {tinymce.Editor} editor Editor instance of the selection.\n\t * @param {tinymce.dom.Serializer} serializer DOM serialization class to use for getContent.\n\t */\n\tfunction Selection(dom, win, serializer, editor) {\n\t\tvar self = this;\n\n\t\tself.dom = dom;\n\t\tself.win = win;\n\t\tself.serializer = serializer;\n\t\tself.editor = editor;\n\t\tself.bookmarkManager = new BookmarkManager(self);\n\t\tself.controlSelection = new ControlSelection(self, editor);\n\n\t\t// No W3C Range support\n\t\tif (!self.win.getSelection) {\n\t\t\tself.tridentSel = new TridentSelection(self);\n\t\t}\n\t}\n\n\tSelection.prototype = {\n\t\t/**\n\t\t * Move the selection cursor range to the specified node and offset.\n\t\t * If there is no node specified it will move it to the first suitable location within the body.\n\t\t *\n\t\t * @method setCursorLocation\n\t\t * @param {Node} node Optional node to put the cursor in.\n\t\t * @param {Number} offset Optional offset from the start of the node to put the cursor at.\n\t\t */\n\t\tsetCursorLocation: function(node, offset) {\n\t\t\tvar self = this, rng = self.dom.createRng();\n\n\t\t\tif (!node) {\n\t\t\t\tself._moveEndPoint(rng, self.editor.getBody(), true);\n\t\t\t\tself.setRng(rng);\n\t\t\t} else {\n\t\t\t\trng.setStart(node, offset);\n\t\t\t\trng.setEnd(node, offset);\n\t\t\t\tself.setRng(rng);\n\t\t\t\tself.collapse(false);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the selected contents using the DOM serializer passed in to this class.\n\t\t *\n\t\t * @method getContent\n\t\t * @param {Object} args Optional settings class with for example output format text or html.\n\t\t * @return {String} Selected contents in for example HTML format.\n\t\t * @example\n\t\t * // Alerts the currently selected contents\n\t\t * alert(tinymce.activeEditor.selection.getContent());\n\t\t *\n\t\t * // Alerts the currently selected contents as plain text\n\t\t * alert(tinymce.activeEditor.selection.getContent({format: 'text'}));\n\t\t */\n\t\tgetContent: function(args) {\n\t\t\tvar self = this, rng = self.getRng(), tmpElm = self.dom.create(\"body\");\n\t\t\tvar se = self.getSel(), whiteSpaceBefore, whiteSpaceAfter, fragment;\n\n\t\t\targs = args || {};\n\t\t\twhiteSpaceBefore = whiteSpaceAfter = '';\n\t\t\targs.get = true;\n\t\t\targs.format = args.format || 'html';\n\t\t\targs.selection = true;\n\t\t\tself.editor.fire('BeforeGetContent', args);\n\n\t\t\tif (args.format == 'text') {\n\t\t\t\treturn self.isCollapsed() ? '' : (rng.text || (se.toString ? se.toString() : ''));\n\t\t\t}\n\n\t\t\tif (rng.cloneContents) {\n\t\t\t\tfragment = rng.cloneContents();\n\n\t\t\t\tif (fragment) {\n\t\t\t\t\ttmpElm.appendChild(fragment);\n\t\t\t\t}\n\t\t\t} else if (rng.item !== undefined || rng.htmlText !== undefined) {\n\t\t\t\t// IE will produce invalid markup if elements are present that\n\t\t\t\t// it doesn't understand like custom elements or HTML5 elements.\n\t\t\t\t// Adding a BR in front of the contents and then remoiving it seems to fix it though.\n\t\t\t\ttmpElm.innerHTML = '<br>' + (rng.item ? rng.item(0).outerHTML : rng.htmlText);\n\t\t\t\ttmpElm.removeChild(tmpElm.firstChild);\n\t\t\t} else {\n\t\t\t\ttmpElm.innerHTML = rng.toString();\n\t\t\t}\n\n\t\t\t// Keep whitespace before and after\n\t\t\tif (/^\\s/.test(tmpElm.innerHTML)) {\n\t\t\t\twhiteSpaceBefore = ' ';\n\t\t\t}\n\n\t\t\tif (/\\s+$/.test(tmpElm.innerHTML)) {\n\t\t\t\twhiteSpaceAfter = ' ';\n\t\t\t}\n\n\t\t\targs.getInner = true;\n\n\t\t\targs.content = self.isCollapsed() ? '' : whiteSpaceBefore + self.serializer.serialize(tmpElm, args) + whiteSpaceAfter;\n\t\t\tself.editor.fire('GetContent', args);\n\n\t\t\treturn args.content;\n\t\t},\n\n\t\t/**\n\t\t * Sets the current selection to the specified content. If any contents is selected it will be replaced\n\t\t * with the contents passed in to this function. If there is no selection the contents will be inserted\n\t\t * where the caret is placed in the editor/page.\n\t\t *\n\t\t * @method setContent\n\t\t * @param {String} content HTML contents to set could also be other formats depending on settings.\n\t\t * @param {Object} args Optional settings object with for example data format.\n\t\t * @example\n\t\t * // Inserts some HTML contents at the current selection\n\t\t * tinymce.activeEditor.selection.setContent('<strong>Some contents</strong>');\n\t\t */\n\t\tsetContent: function(content, args) {\n\t\t\tvar self = this, rng = self.getRng(), caretNode, doc = self.win.document, frag, temp;\n\n\t\t\targs = args || {format: 'html'};\n\t\t\targs.set = true;\n\t\t\targs.selection = true;\n\t\t\targs.content = content;\n\n\t\t\t// Dispatch before set content event\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.editor.fire('BeforeSetContent', args);\n\t\t\t}\n\n\t\t\tcontent = args.content;\n\n\t\t\tif (rng.insertNode) {\n\t\t\t\t// Make caret marker since insertNode places the caret in the beginning of text after insert\n\t\t\t\tcontent += '<span id=\"__caret\">_</span>';\n\n\t\t\t\t// Delete and insert new node\n\t\t\t\tif (rng.startContainer == doc && rng.endContainer == doc) {\n\t\t\t\t\t// WebKit will fail if the body is empty since the range is then invalid and it can't insert contents\n\t\t\t\t\tdoc.body.innerHTML = content;\n\t\t\t\t} else {\n\t\t\t\t\trng.deleteContents();\n\n\t\t\t\t\tif (doc.body.childNodes.length === 0) {\n\t\t\t\t\t\tdoc.body.innerHTML = content;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// createContextualFragment doesn't exists in IE 9 DOMRanges\n\t\t\t\t\t\tif (rng.createContextualFragment) {\n\t\t\t\t\t\t\trng.insertNode(rng.createContextualFragment(content));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Fake createContextualFragment call in IE 9\n\t\t\t\t\t\t\tfrag = doc.createDocumentFragment();\n\t\t\t\t\t\t\ttemp = doc.createElement('div');\n\n\t\t\t\t\t\t\tfrag.appendChild(temp);\n\t\t\t\t\t\t\ttemp.outerHTML = content;\n\n\t\t\t\t\t\t\trng.insertNode(frag);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Move to caret marker\n\t\t\t\tcaretNode = self.dom.get('__caret');\n\n\t\t\t\t// Make sure we wrap it compleatly, Opera fails with a simple select call\n\t\t\t\trng = doc.createRange();\n\t\t\t\trng.setStartBefore(caretNode);\n\t\t\t\trng.setEndBefore(caretNode);\n\t\t\t\tself.setRng(rng);\n\n\t\t\t\t// Remove the caret position\n\t\t\t\tself.dom.remove('__caret');\n\n\t\t\t\ttry {\n\t\t\t\t\tself.setRng(rng);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Might fail on Opera for some odd reason\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (rng.item) {\n\t\t\t\t\t// Delete content and get caret text selection\n\t\t\t\t\tdoc.execCommand('Delete', false, null);\n\t\t\t\t\trng = self.getRng();\n\t\t\t\t}\n\n\t\t\t\t// Explorer removes spaces from the beginning of pasted contents\n\t\t\t\tif (/^\\s+/.test(content)) {\n\t\t\t\t\trng.pasteHTML('<span id=\"__mce_tmp\">_</span>' + content);\n\t\t\t\t\tself.dom.remove('__mce_tmp');\n\t\t\t\t} else {\n\t\t\t\t\trng.pasteHTML(content);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Dispatch set content event\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.editor.fire('SetContent', args);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the start element of a selection range. If the start is in a text\n\t\t * node the parent element will be returned.\n\t\t *\n\t\t * @method getStart\n\t\t * @param {Boolean} real Optional state to get the real parent when the selection is collapsed not the closest element.\n\t\t * @return {Element} Start element of selection range.\n\t\t */\n\t\tgetStart: function(real) {\n\t\t\tvar self = this, rng = self.getRng(), startElement, parentElement, checkRng, node;\n\n\t\t\tif (rng.duplicate || rng.item) {\n\t\t\t\t// Control selection, return first item\n\t\t\t\tif (rng.item) {\n\t\t\t\t\treturn rng.item(0);\n\t\t\t\t}\n\n\t\t\t\t// Get start element\n\t\t\t\tcheckRng = rng.duplicate();\n\t\t\t\tcheckRng.collapse(1);\n\t\t\t\tstartElement = checkRng.parentElement();\n\t\t\t\tif (startElement.ownerDocument !== self.dom.doc) {\n\t\t\t\t\tstartElement = self.dom.getRoot();\n\t\t\t\t}\n\n\t\t\t\t// Check if range parent is inside the start element, then return the inner parent element\n\t\t\t\t// This will fix issues when a single element is selected, IE would otherwise return the wrong start element\n\t\t\t\tparentElement = node = rng.parentElement();\n\t\t\t\twhile ((node = node.parentNode)) {\n\t\t\t\t\tif (node == startElement) {\n\t\t\t\t\t\tstartElement = parentElement;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn startElement;\n\t\t\t}\n\n\t\t\tstartElement = rng.startContainer;\n\n\t\t\tif (startElement.nodeType == 1 && startElement.hasChildNodes()) {\n\t\t\t\tif (!real || !rng.collapsed) {\n\t\t\t\t\tstartElement = startElement.childNodes[Math.min(startElement.childNodes.length - 1, rng.startOffset)];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (startElement && startElement.nodeType == 3) {\n\t\t\t\treturn startElement.parentNode;\n\t\t\t}\n\n\t\t\treturn startElement;\n\t\t},\n\n\t\t/**\n\t\t * Returns the end element of a selection range. If the end is in a text\n\t\t * node the parent element will be returned.\n\t\t *\n\t\t * @method getEnd\n\t\t * @param {Boolean} real Optional state to get the real parent when the selection is collapsed not the closest element.\n\t\t * @return {Element} End element of selection range.\n\t\t */\n\t\tgetEnd: function(real) {\n\t\t\tvar self = this, rng = self.getRng(), endElement, endOffset;\n\n\t\t\tif (rng.duplicate || rng.item) {\n\t\t\t\tif (rng.item) {\n\t\t\t\t\treturn rng.item(0);\n\t\t\t\t}\n\n\t\t\t\trng = rng.duplicate();\n\t\t\t\trng.collapse(0);\n\t\t\t\tendElement = rng.parentElement();\n\t\t\t\tif (endElement.ownerDocument !== self.dom.doc) {\n\t\t\t\t\tendElement = self.dom.getRoot();\n\t\t\t\t}\n\n\t\t\t\tif (endElement && endElement.nodeName == 'BODY') {\n\t\t\t\t\treturn endElement.lastChild || endElement;\n\t\t\t\t}\n\n\t\t\t\treturn endElement;\n\t\t\t}\n\n\t\t\tendElement = rng.endContainer;\n\t\t\tendOffset = rng.endOffset;\n\n\t\t\tif (endElement.nodeType == 1 && endElement.hasChildNodes()) {\n\t\t\t\tif (!real || !rng.collapsed) {\n\t\t\t\t\tendElement = endElement.childNodes[endOffset > 0 ? endOffset - 1 : endOffset];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (endElement && endElement.nodeType == 3) {\n\t\t\t\treturn endElement.parentNode;\n\t\t\t}\n\n\t\t\treturn endElement;\n\t\t},\n\n\t\t/**\n\t\t * Returns a bookmark location for the current selection. This bookmark object\n\t\t * can then be used to restore the selection after some content modification to the document.\n\t\t *\n\t\t * @method getBookmark\n\t\t * @param {Number} type Optional state if the bookmark should be simple or not. Default is complex.\n\t\t * @param {Boolean} normalized Optional state that enables you to get a position that it would be after normalization.\n\t\t * @return {Object} Bookmark object, use moveToBookmark with this object to restore the selection.\n\t\t * @example\n\t\t * // Stores a bookmark of the current selection\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\n\t\t *\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\n\t\t *\n\t\t * // Restore the selection bookmark\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\n\t\t */\n\t\tgetBookmark: function(type, normalized) {\n\t\t\treturn this.bookmarkManager.getBookmark(type, normalized);\n\t\t},\n\n\t\t/**\n\t\t * Restores the selection to the specified bookmark.\n\t\t *\n\t\t * @method moveToBookmark\n\t\t * @param {Object} bookmark Bookmark to restore selection from.\n\t\t * @return {Boolean} true/false if it was successful or not.\n\t\t * @example\n\t\t * // Stores a bookmark of the current selection\n\t\t * var bm = tinymce.activeEditor.selection.getBookmark();\n\t\t *\n\t\t * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');\n\t\t *\n\t\t * // Restore the selection bookmark\n\t\t * tinymce.activeEditor.selection.moveToBookmark(bm);\n\t\t */\n\t\tmoveToBookmark: function(bookmark) {\n\t\t\treturn this.bookmarkManager.moveToBookmark(bookmark);\n\t\t},\n\n\t\t/**\n\t\t * Selects the specified element. This will place the start and end of the selection range around the element.\n\t\t *\n\t\t * @method select\n\t\t * @param {Element} node HTML DOM element to select.\n\t\t * @param {Boolean} content Optional bool state if the contents should be selected or not on non IE browser.\n\t\t * @return {Element} Selected element the same element as the one that got passed in.\n\t\t * @example\n\t\t * // Select the first paragraph in the active editor\n\t\t * tinymce.activeEditor.selection.select(tinymce.activeEditor.dom.select('p')[0]);\n\t\t */\n\t\tselect: function(node, content) {\n\t\t\tvar self = this, dom = self.dom, rng = dom.createRng(), idx;\n\n\t\t\t// Clear stored range set by FocusManager\n\t\t\tself.lastFocusBookmark = null;\n\n\t\t\tif (node) {\n\t\t\t\tif (!content && self.controlSelection.controlSelect(node)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tidx = dom.nodeIndex(node);\n\t\t\t\trng.setStart(node.parentNode, idx);\n\t\t\t\trng.setEnd(node.parentNode, idx + 1);\n\n\t\t\t\t// Find first/last text node or BR element\n\t\t\t\tif (content) {\n\t\t\t\t\tself._moveEndPoint(rng, node, true);\n\t\t\t\t\tself._moveEndPoint(rng, node);\n\t\t\t\t}\n\n\t\t\t\tself.setRng(rng);\n\t\t\t}\n\n\t\t\treturn node;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the selection range is collapsed or not. Collapsed means if it's a caret or a larger selection.\n\t\t *\n\t\t * @method isCollapsed\n\t\t * @return {Boolean} true/false state if the selection range is collapsed or not.\n\t\t * Collapsed means if it's a caret or a larger selection.\n\t\t */\n\t\tisCollapsed: function() {\n\t\t\tvar self = this, rng = self.getRng(), sel = self.getSel();\n\n\t\t\tif (!rng || rng.item) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (rng.compareEndPoints) {\n\t\t\t\treturn rng.compareEndPoints('StartToEnd', rng) === 0;\n\t\t\t}\n\n\t\t\treturn !sel || rng.collapsed;\n\t\t},\n\n\t\t/**\n\t\t * Collapse the selection to start or end of range.\n\t\t *\n\t\t * @method collapse\n\t\t * @param {Boolean} toStart Optional boolean state if to collapse to end or not. Defaults to false.\n\t\t */\n\t\tcollapse: function(toStart) {\n\t\t\tvar self = this, rng = self.getRng(), node;\n\n\t\t\t// Control range on IE\n\t\t\tif (rng.item) {\n\t\t\t\tnode = rng.item(0);\n\t\t\t\trng = self.win.document.body.createTextRange();\n\t\t\t\trng.moveToElementText(node);\n\t\t\t}\n\n\t\t\trng.collapse(!!toStart);\n\t\t\tself.setRng(rng);\n\t\t},\n\n\t\t/**\n\t\t * Returns the browsers internal selection object.\n\t\t *\n\t\t * @method getSel\n\t\t * @return {Selection} Internal browser selection object.\n\t\t */\n\t\tgetSel: function() {\n\t\t\tvar win = this.win;\n\n\t\t\treturn win.getSelection ? win.getSelection() : win.document.selection;\n\t\t},\n\n\t\t/**\n\t\t * Returns the browsers internal range object.\n\t\t *\n\t\t * @method getRng\n\t\t * @param {Boolean} w3c Forces a compatible W3C range on IE.\n\t\t * @return {Range} Internal browser range object.\n\t\t * @see http://www.quirksmode.org/dom/range_intro.html\n\t\t * @see http://www.dotvoid.com/2001/03/using-the-range-object-in-mozilla/\n\t\t */\n\t\tgetRng: function(w3c) {\n\t\t\tvar self = this, selection, rng, elm, doc, ieRng, evt;\n\n\t\t\tfunction tryCompareBoundaryPoints(how, sourceRange, destinationRange) {\n\t\t\t\ttry {\n\t\t\t\t\treturn sourceRange.compareBoundaryPoints(how, destinationRange);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Gecko throws wrong document exception if the range points\n\t\t\t\t\t// to nodes that where removed from the dom #6690\n\t\t\t\t\t// Browsers should mutate existing DOMRange instances so that they always point\n\t\t\t\t\t// to something in the document this is not the case in Gecko works fine in IE/WebKit/Blink\n\t\t\t\t\t// For performance reasons just return -1\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!self.win) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tdoc = self.win.document;\n\n\t\t\t// Use last rng passed from FocusManager if it's available this enables\n\t\t\t// calls to editor.selection.getStart() to work when caret focus is lost on IE\n\t\t\tif (!w3c && self.lastFocusBookmark) {\n\t\t\t\tvar bookmark = self.lastFocusBookmark;\n\n\t\t\t\t// Convert bookmark to range IE 11 fix\n\t\t\t\tif (bookmark.startContainer) {\n\t\t\t\t\trng = doc.createRange();\n\t\t\t\t\trng.setStart(bookmark.startContainer, bookmark.startOffset);\n\t\t\t\t\trng.setEnd(bookmark.endContainer, bookmark.endOffset);\n\t\t\t\t} else {\n\t\t\t\t\trng = bookmark;\n\t\t\t\t}\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\t// Found tridentSel object then we need to use that one\n\t\t\tif (w3c && self.tridentSel) {\n\t\t\t\treturn self.tridentSel.getRangeAt(0);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tif ((selection = self.getSel())) {\n\t\t\t\t\tif (selection.rangeCount > 0) {\n\t\t\t\t\t\trng = selection.getRangeAt(0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng = selection.createRange ? selection.createRange() : doc.createRange();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (ex) {\n\t\t\t\t// IE throws unspecified error here if TinyMCE is placed in a frame/iframe\n\t\t\t}\n\n\t\t\tevt = self.editor.fire('GetSelectionRange', {range: rng});\n\t\t\tif (evt.range !== rng) {\n\t\t\t\treturn evt.range;\n\t\t\t}\n\n\t\t\t// We have W3C ranges and it's IE then fake control selection since IE9 doesn't handle that correctly yet\n\t\t\t// IE 11 doesn't support the selection object so we check for that as well\n\t\t\tif (isIE && rng && rng.setStart && doc.selection) {\n\t\t\t\ttry {\n\t\t\t\t\t// IE will sometimes throw an exception here\n\t\t\t\t\tieRng = doc.selection.createRange();\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Ignore\n\t\t\t\t}\n\n\t\t\t\tif (ieRng && ieRng.item) {\n\t\t\t\t\telm = ieRng.item(0);\n\t\t\t\t\trng = doc.createRange();\n\t\t\t\t\trng.setStartBefore(elm);\n\t\t\t\t\trng.setEndAfter(elm);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// No range found then create an empty one\n\t\t\t// This can occur when the editor is placed in a hidden container element on Gecko\n\t\t\t// Or on IE when there was an exception\n\t\t\tif (!rng) {\n\t\t\t\trng = doc.createRange ? doc.createRange() : doc.body.createTextRange();\n\t\t\t}\n\n\t\t\t// If range is at start of document then move it to start of body\n\t\t\tif (rng.setStart && rng.startContainer.nodeType === 9 && rng.collapsed) {\n\t\t\t\telm = self.dom.getRoot();\n\t\t\t\trng.setStart(elm, 0);\n\t\t\t\trng.setEnd(elm, 0);\n\t\t\t}\n\n\t\t\tif (self.selectedRange && self.explicitRange) {\n\t\t\t\tif (tryCompareBoundaryPoints(rng.START_TO_START, rng, self.selectedRange) === 0 &&\n\t\t\t\t\ttryCompareBoundaryPoints(rng.END_TO_END, rng, self.selectedRange) === 0) {\n\t\t\t\t\t// Safari, Opera and Chrome only ever select text which causes the range to change.\n\t\t\t\t\t// This lets us use the originally set range if the selection hasn't been changed by the user.\n\t\t\t\t\trng = self.explicitRange;\n\t\t\t\t} else {\n\t\t\t\t\tself.selectedRange = null;\n\t\t\t\t\tself.explicitRange = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn rng;\n\t\t},\n\n\t\t/**\n\t\t * Changes the selection to the specified DOM range.\n\t\t *\n\t\t * @method setRng\n\t\t * @param {Range} rng Range to select.\n\t\t * @param {Boolean} forward Optional boolean if the selection is forwards or backwards.\n\t\t */\n\t\tsetRng: function(rng, forward) {\n\t\t\tvar self = this, sel, node, evt;\n\n\t\t\tif (!rng) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Is IE specific range\n\t\t\tif (rng.select) {\n\t\t\t\tself.explicitRange = null;\n\n\t\t\t\ttry {\n\t\t\t\t\trng.select();\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Needed for some odd IE bug #1843306\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!self.tridentSel) {\n\t\t\t\tsel = self.getSel();\n\n\t\t\t\tevt = self.editor.fire('SetSelectionRange', {range: rng});\n\t\t\t\trng = evt.range;\n\n\t\t\t\tif (sel) {\n\t\t\t\t\tself.explicitRange = rng;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t\t\tsel.addRange(rng);\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// IE might throw errors here if the editor is within a hidden container and selection is changed\n\t\t\t\t\t}\n\n\t\t\t\t\t// Forward is set to false and we have an extend function\n\t\t\t\t\tif (forward === false && sel.extend) {\n\t\t\t\t\t\tsel.collapse(rng.endContainer, rng.endOffset);\n\t\t\t\t\t\tsel.extend(rng.startContainer, rng.startOffset);\n\t\t\t\t\t}\n\n\t\t\t\t\t// adding range isn't always successful so we need to check range count otherwise an exception can occur\n\t\t\t\t\tself.selectedRange = sel.rangeCount > 0 ? sel.getRangeAt(0) : null;\n\t\t\t\t}\n\n\t\t\t\t// WebKit egde case selecting images works better using setBaseAndExtent\n\t\t\t\tif (!rng.collapsed && rng.startContainer == rng.endContainer && sel.setBaseAndExtent && !Env.ie) {\n\t\t\t\t\tif (rng.endOffset - rng.startOffset < 2) {\n\t\t\t\t\t\tif (rng.startContainer.hasChildNodes()) {\n\t\t\t\t\t\t\tnode = rng.startContainer.childNodes[rng.startOffset];\n\t\t\t\t\t\t\tif (node && node.tagName == 'IMG') {\n\t\t\t\t\t\t\t\tself.getSel().setBaseAndExtent(node, 0, node, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Is W3C Range fake range on IE\n\t\t\t\tif (rng.cloneRange) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tself.tridentSel.addRange(rng);\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t//IE9 throws an error here if called before selection is placed in the editor\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets the current selection to the specified DOM element.\n\t\t *\n\t\t * @method setNode\n\t\t * @param {Element} elm Element to set as the contents of the selection.\n\t\t * @return {Element} Returns the element that got passed in.\n\t\t * @example\n\t\t * // Inserts a DOM node at current selection/caret location\n\t\t * tinymce.activeEditor.selection.setNode(tinymce.activeEditor.dom.create('img', {src: 'some.gif', title: 'some title'}));\n\t\t */\n\t\tsetNode: function(elm) {\n\t\t\tvar self = this;\n\n\t\t\tself.setContent(self.dom.getOuterHTML(elm));\n\n\t\t\treturn elm;\n\t\t},\n\n\t\t/**\n\t\t * Returns the currently selected element or the common ancestor element for both start and end of the selection.\n\t\t *\n\t\t * @method getNode\n\t\t * @return {Element} Currently selected element or common ancestor element.\n\t\t * @example\n\t\t * // Alerts the currently selected elements node name\n\t\t * alert(tinymce.activeEditor.selection.getNode().nodeName);\n\t\t */\n\t\tgetNode: function() {\n\t\t\tvar self = this, rng = self.getRng(), elm;\n\t\t\tvar startContainer, endContainer, startOffset, endOffset, root = self.dom.getRoot();\n\n\t\t\tfunction skipEmptyTextNodes(node, forwards) {\n\t\t\t\tvar orig = node;\n\n\t\t\t\twhile (node && node.nodeType === 3 && node.length === 0) {\n\t\t\t\t\tnode = forwards ? node.nextSibling : node.previousSibling;\n\t\t\t\t}\n\n\t\t\t\treturn node || orig;\n\t\t\t}\n\n\t\t\t// Range maybe lost after the editor is made visible again\n\t\t\tif (!rng) {\n\t\t\t\treturn root;\n\t\t\t}\n\n\t\t\tstartContainer = rng.startContainer;\n\t\t\tendContainer = rng.endContainer;\n\t\t\tstartOffset = rng.startOffset;\n\t\t\tendOffset = rng.endOffset;\n\n\t\t\tif (rng.setStart) {\n\t\t\t\telm = rng.commonAncestorContainer;\n\n\t\t\t\t// Handle selection a image or other control like element such as anchors\n\t\t\t\tif (!rng.collapsed) {\n\t\t\t\t\tif (startContainer == endContainer) {\n\t\t\t\t\t\tif (endOffset - startOffset < 2) {\n\t\t\t\t\t\t\tif (startContainer.hasChildNodes()) {\n\t\t\t\t\t\t\t\telm = startContainer.childNodes[startOffset];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// If the anchor node is a element instead of a text node then return this element\n\t\t\t\t\t//if (tinymce.isWebKit && sel.anchorNode && sel.anchorNode.nodeType == 1)\n\t\t\t\t\t//\treturn sel.anchorNode.childNodes[sel.anchorOffset];\n\n\t\t\t\t\t// Handle cases where the selection is immediately wrapped around a node and return that node instead of it's parent.\n\t\t\t\t\t// This happens when you double click an underlined word in FireFox.\n\t\t\t\t\tif (startContainer.nodeType === 3 && endContainer.nodeType === 3) {\n\t\t\t\t\t\tif (startContainer.length === startOffset) {\n\t\t\t\t\t\t\tstartContainer = skipEmptyTextNodes(startContainer.nextSibling, true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstartContainer = startContainer.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (endOffset === 0) {\n\t\t\t\t\t\t\tendContainer = skipEmptyTextNodes(endContainer.previousSibling, false);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tendContainer = endContainer.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (startContainer && startContainer === endContainer) {\n\t\t\t\t\t\t\treturn startContainer;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (elm && elm.nodeType == 3) {\n\t\t\t\t\treturn elm.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn elm;\n\t\t\t}\n\n\t\t\telm = rng.item ? rng.item(0) : rng.parentElement();\n\n\t\t\t// IE 7 might return elements outside the iframe\n\t\t\tif (elm.ownerDocument !== self.win.document) {\n\t\t\t\telm = root;\n\t\t\t}\n\n\t\t\treturn elm;\n\t\t},\n\n\t\tgetSelectedBlocks: function(startElm, endElm) {\n\t\t\tvar self = this, dom = self.dom, node, root, selectedBlocks = [];\n\n\t\t\troot = dom.getRoot();\n\t\t\tstartElm = dom.getParent(startElm || self.getStart(), dom.isBlock);\n\t\t\tendElm = dom.getParent(endElm || self.getEnd(), dom.isBlock);\n\n\t\t\tif (startElm && startElm != root) {\n\t\t\t\tselectedBlocks.push(startElm);\n\t\t\t}\n\n\t\t\tif (startElm && endElm && startElm != endElm) {\n\t\t\t\tnode = startElm;\n\n\t\t\t\tvar walker = new TreeWalker(startElm, root);\n\t\t\t\twhile ((node = walker.next()) && node != endElm) {\n\t\t\t\t\tif (dom.isBlock(node)) {\n\t\t\t\t\t\tselectedBlocks.push(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (endElm && startElm != endElm && endElm != root) {\n\t\t\t\tselectedBlocks.push(endElm);\n\t\t\t}\n\n\t\t\treturn selectedBlocks;\n\t\t},\n\n\t\tisForward: function() {\n\t\t\tvar dom = this.dom, sel = this.getSel(), anchorRange, focusRange;\n\n\t\t\t// No support for selection direction then always return true\n\t\t\tif (!sel || !sel.anchorNode || !sel.focusNode) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tanchorRange = dom.createRng();\n\t\t\tanchorRange.setStart(sel.anchorNode, sel.anchorOffset);\n\t\t\tanchorRange.collapse(true);\n\n\t\t\tfocusRange = dom.createRng();\n\t\t\tfocusRange.setStart(sel.focusNode, sel.focusOffset);\n\t\t\tfocusRange.collapse(true);\n\n\t\t\treturn anchorRange.compareBoundaryPoints(anchorRange.START_TO_START, focusRange) <= 0;\n\t\t},\n\n\t\tnormalize: function() {\n\t\t\tvar self = this, rng = self.getRng();\n\n\t\t\tif (Env.range && new RangeUtils(self.dom).normalize(rng)) {\n\t\t\t\tself.setRng(rng, self.isForward());\n\t\t\t}\n\n\t\t\treturn rng;\n\t\t},\n\n\t\t/**\n\t\t * Executes callback when the current selection starts/stops matching the specified selector. The current\n\t\t * state will be passed to the callback as it's first argument.\n\t\t *\n\t\t * @method selectorChanged\n\t\t * @param {String} selector CSS selector to check for.\n\t\t * @param {function} callback Callback with state and args when the selector is matches or not.\n\t\t */\n\t\tselectorChanged: function(selector, callback) {\n\t\t\tvar self = this, currentSelectors;\n\n\t\t\tif (!self.selectorChangedData) {\n\t\t\t\tself.selectorChangedData = {};\n\t\t\t\tcurrentSelectors = {};\n\n\t\t\t\tself.editor.on('NodeChange', function(e) {\n\t\t\t\t\tvar node = e.element, dom = self.dom, parents = dom.getParents(node, null, dom.getRoot()), matchedSelectors = {};\n\n\t\t\t\t\t// Check for new matching selectors\n\t\t\t\t\teach(self.selectorChangedData, function(callbacks, selector) {\n\t\t\t\t\t\teach(parents, function(node) {\n\t\t\t\t\t\t\tif (dom.is(node, selector)) {\n\t\t\t\t\t\t\t\tif (!currentSelectors[selector]) {\n\t\t\t\t\t\t\t\t\t// Execute callbacks\n\t\t\t\t\t\t\t\t\teach(callbacks, function(callback) {\n\t\t\t\t\t\t\t\t\t\tcallback(true, {node: node, selector: selector, parents: parents});\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tcurrentSelectors[selector] = callbacks;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tmatchedSelectors[selector] = callbacks;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t// Check if current selectors still match\n\t\t\t\t\teach(currentSelectors, function(callbacks, selector) {\n\t\t\t\t\t\tif (!matchedSelectors[selector]) {\n\t\t\t\t\t\t\tdelete currentSelectors[selector];\n\n\t\t\t\t\t\t\teach(callbacks, function(callback) {\n\t\t\t\t\t\t\t\tcallback(false, {node: node, selector: selector, parents: parents});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Add selector listeners\n\t\t\tif (!self.selectorChangedData[selector]) {\n\t\t\t\tself.selectorChangedData[selector] = [];\n\t\t\t}\n\n\t\t\tself.selectorChangedData[selector].push(callback);\n\n\t\t\treturn self;\n\t\t},\n\n\t\tgetScrollContainer: function() {\n\t\t\tvar scrollContainer, node = this.dom.getRoot();\n\n\t\t\twhile (node && node.nodeName != 'BODY') {\n\t\t\t\tif (node.scrollHeight > node.clientHeight) {\n\t\t\t\t\tscrollContainer = node;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\treturn scrollContainer;\n\t\t},\n\n\t\tscrollIntoView: function(elm, alignToTop) {\n\t\t\tvar y, viewPort, self = this, dom = self.dom, root = dom.getRoot(), viewPortY, viewPortH, offsetY = 0;\n\n\t\t\tfunction getPos(elm) {\n\t\t\t\tvar x = 0, y = 0;\n\n\t\t\t\tvar offsetParent = elm;\n\t\t\t\twhile (offsetParent && offsetParent.nodeType) {\n\t\t\t\t\tx += offsetParent.offsetLeft || 0;\n\t\t\t\t\ty += offsetParent.offsetTop || 0;\n\t\t\t\t\toffsetParent = offsetParent.offsetParent;\n\t\t\t\t}\n\n\t\t\t\treturn {x: x, y: y};\n\t\t\t}\n\n\t\t\tif (!NodeType.isElement(elm)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (alignToTop === false) {\n\t\t\t\toffsetY = elm.offsetHeight;\n\t\t\t}\n\n\t\t\tif (root.nodeName != 'BODY') {\n\t\t\t\tvar scrollContainer = self.getScrollContainer();\n\t\t\t\tif (scrollContainer) {\n\t\t\t\t\ty = getPos(elm).y - getPos(scrollContainer).y + offsetY;\n\t\t\t\t\tviewPortH = scrollContainer.clientHeight;\n\t\t\t\t\tviewPortY = scrollContainer.scrollTop;\n\t\t\t\t\tif (y < viewPortY || y + 25 > viewPortY + viewPortH) {\n\t\t\t\t\t\tscrollContainer.scrollTop = y < viewPortY ? y : y - viewPortH + 25;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tviewPort = dom.getViewPort(self.editor.getWin());\n\t\t\ty = dom.getPos(elm).y + offsetY;\n\t\t\tviewPortY = viewPort.y;\n\t\t\tviewPortH = viewPort.h;\n\t\t\tif (y < viewPort.y || y + 25 > viewPortY + viewPortH) {\n\t\t\t\tself.editor.getWin().scrollTo(0, y < viewPortY ? y : y - viewPortH + 25);\n\t\t\t}\n\t\t},\n\n\t\tplaceCaretAt: function(clientX, clientY) {\n\t\t\tthis.setRng(RangeUtils.getCaretRangeFromPoint(clientX, clientY, this.editor.getDoc()));\n\t\t},\n\n\t\t_moveEndPoint: function(rng, node, start) {\n\t\t\tvar root = node, walker = new TreeWalker(node, root);\n\t\t\tvar nonEmptyElementsMap = this.dom.schema.getNonEmptyElements();\n\n\t\t\tdo {\n\t\t\t\t// Text node\n\t\t\t\tif (node.nodeType == 3 && trim(node.nodeValue).length !== 0) {\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\trng.setStart(node, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setEnd(node, node.nodeValue.length);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// BR/IMG/INPUT elements but not table cells\n\t\t\t\tif (nonEmptyElementsMap[node.nodeName] && !/^(TD|TH)$/.test(node.nodeName)) {\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (node.nodeName == 'BR') {\n\t\t\t\t\t\t\trng.setEndBefore(node);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setEndAfter(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Found empty text block old IE can place the selection inside those\n\t\t\t\tif (Env.ie && Env.ie < 11 && this.dom.isBlock(node) && this.dom.isEmpty(node)) {\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\trng.setStart(node, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setEnd(node, 0);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} while ((node = (start ? walker.next() : walker.prev())));\n\n\t\t\t// Failed to find any text node or other suitable location then move to the root of body\n\t\t\tif (root.nodeName == 'BODY') {\n\t\t\t\tif (start) {\n\t\t\t\t\trng.setStart(root, 0);\n\t\t\t\t} else {\n\t\t\t\t\trng.setEnd(root, root.childNodes.length);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tgetBoundingClientRect:  function() {\n\t\t\tvar rng = this.getRng();\n\t\t\treturn rng.collapsed ? CaretPosition.fromRangeStart(rng).getClientRects()[0] : rng.getBoundingClientRect();\n\t\t},\n\n\t\tdestroy: function() {\n\t\t\tthis.win = null;\n\t\t\tthis.controlSelection.destroy();\n\t\t}\n\t};\n\n\treturn Selection;\n});\n\n// Included from: js/tinymce/classes/dom/ElementUtils.js\n\n/**\n * ElementUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility class for various element specific functions.\n *\n * @private\n * @class tinymce.dom.ElementUtils\n */\ndefine(\"tinymce/dom/ElementUtils\", [\n\t\"tinymce/dom/BookmarkManager\",\n\t\"tinymce/util/Tools\"\n], function(BookmarkManager, Tools) {\n\tvar each = Tools.each;\n\n\tfunction ElementUtils(dom) {\n\t\t/**\n\t\t * Compares two nodes and checks if it's attributes and styles matches.\n\t\t * This doesn't compare classes as items since their order is significant.\n\t\t *\n\t\t * @method compare\n\t\t * @param {Node} node1 First node to compare with.\n\t\t * @param {Node} node2 Second node to compare with.\n\t\t * @return {boolean} True/false if the nodes are the same or not.\n\t\t */\n\t\tthis.compare = function(node1, node2) {\n\t\t\t// Not the same name\n\t\t\tif (node1.nodeName != node2.nodeName) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Returns all the nodes attributes excluding internal ones, styles and classes.\n\t\t\t *\n\t\t\t * @private\n\t\t\t * @param {Node} node Node to get attributes from.\n\t\t\t * @return {Object} Name/value object with attributes and attribute values.\n\t\t\t */\n\t\t\tfunction getAttribs(node) {\n\t\t\t\tvar attribs = {};\n\n\t\t\t\teach(dom.getAttribs(node), function(attr) {\n\t\t\t\t\tvar name = attr.nodeName.toLowerCase();\n\n\t\t\t\t\t// Don't compare internal attributes or style\n\t\t\t\t\tif (name.indexOf('_') !== 0 && name !== 'style' && name.indexOf('data-') !== 0) {\n\t\t\t\t\t\tattribs[name] = dom.getAttrib(node, name);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn attribs;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Compares two objects checks if it's key + value exists in the other one.\n\t\t\t *\n\t\t\t * @private\n\t\t\t * @param {Object} obj1 First object to compare.\n\t\t\t * @param {Object} obj2 Second object to compare.\n\t\t\t * @return {boolean} True/false if the objects matches or not.\n\t\t\t */\n\t\t\tfunction compareObjects(obj1, obj2) {\n\t\t\t\tvar value, name;\n\n\t\t\t\tfor (name in obj1) {\n\t\t\t\t\t// Obj1 has item obj2 doesn't have\n\t\t\t\t\tif (obj1.hasOwnProperty(name)) {\n\t\t\t\t\t\tvalue = obj2[name];\n\n\t\t\t\t\t\t// Obj2 doesn't have obj1 item\n\t\t\t\t\t\tif (typeof value == \"undefined\") {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Obj2 item has a different value\n\t\t\t\t\t\tif (obj1[name] != value) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Delete similar value\n\t\t\t\t\t\tdelete obj2[name];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Check if obj 2 has something obj 1 doesn't have\n\t\t\t\tfor (name in obj2) {\n\t\t\t\t\t// Obj2 has item obj1 doesn't have\n\t\t\t\t\tif (obj2.hasOwnProperty(name)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Attribs are not the same\n\t\t\tif (!compareObjects(getAttribs(node1), getAttribs(node2))) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Styles are not the same\n\t\t\tif (!compareObjects(dom.parseStyle(dom.getAttrib(node1, 'style')), dom.parseStyle(dom.getAttrib(node2, 'style')))) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn !BookmarkManager.isBookmarkNode(node1) && !BookmarkManager.isBookmarkNode(node2);\n\t\t};\n\t}\n\n\treturn ElementUtils;\n});\n\n// Included from: js/tinymce/classes/fmt/Preview.js\n\n/**\n * Preview.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Internal class for generating previews styles for formats.\n *\n * Example:\n *  Preview.getCssText(editor, 'bold');\n *\n * @private\n * @class tinymce.fmt.Preview\n */\ndefine(\"tinymce/fmt/Preview\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar each = Tools.each;\n\n\tfunction getCssText(editor, format) {\n\t\tvar name, previewElm, dom = editor.dom;\n\t\tvar previewCss = '', parentFontSize, previewStyles;\n\n\t\tpreviewStyles = editor.settings.preview_styles;\n\n\t\t// No preview forced\n\t\tif (previewStyles === false) {\n\t\t\treturn '';\n\t\t}\n\n\t\t// Default preview\n\t\tif (!previewStyles) {\n\t\t\tpreviewStyles = 'font-family font-size font-weight font-style text-decoration ' +\n\t\t\t\t'text-transform color background-color border border-radius outline text-shadow';\n\t\t}\n\n\t\t// Removes any variables since these can't be previewed\n\t\tfunction removeVars(val) {\n\t\t\treturn val.replace(/%(\\w+)/g, '');\n\t\t}\n\n\t\t// Create block/inline element to use for preview\n\t\tif (typeof format == \"string\") {\n\t\t\tformat = editor.formatter.get(format);\n\t\t\tif (!format) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tformat = format[0];\n\t\t}\n\n\t\tname = format.block || format.inline || 'span';\n\t\tpreviewElm = dom.create(name);\n\n\t\t// Add format styles to preview element\n\t\teach(format.styles, function(value, name) {\n\t\t\tvalue = removeVars(value);\n\n\t\t\tif (value) {\n\t\t\t\tdom.setStyle(previewElm, name, value);\n\t\t\t}\n\t\t});\n\n\t\t// Add attributes to preview element\n\t\teach(format.attributes, function(value, name) {\n\t\t\tvalue = removeVars(value);\n\n\t\t\tif (value) {\n\t\t\t\tdom.setAttrib(previewElm, name, value);\n\t\t\t}\n\t\t});\n\n\t\t// Add classes to preview element\n\t\teach(format.classes, function(value) {\n\t\t\tvalue = removeVars(value);\n\n\t\t\tif (!dom.hasClass(previewElm, value)) {\n\t\t\t\tdom.addClass(previewElm, value);\n\t\t\t}\n\t\t});\n\n\t\teditor.fire('PreviewFormats');\n\n\t\t// Add the previewElm outside the visual area\n\t\tdom.setStyles(previewElm, {position: 'absolute', left: -0xFFFF});\n\t\teditor.getBody().appendChild(previewElm);\n\n\t\t// Get parent container font size so we can compute px values out of em/% for older IE:s\n\t\tparentFontSize = dom.getStyle(editor.getBody(), 'fontSize', true);\n\t\tparentFontSize = /px$/.test(parentFontSize) ? parseInt(parentFontSize, 10) : 0;\n\n\t\teach(previewStyles.split(' '), function(name) {\n\t\t\tvar value = dom.getStyle(previewElm, name, true);\n\n\t\t\t// If background is transparent then check if the body has a background color we can use\n\t\t\tif (name == 'background-color' && /transparent|rgba\\s*\\([^)]+,\\s*0\\)/.test(value)) {\n\t\t\t\tvalue = dom.getStyle(editor.getBody(), name, true);\n\n\t\t\t\t// Ignore white since it's the default color, not the nicest fix\n\t\t\t\t// TODO: Fix this by detecting runtime style\n\t\t\t\tif (dom.toHex(value).toLowerCase() == '#ffffff') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (name == 'color') {\n\t\t\t\t// Ignore black since it's the default color, not the nicest fix\n\t\t\t\t// TODO: Fix this by detecting runtime style\n\t\t\t\tif (dom.toHex(value).toLowerCase() == '#000000') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Old IE won't calculate the font size so we need to do that manually\n\t\t\tif (name == 'font-size') {\n\t\t\t\tif (/em|%$/.test(value)) {\n\t\t\t\t\tif (parentFontSize === 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert font size from em/% to px\n\t\t\t\t\tvalue = parseFloat(value, 10) / (/%$/.test(value) ? 100 : 1);\n\t\t\t\t\tvalue = (value * parentFontSize) + 'px';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (name == \"border\" && value) {\n\t\t\t\tpreviewCss += 'padding:0 2px;';\n\t\t\t}\n\n\t\t\tpreviewCss += name + ':' + value + ';';\n\t\t});\n\n\t\teditor.fire('AfterPreviewFormats');\n\n\t\t//previewCss += 'line-height:normal';\n\n\t\tdom.remove(previewElm);\n\n\t\treturn previewCss;\n\t}\n\n\treturn {\n\t\tgetCssText: getCssText\n\t};\n});\n\n// Included from: js/tinymce/classes/fmt/Hooks.js\n\n/**\n * Hooks.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Internal class for overriding formatting.\n *\n * @private\n * @class tinymce.fmt.Hooks\n */\ndefine(\"tinymce/fmt/Hooks\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/DomQuery\"\n], function(Arr, NodeType, $) {\n\tvar postProcessHooks = [], filter = Arr.filter, each = Arr.each;\n\n\tfunction addPostProcessHook(name, hook) {\n\t\tvar hooks = postProcessHooks[name];\n\n\t\tif (!hooks) {\n\t\t\tpostProcessHooks[name] = hooks = [];\n\t\t}\n\n\t\tpostProcessHooks[name].push(hook);\n\t}\n\n\tfunction postProcess(name, editor) {\n\t\teach(postProcessHooks[name], function(hook) {\n\t\t\thook(editor);\n\t\t});\n\t}\n\n\taddPostProcessHook(\"pre\", function(editor) {\n\t\tvar rng = editor.selection.getRng(), isPre, blocks;\n\n\t\tfunction hasPreSibling(pre) {\n\t\t\treturn isPre(pre.previousSibling) && Arr.indexOf(blocks, pre.previousSibling) != -1;\n\t\t}\n\n\t\tfunction joinPre(pre1, pre2) {\n\t\t\t$(pre2).remove();\n\t\t\t$(pre1).append('<br><br>').append(pre2.childNodes);\n\t\t}\n\n\t\tisPre = NodeType.matchNodeNames('pre');\n\n\t\tif (!rng.collapsed) {\n\t\t\tblocks = editor.selection.getSelectedBlocks();\n\n\t\t\teach(filter(filter(blocks, isPre), hasPreSibling), function(pre) {\n\t\t\t\tjoinPre(pre.previousSibling, pre);\n\t\t\t});\n\t\t}\n\t});\n\n\treturn {\n\t\tpostProcess: postProcess\n\t};\n});\n\n// Included from: js/tinymce/classes/Formatter.js\n\n/**\n * Formatter.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Text formatter engine class. This class is used to apply formats like bold, italic, font size\n * etc to the current selection or specific nodes. This engine was built to replace the browser's\n * default formatting logic for execCommand due to its inconsistent and buggy behavior.\n *\n * @class tinymce.Formatter\n * @example\n *  tinymce.activeEditor.formatter.register('mycustomformat', {\n *    inline: 'span',\n *    styles: {color: '#ff0000'}\n *  });\n *\n *  tinymce.activeEditor.formatter.apply('mycustomformat');\n */\ndefine(\"tinymce/Formatter\", [\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/dom/BookmarkManager\",\n\t\"tinymce/dom/ElementUtils\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/fmt/Preview\",\n\t\"tinymce/fmt/Hooks\"\n], function(TreeWalker, RangeUtils, BookmarkManager, ElementUtils, Tools, Preview, Hooks) {\n\t/**\n\t * Constructs a new formatter instance.\n\t *\n\t * @constructor Formatter\n\t * @param {tinymce.Editor} ed Editor instance to construct the formatter engine to.\n\t */\n\treturn function(ed) {\n\t\tvar formats = {},\n\t\t\tdom = ed.dom,\n\t\t\tselection = ed.selection,\n\t\t\trangeUtils = new RangeUtils(dom),\n\t\t\tisValid = ed.schema.isValidChild,\n\t\t\tisBlock = dom.isBlock,\n\t\t\tforcedRootBlock = ed.settings.forced_root_block,\n\t\t\tnodeIndex = dom.nodeIndex,\n\t\t\tINVISIBLE_CHAR = '\\uFEFF',\n\t\t\tMCE_ATTR_RE = /^(src|href|style)$/,\n\t\t\tFALSE = false,\n\t\t\tTRUE = true,\n\t\t\tformatChangeData,\n\t\t\tundef,\n\t\t\tgetContentEditable = dom.getContentEditable,\n\t\t\tdisableCaretContainer,\n\t\t\tmarkCaretContainersBogus,\n\t\t\tisBookmarkNode = BookmarkManager.isBookmarkNode;\n\n\t\tvar each = Tools.each,\n\t\t\tgrep = Tools.grep,\n\t\t\twalk = Tools.walk,\n\t\t\textend = Tools.extend;\n\n\t\tfunction isTextBlock(name) {\n\t\t\tif (name.nodeType) {\n\t\t\t\tname = name.nodeName;\n\t\t\t}\n\n\t\t\treturn !!ed.schema.getTextBlockElements()[name.toLowerCase()];\n\t\t}\n\n\t\tfunction isTableCell(node) {\n\t\t\treturn /^(TH|TD)$/.test(node.nodeName);\n\t\t}\n\n\t\tfunction isInlineBlock(node) {\n\t\t\treturn node && /^(IMG)$/.test(node.nodeName);\n\t\t}\n\n\t\tfunction getParents(node, selector) {\n\t\t\treturn dom.getParents(node, selector, dom.getRoot());\n\t\t}\n\n\t\tfunction isCaretNode(node) {\n\t\t\treturn node.nodeType === 1 && node.id === '_mce_caret';\n\t\t}\n\n\t\tfunction defaultFormats() {\n\t\t\tregister({\n\t\t\t\tvaligntop: [\n\t\t\t\t\t{selector: 'td,th', styles: {'verticalAlign': 'top'}}\n\t\t\t\t],\n\n\t\t\t\tvalignmiddle: [\n\t\t\t\t\t{selector: 'td,th', styles: {'verticalAlign': 'middle'}}\n\t\t\t\t],\n\n\t\t\t\tvalignbottom: [\n\t\t\t\t\t{selector: 'td,th', styles: {'verticalAlign': 'bottom'}}\n\t\t\t\t],\n\n\t\t\t\talignleft: [\n\t\t\t\t\t{selector: 'figure.image', collapsed: false, classes: 'align-left', ceFalseOverride: true},\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\ttextAlign: 'left'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinherit: false,\n\t\t\t\t\t\tdefaultBlock: 'div'\n\t\t\t\t\t},\n\t\t\t\t\t{selector: 'img,table', collapsed: false, styles: {'float': 'left'}}\n\t\t\t\t],\n\n\t\t\t\taligncenter: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\ttextAlign: 'center'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinherit: false,\n\t\t\t\t\t\tdefaultBlock: 'div'\n\t\t\t\t\t},\n\t\t\t\t\t{selector: 'figure.image', collapsed: false, classes: 'align-center', ceFalseOverride: true},\n\t\t\t\t\t{selector: 'img', collapsed: false, styles: {display: 'block', marginLeft: 'auto', marginRight: 'auto'}},\n\t\t\t\t\t{selector: 'table', collapsed: false, styles: {marginLeft: 'auto', marginRight: 'auto'}}\n\t\t\t\t],\n\n\t\t\t\talignright: [\n\t\t\t\t\t{selector: 'figure.image', collapsed: false, classes: 'align-right', ceFalseOverride: true},\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\ttextAlign: 'right'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinherit: false,\n\t\t\t\t\t\tdefaultBlock: 'div'\n\t\t\t\t\t},\n\t\t\t\t\t{selector: 'img,table', collapsed: false, styles: {'float': 'right'}}\n\t\t\t\t],\n\n\t\t\t\talignjustify: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\ttextAlign: 'justify'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinherit: false,\n\t\t\t\t\t\tdefaultBlock: 'div'\n\t\t\t\t\t}\n\t\t\t\t],\n\n\t\t\t\tbold: [\n\t\t\t\t\t{inline: 'strong', remove: 'all'},\n\t\t\t\t\t{inline: 'span', styles: {fontWeight: 'bold'}},\n\t\t\t\t\t{inline: 'b', remove: 'all'}\n\t\t\t\t],\n\n\t\t\t\titalic: [\n\t\t\t\t\t{inline: 'em', remove: 'all'},\n\t\t\t\t\t{inline: 'span', styles: {fontStyle: 'italic'}},\n\t\t\t\t\t{inline: 'i', remove: 'all'}\n\t\t\t\t],\n\n\t\t\t\tunderline: [\n\t\t\t\t\t{inline: 'span', styles: {textDecoration: 'underline'}, exact: true},\n\t\t\t\t\t{inline: 'u', remove: 'all'}\n\t\t\t\t],\n\n\t\t\t\tstrikethrough: [\n\t\t\t\t\t{inline: 'span', styles: {textDecoration: 'line-through'}, exact: true},\n\t\t\t\t\t{inline: 'strike', remove: 'all'}\n\t\t\t\t],\n\n\t\t\t\tforecolor: {inline: 'span', styles: {color: '%value'}, links: true, remove_similar: true},\n\t\t\t\thilitecolor: {inline: 'span', styles: {backgroundColor: '%value'}, links: true, remove_similar: true},\n\t\t\t\tfontname: {inline: 'span', styles: {fontFamily: '%value'}},\n\t\t\t\tfontsize: {inline: 'span', styles: {fontSize: '%value'}},\n\t\t\t\tfontsize_class: {inline: 'span', attributes: {'class': '%value'}},\n\t\t\t\tblockquote: {block: 'blockquote', wrapper: 1, remove: 'all'},\n\t\t\t\tsubscript: {inline: 'sub'},\n\t\t\t\tsuperscript: {inline: 'sup'},\n\t\t\t\tcode: {inline: 'code'},\n\n\t\t\t\tlink: {inline: 'a', selector: 'a', remove: 'all', split: true, deep: true,\n\t\t\t\t\tonmatch: function() {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\n\t\t\t\t\tonformat: function(elm, fmt, vars) {\n\t\t\t\t\t\teach(vars, function(value, key) {\n\t\t\t\t\t\t\tdom.setAttrib(elm, key, value);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tremoveformat: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: 'b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins',\n\t\t\t\t\t\tremove: 'all',\n\t\t\t\t\t\tsplit: true,\n\t\t\t\t\t\texpand: false,\n\t\t\t\t\t\tblock_expand: true,\n\t\t\t\t\t\tdeep: true\n\t\t\t\t\t},\n\t\t\t\t\t{selector: 'span', attributes: ['style', 'class'], remove: 'empty', split: true, expand: false, deep: true},\n\t\t\t\t\t{selector: '*', attributes: ['style', 'class'], split: false, expand: false, deep: true}\n\t\t\t\t]\n\t\t\t});\n\n\t\t\t// Register default block formats\n\t\t\teach('p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp'.split(/\\s/), function(name) {\n\t\t\t\tregister(name, {block: name, remove: 'all'});\n\t\t\t});\n\n\t\t\t// Register user defined formats\n\t\t\tregister(ed.settings.formats);\n\t\t}\n\n\t\tfunction addKeyboardShortcuts() {\n\t\t\t// Add some inline shortcuts\n\t\t\ted.addShortcut('meta+b', 'bold_desc', 'Bold');\n\t\t\ted.addShortcut('meta+i', 'italic_desc', 'Italic');\n\t\t\ted.addShortcut('meta+u', 'underline_desc', 'Underline');\n\n\t\t\t// BlockFormat shortcuts keys\n\t\t\tfor (var i = 1; i <= 6; i++) {\n\t\t\t\ted.addShortcut('access+' + i, '', ['FormatBlock', false, 'h' + i]);\n\t\t\t}\n\n\t\t\ted.addShortcut('access+7', '', ['FormatBlock', false, 'p']);\n\t\t\ted.addShortcut('access+8', '', ['FormatBlock', false, 'div']);\n\t\t\ted.addShortcut('access+9', '', ['FormatBlock', false, 'address']);\n\t\t}\n\n\t\t// Public functions\n\n\t\t/**\n\t\t * Returns the format by name or all formats if no name is specified.\n\t\t *\n\t\t * @method get\n\t\t * @param {String} name Optional name to retrieve by.\n\t\t * @return {Array/Object} Array/Object with all registered formats or a specific format.\n\t\t */\n\t\tfunction get(name) {\n\t\t\treturn name ? formats[name] : formats;\n\t\t}\n\n\t\t/**\n\t\t * Registers a specific format by name.\n\t\t *\n\t\t * @method register\n\t\t * @param {Object/String} name Name of the format for example \"bold\".\n\t\t * @param {Object/Array} format Optional format object or array of format variants\n\t\t * can only be omitted if the first arg is an object.\n\t\t */\n\t\tfunction register(name, format) {\n\t\t\tif (name) {\n\t\t\t\tif (typeof name !== 'string') {\n\t\t\t\t\teach(name, function(format, name) {\n\t\t\t\t\t\tregister(name, format);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// Force format into array and add it to internal collection\n\t\t\t\t\tformat = format.length ? format : [format];\n\n\t\t\t\t\teach(format, function(format) {\n\t\t\t\t\t\t// Set deep to false by default on selector formats this to avoid removing\n\t\t\t\t\t\t// alignment on images inside paragraphs when alignment is changed on paragraphs\n\t\t\t\t\t\tif (format.deep === undef) {\n\t\t\t\t\t\t\tformat.deep = !format.selector;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Default to true\n\t\t\t\t\t\tif (format.split === undef) {\n\t\t\t\t\t\t\tformat.split = !format.selector || format.inline;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Default to true\n\t\t\t\t\t\tif (format.remove === undef && format.selector && !format.inline) {\n\t\t\t\t\t\t\tformat.remove = 'none';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Mark format as a mixed format inline + block level\n\t\t\t\t\t\tif (format.selector && format.inline) {\n\t\t\t\t\t\t\tformat.mixed = true;\n\t\t\t\t\t\t\tformat.block_expand = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Split classes if needed\n\t\t\t\t\t\tif (typeof format.classes === 'string') {\n\t\t\t\t\t\t\tformat.classes = format.classes.split(/\\s+/);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tformats[name] = format;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Unregister a specific format by name.\n\t\t *\n\t\t * @method unregister\n\t\t * @param {String} name Name of the format for example \"bold\".\n\t\t */\n\t\tfunction unregister(name) {\n\t\t\tif (name && formats[name]) {\n\t\t\t\tdelete formats[name];\n\t\t\t}\n\n\t\t\treturn formats;\n\t\t}\n\n\t\tfunction matchesUnInheritedFormatSelector(node, name) {\n\t\t\tvar formatList = get(name);\n\n\t\t\tif (formatList) {\n\t\t\t\tfor (var i = 0; i < formatList.length; i++) {\n\t\t\t\t\tif (formatList[i].inherit === false && dom.is(node, formatList[i].selector)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction getTextDecoration(node) {\n\t\t\tvar decoration;\n\n\t\t\ted.dom.getParent(node, function(n) {\n\t\t\t\tdecoration = ed.dom.getStyle(n, 'text-decoration');\n\t\t\t\treturn decoration && decoration !== 'none';\n\t\t\t});\n\n\t\t\treturn decoration;\n\t\t}\n\n\t\tfunction processUnderlineAndColor(node) {\n\t\t\tvar textDecoration;\n\t\t\tif (node.nodeType === 1 && node.parentNode && node.parentNode.nodeType === 1) {\n\t\t\t\ttextDecoration = getTextDecoration(node.parentNode);\n\t\t\t\tif (ed.dom.getStyle(node, 'color') && textDecoration) {\n\t\t\t\t\ted.dom.setStyle(node, 'text-decoration', textDecoration);\n\t\t\t\t} else if (ed.dom.getStyle(node, 'text-decoration') === textDecoration) {\n\t\t\t\t\ted.dom.setStyle(node, 'text-decoration', null);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Applies the specified format to the current selection or specified node.\n\t\t *\n\t\t * @method apply\n\t\t * @param {String} name Name of format to apply.\n\t\t * @param {Object} vars Optional list of variables to replace within format before applying it.\n\t\t * @param {Node} node Optional node to apply the format to defaults to current selection.\n\t\t */\n\t\tfunction apply(name, vars, node) {\n\t\t\tvar formatList = get(name), format = formatList[0], bookmark, rng, isCollapsed = !node && selection.isCollapsed();\n\n\t\t\tfunction setElementFormat(elm, fmt) {\n\t\t\t\tfmt = fmt || format;\n\n\t\t\t\tif (elm) {\n\t\t\t\t\tif (fmt.onformat) {\n\t\t\t\t\t\tfmt.onformat(elm, fmt, vars, node);\n\t\t\t\t\t}\n\n\t\t\t\t\teach(fmt.styles, function(value, name) {\n\t\t\t\t\t\tdom.setStyle(elm, name, replaceVars(value, vars));\n\t\t\t\t\t});\n\n\t\t\t\t\t// Needed for the WebKit span spam bug\n\t\t\t\t\t// TODO: Remove this once WebKit/Blink fixes this\n\t\t\t\t\tif (fmt.styles) {\n\t\t\t\t\t\tvar styleVal = dom.getAttrib(elm, 'style');\n\n\t\t\t\t\t\tif (styleVal) {\n\t\t\t\t\t\t\telm.setAttribute('data-mce-style', styleVal);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\teach(fmt.attributes, function(value, name) {\n\t\t\t\t\t\tdom.setAttrib(elm, name, replaceVars(value, vars));\n\t\t\t\t\t});\n\n\t\t\t\t\teach(fmt.classes, function(value) {\n\t\t\t\t\t\tvalue = replaceVars(value, vars);\n\n\t\t\t\t\t\tif (!dom.hasClass(elm, value)) {\n\t\t\t\t\t\t\tdom.addClass(elm, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// This converts: <p>[a</p><p>]b</p> -> <p>[a]</p><p>b</p>\n\t\t\tfunction adjustSelectionToVisibleSelection() {\n\t\t\t\tfunction findSelectionEnd(start, end) {\n\t\t\t\t\tvar walker = new TreeWalker(end);\n\t\t\t\t\tfor (node = walker.prev2(); node; node = walker.prev2()) {\n\t\t\t\t\t\tif (node.nodeType == 3 && node.data.length > 0) {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (node.childNodes.length > 1 || node == start || node.tagName == 'BR') {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Adjust selection so that a end container with a end offset of zero is not included in the selection\n\t\t\t\t// as this isn't visible to the user.\n\t\t\t\tvar rng = ed.selection.getRng();\n\t\t\t\tvar start = rng.startContainer;\n\t\t\t\tvar end = rng.endContainer;\n\n\t\t\t\tif (start != end && rng.endOffset === 0) {\n\t\t\t\t\tvar newEnd = findSelectionEnd(start, end);\n\t\t\t\t\tvar endOffset = newEnd.nodeType == 3 ? newEnd.data.length : newEnd.childNodes.length;\n\n\t\t\t\t\trng.setEnd(newEnd, endOffset);\n\t\t\t\t}\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\tfunction applyRngStyle(rng, bookmark, node_specific) {\n\t\t\t\tvar newWrappers = [], wrapName, wrapElm, contentEditable = true;\n\n\t\t\t\t// Setup wrapper element\n\t\t\t\twrapName = format.inline || format.block;\n\t\t\t\twrapElm = dom.create(wrapName);\n\t\t\t\tsetElementFormat(wrapElm);\n\n\t\t\t\trangeUtils.walk(rng, function(nodes) {\n\t\t\t\t\tvar currentWrapElm;\n\n\t\t\t\t\t/**\n\t\t\t\t\t * Process a list of nodes wrap them.\n\t\t\t\t\t */\n\t\t\t\t\tfunction process(node) {\n\t\t\t\t\t\tvar nodeName, parentName, found, hasContentEditableState, lastContentEditable;\n\n\t\t\t\t\t\tlastContentEditable = contentEditable;\n\t\t\t\t\t\tnodeName = node.nodeName.toLowerCase();\n\t\t\t\t\t\tparentName = node.parentNode.nodeName.toLowerCase();\n\n\t\t\t\t\t\t// Node has a contentEditable value\n\t\t\t\t\t\tif (node.nodeType === 1 && getContentEditable(node)) {\n\t\t\t\t\t\t\tlastContentEditable = contentEditable;\n\t\t\t\t\t\t\tcontentEditable = getContentEditable(node) === \"true\";\n\t\t\t\t\t\t\thasContentEditableState = true; // We don't want to wrap the container only it's children\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Stop wrapping on br elements\n\t\t\t\t\t\tif (isEq(nodeName, 'br')) {\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\n\t\t\t\t\t\t\t// Remove any br elements when we wrap things\n\t\t\t\t\t\t\tif (format.block) {\n\t\t\t\t\t\t\t\tdom.remove(node);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// If node is wrapper type\n\t\t\t\t\t\tif (format.wrapper && matchNode(node, name, vars)) {\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Can we rename the block\n\t\t\t\t\t\t// TODO: Break this if up, too complex\n\t\t\t\t\t\tif (contentEditable && !hasContentEditableState && format.block &&\n\t\t\t\t\t\t\t!format.wrapper && isTextBlock(nodeName) && isValid(parentName, wrapName)) {\n\t\t\t\t\t\t\tnode = dom.rename(node, wrapName);\n\t\t\t\t\t\t\tsetElementFormat(node);\n\t\t\t\t\t\t\tnewWrappers.push(node);\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Handle selector patterns\n\t\t\t\t\t\tif (format.selector) {\n\t\t\t\t\t\t\t// Look for matching formats\n\t\t\t\t\t\t\teach(formatList, function(format) {\n\t\t\t\t\t\t\t\t// Check collapsed state if it exists\n\t\t\t\t\t\t\t\tif ('collapsed' in format && format.collapsed !== isCollapsed) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (dom.is(node, format.selector) && !isCaretNode(node)) {\n\t\t\t\t\t\t\t\t\tsetElementFormat(node, format);\n\t\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Continue processing if a selector match wasn't found and a inline element is defined\n\t\t\t\t\t\t\tif (!format.inline || found) {\n\t\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Is it valid to wrap this item\n\t\t\t\t\t\t// TODO: Break this if up, too complex\n\t\t\t\t\t\tif (contentEditable && !hasContentEditableState && isValid(wrapName, nodeName) && isValid(parentName, wrapName) &&\n\t\t\t\t\t\t\t\t!(!node_specific && node.nodeType === 3 &&\n\t\t\t\t\t\t\t\tnode.nodeValue.length === 1 &&\n\t\t\t\t\t\t\t\tnode.nodeValue.charCodeAt(0) === 65279) &&\n\t\t\t\t\t\t\t\t!isCaretNode(node) &&\n\t\t\t\t\t\t\t\t(!format.inline || !isBlock(node))) {\n\t\t\t\t\t\t\t// Start wrapping\n\t\t\t\t\t\t\tif (!currentWrapElm) {\n\t\t\t\t\t\t\t\t// Wrap the node\n\t\t\t\t\t\t\t\tcurrentWrapElm = dom.clone(wrapElm, FALSE);\n\t\t\t\t\t\t\t\tnode.parentNode.insertBefore(currentWrapElm, node);\n\t\t\t\t\t\t\t\tnewWrappers.push(currentWrapElm);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcurrentWrapElm.appendChild(node);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Start a new wrapper for possible children\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\n\t\t\t\t\t\t\teach(grep(node.childNodes), process);\n\n\t\t\t\t\t\t\tif (hasContentEditableState) {\n\t\t\t\t\t\t\t\tcontentEditable = lastContentEditable; // Restore last contentEditable state from stack\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// End the last wrapper\n\t\t\t\t\t\t\tcurrentWrapElm = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Process siblings from range\n\t\t\t\t\teach(nodes, process);\n\t\t\t\t});\n\n\t\t\t\t// Apply formats to links as well to get the color of the underline to change as well\n\t\t\t\tif (format.links === true) {\n\t\t\t\t\teach(newWrappers, function(node) {\n\t\t\t\t\t\tfunction process(node) {\n\t\t\t\t\t\t\tif (node.nodeName === 'A') {\n\t\t\t\t\t\t\t\tsetElementFormat(node, format);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\teach(grep(node.childNodes), process);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tprocess(node);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Cleanup\n\t\t\t\teach(newWrappers, function(node) {\n\t\t\t\t\tvar childCount;\n\n\t\t\t\t\tfunction getChildCount(node) {\n\t\t\t\t\t\tvar count = 0;\n\n\t\t\t\t\t\teach(node.childNodes, function(node) {\n\t\t\t\t\t\t\tif (!isWhiteSpaceNode(node) && !isBookmarkNode(node)) {\n\t\t\t\t\t\t\t\tcount++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn count;\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction mergeStyles(node) {\n\t\t\t\t\t\tvar child, clone;\n\n\t\t\t\t\t\teach(node.childNodes, function(node) {\n\t\t\t\t\t\t\tif (node.nodeType == 1 && !isBookmarkNode(node) && !isCaretNode(node)) {\n\t\t\t\t\t\t\t\tchild = node;\n\t\t\t\t\t\t\t\treturn FALSE; // break loop\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// If child was found and of the same type as the current node\n\t\t\t\t\t\tif (child && !isBookmarkNode(child) && matchName(child, format)) {\n\t\t\t\t\t\t\tclone = dom.clone(child, FALSE);\n\t\t\t\t\t\t\tsetElementFormat(clone);\n\n\t\t\t\t\t\t\tdom.replace(clone, node, TRUE);\n\t\t\t\t\t\t\tdom.remove(child, 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn clone || node;\n\t\t\t\t\t}\n\n\t\t\t\t\tchildCount = getChildCount(node);\n\n\t\t\t\t\t// Remove empty nodes but only if there is multiple wrappers and they are not block\n\t\t\t\t\t// elements so never remove single <h1></h1> since that would remove the\n\t\t\t\t\t// current empty block element where the caret is at\n\t\t\t\t\tif ((newWrappers.length > 1 || !isBlock(node)) && childCount === 0) {\n\t\t\t\t\t\tdom.remove(node, 1);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (format.inline || format.wrapper) {\n\t\t\t\t\t\t// Merges the current node with it's children of similar type to reduce the number of elements\n\t\t\t\t\t\tif (!format.exact && childCount === 1) {\n\t\t\t\t\t\t\tnode = mergeStyles(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Remove/merge children\n\t\t\t\t\t\teach(formatList, function(format) {\n\t\t\t\t\t\t\t// Merge all children of similar type will move styles from child to parent\n\t\t\t\t\t\t\t// this: <span style=\"color:red\"><b><span style=\"color:red; font-size:10px\">text</span></b></span>\n\t\t\t\t\t\t\t// will become: <span style=\"color:red\"><b><span style=\"font-size:10px\">text</span></b></span>\n\t\t\t\t\t\t\teach(dom.select(format.inline, node), function(child) {\n\t\t\t\t\t\t\t\tif (isBookmarkNode(child)) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tremoveFormat(format, vars, child, format.exact ? child : null);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove child if direct parent is of same type\n\t\t\t\t\t\tif (matchNode(node.parentNode, name, vars)) {\n\t\t\t\t\t\t\tdom.remove(node, 1);\n\t\t\t\t\t\t\tnode = 0;\n\t\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Look for parent with similar style format\n\t\t\t\t\t\tif (format.merge_with_parents) {\n\t\t\t\t\t\t\tdom.getParent(node.parentNode, function(parent) {\n\t\t\t\t\t\t\t\tif (matchNode(parent, name, vars)) {\n\t\t\t\t\t\t\t\t\tdom.remove(node, 1);\n\t\t\t\t\t\t\t\t\tnode = 0;\n\t\t\t\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Merge next and previous siblings if they are similar <b>text</b><b>text</b> becomes <b>texttext</b>\n\t\t\t\t\t\tif (node && format.merge_siblings !== false) {\n\t\t\t\t\t\t\tnode = mergeSiblings(getNonWhiteSpaceSibling(node), node);\n\t\t\t\t\t\t\tnode = mergeSiblings(node, getNonWhiteSpaceSibling(node, TRUE));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (getContentEditable(selection.getNode()) === \"false\") {\n\t\t\t\tnode = selection.getNode();\n\t\t\t\tfor (var i = 0, l = formatList.length; i < l; i++) {\n\t\t\t\t\tif (formatList[i].ceFalseOverride && dom.is(node, formatList[i].selector)) {\n\t\t\t\t\t\tsetElementFormat(node, formatList[i]);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (format) {\n\t\t\t\tif (node) {\n\t\t\t\t\tif (node.nodeType) {\n\t\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\t\trng.setEndAfter(node);\n\t\t\t\t\t\tapplyRngStyle(expandRng(rng, formatList), null, true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tapplyRngStyle(node, null, true);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (!isCollapsed || !format.inline || dom.select('td[data-mce-selected],th[data-mce-selected]').length) {\n\t\t\t\t\t\t// Obtain selection node before selection is unselected by applyRngStyle()\n\t\t\t\t\t\tvar curSelNode = ed.selection.getNode();\n\n\t\t\t\t\t\t// If the formats have a default block and we can't find a parent block then\n\t\t\t\t\t\t// start wrapping it with a DIV this is for forced_root_blocks: false\n\t\t\t\t\t\t// It's kind of a hack but people should be using the default block type P since all desktop editors work that way\n\t\t\t\t\t\tif (!forcedRootBlock && formatList[0].defaultBlock && !dom.getParent(curSelNode, dom.isBlock)) {\n\t\t\t\t\t\t\tapply(formatList[0].defaultBlock);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Apply formatting to selection\n\t\t\t\t\t\ted.selection.setRng(adjustSelectionToVisibleSelection());\n\t\t\t\t\t\tbookmark = selection.getBookmark();\n\t\t\t\t\t\tapplyRngStyle(expandRng(selection.getRng(TRUE), formatList), bookmark);\n\n\t\t\t\t\t\t// Colored nodes should be underlined so that the color of the underline matches the text color.\n\t\t\t\t\t\tif (format.styles && (format.styles.color || format.styles.textDecoration)) {\n\t\t\t\t\t\t\twalk(curSelNode, processUnderlineAndColor, 'childNodes');\n\t\t\t\t\t\t\tprocessUnderlineAndColor(curSelNode);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tselection.moveToBookmark(bookmark);\n\t\t\t\t\t\tmoveStart(selection.getRng(TRUE));\n\t\t\t\t\t\ted.nodeChanged();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tperformCaretAction('apply', name, vars);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tHooks.postProcess(name, ed);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Removes the specified format from the current selection or specified node.\n\t\t *\n\t\t * @method remove\n\t\t * @param {String} name Name of format to remove.\n\t\t * @param {Object} vars Optional list of variables to replace within format before removing it.\n\t\t * @param {Node/Range} node Optional node or DOM range to remove the format from defaults to current selection.\n\t\t */\n\t\tfunction remove(name, vars, node, similar) {\n\t\t\tvar formatList = get(name), format = formatList[0], bookmark, rng, contentEditable = true;\n\n\t\t\t// Merges the styles for each node\n\t\t\tfunction process(node) {\n\t\t\t\tvar children, i, l, lastContentEditable, hasContentEditableState;\n\n\t\t\t\t// Node has a contentEditable value\n\t\t\t\tif (node.nodeType === 1 && getContentEditable(node)) {\n\t\t\t\t\tlastContentEditable = contentEditable;\n\t\t\t\t\tcontentEditable = getContentEditable(node) === \"true\";\n\t\t\t\t\thasContentEditableState = true; // We don't want to wrap the container only it's children\n\t\t\t\t}\n\n\t\t\t\t// Grab the children first since the nodelist might be changed\n\t\t\t\tchildren = grep(node.childNodes);\n\n\t\t\t\t// Process current node\n\t\t\t\tif (contentEditable && !hasContentEditableState) {\n\t\t\t\t\tfor (i = 0, l = formatList.length; i < l; i++) {\n\t\t\t\t\t\tif (removeFormat(formatList[i], vars, node, node)) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Process the children\n\t\t\t\tif (format.deep) {\n\t\t\t\t\tif (children.length) {\n\t\t\t\t\t\tfor (i = 0, l = children.length; i < l; i++) {\n\t\t\t\t\t\t\tprocess(children[i]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (hasContentEditableState) {\n\t\t\t\t\t\t\tcontentEditable = lastContentEditable; // Restore last contentEditable state from stack\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction findFormatRoot(container) {\n\t\t\t\tvar formatRoot;\n\n\t\t\t\t// Find format root\n\t\t\t\teach(getParents(container.parentNode).reverse(), function(parent) {\n\t\t\t\t\tvar format;\n\n\t\t\t\t\t// Find format root element\n\t\t\t\t\tif (!formatRoot && parent.id != '_start' && parent.id != '_end') {\n\t\t\t\t\t\t// Is the node matching the format we are looking for\n\t\t\t\t\t\tformat = matchNode(parent, name, vars, similar);\n\t\t\t\t\t\tif (format && format.split !== false) {\n\t\t\t\t\t\t\tformatRoot = parent;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn formatRoot;\n\t\t\t}\n\n\t\t\tfunction wrapAndSplit(formatRoot, container, target, split) {\n\t\t\t\tvar parent, clone, lastClone, firstClone, i, formatRootParent;\n\n\t\t\t\t// Format root found then clone formats and split it\n\t\t\t\tif (formatRoot) {\n\t\t\t\t\tformatRootParent = formatRoot.parentNode;\n\n\t\t\t\t\tfor (parent = container.parentNode; parent && parent != formatRootParent; parent = parent.parentNode) {\n\t\t\t\t\t\tclone = dom.clone(parent, FALSE);\n\n\t\t\t\t\t\tfor (i = 0; i < formatList.length; i++) {\n\t\t\t\t\t\t\tif (removeFormat(formatList[i], vars, clone, clone)) {\n\t\t\t\t\t\t\t\tclone = 0;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Build wrapper node\n\t\t\t\t\t\tif (clone) {\n\t\t\t\t\t\t\tif (lastClone) {\n\t\t\t\t\t\t\t\tclone.appendChild(lastClone);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!firstClone) {\n\t\t\t\t\t\t\t\tfirstClone = clone;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlastClone = clone;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Never split block elements if the format is mixed\n\t\t\t\t\tif (split && (!format.mixed || !isBlock(formatRoot))) {\n\t\t\t\t\t\tcontainer = dom.split(formatRoot, container);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Wrap container in cloned formats\n\t\t\t\t\tif (lastClone) {\n\t\t\t\t\t\ttarget.parentNode.insertBefore(lastClone, target);\n\t\t\t\t\t\tfirstClone.appendChild(target);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tfunction splitToFormatRoot(container) {\n\t\t\t\treturn wrapAndSplit(findFormatRoot(container), container, container, true);\n\t\t\t}\n\n\t\t\tfunction unwrap(start) {\n\t\t\t\tvar node = dom.get(start ? '_start' : '_end'),\n\t\t\t\t\tout = node[start ? 'firstChild' : 'lastChild'];\n\n\t\t\t\t// If the end is placed within the start the result will be removed\n\t\t\t\t// So this checks if the out node is a bookmark node if it is it\n\t\t\t\t// checks for another more suitable node\n\t\t\t\tif (isBookmarkNode(out)) {\n\t\t\t\t\tout = out[start ? 'firstChild' : 'lastChild'];\n\t\t\t\t}\n\n\t\t\t\t// Since dom.remove removes empty text nodes then we need to try to find a better node\n\t\t\t\tif (out.nodeType == 3 && out.data.length === 0) {\n\t\t\t\t\tout = start ? node.previousSibling || node.nextSibling : node.nextSibling || node.previousSibling;\n\t\t\t\t}\n\n\t\t\t\tdom.remove(node, true);\n\n\t\t\t\treturn out;\n\t\t\t}\n\n\t\t\tfunction removeRngStyle(rng) {\n\t\t\t\tvar startContainer, endContainer;\n\t\t\t\tvar commonAncestorContainer = rng.commonAncestorContainer;\n\n\t\t\t\trng = expandRng(rng, formatList, TRUE);\n\n\t\t\t\tif (format.split) {\n\t\t\t\t\tstartContainer = getContainer(rng, TRUE);\n\t\t\t\t\tendContainer = getContainer(rng);\n\n\t\t\t\t\tif (startContainer != endContainer) {\n\t\t\t\t\t\t// WebKit will render the table incorrectly if we wrap a TH or TD in a SPAN\n\t\t\t\t\t\t// so let's see if we can use the first child instead\n\t\t\t\t\t\t// This will happen if you triple click a table cell and use remove formatting\n\t\t\t\t\t\tif (/^(TR|TH|TD)$/.test(startContainer.nodeName) && startContainer.firstChild) {\n\t\t\t\t\t\t\tif (startContainer.nodeName == \"TR\") {\n\t\t\t\t\t\t\t\tstartContainer = startContainer.firstChild.firstChild || startContainer;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tstartContainer = startContainer.firstChild || startContainer;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Try to adjust endContainer as well if cells on the same row were selected - bug #6410\n\t\t\t\t\t\tif (commonAncestorContainer &&\n\t\t\t\t\t\t\t/^T(HEAD|BODY|FOOT|R)$/.test(commonAncestorContainer.nodeName) &&\n\t\t\t\t\t\t\tisTableCell(endContainer) && endContainer.firstChild) {\n\t\t\t\t\t\t\tendContainer = endContainer.firstChild || endContainer;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (dom.isChildOf(startContainer, endContainer) && !isBlock(endContainer) &&\n\t\t\t\t\t\t\t!isTableCell(startContainer) && !isTableCell(endContainer)) {\n\t\t\t\t\t\t\tstartContainer = wrap(startContainer, 'span', {id: '_start', 'data-mce-type': 'bookmark'});\n\t\t\t\t\t\t\tsplitToFormatRoot(startContainer);\n\t\t\t\t\t\t\tstartContainer = unwrap(TRUE);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Wrap start/end nodes in span element since these might be cloned/moved\n\t\t\t\t\t\tstartContainer = wrap(startContainer, 'span', {id: '_start', 'data-mce-type': 'bookmark'});\n\t\t\t\t\t\tendContainer = wrap(endContainer, 'span', {id: '_end', 'data-mce-type': 'bookmark'});\n\n\t\t\t\t\t\t// Split start/end\n\t\t\t\t\t\tsplitToFormatRoot(startContainer);\n\t\t\t\t\t\tsplitToFormatRoot(endContainer);\n\n\t\t\t\t\t\t// Unwrap start/end to get real elements again\n\t\t\t\t\t\tstartContainer = unwrap(TRUE);\n\t\t\t\t\t\tendContainer = unwrap();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstartContainer = endContainer = splitToFormatRoot(startContainer);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Update range positions since they might have changed after the split operations\n\t\t\t\t\trng.startContainer = startContainer.parentNode ? startContainer.parentNode : startContainer;\n\t\t\t\t\trng.startOffset = nodeIndex(startContainer);\n\t\t\t\t\trng.endContainer = endContainer.parentNode ? endContainer.parentNode : endContainer;\n\t\t\t\t\trng.endOffset = nodeIndex(endContainer) + 1;\n\t\t\t\t}\n\n\t\t\t\t// Remove items between start/end\n\t\t\t\trangeUtils.walk(rng, function(nodes) {\n\t\t\t\t\teach(nodes, function(node) {\n\t\t\t\t\t\tprocess(node);\n\n\t\t\t\t\t\t// Remove parent span if it only contains text-decoration: underline, yet a parent node is also underlined.\n\t\t\t\t\t\tif (node.nodeType === 1 && ed.dom.getStyle(node, 'text-decoration') === 'underline' &&\n\t\t\t\t\t\t\tnode.parentNode && getTextDecoration(node.parentNode) === 'underline') {\n\t\t\t\t\t\t\tremoveFormat({\n\t\t\t\t\t\t\t\t'deep': false,\n\t\t\t\t\t\t\t\t'exact': true,\n\t\t\t\t\t\t\t\t'inline': 'span',\n\t\t\t\t\t\t\t\t'styles': {\n\t\t\t\t\t\t\t\t\t'textDecoration': 'underline'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, null, node);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Handle node\n\t\t\tif (node) {\n\t\t\t\tif (node.nodeType) {\n\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\trng.setEndAfter(node);\n\t\t\t\t\tremoveRngStyle(rng);\n\t\t\t\t} else {\n\t\t\t\t\tremoveRngStyle(node);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (getContentEditable(selection.getNode()) === \"false\") {\n\t\t\t\tnode = selection.getNode();\n\t\t\t\tfor (var i = 0, l = formatList.length; i < l; i++) {\n\t\t\t\t\tif (formatList[i].ceFalseOverride) {\n\t\t\t\t\t\tif (removeFormat(formatList[i], vars, node, node)) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!selection.isCollapsed() || !format.inline || dom.select('td[data-mce-selected],th[data-mce-selected]').length) {\n\t\t\t\tbookmark = selection.getBookmark();\n\t\t\t\tremoveRngStyle(selection.getRng(TRUE));\n\t\t\t\tselection.moveToBookmark(bookmark);\n\n\t\t\t\t// Check if start element still has formatting then we are at: \"<b>text|</b>text\"\n\t\t\t\t// and need to move the start into the next text node\n\t\t\t\tif (format.inline && match(name, vars, selection.getStart())) {\n\t\t\t\t\tmoveStart(selection.getRng(true));\n\t\t\t\t}\n\n\t\t\t\ted.nodeChanged();\n\t\t\t} else {\n\t\t\t\tperformCaretAction('remove', name, vars, similar);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Toggles the specified format on/off.\n\t\t *\n\t\t * @method toggle\n\t\t * @param {String} name Name of format to apply/remove.\n\t\t * @param {Object} vars Optional list of variables to replace within format before applying/removing it.\n\t\t * @param {Node} node Optional node to apply the format to or remove from. Defaults to current selection.\n\t\t */\n\t\tfunction toggle(name, vars, node) {\n\t\t\tvar fmt = get(name);\n\n\t\t\tif (match(name, vars, node) && (!('toggle' in fmt[0]) || fmt[0].toggle)) {\n\t\t\t\tremove(name, vars, node);\n\t\t\t} else {\n\t\t\t\tapply(name, vars, node);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Return true/false if the specified node has the specified format.\n\t\t *\n\t\t * @method matchNode\n\t\t * @param {Node} node Node to check the format on.\n\t\t * @param {String} name Format name to check.\n\t\t * @param {Object} vars Optional list of variables to replace before checking it.\n\t\t * @param {Boolean} similar Match format that has similar properties.\n\t\t * @return {Object} Returns the format object it matches or undefined if it doesn't match.\n\t\t */\n\t\tfunction matchNode(node, name, vars, similar) {\n\t\t\tvar formatList = get(name), format, i, classes;\n\n\t\t\tfunction matchItems(node, format, item_name) {\n\t\t\t\tvar key, value, items = format[item_name], i;\n\n\t\t\t\t// Custom match\n\t\t\t\tif (format.onmatch) {\n\t\t\t\t\treturn format.onmatch(node, format, item_name);\n\t\t\t\t}\n\n\t\t\t\t// Check all items\n\t\t\t\tif (items) {\n\t\t\t\t\t// Non indexed object\n\t\t\t\t\tif (items.length === undef) {\n\t\t\t\t\t\tfor (key in items) {\n\t\t\t\t\t\t\tif (items.hasOwnProperty(key)) {\n\t\t\t\t\t\t\t\tif (item_name === 'attributes') {\n\t\t\t\t\t\t\t\t\tvalue = dom.getAttrib(node, key);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tvalue = getStyle(node, key);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (similar && !value && !format.exact) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ((!similar || format.exact) && !isEq(value, normalizeStyleValue(replaceVars(items[key], vars), key))) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Only one match needed for indexed arrays\n\t\t\t\t\t\tfor (i = 0; i < items.length; i++) {\n\t\t\t\t\t\t\tif (item_name === 'attributes' ? dom.getAttrib(node, items[i]) : getStyle(node, items[i])) {\n\t\t\t\t\t\t\t\treturn format;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn format;\n\t\t\t}\n\n\t\t\tif (formatList && node) {\n\t\t\t\t// Check each format in list\n\t\t\t\tfor (i = 0; i < formatList.length; i++) {\n\t\t\t\t\tformat = formatList[i];\n\n\t\t\t\t\t// Name name, attributes, styles and classes\n\t\t\t\t\tif (matchName(node, format) && matchItems(node, format, 'attributes') && matchItems(node, format, 'styles')) {\n\t\t\t\t\t\t// Match classes\n\t\t\t\t\t\tif ((classes = format.classes)) {\n\t\t\t\t\t\t\tfor (i = 0; i < classes.length; i++) {\n\t\t\t\t\t\t\t\tif (!dom.hasClass(node, classes[i])) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn format;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Matches the current selection or specified node against the specified format name.\n\t\t *\n\t\t * @method match\n\t\t * @param {String} name Name of format to match.\n\t\t * @param {Object} vars Optional list of variables to replace before checking it.\n\t\t * @param {Node} node Optional node to check.\n\t\t * @return {boolean} true/false if the specified selection/node matches the format.\n\t\t */\n\t\tfunction match(name, vars, node) {\n\t\t\tvar startNode;\n\n\t\t\tfunction matchParents(node) {\n\t\t\t\tvar root = dom.getRoot();\n\n\t\t\t\tif (node === root) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Find first node with similar format settings\n\t\t\t\tnode = dom.getParent(node, function(node) {\n\t\t\t\t\tif (matchesUnInheritedFormatSelector(node, name)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node.parentNode === root || !!matchNode(node, name, vars, true);\n\t\t\t\t});\n\n\t\t\t\t// Do an exact check on the similar format element\n\t\t\t\treturn matchNode(node, name, vars);\n\t\t\t}\n\n\t\t\t// Check specified node\n\t\t\tif (node) {\n\t\t\t\treturn matchParents(node);\n\t\t\t}\n\n\t\t\t// Check selected node\n\t\t\tnode = selection.getNode();\n\t\t\tif (matchParents(node)) {\n\t\t\t\treturn TRUE;\n\t\t\t}\n\n\t\t\t// Check start node if it's different\n\t\t\tstartNode = selection.getStart();\n\t\t\tif (startNode != node) {\n\t\t\t\tif (matchParents(startNode)) {\n\t\t\t\t\treturn TRUE;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn FALSE;\n\t\t}\n\n\t\t/**\n\t\t * Matches the current selection against the array of formats and returns a new array with matching formats.\n\t\t *\n\t\t * @method matchAll\n\t\t * @param {Array} names Name of format to match.\n\t\t * @param {Object} vars Optional list of variables to replace before checking it.\n\t\t * @return {Array} Array with matched formats.\n\t\t */\n\t\tfunction matchAll(names, vars) {\n\t\t\tvar startElement, matchedFormatNames = [], checkedMap = {};\n\n\t\t\t// Check start of selection for formats\n\t\t\tstartElement = selection.getStart();\n\t\t\tdom.getParent(startElement, function(node) {\n\t\t\t\tvar i, name;\n\n\t\t\t\tfor (i = 0; i < names.length; i++) {\n\t\t\t\t\tname = names[i];\n\n\t\t\t\t\tif (!checkedMap[name] && matchNode(node, name, vars)) {\n\t\t\t\t\t\tcheckedMap[name] = true;\n\t\t\t\t\t\tmatchedFormatNames.push(name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, dom.getRoot());\n\n\t\t\treturn matchedFormatNames;\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if the specified format can be applied to the current selection or not. It\n\t\t * will currently only check the state for selector formats, it returns true on all other format types.\n\t\t *\n\t\t * @method canApply\n\t\t * @param {String} name Name of format to check.\n\t\t * @return {boolean} true/false if the specified format can be applied to the current selection/node.\n\t\t */\n\t\tfunction canApply(name) {\n\t\t\tvar formatList = get(name), startNode, parents, i, x, selector;\n\n\t\t\tif (formatList) {\n\t\t\t\tstartNode = selection.getStart();\n\t\t\t\tparents = getParents(startNode);\n\n\t\t\t\tfor (x = formatList.length - 1; x >= 0; x--) {\n\t\t\t\t\tselector = formatList[x].selector;\n\n\t\t\t\t\t// Format is not selector based then always return TRUE\n\t\t\t\t\t// Is it has a defaultBlock then it's likely it can be applied for example align on a non block element line\n\t\t\t\t\tif (!selector || formatList[x].defaultBlock) {\n\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (i = parents.length - 1; i >= 0; i--) {\n\t\t\t\t\t\tif (dom.is(parents[i], selector)) {\n\t\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn FALSE;\n\t\t}\n\n\t\t/**\n\t\t * Executes the specified callback when the current selection matches the formats or not.\n\t\t *\n\t\t * @method formatChanged\n\t\t * @param {String} formats Comma separated list of formats to check for.\n\t\t * @param {function} callback Callback with state and args when the format is changed/toggled on/off.\n\t\t * @param {Boolean} similar True/false state if the match should handle similar or exact formats.\n\t\t */\n\t\tfunction formatChanged(formats, callback, similar) {\n\t\t\tvar currentFormats;\n\n\t\t\t// Setup format node change logic\n\t\t\tif (!formatChangeData) {\n\t\t\t\tformatChangeData = {};\n\t\t\t\tcurrentFormats = {};\n\n\t\t\t\ted.on('NodeChange', function(e) {\n\t\t\t\t\tvar parents = getParents(e.element), matchedFormats = {};\n\n\t\t\t\t\t// Ignore bogus nodes like the <a> tag created by moveStart()\n\t\t\t\t\tparents = Tools.grep(parents, function(node) {\n\t\t\t\t\t\treturn node.nodeType == 1 && !node.getAttribute('data-mce-bogus');\n\t\t\t\t\t});\n\n\t\t\t\t\t// Check for new formats\n\t\t\t\t\teach(formatChangeData, function(callbacks, format) {\n\t\t\t\t\t\teach(parents, function(node) {\n\t\t\t\t\t\t\tif (matchNode(node, format, {}, callbacks.similar)) {\n\t\t\t\t\t\t\t\tif (!currentFormats[format]) {\n\t\t\t\t\t\t\t\t\t// Execute callbacks\n\t\t\t\t\t\t\t\t\teach(callbacks, function(callback) {\n\t\t\t\t\t\t\t\t\t\tcallback(true, {node: node, format: format, parents: parents});\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tcurrentFormats[format] = callbacks;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tmatchedFormats[format] = callbacks;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (matchesUnInheritedFormatSelector(node, format)) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t// Check if current formats still match\n\t\t\t\t\teach(currentFormats, function(callbacks, format) {\n\t\t\t\t\t\tif (!matchedFormats[format]) {\n\t\t\t\t\t\t\tdelete currentFormats[format];\n\n\t\t\t\t\t\t\teach(callbacks, function(callback) {\n\t\t\t\t\t\t\t\tcallback(false, {node: e.element, format: format, parents: parents});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Add format listeners\n\t\t\teach(formats.split(','), function(format) {\n\t\t\t\tif (!formatChangeData[format]) {\n\t\t\t\t\tformatChangeData[format] = [];\n\t\t\t\t\tformatChangeData[format].similar = similar;\n\t\t\t\t}\n\n\t\t\t\tformatChangeData[format].push(callback);\n\t\t\t});\n\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Returns a preview css text for the specified format.\n\t\t *\n\t\t * @method getCssText\n\t\t * @param {String/Object} format Format to generate preview css text for.\n\t\t * @return {String} Css text for the specified format.\n\t\t * @example\n\t\t * var cssText1 = editor.formatter.getCssText('bold');\n\t\t * var cssText2 = editor.formatter.getCssText({inline: 'b'});\n\t\t */\n\t\tfunction getCssText(format) {\n\t\t\treturn Preview.getCssText(ed, format);\n\t\t}\n\n\t\t// Expose to public\n\t\textend(this, {\n\t\t\tget: get,\n\t\t\tregister: register,\n\t\t\tunregister: unregister,\n\t\t\tapply: apply,\n\t\t\tremove: remove,\n\t\t\ttoggle: toggle,\n\t\t\tmatch: match,\n\t\t\tmatchAll: matchAll,\n\t\t\tmatchNode: matchNode,\n\t\t\tcanApply: canApply,\n\t\t\tformatChanged: formatChanged,\n\t\t\tgetCssText: getCssText\n\t\t});\n\n\t\t// Initialize\n\t\tdefaultFormats();\n\t\taddKeyboardShortcuts();\n\t\ted.on('BeforeGetContent', function(e) {\n\t\t\tif (markCaretContainersBogus && e.format != 'raw') {\n\t\t\t\tmarkCaretContainersBogus();\n\t\t\t}\n\t\t});\n\t\ted.on('mouseup keydown', function(e) {\n\t\t\tif (disableCaretContainer) {\n\t\t\t\tdisableCaretContainer(e);\n\t\t\t}\n\t\t});\n\n\t\t// Private functions\n\n\t\t/**\n\t\t * Checks if the specified nodes name matches the format inline/block or selector.\n\t\t *\n\t\t * @private\n\t\t * @param {Node} node Node to match against the specified format.\n\t\t * @param {Object} format Format object o match with.\n\t\t * @return {boolean} true/false if the format matches.\n\t\t */\n\t\tfunction matchName(node, format) {\n\t\t\t// Check for inline match\n\t\t\tif (isEq(node, format.inline)) {\n\t\t\t\treturn TRUE;\n\t\t\t}\n\n\t\t\t// Check for block match\n\t\t\tif (isEq(node, format.block)) {\n\t\t\t\treturn TRUE;\n\t\t\t}\n\n\t\t\t// Check for selector match\n\t\t\tif (format.selector) {\n\t\t\t\treturn node.nodeType == 1 && dom.is(node, format.selector);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Compares two string/nodes regardless of their case.\n\t\t *\n\t\t * @private\n\t\t * @param {String/Node} str1 Node or string to compare.\n\t\t * @param {String/Node} str2 Node or string to compare.\n\t\t * @return {boolean} True/false if they match.\n\t\t */\n\t\tfunction isEq(str1, str2) {\n\t\t\tstr1 = str1 || '';\n\t\t\tstr2 = str2 || '';\n\n\t\t\tstr1 = '' + (str1.nodeName || str1);\n\t\t\tstr2 = '' + (str2.nodeName || str2);\n\n\t\t\treturn str1.toLowerCase() == str2.toLowerCase();\n\t\t}\n\n\t\t/**\n\t\t * Returns the style by name on the specified node. This method modifies the style\n\t\t * contents to make it more easy to match. This will resolve a few browser issues.\n\t\t *\n\t\t * @private\n\t\t * @param {Node} node to get style from.\n\t\t * @param {String} name Style name to get.\n\t\t * @return {String} Style item value.\n\t\t */\n\t\tfunction getStyle(node, name) {\n\t\t\treturn normalizeStyleValue(dom.getStyle(node, name), name);\n\t\t}\n\n\t\t/**\n\t\t * Normalize style value by name. This method modifies the style contents\n\t\t * to make it more easy to match. This will resolve a few browser issues.\n\t\t *\n\t\t * @private\n\t\t * @param {String} value Value to get style from.\n\t\t * @param {String} name Style name to get.\n\t\t * @return {String} Style item value.\n\t\t */\n\t\tfunction normalizeStyleValue(value, name) {\n\t\t\t// Force the format to hex\n\t\t\tif (name == 'color' || name == 'backgroundColor') {\n\t\t\t\tvalue = dom.toHex(value);\n\t\t\t}\n\n\t\t\t// Opera will return bold as 700\n\t\t\tif (name == 'fontWeight' && value == 700) {\n\t\t\t\tvalue = 'bold';\n\t\t\t}\n\n\t\t\t// Normalize fontFamily so \"'Font name', Font\" becomes: \"Font name,Font\"\n\t\t\tif (name == 'fontFamily') {\n\t\t\t\tvalue = value.replace(/[\\'\\\"]/g, '').replace(/,\\s+/g, ',');\n\t\t\t}\n\n\t\t\treturn '' + value;\n\t\t}\n\n\t\t/**\n\t\t * Replaces variables in the value. The variable format is %var.\n\t\t *\n\t\t * @private\n\t\t * @param {String} value Value to replace variables in.\n\t\t * @param {Object} vars Name/value array with variables to replace.\n\t\t * @return {String} New value with replaced variables.\n\t\t */\n\t\tfunction replaceVars(value, vars) {\n\t\t\tif (typeof value != \"string\") {\n\t\t\t\tvalue = value(vars);\n\t\t\t} else if (vars) {\n\t\t\t\tvalue = value.replace(/%(\\w+)/g, function(str, name) {\n\t\t\t\t\treturn vars[name] || str;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction isWhiteSpaceNode(node) {\n\t\t\treturn node && node.nodeType === 3 && /^([\\t \\r\\n]+|)$/.test(node.nodeValue);\n\t\t}\n\n\t\tfunction wrap(node, name, attrs) {\n\t\t\tvar wrapper = dom.create(name, attrs);\n\n\t\t\tnode.parentNode.insertBefore(wrapper, node);\n\t\t\twrapper.appendChild(node);\n\n\t\t\treturn wrapper;\n\t\t}\n\n\t\t/**\n\t\t * Expands the specified range like object to depending on format.\n\t\t *\n\t\t * For example on block formats it will move the start/end position\n\t\t * to the beginning of the current block.\n\t\t *\n\t\t * @private\n\t\t * @param {Object} rng Range like object.\n\t\t * @param {Array} format Array with formats to expand by.\n\t\t * @param {Boolean} remove\n\t\t * @return {Object} Expanded range like object.\n\t\t */\n\t\tfunction expandRng(rng, format, remove) {\n\t\t\tvar lastIdx, leaf, endPoint,\n\t\t\t\tstartContainer = rng.startContainer,\n\t\t\t\tstartOffset = rng.startOffset,\n\t\t\t\tendContainer = rng.endContainer,\n\t\t\t\tendOffset = rng.endOffset;\n\n\t\t\t// This function walks up the tree if there is no siblings before/after the node\n\t\t\tfunction findParentContainer(start) {\n\t\t\t\tvar container, parent, sibling, siblingName, root;\n\n\t\t\t\tcontainer = parent = start ? startContainer : endContainer;\n\t\t\t\tsiblingName = start ? 'previousSibling' : 'nextSibling';\n\t\t\t\troot = dom.getRoot();\n\n\t\t\t\tfunction isBogusBr(node) {\n\t\t\t\t\treturn node.nodeName == \"BR\" && node.getAttribute('data-mce-bogus') && !node.nextSibling;\n\t\t\t\t}\n\n\t\t\t\t// If it's a text node and the offset is inside the text\n\t\t\t\tif (container.nodeType == 3 && !isWhiteSpaceNode(container)) {\n\t\t\t\t\tif (start ? startOffset > 0 : endOffset < container.nodeValue.length) {\n\t\t\t\t\t\treturn container;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/*eslint no-constant-condition:0 */\n\t\t\t\twhile (true) {\n\t\t\t\t\t// Stop expanding on block elements\n\t\t\t\t\tif (!format[0].block_expand && isBlock(parent)) {\n\t\t\t\t\t\treturn parent;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Walk left/right\n\t\t\t\t\tfor (sibling = parent[siblingName]; sibling; sibling = sibling[siblingName]) {\n\t\t\t\t\t\tif (!isBookmarkNode(sibling) && !isWhiteSpaceNode(sibling) && !isBogusBr(sibling)) {\n\t\t\t\t\t\t\treturn parent;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Check if we can move up are we at root level or body level\n\t\t\t\t\tif (parent == root || parent.parentNode == root) {\n\t\t\t\t\t\tcontainer = parent;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\t// This function walks down the tree to find the leaf at the selection.\n\t\t\t// The offset is also returned as if node initially a leaf, the offset may be in the middle of the text node.\n\t\t\tfunction findLeaf(node, offset) {\n\t\t\t\tif (offset === undef) {\n\t\t\t\t\toffset = node.nodeType === 3 ? node.length : node.childNodes.length;\n\t\t\t\t}\n\n\t\t\t\twhile (node && node.hasChildNodes()) {\n\t\t\t\t\tnode = node.childNodes[offset];\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\toffset = node.nodeType === 3 ? node.length : node.childNodes.length;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn {node: node, offset: offset};\n\t\t\t}\n\n\t\t\t// If index based start position then resolve it\n\t\t\tif (startContainer.nodeType == 1 && startContainer.hasChildNodes()) {\n\t\t\t\tlastIdx = startContainer.childNodes.length - 1;\n\t\t\t\tstartContainer = startContainer.childNodes[startOffset > lastIdx ? lastIdx : startOffset];\n\n\t\t\t\tif (startContainer.nodeType == 3) {\n\t\t\t\t\tstartOffset = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If index based end position then resolve it\n\t\t\tif (endContainer.nodeType == 1 && endContainer.hasChildNodes()) {\n\t\t\t\tlastIdx = endContainer.childNodes.length - 1;\n\t\t\t\tendContainer = endContainer.childNodes[endOffset > lastIdx ? lastIdx : endOffset - 1];\n\n\t\t\t\tif (endContainer.nodeType == 3) {\n\t\t\t\t\tendOffset = endContainer.nodeValue.length;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Expands the node to the closes contentEditable false element if it exists\n\t\t\tfunction findParentContentEditable(node) {\n\t\t\t\tvar parent = node;\n\n\t\t\t\twhile (parent) {\n\t\t\t\t\tif (parent.nodeType === 1 && getContentEditable(parent)) {\n\t\t\t\t\t\treturn getContentEditable(parent) === \"false\" ? parent : node;\n\t\t\t\t\t}\n\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tfunction findWordEndPoint(container, offset, start) {\n\t\t\t\tvar walker, node, pos, lastTextNode;\n\n\t\t\t\tfunction findSpace(node, offset) {\n\t\t\t\t\tvar pos, pos2, str = node.nodeValue;\n\n\t\t\t\t\tif (typeof offset == \"undefined\") {\n\t\t\t\t\t\toffset = start ? str.length : 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\tpos = str.lastIndexOf(' ', offset);\n\t\t\t\t\t\tpos2 = str.lastIndexOf('\\u00a0', offset);\n\t\t\t\t\t\tpos = pos > pos2 ? pos : pos2;\n\n\t\t\t\t\t\t// Include the space on remove to avoid tag soup\n\t\t\t\t\t\tif (pos !== -1 && !remove) {\n\t\t\t\t\t\t\tpos++;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpos = str.indexOf(' ', offset);\n\t\t\t\t\t\tpos2 = str.indexOf('\\u00a0', offset);\n\t\t\t\t\t\tpos = pos !== -1 && (pos2 === -1 || pos < pos2) ? pos : pos2;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn pos;\n\t\t\t\t}\n\n\t\t\t\tif (container.nodeType === 3) {\n\t\t\t\t\tpos = findSpace(container, offset);\n\n\t\t\t\t\tif (pos !== -1) {\n\t\t\t\t\t\treturn {container: container, offset: pos};\n\t\t\t\t\t}\n\n\t\t\t\t\tlastTextNode = container;\n\t\t\t\t}\n\n\t\t\t\t// Walk the nodes inside the block\n\t\t\t\twalker = new TreeWalker(container, dom.getParent(container, isBlock) || ed.getBody());\n\t\t\t\twhile ((node = walker[start ? 'prev' : 'next']())) {\n\t\t\t\t\tif (node.nodeType === 3) {\n\t\t\t\t\t\tlastTextNode = node;\n\t\t\t\t\t\tpos = findSpace(node);\n\n\t\t\t\t\t\tif (pos !== -1) {\n\t\t\t\t\t\t\treturn {container: node, offset: pos};\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (isBlock(node)) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (lastTextNode) {\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\toffset = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toffset = lastTextNode.length;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {container: lastTextNode, offset: offset};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction findSelectorEndPoint(container, sibling_name) {\n\t\t\t\tvar parents, i, y, curFormat;\n\n\t\t\t\tif (container.nodeType == 3 && container.nodeValue.length === 0 && container[sibling_name]) {\n\t\t\t\t\tcontainer = container[sibling_name];\n\t\t\t\t}\n\n\t\t\t\tparents = getParents(container);\n\t\t\t\tfor (i = 0; i < parents.length; i++) {\n\t\t\t\t\tfor (y = 0; y < format.length; y++) {\n\t\t\t\t\t\tcurFormat = format[y];\n\n\t\t\t\t\t\t// If collapsed state is set then skip formats that doesn't match that\n\t\t\t\t\t\tif (\"collapsed\" in curFormat && curFormat.collapsed !== rng.collapsed) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (dom.is(parents[i], curFormat.selector)) {\n\t\t\t\t\t\t\treturn parents[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\tfunction findBlockEndPoint(container, sibling_name) {\n\t\t\t\tvar node, root = dom.getRoot();\n\n\t\t\t\t// Expand to block of similar type\n\t\t\t\tif (!format[0].wrapper) {\n\t\t\t\t\tnode = dom.getParent(container, format[0].block, root);\n\t\t\t\t}\n\n\t\t\t\t// Expand to first wrappable block element or any block element\n\t\t\t\tif (!node) {\n\t\t\t\t\tnode = dom.getParent(container.nodeType == 3 ? container.parentNode : container, function(node) {\n\t\t\t\t\t\t// Fixes #6183 where it would expand to editable parent element in inline mode\n\t\t\t\t\t\treturn node != root && isTextBlock(node);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Exclude inner lists from wrapping\n\t\t\t\tif (node && format[0].wrapper) {\n\t\t\t\t\tnode = getParents(node, 'ul,ol').reverse()[0] || node;\n\t\t\t\t}\n\n\t\t\t\t// Didn't find a block element look for first/last wrappable element\n\t\t\t\tif (!node) {\n\t\t\t\t\tnode = container;\n\n\t\t\t\t\twhile (node[sibling_name] && !isBlock(node[sibling_name])) {\n\t\t\t\t\t\tnode = node[sibling_name];\n\n\t\t\t\t\t\t// Break on BR but include it will be removed later on\n\t\t\t\t\t\t// we can't remove it now since we need to check if it can be wrapped\n\t\t\t\t\t\tif (isEq(node, 'br')) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node || container;\n\t\t\t}\n\n\t\t\t// Expand to closest contentEditable element\n\t\t\tstartContainer = findParentContentEditable(startContainer);\n\t\t\tendContainer = findParentContentEditable(endContainer);\n\n\t\t\t// Exclude bookmark nodes if possible\n\t\t\tif (isBookmarkNode(startContainer.parentNode) || isBookmarkNode(startContainer)) {\n\t\t\t\tstartContainer = isBookmarkNode(startContainer) ? startContainer : startContainer.parentNode;\n\t\t\t\tstartContainer = startContainer.nextSibling || startContainer;\n\n\t\t\t\tif (startContainer.nodeType == 3) {\n\t\t\t\t\tstartOffset = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (isBookmarkNode(endContainer.parentNode) || isBookmarkNode(endContainer)) {\n\t\t\t\tendContainer = isBookmarkNode(endContainer) ? endContainer : endContainer.parentNode;\n\t\t\t\tendContainer = endContainer.previousSibling || endContainer;\n\n\t\t\t\tif (endContainer.nodeType == 3) {\n\t\t\t\t\tendOffset = endContainer.length;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (format[0].inline) {\n\t\t\t\tif (rng.collapsed) {\n\t\t\t\t\t// Expand left to closest word boundary\n\t\t\t\t\tendPoint = findWordEndPoint(startContainer, startOffset, true);\n\t\t\t\t\tif (endPoint) {\n\t\t\t\t\t\tstartContainer = endPoint.container;\n\t\t\t\t\t\tstartOffset = endPoint.offset;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Expand right to closest word boundary\n\t\t\t\t\tendPoint = findWordEndPoint(endContainer, endOffset);\n\t\t\t\t\tif (endPoint) {\n\t\t\t\t\t\tendContainer = endPoint.container;\n\t\t\t\t\t\tendOffset = endPoint.offset;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Avoid applying formatting to a trailing space.\n\t\t\t\tleaf = findLeaf(endContainer, endOffset);\n\t\t\t\tif (leaf.node) {\n\t\t\t\t\twhile (leaf.node && leaf.offset === 0 && leaf.node.previousSibling) {\n\t\t\t\t\t\tleaf = findLeaf(leaf.node.previousSibling);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (leaf.node && leaf.offset > 0 && leaf.node.nodeType === 3 &&\n\t\t\t\t\t\t\tleaf.node.nodeValue.charAt(leaf.offset - 1) === ' ') {\n\n\t\t\t\t\t\tif (leaf.offset > 1) {\n\t\t\t\t\t\t\tendContainer = leaf.node;\n\t\t\t\t\t\t\tendContainer.splitText(leaf.offset - 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Move start/end point up the tree if the leaves are sharp and if we are in different containers\n\t\t\t// Example * becomes !: !<p><b><i>*text</i><i>text*</i></b></p>!\n\t\t\t// This will reduce the number of wrapper elements that needs to be created\n\t\t\t// Move start point up the tree\n\t\t\tif (format[0].inline || format[0].block_expand) {\n\t\t\t\tif (!format[0].inline || (startContainer.nodeType != 3 || startOffset === 0)) {\n\t\t\t\t\tstartContainer = findParentContainer(true);\n\t\t\t\t}\n\n\t\t\t\tif (!format[0].inline || (endContainer.nodeType != 3 || endOffset === endContainer.nodeValue.length)) {\n\t\t\t\t\tendContainer = findParentContainer();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Expand start/end container to matching selector\n\t\t\tif (format[0].selector && format[0].expand !== FALSE && !format[0].inline) {\n\t\t\t\t// Find new startContainer/endContainer if there is better one\n\t\t\t\tstartContainer = findSelectorEndPoint(startContainer, 'previousSibling');\n\t\t\t\tendContainer = findSelectorEndPoint(endContainer, 'nextSibling');\n\t\t\t}\n\n\t\t\t// Expand start/end container to matching block element or text node\n\t\t\tif (format[0].block || format[0].selector) {\n\t\t\t\t// Find new startContainer/endContainer if there is better one\n\t\t\t\tstartContainer = findBlockEndPoint(startContainer, 'previousSibling');\n\t\t\t\tendContainer = findBlockEndPoint(endContainer, 'nextSibling');\n\n\t\t\t\t// Non block element then try to expand up the leaf\n\t\t\t\tif (format[0].block) {\n\t\t\t\t\tif (!isBlock(startContainer)) {\n\t\t\t\t\t\tstartContainer = findParentContainer(true);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!isBlock(endContainer)) {\n\t\t\t\t\t\tendContainer = findParentContainer();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Setup index for startContainer\n\t\t\tif (startContainer.nodeType == 1) {\n\t\t\t\tstartOffset = nodeIndex(startContainer);\n\t\t\t\tstartContainer = startContainer.parentNode;\n\t\t\t}\n\n\t\t\t// Setup index for endContainer\n\t\t\tif (endContainer.nodeType == 1) {\n\t\t\t\tendOffset = nodeIndex(endContainer) + 1;\n\t\t\t\tendContainer = endContainer.parentNode;\n\t\t\t}\n\n\t\t\t// Return new range like object\n\t\t\treturn {\n\t\t\t\tstartContainer: startContainer,\n\t\t\t\tstartOffset: startOffset,\n\t\t\t\tendContainer: endContainer,\n\t\t\t\tendOffset: endOffset\n\t\t\t};\n\t\t}\n\n\t\tfunction isColorFormatAndAnchor(node, format) {\n\t\t\treturn format.links && node.tagName == 'A';\n\t\t}\n\n\t\t/**\n\t\t * Removes the specified format for the specified node. It will also remove the node if it doesn't have\n\t\t * any attributes if the format specifies it to do so.\n\t\t *\n\t\t * @private\n\t\t * @param {Object} format Format object with items to remove from node.\n\t\t * @param {Object} vars Name/value object with variables to apply to format.\n\t\t * @param {Node} node Node to remove the format styles on.\n\t\t * @param {Node} compare_node Optional compare node, if specified the styles will be compared to that node.\n\t\t * @return {Boolean} True/false if the node was removed or not.\n\t\t */\n\t\tfunction removeFormat(format, vars, node, compare_node) {\n\t\t\tvar i, attrs, stylesModified;\n\n\t\t\t// Check if node matches format\n\t\t\tif (!matchName(node, format) && !isColorFormatAndAnchor(node, format)) {\n\t\t\t\treturn FALSE;\n\t\t\t}\n\n\t\t\t// Should we compare with format attribs and styles\n\t\t\tif (format.remove != 'all') {\n\t\t\t\t// Remove styles\n\t\t\t\teach(format.styles, function(value, name) {\n\t\t\t\t\tvalue = normalizeStyleValue(replaceVars(value, vars), name);\n\n\t\t\t\t\t// Indexed array\n\t\t\t\t\tif (typeof name === 'number') {\n\t\t\t\t\t\tname = value;\n\t\t\t\t\t\tcompare_node = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (format.remove_similar || (!compare_node || isEq(getStyle(compare_node, name), value))) {\n\t\t\t\t\t\tdom.setStyle(node, name, '');\n\t\t\t\t\t}\n\n\t\t\t\t\tstylesModified = 1;\n\t\t\t\t});\n\n\t\t\t\t// Remove style attribute if it's empty\n\t\t\t\tif (stylesModified && dom.getAttrib(node, 'style') === '') {\n\t\t\t\t\tnode.removeAttribute('style');\n\t\t\t\t\tnode.removeAttribute('data-mce-style');\n\t\t\t\t}\n\n\t\t\t\t// Remove attributes\n\t\t\t\teach(format.attributes, function(value, name) {\n\t\t\t\t\tvar valueOut;\n\n\t\t\t\t\tvalue = replaceVars(value, vars);\n\n\t\t\t\t\t// Indexed array\n\t\t\t\t\tif (typeof name === 'number') {\n\t\t\t\t\t\tname = value;\n\t\t\t\t\t\tcompare_node = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!compare_node || isEq(dom.getAttrib(compare_node, name), value)) {\n\t\t\t\t\t\t// Keep internal classes\n\t\t\t\t\t\tif (name == 'class') {\n\t\t\t\t\t\t\tvalue = dom.getAttrib(node, name);\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\t// Build new class value where everything is removed except the internal prefixed classes\n\t\t\t\t\t\t\t\tvalueOut = '';\n\t\t\t\t\t\t\t\teach(value.split(/\\s+/), function(cls) {\n\t\t\t\t\t\t\t\t\tif (/mce\\-\\w+/.test(cls)) {\n\t\t\t\t\t\t\t\t\t\tvalueOut += (valueOut ? ' ' : '') + cls;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// We got some internal classes left\n\t\t\t\t\t\t\t\tif (valueOut) {\n\t\t\t\t\t\t\t\t\tdom.setAttrib(node, name, valueOut);\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// IE6 has a bug where the attribute doesn't get removed correctly\n\t\t\t\t\t\tif (name == \"class\") {\n\t\t\t\t\t\t\tnode.removeAttribute('className');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Remove mce prefixed attributes\n\t\t\t\t\t\tif (MCE_ATTR_RE.test(name)) {\n\t\t\t\t\t\t\tnode.removeAttribute('data-mce-' + name);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode.removeAttribute(name);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Remove classes\n\t\t\t\teach(format.classes, function(value) {\n\t\t\t\t\tvalue = replaceVars(value, vars);\n\n\t\t\t\t\tif (!compare_node || dom.hasClass(compare_node, value)) {\n\t\t\t\t\t\tdom.removeClass(node, value);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Check for non internal attributes\n\t\t\t\tattrs = dom.getAttribs(node);\n\t\t\t\tfor (i = 0; i < attrs.length; i++) {\n\t\t\t\t\tvar attrName = attrs[i].nodeName;\n\t\t\t\t\tif (attrName.indexOf('_') !== 0 && attrName.indexOf('data-') !== 0) {\n\t\t\t\t\t\treturn FALSE;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove the inline child if it's empty for example <b> or <span>\n\t\t\tif (format.remove != 'none') {\n\t\t\t\tremoveNode(node, format);\n\t\t\t\treturn TRUE;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Removes the node and wrap it's children in paragraphs before doing so or\n\t\t * appends BR elements to the beginning/end of the block element if forcedRootBlocks is disabled.\n\t\t *\n\t\t * If the div in the node below gets removed:\n\t\t *  text<div>text</div>text\n\t\t *\n\t\t * Output becomes:\n\t\t *  text<div><br />text<br /></div>text\n\t\t *\n\t\t * So when the div is removed the result is:\n\t\t *  text<br />text<br />text\n\t\t *\n\t\t * @private\n\t\t * @param {Node} node Node to remove + apply BR/P elements to.\n\t\t * @param {Object} format Format rule.\n\t\t * @return {Node} Input node.\n\t\t */\n\t\tfunction removeNode(node, format) {\n\t\t\tvar parentNode = node.parentNode, rootBlockElm;\n\n\t\t\tfunction find(node, next, inc) {\n\t\t\t\tnode = getNonWhiteSpaceSibling(node, next, inc);\n\n\t\t\t\treturn !node || (node.nodeName == 'BR' || isBlock(node));\n\t\t\t}\n\n\t\t\tif (format.block) {\n\t\t\t\tif (!forcedRootBlock) {\n\t\t\t\t\t// Append BR elements if needed before we remove the block\n\t\t\t\t\tif (isBlock(node) && !isBlock(parentNode)) {\n\t\t\t\t\t\tif (!find(node, FALSE) && !find(node.firstChild, TRUE, 1)) {\n\t\t\t\t\t\t\tnode.insertBefore(dom.create('br'), node.firstChild);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!find(node, TRUE) && !find(node.lastChild, FALSE, 1)) {\n\t\t\t\t\t\t\tnode.appendChild(dom.create('br'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Wrap the block in a forcedRootBlock if we are at the root of document\n\t\t\t\t\tif (parentNode == dom.getRoot()) {\n\t\t\t\t\t\tif (!format.list_block || !isEq(node, format.list_block)) {\n\t\t\t\t\t\t\teach(grep(node.childNodes), function(node) {\n\t\t\t\t\t\t\t\tif (isValid(forcedRootBlock, node.nodeName.toLowerCase())) {\n\t\t\t\t\t\t\t\t\tif (!rootBlockElm) {\n\t\t\t\t\t\t\t\t\t\trootBlockElm = wrap(node, forcedRootBlock);\n\t\t\t\t\t\t\t\t\t\tdom.setAttribs(rootBlockElm, ed.settings.forced_root_block_attrs);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\trootBlockElm.appendChild(node);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\trootBlockElm = 0;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Never remove nodes that isn't the specified inline element if a selector is specified too\n\t\t\tif (format.selector && format.inline && !isEq(format.inline, node)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdom.remove(node, 1);\n\t\t}\n\n\t\t/**\n\t\t * Returns the next/previous non whitespace node.\n\t\t *\n\t\t * @private\n\t\t * @param {Node} node Node to start at.\n\t\t * @param {boolean} next (Optional) Include next or previous node defaults to previous.\n\t\t * @param {boolean} inc (Optional) Include the current node in checking. Defaults to false.\n\t\t * @return {Node} Next or previous node or undefined if it wasn't found.\n\t\t */\n\t\tfunction getNonWhiteSpaceSibling(node, next, inc) {\n\t\t\tif (node) {\n\t\t\t\tnext = next ? 'nextSibling' : 'previousSibling';\n\n\t\t\t\tfor (node = inc ? node : node[next]; node; node = node[next]) {\n\t\t\t\t\tif (node.nodeType == 1 || !isWhiteSpaceNode(node)) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Merges the next/previous sibling element if they match.\n\t\t *\n\t\t * @private\n\t\t * @param {Node} prev Previous node to compare/merge.\n\t\t * @param {Node} next Next node to compare/merge.\n\t\t * @return {Node} Next node if we didn't merge and prev node if we did.\n\t\t */\n\t\tfunction mergeSiblings(prev, next) {\n\t\t\tvar sibling, tmpSibling, elementUtils = new ElementUtils(dom);\n\n\t\t\tfunction findElementSibling(node, sibling_name) {\n\t\t\t\tfor (sibling = node; sibling; sibling = sibling[sibling_name]) {\n\t\t\t\t\tif (sibling.nodeType == 3 && sibling.nodeValue.length !== 0) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (sibling.nodeType == 1 && !isBookmarkNode(sibling)) {\n\t\t\t\t\t\treturn sibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\t// Check if next/prev exists and that they are elements\n\t\t\tif (prev && next) {\n\t\t\t\t// If previous sibling is empty then jump over it\n\t\t\t\tprev = findElementSibling(prev, 'previousSibling');\n\t\t\t\tnext = findElementSibling(next, 'nextSibling');\n\n\t\t\t\t// Compare next and previous nodes\n\t\t\t\tif (elementUtils.compare(prev, next)) {\n\t\t\t\t\t// Append nodes between\n\t\t\t\t\tfor (sibling = prev.nextSibling; sibling && sibling != next;) {\n\t\t\t\t\t\ttmpSibling = sibling;\n\t\t\t\t\t\tsibling = sibling.nextSibling;\n\t\t\t\t\t\tprev.appendChild(tmpSibling);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove next node\n\t\t\t\t\tdom.remove(next);\n\n\t\t\t\t\t// Move children into prev node\n\t\t\t\t\teach(grep(next.childNodes), function(node) {\n\t\t\t\t\t\tprev.appendChild(node);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn prev;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn next;\n\t\t}\n\n\t\tfunction getContainer(rng, start) {\n\t\t\tvar container, offset, lastIdx;\n\n\t\t\tcontainer = rng[start ? 'startContainer' : 'endContainer'];\n\t\t\toffset = rng[start ? 'startOffset' : 'endOffset'];\n\n\t\t\tif (container.nodeType == 1) {\n\t\t\t\tlastIdx = container.childNodes.length - 1;\n\n\t\t\t\tif (!start && offset) {\n\t\t\t\t\toffset--;\n\t\t\t\t}\n\n\t\t\t\tcontainer = container.childNodes[offset > lastIdx ? lastIdx : offset];\n\t\t\t}\n\n\t\t\t// If start text node is excluded then walk to the next node\n\t\t\tif (container.nodeType === 3 && start && offset >= container.nodeValue.length) {\n\t\t\t\tcontainer = new TreeWalker(container, ed.getBody()).next() || container;\n\t\t\t}\n\n\t\t\t// If end text node is excluded then walk to the previous node\n\t\t\tif (container.nodeType === 3 && !start && offset === 0) {\n\t\t\t\tcontainer = new TreeWalker(container, ed.getBody()).prev() || container;\n\t\t\t}\n\n\t\t\treturn container;\n\t\t}\n\n\t\tfunction performCaretAction(type, name, vars, similar) {\n\t\t\tvar caretContainerId = '_mce_caret', debug = ed.settings.caret_debug;\n\n\t\t\t// Creates a caret container bogus element\n\t\t\tfunction createCaretContainer(fill) {\n\t\t\t\tvar caretContainer = dom.create('span', {id: caretContainerId, 'data-mce-bogus': true, style: debug ? 'color:red' : ''});\n\n\t\t\t\tif (fill) {\n\t\t\t\t\tcaretContainer.appendChild(ed.getDoc().createTextNode(INVISIBLE_CHAR));\n\t\t\t\t}\n\n\t\t\t\treturn caretContainer;\n\t\t\t}\n\n\t\t\tfunction isCaretContainerEmpty(node, nodes) {\n\t\t\t\twhile (node) {\n\t\t\t\t\tif ((node.nodeType === 3 && node.nodeValue !== INVISIBLE_CHAR) || node.childNodes.length > 1) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Collect nodes\n\t\t\t\t\tif (nodes && node.nodeType === 1) {\n\t\t\t\t\t\tnodes.push(node);\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.firstChild;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Returns any parent caret container element\n\t\t\tfunction getParentCaretContainer(node) {\n\t\t\t\twhile (node) {\n\t\t\t\t\tif (node.id === caretContainerId) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Finds the first text node in the specified node\n\t\t\tfunction findFirstTextNode(node) {\n\t\t\t\tvar walker;\n\n\t\t\t\tif (node) {\n\t\t\t\t\twalker = new TreeWalker(node, node);\n\n\t\t\t\t\tfor (node = walker.current(); node; node = walker.next()) {\n\t\t\t\t\t\tif (node.nodeType === 3) {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Removes the caret container for the specified node or all on the current document\n\t\t\tfunction removeCaretContainer(node, move_caret) {\n\t\t\t\tvar child, rng;\n\n\t\t\t\tif (!node) {\n\t\t\t\t\tnode = getParentCaretContainer(selection.getStart());\n\n\t\t\t\t\tif (!node) {\n\t\t\t\t\t\twhile ((node = dom.get(caretContainerId))) {\n\t\t\t\t\t\t\tremoveCaretContainer(node, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\trng = selection.getRng(true);\n\n\t\t\t\t\tif (isCaretContainerEmpty(node)) {\n\t\t\t\t\t\tif (move_caret !== false) {\n\t\t\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\t\t\trng.setEndBefore(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdom.remove(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchild = findFirstTextNode(node);\n\n\t\t\t\t\t\tif (child.nodeValue.charAt(0) === INVISIBLE_CHAR) {\n\t\t\t\t\t\t\tchild.deleteData(0, 1);\n\n\t\t\t\t\t\t\t// Fix for bug #6976\n\t\t\t\t\t\t\tif (rng.startContainer == child && rng.startOffset > 0) {\n\t\t\t\t\t\t\t\trng.setStart(child, rng.startOffset - 1);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (rng.endContainer == child && rng.endOffset > 0) {\n\t\t\t\t\t\t\t\trng.setEnd(child, rng.endOffset - 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdom.remove(node, 1);\n\t\t\t\t\t}\n\n\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Applies formatting to the caret position\n\t\t\tfunction applyCaretFormat() {\n\t\t\t\tvar rng, caretContainer, textNode, offset, bookmark, container, text;\n\n\t\t\t\trng = selection.getRng(true);\n\t\t\t\toffset = rng.startOffset;\n\t\t\t\tcontainer = rng.startContainer;\n\t\t\t\ttext = container.nodeValue;\n\n\t\t\t\tcaretContainer = getParentCaretContainer(selection.getStart());\n\t\t\t\tif (caretContainer) {\n\t\t\t\t\ttextNode = findFirstTextNode(caretContainer);\n\t\t\t\t}\n\n\t\t\t\t// Expand to word is caret is in the middle of a text node and the char before/after is a alpha numeric character\n\t\t\t\tif (text && offset > 0 && offset < text.length && /\\w/.test(text.charAt(offset)) && /\\w/.test(text.charAt(offset - 1))) {\n\t\t\t\t\t// Get bookmark of caret position\n\t\t\t\t\tbookmark = selection.getBookmark();\n\n\t\t\t\t\t// Collapse bookmark range (WebKit)\n\t\t\t\t\trng.collapse(true);\n\n\t\t\t\t\t// Expand the range to the closest word and split it at those points\n\t\t\t\t\trng = expandRng(rng, get(name));\n\t\t\t\t\trng = rangeUtils.split(rng);\n\n\t\t\t\t\t// Apply the format to the range\n\t\t\t\t\tapply(name, vars, rng);\n\n\t\t\t\t\t// Move selection back to caret position\n\t\t\t\t\tselection.moveToBookmark(bookmark);\n\t\t\t\t} else {\n\t\t\t\t\tif (!caretContainer || textNode.nodeValue !== INVISIBLE_CHAR) {\n\t\t\t\t\t\tcaretContainer = createCaretContainer(true);\n\t\t\t\t\t\ttextNode = caretContainer.firstChild;\n\n\t\t\t\t\t\trng.insertNode(caretContainer);\n\t\t\t\t\t\toffset = 1;\n\n\t\t\t\t\t\tapply(name, vars, caretContainer);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tapply(name, vars, caretContainer);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Move selection to text node\n\t\t\t\t\tselection.setCursorLocation(textNode, offset);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction removeCaretFormat() {\n\t\t\t\tvar rng = selection.getRng(true), container, offset, bookmark,\n\t\t\t\t\thasContentAfter, node, formatNode, parents = [], i, caretContainer;\n\n\t\t\t\tcontainer = rng.startContainer;\n\t\t\t\toffset = rng.startOffset;\n\t\t\t\tnode = container;\n\n\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\tif (offset != container.nodeValue.length) {\n\t\t\t\t\t\thasContentAfter = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\twhile (node) {\n\t\t\t\t\tif (matchNode(node, name, vars, similar)) {\n\t\t\t\t\t\tformatNode = node;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.nextSibling) {\n\t\t\t\t\t\thasContentAfter = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tparents.push(node);\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\t// Node doesn't have the specified format\n\t\t\t\tif (!formatNode) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Is there contents after the caret then remove the format on the element\n\t\t\t\tif (hasContentAfter) {\n\t\t\t\t\t// Get bookmark of caret position\n\t\t\t\t\tbookmark = selection.getBookmark();\n\n\t\t\t\t\t// Collapse bookmark range (WebKit)\n\t\t\t\t\trng.collapse(true);\n\n\t\t\t\t\t// Expand the range to the closest word and split it at those points\n\t\t\t\t\trng = expandRng(rng, get(name), true);\n\t\t\t\t\trng = rangeUtils.split(rng);\n\n\t\t\t\t\t// Remove the format from the range\n\t\t\t\t\tremove(name, vars, rng);\n\n\t\t\t\t\t// Move selection back to caret position\n\t\t\t\t\tselection.moveToBookmark(bookmark);\n\t\t\t\t} else {\n\t\t\t\t\tcaretContainer = createCaretContainer();\n\n\t\t\t\t\tnode = caretContainer;\n\t\t\t\t\tfor (i = parents.length - 1; i >= 0; i--) {\n\t\t\t\t\t\tnode.appendChild(dom.clone(parents[i], false));\n\t\t\t\t\t\tnode = node.firstChild;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Insert invisible character into inner most format element\n\t\t\t\t\tnode.appendChild(dom.doc.createTextNode(INVISIBLE_CHAR));\n\t\t\t\t\tnode = node.firstChild;\n\n\t\t\t\t\tvar block = dom.getParent(formatNode, isTextBlock);\n\n\t\t\t\t\tif (block && dom.isEmpty(block)) {\n\t\t\t\t\t\t// Replace formatNode with caretContainer when removing format from empty block like <p><b>|</b></p>\n\t\t\t\t\t\tformatNode.parentNode.replaceChild(caretContainer, formatNode);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Insert caret container after the formatted node\n\t\t\t\t\t\tdom.insertAfter(caretContainer, formatNode);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Move selection to text node\n\t\t\t\t\tselection.setCursorLocation(node, 1);\n\n\t\t\t\t\t// If the formatNode is empty, we can remove it safely.\n\t\t\t\t\tif (dom.isEmpty(formatNode)) {\n\t\t\t\t\t\tdom.remove(formatNode);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Checks if the parent caret container node isn't empty if that is the case it\n\t\t\t// will remove the bogus state on all children that isn't empty\n\t\t\tfunction unmarkBogusCaretParents() {\n\t\t\t\tvar caretContainer;\n\n\t\t\t\tcaretContainer = getParentCaretContainer(selection.getStart());\n\t\t\t\tif (caretContainer && !dom.isEmpty(caretContainer)) {\n\t\t\t\t\twalk(caretContainer, function(node) {\n\t\t\t\t\t\tif (node.nodeType == 1 && node.id !== caretContainerId && !dom.isEmpty(node)) {\n\t\t\t\t\t\t\tdom.setAttrib(node, 'data-mce-bogus', null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 'childNodes');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Only bind the caret events once\n\t\t\tif (!ed._hasCaretEvents) {\n\t\t\t\t// Mark current caret container elements as bogus when getting the contents so we don't end up with empty elements\n\t\t\t\tmarkCaretContainersBogus = function() {\n\t\t\t\t\tvar nodes = [], i;\n\n\t\t\t\t\tif (isCaretContainerEmpty(getParentCaretContainer(selection.getStart()), nodes)) {\n\t\t\t\t\t\t// Mark children\n\t\t\t\t\t\ti = nodes.length;\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tdom.setAttrib(nodes[i], 'data-mce-bogus', '1');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tdisableCaretContainer = function(e) {\n\t\t\t\t\tvar keyCode = e.keyCode;\n\n\t\t\t\t\tremoveCaretContainer();\n\n\t\t\t\t\t// Remove caret container if it's empty\n\t\t\t\t\tif (keyCode == 8 && selection.isCollapsed() && selection.getStart().innerHTML == INVISIBLE_CHAR) {\n\t\t\t\t\t\tremoveCaretContainer(getParentCaretContainer(selection.getStart()));\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove caret container on keydown and it's left/right arrow keys\n\t\t\t\t\tif (keyCode == 37 || keyCode == 39) {\n\t\t\t\t\t\tremoveCaretContainer(getParentCaretContainer(selection.getStart()));\n\t\t\t\t\t}\n\n\t\t\t\t\tunmarkBogusCaretParents();\n\t\t\t\t};\n\n\t\t\t\t// Remove bogus state if they got filled by contents using editor.selection.setContent\n\t\t\t\ted.on('SetContent', function(e) {\n\t\t\t\t\tif (e.selection) {\n\t\t\t\t\t\tunmarkBogusCaretParents();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ted._hasCaretEvents = true;\n\t\t\t}\n\n\t\t\t// Do apply or remove caret format\n\t\t\tif (type == \"apply\") {\n\t\t\t\tapplyCaretFormat();\n\t\t\t} else {\n\t\t\t\tremoveCaretFormat();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Moves the start to the first suitable text node.\n\t\t */\n\t\tfunction moveStart(rng) {\n\t\t\tvar container = rng.startContainer,\n\t\t\t\t\toffset = rng.startOffset, isAtEndOfText,\n\t\t\t\t\twalker, node, nodes, tmpNode;\n\n\t\t\tif (rng.startContainer == rng.endContainer) {\n\t\t\t\tif (isInlineBlock(rng.startContainer.childNodes[rng.startOffset])) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Convert text node into index if possible\n\t\t\tif (container.nodeType == 3 && offset >= container.nodeValue.length) {\n\t\t\t\t// Get the parent container location and walk from there\n\t\t\t\toffset = nodeIndex(container);\n\t\t\t\tcontainer = container.parentNode;\n\t\t\t\tisAtEndOfText = true;\n\t\t\t}\n\n\t\t\t// Move startContainer/startOffset in to a suitable node\n\t\t\tif (container.nodeType == 1) {\n\t\t\t\tnodes = container.childNodes;\n\t\t\t\tcontainer = nodes[Math.min(offset, nodes.length - 1)];\n\t\t\t\twalker = new TreeWalker(container, dom.getParent(container, dom.isBlock));\n\n\t\t\t\t// If offset is at end of the parent node walk to the next one\n\t\t\t\tif (offset > nodes.length - 1 || isAtEndOfText) {\n\t\t\t\t\twalker.next();\n\t\t\t\t}\n\n\t\t\t\tfor (node = walker.current(); node; node = walker.next()) {\n\t\t\t\t\tif (node.nodeType == 3 && !isWhiteSpaceNode(node)) {\n\t\t\t\t\t\t// IE has a \"neat\" feature where it moves the start node into the closest element\n\t\t\t\t\t\t// we can avoid this by inserting an element before it and then remove it after we set the selection\n\t\t\t\t\t\ttmpNode = dom.create('a', {'data-mce-bogus': 'all'}, INVISIBLE_CHAR);\n\t\t\t\t\t\tnode.parentNode.insertBefore(tmpNode, node);\n\n\t\t\t\t\t\t// Set selection and remove tmpNode\n\t\t\t\t\t\trng.setStart(node, 0);\n\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t\tdom.remove(tmpNode);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/UndoManager.js\n\n/**\n * UndoManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles the undo/redo history levels for the editor. Since the built-in undo/redo has major drawbacks a custom one was needed.\n *\n * @class tinymce.UndoManager\n */\ndefine(\"tinymce/UndoManager\", [\n\t\"tinymce/util/VK\",\n\t\"tinymce/Env\"\n], function(VK, Env) {\n\treturn function(editor) {\n\t\tvar self = this, index = 0, data = [], beforeBookmark, isFirstTypedCharacter, locks = 0;\n\n\t\tfunction getContent() {\n\t\t\treturn editor.serializer.getTrimmedContent();\n\t\t}\n\n\t\tfunction setDirty(state) {\n\t\t\teditor.setDirty(state);\n\t\t}\n\n\t\tfunction addNonTypingUndoLevel(e) {\n\t\t\tself.typing = false;\n\t\t\tself.add({}, e);\n\t\t}\n\n\t\t// Add initial undo level when the editor is initialized\n\t\teditor.on('init', function() {\n\t\t\tself.add();\n\t\t});\n\n\t\t// Get position before an execCommand is processed\n\t\teditor.on('BeforeExecCommand', function(e) {\n\t\t\tvar cmd = e.command;\n\n\t\t\tif (cmd != 'Undo' && cmd != 'Redo' && cmd != 'mceRepaint') {\n\t\t\t\tself.beforeChange();\n\t\t\t}\n\t\t});\n\n\t\t// Add undo level after an execCommand call was made\n\t\teditor.on('ExecCommand', function(e) {\n\t\t\tvar cmd = e.command;\n\n\t\t\tif (cmd != 'Undo' && cmd != 'Redo' && cmd != 'mceRepaint') {\n\t\t\t\taddNonTypingUndoLevel(e);\n\t\t\t}\n\t\t});\n\n\t\teditor.on('ObjectResizeStart Cut', function() {\n\t\t\tself.beforeChange();\n\t\t});\n\n\t\teditor.on('SaveContent ObjectResized blur', addNonTypingUndoLevel);\n\t\teditor.on('DragEnd', addNonTypingUndoLevel);\n\n\t\teditor.on('KeyUp', function(e) {\n\t\t\tvar keyCode = e.keyCode;\n\n\t\t\t// If key is prevented then don't add undo level\n\t\t\t// This would happen on keyboard shortcuts for example\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ((keyCode >= 33 && keyCode <= 36) || (keyCode >= 37 && keyCode <= 40) || keyCode == 45 || keyCode == 13 || e.ctrlKey) {\n\t\t\t\taddNonTypingUndoLevel();\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\n\t\t\tif (keyCode == 46 || keyCode == 8 || (Env.mac && (keyCode == 91 || keyCode == 93))) {\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\n\t\t\t// Fire a TypingUndo event on the first character entered\n\t\t\tif (isFirstTypedCharacter && self.typing) {\n\t\t\t\t// Make it dirty if the content was changed after typing the first character\n\t\t\t\tif (!editor.isDirty()) {\n\t\t\t\t\tsetDirty(data[0] && getContent() != data[0].content);\n\n\t\t\t\t\t// Fire initial change event\n\t\t\t\t\tif (editor.isDirty()) {\n\t\t\t\t\t\teditor.fire('change', {level: data[0], lastLevel: null});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\teditor.fire('TypingUndo');\n\t\t\t\tisFirstTypedCharacter = false;\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\t\t});\n\n\t\teditor.on('KeyDown', function(e) {\n\t\t\tvar keyCode = e.keyCode;\n\n\t\t\t// If key is prevented then don't add undo level\n\t\t\t// This would happen on keyboard shortcuts for example\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Is character position keys left,right,up,down,home,end,pgdown,pgup,enter\n\t\t\tif ((keyCode >= 33 && keyCode <= 36) || (keyCode >= 37 && keyCode <= 40) || keyCode == 45) {\n\t\t\t\tif (self.typing) {\n\t\t\t\t\taddNonTypingUndoLevel(e);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If key isn't Ctrl+Alt/AltGr\n\t\t\tvar modKey = (e.ctrlKey && !e.altKey) || e.metaKey;\n\t\t\tif ((keyCode < 16 || keyCode > 20) && keyCode != 224 && keyCode != 91 && !self.typing && !modKey) {\n\t\t\t\tself.beforeChange();\n\t\t\t\tself.typing = true;\n\t\t\t\tself.add({}, e);\n\t\t\t\tisFirstTypedCharacter = true;\n\t\t\t}\n\t\t});\n\n\t\teditor.on('MouseDown', function(e) {\n\t\t\tif (self.typing) {\n\t\t\t\taddNonTypingUndoLevel(e);\n\t\t\t}\n\t\t});\n\n\t\t// Add keyboard shortcuts for undo/redo keys\n\t\teditor.addShortcut('meta+z', '', 'Undo');\n\t\teditor.addShortcut('meta+y,meta+shift+z', '', 'Redo');\n\n\t\teditor.on('AddUndo Undo Redo ClearUndos', function(e) {\n\t\t\tif (!e.isDefaultPrevented()) {\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\t\t});\n\n\t\t/*eslint consistent-this:0 */\n\t\tself = {\n\t\t\t// Explode for debugging reasons\n\t\t\tdata: data,\n\n\t\t\t/**\n\t\t\t * State if the user is currently typing or not. This will add a typing operation into one undo\n\t\t\t * level instead of one new level for each keystroke.\n\t\t\t *\n\t\t\t * @field {Boolean} typing\n\t\t\t */\n\t\t\ttyping: false,\n\n\t\t\t/**\n\t\t\t * Stores away a bookmark to be used when performing an undo action so that the selection is before\n\t\t\t * the change has been made.\n\t\t\t *\n\t\t\t * @method beforeChange\n\t\t\t */\n\t\t\tbeforeChange: function() {\n\t\t\t\tif (!locks) {\n\t\t\t\t\tbeforeBookmark = editor.selection.getBookmark(2, true);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds a new undo level/snapshot to the undo list.\n\t\t\t *\n\t\t\t * @method add\n\t\t\t * @param {Object} level Optional undo level object to add.\n\t\t\t * @param {DOMEvent} event Optional event responsible for the creation of the undo level.\n\t\t\t * @return {Object} Undo level that got added or null it a level wasn't needed.\n\t\t\t */\n\t\t\tadd: function(level, event) {\n\t\t\t\tvar i, settings = editor.settings, lastLevel;\n\n\t\t\t\tlevel = level || {};\n\t\t\t\tlevel.content = getContent();\n\n\t\t\t\tif (locks || editor.removed) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tlastLevel = data[index];\n\t\t\t\tif (editor.fire('BeforeAddUndo', {level: level, lastLevel: lastLevel, originalEvent: event}).isDefaultPrevented()) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// Add undo level if needed\n\t\t\t\tif (lastLevel && lastLevel.content == level.content) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// Set before bookmark on previous level\n\t\t\t\tif (data[index]) {\n\t\t\t\t\tdata[index].beforeBookmark = beforeBookmark;\n\t\t\t\t}\n\n\t\t\t\t// Time to compress\n\t\t\t\tif (settings.custom_undo_redo_levels) {\n\t\t\t\t\tif (data.length > settings.custom_undo_redo_levels) {\n\t\t\t\t\t\tfor (i = 0; i < data.length - 1; i++) {\n\t\t\t\t\t\t\tdata[i] = data[i + 1];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdata.length--;\n\t\t\t\t\t\tindex = data.length;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Get a non intrusive normalized bookmark\n\t\t\t\tlevel.bookmark = editor.selection.getBookmark(2, true);\n\n\t\t\t\t// Crop array if needed\n\t\t\t\tif (index < data.length - 1) {\n\t\t\t\t\tdata.length = index + 1;\n\t\t\t\t}\n\n\t\t\t\tdata.push(level);\n\t\t\t\tindex = data.length - 1;\n\n\t\t\t\tvar args = {level: level, lastLevel: lastLevel, originalEvent: event};\n\n\t\t\t\teditor.fire('AddUndo', args);\n\n\t\t\t\tif (index > 0) {\n\t\t\t\t\tsetDirty(true);\n\t\t\t\t\teditor.fire('change', args);\n\t\t\t\t}\n\n\t\t\t\treturn level;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Undoes the last action.\n\t\t\t *\n\t\t\t * @method undo\n\t\t\t * @return {Object} Undo level or null if no undo was performed.\n\t\t\t */\n\t\t\tundo: function() {\n\t\t\t\tvar level;\n\n\t\t\t\tif (self.typing) {\n\t\t\t\t\tself.add();\n\t\t\t\t\tself.typing = false;\n\t\t\t\t}\n\n\t\t\t\tif (index > 0) {\n\t\t\t\t\tlevel = data[--index];\n\n\t\t\t\t\teditor.setContent(level.content, {format: 'raw'});\n\t\t\t\t\teditor.selection.moveToBookmark(level.beforeBookmark);\n\t\t\t\t\tsetDirty(true);\n\n\t\t\t\t\teditor.fire('undo', {level: level});\n\t\t\t\t}\n\n\t\t\t\treturn level;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Redoes the last action.\n\t\t\t *\n\t\t\t * @method redo\n\t\t\t * @return {Object} Redo level or null if no redo was performed.\n\t\t\t */\n\t\t\tredo: function() {\n\t\t\t\tvar level;\n\n\t\t\t\tif (index < data.length - 1) {\n\t\t\t\t\tlevel = data[++index];\n\n\t\t\t\t\teditor.setContent(level.content, {format: 'raw'});\n\t\t\t\t\teditor.selection.moveToBookmark(level.bookmark);\n\t\t\t\t\tsetDirty(true);\n\n\t\t\t\t\teditor.fire('redo', {level: level});\n\t\t\t\t}\n\n\t\t\t\treturn level;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Removes all undo levels.\n\t\t\t *\n\t\t\t * @method clear\n\t\t\t */\n\t\t\tclear: function() {\n\t\t\t\tdata = [];\n\t\t\t\tindex = 0;\n\t\t\t\tself.typing = false;\n\t\t\t\tself.data = data;\n\t\t\t\teditor.fire('ClearUndos');\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Returns true/false if the undo manager has any undo levels.\n\t\t\t *\n\t\t\t * @method hasUndo\n\t\t\t * @return {Boolean} true/false if the undo manager has any undo levels.\n\t\t\t */\n\t\t\thasUndo: function() {\n\t\t\t\t// Has undo levels or typing and content isn't the same as the initial level\n\t\t\t\treturn index > 0 || (self.typing && data[0] && getContent() != data[0].content);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Returns true/false if the undo manager has any redo levels.\n\t\t\t *\n\t\t\t * @method hasRedo\n\t\t\t * @return {Boolean} true/false if the undo manager has any redo levels.\n\t\t\t */\n\t\t\thasRedo: function() {\n\t\t\t\treturn index < data.length - 1 && !this.typing;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Executes the specified mutator function as an undo transaction. The selection\n\t\t\t * before the modification will be stored to the undo stack and if the DOM changes\n\t\t\t * it will add a new undo level. Any methods within the translation that adds undo levels will\n\t\t\t * be ignored. So a translation can include calls to execCommand or editor.insertContent.\n\t\t\t *\n\t\t\t * @method transact\n\t\t\t * @param {function} callback Function that gets executed and has dom manipulation logic in it.\n\t\t\t * @return {Object} Undo level that got added or null it a level wasn't needed.\n\t\t\t */\n\t\t\ttransact: function(callback) {\n\t\t\t\tself.beforeChange();\n\n\t\t\t\ttry {\n\t\t\t\t\tlocks++;\n\t\t\t\t\tcallback();\n\t\t\t\t} finally {\n\t\t\t\t\tlocks--;\n\t\t\t\t}\n\n\t\t\t\treturn self.add();\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Adds an extra \"hidden\" undo level by first applying the first mutation and store that to the undo stack\n\t\t\t * then roll back that change and do the second mutation on top of the stack. This will produce an extra\n\t\t\t * undo level that the user doesn't see until they undo.\n\t\t\t *\n\t\t\t * @method extra\n\t\t\t * @param {function} callback1 Function that does mutation but gets stored as a \"hidden\" extra undo level.\n\t\t\t * @param {function} callback2 Function that does mutation but gets displayed to the user.\n\t\t\t */\n\t\t\textra: function (callback1, callback2) {\n\t\t\t\tvar lastLevel, bookmark;\n\n\t\t\t\tif (self.transact(callback1)) {\n\t\t\t\t\tbookmark = data[index].bookmark;\n\t\t\t\t\tlastLevel = data[index - 1];\n\t\t\t\t\teditor.setContent(lastLevel.content, {format: 'raw'});\n\t\t\t\t\teditor.selection.moveToBookmark(lastLevel.beforeBookmark);\n\n\t\t\t\t\tif (self.transact(callback2)) {\n\t\t\t\t\t\tdata[index - 1].beforeBookmark = bookmark;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn self;\n\t};\n});\n\n// Included from: js/tinymce/classes/EnterKey.js\n\n/**\n * EnterKey.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Contains logic for handling the enter key to split/generate block elements.\n *\n * @private\n * @class tinymce.EnterKey\n */\ndefine(\"tinymce/EnterKey\", [\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/Env\"\n], function(TreeWalker, RangeUtils, Env) {\n\tvar isIE = Env.ie && Env.ie < 11;\n\n\treturn function(editor) {\n\t\tvar dom = editor.dom, selection = editor.selection, settings = editor.settings;\n\t\tvar undoManager = editor.undoManager, schema = editor.schema, nonEmptyElementsMap = schema.getNonEmptyElements(),\n\t\t\tmoveCaretBeforeOnEnterElementsMap = schema.getMoveCaretBeforeOnEnterElements();\n\n\t\tfunction handleEnterKey(evt) {\n\t\t\tvar rng, tmpRng, editableRoot, container, offset, parentBlock, documentMode, shiftKey,\n\t\t\t\tnewBlock, fragment, containerBlock, parentBlockName, containerBlockName, newBlockName, isAfterLastNodeInContainer;\n\n\t\t\t// Returns true if the block can be split into two blocks or not\n\t\t\tfunction canSplitBlock(node) {\n\t\t\t\treturn node &&\n\t\t\t\t\tdom.isBlock(node) &&\n\t\t\t\t\t!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName) &&\n\t\t\t\t\t!/^(fixed|absolute)/i.test(node.style.position) &&\n\t\t\t\t\tdom.getContentEditable(node) !== \"true\";\n\t\t\t}\n\n\t\t\tfunction isTableCell(node) {\n\t\t\t\treturn node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\n\t\t\t}\n\n\t\t\t// Renders empty block on IE\n\t\t\tfunction renderBlockOnIE(block) {\n\t\t\t\tvar oldRng;\n\n\t\t\t\tif (dom.isBlock(block)) {\n\t\t\t\t\toldRng = selection.getRng();\n\t\t\t\t\tblock.appendChild(dom.create('span', null, '\\u00a0'));\n\t\t\t\t\tselection.select(block);\n\t\t\t\t\tblock.lastChild.outerHTML = '';\n\t\t\t\t\tselection.setRng(oldRng);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove the first empty inline element of the block so this: <p><b><em></em></b>x</p> becomes this: <p>x</p>\n\t\t\tfunction trimInlineElementsOnLeftSideOfBlock(block) {\n\t\t\t\tvar node = block, firstChilds = [], i;\n\n\t\t\t\tif (!node) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Find inner most first child ex: <p><i><b>*</b></i></p>\n\t\t\t\twhile ((node = node.firstChild)) {\n\t\t\t\t\tif (dom.isBlock(node)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.nodeType == 1 && !nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n\t\t\t\t\t\tfirstChilds.push(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ti = firstChilds.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = firstChilds[i];\n\t\t\t\t\tif (!node.hasChildNodes() || (node.firstChild == node.lastChild && node.firstChild.nodeValue === '')) {\n\t\t\t\t\t\tdom.remove(node);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Remove <a> </a> see #5381\n\t\t\t\t\t\tif (node.nodeName == \"A\" && (node.innerText || node.textContent) === ' ') {\n\t\t\t\t\t\t\tdom.remove(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Moves the caret to a suitable position within the root for example in the first non\n\t\t\t// pure whitespace text node or before an image\n\t\t\tfunction moveToCaretPosition(root) {\n\t\t\t\tvar walker, node, rng, lastNode = root, tempElm;\n\t\t\t\tfunction firstNonWhiteSpaceNodeSibling(node) {\n\t\t\t\t\twhile (node) {\n\t\t\t\t\t\tif (node.nodeType == 1 || (node.nodeType == 3 && node.data && /[\\r\\n\\s]/.test(node.data))) {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!root) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Old IE versions doesn't properly render blocks with br elements in them\n\t\t\t\t// For example <p><br></p> wont be rendered correctly in a contentEditable area\n\t\t\t\t// until you remove the br producing <p></p>\n\t\t\t\tif (Env.ie && Env.ie < 9 && parentBlock && parentBlock.firstChild) {\n\t\t\t\t\tif (parentBlock.firstChild == parentBlock.lastChild && parentBlock.firstChild.tagName == 'BR') {\n\t\t\t\t\t\tdom.remove(parentBlock.firstChild);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (/^(LI|DT|DD)$/.test(root.nodeName)) {\n\t\t\t\t\tvar firstChild = firstNonWhiteSpaceNodeSibling(root.firstChild);\n\n\t\t\t\t\tif (firstChild && /^(UL|OL|DL)$/.test(firstChild.nodeName)) {\n\t\t\t\t\t\troot.insertBefore(dom.doc.createTextNode('\\u00a0'), root.firstChild);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\trng = dom.createRng();\n\n\t\t\t\t// Normalize whitespace to remove empty text nodes. Fix for: #6904\n\t\t\t\t// Gecko will be able to place the caret in empty text nodes but it won't render propery\n\t\t\t\t// Older IE versions will sometimes crash so for now ignore all IE versions\n\t\t\t\tif (!Env.ie) {\n\t\t\t\t\troot.normalize();\n\t\t\t\t}\n\n\t\t\t\tif (root.hasChildNodes()) {\n\t\t\t\t\twalker = new TreeWalker(root, root);\n\n\t\t\t\t\twhile ((node = walker.current())) {\n\t\t\t\t\t\tif (node.nodeType == 3) {\n\t\t\t\t\t\t\trng.setStart(node, 0);\n\t\t\t\t\t\t\trng.setEnd(node, 0);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]) {\n\t\t\t\t\t\t\trng.setStartBefore(node);\n\t\t\t\t\t\t\trng.setEndBefore(node);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlastNode = node;\n\t\t\t\t\t\tnode = walker.next();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!node) {\n\t\t\t\t\t\trng.setStart(lastNode, 0);\n\t\t\t\t\t\trng.setEnd(lastNode, 0);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (root.nodeName == 'BR') {\n\t\t\t\t\t\tif (root.nextSibling && dom.isBlock(root.nextSibling)) {\n\t\t\t\t\t\t\t// Trick on older IE versions to render the caret before the BR between two lists\n\t\t\t\t\t\t\tif (!documentMode || documentMode < 9) {\n\t\t\t\t\t\t\t\ttempElm = dom.create('br');\n\t\t\t\t\t\t\t\troot.parentNode.insertBefore(tempElm, root);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trng.setStartBefore(root);\n\t\t\t\t\t\t\trng.setEndBefore(root);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setStartAfter(root);\n\t\t\t\t\t\t\trng.setEndAfter(root);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setStart(root, 0);\n\t\t\t\t\t\trng.setEnd(root, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tselection.setRng(rng);\n\n\t\t\t\t// Remove tempElm created for old IE:s\n\t\t\t\tdom.remove(tempElm);\n\t\t\t\tselection.scrollIntoView(root);\n\t\t\t}\n\n\t\t\tfunction setForcedBlockAttrs(node) {\n\t\t\t\tvar forcedRootBlockName = settings.forced_root_block;\n\n\t\t\t\tif (forcedRootBlockName && forcedRootBlockName.toLowerCase() === node.tagName.toLowerCase()) {\n\t\t\t\t\tdom.setAttribs(node, settings.forced_root_block_attrs);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction emptyBlock(elm) {\n\t\t\t\t// BR is needed in empty blocks on non IE browsers\n\t\t\t\telm.innerHTML = !isIE ? '<br data-mce-bogus=\"1\">' : '';\n\t\t\t}\n\n\t\t\t// Creates a new block element by cloning the current one or creating a new one if the name is specified\n\t\t\t// This function will also copy any text formatting from the parent block and add it to the new one\n\t\t\tfunction createNewBlock(name) {\n\t\t\t\tvar node = container, block, clonedNode, caretNode, textInlineElements = schema.getTextInlineElements();\n\n\t\t\t\tif (name || parentBlockName == \"TABLE\") {\n\t\t\t\t\tblock = dom.create(name || newBlockName);\n\t\t\t\t\tsetForcedBlockAttrs(block);\n\t\t\t\t} else {\n\t\t\t\t\tblock = parentBlock.cloneNode(false);\n\t\t\t\t}\n\n\t\t\t\tcaretNode = block;\n\n\t\t\t\t// Clone any parent styles\n\t\t\t\tif (settings.keep_styles !== false) {\n\t\t\t\t\tdo {\n\t\t\t\t\t\tif (textInlineElements[node.nodeName]) {\n\t\t\t\t\t\t\t// Never clone a caret containers\n\t\t\t\t\t\t\tif (node.id == '_mce_caret') {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tclonedNode = node.cloneNode(false);\n\t\t\t\t\t\t\tdom.setAttrib(clonedNode, 'id', ''); // Remove ID since it needs to be document unique\n\n\t\t\t\t\t\t\tif (block.hasChildNodes()) {\n\t\t\t\t\t\t\t\tclonedNode.appendChild(block.firstChild);\n\t\t\t\t\t\t\t\tblock.appendChild(clonedNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcaretNode = clonedNode;\n\t\t\t\t\t\t\t\tblock.appendChild(clonedNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} while ((node = node.parentNode) && node != editableRoot);\n\t\t\t\t}\n\n\t\t\t\t// BR is needed in empty blocks on non IE browsers\n\t\t\t\tif (!isIE) {\n\t\t\t\t\tcaretNode.innerHTML = '<br data-mce-bogus=\"1\">';\n\t\t\t\t}\n\n\t\t\t\treturn block;\n\t\t\t}\n\n\t\t\t// Returns true/false if the caret is at the start/end of the parent block element\n\t\t\tfunction isCaretAtStartOrEndOfBlock(start) {\n\t\t\t\tvar walker, node, name;\n\n\t\t\t\t// Caret is in the middle of a text node like \"a|b\"\n\t\t\t\tif (container.nodeType == 3 && (start ? offset > 0 : offset < container.nodeValue.length)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// If after the last element in block node edge case for #5091\n\t\t\t\tif (container.parentNode == parentBlock && isAfterLastNodeInContainer && !start) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// If the caret if before the first element in parentBlock\n\t\t\t\tif (start && container.nodeType == 1 && container == parentBlock.firstChild) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Caret can be before/after a table\n\t\t\t\tif (container.nodeName === \"TABLE\" || (container.previousSibling && container.previousSibling.nodeName == \"TABLE\")) {\n\t\t\t\t\treturn (isAfterLastNodeInContainer && !start) || (!isAfterLastNodeInContainer && start);\n\t\t\t\t}\n\n\t\t\t\t// Walk the DOM and look for text nodes or non empty elements\n\t\t\t\twalker = new TreeWalker(container, parentBlock);\n\n\t\t\t\t// If caret is in beginning or end of a text block then jump to the next/previous node\n\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\tif (start && offset === 0) {\n\t\t\t\t\t\twalker.prev();\n\t\t\t\t\t} else if (!start && offset == container.nodeValue.length) {\n\t\t\t\t\t\twalker.next();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twhile ((node = walker.current())) {\n\t\t\t\t\tif (node.nodeType === 1) {\n\t\t\t\t\t\t// Ignore bogus elements\n\t\t\t\t\t\tif (!node.getAttribute('data-mce-bogus')) {\n\t\t\t\t\t\t\t// Keep empty elements like <img /> <input /> but not trailing br:s like <p>text|<br></p>\n\t\t\t\t\t\t\tname = node.nodeName.toLowerCase();\n\t\t\t\t\t\t\tif (nonEmptyElementsMap[name] && name !== 'br') {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (node.nodeType === 3 && !/^[ \\t\\r\\n]*$/.test(node.nodeValue)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (start) {\n\t\t\t\t\t\twalker.prev();\n\t\t\t\t\t} else {\n\t\t\t\t\t\twalker.next();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Wraps any text nodes or inline elements in the specified forced root block name\n\t\t\tfunction wrapSelfAndSiblingsInDefaultBlock(container, offset) {\n\t\t\t\tvar newBlock, parentBlock, startNode, node, next, rootBlockName, blockName = newBlockName || 'P';\n\n\t\t\t\t// Not in a block element or in a table cell or caption\n\t\t\t\tparentBlock = dom.getParent(container, dom.isBlock);\n\t\t\t\tif (!parentBlock || !canSplitBlock(parentBlock)) {\n\t\t\t\t\tparentBlock = parentBlock || editableRoot;\n\n\t\t\t\t\tif (parentBlock == editor.getBody() || isTableCell(parentBlock)) {\n\t\t\t\t\t\trootBlockName = parentBlock.nodeName.toLowerCase();\n\t\t\t\t\t} else {\n\t\t\t\t\t\trootBlockName = parentBlock.parentNode.nodeName.toLowerCase();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!parentBlock.hasChildNodes()) {\n\t\t\t\t\t\tnewBlock = dom.create(blockName);\n\t\t\t\t\t\tsetForcedBlockAttrs(newBlock);\n\t\t\t\t\t\tparentBlock.appendChild(newBlock);\n\t\t\t\t\t\trng.setStart(newBlock, 0);\n\t\t\t\t\t\trng.setEnd(newBlock, 0);\n\t\t\t\t\t\treturn newBlock;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Find parent that is the first child of parentBlock\n\t\t\t\t\tnode = container;\n\t\t\t\t\twhile (node.parentNode != parentBlock) {\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Loop left to find start node start wrapping at\n\t\t\t\t\twhile (node && !dom.isBlock(node)) {\n\t\t\t\t\t\tstartNode = node;\n\t\t\t\t\t\tnode = node.previousSibling;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (startNode && schema.isValidChild(rootBlockName, blockName.toLowerCase())) {\n\t\t\t\t\t\tnewBlock = dom.create(blockName);\n\t\t\t\t\t\tsetForcedBlockAttrs(newBlock);\n\t\t\t\t\t\tstartNode.parentNode.insertBefore(newBlock, startNode);\n\n\t\t\t\t\t\t// Start wrapping until we hit a block\n\t\t\t\t\t\tnode = startNode;\n\t\t\t\t\t\twhile (node && !dom.isBlock(node)) {\n\t\t\t\t\t\t\tnext = node.nextSibling;\n\t\t\t\t\t\t\tnewBlock.appendChild(node);\n\t\t\t\t\t\t\tnode = next;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Restore range to it's past location\n\t\t\t\t\t\trng.setStart(container, offset);\n\t\t\t\t\t\trng.setEnd(container, offset);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn container;\n\t\t\t}\n\n\t\t\t// Inserts a block or br before/after or in the middle of a split list of the LI is empty\n\t\t\tfunction handleEmptyListItem() {\n\t\t\t\tfunction isFirstOrLastLi(first) {\n\t\t\t\t\tvar node = containerBlock[first ? 'firstChild' : 'lastChild'];\n\n\t\t\t\t\t// Find first/last element since there might be whitespace there\n\t\t\t\t\twhile (node) {\n\t\t\t\t\t\tif (node.nodeType == 1) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node[first ? 'nextSibling' : 'previousSibling'];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node === parentBlock;\n\t\t\t\t}\n\n\t\t\t\tfunction getContainerBlock() {\n\t\t\t\t\tvar containerBlockParent = containerBlock.parentNode;\n\n\t\t\t\t\tif (/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)) {\n\t\t\t\t\t\treturn containerBlockParent;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn containerBlock;\n\t\t\t\t}\n\n\t\t\t\tif (containerBlock == editor.getBody()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Check if we are in an nested list\n\t\t\t\tvar containerBlockParentName = containerBlock.parentNode.nodeName;\n\t\t\t\tif (/^(OL|UL|LI)$/.test(containerBlockParentName)) {\n\t\t\t\t\tnewBlockName = 'LI';\n\t\t\t\t}\n\n\t\t\t\tnewBlock = newBlockName ? createNewBlock(newBlockName) : dom.create('BR');\n\n\t\t\t\tif (isFirstOrLastLi(true) && isFirstOrLastLi()) {\n\t\t\t\t\tif (containerBlockParentName == 'LI') {\n\t\t\t\t\t\t// Nested list is inside a LI\n\t\t\t\t\t\tdom.insertAfter(newBlock, getContainerBlock());\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Is first and last list item then replace the OL/UL with a text block\n\t\t\t\t\t\tdom.replace(newBlock, containerBlock);\n\t\t\t\t\t}\n\t\t\t\t} else if (isFirstOrLastLi(true)) {\n\t\t\t\t\tif (containerBlockParentName == 'LI') {\n\t\t\t\t\t\t// List nested in an LI then move the list to a new sibling LI\n\t\t\t\t\t\tdom.insertAfter(newBlock, getContainerBlock());\n\t\t\t\t\t\tnewBlock.appendChild(dom.doc.createTextNode(' ')); // Needed for IE so the caret can be placed\n\t\t\t\t\t\tnewBlock.appendChild(containerBlock);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// First LI in list then remove LI and add text block before list\n\t\t\t\t\t\tcontainerBlock.parentNode.insertBefore(newBlock, containerBlock);\n\t\t\t\t\t}\n\t\t\t\t} else if (isFirstOrLastLi()) {\n\t\t\t\t\t// Last LI in list then remove LI and add text block after list\n\t\t\t\t\tdom.insertAfter(newBlock, getContainerBlock());\n\t\t\t\t\trenderBlockOnIE(newBlock);\n\t\t\t\t} else {\n\t\t\t\t\t// Middle LI in list the split the list and insert a text block in the middle\n\t\t\t\t\t// Extract after fragment and insert it after the current block\n\t\t\t\t\tcontainerBlock = getContainerBlock();\n\t\t\t\t\ttmpRng = rng.cloneRange();\n\t\t\t\t\ttmpRng.setStartAfter(parentBlock);\n\t\t\t\t\ttmpRng.setEndAfter(containerBlock);\n\t\t\t\t\tfragment = tmpRng.extractContents();\n\n\t\t\t\t\tif (newBlockName == 'LI' && fragment.firstChild.nodeName == 'LI') {\n\t\t\t\t\t\tnewBlock = fragment.firstChild;\n\t\t\t\t\t\tdom.insertAfter(fragment, containerBlock);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdom.insertAfter(fragment, containerBlock);\n\t\t\t\t\t\tdom.insertAfter(newBlock, containerBlock);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tdom.remove(parentBlock);\n\t\t\t\tmoveToCaretPosition(newBlock);\n\t\t\t\tundoManager.add();\n\t\t\t}\n\n\t\t\t// Inserts a BR element if the forced_root_block option is set to false or empty string\n\t\t\tfunction insertBr() {\n\t\t\t\teditor.execCommand(\"InsertLineBreak\", false, evt);\n\t\t\t}\n\n\t\t\t// Trims any linebreaks at the beginning of node user for example when pressing enter in a PRE element\n\t\t\tfunction trimLeadingLineBreaks(node) {\n\t\t\t\tdo {\n\t\t\t\t\tif (node.nodeType === 3) {\n\t\t\t\t\t\tnode.nodeValue = node.nodeValue.replace(/^[\\r\\n]+/, '');\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.firstChild;\n\t\t\t\t} while (node);\n\t\t\t}\n\n\t\t\tfunction getEditableRoot(node) {\n\t\t\t\tvar root = dom.getRoot(), parent, editableRoot;\n\n\t\t\t\t// Get all parents until we hit a non editable parent or the root\n\t\t\t\tparent = node;\n\t\t\t\twhile (parent !== root && dom.getContentEditable(parent) !== \"false\") {\n\t\t\t\t\tif (dom.getContentEditable(parent) === \"true\") {\n\t\t\t\t\t\teditableRoot = parent;\n\t\t\t\t\t}\n\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn parent !== root ? editableRoot : root;\n\t\t\t}\n\n\t\t\t// Adds a BR at the end of blocks that only contains an IMG or INPUT since\n\t\t\t// these might be floated and then they won't expand the block\n\t\t\tfunction addBrToBlockIfNeeded(block) {\n\t\t\t\tvar lastChild;\n\n\t\t\t\t// IE will render the blocks correctly other browsers needs a BR\n\t\t\t\tif (!isIE) {\n\t\t\t\t\tblock.normalize(); // Remove empty text nodes that got left behind by the extract\n\n\t\t\t\t\t// Check if the block is empty or contains a floated last child\n\t\t\t\t\tlastChild = block.lastChild;\n\t\t\t\t\tif (!lastChild || (/^(left|right)$/gi.test(dom.getStyle(lastChild, 'float', true)))) {\n\t\t\t\t\t\tdom.add(block, 'br');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction insertNewBlockAfter() {\n\t\t\t\t// If the caret is at the end of a header we produce a P tag after it similar to Word unless we are in a hgroup\n\t\t\t\tif (/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName) && containerBlockName != 'HGROUP') {\n\t\t\t\t\tnewBlock = createNewBlock(newBlockName);\n\t\t\t\t} else {\n\t\t\t\t\tnewBlock = createNewBlock();\n\t\t\t\t}\n\n\t\t\t\t// Split the current container block element if enter is pressed inside an empty inner block element\n\t\t\t\tif (settings.end_container_on_empty_block && canSplitBlock(containerBlock) && dom.isEmpty(parentBlock)) {\n\t\t\t\t\t// Split container block for example a BLOCKQUOTE at the current blockParent location for example a P\n\t\t\t\t\tnewBlock = dom.split(containerBlock, parentBlock);\n\t\t\t\t} else {\n\t\t\t\t\tdom.insertAfter(newBlock, parentBlock);\n\t\t\t\t}\n\n\t\t\t\tmoveToCaretPosition(newBlock);\n\t\t\t}\n\n\t\t\trng = selection.getRng(true);\n\n\t\t\t// Event is blocked by some other handler for example the lists plugin\n\t\t\tif (evt.isDefaultPrevented()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Delete any selected contents\n\t\t\tif (!rng.collapsed) {\n\t\t\t\teditor.execCommand('Delete');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Setup range items and newBlockName\n\t\t\tnew RangeUtils(dom).normalize(rng);\n\t\t\tcontainer = rng.startContainer;\n\t\t\toffset = rng.startOffset;\n\t\t\tnewBlockName = (settings.force_p_newlines ? 'p' : '') || settings.forced_root_block;\n\t\t\tnewBlockName = newBlockName ? newBlockName.toUpperCase() : '';\n\t\t\tdocumentMode = dom.doc.documentMode;\n\t\t\tshiftKey = evt.shiftKey;\n\n\t\t\t// Resolve node index\n\t\t\tif (container.nodeType == 1 && container.hasChildNodes()) {\n\t\t\t\tisAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n\n\t\t\t\tcontainer = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n\t\t\t\tif (isAfterLastNodeInContainer && container.nodeType == 3) {\n\t\t\t\t\toffset = container.nodeValue.length;\n\t\t\t\t} else {\n\t\t\t\t\toffset = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Get editable root node, normally the body element but sometimes a div or span\n\t\t\teditableRoot = getEditableRoot(container);\n\n\t\t\t// If there is no editable root then enter is done inside a contentEditable false element\n\t\t\tif (!editableRoot) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tundoManager.beforeChange();\n\n\t\t\t// If editable root isn't block nor the root of the editor\n\t\t\tif (!dom.isBlock(editableRoot) && editableRoot != dom.getRoot()) {\n\t\t\t\tif (!newBlockName || shiftKey) {\n\t\t\t\t\tinsertBr();\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Wrap the current node and it's sibling in a default block if it's needed.\n\t\t\t// for example this <td>text|<b>text2</b></td> will become this <td><p>text|<b>text2</p></b></td>\n\t\t\t// This won't happen if root blocks are disabled or the shiftKey is pressed\n\t\t\tif ((newBlockName && !shiftKey) || (!newBlockName && shiftKey)) {\n\t\t\t\tcontainer = wrapSelfAndSiblingsInDefaultBlock(container, offset);\n\t\t\t}\n\n\t\t\t// Find parent block and setup empty block paddings\n\t\t\tparentBlock = dom.getParent(container, dom.isBlock);\n\t\t\tcontainerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n\n\t\t\t// Setup block names\n\t\t\tparentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\n\t\t\tcontainerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\n\n\t\t\t// Enter inside block contained within a LI then split or insert before/after LI\n\t\t\tif (containerBlockName == 'LI' && !evt.ctrlKey) {\n\t\t\t\tparentBlock = containerBlock;\n\t\t\t\tparentBlockName = containerBlockName;\n\t\t\t}\n\n\t\t\t// Handle enter in list item\n\t\t\tif (/^(LI|DT|DD)$/.test(parentBlockName)) {\n\t\t\t\tif (!newBlockName && shiftKey) {\n\t\t\t\t\tinsertBr();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Handle enter inside an empty list item\n\t\t\t\tif (dom.isEmpty(parentBlock)) {\n\t\t\t\t\thandleEmptyListItem();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Don't split PRE tags but insert a BR instead easier when writing code samples etc\n\t\t\tif (parentBlockName == 'PRE' && settings.br_in_pre !== false) {\n\t\t\t\tif (!shiftKey) {\n\t\t\t\t\tinsertBr();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// If no root block is configured then insert a BR by default or if the shiftKey is pressed\n\t\t\t\tif ((!newBlockName && !shiftKey && parentBlockName != 'LI') || (newBlockName && shiftKey)) {\n\t\t\t\t\tinsertBr();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If parent block is root then never insert new blocks\n\t\t\tif (newBlockName && parentBlock === editor.getBody()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Default block name if it's not configured\n\t\t\tnewBlockName = newBlockName || 'P';\n\n\t\t\t// Insert new block before/after the parent block depending on caret location\n\t\t\tif (isCaretAtStartOrEndOfBlock()) {\n\t\t\t\tinsertNewBlockAfter();\n\t\t\t} else if (isCaretAtStartOrEndOfBlock(true)) {\n\t\t\t\t// Insert new block before\n\t\t\t\tnewBlock = parentBlock.parentNode.insertBefore(createNewBlock(), parentBlock);\n\t\t\t\trenderBlockOnIE(newBlock);\n\t\t\t\tmoveToCaretPosition(parentBlock);\n\t\t\t} else {\n\t\t\t\t// Extract after fragment and insert it after the current block\n\t\t\t\ttmpRng = rng.cloneRange();\n\t\t\t\ttmpRng.setEndAfter(parentBlock);\n\t\t\t\tfragment = tmpRng.extractContents();\n\t\t\t\ttrimLeadingLineBreaks(fragment);\n\t\t\t\tnewBlock = fragment.firstChild;\n\t\t\t\tdom.insertAfter(fragment, parentBlock);\n\t\t\t\ttrimInlineElementsOnLeftSideOfBlock(newBlock);\n\t\t\t\taddBrToBlockIfNeeded(parentBlock);\n\n\t\t\t\tif (dom.isEmpty(parentBlock)) {\n\t\t\t\t\temptyBlock(parentBlock);\n\t\t\t\t}\n\n\t\t\t\tnewBlock.normalize();\n\n\t\t\t\t// New block might become empty if it's <p><b>a |</b></p>\n\t\t\t\tif (dom.isEmpty(newBlock)) {\n\t\t\t\t\tdom.remove(newBlock);\n\t\t\t\t\tinsertNewBlockAfter();\n\t\t\t\t} else {\n\t\t\t\t\tmoveToCaretPosition(newBlock);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdom.setAttrib(newBlock, 'id', ''); // Remove ID since it needs to be document unique\n\n\t\t\t// Allow custom handling of new blocks\n\t\t\teditor.fire('NewBlock', {newBlock: newBlock});\n\n\t\t\tundoManager.add();\n\t\t}\n\n\t\teditor.on('keydown', function(evt) {\n\t\t\tif (evt.keyCode == 13) {\n\t\t\t\tif (handleEnterKey(evt) !== false) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n});\n\n// Included from: js/tinymce/classes/ForceBlocks.js\n\n/**\n * ForceBlocks.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Makes sure that everything gets wrapped in paragraphs.\n *\n * @private\n * @class tinymce.ForceBlocks\n */\ndefine(\"tinymce/ForceBlocks\", [], function() {\n\treturn function(editor) {\n\t\tvar settings = editor.settings, dom = editor.dom, selection = editor.selection;\n\t\tvar schema = editor.schema, blockElements = schema.getBlockElements();\n\n\t\tfunction addRootBlocks() {\n\t\t\tvar node = selection.getStart(), rootNode = editor.getBody(), rng;\n\t\t\tvar startContainer, startOffset, endContainer, endOffset, rootBlockNode;\n\t\t\tvar tempNode, offset = -0xFFFFFF, wrapped, restoreSelection;\n\t\t\tvar tmpRng, rootNodeName, forcedRootBlock;\n\n\t\t\tforcedRootBlock = settings.forced_root_block;\n\n\t\t\tif (!node || node.nodeType !== 1 || !forcedRootBlock) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if node is wrapped in block\n\t\t\twhile (node && node != rootNode) {\n\t\t\t\tif (blockElements[node.nodeName]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\t// Get current selection\n\t\t\trng = selection.getRng();\n\t\t\tif (rng.setStart) {\n\t\t\t\tstartContainer = rng.startContainer;\n\t\t\t\tstartOffset = rng.startOffset;\n\t\t\t\tendContainer = rng.endContainer;\n\t\t\t\tendOffset = rng.endOffset;\n\n\t\t\t\ttry {\n\t\t\t\t\trestoreSelection = editor.getDoc().activeElement === rootNode;\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// IE throws unspecified error here sometimes\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Force control range into text range\n\t\t\t\tif (rng.item) {\n\t\t\t\t\tnode = rng.item(0);\n\t\t\t\t\trng = editor.getDoc().body.createTextRange();\n\t\t\t\t\trng.moveToElementText(node);\n\t\t\t\t}\n\n\t\t\t\trestoreSelection = rng.parentElement().ownerDocument === editor.getDoc();\n\t\t\t\ttmpRng = rng.duplicate();\n\t\t\t\ttmpRng.collapse(true);\n\t\t\t\tstartOffset = tmpRng.move('character', offset) * -1;\n\n\t\t\t\tif (!tmpRng.collapsed) {\n\t\t\t\t\ttmpRng = rng.duplicate();\n\t\t\t\t\ttmpRng.collapse(false);\n\t\t\t\t\tendOffset = (tmpRng.move('character', offset) * -1) - startOffset;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Wrap non block elements and text nodes\n\t\t\tnode = rootNode.firstChild;\n\t\t\trootNodeName = rootNode.nodeName.toLowerCase();\n\t\t\twhile (node) {\n\t\t\t\t// TODO: Break this up, too complex\n\t\t\t\tif (((node.nodeType === 3 || (node.nodeType == 1 && !blockElements[node.nodeName]))) &&\n\t\t\t\t\tschema.isValidChild(rootNodeName, forcedRootBlock.toLowerCase())) {\n\t\t\t\t\t// Remove empty text nodes\n\t\t\t\t\tif (node.nodeType === 3 && node.nodeValue.length === 0) {\n\t\t\t\t\t\ttempNode = node;\n\t\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t\t\tdom.remove(tempNode);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!rootBlockNode) {\n\t\t\t\t\t\trootBlockNode = dom.create(forcedRootBlock, editor.settings.forced_root_block_attrs);\n\t\t\t\t\t\tnode.parentNode.insertBefore(rootBlockNode, node);\n\t\t\t\t\t\twrapped = true;\n\t\t\t\t\t}\n\n\t\t\t\t\ttempNode = node;\n\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t\trootBlockNode.appendChild(tempNode);\n\t\t\t\t} else {\n\t\t\t\t\trootBlockNode = null;\n\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (wrapped && restoreSelection) {\n\t\t\t\tif (rng.setStart) {\n\t\t\t\t\trng.setStart(startContainer, startOffset);\n\t\t\t\t\trng.setEnd(endContainer, endOffset);\n\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t} else {\n\t\t\t\t\t// Only select if the previous selection was inside the document to prevent auto focus in quirks mode\n\t\t\t\t\ttry {\n\t\t\t\t\t\trng = editor.getDoc().body.createTextRange();\n\t\t\t\t\t\trng.moveToElementText(rootNode);\n\t\t\t\t\t\trng.collapse(true);\n\t\t\t\t\t\trng.moveStart('character', startOffset);\n\n\t\t\t\t\t\tif (endOffset > 0) {\n\t\t\t\t\t\t\trng.moveEnd('character', endOffset);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\trng.select();\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// Ignore\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\t\t}\n\n\t\t// Force root blocks\n\t\tif (settings.forced_root_block) {\n\t\t\teditor.on('NodeChange', addRootBlocks);\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/CaretUtils.js\n\n/**\n * CaretUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility functions shared by the caret logic.\n *\n * @private\n * @class tinymce.caret.CaretUtils\n */\ndefine(\"tinymce/caret/CaretUtils\", [\n\t\"tinymce/util/Fun\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/caret/CaretCandidate\"\n], function(Fun, TreeWalker, NodeType, CaretPosition, CaretContainer, CaretCandidate) {\n\tvar isContentEditableTrue = NodeType.isContentEditableTrue,\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisBlockLike = NodeType.matchStyleValues('display', 'block table table-cell table-caption'),\n\t\tisCaretContainer = CaretContainer.isCaretContainer,\n\t\tcurry = Fun.curry,\n\t\tisElement = NodeType.isElement,\n\t\tisCaretCandidate = CaretCandidate.isCaretCandidate;\n\n\tfunction isForwards(direction) {\n\t\treturn direction > 0;\n\t}\n\n\tfunction isBackwards(direction) {\n\t\treturn direction < 0;\n\t}\n\n\tfunction findNode(node, direction, predicateFn, rootNode, shallow) {\n\t\tvar walker = new TreeWalker(node, rootNode);\n\n\t\tif (isBackwards(direction)) {\n\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\tnode = walker.prev(true);\n\t\t\t\tif (predicateFn(node)) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile ((node = walker.prev(shallow))) {\n\t\t\t\tif (predicateFn(node)) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (isForwards(direction)) {\n\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\tnode = walker.next(true);\n\t\t\t\tif (predicateFn(node)) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile ((node = walker.next(shallow))) {\n\t\t\t\tif (predicateFn(node)) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction getEditingHost(node, rootNode) {\n\t\tfor (node = node.parentNode; node && node != rootNode; node = node.parentNode) {\n\t\t\tif (isContentEditableTrue(node)) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\n\t\treturn rootNode;\n\t}\n\n\tfunction getParentBlock(node, rootNode) {\n\t\twhile (node && node != rootNode) {\n\t\t\tif (isBlockLike(node)) {\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction isInSameBlock(caretPosition1, caretPosition2, rootNode) {\n\t\treturn getParentBlock(caretPosition1.container(), rootNode) == getParentBlock(caretPosition2.container(), rootNode);\n\t}\n\n\tfunction isInSameEditingHost(caretPosition1, caretPosition2, rootNode) {\n\t\treturn getEditingHost(caretPosition1.container(), rootNode) == getEditingHost(caretPosition2.container(), rootNode);\n\t}\n\n\tfunction getChildNodeAtRelativeOffset(relativeOffset, caretPosition) {\n\t\tvar container, offset;\n\n\t\tif (!caretPosition) {\n\t\t\treturn null;\n\t\t}\n\n\t\tcontainer = caretPosition.container();\n\t\toffset = caretPosition.offset();\n\n\t\tif (!isElement(container)) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn container.childNodes[offset + relativeOffset];\n\t}\n\n\tfunction beforeAfter(before, node) {\n\t\tvar range = node.ownerDocument.createRange();\n\n\t\tif (before) {\n\t\t\trange.setStartBefore(node);\n\t\t\trange.setEndBefore(node);\n\t\t} else {\n\t\t\trange.setStartAfter(node);\n\t\t\trange.setEndAfter(node);\n\t\t}\n\n\t\treturn range;\n\t}\n\n\tfunction isNodesInSameBlock(rootNode, node1, node2) {\n\t\treturn getParentBlock(node1, rootNode) == getParentBlock(node2, rootNode);\n\t}\n\n\tfunction lean(left, rootNode, node) {\n\t\tvar sibling, siblingName;\n\n\t\tif (left) {\n\t\t\tsiblingName = 'previousSibling';\n\t\t} else {\n\t\t\tsiblingName = 'nextSibling';\n\t\t}\n\n\t\twhile (node && node != rootNode) {\n\t\t\tsibling = node[siblingName];\n\n\t\t\tif (isCaretContainer(sibling)) {\n\t\t\t\tsibling = sibling[siblingName];\n\t\t\t}\n\n\t\t\tif (isContentEditableFalse(sibling)) {\n\t\t\t\tif (isNodesInSameBlock(rootNode, sibling, node)) {\n\t\t\t\t\treturn sibling;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (isCaretCandidate(sibling)) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tvar before = curry(beforeAfter, true);\n\tvar after = curry(beforeAfter, false);\n\n\tfunction normalizeRange(direction, rootNode, range) {\n\t\tvar node, container, offset, location;\n\t\tvar leanLeft = curry(lean, true, rootNode);\n\t\tvar leanRight = curry(lean, false, rootNode);\n\n\t\tcontainer = range.startContainer;\n\t\toffset = range.startOffset;\n\n\t\tif (CaretContainer.isCaretContainerBlock(container)) {\n\t\t\tif (!isElement(container)) {\n\t\t\t\tcontainer = container.parentNode;\n\t\t\t}\n\n\t\t\tlocation = container.getAttribute('data-mce-caret');\n\n\t\t\tif (location == 'before') {\n\t\t\t\tnode = container.nextSibling;\n\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\treturn before(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (location == 'after') {\n\t\t\t\tnode = container.previousSibling;\n\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\treturn after(node);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!range.collapsed) {\n\t\t\treturn range;\n\t\t}\n\n\t\tif (NodeType.isText(container)) {\n\t\t\tif (isCaretContainer(container)) {\n\t\t\t\tif (direction === 1) {\n\t\t\t\t\tnode = leanRight(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn before(node);\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = leanLeft(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn after(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (direction === -1) {\n\t\t\t\t\tnode = leanLeft(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn after(node);\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = leanRight(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn before(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tif (CaretContainer.endsWithCaretContainer(container) && offset >= container.data.length - 1) {\n\t\t\t\tif (direction === 1) {\n\t\t\t\t\tnode = leanRight(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn before(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tif (CaretContainer.startsWithCaretContainer(container) && offset <= 1) {\n\t\t\t\tif (direction === -1) {\n\t\t\t\t\tnode = leanLeft(container);\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn after(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tif (offset === container.data.length) {\n\t\t\t\tnode = leanRight(container);\n\t\t\t\tif (node) {\n\t\t\t\t\treturn before(node);\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tif (offset === 0) {\n\t\t\t\tnode = leanLeft(container);\n\t\t\t\tif (node) {\n\t\t\t\t\treturn after(node);\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t}\n\t\t}\n\n\t\treturn range;\n\t}\n\n\tfunction isNextToContentEditableFalse(relativeOffset, caretPosition) {\n\t\treturn isContentEditableFalse(getChildNodeAtRelativeOffset(relativeOffset, caretPosition));\n\t}\n\n\treturn {\n\t\tisForwards: isForwards,\n\t\tisBackwards: isBackwards,\n\t\tfindNode: findNode,\n\t\tgetEditingHost: getEditingHost,\n\t\tgetParentBlock: getParentBlock,\n\t\tisInSameBlock: isInSameBlock,\n\t\tisInSameEditingHost: isInSameEditingHost,\n\t\tisBeforeContentEditableFalse: curry(isNextToContentEditableFalse, 0),\n\t\tisAfterContentEditableFalse: curry(isNextToContentEditableFalse, -1),\n\t\tnormalizeRange: normalizeRange\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/CaretWalker.js\n\n/**\n * CaretWalker.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic for moving around a virtual caret in logical order within a DOM element.\n *\n * It ignores the most obvious invalid caret locations such as within a script element or within a\n * contentEditable=false element but it will return locations that isn't possible to render visually.\n *\n * @private\n * @class tinymce.caret.CaretWalker\n * @example\n * var caretWalker = new CaretWalker(rootElm);\n *\n * var prevLogicalCaretPosition = caretWalker.prev(CaretPosition.fromRangeStart(range));\n * var nextLogicalCaretPosition = caretWalker.next(CaretPosition.fromRangeEnd(range));\n */\ndefine(\"tinymce/caret/CaretWalker\", [\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/caret/CaretCandidate\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/caret/CaretUtils\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Fun\"\n], function(NodeType, CaretCandidate, CaretPosition, CaretUtils, Arr, Fun) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisText = NodeType.isText,\n\t\tisElement = NodeType.isElement,\n\t\tisBr = NodeType.isBr,\n\t\tisForwards = CaretUtils.isForwards,\n\t\tisBackwards = CaretUtils.isBackwards,\n\t\tisCaretCandidate = CaretCandidate.isCaretCandidate,\n\t\tisAtomic = CaretCandidate.isAtomic,\n\t\tisEditableCaretCandidate = CaretCandidate.isEditableCaretCandidate;\n\n\tfunction getParents(node, rootNode) {\n\t\tvar parents = [];\n\n\t\twhile (node && node != rootNode) {\n\t\t\tparents.push(node);\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn parents;\n\t}\n\n\tfunction nodeAtIndex(container, offset) {\n\t\tif (container.hasChildNodes() && offset < container.childNodes.length) {\n\t\t\treturn container.childNodes[offset];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction getCaretCandidatePosition(direction, node) {\n\t\tif (isForwards(direction)) {\n\t\t\tif (isCaretCandidate(node.previousSibling) && !isText(node.previousSibling)) {\n\t\t\t\treturn CaretPosition.before(node);\n\t\t\t}\n\n\t\t\tif (isText(node)) {\n\t\t\t\treturn CaretPosition(node, 0);\n\t\t\t}\n\t\t}\n\n\t\tif (isBackwards(direction)) {\n\t\t\tif (isCaretCandidate(node.nextSibling) && !isText(node.nextSibling)) {\n\t\t\t\treturn CaretPosition.after(node);\n\t\t\t}\n\n\t\t\tif (isText(node)) {\n\t\t\t\treturn CaretPosition(node, node.data.length);\n\t\t\t}\n\t\t}\n\n\t\tif (isBackwards(direction)) {\n\t\t\tif (isBr(node)) {\n\t\t\t\treturn CaretPosition.before(node);\n\t\t\t}\n\n\t\t\treturn CaretPosition.after(node);\n\t\t}\n\n\t\treturn CaretPosition.before(node);\n\t}\n\n\t// Jumps over BR elements <p>|<br></p><p>a</p> -> <p><br></p><p>|a</p>\n\tfunction isBrBeforeBlock(node, rootNode) {\n\t\tvar next;\n\n\t\tif (!NodeType.isBr(node)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tnext = findCaretPosition(1, CaretPosition.after(node), rootNode);\n\t\tif (!next) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !CaretUtils.isInSameBlock(CaretPosition.before(node), CaretPosition.before(next), rootNode);\n\t}\n\n\tfunction findCaretPosition(direction, startCaretPosition, rootNode) {\n\t\tvar container, offset, node, nextNode, innerNode,\n\t\t\trootContentEditableFalseElm, caretPosition;\n\n\t\tif (!isElement(rootNode) || !startCaretPosition) {\n\t\t\treturn null;\n\t\t}\n\n\t\tcaretPosition = startCaretPosition;\n\t\tcontainer = caretPosition.container();\n\t\toffset = caretPosition.offset();\n\n\t\tif (isText(container)) {\n\t\t\tif (isBackwards(direction) && offset > 0) {\n\t\t\t\treturn CaretPosition(container, --offset);\n\t\t\t}\n\n\t\t\tif (isForwards(direction) && offset < container.length) {\n\t\t\t\treturn CaretPosition(container, ++offset);\n\t\t\t}\n\n\t\t\tnode = container;\n\t\t} else {\n\t\t\tif (isBackwards(direction) && offset > 0) {\n\t\t\t\tnextNode = nodeAtIndex(container, offset - 1);\n\t\t\t\tif (isCaretCandidate(nextNode)) {\n\t\t\t\t\tif (!isAtomic(nextNode)) {\n\t\t\t\t\t\tinnerNode = CaretUtils.findNode(nextNode, direction, isEditableCaretCandidate, nextNode);\n\t\t\t\t\t\tif (innerNode) {\n\t\t\t\t\t\t\tif (isText(innerNode)) {\n\t\t\t\t\t\t\t\treturn CaretPosition(innerNode, innerNode.data.length);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn CaretPosition.after(innerNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isText(nextNode)) {\n\t\t\t\t\t\treturn CaretPosition(nextNode, nextNode.data.length);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn CaretPosition.before(nextNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (isForwards(direction) && offset < container.childNodes.length) {\n\t\t\t\tnextNode = nodeAtIndex(container, offset);\n\t\t\t\tif (isCaretCandidate(nextNode)) {\n\t\t\t\t\tif (isBrBeforeBlock(nextNode, rootNode)) {\n\t\t\t\t\t\treturn findCaretPosition(direction, CaretPosition.after(nextNode), rootNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!isAtomic(nextNode)) {\n\t\t\t\t\t\tinnerNode = CaretUtils.findNode(nextNode, direction, isEditableCaretCandidate, nextNode);\n\t\t\t\t\t\tif (innerNode) {\n\t\t\t\t\t\t\tif (isText(innerNode)) {\n\t\t\t\t\t\t\t\treturn CaretPosition(innerNode, 0);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn CaretPosition.before(innerNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isText(nextNode)) {\n\t\t\t\t\t\treturn CaretPosition(nextNode, 0);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn CaretPosition.after(nextNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tnode = caretPosition.getNode();\n\t\t}\n\n\t\tif ((isForwards(direction) && caretPosition.isAtEnd()) || (isBackwards(direction) && caretPosition.isAtStart())) {\n\t\t\tnode = CaretUtils.findNode(node, direction, Fun.constant(true), rootNode, true);\n\t\t\tif (isEditableCaretCandidate(node)) {\n\t\t\t\treturn getCaretCandidatePosition(direction, node);\n\t\t\t}\n\t\t}\n\n\t\tnextNode = CaretUtils.findNode(node, direction, isEditableCaretCandidate, rootNode);\n\n\t\trootContentEditableFalseElm = Arr.last(Arr.filter(getParents(container, rootNode), isContentEditableFalse));\n\t\tif (rootContentEditableFalseElm && (!nextNode || !rootContentEditableFalseElm.contains(nextNode))) {\n\t\t\tif (isForwards(direction)) {\n\t\t\t\tcaretPosition = CaretPosition.after(rootContentEditableFalseElm);\n\t\t\t} else {\n\t\t\t\tcaretPosition = CaretPosition.before(rootContentEditableFalseElm);\n\t\t\t}\n\n\t\t\treturn caretPosition;\n\t\t}\n\n\t\tif (nextNode) {\n\t\t\treturn getCaretCandidatePosition(direction, nextNode);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\treturn function(rootNode) {\n\t\treturn {\n\t\t\t/**\n\t\t\t * Returns the next logical caret position from the specificed input\n\t\t\t * caretPoisiton or null if there isn't any more positions left for example\n\t\t\t * at the end specified root element.\n\t\t\t *\n\t\t\t * @method next\n\t\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position to start from.\n\t\t\t * @return {tinymce.caret.CaretPosition} CaretPosition or null if no position was found.\n\t\t\t */\n\t\t\tnext: function(caretPosition) {\n\t\t\t\treturn findCaretPosition(1, caretPosition, rootNode);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Returns the previous logical caret position from the specificed input\n\t\t\t * caretPoisiton or null if there isn't any more positions left for example\n\t\t\t * at the end specified root element.\n\t\t\t *\n\t\t\t * @method prev\n\t\t\t * @param {tinymce.caret.CaretPosition} caretPosition Caret position to start from.\n\t\t\t * @return {tinymce.caret.CaretPosition} CaretPosition or null if no position was found.\n\t\t\t */\n\t\t\tprev: function(caretPosition) {\n\t\t\t\treturn findCaretPosition(-1, caretPosition, rootNode);\n\t\t\t}\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/InsertList.js\n\n/**\n * InsertList.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Handles inserts of lists into the editor instance.\n *\n * @class tinymce.InsertList\n * @private\n */\ndefine(\"tinymce/InsertList\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/caret/CaretWalker\",\n\t\"tinymce/caret/CaretPosition\"\n], function(Tools, CaretWalker, CaretPosition) {\n\tvar isListFragment = function(fragment) {\n\t\tvar firstChild = fragment.firstChild;\n\t\tvar lastChild = fragment.lastChild;\n\n\t\t// Skip meta since it's likely <meta><ul>..</ul>\n\t\tif (firstChild && firstChild.name === 'meta') {\n\t\t\tfirstChild = firstChild.next;\n\t\t}\n\n\t\t// Skip mce_marker since it's likely <ul>..</ul><span id=\"mce_marker\"></span>\n\t\tif (lastChild && lastChild.attr('id') === 'mce_marker') {\n\t\t\tlastChild = lastChild.prev;\n\t\t}\n\n\t\tif (!firstChild || firstChild !== lastChild) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn firstChild.name === 'ul' || firstChild.name === 'ol';\n\t};\n\n\tvar cleanupDomFragment = function (domFragment) {\n\t\tvar firstChild = domFragment.firstChild;\n\t\tvar lastChild = domFragment.lastChild;\n\n\t\t// TODO: remove the meta tag from paste logic\n\t\tif (firstChild && firstChild.nodeName === 'META') {\n\t\t\tfirstChild.parentNode.removeChild(firstChild);\n\t\t}\n\n\t\tif (lastChild && lastChild.id === 'mce_marker') {\n\t\t\tlastChild.parentNode.removeChild(lastChild);\n\t\t}\n\n\t\treturn domFragment;\n\t};\n\n\tvar toDomFragment = function(dom, serializer, fragment) {\n\t\tvar html = serializer.serialize(fragment);\n\t\tvar domFragment = dom.createFragment(html);\n\n\t\treturn cleanupDomFragment(domFragment);\n\t};\n\n\tvar listItems = function(elm) {\n\t\treturn Tools.grep(elm.childNodes, function(child) {\n\t\t\treturn child.nodeName === 'LI';\n\t\t});\n\t};\n\n\tvar isEmpty = function (elm) {\n\t\treturn !elm.firstChild;\n\t};\n\n\tvar trimListItems = function(elms) {\n\t\treturn elms.length > 0 && isEmpty(elms[elms.length - 1]) ? elms.slice(0, -1) : elms;\n\t};\n\n\tvar getParentLi = function(dom, node) {\n\t\tvar parentBlock = dom.getParent(node, dom.isBlock);\n\t\treturn parentBlock && parentBlock.nodeName === 'LI' ? parentBlock : null;\n\t};\n\n\tvar isParentBlockLi = function(dom, node) {\n\t\treturn !!getParentLi(dom, node);\n\t};\n\n\tvar getSplit = function(parentNode, rng) {\n\t\tvar beforeRng = rng.cloneRange();\n\t\tvar afterRng = rng.cloneRange();\n\n\t\tbeforeRng.setStartBefore(parentNode);\n\t\tafterRng.setEndAfter(parentNode);\n\n\t\treturn [\n\t\t\tbeforeRng.cloneContents(),\n\t\t\tafterRng.cloneContents()\n\t\t];\n\t};\n\n\tvar findFirstIn = function(node, rootNode) {\n\t\tvar caretPos = CaretPosition.before(node);\n\t\tvar caretWalker = new CaretWalker(rootNode);\n\t\tvar newCaretPos = caretWalker.next(caretPos);\n\n\t\treturn newCaretPos ? newCaretPos.toRange() : null;\n\t};\n\n\tvar findLastOf = function(node, rootNode) {\n\t\tvar caretPos = CaretPosition.after(node);\n\t\tvar caretWalker = new CaretWalker(rootNode);\n\t\tvar newCaretPos = caretWalker.prev(caretPos);\n\n\t\treturn newCaretPos ? newCaretPos.toRange() : null;\n\t};\n\n\tvar insertMiddle = function(target, elms, rootNode, rng) {\n\t\tvar parts = getSplit(target, rng);\n\t\tvar parentElm = target.parentNode;\n\n\t\tparentElm.insertBefore(parts[0], target);\n\t\tTools.each(elms, function(li) {\n\t\t\tparentElm.insertBefore(li, target);\n\t\t});\n\t\tparentElm.insertBefore(parts[1], target);\n\t\tparentElm.removeChild(target);\n\n\t\treturn findLastOf(elms[elms.length - 1], rootNode);\n\t};\n\n\tvar insertBefore = function(target, elms, rootNode) {\n\t\tvar parentElm = target.parentNode;\n\n\t\tTools.each(elms, function(elm) {\n\t\t\tparentElm.insertBefore(elm, target);\n\t\t});\n\n\t\treturn findFirstIn(target, rootNode);\n\t};\n\n\tvar insertAfter = function(target, elms, rootNode, dom) {\n\t\tdom.insertAfter(elms.reverse(), target);\n\t\treturn findLastOf(elms[0], rootNode);\n\t};\n\n\tvar insertAtCaret = function(serializer, dom, rng, fragment) {\n\t\tvar domFragment = toDomFragment(dom, serializer, fragment);\n\t\tvar liTarget = getParentLi(dom, rng.startContainer);\n\t\tvar liElms = trimListItems(listItems(domFragment.firstChild));\n\t\tvar BEGINNING = 1, END = 2;\n\t\tvar rootNode = dom.getRoot();\n\n\t\tvar isAt = function(location) {\n\t\t\tvar caretPos = CaretPosition.fromRangeStart(rng);\n\t\t\tvar caretWalker = new CaretWalker(dom.getRoot());\n\t\t\tvar newPos = location === BEGINNING ? caretWalker.prev(caretPos) : caretWalker.next(caretPos);\n\n\t\t\treturn newPos ? getParentLi(dom, newPos.getNode()) !== liTarget : true;\n\t\t};\n\n\t\tif (isAt(BEGINNING)) {\n\t\t\treturn insertBefore(liTarget, liElms, rootNode);\n\t\t} else if (isAt(END)) {\n\t\t\treturn insertAfter(liTarget, liElms, rootNode, dom);\n\t\t}\n\n\t\treturn insertMiddle(liTarget, liElms, rootNode, rng);\n\t};\n\n\treturn {\n\t\tisListFragment: isListFragment,\n\t\tinsertAtCaret: insertAtCaret,\n\t\tisParentBlockLi: isParentBlockLi,\n\t\ttrimListItems: trimListItems,\n\t\tlistItems: listItems\n\t};\n});\n\n// Included from: js/tinymce/classes/InsertContent.js\n\n/**\n * InsertContent.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Handles inserts of contents into the editor instance.\n *\n * @class tinymce.InsertContent\n * @private\n */\ndefine(\"tinymce/InsertContent\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/html/Serializer\",\n\t\"tinymce/caret/CaretWalker\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/dom/ElementUtils\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/InsertList\"\n], function(Env, Tools, Serializer, CaretWalker, CaretPosition, ElementUtils, NodeType, InsertList) {\n\tvar isTableCell = NodeType.matchNodeNames('td th');\n\n\tvar insertHtmlAtCaret = function(editor, value, details) {\n\t\tvar parser, serializer, parentNode, rootNode, fragment, args;\n\t\tvar marker, rng, node, node2, bookmarkHtml, merge;\n\t\tvar textInlineElements = editor.schema.getTextInlineElements();\n\t\tvar selection = editor.selection, dom = editor.dom;\n\n\t\tfunction trimOrPaddLeftRight(html) {\n\t\t\tvar rng, container, offset;\n\n\t\t\trng = selection.getRng(true);\n\t\t\tcontainer = rng.startContainer;\n\t\t\toffset = rng.startOffset;\n\n\t\t\tfunction hasSiblingText(siblingName) {\n\t\t\t\treturn container[siblingName] && container[siblingName].nodeType == 3;\n\t\t\t}\n\n\t\t\tif (container.nodeType == 3) {\n\t\t\t\tif (offset > 0) {\n\t\t\t\t\thtml = html.replace(/^&nbsp;/, ' ');\n\t\t\t\t} else if (!hasSiblingText('previousSibling')) {\n\t\t\t\t\thtml = html.replace(/^ /, '&nbsp;');\n\t\t\t\t}\n\n\t\t\t\tif (offset < container.length) {\n\t\t\t\t\thtml = html.replace(/&nbsp;(<br>|)$/, ' ');\n\t\t\t\t} else if (!hasSiblingText('nextSibling')) {\n\t\t\t\t\thtml = html.replace(/(&nbsp;| )(<br>|)$/, '&nbsp;');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn html;\n\t\t}\n\n\t\t// Removes &nbsp; from a [b] c -> a &nbsp;c -> a c\n\t\tfunction trimNbspAfterDeleteAndPaddValue() {\n\t\t\tvar rng, container, offset;\n\n\t\t\trng = selection.getRng(true);\n\t\t\tcontainer = rng.startContainer;\n\t\t\toffset = rng.startOffset;\n\n\t\t\tif (container.nodeType == 3 && rng.collapsed) {\n\t\t\t\tif (container.data[offset] === '\\u00a0') {\n\t\t\t\t\tcontainer.deleteData(offset, 1);\n\n\t\t\t\t\tif (!/[\\u00a0| ]$/.test(value)) {\n\t\t\t\t\t\tvalue += ' ';\n\t\t\t\t\t}\n\t\t\t\t} else if (container.data[offset - 1] === '\\u00a0') {\n\t\t\t\t\tcontainer.deleteData(offset - 1, 1);\n\n\t\t\t\t\tif (!/[\\u00a0| ]$/.test(value)) {\n\t\t\t\t\t\tvalue = ' ' + value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction reduceInlineTextElements() {\n\t\t\tif (merge) {\n\t\t\t\tvar root = editor.getBody(), elementUtils = new ElementUtils(dom);\n\n\t\t\t\tTools.each(dom.select('*[data-mce-fragment]'), function(node) {\n\t\t\t\t\tfor (var testNode = node.parentNode; testNode && testNode != root; testNode = testNode.parentNode) {\n\t\t\t\t\t\tif (textInlineElements[node.nodeName.toLowerCase()] && elementUtils.compare(testNode, node)) {\n\t\t\t\t\t\t\tdom.remove(node, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction markFragmentElements(fragment) {\n\t\t\tvar node = fragment;\n\n\t\t\twhile ((node = node.walk())) {\n\t\t\t\tif (node.type === 1) {\n\t\t\t\t\tnode.attr('data-mce-fragment', '1');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction umarkFragmentElements(elm) {\n\t\t\tTools.each(elm.getElementsByTagName('*'), function(elm) {\n\t\t\t\telm.removeAttribute('data-mce-fragment');\n\t\t\t});\n\t\t}\n\n\t\tfunction isPartOfFragment(node) {\n\t\t\treturn !!node.getAttribute('data-mce-fragment');\n\t\t}\n\n\t\tfunction canHaveChildren(node) {\n\t\t\treturn node && !editor.schema.getShortEndedElements()[node.nodeName];\n\t\t}\n\n\t\tfunction moveSelectionToMarker(marker) {\n\t\t\tvar parentEditableFalseElm, parentBlock, nextRng;\n\n\t\t\tfunction getContentEditableFalseParent(node) {\n\t\t\t\tvar root = editor.getBody();\n\n\t\t\t\tfor (; node && node !== root; node = node.parentNode) {\n\t\t\t\t\tif (editor.dom.getContentEditable(node) === 'false') {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (!marker) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tselection.scrollIntoView(marker);\n\n\t\t\t// If marker is in cE=false then move selection to that element instead\n\t\t\tparentEditableFalseElm = getContentEditableFalseParent(marker);\n\t\t\tif (parentEditableFalseElm) {\n\t\t\t\tdom.remove(marker);\n\t\t\t\tselection.select(parentEditableFalseElm);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Move selection before marker and remove it\n\t\t\trng = dom.createRng();\n\n\t\t\t// If previous sibling is a text node set the selection to the end of that node\n\t\t\tnode = marker.previousSibling;\n\t\t\tif (node && node.nodeType == 3) {\n\t\t\t\trng.setStart(node, node.nodeValue.length);\n\n\t\t\t\t// TODO: Why can't we normalize on IE\n\t\t\t\tif (!Env.ie) {\n\t\t\t\t\tnode2 = marker.nextSibling;\n\t\t\t\t\tif (node2 && node2.nodeType == 3) {\n\t\t\t\t\t\tnode.appendData(node2.data);\n\t\t\t\t\t\tnode2.parentNode.removeChild(node2);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// If the previous sibling isn't a text node or doesn't exist set the selection before the marker node\n\t\t\t\trng.setStartBefore(marker);\n\t\t\t\trng.setEndBefore(marker);\n\t\t\t}\n\n\t\t\tfunction findNextCaretRng(rng) {\n\t\t\t\tvar caretPos = CaretPosition.fromRangeStart(rng);\n\t\t\t\tvar caretWalker = new CaretWalker(editor.getBody());\n\n\t\t\t\tcaretPos = caretWalker.next(caretPos);\n\t\t\t\tif (caretPos) {\n\t\t\t\t\treturn caretPos.toRange();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove the marker node and set the new range\n\t\t\tparentBlock = dom.getParent(marker, dom.isBlock);\n\t\t\tdom.remove(marker);\n\n\t\t\tif (parentBlock && dom.isEmpty(parentBlock)) {\n\t\t\t\teditor.$(parentBlock).empty();\n\n\t\t\t\trng.setStart(parentBlock, 0);\n\t\t\t\trng.setEnd(parentBlock, 0);\n\n\t\t\t\tif (!isTableCell(parentBlock) && !isPartOfFragment(parentBlock) && (nextRng = findNextCaretRng(rng))) {\n\t\t\t\t\trng = nextRng;\n\t\t\t\t\tdom.remove(parentBlock);\n\t\t\t\t} else {\n\t\t\t\t\tdom.add(parentBlock, dom.create('br', {'data-mce-bogus': '1'}));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tselection.setRng(rng);\n\t\t}\n\n\t\t// Check for whitespace before/after value\n\t\tif (/^ | $/.test(value)) {\n\t\t\tvalue = trimOrPaddLeftRight(value);\n\t\t}\n\n\t\t// Setup parser and serializer\n\t\tparser = editor.parser;\n\t\tmerge = details.merge;\n\n\t\tserializer = new Serializer({\n\t\t\tvalidate: editor.settings.validate\n\t\t}, editor.schema);\n\t\tbookmarkHtml = '<span id=\"mce_marker\" data-mce-type=\"bookmark\">&#xFEFF;&#x200B;</span>';\n\n\t\t// Run beforeSetContent handlers on the HTML to be inserted\n\t\targs = {content: value, format: 'html', selection: true};\n\t\teditor.fire('BeforeSetContent', args);\n\t\tvalue = args.content;\n\n\t\t// Add caret at end of contents if it's missing\n\t\tif (value.indexOf('{$caret}') == -1) {\n\t\t\tvalue += '{$caret}';\n\t\t}\n\n\t\t// Replace the caret marker with a span bookmark element\n\t\tvalue = value.replace(/\\{\\$caret\\}/, bookmarkHtml);\n\n\t\t// If selection is at <body>|<p></p> then move it into <body><p>|</p>\n\t\trng = selection.getRng();\n\t\tvar caretElement = rng.startContainer || (rng.parentElement ? rng.parentElement() : null);\n\t\tvar body = editor.getBody();\n\t\tif (caretElement === body && selection.isCollapsed()) {\n\t\t\tif (dom.isBlock(body.firstChild) && canHaveChildren(body.firstChild) && dom.isEmpty(body.firstChild)) {\n\t\t\t\trng = dom.createRng();\n\t\t\t\trng.setStart(body.firstChild, 0);\n\t\t\t\trng.setEnd(body.firstChild, 0);\n\t\t\t\tselection.setRng(rng);\n\t\t\t}\n\t\t}\n\n\t\t// Insert node maker where we will insert the new HTML and get it's parent\n\t\tif (!selection.isCollapsed()) {\n\t\t\t// Fix for #2595 seems that delete removes one extra character on\n\t\t\t// WebKit for some odd reason if you double click select a word\n\t\t\teditor.selection.setRng(editor.selection.getRng());\n\t\t\teditor.getDoc().execCommand('Delete', false, null);\n\t\t\ttrimNbspAfterDeleteAndPaddValue();\n\t\t}\n\n\t\tparentNode = selection.getNode();\n\n\t\t// Parse the fragment within the context of the parent node\n\t\tvar parserArgs = {context: parentNode.nodeName.toLowerCase(), data: details.data};\n\t\tfragment = parser.parse(value, parserArgs);\n\n\t\t// Custom handling of lists\n\t\tif (details.paste === true && InsertList.isListFragment(fragment) && InsertList.isParentBlockLi(dom, parentNode)) {\n\t\t\trng = InsertList.insertAtCaret(serializer, dom, editor.selection.getRng(true), fragment);\n\t\t\teditor.selection.setRng(rng);\n\t\t\teditor.fire('SetContent', args);\n\t\t\treturn;\n\t\t}\n\n\t\tmarkFragmentElements(fragment);\n\n\t\t// Move the caret to a more suitable location\n\t\tnode = fragment.lastChild;\n\t\tif (node.attr('id') == 'mce_marker') {\n\t\t\tmarker = node;\n\n\t\t\tfor (node = node.prev; node; node = node.walk(true)) {\n\t\t\t\tif (node.type == 3 || !dom.isBlock(node.name)) {\n\t\t\t\t\tif (editor.schema.isValidChild(node.parent.name, 'span')) {\n\t\t\t\t\t\tnode.parent.insert(marker, node, node.name === 'br');\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\teditor._selectionOverrides.showBlockCaretContainer(parentNode);\n\n\t\t// If parser says valid we can insert the contents into that parent\n\t\tif (!parserArgs.invalid) {\n\t\t\tvalue = serializer.serialize(fragment);\n\n\t\t\t// Check if parent is empty or only has one BR element then set the innerHTML of that parent\n\t\t\tnode = parentNode.firstChild;\n\t\t\tnode2 = parentNode.lastChild;\n\t\t\tif (!node || (node === node2 && node.nodeName === 'BR')) {\n\t\t\t\tdom.setHTML(parentNode, value);\n\t\t\t} else {\n\t\t\t\tselection.setContent(value);\n\t\t\t}\n\t\t} else {\n\t\t\t// If the fragment was invalid within that context then we need\n\t\t\t// to parse and process the parent it's inserted into\n\n\t\t\t// Insert bookmark node and get the parent\n\t\t\tselection.setContent(bookmarkHtml);\n\t\t\tparentNode = selection.getNode();\n\t\t\trootNode = editor.getBody();\n\n\t\t\t// Opera will return the document node when selection is in root\n\t\t\tif (parentNode.nodeType == 9) {\n\t\t\t\tparentNode = node = rootNode;\n\t\t\t} else {\n\t\t\t\tnode = parentNode;\n\t\t\t}\n\n\t\t\t// Find the ancestor just before the root element\n\t\t\twhile (node !== rootNode) {\n\t\t\t\tparentNode = node;\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\t// Get the outer/inner HTML depending on if we are in the root and parser and serialize that\n\t\t\tvalue = parentNode == rootNode ? rootNode.innerHTML : dom.getOuterHTML(parentNode);\n\t\t\tvalue = serializer.serialize(\n\t\t\t\tparser.parse(\n\t\t\t\t\t// Need to replace by using a function since $ in the contents would otherwise be a problem\n\t\t\t\t\tvalue.replace(/<span (id=\"mce_marker\"|id=mce_marker).+?<\\/span>/i, function() {\n\t\t\t\t\t\treturn serializer.serialize(fragment);\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t);\n\n\t\t\t// Set the inner/outer HTML depending on if we are in the root or not\n\t\t\tif (parentNode == rootNode) {\n\t\t\t\tdom.setHTML(rootNode, value);\n\t\t\t} else {\n\t\t\t\tdom.setOuterHTML(parentNode, value);\n\t\t\t}\n\t\t}\n\n\t\treduceInlineTextElements();\n\t\tmoveSelectionToMarker(dom.get('mce_marker'));\n\t\tumarkFragmentElements(editor.getBody());\n\t\teditor.fire('SetContent', args);\n\t\teditor.addVisual();\n\t};\n\n\tvar processValue = function (value) {\n\t\tvar details;\n\n\t\tif (typeof value !== 'string') {\n\t\t\tdetails = Tools.extend({\n\t\t\t\tpaste: value.paste,\n\t\t\t\tdata: {\n\t\t\t\t\tpaste: value.paste\n\t\t\t\t}\n\t\t\t}, value);\n\n\t\t\treturn {\n\t\t\t\tcontent: value.content,\n\t\t\t\tdetails: details\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tcontent: value,\n\t\t\tdetails: {}\n\t\t};\n\t};\n\n\tvar insertAtCaret = function (editor, value) {\n\t\tvar result = processValue(value);\n\t\tinsertHtmlAtCaret(editor, result.content, result.details);\n\t};\n\n\treturn {\n\t\tinsertAtCaret: insertAtCaret\n\t};\n});\n\n// Included from: js/tinymce/classes/EditorCommands.js\n\n/**\n * EditorCommands.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class enables you to add custom editor commands and it contains\n * overrides for native browser commands to address various bugs and issues.\n *\n * @class tinymce.EditorCommands\n */\ndefine(\"tinymce/EditorCommands\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/InsertContent\"\n], function(Env, Tools, RangeUtils, TreeWalker, InsertContent) {\n\t// Added for compression purposes\n\tvar each = Tools.each, extend = Tools.extend;\n\tvar map = Tools.map, inArray = Tools.inArray, explode = Tools.explode;\n\tvar isOldIE = Env.ie && Env.ie < 11;\n\tvar TRUE = true, FALSE = false;\n\n\treturn function(editor) {\n\t\tvar dom, selection, formatter,\n\t\t\tcommands = {state: {}, exec: {}, value: {}},\n\t\t\tsettings = editor.settings,\n\t\t\tbookmark;\n\n\t\teditor.on('PreInit', function() {\n\t\t\tdom = editor.dom;\n\t\t\tselection = editor.selection;\n\t\t\tsettings = editor.settings;\n\t\t\tformatter = editor.formatter;\n\t\t});\n\n\t\t/**\n\t\t * Executes the specified command.\n\t\t *\n\t\t * @method execCommand\n\t\t * @param {String} command Command to execute.\n\t\t * @param {Boolean} ui Optional user interface state.\n\t\t * @param {Object} value Optional value for command.\n\t\t * @param {Object} args Optional extra arguments to the execCommand.\n\t\t * @return {Boolean} true/false if the command was found or not.\n\t\t */\n\t\tfunction execCommand(command, ui, value, args) {\n\t\t\tvar func, customCommand, state = 0;\n\n\t\t\tif (!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command) && (!args || !args.skip_focus)) {\n\t\t\t\teditor.focus();\n\t\t\t}\n\n\t\t\targs = editor.fire('BeforeExecCommand', {command: command, ui: ui, value: value});\n\t\t\tif (args.isDefaultPrevented()) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tcustomCommand = command.toLowerCase();\n\t\t\tif ((func = commands.exec[customCommand])) {\n\t\t\t\tfunc(customCommand, ui, value);\n\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Plugin commands\n\t\t\teach(editor.plugins, function(p) {\n\t\t\t\tif (p.execCommand && p.execCommand(command, ui, value)) {\n\t\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\n\t\t\t\t\tstate = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (state) {\n\t\t\t\treturn state;\n\t\t\t}\n\n\t\t\t// Theme commands\n\t\t\tif (editor.theme && editor.theme.execCommand && editor.theme.execCommand(command, ui, value)) {\n\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Browser commands\n\t\t\ttry {\n\t\t\t\tstate = editor.getDoc().execCommand(command, ui, value);\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore old IE errors\n\t\t\t}\n\n\t\t\tif (state) {\n\t\t\t\teditor.fire('ExecCommand', {command: command, ui: ui, value: value});\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t/**\n\t\t * Queries the current state for a command for example if the current selection is \"bold\".\n\t\t *\n\t\t * @method queryCommandState\n\t\t * @param {String} command Command to check the state of.\n\t\t * @return {Boolean/Number} true/false if the selected contents is bold or not, -1 if it's not found.\n\t\t */\n\t\tfunction queryCommandState(command) {\n\t\t\tvar func;\n\n\t\t\t// Is hidden then return undefined\n\t\t\tif (editor.quirks.isHidden()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcommand = command.toLowerCase();\n\t\t\tif ((func = commands.state[command])) {\n\t\t\t\treturn func(command);\n\t\t\t}\n\n\t\t\t// Browser commands\n\t\t\ttry {\n\t\t\t\treturn editor.getDoc().queryCommandState(command);\n\t\t\t} catch (ex) {\n\t\t\t\t// Fails sometimes see bug: 1896577\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t/**\n\t\t * Queries the command value for example the current fontsize.\n\t\t *\n\t\t * @method queryCommandValue\n\t\t * @param {String} command Command to check the value of.\n\t\t * @return {Object} Command value of false if it's not found.\n\t\t */\n\t\tfunction queryCommandValue(command) {\n\t\t\tvar func;\n\n\t\t\t// Is hidden then return undefined\n\t\t\tif (editor.quirks.isHidden()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcommand = command.toLowerCase();\n\t\t\tif ((func = commands.value[command])) {\n\t\t\t\treturn func(command);\n\t\t\t}\n\n\t\t\t// Browser commands\n\t\t\ttry {\n\t\t\t\treturn editor.getDoc().queryCommandValue(command);\n\t\t\t} catch (ex) {\n\t\t\t\t// Fails sometimes see bug: 1896577\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Adds commands to the command collection.\n\t\t *\n\t\t * @method addCommands\n\t\t * @param {Object} command_list Name/value collection with commands to add, the names can also be comma separated.\n\t\t * @param {String} type Optional type to add, defaults to exec. Can be value or state as well.\n\t\t */\n\t\tfunction addCommands(command_list, type) {\n\t\t\ttype = type || 'exec';\n\n\t\t\teach(command_list, function(callback, command) {\n\t\t\t\teach(command.toLowerCase().split(','), function(command) {\n\t\t\t\t\tcommands[type][command] = callback;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction addCommand(command, callback, scope) {\n\t\t\tcommand = command.toLowerCase();\n\t\t\tcommands.exec[command] = function(command, ui, value, args) {\n\t\t\t\treturn callback.call(scope || editor, ui, value, args);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if the command is supported or not.\n\t\t *\n\t\t * @method queryCommandSupported\n\t\t * @param {String} command Command that we check support for.\n\t\t * @return {Boolean} true/false if the command is supported or not.\n\t\t */\n\t\tfunction queryCommandSupported(command) {\n\t\t\tcommand = command.toLowerCase();\n\n\t\t\tif (commands.exec[command]) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Browser commands\n\t\t\ttry {\n\t\t\t\treturn editor.getDoc().queryCommandSupported(command);\n\t\t\t} catch (ex) {\n\t\t\t\t// Fails sometimes see bug: 1896577\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction addQueryStateHandler(command, callback, scope) {\n\t\t\tcommand = command.toLowerCase();\n\t\t\tcommands.state[command] = function() {\n\t\t\t\treturn callback.call(scope || editor);\n\t\t\t};\n\t\t}\n\n\t\tfunction addQueryValueHandler(command, callback, scope) {\n\t\t\tcommand = command.toLowerCase();\n\t\t\tcommands.value[command] = function() {\n\t\t\t\treturn callback.call(scope || editor);\n\t\t\t};\n\t\t}\n\n\t\tfunction hasCustomCommand(command) {\n\t\t\tcommand = command.toLowerCase();\n\t\t\treturn !!commands.exec[command];\n\t\t}\n\n\t\t// Expose public methods\n\t\textend(this, {\n\t\t\texecCommand: execCommand,\n\t\t\tqueryCommandState: queryCommandState,\n\t\t\tqueryCommandValue: queryCommandValue,\n\t\t\tqueryCommandSupported: queryCommandSupported,\n\t\t\taddCommands: addCommands,\n\t\t\taddCommand: addCommand,\n\t\t\taddQueryStateHandler: addQueryStateHandler,\n\t\t\taddQueryValueHandler: addQueryValueHandler,\n\t\t\thasCustomCommand: hasCustomCommand\n\t\t});\n\n\t\t// Private methods\n\n\t\tfunction execNativeCommand(command, ui, value) {\n\t\t\tif (ui === undefined) {\n\t\t\t\tui = FALSE;\n\t\t\t}\n\n\t\t\tif (value === undefined) {\n\t\t\t\tvalue = null;\n\t\t\t}\n\n\t\t\treturn editor.getDoc().execCommand(command, ui, value);\n\t\t}\n\n\t\tfunction isFormatMatch(name) {\n\t\t\treturn formatter.match(name);\n\t\t}\n\n\t\tfunction toggleFormat(name, value) {\n\t\t\tformatter.toggle(name, value ? {value: value} : undefined);\n\t\t\teditor.nodeChanged();\n\t\t}\n\n\t\tfunction storeSelection(type) {\n\t\t\tbookmark = selection.getBookmark(type);\n\t\t}\n\n\t\tfunction restoreSelection() {\n\t\t\tselection.moveToBookmark(bookmark);\n\t\t}\n\n\t\t// Add execCommand overrides\n\t\taddCommands({\n\t\t\t// Ignore these, added for compatibility\n\t\t\t'mceResetDesignMode,mceBeginUndoLevel': function() {},\n\n\t\t\t// Add undo manager logic\n\t\t\t'mceEndUndoLevel,mceAddUndoLevel': function() {\n\t\t\t\teditor.undoManager.add();\n\t\t\t},\n\n\t\t\t'Cut,Copy,Paste': function(command) {\n\t\t\t\tvar doc = editor.getDoc(), failed;\n\n\t\t\t\t// Try executing the native command\n\t\t\t\ttry {\n\t\t\t\t\texecNativeCommand(command);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Command failed\n\t\t\t\t\tfailed = TRUE;\n\t\t\t\t}\n\n\t\t\t\t// Chrome reports the paste command as supported however older IE:s will return false for cut/paste\n\t\t\t\tif (command === 'paste' && !doc.queryCommandEnabled(command)) {\n\t\t\t\t\tfailed = true;\n\t\t\t\t}\n\n\t\t\t\t// Present alert message about clipboard access not being available\n\t\t\t\tif (failed || !doc.queryCommandSupported(command)) {\n\t\t\t\t\tvar msg = editor.translate(\n\t\t\t\t\t\t\"Your browser doesn't support direct access to the clipboard. \" +\n\t\t\t\t\t\t\"Please use the Ctrl+X/C/V keyboard shortcuts instead.\"\n\t\t\t\t\t);\n\n\t\t\t\t\tif (Env.mac) {\n\t\t\t\t\t\tmsg = msg.replace(/Ctrl\\+/g, '\\u2318+');\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.notificationManager.open({text: msg, type: 'error'});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Override unlink command\n\t\t\tunlink: function() {\n\t\t\t\tif (selection.isCollapsed()) {\n\t\t\t\t\tvar elm = selection.getNode();\n\t\t\t\t\tif (elm.tagName == 'A') {\n\t\t\t\t\t\teditor.dom.remove(elm, true);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tformatter.remove(\"link\");\n\t\t\t},\n\n\t\t\t// Override justify commands to use the text formatter engine\n\t\t\t'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone': function(command) {\n\t\t\t\tvar align = command.substring(7);\n\n\t\t\t\tif (align == 'full') {\n\t\t\t\t\talign = 'justify';\n\t\t\t\t}\n\n\t\t\t\t// Remove all other alignments first\n\t\t\t\teach('left,center,right,justify'.split(','), function(name) {\n\t\t\t\t\tif (align != name) {\n\t\t\t\t\t\tformatter.remove('align' + name);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (align != 'none') {\n\t\t\t\t\ttoggleFormat('align' + align);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Override list commands to fix WebKit bug\n\t\t\t'InsertUnorderedList,InsertOrderedList': function(command) {\n\t\t\t\tvar listElm, listParent;\n\n\t\t\t\texecNativeCommand(command);\n\n\t\t\t\t// WebKit produces lists within block elements so we need to split them\n\t\t\t\t// we will replace the native list creation logic to custom logic later on\n\t\t\t\t// TODO: Remove this when the list creation logic is removed\n\t\t\t\tlistElm = dom.getParent(selection.getNode(), 'ol,ul');\n\t\t\t\tif (listElm) {\n\t\t\t\t\tlistParent = listElm.parentNode;\n\n\t\t\t\t\t// If list is within a text block then split that block\n\t\t\t\t\tif (/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)) {\n\t\t\t\t\t\tstoreSelection();\n\t\t\t\t\t\tdom.split(listParent, listElm);\n\t\t\t\t\t\trestoreSelection();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Override commands to use the text formatter engine\n\t\t\t'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function(command) {\n\t\t\t\ttoggleFormat(command);\n\t\t\t},\n\n\t\t\t// Override commands to use the text formatter engine\n\t\t\t'ForeColor,HiliteColor,FontName': function(command, ui, value) {\n\t\t\t\ttoggleFormat(command, value);\n\t\t\t},\n\n\t\t\tFontSize: function(command, ui, value) {\n\t\t\t\tvar fontClasses, fontSizes;\n\n\t\t\t\t// Convert font size 1-7 to styles\n\t\t\t\tif (value >= 1 && value <= 7) {\n\t\t\t\t\tfontSizes = explode(settings.font_size_style_values);\n\t\t\t\t\tfontClasses = explode(settings.font_size_classes);\n\n\t\t\t\t\tif (fontClasses) {\n\t\t\t\t\t\tvalue = fontClasses[value - 1] || value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalue = fontSizes[value - 1] || value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttoggleFormat(command, value);\n\t\t\t},\n\n\t\t\tRemoveFormat: function(command) {\n\t\t\t\tformatter.remove(command);\n\t\t\t},\n\n\t\t\tmceBlockQuote: function() {\n\t\t\t\ttoggleFormat('blockquote');\n\t\t\t},\n\n\t\t\tFormatBlock: function(command, ui, value) {\n\t\t\t\treturn toggleFormat(value || 'p');\n\t\t\t},\n\n\t\t\tmceCleanup: function() {\n\t\t\t\tvar bookmark = selection.getBookmark();\n\n\t\t\t\teditor.setContent(editor.getContent({cleanup: TRUE}), {cleanup: TRUE});\n\n\t\t\t\tselection.moveToBookmark(bookmark);\n\t\t\t},\n\n\t\t\tmceRemoveNode: function(command, ui, value) {\n\t\t\t\tvar node = value || selection.getNode();\n\n\t\t\t\t// Make sure that the body node isn't removed\n\t\t\t\tif (node != editor.getBody()) {\n\t\t\t\t\tstoreSelection();\n\t\t\t\t\teditor.dom.remove(node, TRUE);\n\t\t\t\t\trestoreSelection();\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tmceSelectNodeDepth: function(command, ui, value) {\n\t\t\t\tvar counter = 0;\n\n\t\t\t\tdom.getParent(selection.getNode(), function(node) {\n\t\t\t\t\tif (node.nodeType == 1 && counter++ == value) {\n\t\t\t\t\t\tselection.select(node);\n\t\t\t\t\t\treturn FALSE;\n\t\t\t\t\t}\n\t\t\t\t}, editor.getBody());\n\t\t\t},\n\n\t\t\tmceSelectNode: function(command, ui, value) {\n\t\t\t\tselection.select(value);\n\t\t\t},\n\n\t\t\tmceInsertContent: function(command, ui, value) {\n\t\t\t\tInsertContent.insertAtCaret(editor, value);\n\t\t\t},\n\n\t\t\tmceInsertRawHTML: function(command, ui, value) {\n\t\t\t\tselection.setContent('tiny_mce_marker');\n\t\t\t\teditor.setContent(\n\t\t\t\t\teditor.getContent().replace(/tiny_mce_marker/g, function() {\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t},\n\n\t\t\tmceToggleFormat: function(command, ui, value) {\n\t\t\t\ttoggleFormat(value);\n\t\t\t},\n\n\t\t\tmceSetContent: function(command, ui, value) {\n\t\t\t\teditor.setContent(value);\n\t\t\t},\n\n\t\t\t'Indent,Outdent': function(command) {\n\t\t\t\tvar intentValue, indentUnit, value;\n\n\t\t\t\t// Setup indent level\n\t\t\t\tintentValue = settings.indentation;\n\t\t\t\tindentUnit = /[a-z%]+$/i.exec(intentValue);\n\t\t\t\tintentValue = parseInt(intentValue, 10);\n\n\t\t\t\tif (!queryCommandState('InsertUnorderedList') && !queryCommandState('InsertOrderedList')) {\n\t\t\t\t\t// If forced_root_blocks is set to false we don't have a block to indent so lets create a div\n\t\t\t\t\tif (!settings.forced_root_block && !dom.getParent(selection.getNode(), dom.isBlock)) {\n\t\t\t\t\t\tformatter.apply('div');\n\t\t\t\t\t}\n\n\t\t\t\t\teach(selection.getSelectedBlocks(), function(element) {\n\t\t\t\t\t\tif (dom.getContentEditable(element) === \"false\") {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (element.nodeName != \"LI\") {\n\t\t\t\t\t\t\tvar indentStyleName = editor.getParam('indent_use_margin', false) ? 'margin' : 'padding';\n\n\t\t\t\t\t\t\tindentStyleName += dom.getStyle(element, 'direction', true) == 'rtl' ? 'Right' : 'Left';\n\n\t\t\t\t\t\t\tif (command == 'outdent') {\n\t\t\t\t\t\t\t\tvalue = Math.max(0, parseInt(element.style[indentStyleName] || 0, 10) - intentValue);\n\t\t\t\t\t\t\t\tdom.setStyle(element, indentStyleName, value ? value + indentUnit : '');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvalue = (parseInt(element.style[indentStyleName] || 0, 10) + intentValue) + indentUnit;\n\t\t\t\t\t\t\t\tdom.setStyle(element, indentStyleName, value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\texecNativeCommand(command);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tmceRepaint: function() {\n\t\t\t},\n\n\t\t\tInsertHorizontalRule: function() {\n\t\t\t\teditor.execCommand('mceInsertContent', false, '<hr />');\n\t\t\t},\n\n\t\t\tmceToggleVisualAid: function() {\n\t\t\t\teditor.hasVisual = !editor.hasVisual;\n\t\t\t\teditor.addVisual();\n\t\t\t},\n\n\t\t\tmceReplaceContent: function(command, ui, value) {\n\t\t\t\teditor.execCommand('mceInsertContent', false, value.replace(/\\{\\$selection\\}/g, selection.getContent({format: 'text'})));\n\t\t\t},\n\n\t\t\tmceInsertLink: function(command, ui, value) {\n\t\t\t\tvar anchor;\n\n\t\t\t\tif (typeof value == 'string') {\n\t\t\t\t\tvalue = {href: value};\n\t\t\t\t}\n\n\t\t\t\tanchor = dom.getParent(selection.getNode(), 'a');\n\n\t\t\t\t// Spaces are never valid in URLs and it's a very common mistake for people to make so we fix it here.\n\t\t\t\tvalue.href = value.href.replace(' ', '%20');\n\n\t\t\t\t// Remove existing links if there could be child links or that the href isn't specified\n\t\t\t\tif (!anchor || !value.href) {\n\t\t\t\t\tformatter.remove('link');\n\t\t\t\t}\n\n\t\t\t\t// Apply new link to selection\n\t\t\t\tif (value.href) {\n\t\t\t\t\tformatter.apply('link', value, anchor);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tselectAll: function() {\n\t\t\t\tvar root = dom.getRoot(), rng;\n\n\t\t\t\tif (selection.getRng().setStart) {\n\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\trng.setStart(root, 0);\n\t\t\t\t\trng.setEnd(root, root.childNodes.length);\n\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t} else {\n\t\t\t\t\t// IE will render it's own root level block elements and sometimes\n\t\t\t\t\t// even put font elements in them when the user starts typing. So we need to\n\t\t\t\t\t// move the selection to a more suitable element from this:\n\t\t\t\t\t// <body>|<p></p></body> to this: <body><p>|</p></body>\n\t\t\t\t\trng = selection.getRng();\n\t\t\t\t\tif (!rng.item) {\n\t\t\t\t\t\trng.moveToElementText(root);\n\t\t\t\t\t\trng.select();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t\"delete\": function() {\n\t\t\t\texecNativeCommand(\"Delete\");\n\n\t\t\t\t// Check if body is empty after the delete call if so then set the contents\n\t\t\t\t// to an empty string and move the caret to any block produced by that operation\n\t\t\t\t// this fixes the issue with root blocks not being properly produced after a delete call on IE\n\t\t\t\tvar body = editor.getBody();\n\n\t\t\t\tif (dom.isEmpty(body)) {\n\t\t\t\t\teditor.setContent('');\n\n\t\t\t\t\tif (body.firstChild && dom.isBlock(body.firstChild)) {\n\t\t\t\t\t\teditor.selection.setCursorLocation(body.firstChild, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.selection.setCursorLocation(body, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tmceNewDocument: function() {\n\t\t\t\teditor.setContent('');\n\t\t\t},\n\n\t\t\tInsertLineBreak: function(command, ui, value) {\n\t\t\t\t// We load the current event in from EnterKey.js when appropriate to heed\n\t\t\t\t// certain event-specific variations such as ctrl-enter in a list\n\t\t\t\tvar evt = value;\n\t\t\t\tvar brElm, extraBr, marker;\n\t\t\t\tvar rng = selection.getRng(true);\n\t\t\t\tnew RangeUtils(dom).normalize(rng);\n\n\t\t\t\tvar offset = rng.startOffset;\n\t\t\t\tvar container = rng.startContainer;\n\n\t\t\t\t// Resolve node index\n\t\t\t\tif (container.nodeType == 1 && container.hasChildNodes()) {\n\t\t\t\t\tvar isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n\n\t\t\t\t\tcontainer = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n\t\t\t\t\tif (isAfterLastNodeInContainer && container.nodeType == 3) {\n\t\t\t\t\t\toffset = container.nodeValue.length;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toffset = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar parentBlock = dom.getParent(container, dom.isBlock);\n\t\t\t\tvar parentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\n\t\t\t\tvar containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n\t\t\t\tvar containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\n\n\t\t\t\t// Enter inside block contained within a LI then split or insert before/after LI\n\t\t\t\tvar isControlKey = evt && evt.ctrlKey;\n\t\t\t\tif (containerBlockName == 'LI' && !isControlKey) {\n\t\t\t\t\tparentBlock = containerBlock;\n\t\t\t\t\tparentBlockName = containerBlockName;\n\t\t\t\t}\n\n\t\t\t\t// Walks the parent block to the right and look for BR elements\n\t\t\t\tfunction hasRightSideContent() {\n\t\t\t\t\tvar walker = new TreeWalker(container, parentBlock), node;\n\t\t\t\t\tvar nonEmptyElementsMap = editor.schema.getNonEmptyElements();\n\n\t\t\t\t\twhile ((node = walker.next())) {\n\t\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName.toLowerCase()] || node.length > 0) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (container && container.nodeType == 3 && offset >= container.nodeValue.length) {\n\t\t\t\t\t// Insert extra BR element at the end block elements\n\t\t\t\t\tif (!isOldIE && !hasRightSideContent()) {\n\t\t\t\t\t\tbrElm = dom.create('br');\n\t\t\t\t\t\trng.insertNode(brElm);\n\t\t\t\t\t\trng.setStartAfter(brElm);\n\t\t\t\t\t\trng.setEndAfter(brElm);\n\t\t\t\t\t\textraBr = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbrElm = dom.create('br');\n\t\t\t\trng.insertNode(brElm);\n\n\t\t\t\t// Rendering modes below IE8 doesn't display BR elements in PRE unless we have a \\n before it\n\t\t\t\tvar documentMode = dom.doc.documentMode;\n\t\t\t\tif (isOldIE && parentBlockName == 'PRE' && (!documentMode || documentMode < 8)) {\n\t\t\t\t\tbrElm.parentNode.insertBefore(dom.doc.createTextNode('\\r'), brElm);\n\t\t\t\t}\n\n\t\t\t\t// Insert temp marker and scroll to that\n\t\t\t\tmarker = dom.create('span', {}, '&nbsp;');\n\t\t\t\tbrElm.parentNode.insertBefore(marker, brElm);\n\t\t\t\tselection.scrollIntoView(marker);\n\t\t\t\tdom.remove(marker);\n\n\t\t\t\tif (!extraBr) {\n\t\t\t\t\trng.setStartAfter(brElm);\n\t\t\t\t\trng.setEndAfter(brElm);\n\t\t\t\t} else {\n\t\t\t\t\trng.setStartBefore(brElm);\n\t\t\t\t\trng.setEndBefore(brElm);\n\t\t\t\t}\n\n\t\t\t\tselection.setRng(rng);\n\t\t\t\teditor.undoManager.add();\n\n\t\t\t\treturn TRUE;\n\t\t\t}\n\t\t});\n\n\t\t// Add queryCommandState overrides\n\t\taddCommands({\n\t\t\t// Override justify commands\n\t\t\t'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull': function(command) {\n\t\t\t\tvar name = 'align' + command.substring(7);\n\t\t\t\tvar nodes = selection.isCollapsed() ? [dom.getParent(selection.getNode(), dom.isBlock)] : selection.getSelectedBlocks();\n\t\t\t\tvar matches = map(nodes, function(node) {\n\t\t\t\t\treturn !!formatter.matchNode(node, name);\n\t\t\t\t});\n\t\t\t\treturn inArray(matches, TRUE) !== -1;\n\t\t\t},\n\n\t\t\t'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function(command) {\n\t\t\t\treturn isFormatMatch(command);\n\t\t\t},\n\n\t\t\tmceBlockQuote: function() {\n\t\t\t\treturn isFormatMatch('blockquote');\n\t\t\t},\n\n\t\t\tOutdent: function() {\n\t\t\t\tvar node;\n\n\t\t\t\tif (settings.inline_styles) {\n\t\t\t\t\tif ((node = dom.getParent(selection.getStart(), dom.isBlock)) && parseInt(node.style.paddingLeft, 10) > 0) {\n\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((node = dom.getParent(selection.getEnd(), dom.isBlock)) && parseInt(node.style.paddingLeft, 10) > 0) {\n\t\t\t\t\t\treturn TRUE;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn (\n\t\t\t\t\tqueryCommandState('InsertUnorderedList') ||\n\t\t\t\t\tqueryCommandState('InsertOrderedList') ||\n\t\t\t\t\t(!settings.inline_styles && !!dom.getParent(selection.getNode(), 'BLOCKQUOTE'))\n\t\t\t\t);\n\t\t\t},\n\n\t\t\t'InsertUnorderedList,InsertOrderedList': function(command) {\n\t\t\t\tvar list = dom.getParent(selection.getNode(), 'ul,ol');\n\n\t\t\t\treturn list &&\n\t\t\t\t\t(\n\t\t\t\t\t\tcommand === 'insertunorderedlist' && list.tagName === 'UL' ||\n\t\t\t\t\t\tcommand === 'insertorderedlist' && list.tagName === 'OL'\n\t\t\t\t\t);\n\t\t\t}\n\t\t}, 'state');\n\n\t\t// Add queryCommandValue overrides\n\t\taddCommands({\n\t\t\t'FontSize,FontName': function(command) {\n\t\t\t\tvar value = 0, parent;\n\n\t\t\t\tif ((parent = dom.getParent(selection.getNode(), 'span'))) {\n\t\t\t\t\tif (command == 'fontsize') {\n\t\t\t\t\t\tvalue = parent.style.fontSize;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalue = parent.style.fontFamily.replace(/, /g, ',').replace(/[\\'\\\"]/g, '').toLowerCase();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}, 'value');\n\n\t\t// Add undo manager logic\n\t\taddCommands({\n\t\t\tUndo: function() {\n\t\t\t\teditor.undoManager.undo();\n\t\t\t},\n\n\t\t\tRedo: function() {\n\t\t\t\teditor.undoManager.redo();\n\t\t\t}\n\t\t});\n\t};\n});\n\n// Included from: js/tinymce/classes/util/URI.js\n\n/**\n * URI.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles parsing, modification and serialization of URI/URL strings.\n * @class tinymce.util.URI\n */\ndefine(\"tinymce/util/URI\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar each = Tools.each, trim = Tools.trim;\n\tvar queryParts = \"source protocol authority userInfo user password host port relative path directory file query anchor\".split(' ');\n\tvar DEFAULT_PORTS = {\n\t\t'ftp': 21,\n\t\t'http': 80,\n\t\t'https': 443,\n\t\t'mailto': 25\n\t};\n\n\t/**\n\t * Constructs a new URI instance.\n\t *\n\t * @constructor\n\t * @method URI\n\t * @param {String} url URI string to parse.\n\t * @param {Object} settings Optional settings object.\n\t */\n\tfunction URI(url, settings) {\n\t\tvar self = this, baseUri, base_url;\n\n\t\turl = trim(url);\n\t\tsettings = self.settings = settings || {};\n\t\tbaseUri = settings.base_uri;\n\n\t\t// Strange app protocol that isn't http/https or local anchor\n\t\t// For example: mailto,skype,tel etc.\n\t\tif (/^([\\w\\-]+):([^\\/]{2})/i.test(url) || /^\\s*#/.test(url)) {\n\t\t\tself.source = url;\n\t\t\treturn;\n\t\t}\n\n\t\tvar isProtocolRelative = url.indexOf('//') === 0;\n\n\t\t// Absolute path with no host, fake host and protocol\n\t\tif (url.indexOf('/') === 0 && !isProtocolRelative) {\n\t\t\turl = (baseUri ? baseUri.protocol || 'http' : 'http') + '://mce_host' + url;\n\t\t}\n\n\t\t// Relative path http:// or protocol relative //path\n\t\tif (!/^[\\w\\-]*:?\\/\\//.test(url)) {\n\t\t\tbase_url = settings.base_uri ? settings.base_uri.path : new URI(location.href).directory;\n\t\t\tif (settings.base_uri.protocol === \"\") {\n\t\t\t\turl = '//mce_host' + self.toAbsPath(base_url, url);\n\t\t\t} else {\n\t\t\t\turl = /([^#?]*)([#?]?.*)/.exec(url);\n\t\t\t\turl = ((baseUri && baseUri.protocol) || 'http') + '://mce_host' + self.toAbsPath(base_url, url[1]) + url[2];\n\t\t\t}\n\t\t}\n\n\t\t// Parse URL (Credits goes to Steave, http://blog.stevenlevithan.com/archives/parseuri)\n\t\turl = url.replace(/@@/g, '(mce_at)'); // Zope 3 workaround, they use @@something\n\n\t\t/*jshint maxlen: 255 */\n\t\t/*eslint max-len: 0 */\n\t\turl = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@\\/]*):?([^:@\\/]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(url);\n\n\t\teach(queryParts, function(v, i) {\n\t\t\tvar part = url[i];\n\n\t\t\t// Zope 3 workaround, they use @@something\n\t\t\tif (part) {\n\t\t\t\tpart = part.replace(/\\(mce_at\\)/g, '@@');\n\t\t\t}\n\n\t\t\tself[v] = part;\n\t\t});\n\n\t\tif (baseUri) {\n\t\t\tif (!self.protocol) {\n\t\t\t\tself.protocol = baseUri.protocol;\n\t\t\t}\n\n\t\t\tif (!self.userInfo) {\n\t\t\t\tself.userInfo = baseUri.userInfo;\n\t\t\t}\n\n\t\t\tif (!self.port && self.host === 'mce_host') {\n\t\t\t\tself.port = baseUri.port;\n\t\t\t}\n\n\t\t\tif (!self.host || self.host === 'mce_host') {\n\t\t\t\tself.host = baseUri.host;\n\t\t\t}\n\n\t\t\tself.source = '';\n\t\t}\n\n\t\tif (isProtocolRelative) {\n\t\t\tself.protocol = '';\n\t\t}\n\n\t\t//t.path = t.path || '/';\n\t}\n\n\tURI.prototype = {\n\t\t/**\n\t\t * Sets the internal path part of the URI.\n\t\t *\n\t\t * @method setPath\n\t\t * @param {string} path Path string to set.\n\t\t */\n\t\tsetPath: function(path) {\n\t\t\tvar self = this;\n\n\t\t\tpath = /^(.*?)\\/?(\\w+)?$/.exec(path);\n\n\t\t\t// Update path parts\n\t\t\tself.path = path[0];\n\t\t\tself.directory = path[1];\n\t\t\tself.file = path[2];\n\n\t\t\t// Rebuild source\n\t\t\tself.source = '';\n\t\t\tself.getURI();\n\t\t},\n\n\t\t/**\n\t\t * Converts the specified URI into a relative URI based on the current URI instance location.\n\t\t *\n\t\t * @method toRelative\n\t\t * @param {String} uri URI to convert into a relative path/URI.\n\t\t * @return {String} Relative URI from the point specified in the current URI instance.\n\t\t * @example\n\t\t * // Converts an absolute URL to an relative URL url will be somedir/somefile.htm\n\t\t * var url = new tinymce.util.URI('http://www.site.com/dir/').toRelative('http://www.site.com/dir/somedir/somefile.htm');\n\t\t */\n\t\ttoRelative: function(uri) {\n\t\t\tvar self = this, output;\n\n\t\t\tif (uri === \"./\") {\n\t\t\t\treturn uri;\n\t\t\t}\n\n\t\t\turi = new URI(uri, {base_uri: self});\n\n\t\t\t// Not on same domain/port or protocol\n\t\t\tif ((uri.host != 'mce_host' && self.host != uri.host && uri.host) || self.port != uri.port ||\n\t\t\t\t(self.protocol != uri.protocol && uri.protocol !== \"\")) {\n\t\t\t\treturn uri.getURI();\n\t\t\t}\n\n\t\t\tvar tu = self.getURI(), uu = uri.getURI();\n\n\t\t\t// Allow usage of the base_uri when relative_urls = true\n\t\t\tif (tu == uu || (tu.charAt(tu.length - 1) == \"/\" && tu.substr(0, tu.length - 1) == uu)) {\n\t\t\t\treturn tu;\n\t\t\t}\n\n\t\t\toutput = self.toRelPath(self.path, uri.path);\n\n\t\t\t// Add query\n\t\t\tif (uri.query) {\n\t\t\t\toutput += '?' + uri.query;\n\t\t\t}\n\n\t\t\t// Add anchor\n\t\t\tif (uri.anchor) {\n\t\t\t\toutput += '#' + uri.anchor;\n\t\t\t}\n\n\t\t\treturn output;\n\t\t},\n\n\t\t/**\n\t\t * Converts the specified URI into a absolute URI based on the current URI instance location.\n\t\t *\n\t\t * @method toAbsolute\n\t\t * @param {String} uri URI to convert into a relative path/URI.\n\t\t * @param {Boolean} noHost No host and protocol prefix.\n\t\t * @return {String} Absolute URI from the point specified in the current URI instance.\n\t\t * @example\n\t\t * // Converts an relative URL to an absolute URL url will be http://www.site.com/dir/somedir/somefile.htm\n\t\t * var url = new tinymce.util.URI('http://www.site.com/dir/').toAbsolute('somedir/somefile.htm');\n\t\t */\n\t\ttoAbsolute: function(uri, noHost) {\n\t\t\turi = new URI(uri, {base_uri: this});\n\n\t\t\treturn uri.getURI(noHost && this.isSameOrigin(uri));\n\t\t},\n\n\t\t/**\n\t\t * Determine whether the given URI has the same origin as this URI.  Based on RFC-6454.\n\t\t * Supports default ports for protocols listed in DEFAULT_PORTS.  Unsupported protocols will fail safe: they\n\t\t * won't match, if the port specifications differ.\n\t\t *\n\t\t * @method isSameOrigin\n\t\t * @param {tinymce.util.URI} uri Uri instance to compare.\n\t\t * @returns {Boolean} True if the origins are the same.\n\t\t */\n\t\tisSameOrigin: function(uri) {\n\t\t\tif (this.host == uri.host && this.protocol == uri.protocol) {\n\t\t\t\tif (this.port == uri.port) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tvar defaultPort = DEFAULT_PORTS[this.protocol];\n\t\t\t\tif (defaultPort && ((this.port || defaultPort) == (uri.port || defaultPort))) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Converts a absolute path into a relative path.\n\t\t *\n\t\t * @method toRelPath\n\t\t * @param {String} base Base point to convert the path from.\n\t\t * @param {String} path Absolute path to convert into a relative path.\n\t\t */\n\t\ttoRelPath: function(base, path) {\n\t\t\tvar items, breakPoint = 0, out = '', i, l;\n\n\t\t\t// Split the paths\n\t\t\tbase = base.substring(0, base.lastIndexOf('/'));\n\t\t\tbase = base.split('/');\n\t\t\titems = path.split('/');\n\n\t\t\tif (base.length >= items.length) {\n\t\t\t\tfor (i = 0, l = base.length; i < l; i++) {\n\t\t\t\t\tif (i >= items.length || base[i] != items[i]) {\n\t\t\t\t\t\tbreakPoint = i + 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (base.length < items.length) {\n\t\t\t\tfor (i = 0, l = items.length; i < l; i++) {\n\t\t\t\t\tif (i >= base.length || base[i] != items[i]) {\n\t\t\t\t\t\tbreakPoint = i + 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (breakPoint === 1) {\n\t\t\t\treturn path;\n\t\t\t}\n\n\t\t\tfor (i = 0, l = base.length - (breakPoint - 1); i < l; i++) {\n\t\t\t\tout += \"../\";\n\t\t\t}\n\n\t\t\tfor (i = breakPoint - 1, l = items.length; i < l; i++) {\n\t\t\t\tif (i != breakPoint - 1) {\n\t\t\t\t\tout += \"/\" + items[i];\n\t\t\t\t} else {\n\t\t\t\t\tout += items[i];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn out;\n\t\t},\n\n\t\t/**\n\t\t * Converts a relative path into a absolute path.\n\t\t *\n\t\t * @method toAbsPath\n\t\t * @param {String} base Base point to convert the path from.\n\t\t * @param {String} path Relative path to convert into an absolute path.\n\t\t */\n\t\ttoAbsPath: function(base, path) {\n\t\t\tvar i, nb = 0, o = [], tr, outPath;\n\n\t\t\t// Split paths\n\t\t\ttr = /\\/$/.test(path) ? '/' : '';\n\t\t\tbase = base.split('/');\n\t\t\tpath = path.split('/');\n\n\t\t\t// Remove empty chunks\n\t\t\teach(base, function(k) {\n\t\t\t\tif (k) {\n\t\t\t\t\to.push(k);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tbase = o;\n\n\t\t\t// Merge relURLParts chunks\n\t\t\tfor (i = path.length - 1, o = []; i >= 0; i--) {\n\t\t\t\t// Ignore empty or .\n\t\t\t\tif (path[i].length === 0 || path[i] === \".\") {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Is parent\n\t\t\t\tif (path[i] === '..') {\n\t\t\t\t\tnb++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Move up\n\t\t\t\tif (nb > 0) {\n\t\t\t\t\tnb--;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\to.push(path[i]);\n\t\t\t}\n\n\t\t\ti = base.length - nb;\n\n\t\t\t// If /a/b/c or /\n\t\t\tif (i <= 0) {\n\t\t\t\toutPath = o.reverse().join('/');\n\t\t\t} else {\n\t\t\t\toutPath = base.slice(0, i).join('/') + '/' + o.reverse().join('/');\n\t\t\t}\n\n\t\t\t// Add front / if it's needed\n\t\t\tif (outPath.indexOf('/') !== 0) {\n\t\t\t\toutPath = '/' + outPath;\n\t\t\t}\n\n\t\t\t// Add traling / if it's needed\n\t\t\tif (tr && outPath.lastIndexOf('/') !== outPath.length - 1) {\n\t\t\t\toutPath += tr;\n\t\t\t}\n\n\t\t\treturn outPath;\n\t\t},\n\n\t\t/**\n\t\t * Returns the full URI of the internal structure.\n\t\t *\n\t\t * @method getURI\n\t\t * @param {Boolean} noProtoHost Optional no host and protocol part. Defaults to false.\n\t\t */\n\t\tgetURI: function(noProtoHost) {\n\t\t\tvar s, self = this;\n\n\t\t\t// Rebuild source\n\t\t\tif (!self.source || noProtoHost) {\n\t\t\t\ts = '';\n\n\t\t\t\tif (!noProtoHost) {\n\t\t\t\t\tif (self.protocol) {\n\t\t\t\t\t\ts += self.protocol + '://';\n\t\t\t\t\t} else {\n\t\t\t\t\t\ts += '//';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (self.userInfo) {\n\t\t\t\t\t\ts += self.userInfo + '@';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (self.host) {\n\t\t\t\t\t\ts += self.host;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (self.port) {\n\t\t\t\t\t\ts += ':' + self.port;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (self.path) {\n\t\t\t\t\ts += self.path;\n\t\t\t\t}\n\n\t\t\t\tif (self.query) {\n\t\t\t\t\ts += '?' + self.query;\n\t\t\t\t}\n\n\t\t\t\tif (self.anchor) {\n\t\t\t\t\ts += '#' + self.anchor;\n\t\t\t\t}\n\n\t\t\t\tself.source = s;\n\t\t\t}\n\n\t\t\treturn self.source;\n\t\t}\n\t};\n\n\tURI.parseDataUri = function(uri) {\n\t\tvar type, matches;\n\n\t\turi = decodeURIComponent(uri).split(',');\n\n\t\tmatches = /data:([^;]+)/.exec(uri[0]);\n\t\tif (matches) {\n\t\t\ttype = matches[1];\n\t\t}\n\n\t\treturn {\n\t\t\ttype: type,\n\t\t\tdata: uri[1]\n\t\t};\n\t};\n\n\tURI.getDocumentBaseUrl = function(loc) {\n\t\tvar baseUrl;\n\n\t\t// Pass applewebdata:// and other non web protocols though\n\t\tif (loc.protocol.indexOf('http') !== 0 && loc.protocol !== 'file:') {\n\t\t\tbaseUrl = loc.href;\n\t\t} else {\n\t\t\tbaseUrl = loc.protocol + '//' + loc.host + loc.pathname;\n\t\t}\n\n\t\tif (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(baseUrl)) {\n\t\t\tbaseUrl = baseUrl.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n\n\t\t\tif (!/[\\/\\\\]$/.test(baseUrl)) {\n\t\t\t\tbaseUrl += '/';\n\t\t\t}\n\t\t}\n\n\t\treturn baseUrl;\n\t};\n\n\treturn URI;\n});\n\n// Included from: js/tinymce/classes/util/Class.js\n\n/**\n * Class.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This utilitiy class is used for easier inheritance.\n *\n * Features:\n * * Exposed super functions: this._super();\n * * Mixins\n * * Dummy functions\n * * Property functions: var value = object.value(); and object.value(newValue);\n * * Static functions\n * * Defaults settings\n */\ndefine(\"tinymce/util/Class\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar each = Tools.each, extend = Tools.extend;\n\n\tvar extendClass, initializing;\n\n\tfunction Class() {\n\t}\n\n\t// Provides classical inheritance, based on code made by John Resig\n\tClass.extend = extendClass = function(prop) {\n\t\tvar self = this, _super = self.prototype, prototype, name, member;\n\n\t\t// The dummy class constructor\n\t\tfunction Class() {\n\t\t\tvar i, mixins, mixin, self = this;\n\n\t\t\t// All construction is actually done in the init method\n\t\t\tif (!initializing) {\n\t\t\t\t// Run class constuctor\n\t\t\t\tif (self.init) {\n\t\t\t\t\tself.init.apply(self, arguments);\n\t\t\t\t}\n\n\t\t\t\t// Run mixin constructors\n\t\t\t\tmixins = self.Mixins;\n\t\t\t\tif (mixins) {\n\t\t\t\t\ti = mixins.length;\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tmixin = mixins[i];\n\t\t\t\t\t\tif (mixin.init) {\n\t\t\t\t\t\t\tmixin.init.apply(self, arguments);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Dummy function, needs to be extended in order to provide functionality\n\t\tfunction dummy() {\n\t\t\treturn this;\n\t\t}\n\n\t\t// Creates a overloaded method for the class\n\t\t// this enables you to use this._super(); to call the super function\n\t\tfunction createMethod(name, fn) {\n\t\t\treturn function() {\n\t\t\t\tvar self = this, tmp = self._super, ret;\n\n\t\t\t\tself._super = _super[name];\n\t\t\t\tret = fn.apply(self, arguments);\n\t\t\t\tself._super = tmp;\n\n\t\t\t\treturn ret;\n\t\t\t};\n\t\t}\n\n\t\t// Instantiate a base class (but only create the instance,\n\t\t// don't run the init constructor)\n\t\tinitializing = true;\n\n\t\t/*eslint new-cap:0 */\n\t\tprototype = new self();\n\t\tinitializing = false;\n\n\t\t// Add mixins\n\t\tif (prop.Mixins) {\n\t\t\teach(prop.Mixins, function(mixin) {\n\t\t\t\tfor (var name in mixin) {\n\t\t\t\t\tif (name !== \"init\") {\n\t\t\t\t\t\tprop[name] = mixin[name];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (_super.Mixins) {\n\t\t\t\tprop.Mixins = _super.Mixins.concat(prop.Mixins);\n\t\t\t}\n\t\t}\n\n\t\t// Generate dummy methods\n\t\tif (prop.Methods) {\n\t\t\teach(prop.Methods.split(','), function(name) {\n\t\t\t\tprop[name] = dummy;\n\t\t\t});\n\t\t}\n\n\t\t// Generate property methods\n\t\tif (prop.Properties) {\n\t\t\teach(prop.Properties.split(','), function(name) {\n\t\t\t\tvar fieldName = '_' + name;\n\n\t\t\t\tprop[name] = function(value) {\n\t\t\t\t\tvar self = this, undef;\n\n\t\t\t\t\t// Set value\n\t\t\t\t\tif (value !== undef) {\n\t\t\t\t\t\tself[fieldName] = value;\n\n\t\t\t\t\t\treturn self;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Get value\n\t\t\t\t\treturn self[fieldName];\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\t// Static functions\n\t\tif (prop.Statics) {\n\t\t\teach(prop.Statics, function(func, name) {\n\t\t\t\tClass[name] = func;\n\t\t\t});\n\t\t}\n\n\t\t// Default settings\n\t\tif (prop.Defaults && _super.Defaults) {\n\t\t\tprop.Defaults = extend({}, _super.Defaults, prop.Defaults);\n\t\t}\n\n\t\t// Copy the properties over onto the new prototype\n\t\tfor (name in prop) {\n\t\t\tmember = prop[name];\n\n\t\t\tif (typeof member == \"function\" && _super[name]) {\n\t\t\t\tprototype[name] = createMethod(name, member);\n\t\t\t} else {\n\t\t\t\tprototype[name] = member;\n\t\t\t}\n\t\t}\n\n\t\t// Populate our constructed prototype object\n\t\tClass.prototype = prototype;\n\n\t\t// Enforce the constructor to be what we expect\n\t\tClass.constructor = Class;\n\n\t\t// And make this class extendible\n\t\tClass.extend = extendClass;\n\n\t\treturn Class;\n\t};\n\n\treturn Class;\n});\n\n// Included from: js/tinymce/classes/util/EventDispatcher.js\n\n/**\n * EventDispatcher.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class lets you add/remove and fire events by name on the specified scope. This makes\n * it easy to add event listener logic to any class.\n *\n * @class tinymce.util.EventDispatcher\n * @example\n *  var eventDispatcher = new EventDispatcher();\n *\n *  eventDispatcher.on('click', function() {console.log('data');});\n *  eventDispatcher.fire('click', {data: 123});\n */\ndefine(\"tinymce/util/EventDispatcher\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\tvar nativeEvents = Tools.makeMap(\n\t\t\"focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange \" +\n\t\t\"mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover \" +\n\t\t\"draggesture dragdrop drop drag submit \" +\n\t\t\"compositionstart compositionend compositionupdate touchstart touchmove touchend\",\n\t\t' '\n\t);\n\n\tfunction Dispatcher(settings) {\n\t\tvar self = this, scope, bindings = {}, toggleEvent;\n\n\t\tfunction returnFalse() {\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction returnTrue() {\n\t\t\treturn true;\n\t\t}\n\n\t\tsettings = settings || {};\n\t\tscope = settings.scope || self;\n\t\ttoggleEvent = settings.toggleEvent || returnFalse;\n\n\t\t/**\n\t\t * Fires the specified event by name.\n\t\t *\n\t\t * @method fire\n\t\t * @param {String} name Name of the event to fire.\n\t\t * @param {Object?} args Event arguments.\n\t\t * @return {Object} Event args instance passed in.\n\t\t * @example\n\t\t * instance.fire('event', {...});\n\t\t */\n\t\tfunction fire(name, args) {\n\t\t\tvar handlers, i, l, callback;\n\n\t\t\tname = name.toLowerCase();\n\t\t\targs = args || {};\n\t\t\targs.type = name;\n\n\t\t\t// Setup target is there isn't one\n\t\t\tif (!args.target) {\n\t\t\t\targs.target = scope;\n\t\t\t}\n\n\t\t\t// Add event delegation methods if they are missing\n\t\t\tif (!args.preventDefault) {\n\t\t\t\t// Add preventDefault method\n\t\t\t\targs.preventDefault = function() {\n\t\t\t\t\targs.isDefaultPrevented = returnTrue;\n\t\t\t\t};\n\n\t\t\t\t// Add stopPropagation\n\t\t\t\targs.stopPropagation = function() {\n\t\t\t\t\targs.isPropagationStopped = returnTrue;\n\t\t\t\t};\n\n\t\t\t\t// Add stopImmediatePropagation\n\t\t\t\targs.stopImmediatePropagation = function() {\n\t\t\t\t\targs.isImmediatePropagationStopped = returnTrue;\n\t\t\t\t};\n\n\t\t\t\t// Add event delegation states\n\t\t\t\targs.isDefaultPrevented = returnFalse;\n\t\t\t\targs.isPropagationStopped = returnFalse;\n\t\t\t\targs.isImmediatePropagationStopped = returnFalse;\n\t\t\t}\n\n\t\t\tif (settings.beforeFire) {\n\t\t\t\tsettings.beforeFire(args);\n\t\t\t}\n\n\t\t\thandlers = bindings[name];\n\t\t\tif (handlers) {\n\t\t\t\tfor (i = 0, l = handlers.length; i < l; i++) {\n\t\t\t\t\tcallback = handlers[i];\n\n\t\t\t\t\t// Unbind handlers marked with \"once\"\n\t\t\t\t\tif (callback.once) {\n\t\t\t\t\t\toff(name, callback.func);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Stop immediate propagation if needed\n\t\t\t\t\tif (args.isImmediatePropagationStopped()) {\n\t\t\t\t\t\targs.stopPropagation();\n\t\t\t\t\t\treturn args;\n\t\t\t\t\t}\n\n\t\t\t\t\t// If callback returns false then prevent default and stop all propagation\n\t\t\t\t\tif (callback.func.call(scope, args) === false) {\n\t\t\t\t\t\targs.preventDefault();\n\t\t\t\t\t\treturn args;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn args;\n\t\t}\n\n\t\t/**\n\t\t * Binds an event listener to a specific event by name.\n\t\t *\n\t\t * @method on\n\t\t * @param {String} name Event name or space separated list of events to bind.\n\t\t * @param {callback} callback Callback to be executed when the event occurs.\n\t\t * @param {Boolean} first Optional flag if the event should be prepended. Use this with care.\n\t\t * @return {Object} Current class instance.\n\t\t * @example\n\t\t * instance.on('event', function(e) {\n\t\t *     // Callback logic\n\t\t * });\n\t\t */\n\t\tfunction on(name, callback, prepend, extra) {\n\t\t\tvar handlers, names, i;\n\n\t\t\tif (callback === false) {\n\t\t\t\tcallback = returnFalse;\n\t\t\t}\n\n\t\t\tif (callback) {\n\t\t\t\tcallback = {\n\t\t\t\t\tfunc: callback\n\t\t\t\t};\n\n\t\t\t\tif (extra) {\n\t\t\t\t\tTools.extend(callback, extra);\n\t\t\t\t}\n\n\t\t\t\tnames = name.toLowerCase().split(' ');\n\t\t\t\ti = names.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tname = names[i];\n\t\t\t\t\thandlers = bindings[name];\n\t\t\t\t\tif (!handlers) {\n\t\t\t\t\t\thandlers = bindings[name] = [];\n\t\t\t\t\t\ttoggleEvent(name, true);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (prepend) {\n\t\t\t\t\t\thandlers.unshift(callback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandlers.push(callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self;\n\t\t}\n\n\t\t/**\n\t\t * Unbinds an event listener to a specific event by name.\n\t\t *\n\t\t * @method off\n\t\t * @param {String?} name Name of the event to unbind.\n\t\t * @param {callback?} callback Callback to unbind.\n\t\t * @return {Object} Current class instance.\n\t\t * @example\n\t\t * // Unbind specific callback\n\t\t * instance.off('event', handler);\n\t\t *\n\t\t * // Unbind all listeners by name\n\t\t * instance.off('event');\n\t\t *\n\t\t * // Unbind all events\n\t\t * instance.off();\n\t\t */\n\t\tfunction off(name, callback) {\n\t\t\tvar i, handlers, bindingName, names, hi;\n\n\t\t\tif (name) {\n\t\t\t\tnames = name.toLowerCase().split(' ');\n\t\t\t\ti = names.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tname = names[i];\n\t\t\t\t\thandlers = bindings[name];\n\n\t\t\t\t\t// Unbind all handlers\n\t\t\t\t\tif (!name) {\n\t\t\t\t\t\tfor (bindingName in bindings) {\n\t\t\t\t\t\t\ttoggleEvent(bindingName, false);\n\t\t\t\t\t\t\tdelete bindings[bindingName];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn self;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (handlers) {\n\t\t\t\t\t\t// Unbind all by name\n\t\t\t\t\t\tif (!callback) {\n\t\t\t\t\t\t\thandlers.length = 0;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Unbind specific ones\n\t\t\t\t\t\t\thi = handlers.length;\n\t\t\t\t\t\t\twhile (hi--) {\n\t\t\t\t\t\t\t\tif (handlers[hi].func === callback) {\n\t\t\t\t\t\t\t\t\thandlers = handlers.slice(0, hi).concat(handlers.slice(hi + 1));\n\t\t\t\t\t\t\t\t\tbindings[name] = handlers;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!handlers.length) {\n\t\t\t\t\t\t\ttoggleEvent(name, false);\n\t\t\t\t\t\t\tdelete bindings[name];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (name in bindings) {\n\t\t\t\t\ttoggleEvent(name, false);\n\t\t\t\t}\n\n\t\t\t\tbindings = {};\n\t\t\t}\n\n\t\t\treturn self;\n\t\t}\n\n\t\t/**\n\t\t * Binds an event listener to a specific event by name\n\t\t * and automatically unbind the event once the callback fires.\n\t\t *\n\t\t * @method once\n\t\t * @param {String} name Event name or space separated list of events to bind.\n\t\t * @param {callback} callback Callback to be executed when the event occurs.\n\t\t * @param {Boolean} first Optional flag if the event should be prepended. Use this with care.\n\t\t * @return {Object} Current class instance.\n\t\t * @example\n\t\t * instance.once('event', function(e) {\n\t\t *     // Callback logic\n\t\t * });\n\t\t */\n\t\tfunction once(name, callback, prepend) {\n\t\t\treturn on(name, callback, prepend, {once: true});\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if the dispatcher has a event of the specified name.\n\t\t *\n\t\t * @method has\n\t\t * @param {String} name Name of the event to check for.\n\t\t * @return {Boolean} true/false if the event exists or not.\n\t\t */\n\t\tfunction has(name) {\n\t\t\tname = name.toLowerCase();\n\t\t\treturn !(!bindings[name] || bindings[name].length === 0);\n\t\t}\n\n\t\t// Expose\n\t\tself.fire = fire;\n\t\tself.on = on;\n\t\tself.off = off;\n\t\tself.once = once;\n\t\tself.has = has;\n\t}\n\n\t/**\n\t * Returns true/false if the specified event name is a native browser event or not.\n\t *\n\t * @method isNative\n\t * @param {String} name Name to check if it's native.\n\t * @return {Boolean} true/false if the event is native or not.\n\t * @static\n\t */\n\tDispatcher.isNative = function(name) {\n\t\treturn !!nativeEvents[name.toLowerCase()];\n\t};\n\n\treturn Dispatcher;\n});\n\n// Included from: js/tinymce/classes/data/Binding.js\n\n/**\n * Binding.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class gets dynamically extended to provide a binding between two models. This makes it possible to\n * sync the state of two properties in two models by a layer of abstraction.\n *\n * @private\n * @class tinymce.data.Binding\n */\ndefine(\"tinymce/data/Binding\", [], function() {\n\t/**\n\t * Constructs a new bidning.\n\t *\n\t * @constructor\n\t * @method Binding\n\t * @param {Object} settings Settings to the binding.\n\t */\n\tfunction Binding(settings) {\n\t\tthis.create = settings.create;\n\t}\n\n\t/**\n\t * Creates a binding for a property on a model.\n\t *\n\t * @method create\n\t * @param {tinymce.data.ObservableObject} model Model to create binding to.\n\t * @param {String} name Name of property to bind.\n\t * @return {tinymce.data.Binding} Binding instance.\n\t */\n\tBinding.create = function(model, name) {\n\t\treturn new Binding({\n\t\t\tcreate: function(otherModel, otherName) {\n\t\t\t\tvar bindings;\n\n\t\t\t\tfunction fromSelfToOther(e) {\n\t\t\t\t\totherModel.set(otherName, e.value);\n\t\t\t\t}\n\n\t\t\t\tfunction fromOtherToSelf(e) {\n\t\t\t\t\tmodel.set(name, e.value);\n\t\t\t\t}\n\n\t\t\t\totherModel.on('change:' + otherName, fromOtherToSelf);\n\t\t\t\tmodel.on('change:' + name, fromSelfToOther);\n\n\t\t\t\t// Keep track of the bindings\n\t\t\t\tbindings = otherModel._bindings;\n\n\t\t\t\tif (!bindings) {\n\t\t\t\t\tbindings = otherModel._bindings = [];\n\n\t\t\t\t\totherModel.on('destroy', function() {\n\t\t\t\t\t\tvar i = bindings.length;\n\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tbindings[i]();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tbindings.push(function() {\n\t\t\t\t\tmodel.off('change:' + name, fromSelfToOther);\n\t\t\t\t});\n\n\t\t\t\treturn model.get(name);\n\t\t\t}\n\t\t});\n\t};\n\n\treturn Binding;\n});\n\n// Included from: js/tinymce/classes/util/Observable.js\n\n/**\n * Observable.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This mixin will add event binding logic to classes.\n *\n * @mixin tinymce.util.Observable\n */\ndefine(\"tinymce/util/Observable\", [\n\t\"tinymce/util/EventDispatcher\"\n], function(EventDispatcher) {\n\tfunction getEventDispatcher(obj) {\n\t\tif (!obj._eventDispatcher) {\n\t\t\tobj._eventDispatcher = new EventDispatcher({\n\t\t\t\tscope: obj,\n\t\t\t\ttoggleEvent: function(name, state) {\n\t\t\t\t\tif (EventDispatcher.isNative(name) && obj.toggleNativeEvent) {\n\t\t\t\t\t\tobj.toggleNativeEvent(name, state);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn obj._eventDispatcher;\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Fires the specified event by name.\n\t\t *\n\t\t * @method fire\n\t\t * @param {String} name Name of the event to fire.\n\t\t * @param {Object?} args Event arguments.\n\t\t * @param {Boolean?} bubble True/false if the event is to be bubbled.\n\t\t * @return {Object} Event args instance passed in.\n\t\t * @example\n\t\t * instance.fire('event', {...});\n\t\t */\n\t\tfire: function(name, args, bubble) {\n\t\t\tvar self = this;\n\n\t\t\t// Prevent all events except the remove event after the instance has been removed\n\t\t\tif (self.removed && name !== \"remove\") {\n\t\t\t\treturn args;\n\t\t\t}\n\n\t\t\targs = getEventDispatcher(self).fire(name, args, bubble);\n\n\t\t\t// Bubble event up to parents\n\t\t\tif (bubble !== false && self.parent) {\n\t\t\t\tvar parent = self.parent();\n\t\t\t\twhile (parent && !args.isPropagationStopped()) {\n\t\t\t\t\tparent.fire(name, args, false);\n\t\t\t\t\tparent = parent.parent();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn args;\n\t\t},\n\n\t\t/**\n\t\t * Binds an event listener to a specific event by name.\n\t\t *\n\t\t * @method on\n\t\t * @param {String} name Event name or space separated list of events to bind.\n\t\t * @param {callback} callback Callback to be executed when the event occurs.\n\t\t * @param {Boolean} first Optional flag if the event should be prepended. Use this with care.\n\t\t * @return {Object} Current class instance.\n\t\t * @example\n\t\t * instance.on('event', function(e) {\n\t\t *     // Callback logic\n\t\t * });\n\t\t */\n\t\ton: function(name, callback, prepend) {\n\t\t\treturn getEventDispatcher(this).on(name, callback, prepend);\n\t\t},\n\n\t\t/**\n\t\t * Unbinds an event listener to a specific event by name.\n\t\t *\n\t\t * @method off\n\t\t * @param {String?} name Name of the event to unbind.\n\t\t * @param {callback?} callback Callback to unbind.\n\t\t * @return {Object} Current class instance.\n\t\t * @example\n\t\t * // Unbind specific callback\n\t\t * instance.off('event', handler);\n\t\t *\n\t\t * // Unbind all listeners by name\n\t\t * instance.off('event');\n\t\t *\n\t\t * // Unbind all events\n\t\t * instance.off();\n\t\t */\n\t\toff: function(name, callback) {\n\t\t\treturn getEventDispatcher(this).off(name, callback);\n\t\t},\n\n\t\t/**\n\t\t * Bind the event callback and once it fires the callback is removed.\n\t\t *\n\t\t * @method once\n\t\t * @param {String} name Name of the event to bind.\n\t\t * @param {callback} callback Callback to bind only once.\n\t\t * @return {Object} Current class instance.\n\t\t */\n\t\tonce: function(name, callback) {\n\t\t\treturn getEventDispatcher(this).once(name, callback);\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the object has a event of the specified name.\n\t\t *\n\t\t * @method hasEventListeners\n\t\t * @param {String} name Name of the event to check for.\n\t\t * @return {Boolean} true/false if the event exists or not.\n\t\t */\n\t\thasEventListeners: function(name) {\n\t\t\treturn getEventDispatcher(this).has(name);\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/data/ObservableObject.js\n\n/**\n * ObservableObject.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is a object that is observable when properties changes a change event gets emitted.\n *\n * @private\n * @class tinymce.data.ObservableObject\n */\ndefine(\"tinymce/data/ObservableObject\", [\n\t\"tinymce/data/Binding\",\n\t\"tinymce/util/Observable\",\n\t\"tinymce/util/Class\",\n\t\"tinymce/util/Tools\"\n], function(Binding, Observable, Class, Tools) {\n\tfunction isNode(node) {\n\t\treturn node.nodeType > 0;\n\t}\n\n\t// Todo: Maybe this should be shallow compare since it might be huge object references\n\tfunction isEqual(a, b) {\n\t\tvar k, checked;\n\n\t\t// Strict equals\n\t\tif (a === b) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Compare null\n\t\tif (a === null || b === null) {\n\t\t\treturn a === b;\n\t\t}\n\n\t\t// Compare number, boolean, string, undefined\n\t\tif (typeof a !== \"object\" || typeof b !== \"object\") {\n\t\t\treturn a === b;\n\t\t}\n\n\t\t// Compare arrays\n\t\tif (Tools.isArray(b)) {\n\t\t\tif (a.length !== b.length) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tk = a.length;\n\t\t\twhile (k--) {\n\t\t\t\tif (!isEqual(a[k], b[k])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Shallow compare nodes\n\t\tif (isNode(a) || isNode(b)) {\n\t\t\treturn a === b;\n\t\t}\n\n\t\t// Compare objects\n\t\tchecked = {};\n\t\tfor (k in b) {\n\t\t\tif (!isEqual(a[k], b[k])) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tchecked[k] = true;\n\t\t}\n\n\t\tfor (k in a) {\n\t\t\tif (!checked[k] && !isEqual(a[k], b[k])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\treturn Class.extend({\n\t\tMixins: [Observable],\n\n\t\t/**\n\t\t * Constructs a new observable object instance.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} data Initial data for the object.\n\t\t */\n\t\tinit: function(data) {\n\t\t\tvar name, value;\n\n\t\t\tdata = data || {};\n\n\t\t\tfor (name in data) {\n\t\t\t\tvalue = data[name];\n\n\t\t\t\tif (value instanceof Binding) {\n\t\t\t\t\tdata[name] = value.create(this, name);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.data = data;\n\t\t},\n\n\t\t/**\n\t\t * Sets a property on the value this will call\n\t\t * observers if the value is a change from the current value.\n\t\t *\n\t\t * @method set\n\t\t * @param {String/object} name Name of the property to set or a object of items to set.\n\t\t * @param {Object} value Value to set for the property.\n\t\t * @return {tinymce.data.ObservableObject} Observable object instance.\n\t\t */\n\t\tset: function(name, value) {\n\t\t\tvar key, args, oldValue = this.data[name];\n\n\t\t\tif (value instanceof Binding) {\n\t\t\t\tvalue = value.create(this, name);\n\t\t\t}\n\n\t\t\tif (typeof name === \"object\") {\n\t\t\t\tfor (key in name) {\n\t\t\t\t\tthis.set(key, name[key]);\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tif (!isEqual(oldValue, value)) {\n\t\t\t\tthis.data[name] = value;\n\n\t\t\t\targs = {\n\t\t\t\t\ttarget: this,\n\t\t\t\t\tname: name,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\toldValue: oldValue\n\t\t\t\t};\n\n\t\t\t\tthis.fire('change:' + name, args);\n\t\t\t\tthis.fire('change', args);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Gets a property by name.\n\t\t *\n\t\t * @method get\n\t\t * @param {String} name Name of the property to get.\n\t\t * @return {Object} Object value of propery.\n\t\t */\n\t\tget: function(name) {\n\t\t\treturn this.data[name];\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the specified property exists.\n\t\t *\n\t\t * @method has\n\t\t * @param {String} name Name of the property to check for.\n\t\t * @return {Boolean} true/false if the item exists.\n\t\t */\n\t\thas: function(name) {\n\t\t\treturn name in this.data;\n\t\t},\n\n\t\t/**\n\t\t * Returns a dynamic property binding for the specified property name. This makes\n\t\t * it possible to sync the state of two properties in two ObservableObject instances.\n\t\t *\n\t\t * @method bind\n\t\t * @param {String} name Name of the property to sync with the property it's inserted to.\n\t\t * @return {tinymce.data.Binding} Data binding instance.\n\t\t */\n\t\tbind: function(name) {\n\t\t\treturn Binding.create(this, name);\n\t\t},\n\n\t\t/**\n\t\t * Destroys the observable object and fires the \"destroy\"\n\t\t * event and clean up any internal resources.\n\t\t *\n\t\t * @method destroy\n\t\t */\n\t\tdestroy: function() {\n\t\t\tthis.fire('destroy');\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Selector.js\n\n/**\n * Selector.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*eslint no-nested-ternary:0 */\n\n/**\n * Selector engine, enables you to select controls by using CSS like expressions.\n * We currently only support basic CSS expressions to reduce the size of the core\n * and the ones we support should be enough for most cases.\n *\n * @example\n * Supported expressions:\n *  element\n *  element#name\n *  element.class\n *  element[attr]\n *  element[attr*=value]\n *  element[attr~=value]\n *  element[attr!=value]\n *  element[attr^=value]\n *  element[attr$=value]\n *  element:<state>\n *  element:not(<expression>)\n *  element:first\n *  element:last\n *  element:odd\n *  element:even\n *  element element\n *  element > element\n *\n * @class tinymce.ui.Selector\n */\ndefine(\"tinymce/ui/Selector\", [\n\t\"tinymce/util/Class\"\n], function(Class) {\n\t\"use strict\";\n\n\t/**\n\t * Produces an array with a unique set of objects. It will not compare the values\n\t * but the references of the objects.\n\t *\n\t * @private\n\t * @method unqiue\n\t * @param {Array} array Array to make into an array with unique items.\n\t * @return {Array} Array with unique items.\n\t */\n\tfunction unique(array) {\n\t\tvar uniqueItems = [], i = array.length, item;\n\n\t\twhile (i--) {\n\t\t\titem = array[i];\n\n\t\t\tif (!item.__checked) {\n\t\t\t\tuniqueItems.push(item);\n\t\t\t\titem.__checked = 1;\n\t\t\t}\n\t\t}\n\n\t\ti = uniqueItems.length;\n\t\twhile (i--) {\n\t\t\tdelete uniqueItems[i].__checked;\n\t\t}\n\n\t\treturn uniqueItems;\n\t}\n\n\tvar expression = /^([\\w\\\\*]+)?(?:#([\\w\\-\\\\]+))?(?:\\.([\\w\\\\\\.]+))?(?:\\[\\@?([\\w\\\\]+)([\\^\\$\\*!~]?=)([\\w\\\\]+)\\])?(?:\\:(.+))?/i;\n\n\t/*jshint maxlen:255 */\n\t/*eslint max-len:0 */\n\tvar chunker = /((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^\\[\\]]*\\]|['\"][^'\"]*['\"]|[^\\[\\]'\"]+)+\\]|\\\\.|[^ >+~,(\\[\\\\]+)+|[>+~])(\\s*,\\s*)?((?:.|\\r|\\n)*)/g,\n\t\twhiteSpace = /^\\s*|\\s*$/g,\n\t\tCollection;\n\n\tvar Selector = Class.extend({\n\t\t/**\n\t\t * Constructs a new Selector instance.\n\t\t *\n\t\t * @constructor\n\t\t * @method init\n\t\t * @param {String} selector CSS like selector expression.\n\t\t */\n\t\tinit: function(selector) {\n\t\t\tvar match = this.match;\n\n\t\t\tfunction compileNameFilter(name) {\n\t\t\t\tif (name) {\n\t\t\t\t\tname = name.toLowerCase();\n\n\t\t\t\t\treturn function(item) {\n\t\t\t\t\t\treturn name === '*' || item.type === name;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction compileIdFilter(id) {\n\t\t\t\tif (id) {\n\t\t\t\t\treturn function(item) {\n\t\t\t\t\t\treturn item._name === id;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction compileClassesFilter(classes) {\n\t\t\t\tif (classes) {\n\t\t\t\t\tclasses = classes.split('.');\n\n\t\t\t\t\treturn function(item) {\n\t\t\t\t\t\tvar i = classes.length;\n\n\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\tif (!item.classes.contains(classes[i])) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction compileAttrFilter(name, cmp, check) {\n\t\t\t\tif (name) {\n\t\t\t\t\treturn function(item) {\n\t\t\t\t\t\tvar value = item[name] ? item[name]() : '';\n\n\t\t\t\t\t\treturn !cmp ? !!check :\n\t\t\t\t\t\t\tcmp === \"=\" ? value === check :\n\t\t\t\t\t\t\tcmp === \"*=\" ? value.indexOf(check) >= 0 :\n\t\t\t\t\t\t\tcmp === \"~=\" ? (\" \" + value + \" \").indexOf(\" \" + check + \" \") >= 0 :\n\t\t\t\t\t\t\tcmp === \"!=\" ? value != check :\n\t\t\t\t\t\t\tcmp === \"^=\" ? value.indexOf(check) === 0 :\n\t\t\t\t\t\t\tcmp === \"$=\" ? value.substr(value.length - check.length) === check :\n\t\t\t\t\t\t\tfalse;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction compilePsuedoFilter(name) {\n\t\t\t\tvar notSelectors;\n\n\t\t\t\tif (name) {\n\t\t\t\t\tname = /(?:not\\((.+)\\))|(.+)/i.exec(name);\n\n\t\t\t\t\tif (!name[1]) {\n\t\t\t\t\t\tname = name[2];\n\n\t\t\t\t\t\treturn function(item, index, length) {\n\t\t\t\t\t\t\treturn name === 'first' ? index === 0 :\n\t\t\t\t\t\t\t\tname === 'last' ? index === length - 1 :\n\t\t\t\t\t\t\t\tname === 'even' ? index % 2 === 0 :\n\t\t\t\t\t\t\t\tname === 'odd' ? index % 2 === 1 :\n\t\t\t\t\t\t\t\titem[name] ? item[name]() :\n\t\t\t\t\t\t\t\tfalse;\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\t// Compile not expression\n\t\t\t\t\tnotSelectors = parseChunks(name[1], []);\n\n\t\t\t\t\treturn function(item) {\n\t\t\t\t\t\treturn !match(item, notSelectors);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction compile(selector, filters, direct) {\n\t\t\t\tvar parts;\n\n\t\t\t\tfunction add(filter) {\n\t\t\t\t\tif (filter) {\n\t\t\t\t\t\tfilters.push(filter);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Parse expression into parts\n\t\t\t\tparts = expression.exec(selector.replace(whiteSpace, ''));\n\n\t\t\t\tadd(compileNameFilter(parts[1]));\n\t\t\t\tadd(compileIdFilter(parts[2]));\n\t\t\t\tadd(compileClassesFilter(parts[3]));\n\t\t\t\tadd(compileAttrFilter(parts[4], parts[5], parts[6]));\n\t\t\t\tadd(compilePsuedoFilter(parts[7]));\n\n\t\t\t\t// Mark the filter with pseudo for performance\n\t\t\t\tfilters.pseudo = !!parts[7];\n\t\t\t\tfilters.direct = direct;\n\n\t\t\t\treturn filters;\n\t\t\t}\n\n\t\t\t// Parser logic based on Sizzle by John Resig\n\t\t\tfunction parseChunks(selector, selectors) {\n\t\t\t\tvar parts = [], extra, matches, i;\n\n\t\t\t\tdo {\n\t\t\t\t\tchunker.exec(\"\");\n\t\t\t\t\tmatches = chunker.exec(selector);\n\n\t\t\t\t\tif (matches) {\n\t\t\t\t\t\tselector = matches[3];\n\t\t\t\t\t\tparts.push(matches[1]);\n\n\t\t\t\t\t\tif (matches[2]) {\n\t\t\t\t\t\t\textra = matches[3];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} while (matches);\n\n\t\t\t\tif (extra) {\n\t\t\t\t\tparseChunks(extra, selectors);\n\t\t\t\t}\n\n\t\t\t\tselector = [];\n\t\t\t\tfor (i = 0; i < parts.length; i++) {\n\t\t\t\t\tif (parts[i] != '>') {\n\t\t\t\t\t\tselector.push(compile(parts[i], [], parts[i - 1] === '>'));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tselectors.push(selector);\n\n\t\t\t\treturn selectors;\n\t\t\t}\n\n\t\t\tthis._selectors = parseChunks(selector, []);\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the selector matches the specified control.\n\t\t *\n\t\t * @method match\n\t\t * @param {tinymce.ui.Control} control Control to match against the selector.\n\t\t * @param {Array} selectors Optional array of selectors, mostly used internally.\n\t\t * @return {Boolean} true/false state if the control matches or not.\n\t\t */\n\t\tmatch: function(control, selectors) {\n\t\t\tvar i, l, si, sl, selector, fi, fl, filters, index, length, siblings, count, item;\n\n\t\t\tselectors = selectors || this._selectors;\n\t\t\tfor (i = 0, l = selectors.length; i < l; i++) {\n\t\t\t\tselector = selectors[i];\n\t\t\t\tsl = selector.length;\n\t\t\t\titem = control;\n\t\t\t\tcount = 0;\n\n\t\t\t\tfor (si = sl - 1; si >= 0; si--) {\n\t\t\t\t\tfilters = selector[si];\n\n\t\t\t\t\twhile (item) {\n\t\t\t\t\t\t// Find the index and length since a pseudo filter like :first needs it\n\t\t\t\t\t\tif (filters.pseudo) {\n\t\t\t\t\t\t\tsiblings = item.parent().items();\n\t\t\t\t\t\t\tindex = length = siblings.length;\n\t\t\t\t\t\t\twhile (index--) {\n\t\t\t\t\t\t\t\tif (siblings[index] === item) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (fi = 0, fl = filters.length; fi < fl; fi++) {\n\t\t\t\t\t\t\tif (!filters[fi](item, index, length)) {\n\t\t\t\t\t\t\t\tfi = fl + 1;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (fi === fl) {\n\t\t\t\t\t\t\tcount++;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// If it didn't match the right most expression then\n\t\t\t\t\t\t\t// break since it's no point looking at the parents\n\t\t\t\t\t\t\tif (si === sl - 1) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\titem = item.parent();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If we found all selectors then return true otherwise continue looking\n\t\t\t\tif (count === sl) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Returns a tinymce.ui.Collection with matches of the specified selector inside the specified container.\n\t\t *\n\t\t * @method find\n\t\t * @param {tinymce.ui.Control} container Container to look for items in.\n\t\t * @return {tinymce.ui.Collection} Collection with matched elements.\n\t\t */\n\t\tfind: function(container) {\n\t\t\tvar matches = [], i, l, selectors = this._selectors;\n\n\t\t\tfunction collect(items, selector, index) {\n\t\t\t\tvar i, l, fi, fl, item, filters = selector[index];\n\n\t\t\t\tfor (i = 0, l = items.length; i < l; i++) {\n\t\t\t\t\titem = items[i];\n\n\t\t\t\t\t// Run each filter against the item\n\t\t\t\t\tfor (fi = 0, fl = filters.length; fi < fl; fi++) {\n\t\t\t\t\t\tif (!filters[fi](item, i, l)) {\n\t\t\t\t\t\t\tfi = fl + 1;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// All filters matched the item\n\t\t\t\t\tif (fi === fl) {\n\t\t\t\t\t\t// Matched item is on the last expression like: panel toolbar [button]\n\t\t\t\t\t\tif (index == selector.length - 1) {\n\t\t\t\t\t\t\tmatches.push(item);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Collect next expression type\n\t\t\t\t\t\t\tif (item.items) {\n\t\t\t\t\t\t\t\tcollect(item.items(), selector, index + 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (filters.direct) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Collect child items\n\t\t\t\t\tif (item.items) {\n\t\t\t\t\t\tcollect(item.items(), selector, index);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (container.items) {\n\t\t\t\tfor (i = 0, l = selectors.length; i < l; i++) {\n\t\t\t\t\tcollect(container.items(), selectors[i], 0);\n\t\t\t\t}\n\n\t\t\t\t// Unique the matches if needed\n\t\t\t\tif (l > 1) {\n\t\t\t\t\tmatches = unique(matches);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Fix for circular reference\n\t\t\tif (!Collection) {\n\t\t\t\t// TODO: Fix me!\n\t\t\t\tCollection = Selector.Collection;\n\t\t\t}\n\n\t\t\treturn new Collection(matches);\n\t\t}\n\t});\n\n\treturn Selector;\n});\n\n// Included from: js/tinymce/classes/ui/Collection.js\n\n/**\n * Collection.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Control collection, this class contains control instances and it enables you to\n * perform actions on all the contained items. This is very similar to how jQuery works.\n *\n * @example\n * someCollection.show().disabled(true);\n *\n * @class tinymce.ui.Collection\n */\ndefine(\"tinymce/ui/Collection\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/ui/Selector\",\n\t\"tinymce/util/Class\"\n], function(Tools, Selector, Class) {\n\t\"use strict\";\n\n\tvar Collection, proto, push = Array.prototype.push, slice = Array.prototype.slice;\n\n\tproto = {\n\t\t/**\n\t\t * Current number of contained control instances.\n\t\t *\n\t\t * @field length\n\t\t * @type Number\n\t\t */\n\t\tlength: 0,\n\n\t\t/**\n\t\t * Constructor for the collection.\n\t\t *\n\t\t * @constructor\n\t\t * @method init\n\t\t * @param {Array} items Optional array with items to add.\n\t\t */\n\t\tinit: function(items) {\n\t\t\tif (items) {\n\t\t\t\tthis.add(items);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Adds new items to the control collection.\n\t\t *\n\t\t * @method add\n\t\t * @param {Array} items Array if items to add to collection.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\tadd: function(items) {\n\t\t\tvar self = this;\n\n\t\t\t// Force single item into array\n\t\t\tif (!Tools.isArray(items)) {\n\t\t\t\tif (items instanceof Collection) {\n\t\t\t\t\tself.add(items.toArray());\n\t\t\t\t} else {\n\t\t\t\t\tpush.call(self, items);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpush.apply(self, items);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Sets the contents of the collection. This will remove any existing items\n\t\t * and replace them with the ones specified in the input array.\n\t\t *\n\t\t * @method set\n\t\t * @param {Array} items Array with items to set into the Collection.\n\t\t * @return {tinymce.ui.Collection} Collection instance.\n\t\t */\n\t\tset: function(items) {\n\t\t\tvar self = this, len = self.length, i;\n\n\t\t\tself.length = 0;\n\t\t\tself.add(items);\n\n\t\t\t// Remove old entries\n\t\t\tfor (i = self.length; i < len; i++) {\n\t\t\t\tdelete self[i];\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Filters the collection item based on the specified selector expression or selector function.\n\t\t *\n\t\t * @method filter\n\t\t * @param {String} selector Selector expression to filter items by.\n\t\t * @return {tinymce.ui.Collection} Collection containing the filtered items.\n\t\t */\n\t\tfilter: function(selector) {\n\t\t\tvar self = this, i, l, matches = [], item, match;\n\n\t\t\t// Compile string into selector expression\n\t\t\tif (typeof selector === \"string\") {\n\t\t\t\tselector = new Selector(selector);\n\n\t\t\t\tmatch = function(item) {\n\t\t\t\t\treturn selector.match(item);\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// Use selector as matching function\n\t\t\t\tmatch = selector;\n\t\t\t}\n\n\t\t\tfor (i = 0, l = self.length; i < l; i++) {\n\t\t\t\titem = self[i];\n\n\t\t\t\tif (match(item)) {\n\t\t\t\t\tmatches.push(item);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn new Collection(matches);\n\t\t},\n\n\t\t/**\n\t\t * Slices the items within the collection.\n\t\t *\n\t\t * @method slice\n\t\t * @param {Number} index Index to slice at.\n\t\t * @param {Number} len Optional length to slice.\n\t\t * @return {tinymce.ui.Collection} Current collection.\n\t\t */\n\t\tslice: function() {\n\t\t\treturn new Collection(slice.apply(this, arguments));\n\t\t},\n\n\t\t/**\n\t\t * Makes the current collection equal to the specified index.\n\t\t *\n\t\t * @method eq\n\t\t * @param {Number} index Index of the item to set the collection to.\n\t\t * @return {tinymce.ui.Collection} Current collection.\n\t\t */\n\t\teq: function(index) {\n\t\t\treturn index === -1 ? this.slice(index) : this.slice(index, +index + 1);\n\t\t},\n\n\t\t/**\n\t\t * Executes the specified callback on each item in collection.\n\t\t *\n\t\t * @method each\n\t\t * @param {function} callback Callback to execute for each item in collection.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\teach: function(callback) {\n\t\t\tTools.each(this, callback);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Returns an JavaScript array object of the contents inside the collection.\n\t\t *\n\t\t * @method toArray\n\t\t * @return {Array} Array with all items from collection.\n\t\t */\n\t\ttoArray: function() {\n\t\t\treturn Tools.toArray(this);\n\t\t},\n\n\t\t/**\n\t\t * Finds the index of the specified control or return -1 if it isn't in the collection.\n\t\t *\n\t\t * @method indexOf\n\t\t * @param {Control} ctrl Control instance to look for.\n\t\t * @return {Number} Index of the specified control or -1.\n\t\t */\n\t\tindexOf: function(ctrl) {\n\t\t\tvar self = this, i = self.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tif (self[i] === ctrl) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn i;\n\t\t},\n\n\t\t/**\n\t\t * Returns a new collection of the contents in reverse order.\n\t\t *\n\t\t * @method reverse\n\t\t * @return {tinymce.ui.Collection} Collection instance with reversed items.\n\t\t */\n\t\treverse: function() {\n\t\t\treturn new Collection(Tools.toArray(this).reverse());\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the class exists or not.\n\t\t *\n\t\t * @method hasClass\n\t\t * @param {String} cls Class to check for.\n\t\t * @return {Boolean} true/false state if the class exists or not.\n\t\t */\n\t\thasClass: function(cls) {\n\t\t\treturn this[0] ? this[0].classes.contains(cls) : false;\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets the specific property on the items in the collection. The same as executing control.<property>(<value>);\n\t\t *\n\t\t * @method prop\n\t\t * @param {String} name Property name to get/set.\n\t\t * @param {Object} value Optional object value to set.\n\t\t * @return {tinymce.ui.Collection} Current collection instance or value of the first item on a get operation.\n\t\t */\n\t\tprop: function(name, value) {\n\t\t\tvar self = this, undef, item;\n\n\t\t\tif (value !== undef) {\n\t\t\t\tself.each(function(item) {\n\t\t\t\t\tif (item[name]) {\n\t\t\t\t\t\titem[name](value);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\titem = self[0];\n\n\t\t\tif (item && item[name]) {\n\t\t\t\treturn item[name]();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Executes the specific function name with optional arguments an all items in collection if it exists.\n\t\t *\n\t\t * @example collection.exec(\"myMethod\", arg1, arg2, arg3);\n\t\t * @method exec\n\t\t * @param {String} name Name of the function to execute.\n\t\t * @param {Object} ... Multiple arguments to pass to each function.\n\t\t * @return {tinymce.ui.Collection} Current collection.\n\t\t */\n\t\texec: function(name) {\n\t\t\tvar self = this, args = Tools.toArray(arguments).slice(1);\n\n\t\t\tself.each(function(item) {\n\t\t\t\tif (item[name]) {\n\t\t\t\t\titem[name].apply(item, args);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Remove all items from collection and DOM.\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.ui.Collection} Current collection.\n\t\t */\n\t\tremove: function() {\n\t\t\tvar i = this.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tthis[i].remove();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Adds a class to all items in the collection.\n\t\t *\n\t\t * @method addClass\n\t\t * @param {String} cls Class to add to each item.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\taddClass: function(cls) {\n\t\t\treturn this.each(function(item) {\n\t\t\t\titem.classes.add(cls);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified class from all items in collection.\n\t\t *\n\t\t * @method removeClass\n\t\t * @param {String} cls Class to remove from each item.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\tremoveClass: function(cls) {\n\t\t\treturn this.each(function(item) {\n\t\t\t\titem.classes.remove(cls);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Fires the specified event by name and arguments on the control. This will execute all\n\t\t * bound event handlers.\n\t\t *\n\t\t * @method fire\n\t\t * @param {String} name Name of the event to fire.\n\t\t * @param {Object} args Optional arguments to pass to the event.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\t// fire: function(event, args) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Binds a callback to the specified event. This event can both be\n\t\t * native browser events like \"click\" or custom ones like PostRender.\n\t\t *\n\t\t * The callback function will have two parameters the first one being the control that received the event\n\t\t * the second one will be the event object either the browsers native event object or a custom JS object.\n\t\t *\n\t\t * @method on\n\t\t * @param {String} name Name of the event to bind. For example \"click\".\n\t\t * @param {String/function} callback Callback function to execute ones the event occurs.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\t// on: function(name, callback) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Unbinds the specified event and optionally a specific callback. If you omit the name\n\t\t * parameter all event handlers will be removed. If you omit the callback all event handles\n\t\t * by the specified name will be removed.\n\t\t *\n\t\t * @method off\n\t\t * @param {String} name Optional name for the event to unbind.\n\t\t * @param {function} callback Optional callback function to unbind.\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\t// off: function(name, callback) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Shows the items in the current collection.\n\t\t *\n\t\t * @method show\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\t// show: function() {}, -- Generated by code below\n\n\t\t/**\n\t\t * Hides the items in the current collection.\n\t\t *\n\t\t * @method hide\n\t\t * @return {tinymce.ui.Collection} Current collection instance.\n\t\t */\n\t\t// hide: function() {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the text contents of the items in the current collection.\n\t\t *\n\t\t * @method text\n\t\t * @return {tinymce.ui.Collection} Current collection instance or text value of the first item on a get operation.\n\t\t */\n\t\t// text: function(value) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the name contents of the items in the current collection.\n\t\t *\n\t\t * @method name\n\t\t * @return {tinymce.ui.Collection} Current collection instance or name value of the first item on a get operation.\n\t\t */\n\t\t// name: function(value) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the disabled state on the items in the current collection.\n\t\t *\n\t\t * @method disabled\n\t\t * @return {tinymce.ui.Collection} Current collection instance or disabled state of the first item on a get operation.\n\t\t */\n\t\t// disabled: function(state) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the active state on the items in the current collection.\n\t\t *\n\t\t * @method active\n\t\t * @return {tinymce.ui.Collection} Current collection instance or active state of the first item on a get operation.\n\t\t */\n\t\t// active: function(state) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the selected state on the items in the current collection.\n\t\t *\n\t\t * @method selected\n\t\t * @return {tinymce.ui.Collection} Current collection instance or selected state of the first item on a get operation.\n\t\t */\n\t\t// selected: function(state) {}, -- Generated by code below\n\n\t\t/**\n\t\t * Sets/gets the selected state on the items in the current collection.\n\t\t *\n\t\t * @method visible\n\t\t * @return {tinymce.ui.Collection} Current collection instance or visible state of the first item on a get operation.\n\t\t */\n\t\t// visible: function(state) {}, -- Generated by code below\n\t};\n\n\t// Extend tinymce.ui.Collection prototype with some generated control specific methods\n\tTools.each('fire on off show hide append prepend before after reflow'.split(' '), function(name) {\n\t\tproto[name] = function() {\n\t\t\tvar args = Tools.toArray(arguments);\n\n\t\t\tthis.each(function(ctrl) {\n\t\t\t\tif (name in ctrl) {\n\t\t\t\t\tctrl[name].apply(ctrl, args);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn this;\n\t\t};\n\t});\n\n\t// Extend tinymce.ui.Collection prototype with some property methods\n\tTools.each('text name disabled active selected checked visible parent value data'.split(' '), function(name) {\n\t\tproto[name] = function(value) {\n\t\t\treturn this.prop(name, value);\n\t\t};\n\t});\n\n\t// Create class based on the new prototype\n\tCollection = Class.extend(proto);\n\n\t// Stick Collection into Selector to prevent circual references\n\tSelector.Collection = Collection;\n\n\treturn Collection;\n});\n\n// Included from: js/tinymce/classes/ui/DomUtils.js\n\n/**\n * DomUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Private UI DomUtils proxy.\n *\n * @private\n * @class tinymce.ui.DomUtils\n */\ndefine(\"tinymce/ui/DomUtils\", [\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/DOMUtils\"\n], function(Env, Tools, DOMUtils) {\n\t\"use strict\";\n\n\tvar count = 0;\n\n\tvar funcs = {\n\t\tid: function() {\n\t\t\treturn 'mceu_' + (count++);\n\t\t},\n\n\t\tcreate: function(name, attrs, children) {\n\t\t\tvar elm = document.createElement(name);\n\n\t\t\tDOMUtils.DOM.setAttribs(elm, attrs);\n\n\t\t\tif (typeof children === 'string') {\n\t\t\t\telm.innerHTML = children;\n\t\t\t} else {\n\t\t\t\tTools.each(children, function(child) {\n\t\t\t\t\tif (child.nodeType) {\n\t\t\t\t\t\telm.appendChild(child);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn elm;\n\t\t},\n\n\t\tcreateFragment: function(html) {\n\t\t\treturn DOMUtils.DOM.createFragment(html);\n\t\t},\n\n\t\tgetWindowSize: function() {\n\t\t\treturn DOMUtils.DOM.getViewPort();\n\t\t},\n\n\t\tgetSize: function(elm) {\n\t\t\tvar width, height;\n\n\t\t\tif (elm.getBoundingClientRect) {\n\t\t\t\tvar rect = elm.getBoundingClientRect();\n\n\t\t\t\twidth = Math.max(rect.width || (rect.right - rect.left), elm.offsetWidth);\n\t\t\t\theight = Math.max(rect.height || (rect.bottom - rect.bottom), elm.offsetHeight);\n\t\t\t} else {\n\t\t\t\twidth = elm.offsetWidth;\n\t\t\t\theight = elm.offsetHeight;\n\t\t\t}\n\n\t\t\treturn {width: width, height: height};\n\t\t},\n\n\t\tgetPos: function(elm, root) {\n\t\t\treturn DOMUtils.DOM.getPos(elm, root || funcs.getContainer());\n\t\t},\n\n\t\tgetContainer: function () {\n\t\t\treturn Env.container ? Env.container : document.body;\n\t\t},\n\n\t\tgetViewPort: function(win) {\n\t\t\treturn DOMUtils.DOM.getViewPort(win);\n\t\t},\n\n\t\tget: function(id) {\n\t\t\treturn document.getElementById(id);\n\t\t},\n\n\t\taddClass: function(elm, cls) {\n\t\t\treturn DOMUtils.DOM.addClass(elm, cls);\n\t\t},\n\n\t\tremoveClass: function(elm, cls) {\n\t\t\treturn DOMUtils.DOM.removeClass(elm, cls);\n\t\t},\n\n\t\thasClass: function(elm, cls) {\n\t\t\treturn DOMUtils.DOM.hasClass(elm, cls);\n\t\t},\n\n\t\ttoggleClass: function(elm, cls, state) {\n\t\t\treturn DOMUtils.DOM.toggleClass(elm, cls, state);\n\t\t},\n\n\t\tcss: function(elm, name, value) {\n\t\t\treturn DOMUtils.DOM.setStyle(elm, name, value);\n\t\t},\n\n\t\tgetRuntimeStyle: function(elm, name) {\n\t\t\treturn DOMUtils.DOM.getStyle(elm, name, true);\n\t\t},\n\n\t\ton: function(target, name, callback, scope) {\n\t\t\treturn DOMUtils.DOM.bind(target, name, callback, scope);\n\t\t},\n\n\t\toff: function(target, name, callback) {\n\t\t\treturn DOMUtils.DOM.unbind(target, name, callback);\n\t\t},\n\n\t\tfire: function(target, name, args) {\n\t\t\treturn DOMUtils.DOM.fire(target, name, args);\n\t\t},\n\n\t\tinnerHtml: function(elm, html) {\n\t\t\t// Workaround for <div> in <p> bug on IE 8 #6178\n\t\t\tDOMUtils.DOM.setHTML(elm, html);\n\t\t}\n\t};\n\n\treturn funcs;\n});\n\n// Included from: js/tinymce/classes/ui/BoxUtils.js\n\n/**\n * BoxUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility class for box parsing and measuring.\n *\n * @private\n * @class tinymce.ui.BoxUtils\n */\ndefine(\"tinymce/ui/BoxUtils\", [\n], function() {\n\t\"use strict\";\n\n\treturn {\n\t\t/**\n\t\t * Parses the specified box value. A box value contains 1-4 properties in clockwise order.\n\t\t *\n\t\t * @method parseBox\n\t\t * @param {String/Number} value Box value \"0 1 2 3\" or \"0\" etc.\n\t\t * @return {Object} Object with top/right/bottom/left properties.\n\t\t * @private\n\t\t */\n\t\tparseBox: function(value) {\n\t\t\tvar len, radix = 10;\n\n\t\t\tif (!value) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (typeof value === \"number\") {\n\t\t\t\tvalue = value || 0;\n\n\t\t\t\treturn {\n\t\t\t\t\ttop: value,\n\t\t\t\t\tleft: value,\n\t\t\t\t\tbottom: value,\n\t\t\t\t\tright: value\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tvalue = value.split(' ');\n\t\t\tlen = value.length;\n\n\t\t\tif (len === 1) {\n\t\t\t\tvalue[1] = value[2] = value[3] = value[0];\n\t\t\t} else if (len === 2) {\n\t\t\t\tvalue[2] = value[0];\n\t\t\t\tvalue[3] = value[1];\n\t\t\t} else if (len === 3) {\n\t\t\t\tvalue[3] = value[1];\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\ttop: parseInt(value[0], radix) || 0,\n\t\t\t\tright: parseInt(value[1], radix) || 0,\n\t\t\t\tbottom: parseInt(value[2], radix) || 0,\n\t\t\t\tleft: parseInt(value[3], radix) || 0\n\t\t\t};\n\t\t},\n\n\t\tmeasureBox: function(elm, prefix) {\n\t\t\tfunction getStyle(name) {\n\t\t\t\tvar defaultView = document.defaultView;\n\n\t\t\t\tif (defaultView) {\n\t\t\t\t\t// Remove camelcase\n\t\t\t\t\tname = name.replace(/[A-Z]/g, function(a) {\n\t\t\t\t\t\treturn '-' + a;\n\t\t\t\t\t});\n\n\t\t\t\t\treturn defaultView.getComputedStyle(elm, null).getPropertyValue(name);\n\t\t\t\t}\n\n\t\t\t\treturn elm.currentStyle[name];\n\t\t\t}\n\n\t\t\tfunction getSide(name) {\n\t\t\t\tvar val = parseFloat(getStyle(name), 10);\n\n\t\t\t\treturn isNaN(val) ? 0 : val;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\ttop: getSide(prefix + \"TopWidth\"),\n\t\t\t\tright: getSide(prefix + \"RightWidth\"),\n\t\t\t\tbottom: getSide(prefix + \"BottomWidth\"),\n\t\t\t\tleft: getSide(prefix + \"LeftWidth\")\n\t\t\t};\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/ClassList.js\n\n/**\n * ClassList.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Handles adding and removal of classes.\n *\n * @private\n * @class tinymce.ui.ClassList\n */\ndefine(\"tinymce/ui/ClassList\", [\n\t\"tinymce/util/Tools\"\n], function(Tools) {\n\t\"use strict\";\n\n\tfunction noop() {\n\t}\n\n\t/**\n\t * Constructs a new class list the specified onchange\n\t * callback will be executed when the class list gets modifed.\n\t *\n\t * @constructor ClassList\n\t * @param {function} onchange Onchange callback to be executed.\n\t */\n\tfunction ClassList(onchange) {\n\t\tthis.cls = [];\n\t\tthis.cls._map = {};\n\t\tthis.onchange = onchange || noop;\n\t\tthis.prefix = '';\n\t}\n\n\tTools.extend(ClassList.prototype, {\n\t\t/**\n\t\t * Adds a new class to the class list.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} cls Class to be added.\n\t\t * @return {tinymce.ui.ClassList} Current class list instance.\n\t\t */\n\t\tadd: function(cls) {\n\t\t\tif (cls && !this.contains(cls)) {\n\t\t\t\tthis.cls._map[cls] = true;\n\t\t\t\tthis.cls.push(cls);\n\t\t\t\tthis._change();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified class from the class list.\n\t\t *\n\t\t * @method remove\n\t\t * @param {String} cls Class to be removed.\n\t\t * @return {tinymce.ui.ClassList} Current class list instance.\n\t\t */\n\t\tremove: function(cls) {\n\t\t\tif (this.contains(cls)) {\n\t\t\t\tfor (var i = 0; i < this.cls.length; i++) {\n\t\t\t\t\tif (this.cls[i] === cls) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.cls.splice(i, 1);\n\t\t\t\tdelete this.cls._map[cls];\n\t\t\t\tthis._change();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Toggles a class in the class list.\n\t\t *\n\t\t * @method toggle\n\t\t * @param {String} cls Class to be added/removed.\n\t\t * @param {Boolean} state Optional state if it should be added/removed.\n\t\t * @return {tinymce.ui.ClassList} Current class list instance.\n\t\t */\n\t\ttoggle: function(cls, state) {\n\t\t\tvar curState = this.contains(cls);\n\n\t\t\tif (curState !== state) {\n\t\t\t\tif (curState) {\n\t\t\t\t\tthis.remove(cls);\n\t\t\t\t} else {\n\t\t\t\t\tthis.add(cls);\n\t\t\t\t}\n\n\t\t\t\tthis._change();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Returns true if the class list has the specified class.\n\t\t *\n\t\t * @method contains\n\t\t * @param {String} cls Class to look for.\n\t\t * @return {Boolean} true/false if the class exists or not.\n\t\t */\n\t\tcontains: function(cls) {\n\t\t\treturn !!this.cls._map[cls];\n\t\t},\n\n\t\t/**\n\t\t * Returns a space separated list of classes.\n\t\t *\n\t\t * @method toString\n\t\t * @return {String} Space separated list of classes.\n\t\t */\n\n\t\t_change: function() {\n\t\t\tdelete this.clsValue;\n\t\t\tthis.onchange.call(this);\n\t\t}\n\t});\n\n\t// IE 8 compatibility\n\tClassList.prototype.toString = function() {\n\t\tvar value;\n\n\t\tif (this.clsValue) {\n\t\t\treturn this.clsValue;\n\t\t}\n\n\t\tvalue = '';\n\t\tfor (var i = 0; i < this.cls.length; i++) {\n\t\t\tif (i > 0) {\n\t\t\t\tvalue += ' ';\n\t\t\t}\n\n\t\t\tvalue += this.prefix + this.cls[i];\n\t\t}\n\n\t\treturn value;\n\t};\n\n\treturn ClassList;\n});\n\n// Included from: js/tinymce/classes/ui/ReflowQueue.js\n\n/**\n * ReflowQueue.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class will automatically reflow controls on the next animation frame within a few milliseconds on older browsers.\n * If the user manually reflows then the automatic reflow will be cancelled. This class is used internally when various control states\n * changes that triggers a reflow.\n *\n * @class tinymce.ui.ReflowQueue\n * @static\n */\ndefine(\"tinymce/ui/ReflowQueue\", [\n\t\"tinymce/util/Delay\"\n], function(Delay) {\n\tvar dirtyCtrls = {}, animationFrameRequested;\n\n\treturn {\n\t\t/**\n\t\t * Adds a control to the next automatic reflow call. This is the control that had a state\n\t\t * change for example if the control was hidden/shown.\n\t\t *\n\t\t * @method add\n\t\t * @param {tinymce.ui.Control} ctrl Control to add to queue.\n\t\t */\n\t\tadd: function(ctrl) {\n\t\t\tvar parent = ctrl.parent();\n\n\t\t\tif (parent) {\n\t\t\t\tif (!parent._layout || parent._layout.isNative()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!dirtyCtrls[parent._id]) {\n\t\t\t\t\tdirtyCtrls[parent._id] = parent;\n\t\t\t\t}\n\n\t\t\t\tif (!animationFrameRequested) {\n\t\t\t\t\tanimationFrameRequested = true;\n\n\t\t\t\t\tDelay.requestAnimationFrame(function() {\n\t\t\t\t\t\tvar id, ctrl;\n\n\t\t\t\t\t\tanimationFrameRequested = false;\n\n\t\t\t\t\t\tfor (id in dirtyCtrls) {\n\t\t\t\t\t\t\tctrl = dirtyCtrls[id];\n\n\t\t\t\t\t\t\tif (ctrl.state.get('rendered')) {\n\t\t\t\t\t\t\t\tctrl.reflow();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdirtyCtrls = {};\n\t\t\t\t\t}, document.body);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified control from the automatic reflow. This will happen when for example the user\n\t\t * manually triggers a reflow.\n\t\t *\n\t\t * @method remove\n\t\t * @param {tinymce.ui.Control} ctrl Control to remove from queue.\n\t\t */\n\t\tremove: function(ctrl) {\n\t\t\tif (dirtyCtrls[ctrl._id]) {\n\t\t\t\tdelete dirtyCtrls[ctrl._id];\n\t\t\t}\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Control.js\n\n/**\n * Control.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*eslint consistent-this:0 */\n\n/**\n * This is the base class for all controls and containers. All UI control instances inherit\n * from this one as it has the base logic needed by all of them.\n *\n * @class tinymce.ui.Control\n */\ndefine(\"tinymce/ui/Control\", [\n\t\"tinymce/util/Class\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/EventDispatcher\",\n\t\"tinymce/data/ObservableObject\",\n\t\"tinymce/ui/Collection\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/BoxUtils\",\n\t\"tinymce/ui/ClassList\",\n\t\"tinymce/ui/ReflowQueue\"\n], function(Class, Tools, EventDispatcher, ObservableObject, Collection, DomUtils, $, BoxUtils, ClassList, ReflowQueue) {\n\t\"use strict\";\n\n\tvar hasMouseWheelEventSupport = \"onmousewheel\" in document;\n\tvar hasWheelEventSupport = false;\n\tvar classPrefix = \"mce-\";\n\tvar Control, idCounter = 0;\n\n\tvar proto = {\n\t\tStatics: {\n\t\t\tclassPrefix: classPrefix\n\t\t},\n\n\t\tisRtl: function() {\n\t\t\treturn Control.rtl;\n\t\t},\n\n\t\t/**\n\t\t * Class/id prefix to use for all controls.\n\t\t *\n\t\t * @final\n\t\t * @field {String} classPrefix\n\t\t */\n\t\tclassPrefix: classPrefix,\n\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} style Style CSS properties to add.\n\t\t * @setting {String} border Border box values example: 1 1 1 1\n\t\t * @setting {String} padding Padding box values example: 1 1 1 1\n\t\t * @setting {String} margin Margin box values example: 1 1 1 1\n\t\t * @setting {Number} minWidth Minimal width for the control.\n\t\t * @setting {Number} minHeight Minimal height for the control.\n\t\t * @setting {String} classes Space separated list of classes to add.\n\t\t * @setting {String} role WAI-ARIA role to use for control.\n\t\t * @setting {Boolean} hidden Is the control hidden by default.\n\t\t * @setting {Boolean} disabled Is the control disabled by default.\n\t\t * @setting {String} name Name of the control instance.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, classes, defaultClasses;\n\n\t\t\tfunction applyClasses(classes) {\n\t\t\t\tvar i;\n\n\t\t\t\tclasses = classes.split(' ');\n\t\t\t\tfor (i = 0; i < classes.length; i++) {\n\t\t\t\t\tself.classes.add(classes[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.settings = settings = Tools.extend({}, self.Defaults, settings);\n\n\t\t\t// Initial states\n\t\t\tself._id = settings.id || ('mceu_' + (idCounter++));\n\t\t\tself._aria = {role: settings.role};\n\t\t\tself._elmCache = {};\n\t\t\tself.$ = $;\n\n\t\t\tself.state = new ObservableObject({\n\t\t\t\tvisible: true,\n\t\t\t\tactive: false,\n\t\t\t\tdisabled: false,\n\t\t\t\tvalue: ''\n\t\t\t});\n\n\t\t\tself.data = new ObservableObject(settings.data);\n\n\t\t\tself.classes = new ClassList(function() {\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.getEl().className = this.toString();\n\t\t\t\t}\n\t\t\t});\n\t\t\tself.classes.prefix = self.classPrefix;\n\n\t\t\t// Setup classes\n\t\t\tclasses = settings.classes;\n\t\t\tif (classes) {\n\t\t\t\tif (self.Defaults) {\n\t\t\t\t\tdefaultClasses = self.Defaults.classes;\n\n\t\t\t\t\tif (defaultClasses && classes != defaultClasses) {\n\t\t\t\t\t\tapplyClasses(defaultClasses);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tapplyClasses(classes);\n\t\t\t}\n\n\t\t\tTools.each('title text name visible disabled active value'.split(' '), function(name) {\n\t\t\t\tif (name in settings) {\n\t\t\t\t\tself[name](settings[name]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('click', function() {\n\t\t\t\tif (self.disabled()) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * Name/value object with settings for the current control.\n\t\t\t *\n\t\t\t * @field {Object} settings\n\t\t\t */\n\t\t\tself.settings = settings;\n\n\t\t\tself.borderBox = BoxUtils.parseBox(settings.border);\n\t\t\tself.paddingBox = BoxUtils.parseBox(settings.padding);\n\t\t\tself.marginBox = BoxUtils.parseBox(settings.margin);\n\n\t\t\tif (settings.hidden) {\n\t\t\t\tself.hide();\n\t\t\t}\n\t\t},\n\n\t\t// Will generate getter/setter methods for these properties\n\t\tProperties: 'parent,name',\n\n\t\t/**\n\t\t * Returns the root element to render controls into.\n\t\t *\n\t\t * @method getContainerElm\n\t\t * @return {Element} HTML DOM element to render into.\n\t\t */\n\t\tgetContainerElm: function() {\n\t\t\treturn DomUtils.getContainer();\n\t\t},\n\n\t\t/**\n\t\t * Returns a control instance for the current DOM element.\n\t\t *\n\t\t * @method getParentCtrl\n\t\t * @param {Element} elm HTML dom element to get parent control from.\n\t\t * @return {tinymce.ui.Control} Control instance or undefined.\n\t\t */\n\t\tgetParentCtrl: function(elm) {\n\t\t\tvar ctrl, lookup = this.getRoot().controlIdLookup;\n\n\t\t\twhile (elm && lookup) {\n\t\t\t\tctrl = lookup[elm.id];\n\t\t\t\tif (ctrl) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\telm = elm.parentNode;\n\t\t\t}\n\n\t\t\treturn ctrl;\n\t\t},\n\n\t\t/**\n\t\t * Initializes the current controls layout rect.\n\t\t * This will be executed by the layout managers to determine the\n\t\t * default minWidth/minHeight etc.\n\t\t *\n\t\t * @method initLayoutRect\n\t\t * @return {Object} Layout rect instance.\n\t\t */\n\t\tinitLayoutRect: function() {\n\t\t\tvar self = this, settings = self.settings, borderBox, layoutRect;\n\t\t\tvar elm = self.getEl(), width, height, minWidth, minHeight, autoResize;\n\t\t\tvar startMinWidth, startMinHeight, initialSize;\n\n\t\t\t// Measure the current element\n\t\t\tborderBox = self.borderBox = self.borderBox || BoxUtils.measureBox(elm, 'border');\n\t\t\tself.paddingBox = self.paddingBox || BoxUtils.measureBox(elm, 'padding');\n\t\t\tself.marginBox = self.marginBox || BoxUtils.measureBox(elm, 'margin');\n\t\t\tinitialSize = DomUtils.getSize(elm);\n\n\t\t\t// Setup minWidth/minHeight and width/height\n\t\t\tstartMinWidth = settings.minWidth;\n\t\t\tstartMinHeight = settings.minHeight;\n\t\t\tminWidth = startMinWidth || initialSize.width;\n\t\t\tminHeight = startMinHeight || initialSize.height;\n\t\t\twidth = settings.width;\n\t\t\theight = settings.height;\n\t\t\tautoResize = settings.autoResize;\n\t\t\tautoResize = typeof autoResize != \"undefined\" ? autoResize : !width && !height;\n\n\t\t\twidth = width || minWidth;\n\t\t\theight = height || minHeight;\n\n\t\t\tvar deltaW = borderBox.left + borderBox.right;\n\t\t\tvar deltaH = borderBox.top + borderBox.bottom;\n\n\t\t\tvar maxW = settings.maxWidth || 0xFFFF;\n\t\t\tvar maxH = settings.maxHeight || 0xFFFF;\n\n\t\t\t// Setup initial layout rect\n\t\t\tself._layoutRect = layoutRect = {\n\t\t\t\tx: settings.x || 0,\n\t\t\t\ty: settings.y || 0,\n\t\t\t\tw: width,\n\t\t\t\th: height,\n\t\t\t\tdeltaW: deltaW,\n\t\t\t\tdeltaH: deltaH,\n\t\t\t\tcontentW: width - deltaW,\n\t\t\t\tcontentH: height - deltaH,\n\t\t\t\tinnerW: width - deltaW,\n\t\t\t\tinnerH: height - deltaH,\n\t\t\t\tstartMinWidth: startMinWidth || 0,\n\t\t\t\tstartMinHeight: startMinHeight || 0,\n\t\t\t\tminW: Math.min(minWidth, maxW),\n\t\t\t\tminH: Math.min(minHeight, maxH),\n\t\t\t\tmaxW: maxW,\n\t\t\t\tmaxH: maxH,\n\t\t\t\tautoResize: autoResize,\n\t\t\t\tscrollW: 0\n\t\t\t};\n\n\t\t\tself._lastLayoutRect = {};\n\n\t\t\treturn layoutRect;\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter for the current layout rect.\n\t\t *\n\t\t * @method layoutRect\n\t\t * @param {Object} [newRect] Optional new layout rect.\n\t\t * @return {tinymce.ui.Control/Object} Current control or rect object.\n\t\t */\n\t\tlayoutRect: function(newRect) {\n\t\t\tvar self = this, curRect = self._layoutRect, lastLayoutRect, size, deltaWidth, deltaHeight, undef, repaintControls;\n\n\t\t\t// Initialize default layout rect\n\t\t\tif (!curRect) {\n\t\t\t\tcurRect = self.initLayoutRect();\n\t\t\t}\n\n\t\t\t// Set new rect values\n\t\t\tif (newRect) {\n\t\t\t\t// Calc deltas between inner and outer sizes\n\t\t\t\tdeltaWidth = curRect.deltaW;\n\t\t\t\tdeltaHeight = curRect.deltaH;\n\n\t\t\t\t// Set x position\n\t\t\t\tif (newRect.x !== undef) {\n\t\t\t\t\tcurRect.x = newRect.x;\n\t\t\t\t}\n\n\t\t\t\t// Set y position\n\t\t\t\tif (newRect.y !== undef) {\n\t\t\t\t\tcurRect.y = newRect.y;\n\t\t\t\t}\n\n\t\t\t\t// Set minW\n\t\t\t\tif (newRect.minW !== undef) {\n\t\t\t\t\tcurRect.minW = newRect.minW;\n\t\t\t\t}\n\n\t\t\t\t// Set minH\n\t\t\t\tif (newRect.minH !== undef) {\n\t\t\t\t\tcurRect.minH = newRect.minH;\n\t\t\t\t}\n\n\t\t\t\t// Set new width and calculate inner width\n\t\t\t\tsize = newRect.w;\n\t\t\t\tif (size !== undef) {\n\t\t\t\t\tsize = size < curRect.minW ? curRect.minW : size;\n\t\t\t\t\tsize = size > curRect.maxW ? curRect.maxW : size;\n\t\t\t\t\tcurRect.w = size;\n\t\t\t\t\tcurRect.innerW = size - deltaWidth;\n\t\t\t\t}\n\n\t\t\t\t// Set new height and calculate inner height\n\t\t\t\tsize = newRect.h;\n\t\t\t\tif (size !== undef) {\n\t\t\t\t\tsize = size < curRect.minH ? curRect.minH : size;\n\t\t\t\t\tsize = size > curRect.maxH ? curRect.maxH : size;\n\t\t\t\t\tcurRect.h = size;\n\t\t\t\t\tcurRect.innerH = size - deltaHeight;\n\t\t\t\t}\n\n\t\t\t\t// Set new inner width and calculate width\n\t\t\t\tsize = newRect.innerW;\n\t\t\t\tif (size !== undef) {\n\t\t\t\t\tsize = size < curRect.minW - deltaWidth ? curRect.minW - deltaWidth : size;\n\t\t\t\t\tsize = size > curRect.maxW - deltaWidth ? curRect.maxW - deltaWidth : size;\n\t\t\t\t\tcurRect.innerW = size;\n\t\t\t\t\tcurRect.w = size + deltaWidth;\n\t\t\t\t}\n\n\t\t\t\t// Set new height and calculate inner height\n\t\t\t\tsize = newRect.innerH;\n\t\t\t\tif (size !== undef) {\n\t\t\t\t\tsize = size < curRect.minH - deltaHeight ? curRect.minH - deltaHeight : size;\n\t\t\t\t\tsize = size > curRect.maxH - deltaHeight ? curRect.maxH - deltaHeight : size;\n\t\t\t\t\tcurRect.innerH = size;\n\t\t\t\t\tcurRect.h = size + deltaHeight;\n\t\t\t\t}\n\n\t\t\t\t// Set new contentW\n\t\t\t\tif (newRect.contentW !== undef) {\n\t\t\t\t\tcurRect.contentW = newRect.contentW;\n\t\t\t\t}\n\n\t\t\t\t// Set new contentH\n\t\t\t\tif (newRect.contentH !== undef) {\n\t\t\t\t\tcurRect.contentH = newRect.contentH;\n\t\t\t\t}\n\n\t\t\t\t// Compare last layout rect with the current one to see if we need to repaint or not\n\t\t\t\tlastLayoutRect = self._lastLayoutRect;\n\t\t\t\tif (lastLayoutRect.x !== curRect.x || lastLayoutRect.y !== curRect.y ||\n\t\t\t\t\tlastLayoutRect.w !== curRect.w || lastLayoutRect.h !== curRect.h) {\n\t\t\t\t\trepaintControls = Control.repaintControls;\n\n\t\t\t\t\tif (repaintControls) {\n\t\t\t\t\t\tif (repaintControls.map && !repaintControls.map[self._id]) {\n\t\t\t\t\t\t\trepaintControls.push(self);\n\t\t\t\t\t\t\trepaintControls.map[self._id] = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlastLayoutRect.x = curRect.x;\n\t\t\t\t\tlastLayoutRect.y = curRect.y;\n\t\t\t\t\tlastLayoutRect.w = curRect.w;\n\t\t\t\t\tlastLayoutRect.h = curRect.h;\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t}\n\n\t\t\treturn curRect;\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, style, bodyStyle, bodyElm, rect, borderBox;\n\t\t\tvar borderW, borderH, lastRepaintRect, round, value;\n\n\t\t\t// Use Math.round on all values on IE < 9\n\t\t\tround = !document.createRange ? Math.round : function(value) {\n\t\t\t\treturn value;\n\t\t\t};\n\n\t\t\tstyle = self.getEl().style;\n\t\t\trect = self._layoutRect;\n\t\t\tlastRepaintRect = self._lastRepaintRect || {};\n\n\t\t\tborderBox = self.borderBox;\n\t\t\tborderW = borderBox.left + borderBox.right;\n\t\t\tborderH = borderBox.top + borderBox.bottom;\n\n\t\t\tif (rect.x !== lastRepaintRect.x) {\n\t\t\t\tstyle.left = round(rect.x) + 'px';\n\t\t\t\tlastRepaintRect.x = rect.x;\n\t\t\t}\n\n\t\t\tif (rect.y !== lastRepaintRect.y) {\n\t\t\t\tstyle.top = round(rect.y) + 'px';\n\t\t\t\tlastRepaintRect.y = rect.y;\n\t\t\t}\n\n\t\t\tif (rect.w !== lastRepaintRect.w) {\n\t\t\t\tvalue = round(rect.w - borderW);\n\t\t\t\tstyle.width = (value >= 0 ? value : 0) + 'px';\n\t\t\t\tlastRepaintRect.w = rect.w;\n\t\t\t}\n\n\t\t\tif (rect.h !== lastRepaintRect.h) {\n\t\t\t\tvalue = round(rect.h - borderH);\n\t\t\t\tstyle.height = (value >= 0 ? value : 0) + 'px';\n\t\t\t\tlastRepaintRect.h = rect.h;\n\t\t\t}\n\n\t\t\t// Update body if needed\n\t\t\tif (self._hasBody && rect.innerW !== lastRepaintRect.innerW) {\n\t\t\t\tvalue = round(rect.innerW);\n\n\t\t\t\tbodyElm = self.getEl('body');\n\t\t\t\tif (bodyElm) {\n\t\t\t\t\tbodyStyle = bodyElm.style;\n\t\t\t\t\tbodyStyle.width = (value >= 0 ? value : 0) + 'px';\n\t\t\t\t}\n\n\t\t\t\tlastRepaintRect.innerW = rect.innerW;\n\t\t\t}\n\n\t\t\tif (self._hasBody && rect.innerH !== lastRepaintRect.innerH) {\n\t\t\t\tvalue = round(rect.innerH);\n\n\t\t\t\tbodyElm = bodyElm || self.getEl('body');\n\t\t\t\tif (bodyElm) {\n\t\t\t\t\tbodyStyle = bodyStyle || bodyElm.style;\n\t\t\t\t\tbodyStyle.height = (value >= 0 ? value : 0) + 'px';\n\t\t\t\t}\n\n\t\t\t\tlastRepaintRect.innerH = rect.innerH;\n\t\t\t}\n\n\t\t\tself._lastRepaintRect = lastRepaintRect;\n\t\t\tself.fire('repaint', {}, false);\n\t\t},\n\n\t\t/**\n\t\t * Updates the controls layout rect by re-measuing it.\n\t\t */\n\t\tupdateLayoutRect: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.parent()._lastRect = null;\n\n\t\t\tDomUtils.css(self.getEl(), {width: '', height: ''});\n\n\t\t\tself._layoutRect = self._lastRepaintRect = self._lastLayoutRect = null;\n\t\t\tself.initLayoutRect();\n\t\t},\n\n\t\t/**\n\t\t * Binds a callback to the specified event. This event can both be\n\t\t * native browser events like \"click\" or custom ones like PostRender.\n\t\t *\n\t\t * The callback function will be passed a DOM event like object that enables yout do stop propagation.\n\t\t *\n\t\t * @method on\n\t\t * @param {String} name Name of the event to bind. For example \"click\".\n\t\t * @param {String/function} callback Callback function to execute ones the event occurs.\n\t\t * @return {tinymce.ui.Control} Current control object.\n\t\t */\n\t\ton: function(name, callback) {\n\t\t\tvar self = this;\n\n\t\t\tfunction resolveCallbackName(name) {\n\t\t\t\tvar callback, scope;\n\n\t\t\t\tif (typeof name != 'string') {\n\t\t\t\t\treturn name;\n\t\t\t\t}\n\n\t\t\t\treturn function(e) {\n\t\t\t\t\tif (!callback) {\n\t\t\t\t\t\tself.parentsAndSelf().each(function(ctrl) {\n\t\t\t\t\t\t\tvar callbacks = ctrl.settings.callbacks;\n\n\t\t\t\t\t\t\tif (callbacks && (callback = callbacks[name])) {\n\t\t\t\t\t\t\t\tscope = ctrl;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!callback) {\n\t\t\t\t\t\te.action = name;\n\t\t\t\t\t\tthis.fire('execute', e);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn callback.call(scope, e);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tgetEventDispatcher(self).on(name, resolveCallbackName(callback));\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Unbinds the specified event and optionally a specific callback. If you omit the name\n\t\t * parameter all event handlers will be removed. If you omit the callback all event handles\n\t\t * by the specified name will be removed.\n\t\t *\n\t\t * @method off\n\t\t * @param {String} [name] Name for the event to unbind.\n\t\t * @param {function} [callback] Callback function to unbind.\n\t\t * @return {tinymce.ui.Control} Current control object.\n\t\t */\n\t\toff: function(name, callback) {\n\t\t\tgetEventDispatcher(this).off(name, callback);\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Fires the specified event by name and arguments on the control. This will execute all\n\t\t * bound event handlers.\n\t\t *\n\t\t * @method fire\n\t\t * @param {String} name Name of the event to fire.\n\t\t * @param {Object} [args] Arguments to pass to the event.\n\t\t * @param {Boolean} [bubble] Value to control bubbling. Defaults to true.\n\t\t * @return {Object} Current arguments object.\n\t\t */\n\t\tfire: function(name, args, bubble) {\n\t\t\tvar self = this;\n\n\t\t\targs = args || {};\n\n\t\t\tif (!args.control) {\n\t\t\t\targs.control = self;\n\t\t\t}\n\n\t\t\targs = getEventDispatcher(self).fire(name, args);\n\n\t\t\t// Bubble event up to parents\n\t\t\tif (bubble !== false && self.parent) {\n\t\t\t\tvar parent = self.parent();\n\t\t\t\twhile (parent && !args.isPropagationStopped()) {\n\t\t\t\t\tparent.fire(name, args, false);\n\t\t\t\t\tparent = parent.parent();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn args;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the specified event has any listeners.\n\t\t *\n\t\t * @method hasEventListeners\n\t\t * @param {String} name Name of the event to check for.\n\t\t * @return {Boolean} True/false state if the event has listeners.\n\t\t */\n\t\thasEventListeners: function(name) {\n\t\t\treturn getEventDispatcher(this).has(name);\n\t\t},\n\n\t\t/**\n\t\t * Returns a control collection with all parent controls.\n\t\t *\n\t\t * @method parents\n\t\t * @param {String} selector Optional selector expression to find parents.\n\t\t * @return {tinymce.ui.Collection} Collection with all parent controls.\n\t\t */\n\t\tparents: function(selector) {\n\t\t\tvar self = this, ctrl, parents = new Collection();\n\n\t\t\t// Add each parent to collection\n\t\t\tfor (ctrl = self.parent(); ctrl; ctrl = ctrl.parent()) {\n\t\t\t\tparents.add(ctrl);\n\t\t\t}\n\n\t\t\t// Filter away everything that doesn't match the selector\n\t\t\tif (selector) {\n\t\t\t\tparents = parents.filter(selector);\n\t\t\t}\n\n\t\t\treturn parents;\n\t\t},\n\n\t\t/**\n\t\t * Returns the current control and it's parents.\n\t\t *\n\t\t * @method parentsAndSelf\n\t\t * @param {String} selector Optional selector expression to find parents.\n\t\t * @return {tinymce.ui.Collection} Collection with all parent controls.\n\t\t */\n\t\tparentsAndSelf: function(selector) {\n\t\t\treturn new Collection(this).add(this.parents(selector));\n\t\t},\n\n\t\t/**\n\t\t * Returns the control next to the current control.\n\t\t *\n\t\t * @method next\n\t\t * @return {tinymce.ui.Control} Next control instance.\n\t\t */\n\t\tnext: function() {\n\t\t\tvar parentControls = this.parent().items();\n\n\t\t\treturn parentControls[parentControls.indexOf(this) + 1];\n\t\t},\n\n\t\t/**\n\t\t * Returns the control previous to the current control.\n\t\t *\n\t\t * @method prev\n\t\t * @return {tinymce.ui.Control} Previous control instance.\n\t\t */\n\t\tprev: function() {\n\t\t\tvar parentControls = this.parent().items();\n\n\t\t\treturn parentControls[parentControls.indexOf(this) - 1];\n\t\t},\n\n\t\t/**\n\t\t * Sets the inner HTML of the control element.\n\t\t *\n\t\t * @method innerHtml\n\t\t * @param {String} html Html string to set as inner html.\n\t\t * @return {tinymce.ui.Control} Current control object.\n\t\t */\n\t\tinnerHtml: function(html) {\n\t\t\tthis.$el.html(html);\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Returns the control DOM element or sub element.\n\t\t *\n\t\t * @method getEl\n\t\t * @param {String} [suffix] Suffix to get element by.\n\t\t * @return {Element} HTML DOM element for the current control or it's children.\n\t\t */\n\t\tgetEl: function(suffix) {\n\t\t\tvar id = suffix ? this._id + '-' + suffix : this._id;\n\n\t\t\tif (!this._elmCache[id]) {\n\t\t\t\tthis._elmCache[id] = $('#' + id)[0];\n\t\t\t}\n\n\t\t\treturn this._elmCache[id];\n\t\t},\n\n\t\t/**\n\t\t * Sets the visible state to true.\n\t\t *\n\t\t * @method show\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tshow: function() {\n\t\t\treturn this.visible(true);\n\t\t},\n\n\t\t/**\n\t\t * Sets the visible state to false.\n\t\t *\n\t\t * @method hide\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\thide: function() {\n\t\t\treturn this.visible(false);\n\t\t},\n\n\t\t/**\n\t\t * Focuses the current control.\n\t\t *\n\t\t * @method focus\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tfocus: function() {\n\t\t\ttry {\n\t\t\t\tthis.getEl().focus();\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore IE error\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Blurs the current control.\n\t\t *\n\t\t * @method blur\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tblur: function() {\n\t\t\tthis.getEl().blur();\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Sets the specified aria property.\n\t\t *\n\t\t * @method aria\n\t\t * @param {String} name Name of the aria property to set.\n\t\t * @param {String} value Value of the aria property.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\taria: function(name, value) {\n\t\t\tvar self = this, elm = self.getEl(self.ariaTarget);\n\n\t\t\tif (typeof value === \"undefined\") {\n\t\t\t\treturn self._aria[name];\n\t\t\t}\n\n\t\t\tself._aria[name] = value;\n\n\t\t\tif (self.state.get('rendered')) {\n\t\t\t\telm.setAttribute(name == 'role' ? name : 'aria-' + name, value);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Encodes the specified string with HTML entities. It will also\n\t\t * translate the string to different languages.\n\t\t *\n\t\t * @method encode\n\t\t * @param {String/Object/Array} text Text to entity encode.\n\t\t * @param {Boolean} [translate=true] False if the contents shouldn't be translated.\n\t\t * @return {String} Encoded and possible traslated string.\n\t\t */\n\t\tencode: function(text, translate) {\n\t\t\tif (translate !== false) {\n\t\t\t\ttext = this.translate(text);\n\t\t\t}\n\n\t\t\treturn (text || '').replace(/[&<>\"]/g, function(match) {\n\t\t\t\treturn '&#' + match.charCodeAt(0) + ';';\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns the translated string.\n\t\t *\n\t\t * @method translate\n\t\t * @param {String} text Text to translate.\n\t\t * @return {String} Translated string or the same as the input.\n\t\t */\n\t\ttranslate: function(text) {\n\t\t\treturn Control.translate ? Control.translate(text) : text;\n\t\t},\n\n\t\t/**\n\t\t * Adds items before the current control.\n\t\t *\n\t\t * @method before\n\t\t * @param {Array/tinymce.ui.Collection} items Array of items to prepend before this control.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tbefore: function(items) {\n\t\t\tvar self = this, parent = self.parent();\n\n\t\t\tif (parent) {\n\t\t\t\tparent.insert(items, parent.items().indexOf(self), true);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Adds items after the current control.\n\t\t *\n\t\t * @method after\n\t\t * @param {Array/tinymce.ui.Collection} items Array of items to append after this control.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tafter: function(items) {\n\t\t\tvar self = this, parent = self.parent();\n\n\t\t\tif (parent) {\n\t\t\t\tparent.insert(items, parent.items().indexOf(self));\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Removes the current control from DOM and from UI collections.\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tremove: function() {\n\t\t\tvar self = this, elm = self.getEl(), parent = self.parent(), newItems, i;\n\n\t\t\tif (self.items) {\n\t\t\t\tvar controls = self.items().toArray();\n\t\t\t\ti = controls.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tcontrols[i].remove();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (parent && parent.items) {\n\t\t\t\tnewItems = [];\n\n\t\t\t\tparent.items().each(function(item) {\n\t\t\t\t\tif (item !== self) {\n\t\t\t\t\t\tnewItems.push(item);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tparent.items().set(newItems);\n\t\t\t\tparent._lastRect = null;\n\t\t\t}\n\n\t\t\tif (self._eventsRoot && self._eventsRoot == self) {\n\t\t\t\t$(elm).off();\n\t\t\t}\n\n\t\t\tvar lookup = self.getRoot().controlIdLookup;\n\t\t\tif (lookup) {\n\t\t\t\tdelete lookup[self._id];\n\t\t\t}\n\n\t\t\tif (elm && elm.parentNode) {\n\t\t\t\telm.parentNode.removeChild(elm);\n\t\t\t}\n\n\t\t\tself.state.set('rendered', false);\n\t\t\tself.state.destroy();\n\n\t\t\tself.fire('remove');\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control before the specified element.\n\t\t *\n\t\t * @method renderBefore\n\t\t * @param {Element} elm Element to render before.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\trenderBefore: function(elm) {\n\t\t\t$(elm).before(this.renderHtml());\n\t\t\tthis.postRender();\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control to the specified element.\n\t\t *\n\t\t * @method renderBefore\n\t\t * @param {Element} elm Element to render to.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\trenderTo: function(elm) {\n\t\t\t$(elm || this.getContainerElm()).append(this.renderHtml());\n\t\t\tthis.postRender();\n\t\t\treturn this;\n\t\t},\n\n\t\tpreRender: function() {\n\t\t},\n\n\t\trender: function() {\n\t\t},\n\n\t\trenderHtml: function() {\n\t\t\treturn '<div id=\"' + this._id + '\" class=\"' + this.classes + '\"></div>';\n\t\t},\n\n\t\t/**\n\t\t * Post render method. Called after the control has been rendered to the target.\n\t\t *\n\t\t * @method postRender\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, settings = self.settings, elm, box, parent, name, parentEventsRoot;\n\n\t\t\tself.$el = $(self.getEl());\n\t\t\tself.state.set('rendered', true);\n\n\t\t\t// Bind on<event> settings\n\t\t\tfor (name in settings) {\n\t\t\t\tif (name.indexOf(\"on\") === 0) {\n\t\t\t\t\tself.on(name.substr(2), settings[name]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (self._eventsRoot) {\n\t\t\t\tfor (parent = self.parent(); !parentEventsRoot && parent; parent = parent.parent()) {\n\t\t\t\t\tparentEventsRoot = parent._eventsRoot;\n\t\t\t\t}\n\n\t\t\t\tif (parentEventsRoot) {\n\t\t\t\t\tfor (name in parentEventsRoot._nativeEvents) {\n\t\t\t\t\t\tself._nativeEvents[name] = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbindPendingEvents(self);\n\n\t\t\tif (settings.style) {\n\t\t\t\telm = self.getEl();\n\t\t\t\tif (elm) {\n\t\t\t\t\telm.setAttribute('style', settings.style);\n\t\t\t\t\telm.style.cssText = settings.style;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (self.settings.border) {\n\t\t\t\tbox = self.borderBox;\n\t\t\t\tself.$el.css({\n\t\t\t\t\t'border-top-width': box.top,\n\t\t\t\t\t'border-right-width': box.right,\n\t\t\t\t\t'border-bottom-width': box.bottom,\n\t\t\t\t\t'border-left-width': box.left\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Add instance to lookup\n\t\t\tvar root = self.getRoot();\n\t\t\tif (!root.controlIdLookup) {\n\t\t\t\troot.controlIdLookup = {};\n\t\t\t}\n\n\t\t\troot.controlIdLookup[self._id] = self;\n\n\t\t\tfor (var key in self._aria) {\n\t\t\t\tself.aria(key, self._aria[key]);\n\t\t\t}\n\n\t\t\tif (self.state.get('visible') === false) {\n\t\t\t\tself.getEl().style.display = 'none';\n\t\t\t}\n\n\t\t\tself.bindStates();\n\n\t\t\tself.state.on('change:visible', function(e) {\n\t\t\t\tvar state = e.value, parentCtrl;\n\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.getEl().style.display = state === false ? 'none' : '';\n\n\t\t\t\t\t// Need to force a reflow here on IE 8\n\t\t\t\t\tself.getEl().getBoundingClientRect();\n\t\t\t\t}\n\n\t\t\t\t// Parent container needs to reflow\n\t\t\t\tparentCtrl = self.parent();\n\t\t\t\tif (parentCtrl) {\n\t\t\t\t\tparentCtrl._lastRect = null;\n\t\t\t\t}\n\n\t\t\t\tself.fire(state ? 'show' : 'hide');\n\n\t\t\t\tReflowQueue.add(self);\n\t\t\t});\n\n\t\t\tself.fire('postrender', {}, false);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t},\n\n\t\t/**\n\t\t * Scrolls the current control into view.\n\t\t *\n\t\t * @method scrollIntoView\n\t\t * @param {String} align Alignment in view top|center|bottom.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tscrollIntoView: function(align) {\n\t\t\tfunction getOffset(elm, rootElm) {\n\t\t\t\tvar x, y, parent = elm;\n\n\t\t\t\tx = y = 0;\n\t\t\t\twhile (parent && parent != rootElm && parent.nodeType) {\n\t\t\t\t\tx += parent.offsetLeft || 0;\n\t\t\t\t\ty += parent.offsetTop || 0;\n\t\t\t\t\tparent = parent.offsetParent;\n\t\t\t\t}\n\n\t\t\t\treturn {x: x, y: y};\n\t\t\t}\n\n\t\t\tvar elm = this.getEl(), parentElm = elm.parentNode;\n\t\t\tvar x, y, width, height, parentWidth, parentHeight;\n\t\t\tvar pos = getOffset(elm, parentElm);\n\n\t\t\tx = pos.x;\n\t\t\ty = pos.y;\n\t\t\twidth = elm.offsetWidth;\n\t\t\theight = elm.offsetHeight;\n\t\t\tparentWidth = parentElm.clientWidth;\n\t\t\tparentHeight = parentElm.clientHeight;\n\n\t\t\tif (align == \"end\") {\n\t\t\t\tx -= parentWidth - width;\n\t\t\t\ty -= parentHeight - height;\n\t\t\t} else if (align == \"center\") {\n\t\t\t\tx -= (parentWidth / 2) - (width / 2);\n\t\t\t\ty -= (parentHeight / 2) - (height / 2);\n\t\t\t}\n\n\t\t\tparentElm.scrollLeft = x;\n\t\t\tparentElm.scrollTop = y;\n\n\t\t\treturn this;\n\t\t},\n\n\t\tgetRoot: function() {\n\t\t\tvar ctrl = this, rootControl, parents = [];\n\n\t\t\twhile (ctrl) {\n\t\t\t\tif (ctrl.rootControl) {\n\t\t\t\t\trootControl = ctrl.rootControl;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tparents.push(ctrl);\n\t\t\t\trootControl = ctrl;\n\t\t\t\tctrl = ctrl.parent();\n\t\t\t}\n\n\t\t\tif (!rootControl) {\n\t\t\t\trootControl = this;\n\t\t\t}\n\n\t\t\tvar i = parents.length;\n\t\t\twhile (i--) {\n\t\t\t\tparents[i].rootControl = rootControl;\n\t\t\t}\n\n\t\t\treturn rootControl;\n\t\t},\n\n\t\t/**\n\t\t * Reflows the current control and it's parents.\n\t\t * This should be used after you for example append children to the current control so\n\t\t * that the layout managers know that they need to reposition everything.\n\t\t *\n\t\t * @example\n\t\t * container.append({type: 'button', text: 'My button'}).reflow();\n\t\t *\n\t\t * @method reflow\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\treflow: function() {\n\t\t\tReflowQueue.remove(this);\n\n\t\t\tvar parent = this.parent();\n\t\t\tif (parent._layout && !parent._layout.isNative()) {\n\t\t\t\tparent.reflow();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Sets/gets the parent container for the control.\n\t\t *\n\t\t * @method parent\n\t\t * @param {tinymce.ui.Container} parent Optional parent to set.\n\t\t * @return {tinymce.ui.Control} Parent control or the current control on a set action.\n\t\t */\n\t\t// parent: function(parent) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the text for the control.\n\t\t *\n\t\t * @method text\n\t\t * @param {String} value Value to set to control.\n\t\t * @return {String/tinymce.ui.Control} Current control on a set operation or current value on a get.\n\t\t */\n\t\t// text: function(value) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the disabled state on the control.\n\t\t *\n\t\t * @method disabled\n\t\t * @param {Boolean} state Value to set to control.\n\t\t * @return {Boolean/tinymce.ui.Control} Current control on a set operation or current state on a get.\n\t\t */\n\t\t// disabled: function(state) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the active for the control.\n\t\t *\n\t\t * @method active\n\t\t * @param {Boolean} state Value to set to control.\n\t\t * @return {Boolean/tinymce.ui.Control} Current control on a set operation or current state on a get.\n\t\t */\n\t\t// active: function(state) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the name for the control.\n\t\t *\n\t\t * @method name\n\t\t * @param {String} value Value to set to control.\n\t\t * @return {String/tinymce.ui.Control} Current control on a set operation or current value on a get.\n\t\t */\n\t\t// name: function(value) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the title for the control.\n\t\t *\n\t\t * @method title\n\t\t * @param {String} value Value to set to control.\n\t\t * @return {String/tinymce.ui.Control} Current control on a set operation or current value on a get.\n\t\t */\n\t\t// title: function(value) {} -- Generated\n\n\t\t/**\n\t\t * Sets/gets the visible for the control.\n\t\t *\n\t\t * @method visible\n\t\t * @param {Boolean} state Value to set to control.\n\t\t * @return {Boolean/tinymce.ui.Control} Current control on a set operation or current state on a get.\n\t\t */\n\t\t// visible: function(value) {} -- Generated\n\t};\n\n\t/**\n\t * Setup state properties.\n\t */\n\tTools.each('text title visible disabled active value'.split(' '), function(name) {\n\t\tproto[name] = function(value) {\n\t\t\tif (arguments.length === 0) {\n\t\t\t\treturn this.state.get(name);\n\t\t\t}\n\n\t\t\tif (typeof value != \"undefined\") {\n\t\t\t\tthis.state.set(name, value);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t};\n\t});\n\n\tControl = Class.extend(proto);\n\n\tfunction getEventDispatcher(obj) {\n\t\tif (!obj._eventDispatcher) {\n\t\t\tobj._eventDispatcher = new EventDispatcher({\n\t\t\t\tscope: obj,\n\t\t\t\ttoggleEvent: function(name, state) {\n\t\t\t\t\tif (state && EventDispatcher.isNative(name)) {\n\t\t\t\t\t\tif (!obj._nativeEvents) {\n\t\t\t\t\t\t\tobj._nativeEvents = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tobj._nativeEvents[name] = true;\n\n\t\t\t\t\t\tif (obj.state.get('rendered')) {\n\t\t\t\t\t\t\tbindPendingEvents(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn obj._eventDispatcher;\n\t}\n\n\tfunction bindPendingEvents(eventCtrl) {\n\t\tvar i, l, parents, eventRootCtrl, nativeEvents, name;\n\n\t\tfunction delegate(e) {\n\t\t\tvar control = eventCtrl.getParentCtrl(e.target);\n\n\t\t\tif (control) {\n\t\t\t\tcontrol.fire(e.type, e);\n\t\t\t}\n\t\t}\n\n\t\tfunction mouseLeaveHandler() {\n\t\t\tvar ctrl = eventRootCtrl._lastHoverCtrl;\n\n\t\t\tif (ctrl) {\n\t\t\t\tctrl.fire(\"mouseleave\", {target: ctrl.getEl()});\n\n\t\t\t\tctrl.parents().each(function(ctrl) {\n\t\t\t\t\tctrl.fire(\"mouseleave\", {target: ctrl.getEl()});\n\t\t\t\t});\n\n\t\t\t\teventRootCtrl._lastHoverCtrl = null;\n\t\t\t}\n\t\t}\n\n\t\tfunction mouseEnterHandler(e) {\n\t\t\tvar ctrl = eventCtrl.getParentCtrl(e.target), lastCtrl = eventRootCtrl._lastHoverCtrl, idx = 0, i, parents, lastParents;\n\n\t\t\t// Over on a new control\n\t\t\tif (ctrl !== lastCtrl) {\n\t\t\t\teventRootCtrl._lastHoverCtrl = ctrl;\n\n\t\t\t\tparents = ctrl.parents().toArray().reverse();\n\t\t\t\tparents.push(ctrl);\n\n\t\t\t\tif (lastCtrl) {\n\t\t\t\t\tlastParents = lastCtrl.parents().toArray().reverse();\n\t\t\t\t\tlastParents.push(lastCtrl);\n\n\t\t\t\t\tfor (idx = 0; idx < lastParents.length; idx++) {\n\t\t\t\t\t\tif (parents[idx] !== lastParents[idx]) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (i = lastParents.length - 1; i >= idx; i--) {\n\t\t\t\t\t\tlastCtrl = lastParents[i];\n\t\t\t\t\t\tlastCtrl.fire(\"mouseleave\", {\n\t\t\t\t\t\t\ttarget: lastCtrl.getEl()\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (i = idx; i < parents.length; i++) {\n\t\t\t\t\tctrl = parents[i];\n\t\t\t\t\tctrl.fire(\"mouseenter\", {\n\t\t\t\t\t\ttarget: ctrl.getEl()\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction fixWheelEvent(e) {\n\t\t\te.preventDefault();\n\n\t\t\tif (e.type == \"mousewheel\") {\n\t\t\t\te.deltaY = -1 / 40 * e.wheelDelta;\n\n\t\t\t\tif (e.wheelDeltaX) {\n\t\t\t\t\te.deltaX = -1 / 40 * e.wheelDeltaX;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\te.deltaX = 0;\n\t\t\t\te.deltaY = e.detail;\n\t\t\t}\n\n\t\t\te = eventCtrl.fire(\"wheel\", e);\n\t\t}\n\n\t\tnativeEvents = eventCtrl._nativeEvents;\n\t\tif (nativeEvents) {\n\t\t\t// Find event root element if it exists\n\t\t\tparents = eventCtrl.parents().toArray();\n\t\t\tparents.unshift(eventCtrl);\n\t\t\tfor (i = 0, l = parents.length; !eventRootCtrl && i < l; i++) {\n\t\t\t\teventRootCtrl = parents[i]._eventsRoot;\n\t\t\t}\n\n\t\t\t// Event root wasn't found the use the root control\n\t\t\tif (!eventRootCtrl) {\n\t\t\t\teventRootCtrl = parents[parents.length - 1] || eventCtrl;\n\t\t\t}\n\n\t\t\t// Set the eventsRoot property on children that didn't have it\n\t\t\teventCtrl._eventsRoot = eventRootCtrl;\n\t\t\tfor (l = i, i = 0; i < l; i++) {\n\t\t\t\tparents[i]._eventsRoot = eventRootCtrl;\n\t\t\t}\n\n\t\t\tvar eventRootDelegates = eventRootCtrl._delegates;\n\t\t\tif (!eventRootDelegates) {\n\t\t\t\teventRootDelegates = eventRootCtrl._delegates = {};\n\t\t\t}\n\n\t\t\t// Bind native event delegates\n\t\t\tfor (name in nativeEvents) {\n\t\t\t\tif (!nativeEvents) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (name === \"wheel\" && !hasWheelEventSupport) {\n\t\t\t\t\tif (hasMouseWheelEventSupport) {\n\t\t\t\t\t\t$(eventCtrl.getEl()).on(\"mousewheel\", fixWheelEvent);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(eventCtrl.getEl()).on(\"DOMMouseScroll\", fixWheelEvent);\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Special treatment for mousenter/mouseleave since these doesn't bubble\n\t\t\t\tif (name === \"mouseenter\" || name === \"mouseleave\") {\n\t\t\t\t\t// Fake mousenter/mouseleave\n\t\t\t\t\tif (!eventRootCtrl._hasMouseEnter) {\n\t\t\t\t\t\t$(eventRootCtrl.getEl()).on(\"mouseleave\", mouseLeaveHandler).on(\"mouseover\", mouseEnterHandler);\n\t\t\t\t\t\teventRootCtrl._hasMouseEnter = 1;\n\t\t\t\t\t}\n\t\t\t\t} else if (!eventRootDelegates[name]) {\n\t\t\t\t\t$(eventRootCtrl.getEl()).on(name, delegate);\n\t\t\t\t\teventRootDelegates[name] = true;\n\t\t\t\t}\n\n\t\t\t\t// Remove the event once it's bound\n\t\t\t\tnativeEvents[name] = false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn Control;\n});\n\n// Included from: js/tinymce/classes/ui/Factory.js\n\n/**\n * Factory.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*global tinymce:true */\n\n/**\n * This class is a factory for control instances. This enables you\n * to create instances of controls without having to require the UI controls directly.\n *\n * It also allow you to override or add new control types.\n *\n * @class tinymce.ui.Factory\n */\ndefine(\"tinymce/ui/Factory\", [], function() {\n\t\"use strict\";\n\n\tvar types = {}, namespaceInit;\n\n\treturn {\n\t\t/**\n\t\t * Adds a new control instance type to the factory.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} type Type name for example \"button\".\n\t\t * @param {function} typeClass Class type function.\n\t\t */\n\t\tadd: function(type, typeClass) {\n\t\t\ttypes[type.toLowerCase()] = typeClass;\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the specified type exists or not.\n\t\t *\n\t\t * @method has\n\t\t * @param {String} type Type to look for.\n\t\t * @return {Boolean} true/false if the control by name exists.\n\t\t */\n\t\thas: function(type) {\n\t\t\treturn !!types[type.toLowerCase()];\n\t\t},\n\n\t\t/**\n\t\t * Creates a new control instance based on the settings provided. The instance created will be\n\t\t * based on the specified type property it can also create whole structures of components out of\n\t\t * the specified JSON object.\n\t\t *\n\t\t * @example\n\t\t * tinymce.ui.Factory.create({\n\t\t *     type: 'button',\n\t\t *     text: 'Hello world!'\n\t\t * });\n\t\t *\n\t\t * @method create\n\t\t * @param {Object/String} settings Name/Value object with items used to create the type.\n\t\t * @return {tinymce.ui.Control} Control instance based on the specified type.\n\t\t */\n\t\tcreate: function(type, settings) {\n\t\t\tvar ControlType, name, namespace;\n\n\t\t\t// Build type lookup\n\t\t\tif (!namespaceInit) {\n\t\t\t\tnamespace = tinymce.ui;\n\n\t\t\t\tfor (name in namespace) {\n\t\t\t\t\ttypes[name.toLowerCase()] = namespace[name];\n\t\t\t\t}\n\n\t\t\t\tnamespaceInit = true;\n\t\t\t}\n\n\t\t\t// If string is specified then use it as the type\n\t\t\tif (typeof type == 'string') {\n\t\t\t\tsettings = settings || {};\n\t\t\t\tsettings.type = type;\n\t\t\t} else {\n\t\t\t\tsettings = type;\n\t\t\t\ttype = settings.type;\n\t\t\t}\n\n\t\t\t// Find control type\n\t\t\ttype = type.toLowerCase();\n\t\t\tControlType = types[type];\n\n\t\t\t// #if debug\n\n\t\t\tif (!ControlType) {\n\t\t\t\tthrow new Error(\"Could not find control by type: \" + type);\n\t\t\t}\n\n\t\t\t// #endif\n\n\t\t\tControlType = new ControlType(settings);\n\t\t\tControlType.type = type; // Set the type on the instance, this will be used by the Selector engine\n\n\t\t\treturn ControlType;\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/KeyboardNavigation.js\n\n/**\n * KeyboardNavigation.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles keyboard navigation of controls and elements.\n *\n * @class tinymce.ui.KeyboardNavigation\n */\ndefine(\"tinymce/ui/KeyboardNavigation\", [\n], function() {\n\t\"use strict\";\n\n\t/**\n\t * This class handles all keyboard navigation for WAI-ARIA support. Each root container\n\t * gets an instance of this class.\n\t *\n\t * @constructor\n\t */\n\treturn function(settings) {\n\t\tvar root = settings.root, focusedElement, focusedControl;\n\n\t\tfunction isElement(node) {\n\t\t\treturn node && node.nodeType === 1;\n\t\t}\n\n\t\ttry {\n\t\t\tfocusedElement = document.activeElement;\n\t\t} catch (ex) {\n\t\t\t// IE sometimes fails to return a proper element\n\t\t\tfocusedElement = document.body;\n\t\t}\n\n\t\tfocusedControl = root.getParentCtrl(focusedElement);\n\n\t\t/**\n\t\t * Returns the currently focused elements wai aria role of the currently\n\t\t * focused element or specified element.\n\t\t *\n\t\t * @private\n\t\t * @param {Element} elm Optional element to get role from.\n\t\t * @return {String} Role of specified element.\n\t\t */\n\t\tfunction getRole(elm) {\n\t\t\telm = elm || focusedElement;\n\n\t\t\tif (isElement(elm)) {\n\t\t\t\treturn elm.getAttribute('role');\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\t/**\n\t\t * Returns the wai role of the parent element of the currently\n\t\t * focused element or specified element.\n\t\t *\n\t\t * @private\n\t\t * @param {Element} elm Optional element to get parent role from.\n\t\t * @return {String} Role of the first parent that has a role.\n\t\t */\n\t\tfunction getParentRole(elm) {\n\t\t\tvar role, parent = elm || focusedElement;\n\n\t\t\twhile ((parent = parent.parentNode)) {\n\t\t\t\tif ((role = getRole(parent))) {\n\t\t\t\t\treturn role;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Returns a wai aria property by name for example aria-selected.\n\t\t *\n\t\t * @private\n\t\t * @param {String} name Name of the aria property to get for example \"disabled\".\n\t\t * @return {String} Aria property value.\n\t\t */\n\t\tfunction getAriaProp(name) {\n\t\t\tvar elm = focusedElement;\n\n\t\t\tif (isElement(elm)) {\n\t\t\t\treturn elm.getAttribute('aria-' + name);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Is the element a text input element or not.\n\t\t *\n\t\t * @private\n\t\t * @param {Element} elm Element to check if it's an text input element or not.\n\t\t * @return {Boolean} True/false if the element is a text element or not.\n\t\t */\n\t\tfunction isTextInputElement(elm) {\n\t\t\tvar tagName = elm.tagName.toUpperCase();\n\n\t\t\t// Notice: since type can be \"email\" etc we don't check the type\n\t\t\t// So all input elements gets treated as text input elements\n\t\t\treturn tagName == \"INPUT\" || tagName == \"TEXTAREA\" || tagName == \"SELECT\";\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if the specified element can be focused or not.\n\t\t *\n\t\t * @private\n\t\t * @param {Element} elm DOM element to check if it can be focused or not.\n\t\t * @return {Boolean} True/false if the element can have focus.\n\t\t */\n\t\tfunction canFocus(elm) {\n\t\t\tif (isTextInputElement(elm) && !elm.hidden) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (/^(button|menuitem|checkbox|tab|menuitemcheckbox|option|gridcell|slider)$/.test(getRole(elm))) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t/**\n\t\t * Returns an array of focusable visible elements within the specified container element.\n\t\t *\n\t\t * @private\n\t\t * @param {Element} elm DOM element to find focusable elements within.\n\t\t * @return {Array} Array of focusable elements.\n\t\t */\n\t\tfunction getFocusElements(elm) {\n\t\t\tvar elements = [];\n\n\t\t\tfunction collect(elm) {\n\t\t\t\tif (elm.nodeType != 1 || elm.style.display == 'none') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (canFocus(elm)) {\n\t\t\t\t\telements.push(elm);\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0; i < elm.childNodes.length; i++) {\n\t\t\t\t\tcollect(elm.childNodes[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcollect(elm || root.getEl());\n\n\t\t\treturn elements;\n\t\t}\n\n\t\t/**\n\t\t * Returns the navigation root control for the specified control. The navigation root\n\t\t * is the control that the keyboard navigation gets scoped to for example a menubar or toolbar group.\n\t\t * It will look for parents of the specified target control or the currently focused control if this option is omitted.\n\t\t *\n\t\t * @private\n\t\t * @param {tinymce.ui.Control} targetControl Optional target control to find root of.\n\t\t * @return {tinymce.ui.Control} Navigation root control.\n\t\t */\n\t\tfunction getNavigationRoot(targetControl) {\n\t\t\tvar navigationRoot, controls;\n\n\t\t\ttargetControl = targetControl || focusedControl;\n\t\t\tcontrols = targetControl.parents().toArray();\n\t\t\tcontrols.unshift(targetControl);\n\n\t\t\tfor (var i = 0; i < controls.length; i++) {\n\t\t\t\tnavigationRoot = controls[i];\n\n\t\t\t\tif (navigationRoot.settings.ariaRoot) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn navigationRoot;\n\t\t}\n\n\t\t/**\n\t\t * Focuses the first item in the specified targetControl element or the last aria index if the\n\t\t * navigation root has the ariaRemember option enabled.\n\t\t *\n\t\t * @private\n\t\t * @param {tinymce.ui.Control} targetControl Target control to focus the first item in.\n\t\t */\n\t\tfunction focusFirst(targetControl) {\n\t\t\tvar navigationRoot = getNavigationRoot(targetControl);\n\t\t\tvar focusElements = getFocusElements(navigationRoot.getEl());\n\n\t\t\tif (navigationRoot.settings.ariaRemember && \"lastAriaIndex\" in navigationRoot) {\n\t\t\t\tmoveFocusToIndex(navigationRoot.lastAriaIndex, focusElements);\n\t\t\t} else {\n\t\t\t\tmoveFocusToIndex(0, focusElements);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the specified index within the elements list.\n\t\t * This will scope the index to the size of the element list if it changed.\n\t\t *\n\t\t * @private\n\t\t * @param {Number} idx Specified index to move to.\n\t\t * @param {Array} elements Array with dom elements to move focus within.\n\t\t * @return {Number} Input index or a changed index if it was out of range.\n\t\t */\n\t\tfunction moveFocusToIndex(idx, elements) {\n\t\t\tif (idx < 0) {\n\t\t\t\tidx = elements.length - 1;\n\t\t\t} else if (idx >= elements.length) {\n\t\t\t\tidx = 0;\n\t\t\t}\n\n\t\t\tif (elements[idx]) {\n\t\t\t\telements[idx].focus();\n\t\t\t}\n\n\t\t\treturn idx;\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus forwards or backwards.\n\t\t *\n\t\t * @private\n\t\t * @param {Number} dir Direction to move in positive means forward, negative means backwards.\n\t\t * @param {Array} elements Optional array of elements to move within defaults to the current navigation roots elements.\n\t\t */\n\t\tfunction moveFocus(dir, elements) {\n\t\t\tvar idx = -1, navigationRoot = getNavigationRoot();\n\n\t\t\telements = elements || getFocusElements(navigationRoot.getEl());\n\n\t\t\tfor (var i = 0; i < elements.length; i++) {\n\t\t\t\tif (elements[i] === focusedElement) {\n\t\t\t\t\tidx = i;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tidx += dir;\n\t\t\tnavigationRoot.lastAriaIndex = moveFocusToIndex(idx, elements);\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the left this is called by the left key.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction left() {\n\t\t\tvar parentRole = getParentRole();\n\n\t\t\tif (parentRole == \"tablist\") {\n\t\t\t\tmoveFocus(-1, getFocusElements(focusedElement.parentNode));\n\t\t\t} else if (focusedControl.parent().submenu) {\n\t\t\t\tcancel();\n\t\t\t} else {\n\t\t\t\tmoveFocus(-1);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the right this is called by the right key.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction right() {\n\t\t\tvar role = getRole(), parentRole = getParentRole();\n\n\t\t\tif (parentRole == \"tablist\") {\n\t\t\t\tmoveFocus(1, getFocusElements(focusedElement.parentNode));\n\t\t\t} else if (role == \"menuitem\" && parentRole == \"menu\" && getAriaProp('haspopup')) {\n\t\t\t\tenter();\n\t\t\t} else {\n\t\t\t\tmoveFocus(1);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the up this is called by the up key.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction up() {\n\t\t\tmoveFocus(-1);\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the up this is called by the down key.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction down() {\n\t\t\tvar role = getRole(), parentRole = getParentRole();\n\n\t\t\tif (role == \"menuitem\" && parentRole == \"menubar\") {\n\t\t\t\tenter();\n\t\t\t} else if (role == \"button\" && getAriaProp('haspopup')) {\n\t\t\t\tenter({key: 'down'});\n\t\t\t} else {\n\t\t\t\tmoveFocus(1);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Moves the focus to the next item or previous item depending on shift key.\n\t\t *\n\t\t * @private\n\t\t * @param {DOMEvent} e DOM event object.\n\t\t */\n\t\tfunction tab(e) {\n\t\t\tvar parentRole = getParentRole();\n\n\t\t\tif (parentRole == \"tablist\") {\n\t\t\t\tvar elm = getFocusElements(focusedControl.getEl('body'))[0];\n\n\t\t\t\tif (elm) {\n\t\t\t\t\telm.focus();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tmoveFocus(e.shiftKey ? -1 : 1);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Calls the cancel event on the currently focused control. This is normally done using the Esc key.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction cancel() {\n\t\t\tfocusedControl.fire('cancel');\n\t\t}\n\n\t\t/**\n\t\t * Calls the click event on the currently focused control. This is normally done using the Enter/Space keys.\n\t\t *\n\t\t * @private\n\t\t * @param {Object} aria Optional aria data to pass along with the enter event.\n\t\t */\n\t\tfunction enter(aria) {\n\t\t\taria = aria || {};\n\t\t\tfocusedControl.fire('click', {target: focusedElement, aria: aria});\n\t\t}\n\n\t\troot.on('keydown', function(e) {\n\t\t\tfunction handleNonTabOrEscEvent(e, handler) {\n\t\t\t\t// Ignore non tab keys for text elements\n\t\t\t\tif (isTextInputElement(focusedElement)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (getRole(focusedElement) === 'slider') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (handler(e) !== false) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (e.keyCode) {\n\t\t\t\tcase 37: // DOM_VK_LEFT\n\t\t\t\t\thandleNonTabOrEscEvent(e, left);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 39: // DOM_VK_RIGHT\n\t\t\t\t\thandleNonTabOrEscEvent(e, right);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 38: // DOM_VK_UP\n\t\t\t\t\thandleNonTabOrEscEvent(e, up);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 40: // DOM_VK_DOWN\n\t\t\t\t\thandleNonTabOrEscEvent(e, down);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 27: // DOM_VK_ESCAPE\n\t\t\t\t\tcancel();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 14: // DOM_VK_ENTER\n\t\t\t\tcase 13: // DOM_VK_RETURN\n\t\t\t\tcase 32: // DOM_VK_SPACE\n\t\t\t\t\thandleNonTabOrEscEvent(e, enter);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 9: // DOM_VK_TAB\n\t\t\t\t\tif (tab(e) !== false) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\troot.on('focusin', function(e) {\n\t\t\tfocusedElement = e.target;\n\t\t\tfocusedControl = e.control;\n\t\t});\n\n\t\treturn {\n\t\t\tfocusFirst: focusFirst\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Container.js\n\n/**\n * Container.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Container control. This is extended by all controls that can have\n * children such as panels etc. You can also use this class directly as an\n * generic container instance. The container doesn't have any specific role or style.\n *\n * @-x-less Container.less\n * @class tinymce.ui.Container\n * @extends tinymce.ui.Control\n */\ndefine(\"tinymce/ui/Container\", [\n\t\"tinymce/ui/Control\",\n\t\"tinymce/ui/Collection\",\n\t\"tinymce/ui/Selector\",\n\t\"tinymce/ui/Factory\",\n\t\"tinymce/ui/KeyboardNavigation\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/ClassList\",\n\t\"tinymce/ui/ReflowQueue\"\n], function(Control, Collection, Selector, Factory, KeyboardNavigation, Tools, $, ClassList, ReflowQueue) {\n\t\"use strict\";\n\n\tvar selectorCache = {};\n\n\treturn Control.extend({\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Array} items Items to add to container in JSON format or control instances.\n\t\t * @setting {String} layout Layout manager by name to use.\n\t\t * @setting {Object} defaults Default settings to apply to all items.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\n\t\t\tif (settings.fixed) {\n\t\t\t\tself.state.set('fixed', true);\n\t\t\t}\n\n\t\t\tself._items = new Collection();\n\n\t\t\tif (self.isRtl()) {\n\t\t\t\tself.classes.add('rtl');\n\t\t\t}\n\n\t\t\tself.bodyClasses = new ClassList(function() {\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.getEl('body').className = this.toString();\n\t\t\t\t}\n\t\t\t});\n\t\t\tself.bodyClasses.prefix = self.classPrefix;\n\n\t\t\tself.classes.add('container');\n\t\t\tself.bodyClasses.add('container-body');\n\n\t\t\tif (settings.containerCls) {\n\t\t\t\tself.classes.add(settings.containerCls);\n\t\t\t}\n\n\t\t\tself._layout = Factory.create((settings.layout || '') + 'layout');\n\n\t\t\tif (self.settings.items) {\n\t\t\t\tself.add(self.settings.items);\n\t\t\t} else {\n\t\t\t\tself.add(self.render());\n\t\t\t}\n\n\t\t\t// TODO: Fix this!\n\t\t\tself._hasBody = true;\n\t\t},\n\n\t\t/**\n\t\t * Returns a collection of child items that the container currently have.\n\t\t *\n\t\t * @method items\n\t\t * @return {tinymce.ui.Collection} Control collection direct child controls.\n\t\t */\n\t\titems: function() {\n\t\t\treturn this._items;\n\t\t},\n\n\t\t/**\n\t\t * Find child controls by selector.\n\t\t *\n\t\t * @method find\n\t\t * @param {String} selector Selector CSS pattern to find children by.\n\t\t * @return {tinymce.ui.Collection} Control collection with child controls.\n\t\t */\n\t\tfind: function(selector) {\n\t\t\tselector = selectorCache[selector] = selectorCache[selector] || new Selector(selector);\n\n\t\t\treturn selector.find(this);\n\t\t},\n\n\t\t/**\n\t\t * Adds one or many items to the current container. This will create instances of\n\t\t * the object representations if needed.\n\t\t *\n\t\t * @method add\n\t\t * @param {Array/Object/tinymce.ui.Control} items Array or item that will be added to the container.\n\t\t * @return {tinymce.ui.Collection} Current collection control.\n\t\t */\n\t\tadd: function(items) {\n\t\t\tvar self = this;\n\n\t\t\tself.items().add(self.create(items)).parent(self);\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Focuses the current container instance. This will look\n\t\t * for the first control in the container and focus that.\n\t\t *\n\t\t * @method focus\n\t\t * @param {Boolean} keyboard Optional true/false if the focus was a keyboard focus or not.\n\t\t * @return {tinymce.ui.Collection} Current instance.\n\t\t */\n\t\tfocus: function(keyboard) {\n\t\t\tvar self = this, focusCtrl, keyboardNav, items;\n\n\t\t\tif (keyboard) {\n\t\t\t\tkeyboardNav = self.keyboardNav || self.parents().eq(-1)[0].keyboardNav;\n\n\t\t\t\tif (keyboardNav) {\n\t\t\t\t\tkeyboardNav.focusFirst(self);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\titems = self.find('*');\n\n\t\t\t// TODO: Figure out a better way to auto focus alert dialog buttons\n\t\t\tif (self.statusbar) {\n\t\t\t\titems.add(self.statusbar.items());\n\t\t\t}\n\n\t\t\titems.each(function(ctrl) {\n\t\t\t\tif (ctrl.settings.autofocus) {\n\t\t\t\t\tfocusCtrl = null;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (ctrl.canFocus) {\n\t\t\t\t\tfocusCtrl = focusCtrl || ctrl;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (focusCtrl) {\n\t\t\t\tfocusCtrl.focus();\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Replaces the specified child control with a new control.\n\t\t *\n\t\t * @method replace\n\t\t * @param {tinymce.ui.Control} oldItem Old item to be replaced.\n\t\t * @param {tinymce.ui.Control} newItem New item to be inserted.\n\t\t */\n\t\treplace: function(oldItem, newItem) {\n\t\t\tvar ctrlElm, items = this.items(), i = items.length;\n\n\t\t\t// Replace the item in collection\n\t\t\twhile (i--) {\n\t\t\t\tif (items[i] === oldItem) {\n\t\t\t\t\titems[i] = newItem;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (i >= 0) {\n\t\t\t\t// Remove new item from DOM\n\t\t\t\tctrlElm = newItem.getEl();\n\t\t\t\tif (ctrlElm) {\n\t\t\t\t\tctrlElm.parentNode.removeChild(ctrlElm);\n\t\t\t\t}\n\n\t\t\t\t// Remove old item from DOM\n\t\t\t\tctrlElm = oldItem.getEl();\n\t\t\t\tif (ctrlElm) {\n\t\t\t\t\tctrlElm.parentNode.removeChild(ctrlElm);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Adopt the item\n\t\t\tnewItem.parent(this);\n\t\t},\n\n\t\t/**\n\t\t * Creates the specified items. If any of the items is plain JSON style objects\n\t\t * it will convert these into real tinymce.ui.Control instances.\n\t\t *\n\t\t * @method create\n\t\t * @param {Array} items Array of items to convert into control instances.\n\t\t * @return {Array} Array with control instances.\n\t\t */\n\t\tcreate: function(items) {\n\t\t\tvar self = this, settings, ctrlItems = [];\n\n\t\t\t// Non array structure, then force it into an array\n\t\t\tif (!Tools.isArray(items)) {\n\t\t\t\titems = [items];\n\t\t\t}\n\n\t\t\t// Add default type to each child control\n\t\t\tTools.each(items, function(item) {\n\t\t\t\tif (item) {\n\t\t\t\t\t// Construct item if needed\n\t\t\t\t\tif (!(item instanceof Control)) {\n\t\t\t\t\t\t// Name only then convert it to an object\n\t\t\t\t\t\tif (typeof item == \"string\") {\n\t\t\t\t\t\t\titem = {type: item};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Create control instance based on input settings and default settings\n\t\t\t\t\t\tsettings = Tools.extend({}, self.settings.defaults, item);\n\t\t\t\t\t\titem.type = settings.type = settings.type || item.type || self.settings.defaultType ||\n\t\t\t\t\t\t\t(settings.defaults ? settings.defaults.type : null);\n\t\t\t\t\t\titem = Factory.create(settings);\n\t\t\t\t\t}\n\n\t\t\t\t\tctrlItems.push(item);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn ctrlItems;\n\t\t},\n\n\t\t/**\n\t\t * Renders new control instances.\n\t\t *\n\t\t * @private\n\t\t */\n\t\trenderNew: function() {\n\t\t\tvar self = this;\n\n\t\t\t// Render any new items\n\t\t\tself.items().each(function(ctrl, index) {\n\t\t\t\tvar containerElm;\n\n\t\t\t\tctrl.parent(self);\n\n\t\t\t\tif (!ctrl.state.get('rendered')) {\n\t\t\t\t\tcontainerElm = self.getEl('body');\n\n\t\t\t\t\t// Insert or append the item\n\t\t\t\t\tif (containerElm.hasChildNodes() && index <= containerElm.childNodes.length - 1) {\n\t\t\t\t\t\t$(containerElm.childNodes[index]).before(ctrl.renderHtml());\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(containerElm).append(ctrl.renderHtml());\n\t\t\t\t\t}\n\n\t\t\t\t\tctrl.postRender();\n\t\t\t\t\tReflowQueue.add(ctrl);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself._layout.applyClasses(self.items().filter(':visible'));\n\t\t\tself._lastRect = null;\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Appends new instances to the current container.\n\t\t *\n\t\t * @method append\n\t\t * @param {Array/tinymce.ui.Collection} items Array if controls to append.\n\t\t * @return {tinymce.ui.Container} Current container instance.\n\t\t */\n\t\tappend: function(items) {\n\t\t\treturn this.add(items).renderNew();\n\t\t},\n\n\t\t/**\n\t\t * Prepends new instances to the current container.\n\t\t *\n\t\t * @method prepend\n\t\t * @param {Array/tinymce.ui.Collection} items Array if controls to prepend.\n\t\t * @return {tinymce.ui.Container} Current container instance.\n\t\t */\n\t\tprepend: function(items) {\n\t\t\tvar self = this;\n\n\t\t\tself.items().set(self.create(items).concat(self.items().toArray()));\n\n\t\t\treturn self.renderNew();\n\t\t},\n\n\t\t/**\n\t\t * Inserts an control at a specific index.\n\t\t *\n\t\t * @method insert\n\t\t * @param {Array/tinymce.ui.Collection} items Array if controls to insert.\n\t\t * @param {Number} index Index to insert controls at.\n\t\t * @param {Boolean} [before=false] Inserts controls before the index.\n\t\t */\n\t\tinsert: function(items, index, before) {\n\t\t\tvar self = this, curItems, beforeItems, afterItems;\n\n\t\t\titems = self.create(items);\n\t\t\tcurItems = self.items();\n\n\t\t\tif (!before && index < curItems.length - 1) {\n\t\t\t\tindex += 1;\n\t\t\t}\n\n\t\t\tif (index >= 0 && index < curItems.length) {\n\t\t\t\tbeforeItems = curItems.slice(0, index).toArray();\n\t\t\t\tafterItems = curItems.slice(index).toArray();\n\t\t\t\tcurItems.set(beforeItems.concat(items, afterItems));\n\t\t\t}\n\n\t\t\treturn self.renderNew();\n\t\t},\n\n\t\t/**\n\t\t * Populates the form fields from the specified JSON data object.\n\t\t *\n\t\t * Control items in the form that matches the data will have it's value set.\n\t\t *\n\t\t * @method fromJSON\n\t\t * @param {Object} data JSON data object to set control values by.\n\t\t * @return {tinymce.ui.Container} Current form instance.\n\t\t */\n\t\tfromJSON: function(data) {\n\t\t\tvar self = this;\n\n\t\t\tfor (var name in data) {\n\t\t\t\tself.find('#' + name).value(data[name]);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Serializes the form into a JSON object by getting all items\n\t\t * that has a name and a value.\n\t\t *\n\t\t * @method toJSON\n\t\t * @return {Object} JSON object with form data.\n\t\t */\n\t\ttoJSON: function() {\n\t\t\tvar self = this, data = {};\n\n\t\t\tself.find('*').each(function(ctrl) {\n\t\t\t\tvar name = ctrl.name(), value = ctrl.value();\n\n\t\t\t\tif (name && typeof value != \"undefined\") {\n\t\t\t\t\tdata[name] = value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn data;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, role = this.settings.role;\n\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\"' + (role ? ' role=\"' + this.settings.role + '\"' : '') + '>' +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Post render method. Called after the control has been rendered to the target.\n\t\t *\n\t\t * @method postRender\n\t\t * @return {tinymce.ui.Container} Current combobox instance.\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, box;\n\n\t\t\tself.items().exec('postRender');\n\t\t\tself._super();\n\n\t\t\tself._layout.postRender(self);\n\t\t\tself.state.set('rendered', true);\n\n\t\t\tif (self.settings.style) {\n\t\t\t\tself.$el.css(self.settings.style);\n\t\t\t}\n\n\t\t\tif (self.settings.border) {\n\t\t\t\tbox = self.borderBox;\n\t\t\t\tself.$el.css({\n\t\t\t\t\t'border-top-width': box.top,\n\t\t\t\t\t'border-right-width': box.right,\n\t\t\t\t\t'border-bottom-width': box.bottom,\n\t\t\t\t\t'border-left-width': box.left\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!self.parent()) {\n\t\t\t\tself.keyboardNav = new KeyboardNavigation({\n\t\t\t\t\troot: self\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Initializes the current controls layout rect.\n\t\t * This will be executed by the layout managers to determine the\n\t\t * default minWidth/minHeight etc.\n\t\t *\n\t\t * @method initLayoutRect\n\t\t * @return {Object} Layout rect instance.\n\t\t */\n\t\tinitLayoutRect: function() {\n\t\t\tvar self = this, layoutRect = self._super();\n\n\t\t\t// Recalc container size by asking layout manager\n\t\t\tself._layout.recalc(self);\n\n\t\t\treturn layoutRect;\n\t\t},\n\n\t\t/**\n\t\t * Recalculates the positions of the controls in the current container.\n\t\t * This is invoked by the reflow method and shouldn't be called directly.\n\t\t *\n\t\t * @method recalc\n\t\t */\n\t\trecalc: function() {\n\t\t\tvar self = this, rect = self._layoutRect, lastRect = self._lastRect;\n\n\t\t\tif (!lastRect || lastRect.w != rect.w || lastRect.h != rect.h) {\n\t\t\t\tself._layout.recalc(self);\n\t\t\t\trect = self.layoutRect();\n\t\t\t\tself._lastRect = {x: rect.x, y: rect.y, w: rect.w, h: rect.h};\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Reflows the current container and it's children and possible parents.\n\t\t * This should be used after you for example append children to the current control so\n\t\t * that the layout managers know that they need to reposition everything.\n\t\t *\n\t\t * @example\n\t\t * container.append({type: 'button', text: 'My button'}).reflow();\n\t\t *\n\t\t * @method reflow\n\t\t * @return {tinymce.ui.Container} Current container instance.\n\t\t */\n\t\treflow: function() {\n\t\t\tvar i;\n\n\t\t\tReflowQueue.remove(this);\n\n\t\t\tif (this.visible()) {\n\t\t\t\tControl.repaintControls = [];\n\t\t\t\tControl.repaintControls.map = {};\n\n\t\t\t\tthis.recalc();\n\t\t\t\ti = Control.repaintControls.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tControl.repaintControls[i].repaint();\n\t\t\t\t}\n\n\t\t\t\t// TODO: Fix me!\n\t\t\t\tif (this.settings.layout !== \"flow\" && this.settings.layout !== \"stack\") {\n\t\t\t\t\tthis.repaint();\n\t\t\t\t}\n\n\t\t\t\tControl.repaintControls = [];\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/DragHelper.js\n\n/**\n * DragHelper.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Drag/drop helper class.\n *\n * @example\n * var dragHelper = new tinymce.ui.DragHelper('mydiv', {\n *     start: function(evt) {\n *     },\n *\n *     drag: function(evt) {\n *     },\n *\n *     end: function(evt) {\n *     }\n * });\n *\n * @class tinymce.ui.DragHelper\n */\ndefine(\"tinymce/ui/DragHelper\", [\n\t\"tinymce/dom/DomQuery\"\n], function($) {\n\t\"use strict\";\n\n\tfunction getDocumentSize(doc) {\n\t\tvar documentElement, body, scrollWidth, clientWidth;\n\t\tvar offsetWidth, scrollHeight, clientHeight, offsetHeight, max = Math.max;\n\n\t\tdocumentElement = doc.documentElement;\n\t\tbody = doc.body;\n\n\t\tscrollWidth = max(documentElement.scrollWidth, body.scrollWidth);\n\t\tclientWidth = max(documentElement.clientWidth, body.clientWidth);\n\t\toffsetWidth = max(documentElement.offsetWidth, body.offsetWidth);\n\n\t\tscrollHeight = max(documentElement.scrollHeight, body.scrollHeight);\n\t\tclientHeight = max(documentElement.clientHeight, body.clientHeight);\n\t\toffsetHeight = max(documentElement.offsetHeight, body.offsetHeight);\n\n\t\treturn {\n\t\t\twidth: scrollWidth < offsetWidth ? clientWidth : scrollWidth,\n\t\t\theight: scrollHeight < offsetHeight ? clientHeight : scrollHeight\n\t\t};\n\t}\n\n\tfunction updateWithTouchData(e) {\n\t\tvar keys, i;\n\n\t\tif (e.changedTouches) {\n\t\t\tkeys = \"screenX screenY pageX pageY clientX clientY\".split(' ');\n\t\t\tfor (i = 0; i < keys.length; i++) {\n\t\t\t\te[keys[i]] = e.changedTouches[0][keys[i]];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn function(id, settings) {\n\t\tvar $eventOverlay, doc = settings.document || document, downButton, start, stop, drag, startX, startY;\n\n\t\tsettings = settings || {};\n\n\t\tfunction getHandleElm() {\n\t\t\treturn doc.getElementById(settings.handle || id);\n\t\t}\n\n\t\tstart = function(e) {\n\t\t\tvar docSize = getDocumentSize(doc), handleElm, cursor;\n\n\t\t\tupdateWithTouchData(e);\n\n\t\t\te.preventDefault();\n\t\t\tdownButton = e.button;\n\t\t\thandleElm = getHandleElm();\n\t\t\tstartX = e.screenX;\n\t\t\tstartY = e.screenY;\n\n\t\t\t// Grab cursor from handle so we can place it on overlay\n\t\t\tif (window.getComputedStyle) {\n\t\t\t\tcursor = window.getComputedStyle(handleElm, null).getPropertyValue(\"cursor\");\n\t\t\t} else {\n\t\t\t\tcursor = handleElm.runtimeStyle.cursor;\n\t\t\t}\n\n\t\t\t$eventOverlay = $('<div>').css({\n\t\t\t\tposition: \"absolute\",\n\t\t\t\ttop: 0, left: 0,\n\t\t\t\twidth: docSize.width,\n\t\t\t\theight: docSize.height,\n\t\t\t\tzIndex: 0x7FFFFFFF,\n\t\t\t\topacity: 0.0001,\n\t\t\t\tcursor: cursor\n\t\t\t}).appendTo(doc.body);\n\n\t\t\t$(doc).on('mousemove touchmove', drag).on('mouseup touchend', stop);\n\n\t\t\tsettings.start(e);\n\t\t};\n\n\t\tdrag = function(e) {\n\t\t\tupdateWithTouchData(e);\n\n\t\t\tif (e.button !== downButton) {\n\t\t\t\treturn stop(e);\n\t\t\t}\n\n\t\t\te.deltaX = e.screenX - startX;\n\t\t\te.deltaY = e.screenY - startY;\n\n\t\t\te.preventDefault();\n\t\t\tsettings.drag(e);\n\t\t};\n\n\t\tstop = function(e) {\n\t\t\tupdateWithTouchData(e);\n\n\t\t\t$(doc).off('mousemove touchmove', drag).off('mouseup touchend', stop);\n\n\t\t\t$eventOverlay.remove();\n\n\t\t\tif (settings.stop) {\n\t\t\t\tsettings.stop(e);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Destroys the drag/drop helper instance.\n\t\t *\n\t\t * @method destroy\n\t\t */\n\t\tthis.destroy = function() {\n\t\t\t$(getHandleElm()).off();\n\t\t};\n\n\t\t$(getHandleElm()).on('mousedown touchstart', start);\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Scrollable.js\n\n/**\n * Scrollable.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This mixin makes controls scrollable using custom scrollbars.\n *\n * @-x-less Scrollable.less\n * @mixin tinymce.ui.Scrollable\n */\ndefine(\"tinymce/ui/Scrollable\", [\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/DragHelper\"\n], function($, DragHelper) {\n\t\"use strict\";\n\n\treturn {\n\t\tinit: function() {\n\t\t\tvar self = this;\n\t\t\tself.on('repaint', self.renderScroll);\n\t\t},\n\n\t\trenderScroll: function() {\n\t\t\tvar self = this, margin = 2;\n\n\t\t\tfunction repaintScroll() {\n\t\t\t\tvar hasScrollH, hasScrollV, bodyElm;\n\n\t\t\t\tfunction repaintAxis(axisName, posName, sizeName, contentSizeName, hasScroll, ax) {\n\t\t\t\t\tvar containerElm, scrollBarElm, scrollThumbElm;\n\t\t\t\t\tvar containerSize, scrollSize, ratio, rect;\n\t\t\t\t\tvar posNameLower, sizeNameLower;\n\n\t\t\t\t\tscrollBarElm = self.getEl('scroll' + axisName);\n\t\t\t\t\tif (scrollBarElm) {\n\t\t\t\t\t\tposNameLower = posName.toLowerCase();\n\t\t\t\t\t\tsizeNameLower = sizeName.toLowerCase();\n\n\t\t\t\t\t\t$(self.getEl('absend')).css(posNameLower, self.layoutRect()[contentSizeName] - 1);\n\n\t\t\t\t\t\tif (!hasScroll) {\n\t\t\t\t\t\t\t$(scrollBarElm).css('display', 'none');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$(scrollBarElm).css('display', 'block');\n\t\t\t\t\t\tcontainerElm = self.getEl('body');\n\t\t\t\t\t\tscrollThumbElm = self.getEl('scroll' + axisName + \"t\");\n\t\t\t\t\t\tcontainerSize = containerElm[\"client\" + sizeName] - (margin * 2);\n\t\t\t\t\t\tcontainerSize -= hasScrollH && hasScrollV ? scrollBarElm[\"client\" + ax] : 0;\n\t\t\t\t\t\tscrollSize = containerElm[\"scroll\" + sizeName];\n\t\t\t\t\t\tratio = containerSize / scrollSize;\n\n\t\t\t\t\t\trect = {};\n\t\t\t\t\t\trect[posNameLower] = containerElm[\"offset\" + posName] + margin;\n\t\t\t\t\t\trect[sizeNameLower] = containerSize;\n\t\t\t\t\t\t$(scrollBarElm).css(rect);\n\n\t\t\t\t\t\trect = {};\n\t\t\t\t\t\trect[posNameLower] = containerElm[\"scroll\" + posName] * ratio;\n\t\t\t\t\t\trect[sizeNameLower] = containerSize * ratio;\n\t\t\t\t\t\t$(scrollThumbElm).css(rect);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbodyElm = self.getEl('body');\n\t\t\t\thasScrollH = bodyElm.scrollWidth > bodyElm.clientWidth;\n\t\t\t\thasScrollV = bodyElm.scrollHeight > bodyElm.clientHeight;\n\n\t\t\t\trepaintAxis(\"h\", \"Left\", \"Width\", \"contentW\", hasScrollH, \"Height\");\n\t\t\t\trepaintAxis(\"v\", \"Top\", \"Height\", \"contentH\", hasScrollV, \"Width\");\n\t\t\t}\n\n\t\t\tfunction addScroll() {\n\t\t\t\tfunction addScrollAxis(axisName, posName, sizeName, deltaPosName, ax) {\n\t\t\t\t\tvar scrollStart, axisId = self._id + '-scroll' + axisName, prefix = self.classPrefix;\n\n\t\t\t\t\t$(self.getEl()).append(\n\t\t\t\t\t\t'<div id=\"' + axisId + '\" class=\"' + prefix + 'scrollbar ' + prefix + 'scrollbar-' + axisName + '\">' +\n\t\t\t\t\t\t\t'<div id=\"' + axisId + 't\" class=\"' + prefix + 'scrollbar-thumb\"></div>' +\n\t\t\t\t\t\t'</div>'\n\t\t\t\t\t);\n\n\t\t\t\t\tself.draghelper = new DragHelper(axisId + 't', {\n\t\t\t\t\t\tstart: function() {\n\t\t\t\t\t\t\tscrollStart = self.getEl('body')[\"scroll\" + posName];\n\t\t\t\t\t\t\t$('#' + axisId).addClass(prefix + 'active');\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\tdrag: function(e) {\n\t\t\t\t\t\t\tvar ratio, hasScrollH, hasScrollV, containerSize, layoutRect = self.layoutRect();\n\n\t\t\t\t\t\t\thasScrollH = layoutRect.contentW > layoutRect.innerW;\n\t\t\t\t\t\t\thasScrollV = layoutRect.contentH > layoutRect.innerH;\n\t\t\t\t\t\t\tcontainerSize = self.getEl('body')[\"client\" + sizeName] - (margin * 2);\n\t\t\t\t\t\t\tcontainerSize -= hasScrollH && hasScrollV ? self.getEl('scroll' + axisName)[\"client\" + ax] : 0;\n\n\t\t\t\t\t\t\tratio = containerSize / self.getEl('body')[\"scroll\" + sizeName];\n\t\t\t\t\t\t\tself.getEl('body')[\"scroll\" + posName] = scrollStart + (e[\"delta\" + deltaPosName] / ratio);\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\tstop: function() {\n\t\t\t\t\t\t\t$('#' + axisId).removeClass(prefix + 'active');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tself.classes.add('scroll');\n\n\t\t\t\taddScrollAxis(\"v\", \"Top\", \"Height\", \"Y\", \"Width\");\n\t\t\t\taddScrollAxis(\"h\", \"Left\", \"Width\", \"X\", \"Height\");\n\t\t\t}\n\n\t\t\tif (self.settings.autoScroll) {\n\t\t\t\tif (!self._hasScroll) {\n\t\t\t\t\tself._hasScroll = true;\n\t\t\t\t\taddScroll();\n\n\t\t\t\t\tself.on('wheel', function(e) {\n\t\t\t\t\t\tvar bodyEl = self.getEl('body');\n\n\t\t\t\t\t\tbodyEl.scrollLeft += (e.deltaX || 0) * 10;\n\t\t\t\t\t\tbodyEl.scrollTop += e.deltaY * 10;\n\n\t\t\t\t\t\trepaintScroll();\n\t\t\t\t\t});\n\n\t\t\t\t\t$(self.getEl('body')).on(\"scroll\", repaintScroll);\n\t\t\t\t}\n\n\t\t\t\trepaintScroll();\n\t\t\t}\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Panel.js\n\n/**\n * Panel.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new panel.\n *\n * @-x-less Panel.less\n * @class tinymce.ui.Panel\n * @extends tinymce.ui.Container\n * @mixes tinymce.ui.Scrollable\n */\ndefine(\"tinymce/ui/Panel\", [\n\t\"tinymce/ui/Container\",\n\t\"tinymce/ui/Scrollable\"\n], function(Container, Scrollable) {\n\t\"use strict\";\n\n\treturn Container.extend({\n\t\tDefaults: {\n\t\t\tlayout: 'fit',\n\t\t\tcontainerCls: 'panel'\n\t\t},\n\n\t\tMixins: [Scrollable],\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, innerHtml = self.settings.html;\n\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\tif (typeof innerHtml == \"undefined\") {\n\t\t\t\tinnerHtml = (\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\tlayout.renderHtml(self) +\n\t\t\t\t\t'</div>'\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tif (typeof innerHtml == 'function') {\n\t\t\t\t\tinnerHtml = innerHtml.call(self);\n\t\t\t\t}\n\n\t\t\t\tself._hasBody = false;\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\" role=\"group\">' +\n\t\t\t\t\t(self._preBodyHtml || '') +\n\t\t\t\t\tinnerHtml +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Movable.js\n\n/**\n * Movable.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Movable mixin. Makes controls movable absolute and relative to other elements.\n *\n * @mixin tinymce.ui.Movable\n */\ndefine(\"tinymce/ui/Movable\", [\n\t\"tinymce/ui/DomUtils\"\n], function(DomUtils) {\n\t\"use strict\";\n\n\tfunction calculateRelativePosition(ctrl, targetElm, rel) {\n\t\tvar ctrlElm, pos, x, y, selfW, selfH, targetW, targetH, viewport, size;\n\n\t\tviewport = DomUtils.getViewPort();\n\n\t\t// Get pos of target\n\t\tpos = DomUtils.getPos(targetElm);\n\t\tx = pos.x;\n\t\ty = pos.y;\n\n\t\tif (ctrl.state.get('fixed') && DomUtils.getRuntimeStyle(document.body, 'position') == 'static') {\n\t\t\tx -= viewport.x;\n\t\t\ty -= viewport.y;\n\t\t}\n\n\t\t// Get size of self\n\t\tctrlElm = ctrl.getEl();\n\t\tsize = DomUtils.getSize(ctrlElm);\n\t\tselfW = size.width;\n\t\tselfH = size.height;\n\n\t\t// Get size of target\n\t\tsize = DomUtils.getSize(targetElm);\n\t\ttargetW = size.width;\n\t\ttargetH = size.height;\n\n\t\t// Parse align string\n\t\trel = (rel || '').split('');\n\n\t\t// Target corners\n\t\tif (rel[0] === 'b') {\n\t\t\ty += targetH;\n\t\t}\n\n\t\tif (rel[1] === 'r') {\n\t\t\tx += targetW;\n\t\t}\n\n\t\tif (rel[0] === 'c') {\n\t\t\ty += Math.round(targetH / 2);\n\t\t}\n\n\t\tif (rel[1] === 'c') {\n\t\t\tx += Math.round(targetW / 2);\n\t\t}\n\n\t\t// Self corners\n\t\tif (rel[3] === 'b') {\n\t\t\ty -= selfH;\n\t\t}\n\n\t\tif (rel[4] === 'r') {\n\t\t\tx -= selfW;\n\t\t}\n\n\t\tif (rel[3] === 'c') {\n\t\t\ty -= Math.round(selfH / 2);\n\t\t}\n\n\t\tif (rel[4] === 'c') {\n\t\t\tx -= Math.round(selfW / 2);\n\t\t}\n\n\t\treturn {\n\t\t\tx: x,\n\t\t\ty: y,\n\t\t\tw: selfW,\n\t\t\th: selfH\n\t\t};\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Tests various positions to get the most suitable one.\n\t\t *\n\t\t * @method testMoveRel\n\t\t * @param {DOMElement} elm Element to position against.\n\t\t * @param {Array} rels Array with relative positions.\n\t\t * @return {String} Best suitable relative position.\n\t\t */\n\t\ttestMoveRel: function(elm, rels) {\n\t\t\tvar viewPortRect = DomUtils.getViewPort();\n\n\t\t\tfor (var i = 0; i < rels.length; i++) {\n\t\t\t\tvar pos = calculateRelativePosition(this, elm, rels[i]);\n\n\t\t\t\tif (this.state.get('fixed')) {\n\t\t\t\t\tif (pos.x > 0 && pos.x + pos.w < viewPortRect.w && pos.y > 0 && pos.y + pos.h < viewPortRect.h) {\n\t\t\t\t\t\treturn rels[i];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (pos.x > viewPortRect.x && pos.x + pos.w < viewPortRect.w + viewPortRect.x &&\n\t\t\t\t\t\tpos.y > viewPortRect.y && pos.y + pos.h < viewPortRect.h + viewPortRect.y) {\n\t\t\t\t\t\treturn rels[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn rels[0];\n\t\t},\n\n\t\t/**\n\t\t * Move relative to the specified element.\n\t\t *\n\t\t * @method moveRel\n\t\t * @param {Element} elm Element to move relative to.\n\t\t * @param {String} rel Relative mode. For example: br-tl.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tmoveRel: function(elm, rel) {\n\t\t\tif (typeof rel != 'string') {\n\t\t\t\trel = this.testMoveRel(elm, rel);\n\t\t\t}\n\n\t\t\tvar pos = calculateRelativePosition(this, elm, rel);\n\t\t\treturn this.moveTo(pos.x, pos.y);\n\t\t},\n\n\t\t/**\n\t\t * Move by a relative x, y values.\n\t\t *\n\t\t * @method moveBy\n\t\t * @param {Number} dx Relative x position.\n\t\t * @param {Number} dy Relative y position.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tmoveBy: function(dx, dy) {\n\t\t\tvar self = this, rect = self.layoutRect();\n\n\t\t\tself.moveTo(rect.x + dx, rect.y + dy);\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Move to absolute position.\n\t\t *\n\t\t * @method moveTo\n\t\t * @param {Number} x Absolute x position.\n\t\t * @param {Number} y Absolute y position.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tmoveTo: function(x, y) {\n\t\t\tvar self = this;\n\n\t\t\t// TODO: Move this to some global class\n\t\t\tfunction constrain(value, max, size) {\n\t\t\t\tif (value < 0) {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\n\t\t\t\tif (value + size > max) {\n\t\t\t\t\tvalue = max - size;\n\t\t\t\t\treturn value < 0 ? 0 : value;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tif (self.settings.constrainToViewport) {\n\t\t\t\tvar viewPortRect = DomUtils.getViewPort(window);\n\t\t\t\tvar layoutRect = self.layoutRect();\n\n\t\t\t\tx = constrain(x, viewPortRect.w + viewPortRect.x, layoutRect.w);\n\t\t\t\ty = constrain(y, viewPortRect.h + viewPortRect.y, layoutRect.h);\n\t\t\t}\n\n\t\t\tif (self.state.get('rendered')) {\n\t\t\t\tself.layoutRect({x: x, y: y}).repaint();\n\t\t\t} else {\n\t\t\t\tself.settings.x = x;\n\t\t\t\tself.settings.y = y;\n\t\t\t}\n\n\t\t\tself.fire('move', {x: x, y: y});\n\n\t\t\treturn self;\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Resizable.js\n\n/**\n * Resizable.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Resizable mixin. Enables controls to be resized.\n *\n * @mixin tinymce.ui.Resizable\n */\ndefine(\"tinymce/ui/Resizable\", [\n\t\"tinymce/ui/DomUtils\"\n], function(DomUtils) {\n\t\"use strict\";\n\n\treturn {\n\t\t/**\n\t\t * Resizes the control to contents.\n\t\t *\n\t\t * @method resizeToContent\n\t\t */\n\t\tresizeToContent: function() {\n\t\t\tthis._layoutRect.autoResize = true;\n\t\t\tthis._lastRect = null;\n\t\t\tthis.reflow();\n\t\t},\n\n\t\t/**\n\t\t * Resizes the control to a specific width/height.\n\t\t *\n\t\t * @method resizeTo\n\t\t * @param {Number} w Control width.\n\t\t * @param {Number} h Control height.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tresizeTo: function(w, h) {\n\t\t\t// TODO: Fix hack\n\t\t\tif (w <= 1 || h <= 1) {\n\t\t\t\tvar rect = DomUtils.getWindowSize();\n\n\t\t\t\tw = w <= 1 ? w * rect.w : w;\n\t\t\t\th = h <= 1 ? h * rect.h : h;\n\t\t\t}\n\n\t\t\tthis._layoutRect.autoResize = false;\n\t\t\treturn this.layoutRect({minW: w, minH: h, w: w, h: h}).reflow();\n\t\t},\n\n\t\t/**\n\t\t * Resizes the control to a specific relative width/height.\n\t\t *\n\t\t * @method resizeBy\n\t\t * @param {Number} dw Relative control width.\n\t\t * @param {Number} dh Relative control height.\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tresizeBy: function(dw, dh) {\n\t\t\tvar self = this, rect = self.layoutRect();\n\n\t\t\treturn self.resizeTo(rect.w + dw, rect.h + dh);\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/FloatPanel.js\n\n/**\n * FloatPanel.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a floating panel.\n *\n * @-x-less FloatPanel.less\n * @class tinymce.ui.FloatPanel\n * @extends tinymce.ui.Panel\n * @mixes tinymce.ui.Movable\n * @mixes tinymce.ui.Resizable\n */\ndefine(\"tinymce/ui/FloatPanel\", [\n\t\"tinymce/ui/Panel\",\n\t\"tinymce/ui/Movable\",\n\t\"tinymce/ui/Resizable\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/util/Delay\"\n], function(Panel, Movable, Resizable, DomUtils, $, Delay) {\n\t\"use strict\";\n\n\tvar documentClickHandler, documentScrollHandler, windowResizeHandler, visiblePanels = [];\n\tvar zOrder = [], hasModal;\n\n\tfunction isChildOf(ctrl, parent) {\n\t\twhile (ctrl) {\n\t\t\tif (ctrl == parent) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tctrl = ctrl.parent();\n\t\t}\n\t}\n\n\tfunction skipOrHidePanels(e) {\n\t\t// Hide any float panel when a click/focus out is out side that float panel and the\n\t\t// float panels direct parent for example a click on a menu button\n\t\tvar i = visiblePanels.length;\n\n\t\twhile (i--) {\n\t\t\tvar panel = visiblePanels[i], clickCtrl = panel.getParentCtrl(e.target);\n\n\t\t\tif (panel.settings.autohide) {\n\t\t\t\tif (clickCtrl) {\n\t\t\t\t\tif (isChildOf(clickCtrl, panel) || panel.parent() === clickCtrl) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\te = panel.fire('autohide', {target: e.target});\n\t\t\t\tif (!e.isDefaultPrevented()) {\n\t\t\t\t\tpanel.hide();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction bindDocumentClickHandler() {\n\n\t\tif (!documentClickHandler) {\n\t\t\tdocumentClickHandler = function(e) {\n\t\t\t\t// Gecko fires click event and in the wrong order on Mac so lets normalize\n\t\t\t\tif (e.button == 2) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tskipOrHidePanels(e);\n\t\t\t};\n\n\t\t\t$(document).on('click touchstart', documentClickHandler);\n\t\t}\n\t}\n\n\tfunction bindDocumentScrollHandler() {\n\t\tif (!documentScrollHandler) {\n\t\t\tdocumentScrollHandler = function() {\n\t\t\t\tvar i;\n\n\t\t\t\ti = visiblePanels.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\trepositionPanel(visiblePanels[i]);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t$(window).on('scroll', documentScrollHandler);\n\t\t}\n\t}\n\n\tfunction bindWindowResizeHandler() {\n\t\tif (!windowResizeHandler) {\n\t\t\tvar docElm = document.documentElement, clientWidth = docElm.clientWidth, clientHeight = docElm.clientHeight;\n\n\t\t\twindowResizeHandler = function() {\n\t\t\t\t// Workaround for #7065 IE 7 fires resize events event though the window wasn't resized\n\t\t\t\tif (!document.all || clientWidth != docElm.clientWidth || clientHeight != docElm.clientHeight) {\n\t\t\t\t\tclientWidth = docElm.clientWidth;\n\t\t\t\t\tclientHeight = docElm.clientHeight;\n\t\t\t\t\tFloatPanel.hideAll();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t$(window).on('resize', windowResizeHandler);\n\t\t}\n\t}\n\n\t/**\n\t * Repositions the panel to the top of page if the panel is outside of the visual viewport. It will\n\t * also reposition all child panels of the current panel.\n\t */\n\tfunction repositionPanel(panel) {\n\t\tvar scrollY = DomUtils.getViewPort().y;\n\n\t\tfunction toggleFixedChildPanels(fixed, deltaY) {\n\t\t\tvar parent;\n\n\t\t\tfor (var i = 0; i < visiblePanels.length; i++) {\n\t\t\t\tif (visiblePanels[i] != panel) {\n\t\t\t\t\tparent = visiblePanels[i].parent();\n\n\t\t\t\t\twhile (parent && (parent = parent.parent())) {\n\t\t\t\t\t\tif (parent == panel) {\n\t\t\t\t\t\t\tvisiblePanels[i].fixed(fixed).moveBy(0, deltaY).repaint();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (panel.settings.autofix) {\n\t\t\tif (!panel.state.get('fixed')) {\n\t\t\t\tpanel._autoFixY = panel.layoutRect().y;\n\n\t\t\t\tif (panel._autoFixY < scrollY) {\n\t\t\t\t\tpanel.fixed(true).layoutRect({y: 0}).repaint();\n\t\t\t\t\ttoggleFixedChildPanels(true, scrollY - panel._autoFixY);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (panel._autoFixY > scrollY) {\n\t\t\t\t\tpanel.fixed(false).layoutRect({y: panel._autoFixY}).repaint();\n\t\t\t\t\ttoggleFixedChildPanels(false, panel._autoFixY - scrollY);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction addRemove(add, ctrl) {\n\t\tvar i, zIndex = FloatPanel.zIndex || 0xFFFF, topModal;\n\n\t\tif (add) {\n\t\t\tzOrder.push(ctrl);\n\t\t} else {\n\t\t\ti = zOrder.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tif (zOrder[i] === ctrl) {\n\t\t\t\t\tzOrder.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (zOrder.length) {\n\t\t\tfor (i = 0; i < zOrder.length; i++) {\n\t\t\t\tif (zOrder[i].modal) {\n\t\t\t\t\tzIndex++;\n\t\t\t\t\ttopModal = zOrder[i];\n\t\t\t\t}\n\n\t\t\t\tzOrder[i].getEl().style.zIndex = zIndex;\n\t\t\t\tzOrder[i].zIndex = zIndex;\n\t\t\t\tzIndex++;\n\t\t\t}\n\t\t}\n\n\t\tvar modalBlockEl = $('#' + ctrl.classPrefix + 'modal-block', ctrl.getContainerElm())[0];\n\n\t\tif (topModal) {\n\t\t\t$(modalBlockEl).css('z-index', topModal.zIndex - 1);\n\t\t} else if (modalBlockEl) {\n\t\t\tmodalBlockEl.parentNode.removeChild(modalBlockEl);\n\t\t\thasModal = false;\n\t\t}\n\n\t\tFloatPanel.currentZIndex = zIndex;\n\t}\n\n\tvar FloatPanel = Panel.extend({\n\t\tMixins: [Movable, Resizable],\n\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} autohide Automatically hide the panel.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tself._eventsRoot = self;\n\n\t\t\tself.classes.add('floatpanel');\n\n\t\t\t// Hide floatpanes on click out side the root button\n\t\t\tif (settings.autohide) {\n\t\t\t\tbindDocumentClickHandler();\n\t\t\t\tbindWindowResizeHandler();\n\t\t\t\tvisiblePanels.push(self);\n\t\t\t}\n\n\t\t\tif (settings.autofix) {\n\t\t\t\tbindDocumentScrollHandler();\n\n\t\t\t\tself.on('move', function() {\n\t\t\t\t\trepositionPanel(this);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.on('postrender show', function(e) {\n\t\t\t\tif (e.control == self) {\n\t\t\t\t\tvar $modalBlockEl, prefix = self.classPrefix;\n\n\t\t\t\t\tif (self.modal && !hasModal) {\n\t\t\t\t\t\t$modalBlockEl = $('#' + prefix + 'modal-block', self.getContainerElm());\n\t\t\t\t\t\tif (!$modalBlockEl[0]) {\n\t\t\t\t\t\t\t$modalBlockEl = $(\n\t\t\t\t\t\t\t\t'<div id=\"' + prefix + 'modal-block\" class=\"' + prefix + 'reset ' + prefix + 'fade\"></div>'\n\t\t\t\t\t\t\t).appendTo(self.getContainerElm());\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tDelay.setTimeout(function() {\n\t\t\t\t\t\t\t$modalBlockEl.addClass(prefix + 'in');\n\t\t\t\t\t\t\t$(self.getEl()).addClass(prefix + 'in');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\thasModal = true;\n\t\t\t\t\t}\n\n\t\t\t\t\taddRemove(true, self);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('show', function() {\n\t\t\t\tself.parents().each(function(ctrl) {\n\t\t\t\t\tif (ctrl.state.get('fixed')) {\n\t\t\t\t\t\tself.fixed(true);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (settings.popover) {\n\t\t\t\tself._preBodyHtml = '<div class=\"' + self.classPrefix + 'arrow\"></div>';\n\t\t\t\tself.classes.add('popover').add('bottom').add(self.isRtl() ? 'end' : 'start');\n\t\t\t}\n\n\t\t\tself.aria('label', settings.ariaLabel);\n\t\t\tself.aria('labelledby', self._id);\n\t\t\tself.aria('describedby', self.describedBy || self._id + '-none');\n\t\t},\n\n\t\tfixed: function(state) {\n\t\t\tvar self = this;\n\n\t\t\tif (self.state.get('fixed') != state) {\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tvar viewport = DomUtils.getViewPort();\n\n\t\t\t\t\tif (state) {\n\t\t\t\t\t\tself.layoutRect().y -= viewport.y;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.layoutRect().y += viewport.y;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tself.classes.toggle('fixed', state);\n\t\t\t\tself.state.set('fixed', state);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Shows the current float panel.\n\t\t *\n\t\t * @method show\n\t\t * @return {tinymce.ui.FloatPanel} Current floatpanel instance.\n\t\t */\n\t\tshow: function() {\n\t\t\tvar self = this, i, state = self._super();\n\n\t\t\ti = visiblePanels.length;\n\t\t\twhile (i--) {\n\t\t\t\tif (visiblePanels[i] === self) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (i === -1) {\n\t\t\t\tvisiblePanels.push(self);\n\t\t\t}\n\n\t\t\treturn state;\n\t\t},\n\n\t\t/**\n\t\t * Hides the current float panel.\n\t\t *\n\t\t * @method hide\n\t\t * @return {tinymce.ui.FloatPanel} Current floatpanel instance.\n\t\t */\n\t\thide: function() {\n\t\t\tremoveVisiblePanel(this);\n\t\t\taddRemove(false, this);\n\n\t\t\treturn this._super();\n\t\t},\n\n\t\t/**\n\t\t * Hide all visible float panels with he autohide setting enabled. This is for\n\t\t * manually hiding floating menus or panels.\n\t\t *\n\t\t * @method hideAll\n\t\t */\n\t\thideAll: function() {\n\t\t\tFloatPanel.hideAll();\n\t\t},\n\n\t\t/**\n\t\t * Closes the float panel. This will remove the float panel from page and fire the close event.\n\t\t *\n\t\t * @method close\n\t\t */\n\t\tclose: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!self.fire('close').isDefaultPrevented()) {\n\t\t\t\tself.remove();\n\t\t\t\taddRemove(false, self);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Removes the float panel from page.\n\t\t *\n\t\t * @method remove\n\t\t */\n\t\tremove: function() {\n\t\t\tremoveVisiblePanel(this);\n\t\t\tthis._super();\n\t\t},\n\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self.settings.bodyRole) {\n\t\t\t\tthis.getEl('body').setAttribute('role', self.settings.bodyRole);\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n\n\t/**\n\t * Hide all visible float panels with he autohide setting enabled. This is for\n\t * manually hiding floating menus or panels.\n\t *\n\t * @static\n\t * @method hideAll\n\t */\n\tFloatPanel.hideAll = function() {\n\t\tvar i = visiblePanels.length;\n\n\t\twhile (i--) {\n\t\t\tvar panel = visiblePanels[i];\n\n\t\t\tif (panel && panel.settings.autohide) {\n\t\t\t\tpanel.hide();\n\t\t\t\tvisiblePanels.splice(i, 1);\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction removeVisiblePanel(panel) {\n\t\tvar i;\n\n\t\ti = visiblePanels.length;\n\t\twhile (i--) {\n\t\t\tif (visiblePanels[i] === panel) {\n\t\t\t\tvisiblePanels.splice(i, 1);\n\t\t\t}\n\t\t}\n\n\t\ti = zOrder.length;\n\t\twhile (i--) {\n\t\t\tif (zOrder[i] === panel) {\n\t\t\t\tzOrder.splice(i, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn FloatPanel;\n});\n\n// Included from: js/tinymce/classes/ui/Window.js\n\n/**\n * Window.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new window.\n *\n * @-x-less Window.less\n * @class tinymce.ui.Window\n * @extends tinymce.ui.FloatPanel\n */\ndefine(\"tinymce/ui/Window\", [\n\t\"tinymce/ui/FloatPanel\",\n\t\"tinymce/ui/Panel\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/DragHelper\",\n\t\"tinymce/ui/BoxUtils\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Delay\"\n], function(FloatPanel, Panel, DomUtils, $, DragHelper, BoxUtils, Env, Delay) {\n\t\"use strict\";\n\n\tvar windows = [], oldMetaValue = '';\n\n\tfunction toggleFullScreenState(state) {\n\t\tvar noScaleMetaValue = 'width=device-width,initial-scale=1.0,user-scalable=0,minimum-scale=1.0,maximum-scale=1.0',\n\t\t\tviewport = $(\"meta[name=viewport]\")[0],\n\t\t\tcontentValue;\n\n\t\tif (Env.overrideViewPort === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!viewport) {\n\t\t\tviewport = document.createElement('meta');\n\t\t\tviewport.setAttribute('name', 'viewport');\n\t\t\tdocument.getElementsByTagName('head')[0].appendChild(viewport);\n\t\t}\n\n\t\tcontentValue = viewport.getAttribute('content');\n\t\tif (contentValue && typeof oldMetaValue != 'undefined') {\n\t\t\toldMetaValue = contentValue;\n\t\t}\n\n\t\tviewport.setAttribute('content', state ? noScaleMetaValue : oldMetaValue);\n\t}\n\n\tfunction toggleBodyFullScreenClasses(classPrefix) {\n\t\tfor (var i = 0; i < windows.length; i++) {\n\t\t\tif (windows[i]._fullscreen) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t$([document.documentElement, document.body]).removeClass(classPrefix + 'fullscreen');\n\t}\n\n\tfunction handleWindowResize() {\n\t\tif (!Env.desktop) {\n\t\t\tvar lastSize = {\n\t\t\t\tw: window.innerWidth,\n\t\t\t\th: window.innerHeight\n\t\t\t};\n\n\t\t\tDelay.setInterval(function() {\n\t\t\t\tvar w = window.innerWidth,\n\t\t\t\t\th = window.innerHeight;\n\n\t\t\t\tif (lastSize.w != w || lastSize.h != h) {\n\t\t\t\t\tlastSize = {\n\t\t\t\t\t\tw: w,\n\t\t\t\t\t\th: h\n\t\t\t\t\t};\n\n\t\t\t\t\t$(window).trigger('resize');\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t}\n\n\t\tfunction reposition() {\n\t\t\tvar i, rect = DomUtils.getWindowSize(), layoutRect;\n\n\t\t\tfor (i = 0; i < windows.length; i++) {\n\t\t\t\tlayoutRect = windows[i].layoutRect();\n\n\t\t\t\twindows[i].moveTo(\n\t\t\t\t\twindows[i].settings.x || Math.max(0, rect.w / 2 - layoutRect.w / 2),\n\t\t\t\t\twindows[i].settings.y || Math.max(0, rect.h / 2 - layoutRect.h / 2)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t$(window).on('resize', reposition);\n\t}\n\n\tvar Window = FloatPanel.extend({\n\t\tmodal: true,\n\n\t\tDefaults: {\n\t\t\tborder: 1,\n\t\t\tlayout: 'flex',\n\t\t\tcontainerCls: 'panel',\n\t\t\trole: 'dialog',\n\t\t\tcallbacks: {\n\t\t\t\tsubmit: function() {\n\t\t\t\t\tthis.fire('submit', {data: this.toJSON()});\n\t\t\t\t},\n\n\t\t\t\tclose: function() {\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\n\t\t\tif (self.isRtl()) {\n\t\t\t\tself.classes.add('rtl');\n\t\t\t}\n\n\t\t\tself.classes.add('window');\n\t\t\tself.bodyClasses.add('window-body');\n\t\t\tself.state.set('fixed', true);\n\n\t\t\t// Create statusbar\n\t\t\tif (settings.buttons) {\n\t\t\t\tself.statusbar = new Panel({\n\t\t\t\t\tlayout: 'flex',\n\t\t\t\t\tborder: '1 0 0 0',\n\t\t\t\t\tspacing: 3,\n\t\t\t\t\tpadding: 10,\n\t\t\t\t\talign: 'center',\n\t\t\t\t\tpack: self.isRtl() ? 'start' : 'end',\n\t\t\t\t\tdefaults: {\n\t\t\t\t\t\ttype: 'button'\n\t\t\t\t\t},\n\t\t\t\t\titems: settings.buttons\n\t\t\t\t});\n\n\t\t\t\tself.statusbar.classes.add('foot');\n\t\t\t\tself.statusbar.parent(self);\n\t\t\t}\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tvar closeClass = self.classPrefix + 'close';\n\n\t\t\t\tif (DomUtils.hasClass(e.target, closeClass) || DomUtils.hasClass(e.target.parentNode, closeClass)) {\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('cancel', function() {\n\t\t\t\tself.close();\n\t\t\t});\n\n\t\t\tself.aria('describedby', self.describedBy || self._id + '-none');\n\t\t\tself.aria('label', settings.title);\n\t\t\tself._fullscreen = false;\n\t\t},\n\n\t\t/**\n\t\t * Recalculates the positions of the controls in the current container.\n\t\t * This is invoked by the reflow method and shouldn't be called directly.\n\t\t *\n\t\t * @method recalc\n\t\t */\n\t\trecalc: function() {\n\t\t\tvar self = this, statusbar = self.statusbar, layoutRect, width, x, needsRecalc;\n\n\t\t\tif (self._fullscreen) {\n\t\t\t\tself.layoutRect(DomUtils.getWindowSize());\n\t\t\t\tself.layoutRect().contentH = self.layoutRect().innerH;\n\t\t\t}\n\n\t\t\tself._super();\n\n\t\t\tlayoutRect = self.layoutRect();\n\n\t\t\t// Resize window based on title width\n\t\t\tif (self.settings.title && !self._fullscreen) {\n\t\t\t\twidth = layoutRect.headerW;\n\t\t\t\tif (width > layoutRect.w) {\n\t\t\t\t\tx = layoutRect.x - Math.max(0, width / 2);\n\t\t\t\t\tself.layoutRect({w: width, x: x});\n\t\t\t\t\tneedsRecalc = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Resize window based on statusbar width\n\t\t\tif (statusbar) {\n\t\t\t\tstatusbar.layoutRect({w: self.layoutRect().innerW}).recalc();\n\n\t\t\t\twidth = statusbar.layoutRect().minW + layoutRect.deltaW;\n\t\t\t\tif (width > layoutRect.w) {\n\t\t\t\t\tx = layoutRect.x - Math.max(0, width - layoutRect.w);\n\t\t\t\t\tself.layoutRect({w: width, x: x});\n\t\t\t\t\tneedsRecalc = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Recalc body and disable auto resize\n\t\t\tif (needsRecalc) {\n\t\t\t\tself.recalc();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Initializes the current controls layout rect.\n\t\t * This will be executed by the layout managers to determine the\n\t\t * default minWidth/minHeight etc.\n\t\t *\n\t\t * @method initLayoutRect\n\t\t * @return {Object} Layout rect instance.\n\t\t */\n\t\tinitLayoutRect: function() {\n\t\t\tvar self = this, layoutRect = self._super(), deltaH = 0, headEl;\n\n\t\t\t// Reserve vertical space for title\n\t\t\tif (self.settings.title && !self._fullscreen) {\n\t\t\t\theadEl = self.getEl('head');\n\n\t\t\t\tvar size = DomUtils.getSize(headEl);\n\n\t\t\t\tlayoutRect.headerW = size.width;\n\t\t\t\tlayoutRect.headerH = size.height;\n\n\t\t\t\tdeltaH += layoutRect.headerH;\n\t\t\t}\n\n\t\t\t// Reserve vertical space for statusbar\n\t\t\tif (self.statusbar) {\n\t\t\t\tdeltaH += self.statusbar.layoutRect().h;\n\t\t\t}\n\n\t\t\tlayoutRect.deltaH += deltaH;\n\t\t\tlayoutRect.minH += deltaH;\n\t\t\t//layoutRect.innerH -= deltaH;\n\t\t\tlayoutRect.h += deltaH;\n\n\t\t\tvar rect = DomUtils.getWindowSize();\n\n\t\t\tlayoutRect.x = self.settings.x || Math.max(0, rect.w / 2 - layoutRect.w / 2);\n\t\t\tlayoutRect.y = self.settings.y || Math.max(0, rect.h / 2 - layoutRect.h / 2);\n\n\t\t\treturn layoutRect;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, id = self._id, prefix = self.classPrefix;\n\t\t\tvar settings = self.settings, headerHtml = '', footerHtml = '', html = settings.html;\n\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\tif (settings.title) {\n\t\t\t\theaderHtml = (\n\t\t\t\t\t'<div id=\"' + id + '-head\" class=\"' + prefix + 'window-head\">' +\n\t\t\t\t\t\t'<div id=\"' + id + '-title\" class=\"' + prefix + 'title\">' + self.encode(settings.title) + '</div>' +\n\t\t\t\t\t\t'<div id=\"' + id + '-dragh\" class=\"' + prefix + 'dragh\"></div>' +\n\t\t\t\t\t\t'<button type=\"button\" class=\"' + prefix + 'close\" aria-hidden=\"true\">' +\n\t\t\t\t\t\t\t'<i class=\"mce-ico mce-i-remove\"></i>' +\n\t\t\t\t\t\t'</button>' +\n\t\t\t\t\t'</div>'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (settings.url) {\n\t\t\t\thtml = '<iframe src=\"' + settings.url + '\" tabindex=\"-1\"></iframe>';\n\t\t\t}\n\n\t\t\tif (typeof html == \"undefined\") {\n\t\t\t\thtml = layout.renderHtml(self);\n\t\t\t}\n\n\t\t\tif (self.statusbar) {\n\t\t\t\tfooterHtml = self.statusbar.renderHtml();\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" hidefocus=\"1\">' +\n\t\t\t\t\t'<div class=\"' + self.classPrefix + 'reset\" role=\"application\">' +\n\t\t\t\t\t\theaderHtml +\n\t\t\t\t\t\t'<div id=\"' + id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\t\thtml +\n\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\tfooterHtml +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Switches the window fullscreen mode.\n\t\t *\n\t\t * @method fullscreen\n\t\t * @param {Boolean} state True/false state.\n\t\t * @return {tinymce.ui.Window} Current window instance.\n\t\t */\n\t\tfullscreen: function(state) {\n\t\t\tvar self = this, documentElement = document.documentElement, slowRendering, prefix = self.classPrefix, layoutRect;\n\n\t\t\tif (state != self._fullscreen) {\n\t\t\t\t$(window).on('resize', function() {\n\t\t\t\t\tvar time;\n\n\t\t\t\t\tif (self._fullscreen) {\n\t\t\t\t\t\t// Time the layout time if it's to slow use a timeout to not hog the CPU\n\t\t\t\t\t\tif (!slowRendering) {\n\t\t\t\t\t\t\ttime = new Date().getTime();\n\n\t\t\t\t\t\t\tvar rect = DomUtils.getWindowSize();\n\t\t\t\t\t\t\tself.moveTo(0, 0).resizeTo(rect.w, rect.h);\n\n\t\t\t\t\t\t\tif ((new Date().getTime()) - time > 50) {\n\t\t\t\t\t\t\t\tslowRendering = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (!self._timer) {\n\t\t\t\t\t\t\t\tself._timer = Delay.setTimeout(function() {\n\t\t\t\t\t\t\t\t\tvar rect = DomUtils.getWindowSize();\n\t\t\t\t\t\t\t\t\tself.moveTo(0, 0).resizeTo(rect.w, rect.h);\n\n\t\t\t\t\t\t\t\t\tself._timer = 0;\n\t\t\t\t\t\t\t\t}, 50);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tlayoutRect = self.layoutRect();\n\t\t\t\tself._fullscreen = state;\n\n\t\t\t\tif (!state) {\n\t\t\t\t\tself.borderBox = BoxUtils.parseBox(self.settings.border);\n\t\t\t\t\tself.getEl('head').style.display = '';\n\t\t\t\t\tlayoutRect.deltaH += layoutRect.headerH;\n\t\t\t\t\t$([documentElement, document.body]).removeClass(prefix + 'fullscreen');\n\t\t\t\t\tself.classes.remove('fullscreen');\n\t\t\t\t\tself.moveTo(self._initial.x, self._initial.y).resizeTo(self._initial.w, self._initial.h);\n\t\t\t\t} else {\n\t\t\t\t\tself._initial = {x: layoutRect.x, y: layoutRect.y, w: layoutRect.w, h: layoutRect.h};\n\n\t\t\t\t\tself.borderBox = BoxUtils.parseBox('0');\n\t\t\t\t\tself.getEl('head').style.display = 'none';\n\t\t\t\t\tlayoutRect.deltaH -= layoutRect.headerH + 2;\n\t\t\t\t\t$([documentElement, document.body]).addClass(prefix + 'fullscreen');\n\t\t\t\t\tself.classes.add('fullscreen');\n\n\t\t\t\t\tvar rect = DomUtils.getWindowSize();\n\t\t\t\t\tself.moveTo(0, 0).resizeTo(rect.w, rect.h);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self.reflow();\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, startPos;\n\n\t\t\tsetTimeout(function() {\n\t\t\t\tself.classes.add('in');\n\t\t\t\tself.fire('open');\n\t\t\t}, 0);\n\n\t\t\tself._super();\n\n\t\t\tif (self.statusbar) {\n\t\t\t\tself.statusbar.postRender();\n\t\t\t}\n\n\t\t\tself.focus();\n\n\t\t\tthis.dragHelper = new DragHelper(self._id + '-dragh', {\n\t\t\t\tstart: function() {\n\t\t\t\t\tstartPos = {\n\t\t\t\t\t\tx: self.layoutRect().x,\n\t\t\t\t\t\ty: self.layoutRect().y\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tdrag: function(e) {\n\t\t\t\t\tself.moveTo(startPos.x + e.deltaX, startPos.y + e.deltaY);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('submit', function(e) {\n\t\t\t\tif (!e.isDefaultPrevented()) {\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\twindows.push(self);\n\t\t\ttoggleFullScreenState(true);\n\t\t},\n\n\t\t/**\n\t\t * Fires a submit event with the serialized form.\n\t\t *\n\t\t * @method submit\n\t\t * @return {Object} Event arguments object.\n\t\t */\n\t\tsubmit: function() {\n\t\t\treturn this.fire('submit', {data: this.toJSON()});\n\t\t},\n\n\t\t/**\n\t\t * Removes the current control from DOM and from UI collections.\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tremove: function() {\n\t\t\tvar self = this, i;\n\n\t\t\tself.dragHelper.destroy();\n\t\t\tself._super();\n\n\t\t\tif (self.statusbar) {\n\t\t\t\tthis.statusbar.remove();\n\t\t\t}\n\n\t\t\ti = windows.length;\n\t\t\twhile (i--) {\n\t\t\t\tif (windows[i] === self) {\n\t\t\t\t\twindows.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttoggleFullScreenState(windows.length > 0);\n\t\t\ttoggleBodyFullScreenClasses(self.classPrefix);\n\t\t},\n\n\t\t/**\n\t\t * Returns the contentWindow object of the iframe if it exists.\n\t\t *\n\t\t * @method getContentWindow\n\t\t * @return {Window} window object or null.\n\t\t */\n\t\tgetContentWindow: function() {\n\t\t\tvar ifr = this.getEl().getElementsByTagName('iframe')[0];\n\t\t\treturn ifr ? ifr.contentWindow : null;\n\t\t}\n\t});\n\n\thandleWindowResize();\n\n\treturn Window;\n});\n\n// Included from: js/tinymce/classes/ui/MessageBox.js\n\n/**\n * MessageBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to create MessageBoxes like alerts/confirms etc.\n *\n * @class tinymce.ui.MessageBox\n * @extends tinymce.ui.FloatPanel\n */\ndefine(\"tinymce/ui/MessageBox\", [\n\t\"tinymce/ui/Window\"\n], function(Window) {\n\t\"use strict\";\n\n\tvar MessageBox = Window.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tsettings = {\n\t\t\t\tborder: 1,\n\t\t\t\tpadding: 20,\n\t\t\t\tlayout: 'flex',\n\t\t\t\tpack: \"center\",\n\t\t\t\talign: \"center\",\n\t\t\t\tcontainerCls: 'panel',\n\t\t\t\tautoScroll: true,\n\t\t\t\tbuttons: {type: \"button\", text: \"Ok\", action: \"ok\"},\n\t\t\t\titems: {\n\t\t\t\t\ttype: \"label\",\n\t\t\t\t\tmultiline: true,\n\t\t\t\t\tmaxWidth: 500,\n\t\t\t\t\tmaxHeight: 200\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._super(settings);\n\t\t},\n\n\t\tStatics: {\n\t\t\t/**\n\t\t\t * Ok buttons constant.\n\t\t\t *\n\t\t\t * @static\n\t\t\t * @final\n\t\t\t * @field {Number} OK\n\t\t\t */\n\t\t\tOK: 1,\n\n\t\t\t/**\n\t\t\t * Ok/cancel buttons constant.\n\t\t\t *\n\t\t\t * @static\n\t\t\t * @final\n\t\t\t * @field {Number} OK_CANCEL\n\t\t\t */\n\t\t\tOK_CANCEL: 2,\n\n\t\t\t/**\n\t\t\t * yes/no buttons constant.\n\t\t\t *\n\t\t\t * @static\n\t\t\t * @final\n\t\t\t * @field {Number} YES_NO\n\t\t\t */\n\t\t\tYES_NO: 3,\n\n\t\t\t/**\n\t\t\t * yes/no/cancel buttons constant.\n\t\t\t *\n\t\t\t * @static\n\t\t\t * @final\n\t\t\t * @field {Number} YES_NO_CANCEL\n\t\t\t */\n\t\t\tYES_NO_CANCEL: 4,\n\n\t\t\t/**\n\t\t\t * Constructs a new message box and renders it to the body element.\n\t\t\t *\n\t\t\t * @static\n\t\t\t * @method msgBox\n\t\t\t * @param {Object} settings Name/value object with settings.\n\t\t\t */\n\t\t\tmsgBox: function(settings) {\n\t\t\t\tvar buttons, callback = settings.callback || function() {};\n\n\t\t\t\tfunction createButton(text, status, primary) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: \"button\",\n\t\t\t\t\t\ttext: text,\n\t\t\t\t\t\tsubtype: primary ? 'primary' : '',\n\t\t\t\t\t\tonClick: function(e) {\n\t\t\t\t\t\t\te.control.parents()[1].close();\n\t\t\t\t\t\t\tcallback(status);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tswitch (settings.buttons) {\n\t\t\t\t\tcase MessageBox.OK_CANCEL:\n\t\t\t\t\t\tbuttons = [\n\t\t\t\t\t\t\tcreateButton('Ok', true, true),\n\t\t\t\t\t\t\tcreateButton('Cancel', false)\n\t\t\t\t\t\t];\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase MessageBox.YES_NO:\n\t\t\t\t\tcase MessageBox.YES_NO_CANCEL:\n\t\t\t\t\t\tbuttons = [\n\t\t\t\t\t\t\tcreateButton('Yes', 1, true),\n\t\t\t\t\t\t\tcreateButton('No', 0)\n\t\t\t\t\t\t];\n\n\t\t\t\t\t\tif (settings.buttons == MessageBox.YES_NO_CANCEL) {\n\t\t\t\t\t\t\tbuttons.push(createButton('Cancel', -1));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbuttons = [\n\t\t\t\t\t\t\tcreateButton('Ok', true, true)\n\t\t\t\t\t\t];\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\treturn new Window({\n\t\t\t\t\tpadding: 20,\n\t\t\t\t\tx: settings.x,\n\t\t\t\t\ty: settings.y,\n\t\t\t\t\tminWidth: 300,\n\t\t\t\t\tminHeight: 100,\n\t\t\t\t\tlayout: \"flex\",\n\t\t\t\t\tpack: \"center\",\n\t\t\t\t\talign: \"center\",\n\t\t\t\t\tbuttons: buttons,\n\t\t\t\t\ttitle: settings.title,\n\t\t\t\t\trole: 'alertdialog',\n\t\t\t\t\titems: {\n\t\t\t\t\t\ttype: \"label\",\n\t\t\t\t\t\tmultiline: true,\n\t\t\t\t\t\tmaxWidth: 500,\n\t\t\t\t\t\tmaxHeight: 200,\n\t\t\t\t\t\ttext: settings.text\n\t\t\t\t\t},\n\t\t\t\t\tonPostRender: function() {\n\t\t\t\t\t\tthis.aria('describedby', this.items()[0]._id);\n\t\t\t\t\t},\n\t\t\t\t\tonClose: settings.onClose,\n\t\t\t\t\tonCancel: function() {\n\t\t\t\t\t\tcallback(false);\n\t\t\t\t\t}\n\t\t\t\t}).renderTo(document.body).reflow();\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Creates a new alert dialog.\n\t\t\t *\n\t\t\t * @method alert\n\t\t\t * @param {Object} settings Settings for the alert dialog.\n\t\t\t * @param {function} [callback] Callback to execute when the user makes a choice.\n\t\t\t */\n\t\t\talert: function(settings, callback) {\n\t\t\t\tif (typeof settings == \"string\") {\n\t\t\t\t\tsettings = {text: settings};\n\t\t\t\t}\n\n\t\t\t\tsettings.callback = callback;\n\t\t\t\treturn MessageBox.msgBox(settings);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Creates a new confirm dialog.\n\t\t\t *\n\t\t\t * @method confirm\n\t\t\t * @param {Object} settings Settings for the confirm dialog.\n\t\t\t * @param {function} [callback] Callback to execute when the user makes a choice.\n\t\t\t */\n\t\t\tconfirm: function(settings, callback) {\n\t\t\t\tif (typeof settings == \"string\") {\n\t\t\t\t\tsettings = {text: settings};\n\t\t\t\t}\n\n\t\t\t\tsettings.callback = callback;\n\t\t\t\tsettings.buttons = MessageBox.OK_CANCEL;\n\n\t\t\t\treturn MessageBox.msgBox(settings);\n\t\t\t}\n\t\t}\n\t});\n\n\treturn MessageBox;\n});\n\n// Included from: js/tinymce/classes/WindowManager.js\n\n/**\n * WindowManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles the creation of native windows and dialogs. This class can be extended to provide for example inline dialogs.\n *\n * @class tinymce.WindowManager\n * @example\n * // Opens a new dialog with the file.htm file and the size 320x240\n * // It also adds a custom parameter this can be retrieved by using tinyMCEPopup.getWindowArg inside the dialog.\n * tinymce.activeEditor.windowManager.open({\n *    url: 'file.htm',\n *    width: 320,\n *    height: 240\n * }, {\n *    custom_param: 1\n * });\n *\n * // Displays an alert box using the active editors window manager instance\n * tinymce.activeEditor.windowManager.alert('Hello world!');\n *\n * // Displays an confirm box and an alert message will be displayed depending on what you choose in the confirm\n * tinymce.activeEditor.windowManager.confirm(\"Do you want to do something\", function(s) {\n *    if (s)\n *       tinymce.activeEditor.windowManager.alert(\"Ok\");\n *    else\n *       tinymce.activeEditor.windowManager.alert(\"Cancel\");\n * });\n */\ndefine(\"tinymce/WindowManager\", [\n\t\"tinymce/ui/Window\",\n\t\"tinymce/ui/MessageBox\"\n], function(Window, MessageBox) {\n\treturn function(editor) {\n\t\tvar self = this, windows = [];\n\n\t\tfunction getTopMostWindow() {\n\t\t\tif (windows.length) {\n\t\t\t\treturn windows[windows.length - 1];\n\t\t\t}\n\t\t}\n\n\t\tfunction fireOpenEvent(win) {\n\t\t\teditor.fire('OpenWindow', {\n\t\t\t\twin: win\n\t\t\t});\n\t\t}\n\n\t\tfunction fireCloseEvent(win) {\n\t\t\teditor.fire('CloseWindow', {\n\t\t\t\twin: win\n\t\t\t});\n\t\t}\n\n\t\tself.windows = windows;\n\n\t\teditor.on('remove', function() {\n\t\t\tvar i = windows.length;\n\n\t\t\twhile (i--) {\n\t\t\t\twindows[i].close();\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Opens a new window.\n\t\t *\n\t\t * @method open\n\t\t * @param {Object} args Optional name/value settings collection contains things like width/height/url etc.\n\t\t * @param {Object} params Options like title, file, width, height etc.\n\t\t * @option {String} title Window title.\n\t\t * @option {String} file URL of the file to open in the window.\n\t\t * @option {Number} width Width in pixels.\n\t\t * @option {Number} height Height in pixels.\n\t\t * @option {Boolean} autoScroll Specifies whether the popup window can have scrollbars if required (i.e. content\n\t\t * larger than the popup size specified).\n\t\t */\n\t\tself.open = function(args, params) {\n\t\t\tvar win;\n\n\t\t\teditor.editorManager.setActive(editor);\n\n\t\t\targs.title = args.title || ' ';\n\n\t\t\t// Handle URL\n\t\t\targs.url = args.url || args.file; // Legacy\n\t\t\tif (args.url) {\n\t\t\t\targs.width = parseInt(args.width || 320, 10);\n\t\t\t\targs.height = parseInt(args.height || 240, 10);\n\t\t\t}\n\n\t\t\t// Handle body\n\t\t\tif (args.body) {\n\t\t\t\targs.items = {\n\t\t\t\t\tdefaults: args.defaults,\n\t\t\t\t\ttype: args.bodyType || 'form',\n\t\t\t\t\titems: args.body,\n\t\t\t\t\tdata: args.data,\n\t\t\t\t\tcallbacks: args.commands\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!args.url && !args.buttons) {\n\t\t\t\targs.buttons = [\n\t\t\t\t\t{text: 'Ok', subtype: 'primary', onclick: function() {\n\t\t\t\t\t\twin.find('form')[0].submit();\n\t\t\t\t\t}},\n\n\t\t\t\t\t{text: 'Cancel', onclick: function() {\n\t\t\t\t\t\twin.close();\n\t\t\t\t\t}}\n\t\t\t\t];\n\t\t\t}\n\n\t\t\twin = new Window(args);\n\t\t\twindows.push(win);\n\n\t\t\twin.on('close', function() {\n\t\t\t\tvar i = windows.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tif (windows[i] === win) {\n\t\t\t\t\t\twindows.splice(i, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!windows.length) {\n\t\t\t\t\teditor.focus();\n\t\t\t\t}\n\n\t\t\t\tfireCloseEvent(win);\n\t\t\t});\n\n\t\t\t// Handle data\n\t\t\tif (args.data) {\n\t\t\t\twin.on('postRender', function() {\n\t\t\t\t\tthis.find('*').each(function(ctrl) {\n\t\t\t\t\t\tvar name = ctrl.name();\n\n\t\t\t\t\t\tif (name in args.data) {\n\t\t\t\t\t\t\tctrl.value(args.data[name]);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// store args and parameters\n\t\t\twin.features = args || {};\n\t\t\twin.params = params || {};\n\n\t\t\t// Takes a snapshot in the FocusManager of the selection before focus is lost to dialog\n\t\t\tif (windows.length === 1) {\n\t\t\t\teditor.nodeChanged();\n\t\t\t}\n\n\t\t\twin = win.renderTo().reflow();\n\n\t\t\tfireOpenEvent(win);\n\n\t\t\treturn win;\n\t\t};\n\n\t\t/**\n\t\t * Creates a alert dialog. Please don't use the blocking behavior of this\n\t\t * native version use the callback method instead then it can be extended.\n\t\t *\n\t\t * @method alert\n\t\t * @param {String} message Text to display in the new alert dialog.\n\t\t * @param {function} callback Callback function to be executed after the user has selected ok.\n\t\t * @param {Object} scope Optional scope to execute the callback in.\n\t\t * @example\n\t\t * // Displays an alert box using the active editors window manager instance\n\t\t * tinymce.activeEditor.windowManager.alert('Hello world!');\n\t\t */\n\t\tself.alert = function(message, callback, scope) {\n\t\t\tvar win;\n\n\t\t\twin = MessageBox.alert(message, function() {\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback.call(scope || this);\n\t\t\t\t} else {\n\t\t\t\t\teditor.focus();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\twin.on('close', function() {\n\t\t\t\tfireCloseEvent(win);\n\t\t\t});\n\n\t\t\tfireOpenEvent(win);\n\t\t};\n\n\t\t/**\n\t\t * Creates a confirm dialog. Please don't use the blocking behavior of this\n\t\t * native version use the callback method instead then it can be extended.\n\t\t *\n\t\t * @method confirm\n\t\t * @param {String} message Text to display in the new confirm dialog.\n\t\t * @param {function} callback Callback function to be executed after the user has selected ok or cancel.\n\t\t * @param {Object} scope Optional scope to execute the callback in.\n\t\t * @example\n\t\t * // Displays an confirm box and an alert message will be displayed depending on what you choose in the confirm\n\t\t * tinymce.activeEditor.windowManager.confirm(\"Do you want to do something\", function(s) {\n\t\t *    if (s)\n\t\t *       tinymce.activeEditor.windowManager.alert(\"Ok\");\n\t\t *    else\n\t\t *       tinymce.activeEditor.windowManager.alert(\"Cancel\");\n\t\t * });\n\t\t */\n\t\tself.confirm = function(message, callback, scope) {\n\t\t\tvar win;\n\n\t\t\twin = MessageBox.confirm(message, function(state) {\n\t\t\t\tcallback.call(scope || this, state);\n\t\t\t});\n\n\t\t\twin.on('close', function() {\n\t\t\t\tfireCloseEvent(win);\n\t\t\t});\n\n\t\t\tfireOpenEvent(win);\n\t\t};\n\n\t\t/**\n\t\t * Closes the top most window.\n\t\t *\n\t\t * @method close\n\t\t */\n\t\tself.close = function() {\n\t\t\tif (getTopMostWindow()) {\n\t\t\t\tgetTopMostWindow().close();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Returns the params of the last window open call. This can be used in iframe based\n\t\t * dialog to get params passed from the tinymce plugin.\n\t\t *\n\t\t * @example\n\t\t * var dialogArguments = top.tinymce.activeEditor.windowManager.getParams();\n\t\t *\n\t\t * @method getParams\n\t\t * @return {Object} Name/value object with parameters passed from windowManager.open call.\n\t\t */\n\t\tself.getParams = function() {\n\t\t\treturn getTopMostWindow() ? getTopMostWindow().params : null;\n\t\t};\n\n\t\t/**\n\t\t * Sets the params of the last opened window.\n\t\t *\n\t\t * @method setParams\n\t\t * @param {Object} params Params object to set for the last opened window.\n\t\t */\n\t\tself.setParams = function(params) {\n\t\t\tif (getTopMostWindow()) {\n\t\t\t\tgetTopMostWindow().params = params;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Returns the currently opened window objects.\n\t\t *\n\t\t * @method getWindows\n\t\t * @return {Array} Array of the currently opened windows.\n\t\t */\n\t\tself.getWindows = function() {\n\t\t\treturn windows;\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Tooltip.js\n\n/**\n * Tooltip.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a tooltip instance.\n *\n * @-x-less ToolTip.less\n * @class tinymce.ui.ToolTip\n * @extends tinymce.ui.Control\n * @mixes tinymce.ui.Movable\n */\ndefine(\"tinymce/ui/Tooltip\", [\n\t\"tinymce/ui/Control\",\n\t\"tinymce/ui/Movable\"\n], function(Control, Movable) {\n\treturn Control.extend({\n\t\tMixins: [Movable],\n\n\t\tDefaults: {\n\t\t\tclasses: 'widget tooltip tooltip-n'\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, prefix = self.classPrefix;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" role=\"presentation\">' +\n\t\t\t\t\t'<div class=\"' + prefix + 'tooltip-arrow\"></div>' +\n\t\t\t\t\t'<div class=\"' + prefix + 'tooltip-inner\">' + self.encode(self.state.get('text')) + '</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tself.getEl().lastChild.innerHTML = self.encode(e.value);\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, style, rect;\n\n\t\t\tstyle = self.getEl().style;\n\t\t\trect = self._layoutRect;\n\n\t\t\tstyle.left = rect.x + 'px';\n\t\t\tstyle.top = rect.y + 'px';\n\t\t\tstyle.zIndex = 0xFFFF + 0xFFFF;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Widget.js\n\n/**\n * Widget.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Widget base class a widget is a control that has a tooltip and some basic states.\n *\n * @class tinymce.ui.Widget\n * @extends tinymce.ui.Control\n */\ndefine(\"tinymce/ui/Widget\", [\n\t\"tinymce/ui/Control\",\n\t\"tinymce/ui/Tooltip\"\n], function(Control, Tooltip) {\n\t\"use strict\";\n\n\tvar tooltip;\n\n\tvar Widget = Control.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} tooltip Tooltip text to display when hovering.\n\t\t * @setting {Boolean} autofocus True if the control should be focused when rendered.\n\t\t * @setting {String} text Text to display inside widget.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\t\t\tself.canFocus = true;\n\n\t\t\tif (settings.tooltip && Widget.tooltips !== false) {\n\t\t\t\tself.on('mouseenter', function(e) {\n\t\t\t\t\tvar tooltip = self.tooltip().moveTo(-0xFFFF);\n\n\t\t\t\t\tif (e.control == self) {\n\t\t\t\t\t\tvar rel = tooltip.text(settings.tooltip).show().testMoveRel(self.getEl(), ['bc-tc', 'bc-tl', 'bc-tr']);\n\n\t\t\t\t\t\ttooltip.classes.toggle('tooltip-n', rel == 'bc-tc');\n\t\t\t\t\t\ttooltip.classes.toggle('tooltip-nw', rel == 'bc-tl');\n\t\t\t\t\t\ttooltip.classes.toggle('tooltip-ne', rel == 'bc-tr');\n\n\t\t\t\t\t\ttooltip.moveRel(self.getEl(), rel);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttooltip.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.on('mouseleave mousedown click', function() {\n\t\t\t\t\tself.tooltip().hide();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.aria('label', settings.ariaLabel || settings.tooltip);\n\t\t},\n\n\t\t/**\n\t\t * Returns the current tooltip instance.\n\t\t *\n\t\t * @method tooltip\n\t\t * @return {tinymce.ui.Tooltip} Tooltip instance.\n\t\t */\n\t\ttooltip: function() {\n\t\t\tif (!tooltip) {\n\t\t\t\ttooltip = new Tooltip({type: 'tooltip'});\n\t\t\t\ttooltip.renderTo();\n\t\t\t}\n\n\t\t\treturn tooltip;\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, settings = self.settings;\n\n\t\t\tself._super();\n\n\t\t\tif (!self.parent() && (settings.width || settings.height)) {\n\t\t\t\tself.initLayoutRect();\n\t\t\t\tself.repaint();\n\t\t\t}\n\n\t\t\tif (settings.autofocus) {\n\t\t\t\tself.focus();\n\t\t\t}\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tfunction disable(state) {\n\t\t\t\tself.aria('disabled', state);\n\t\t\t\tself.classes.toggle('disabled', state);\n\t\t\t}\n\n\t\t\tfunction active(state) {\n\t\t\t\tself.aria('pressed', state);\n\t\t\t\tself.classes.toggle('active', state);\n\t\t\t}\n\n\t\t\tself.state.on('change:disabled', function(e) {\n\t\t\t\tdisable(e.value);\n\t\t\t});\n\n\t\t\tself.state.on('change:active', function(e) {\n\t\t\t\tactive(e.value);\n\t\t\t});\n\n\t\t\tif (self.state.get('disabled')) {\n\t\t\t\tdisable(true);\n\t\t\t}\n\n\t\t\tif (self.state.get('active')) {\n\t\t\t\tactive(true);\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t/**\n\t\t * Removes the current control from DOM and from UI collections.\n\t\t *\n\t\t * @method remove\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tremove: function() {\n\t\t\tthis._super();\n\n\t\t\tif (tooltip) {\n\t\t\t\ttooltip.remove();\n\t\t\t\ttooltip = null;\n\t\t\t}\n\t\t}\n\t});\n\n\treturn Widget;\n});\n\n// Included from: js/tinymce/classes/ui/Progress.js\n\n/**\n * Progress.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Progress control.\n *\n * @-x-less Progress.less\n * @class tinymce.ui.Progress\n * @extends tinymce.ui.Control\n */\ndefine(\"tinymce/ui/Progress\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tvalue: 0\n\t\t},\n\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('progress');\n\n\t\t\tif (!self.settings.filter) {\n\t\t\t\tself.settings.filter = function(value) {\n\t\t\t\t\treturn Math.round(value);\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = this.classPrefix;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<div class=\"' + prefix + 'bar-container\">' +\n\t\t\t\t\t\t'<div class=\"' + prefix + 'bar\"></div>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\t'<div class=\"' + prefix + 'text\">0%</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself._super();\n\t\t\tself.value(self.settings.value);\n\n\t\t\treturn self;\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tfunction setValue(value) {\n\t\t\t\tvalue = self.settings.filter(value);\n\t\t\t\tself.getEl().lastChild.innerHTML = value + '%';\n\t\t\t\tself.getEl().firstChild.firstChild.style.width = value + '%';\n\t\t\t}\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tsetValue(e.value);\n\t\t\t});\n\n\t\t\tsetValue(self.state.get('value'));\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Notification.js\n\n/**\n * Notification.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a notification instance.\n *\n * @-x-less Notification.less\n * @class tinymce.ui.Notification\n * @extends tinymce.ui.Container\n * @mixes tinymce.ui.Movable\n */\ndefine(\"tinymce/ui/Notification\", [\n\t\"tinymce/ui/Control\",\n\t\"tinymce/ui/Movable\",\n\t\"tinymce/ui/Progress\",\n\t\"tinymce/util/Delay\"\n], function(Control, Movable, Progress, Delay) {\n\treturn Control.extend({\n\t\tMixins: [Movable],\n\n\t\tDefaults: {\n\t\t\tclasses: 'widget notification'\n\t\t},\n\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\n\t\t\tif (settings.text) {\n\t\t\t\tself.text(settings.text);\n\t\t\t}\n\n\t\t\tif (settings.icon) {\n\t\t\t\tself.icon = settings.icon;\n\t\t\t}\n\n\t\t\tif (settings.color) {\n\t\t\t\tself.color = settings.color;\n\t\t\t}\n\n\t\t\tif (settings.type) {\n\t\t\t\tself.classes.add('notification-' + settings.type);\n\t\t\t}\n\n\t\t\tif (settings.timeout && (settings.timeout < 0 || settings.timeout > 0) && !settings.closeButton) {\n\t\t\t\tself.closeButton = false;\n\t\t\t} else {\n\t\t\t\tself.classes.add('has-close');\n\t\t\t\tself.closeButton = true;\n\t\t\t}\n\n\t\t\tif (settings.progressBar) {\n\t\t\t\tself.progressBar = new Progress();\n\t\t\t}\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tif (e.target.className.indexOf(self.classPrefix + 'close') != -1) {\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, prefix = self.classPrefix, icon = '', closeButton = '', progressBar = '', notificationStyle = '';\n\n\t\t\tif (self.icon) {\n\t\t\t\ticon = '<i class=\"' + prefix + 'ico' + ' ' + prefix + 'i-' + self.icon + '\"></i>';\n\t\t\t}\n\n\t\t\tif (self.color) {\n\t\t\t\tnotificationStyle = ' style=\"background-color: ' + self.color + '\"';\n\t\t\t}\n\n\t\t\tif (self.closeButton) {\n\t\t\t\tcloseButton = '<button type=\"button\" class=\"' + prefix + 'close\" aria-hidden=\"true\">\\u00d7</button>';\n\t\t\t}\n\n\t\t\tif (self.progressBar) {\n\t\t\t\tprogressBar = self.progressBar.renderHtml();\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\"' + notificationStyle + ' role=\"presentation\">' +\n\t\t\t\t\ticon +\n\t\t\t\t\t'<div class=\"' + prefix + 'notification-inner\">' + self.state.get('text') + '</div>' +\n\t\t\t\t\tprogressBar +\n\t\t\t\t\tcloseButton +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tDelay.setTimeout(function() {\n\t\t\t\tself.$el.addClass(self.classPrefix + 'in');\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tself.getEl().childNodes[1].innerHTML = e.value;\n\t\t\t});\n\t\t\tif (self.progressBar) {\n\t\t\t\tself.progressBar.bindStates();\n\t\t\t}\n\t\t\treturn self._super();\n\t\t},\n\n\t\tclose: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!self.fire('close').isDefaultPrevented()) {\n\t\t\t\tself.remove();\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, style, rect;\n\n\t\t\tstyle = self.getEl().style;\n\t\t\trect = self._layoutRect;\n\n\t\t\tstyle.left = rect.x + 'px';\n\t\t\tstyle.top = rect.y + 'px';\n\t\t\tstyle.zIndex = 0xFFFF + 0xFFFF;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/NotificationManager.js\n\n/**\n * NotificationManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class handles the creation of TinyMCE's notifications.\n *\n * @class tinymce.notificationManager\n * @example\n * // Opens a new notification of type \"error\" with text \"An error occurred.\"\n * tinymce.activeEditor.notificationManager.open({\n *    text: 'An error occurred.',\n *    type: 'error'\n * });\n */\ndefine(\"tinymce/NotificationManager\", [\n\t\"tinymce/ui/Notification\",\n\t\"tinymce/util/Delay\"\n], function(Notification, Delay) {\n\treturn function(editor) {\n\t\tvar self = this, notifications = [];\n\n\t\tfunction getLastNotification() {\n\t\t\tif (notifications.length) {\n\t\t\t\treturn notifications[notifications.length - 1];\n\t\t\t}\n\t\t}\n\n\t\tself.notifications = notifications;\n\n\t\tfunction resizeWindowEvent() {\n\t\t\tDelay.requestAnimationFrame(function() {\n\t\t\t\tprePositionNotifications();\n\t\t\t\tpositionNotifications();\n\t\t\t});\n\t\t}\n\n\t\t// Since the viewport will change based on the present notifications, we need to move them all to the\n\t\t// top left of the viewport to give an accurate size measurement so we can position them later.\n\t\tfunction prePositionNotifications() {\n\t\t\tfor (var i = 0; i < notifications.length; i++) {\n\t\t\t\tnotifications[i].moveTo(0, 0);\n\t\t\t}\n\t\t}\n\n\t\tfunction positionNotifications() {\n\t\t\tif (notifications.length > 0) {\n\t\t\t\tvar firstItem = notifications.slice(0, 1)[0];\n\t\t\t\tvar container = editor.inline ? editor.getElement() : editor.getContentAreaContainer();\n\t\t\t\tfirstItem.moveRel(container, 'tc-tc');\n\t\t\t\tif (notifications.length > 1) {\n\t\t\t\t\tfor (var i = 1; i < notifications.length; i++) {\n\t\t\t\t\t\tnotifications[i].moveRel(notifications[i - 1].getEl(), 'bc-tc');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\teditor.on('remove', function() {\n\t\t\tvar i = notifications.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tnotifications[i].close();\n\t\t\t}\n\t\t});\n\n\t\teditor.on('ResizeEditor', positionNotifications);\n\t\teditor.on('ResizeWindow', resizeWindowEvent);\n\n\t\t/**\n\t\t * Opens a new notification.\n\t\t *\n\t\t * @method open\n\t\t * @param {Object} args Optional name/value settings collection contains things like timeout/color/message etc.\n\t\t */\n\t\tself.open = function(args) {\n\t\t\tvar notif;\n\n\t\t\teditor.editorManager.setActive(editor);\n\n\t\t\tnotif = new Notification(args);\n\t\t\tnotifications.push(notif);\n\n\t\t\t//If we have a timeout value\n\t\t\tif (args.timeout > 0) {\n\t\t\t\tnotif.timer = setTimeout(function() {\n\t\t\t\t\tnotif.close();\n\t\t\t\t}, args.timeout);\n\t\t\t}\n\n\t\t\tnotif.on('close', function() {\n\t\t\t\tvar i = notifications.length;\n\n\t\t\t\tif (notif.timer) {\n\t\t\t\t\teditor.getWin().clearTimeout(notif.timer);\n\t\t\t\t}\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tif (notifications[i] === notif) {\n\t\t\t\t\t\tnotifications.splice(i, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tpositionNotifications();\n\t\t\t});\n\n\t\t\tnotif.renderTo();\n\n\t\t\tpositionNotifications();\n\n\t\t\treturn notif;\n\t\t};\n\n\t\t/**\n\t\t * Closes the top most notification.\n\t\t *\n\t\t * @method close\n\t\t */\n\t\tself.close = function() {\n\t\t\tif (getLastNotification()) {\n\t\t\t\tgetLastNotification().close();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Returns the currently opened notification objects.\n\t\t *\n\t\t * @method getNotifications\n\t\t * @return {Array} Array of the currently opened notifications.\n\t\t */\n\t\tself.getNotifications = function() {\n\t\t\treturn notifications;\n\t\t};\n\n\t\teditor.on('SkinLoaded', function() {\n\t\t\tvar serviceMessage = editor.settings.service_message;\n\n\t\t\tif (serviceMessage) {\n\t\t\t\teditor.notificationManager.open({\n\t\t\t\t\ttext: serviceMessage,\n\t\t\t\t\ttype: 'warning',\n\t\t\t\t\ttimeout: 0,\n\t\t\t\t\ticon: ''\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t//self.positionNotifications = positionNotifications;\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/NodePath.js\n\n/**\n * NodePath.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Handles paths of nodes within an element.\n *\n * @private\n * @class tinymce.dom.NodePath\n */\ndefine(\"tinymce/dom/NodePath\", [\n\t\"tinymce/dom/DOMUtils\"\n], function(DOMUtils) {\n\tfunction create(rootNode, targetNode, normalized) {\n\t\tvar path = [];\n\n\t\tfor (; targetNode && targetNode != rootNode; targetNode = targetNode.parentNode) {\n\t\t\tpath.push(DOMUtils.nodeIndex(targetNode, normalized));\n\t\t}\n\n\t\treturn path;\n\t}\n\n\tfunction resolve(rootNode, path) {\n\t\tvar i, node, children;\n\n\t\tfor (node = rootNode, i = path.length - 1; i >= 0; i--) {\n\t\t\tchildren = node.childNodes;\n\n\t\t\tif (path[i] > children.length - 1) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tnode = children[path[i]];\n\t\t}\n\n\t\treturn node;\n\t}\n\n\treturn {\n\t\tcreate: create,\n\t\tresolve: resolve\n\t};\n});\n\n// Included from: js/tinymce/classes/util/Quirks.js\n\n/**\n * Quirks.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n *\n * @ignore-file\n */\n\n/**\n * This file includes fixes for various browser quirks it's made to make it easy to add/remove browser specific fixes.\n *\n * @private\n * @class tinymce.util.Quirks\n */\ndefine(\"tinymce/util/Quirks\", [\n\t\"tinymce/util/VK\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/dom/TreeWalker\",\n\t\"tinymce/dom/NodePath\",\n\t\"tinymce/html/Node\",\n\t\"tinymce/html/Entities\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/caret/CaretWalker\"\n], function(VK, RangeUtils, TreeWalker, NodePath, Node, Entities, Env, Tools, Delay, CaretContainer, CaretPosition, CaretWalker) {\n\treturn function(editor) {\n\t\tvar each = Tools.each, $ = editor.$;\n\t\tvar BACKSPACE = VK.BACKSPACE, DELETE = VK.DELETE, dom = editor.dom, selection = editor.selection,\n\t\t\tsettings = editor.settings, parser = editor.parser, serializer = editor.serializer;\n\t\tvar isGecko = Env.gecko, isIE = Env.ie, isWebKit = Env.webkit;\n\t\tvar mceInternalUrlPrefix = 'data:text/mce-internal,';\n\t\tvar mceInternalDataType = isIE ? 'Text' : 'URL';\n\n\t\t/**\n\t\t * Executes a command with a specific state this can be to enable/disable browser editing features.\n\t\t */\n\t\tfunction setEditorCommandState(cmd, state) {\n\t\t\ttry {\n\t\t\t\teditor.getDoc().execCommand(cmd, false, state);\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Returns current IE document mode.\n\t\t */\n\t\tfunction getDocumentMode() {\n\t\t\tvar documentMode = editor.getDoc().documentMode;\n\n\t\t\treturn documentMode ? documentMode : 6;\n\t\t}\n\n\t\t/**\n\t\t * Returns true/false if the event is prevented or not.\n\t\t *\n\t\t * @private\n\t\t * @param {Event} e Event object.\n\t\t * @return {Boolean} true/false if the event is prevented or not.\n\t\t */\n\t\tfunction isDefaultPrevented(e) {\n\t\t\treturn e.isDefaultPrevented();\n\t\t}\n\n\t\t/**\n\t\t * Sets Text/URL data on the event's dataTransfer object to a special data:text/mce-internal url.\n\t\t * This is to workaround the inability to set custom contentType on IE and Safari.\n\t\t * The editor's selected content is encoded into this url so drag and drop between editors will work.\n\t\t *\n\t\t * @private\n\t\t * @param {DragEvent} e Event object\n\t\t */\n\t\tfunction setMceInternalContent(e) {\n\t\t\tvar selectionHtml, internalContent;\n\n\t\t\tif (e.dataTransfer) {\n\t\t\t\tif (editor.selection.isCollapsed() && e.target.tagName == 'IMG') {\n\t\t\t\t\tselection.select(e.target);\n\t\t\t\t}\n\n\t\t\t\tselectionHtml = editor.selection.getContent();\n\n\t\t\t\t// Safari/IE doesn't support custom dataTransfer items so we can only use URL and Text\n\t\t\t\tif (selectionHtml.length > 0) {\n\t\t\t\t\tinternalContent = mceInternalUrlPrefix + escape(editor.id) + ',' + escape(selectionHtml);\n\t\t\t\t\te.dataTransfer.setData(mceInternalDataType, internalContent);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Gets content of special data:text/mce-internal url on the event's dataTransfer object.\n\t\t * This is to workaround the inability to set custom contentType on IE and Safari.\n\t\t * The editor's selected content is encoded into this url so drag and drop between editors will work.\n\t\t *\n\t\t * @private\n\t\t * @param {DragEvent} e Event object\n\t\t * @returns {String} mce-internal content\n\t\t */\n\t\tfunction getMceInternalContent(e) {\n\t\t\tvar internalContent;\n\n\t\t\tif (e.dataTransfer) {\n\t\t\t\tinternalContent = e.dataTransfer.getData(mceInternalDataType);\n\n\t\t\t\tif (internalContent && internalContent.indexOf(mceInternalUrlPrefix) >= 0) {\n\t\t\t\t\tinternalContent = internalContent.substr(mceInternalUrlPrefix.length).split(',');\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: unescape(internalContent[0]),\n\t\t\t\t\t\thtml: unescape(internalContent[1])\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\t/**\n\t\t * Inserts contents using the paste clipboard command if it's available if it isn't it will fallback\n\t\t * to the core command.\n\t\t *\n\t\t * @private\n\t\t * @param {String} content Content to insert at selection.\n\t\t */\n\t\tfunction insertClipboardContents(content) {\n\t\t\tif (editor.queryCommandSupported('mceInsertClipboardContent')) {\n\t\t\t\teditor.execCommand('mceInsertClipboardContent', false, {content: content});\n\t\t\t} else {\n\t\t\t\teditor.execCommand('mceInsertContent', false, content);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Fixes a WebKit bug when deleting contents using backspace or delete key.\n\t\t * WebKit will produce a span element if you delete across two block elements.\n\t\t *\n\t\t * Example:\n\t\t * <h1>a</h1><p>|b</p>\n\t\t *\n\t\t * Will produce this on backspace:\n\t\t * <h1>a<span style=\"<all runtime styles>\">b</span></p>\n\t\t *\n\t\t * This fixes the backspace to produce:\n\t\t * <h1>a|b</p>\n\t\t *\n\t\t * See bug: https://bugs.webkit.org/show_bug.cgi?id=45784\n\t\t *\n\t\t * This fixes the following delete scenarios:\n\t\t *  1. Delete by pressing backspace key.\n\t\t *  2. Delete by pressing delete key.\n\t\t *  3. Delete by pressing backspace key with ctrl/cmd (Word delete).\n\t\t *  4. Delete by pressing delete key with ctrl/cmd (Word delete).\n\t\t *  5. Delete by drag/dropping contents inside the editor.\n\t\t *  6. Delete by using Cut Ctrl+X/Cmd+X.\n\t\t *  7. Delete by selecting contents and writing a character.\n\t\t *\n\t\t * This code is a ugly hack since writing full custom delete logic for just this bug\n\t\t * fix seemed like a huge task. I hope we can remove this before the year 2030.\n\t\t */\n\t\tfunction cleanupStylesWhenDeleting() {\n\t\t\tvar doc = editor.getDoc(), dom = editor.dom, selection = editor.selection;\n\t\t\tvar MutationObserver = window.MutationObserver, olderWebKit, dragStartRng;\n\n\t\t\t// Add mini polyfill for older WebKits\n\t\t\t// TODO: Remove this when old Safari versions gets updated\n\t\t\tif (!MutationObserver) {\n\t\t\t\tolderWebKit = true;\n\n\t\t\t\tMutationObserver = function() {\n\t\t\t\t\tvar records = [], target;\n\n\t\t\t\t\tfunction nodeInsert(e) {\n\t\t\t\t\t\tvar target = e.relatedNode || e.target;\n\t\t\t\t\t\trecords.push({target: target, addedNodes: [target]});\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction attrModified(e) {\n\t\t\t\t\t\tvar target = e.relatedNode || e.target;\n\t\t\t\t\t\trecords.push({target: target, attributeName: e.attrName});\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observe = function(node) {\n\t\t\t\t\t\ttarget = node;\n\t\t\t\t\t\ttarget.addEventListener('DOMSubtreeModified', nodeInsert, false);\n\t\t\t\t\t\ttarget.addEventListener('DOMNodeInsertedIntoDocument', nodeInsert, false);\n\t\t\t\t\t\ttarget.addEventListener('DOMNodeInserted', nodeInsert, false);\n\t\t\t\t\t\ttarget.addEventListener('DOMAttrModified', attrModified, false);\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.disconnect = function() {\n\t\t\t\t\t\ttarget.removeEventListener('DOMSubtreeModified', nodeInsert, false);\n\t\t\t\t\t\ttarget.removeEventListener('DOMNodeInsertedIntoDocument', nodeInsert, false);\n\t\t\t\t\t\ttarget.removeEventListener('DOMNodeInserted', nodeInsert, false);\n\t\t\t\t\t\ttarget.removeEventListener('DOMAttrModified', attrModified, false);\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.takeRecords = function() {\n\t\t\t\t\t\treturn records;\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tfunction isTrailingBr(node) {\n\t\t\t\tvar blockElements = dom.schema.getBlockElements(), rootNode = editor.getBody();\n\n\t\t\t\tif (node.nodeName != 'BR') {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tfor (; node != rootNode && !blockElements[node.nodeName]; node = node.parentNode) {\n\t\t\t\t\tif (node.nextSibling) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tfunction isSiblingsIgnoreWhiteSpace(node1, node2) {\n\t\t\t\tvar node;\n\n\t\t\t\tfor (node = node1.nextSibling; node && node != node2; node = node.nextSibling) {\n\t\t\t\t\tif (node.nodeType == 3 && $.trim(node.data).length === 0) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node !== node2) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node === node2;\n\t\t\t}\n\n\t\t\tfunction findCaretNode(node, forward, startNode) {\n\t\t\t\tvar walker, current, nonEmptyElements;\n\n\t\t\t\tnonEmptyElements = dom.schema.getNonEmptyElements();\n\n\t\t\t\twalker = new TreeWalker(startNode || node, node);\n\n\t\t\t\twhile ((current = walker[forward ? 'next' : 'prev']())) {\n\t\t\t\t\tif (nonEmptyElements[current.nodeName] && !isTrailingBr(current)) {\n\t\t\t\t\t\treturn current;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (current.nodeType == 3 && current.data.length > 0) {\n\t\t\t\t\t\treturn current;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction deleteRangeBetweenTextBlocks(rng) {\n\t\t\t\tvar startBlock, endBlock, caretNodeBefore, caretNodeAfter, textBlockElements;\n\n\t\t\t\tif (rng.collapsed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstartBlock = dom.getParent(RangeUtils.getNode(rng.startContainer, rng.startOffset), dom.isBlock);\n\t\t\t\tendBlock = dom.getParent(RangeUtils.getNode(rng.endContainer, rng.endOffset), dom.isBlock);\n\t\t\t\ttextBlockElements = editor.schema.getTextBlockElements();\n\n\t\t\t\tif (startBlock == endBlock) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!textBlockElements[startBlock.nodeName] || !textBlockElements[endBlock.nodeName]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (dom.getContentEditable(startBlock) === \"false\" || dom.getContentEditable(endBlock) === \"false\") {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\trng.deleteContents();\n\n\t\t\t\tcaretNodeBefore = findCaretNode(startBlock, false);\n\t\t\t\tcaretNodeAfter = findCaretNode(endBlock, true);\n\n\t\t\t\tif (!dom.isEmpty(endBlock)) {\n\t\t\t\t\t$(startBlock).append(endBlock.childNodes);\n\t\t\t\t}\n\n\t\t\t\t$(endBlock).remove();\n\n\t\t\t\tif (caretNodeBefore) {\n\t\t\t\t\tif (caretNodeBefore.nodeType == 1) {\n\t\t\t\t\t\tif (caretNodeBefore.nodeName == \"BR\") {\n\t\t\t\t\t\t\trng.setStartBefore(caretNodeBefore);\n\t\t\t\t\t\t\trng.setEndBefore(caretNodeBefore);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setStartAfter(caretNodeBefore);\n\t\t\t\t\t\t\trng.setEndAfter(caretNodeBefore);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setStart(caretNodeBefore, caretNodeBefore.data.length);\n\t\t\t\t\t\trng.setEnd(caretNodeBefore, caretNodeBefore.data.length);\n\t\t\t\t\t}\n\t\t\t\t} else if (caretNodeAfter) {\n\t\t\t\t\tif (caretNodeAfter.nodeType == 1) {\n\t\t\t\t\t\trng.setStartBefore(caretNodeAfter);\n\t\t\t\t\t\trng.setEndBefore(caretNodeAfter);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trng.setStart(caretNodeAfter, 0);\n\t\t\t\t\t\trng.setEnd(caretNodeAfter, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tselection.setRng(rng);\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tfunction expandBetweenBlocks(rng, isForward) {\n\t\t\t\tvar caretNode, targetCaretNode, textBlock, targetTextBlock, container, offset;\n\n\t\t\t\tif (!rng.collapsed) {\n\t\t\t\t\treturn rng;\n\t\t\t\t}\n\n\t\t\t\tcontainer = rng.startContainer;\n\t\t\t\toffset = rng.startOffset;\n\n\t\t\t\tif (container.nodeType == 3) {\n\t\t\t\t\tif (isForward) {\n\t\t\t\t\t\tif (offset < container.data.length) {\n\t\t\t\t\t\t\treturn rng;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (offset > 0) {\n\t\t\t\t\t\t\treturn rng;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcaretNode = RangeUtils.getNode(rng.startContainer, rng.startOffset);\n\t\t\t\ttextBlock = dom.getParent(caretNode, dom.isBlock);\n\t\t\t\ttargetCaretNode = findCaretNode(editor.getBody(), isForward, caretNode);\n\t\t\t\ttargetTextBlock = dom.getParent(targetCaretNode, dom.isBlock);\n\n\t\t\t\tif (!caretNode || !targetCaretNode) {\n\t\t\t\t\treturn rng;\n\t\t\t\t}\n\n\t\t\t\tif (targetTextBlock && textBlock != targetTextBlock) {\n\t\t\t\t\tif (!isForward) {\n\t\t\t\t\t\tif (!isSiblingsIgnoreWhiteSpace(targetTextBlock, textBlock)) {\n\t\t\t\t\t\t\treturn rng;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (targetCaretNode.nodeType == 1) {\n\t\t\t\t\t\t\tif (targetCaretNode.nodeName == \"BR\") {\n\t\t\t\t\t\t\t\trng.setStartBefore(targetCaretNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trng.setStartAfter(targetCaretNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setStart(targetCaretNode, targetCaretNode.data.length);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (caretNode.nodeType == 1) {\n\t\t\t\t\t\t\trng.setEnd(caretNode, 0);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setEndBefore(caretNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!isSiblingsIgnoreWhiteSpace(textBlock, targetTextBlock)) {\n\t\t\t\t\t\t\treturn rng;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (caretNode.nodeType == 1) {\n\t\t\t\t\t\t\tif (caretNode.nodeName == \"BR\") {\n\t\t\t\t\t\t\t\trng.setStartBefore(caretNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trng.setStartAfter(caretNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setStart(caretNode, caretNode.data.length);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (targetCaretNode.nodeType == 1) {\n\t\t\t\t\t\t\trng.setEnd(targetCaretNode, 0);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.setEndBefore(targetCaretNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\tfunction handleTextBlockMergeDelete(isForward) {\n\t\t\t\tvar rng = selection.getRng();\n\n\t\t\t\trng = expandBetweenBlocks(rng, isForward);\n\n\t\t\t\tif (deleteRangeBetweenTextBlocks(rng)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * This retains the formatting if the last character is to be deleted.\n\t\t\t *\n\t\t\t * Backspace on this: <p><b><i>a|</i></b></p> would become <p>|</p> in WebKit.\n\t\t\t * With this patch: <p><b><i>|<br></i></b></p>\n\t\t\t */\n\t\t\tfunction handleLastBlockCharacterDelete(isForward, rng) {\n\t\t\t\tvar path, blockElm, newBlockElm, clonedBlockElm, sibling,\n\t\t\t\t\tcontainer, offset, br, currentFormatNodes;\n\n\t\t\t\tfunction cloneTextBlockWithFormats(blockElm, node) {\n\t\t\t\t\tcurrentFormatNodes = $(node).parents().filter(function(idx, node) {\n\t\t\t\t\t\treturn !!editor.schema.getTextInlineElements()[node.nodeName];\n\t\t\t\t\t});\n\n\t\t\t\t\tnewBlockElm = blockElm.cloneNode(false);\n\n\t\t\t\t\tcurrentFormatNodes = Tools.map(currentFormatNodes, function(formatNode) {\n\t\t\t\t\t\tformatNode = formatNode.cloneNode(false);\n\n\t\t\t\t\t\tif (newBlockElm.hasChildNodes()) {\n\t\t\t\t\t\t\tformatNode.appendChild(newBlockElm.firstChild);\n\t\t\t\t\t\t\tnewBlockElm.appendChild(formatNode);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnewBlockElm.appendChild(formatNode);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnewBlockElm.appendChild(formatNode);\n\n\t\t\t\t\t\treturn formatNode;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (currentFormatNodes.length) {\n\t\t\t\t\t\tbr = dom.create('br');\n\t\t\t\t\t\tcurrentFormatNodes[0].appendChild(br);\n\t\t\t\t\t\tdom.replace(newBlockElm, blockElm);\n\n\t\t\t\t\t\trng.setStartBefore(br);\n\t\t\t\t\t\trng.setEndBefore(br);\n\t\t\t\t\t\teditor.selection.setRng(rng);\n\n\t\t\t\t\t\treturn br;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tfunction isTextBlock(node) {\n\t\t\t\t\treturn node && editor.schema.getTextBlockElements()[node.tagName];\n\t\t\t\t}\n\n\t\t\t\tif (!rng.collapsed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcontainer = rng.startContainer;\n\t\t\t\toffset = rng.startOffset;\n\t\t\t\tblockElm = dom.getParent(container, dom.isBlock);\n\t\t\t\tif (!isTextBlock(blockElm)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (container.nodeType == 1) {\n\t\t\t\t\tcontainer = container.childNodes[offset];\n\t\t\t\t\tif (container && container.tagName != 'BR') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isForward) {\n\t\t\t\t\t\tsibling = blockElm.nextSibling;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsibling = blockElm.previousSibling;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dom.isEmpty(blockElm) && isTextBlock(sibling) && dom.isEmpty(sibling)) {\n\t\t\t\t\t\tif (cloneTextBlockWithFormats(blockElm, container)) {\n\t\t\t\t\t\t\tdom.remove(sibling);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (container.nodeType == 3) {\n\t\t\t\t\tpath = NodePath.create(blockElm, container);\n\t\t\t\t\tclonedBlockElm = blockElm.cloneNode(true);\n\t\t\t\t\tcontainer = NodePath.resolve(clonedBlockElm, path);\n\n\t\t\t\t\tif (isForward) {\n\t\t\t\t\t\tif (offset >= container.data.length) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcontainer.deleteData(offset, 1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (offset <= 0) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcontainer.deleteData(offset - 1, 1);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dom.isEmpty(clonedBlockElm)) {\n\t\t\t\t\t\treturn cloneTextBlockWithFormats(blockElm, container);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction customDelete(isForward) {\n\t\t\t\tvar mutationObserver, rng, caretElement;\n\n\t\t\t\tif (handleTextBlockMergeDelete(isForward)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tTools.each(editor.getBody().getElementsByTagName('*'), function(elm) {\n\t\t\t\t\t// Mark existing spans\n\t\t\t\t\tif (elm.tagName == 'SPAN') {\n\t\t\t\t\t\telm.setAttribute('mce-data-marked', 1);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Make sure all elements has a data-mce-style attribute\n\t\t\t\t\tif (!elm.hasAttribute('data-mce-style') && elm.hasAttribute('style')) {\n\t\t\t\t\t\teditor.dom.setAttrib(elm, 'style', editor.dom.getAttrib(elm, 'style'));\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Observe added nodes and style attribute changes\n\t\t\t\tmutationObserver = new MutationObserver(function() {});\n\t\t\t\tmutationObserver.observe(editor.getDoc(), {\n\t\t\t\t\tchildList: true,\n\t\t\t\t\tattributes: true,\n\t\t\t\t\tsubtree: true,\n\t\t\t\t\tattributeFilter: ['style']\n\t\t\t\t});\n\n\t\t\t\teditor.getDoc().execCommand(isForward ? 'ForwardDelete' : 'Delete', false, null);\n\n\t\t\t\trng = editor.selection.getRng();\n\t\t\t\tcaretElement = rng.startContainer.parentNode;\n\n\t\t\t\tTools.each(mutationObserver.takeRecords(), function(record) {\n\t\t\t\t\tif (!dom.isChildOf(record.target, editor.getBody())) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Restore style attribute to previous value\n\t\t\t\t\tif (record.attributeName == \"style\") {\n\t\t\t\t\t\tvar oldValue = record.target.getAttribute('data-mce-style');\n\n\t\t\t\t\t\tif (oldValue) {\n\t\t\t\t\t\t\trecord.target.setAttribute(\"style\", oldValue);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trecord.target.removeAttribute(\"style\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove all spans that aren't marked and retain selection\n\t\t\t\t\tTools.each(record.addedNodes, function(node) {\n\t\t\t\t\t\tif (node.nodeName == \"SPAN\" && !node.getAttribute('mce-data-marked')) {\n\t\t\t\t\t\t\tvar offset, container;\n\n\t\t\t\t\t\t\tif (node == caretElement) {\n\t\t\t\t\t\t\t\toffset = rng.startOffset;\n\t\t\t\t\t\t\t\tcontainer = node.firstChild;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdom.remove(node, true);\n\n\t\t\t\t\t\t\tif (container) {\n\t\t\t\t\t\t\t\trng.setStart(container, offset);\n\t\t\t\t\t\t\t\trng.setEnd(container, offset);\n\t\t\t\t\t\t\t\teditor.selection.setRng(rng);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tmutationObserver.disconnect();\n\n\t\t\t\t// Remove any left over marks\n\t\t\t\tTools.each(editor.dom.select('span[mce-data-marked]'), function(span) {\n\t\t\t\t\tspan.removeAttribute('mce-data-marked');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tvar isForward = e.keyCode == DELETE, isMetaOrCtrl = e.ctrlKey || e.metaKey;\n\n\t\t\t\tif (!isDefaultPrevented(e) && (isForward || e.keyCode == BACKSPACE)) {\n\t\t\t\t\tvar rng = editor.selection.getRng(), container = rng.startContainer, offset = rng.startOffset;\n\n\t\t\t\t\t// Shift+Delete is cut\n\t\t\t\t\tif (isForward && e.shiftKey) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (handleLastBlockCharacterDelete(isForward, rng)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Ignore non meta delete in the where there is text before/after the caret\n\t\t\t\t\tif (!isMetaOrCtrl && rng.collapsed && container.nodeType == 3) {\n\t\t\t\t\t\tif (isForward ? offset < container.data.length : offset > 0) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tif (isMetaOrCtrl) {\n\t\t\t\t\t\teditor.selection.getSel().modify(\"extend\", isForward ? \"forward\" : \"backward\", e.metaKey ? \"lineboundary\" : \"word\");\n\t\t\t\t\t}\n\n\t\t\t\t\tcustomDelete(isForward);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Handle case where text is deleted by typing over\n\t\t\teditor.on('keypress', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e) && !selection.isCollapsed() && e.charCode > 31 && !VK.metaKeyPressed(e)) {\n\t\t\t\t\tvar rng, currentFormatNodes, fragmentNode, blockParent, caretNode, charText;\n\n\t\t\t\t\trng = editor.selection.getRng();\n\t\t\t\t\tcharText = String.fromCharCode(e.charCode);\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t// Keep track of current format nodes\n\t\t\t\t\tcurrentFormatNodes = $(rng.startContainer).parents().filter(function(idx, node) {\n\t\t\t\t\t\treturn !!editor.schema.getTextInlineElements()[node.nodeName];\n\t\t\t\t\t});\n\n\t\t\t\t\tcustomDelete(true);\n\n\t\t\t\t\t// Check if the browser removed them\n\t\t\t\t\tcurrentFormatNodes = currentFormatNodes.filter(function(idx, node) {\n\t\t\t\t\t\treturn !$.contains(editor.getBody(), node);\n\t\t\t\t\t});\n\n\t\t\t\t\t// Then re-add them\n\t\t\t\t\tif (currentFormatNodes.length) {\n\t\t\t\t\t\tfragmentNode = dom.createFragment();\n\n\t\t\t\t\t\tcurrentFormatNodes.each(function(idx, formatNode) {\n\t\t\t\t\t\t\tformatNode = formatNode.cloneNode(false);\n\n\t\t\t\t\t\t\tif (fragmentNode.hasChildNodes()) {\n\t\t\t\t\t\t\t\tformatNode.appendChild(fragmentNode.firstChild);\n\t\t\t\t\t\t\t\tfragmentNode.appendChild(formatNode);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcaretNode = formatNode;\n\t\t\t\t\t\t\t\tfragmentNode.appendChild(formatNode);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfragmentNode.appendChild(formatNode);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tcaretNode.appendChild(editor.getDoc().createTextNode(charText));\n\n\t\t\t\t\t\t// Prevent edge case where older WebKit would add an extra BR element\n\t\t\t\t\t\tblockParent = dom.getParent(rng.startContainer, dom.isBlock);\n\t\t\t\t\t\tif (dom.isEmpty(blockParent)) {\n\t\t\t\t\t\t\t$(blockParent).empty().append(fragmentNode);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trng.insertNode(fragmentNode);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\trng.setStart(caretNode.firstChild, 1);\n\t\t\t\t\t\trng.setEnd(caretNode.firstChild, 1);\n\t\t\t\t\t\teditor.selection.setRng(rng);\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.selection.setContent(charText);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.addCommand('Delete', function() {\n\t\t\t\tcustomDelete();\n\t\t\t});\n\n\t\t\teditor.addCommand('ForwardDelete', function() {\n\t\t\t\tcustomDelete(true);\n\t\t\t});\n\n\t\t\t// Older WebKits doesn't properly handle the clipboard so we can't add the rest\n\t\t\tif (olderWebKit) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\teditor.on('dragstart', function(e) {\n\t\t\t\tdragStartRng = selection.getRng();\n\t\t\t\tsetMceInternalContent(e);\n\t\t\t});\n\n\t\t\teditor.on('drop', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e)) {\n\t\t\t\t\tvar internalContent = getMceInternalContent(e);\n\n\t\t\t\t\tif (internalContent) {\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t// Safari has a weird issue where drag/dropping images sometimes\n\t\t\t\t\t\t// produces a green plus icon. When this happens the caretRangeFromPoint\n\t\t\t\t\t\t// will return \"null\" even though the x, y coordinate is correct.\n\t\t\t\t\t\t// But if we detach the insert from the drop event we will get a proper range\n\t\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\t\tvar pointRng = RangeUtils.getCaretRangeFromPoint(e.x, e.y, doc);\n\n\t\t\t\t\t\t\tif (dragStartRng) {\n\t\t\t\t\t\t\t\tselection.setRng(dragStartRng);\n\t\t\t\t\t\t\t\tdragStartRng = null;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcustomDelete();\n\t\t\t\t\t\t\tselection.setRng(pointRng);\n\t\t\t\t\t\t\tinsertClipboardContents(internalContent.html);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('cut', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e) && e.clipboardData && !editor.selection.isCollapsed()) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.clipboardData.clearData();\n\t\t\t\t\te.clipboardData.setData('text/html', editor.selection.getContent());\n\t\t\t\t\te.clipboardData.setData('text/plain', editor.selection.getContent({format: 'text'}));\n\n\t\t\t\t\t// Needed delay for https://code.google.com/p/chromium/issues/detail?id=363288#c3\n\t\t\t\t\t// Nested delete/forwardDelete not allowed on execCommand(\"cut\")\n\t\t\t\t\t// This is ugly but not sure how to work around it otherwise\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\tcustomDelete(true);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Makes sure that the editor body becomes empty when backspace or delete is pressed in empty editors.\n\t\t *\n\t\t * For example:\n\t\t * <p><b>|</b></p>\n\t\t *\n\t\t * Or:\n\t\t * <h1>|</h1>\n\t\t *\n\t\t * Or:\n\t\t * [<h1></h1>]\n\t\t */\n\t\tfunction emptyEditorWhenDeleting() {\n\t\t\tfunction serializeRng(rng) {\n\t\t\t\tvar body = dom.create(\"body\");\n\t\t\t\tvar contents = rng.cloneContents();\n\t\t\t\tbody.appendChild(contents);\n\t\t\t\treturn selection.serializer.serialize(body, {format: 'html'});\n\t\t\t}\n\n\t\t\tfunction allContentsSelected(rng) {\n\t\t\t\tif (!rng.setStart) {\n\t\t\t\t\tif (rng.item) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar bodyRng = rng.duplicate();\n\t\t\t\t\tbodyRng.moveToElementText(editor.getBody());\n\t\t\t\t\treturn RangeUtils.compareRanges(rng, bodyRng);\n\t\t\t\t}\n\n\t\t\t\tvar selection = serializeRng(rng);\n\n\t\t\t\tvar allRng = dom.createRng();\n\t\t\t\tallRng.selectNode(editor.getBody());\n\n\t\t\t\tvar allSelection = serializeRng(allRng);\n\t\t\t\treturn selection === allSelection;\n\t\t\t}\n\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tvar keyCode = e.keyCode, isCollapsed, body;\n\n\t\t\t\t// Empty the editor if it's needed for example backspace at <p><b>|</b></p>\n\t\t\t\tif (!isDefaultPrevented(e) && (keyCode == DELETE || keyCode == BACKSPACE)) {\n\t\t\t\t\tisCollapsed = editor.selection.isCollapsed();\n\t\t\t\t\tbody = editor.getBody();\n\n\t\t\t\t\t// Selection is collapsed but the editor isn't empty\n\t\t\t\t\tif (isCollapsed && !dom.isEmpty(body)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Selection isn't collapsed but not all the contents is selected\n\t\t\t\t\tif (!isCollapsed && !allContentsSelected(editor.selection.getRng())) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Manually empty the editor\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\teditor.setContent('');\n\n\t\t\t\t\tif (body.firstChild && dom.isBlock(body.firstChild)) {\n\t\t\t\t\t\teditor.selection.setCursorLocation(body.firstChild, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.selection.setCursorLocation(body, 0);\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * WebKit doesn't select all the nodes in the body when you press Ctrl+A.\n\t\t * IE selects more than the contents <body>[<p>a</p>]</body> instead of <body><p>[a]</p]</body> see bug #6438\n\t\t * This selects the whole body so that backspace/delete logic will delete everything\n\t\t */\n\t\tfunction selectAll() {\n\t\t\teditor.shortcuts.add('meta+a', null, 'SelectAll');\n\t\t}\n\n\t\t/**\n\t\t * WebKit has a weird issue where it some times fails to properly convert keypresses to input method keystrokes.\n\t\t * The IME on Mac doesn't initialize when it doesn't fire a proper focus event.\n\t\t *\n\t\t * This seems to happen when the user manages to click the documentElement element then the window doesn't get proper focus until\n\t\t * you enter a character into the editor.\n\t\t *\n\t\t * It also happens when the first focus in made to the body.\n\t\t *\n\t\t * See: https://bugs.webkit.org/show_bug.cgi?id=83566\n\t\t */\n\t\tfunction inputMethodFocus() {\n\t\t\tif (!editor.settings.content_editable) {\n\t\t\t\t// Case 1 IME doesn't initialize if you focus the document\n\t\t\t\t// Disabled since it was interferring with the cE=false logic\n\t\t\t\t// Also coultn't reproduce the issue on Safari 9\n\t\t\t\t/*dom.bind(editor.getDoc(), 'focusin', function() {\n\t\t\t\t\tselection.setRng(selection.getRng());\n\t\t\t\t});*/\n\n\t\t\t\t// Case 2 IME doesn't initialize if you click the documentElement it also doesn't properly fire the focusin event\n\t\t\t\t// Needs to be both down/up due to weird rendering bug on Chrome Windows\n\t\t\t\tdom.bind(editor.getDoc(), 'mousedown mouseup', function(e) {\n\t\t\t\t\tvar rng;\n\n\t\t\t\t\tif (e.target == editor.getDoc().documentElement) {\n\t\t\t\t\t\trng = selection.getRng();\n\t\t\t\t\t\teditor.getBody().focus();\n\n\t\t\t\t\t\tif (e.type == 'mousedown') {\n\t\t\t\t\t\t\tif (CaretContainer.isCaretContainer(rng.startContainer)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Edge case for mousedown, drag select and mousedown again within selection on Chrome Windows to render caret\n\t\t\t\t\t\t\tselection.placeCaretAt(e.clientX, e.clientY);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Backspacing in FireFox/IE from a paragraph into a horizontal rule results in a floating text node because the\n\t\t * browser just deletes the paragraph - the browser fails to merge the text node with a horizontal rule so it is\n\t\t * left there. TinyMCE sees a floating text node and wraps it in a paragraph on the key up event (ForceBlocks.js\n\t\t * addRootBlocks), meaning the action does nothing. With this code, FireFox/IE matche the behaviour of other\n\t\t * browsers.\n\t\t *\n\t\t * It also fixes a bug on Firefox where it's impossible to delete HR elements.\n\t\t */\n\t\tfunction removeHrOnBackspace() {\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n\t\t\t\t\t// Check if there is any HR elements this is faster since getRng on IE 7 & 8 is slow\n\t\t\t\t\tif (!editor.getBody().getElementsByTagName('hr').length) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (selection.isCollapsed() && selection.getRng(true).startOffset === 0) {\n\t\t\t\t\t\tvar node = selection.getNode();\n\t\t\t\t\t\tvar previousSibling = node.previousSibling;\n\n\t\t\t\t\t\tif (node.nodeName == 'HR') {\n\t\t\t\t\t\t\tdom.remove(node);\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === \"hr\") {\n\t\t\t\t\t\t\tdom.remove(previousSibling);\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Firefox 3.x has an issue where the body element won't get proper focus if you click out\n\t\t * side it's rectangle.\n\t\t */\n\t\tfunction focusBody() {\n\t\t\t// Fix for a focus bug in FF 3.x where the body element\n\t\t\t// wouldn't get proper focus if the user clicked on the HTML element\n\t\t\tif (!window.Range.prototype.getClientRects) { // Detect getClientRects got introduced in FF 4\n\t\t\t\teditor.on('mousedown', function(e) {\n\t\t\t\t\tif (!isDefaultPrevented(e) && e.target.nodeName === \"HTML\") {\n\t\t\t\t\t\tvar body = editor.getBody();\n\n\t\t\t\t\t\t// Blur the body it's focused but not correctly focused\n\t\t\t\t\t\tbody.blur();\n\n\t\t\t\t\t\t// Refocus the body after a little while\n\t\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\t\tbody.focus();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * WebKit has a bug where it isn't possible to select image, hr or anchor elements\n\t\t * by clicking on them so we need to fake that.\n\t\t */\n\t\tfunction selectControlElements() {\n\t\t\teditor.on('click', function(e) {\n\t\t\t\tvar target = e.target;\n\n\t\t\t\t// Workaround for bug, http://bugs.webkit.org/show_bug.cgi?id=12250\n\t\t\t\t// WebKit can't even do simple things like selecting an image\n\t\t\t\t// Needs to be the setBaseAndExtend or it will fail to select floated images\n\t\t\t\tif (/^(IMG|HR)$/.test(target.nodeName) && dom.getContentEditableParent(target) !== \"false\") {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tselection.getSel().setBaseAndExtent(target, 0, target, 1);\n\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t}\n\n\t\t\t\tif (target.nodeName == 'A' && dom.hasClass(target, 'mce-item-anchor')) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tselection.select(target);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Fixes a Gecko bug where the style attribute gets added to the wrong element when deleting between two block elements.\n\t\t *\n\t\t * Fixes do backspace/delete on this:\n\t\t * <p>bla[ck</p><p style=\"color:red\">r]ed</p>\n\t\t *\n\t\t * Would become:\n\t\t * <p>bla|ed</p>\n\t\t *\n\t\t * Instead of:\n\t\t * <p style=\"color:red\">bla|ed</p>\n\t\t */\n\t\tfunction removeStylesWhenDeletingAcrossBlockElements() {\n\t\t\tfunction getAttributeApplyFunction() {\n\t\t\t\tvar template = dom.getAttribs(selection.getStart().cloneNode(false));\n\n\t\t\t\treturn function() {\n\t\t\t\t\tvar target = selection.getStart();\n\n\t\t\t\t\tif (target !== editor.getBody()) {\n\t\t\t\t\t\tdom.setAttrib(target, \"style\", null);\n\n\t\t\t\t\t\teach(template, function(attr) {\n\t\t\t\t\t\t\ttarget.setAttributeNode(attr.cloneNode(true));\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tfunction isSelectionAcrossElements() {\n\t\t\t\treturn !selection.isCollapsed() &&\n\t\t\t\t\tdom.getParent(selection.getStart(), dom.isBlock) != dom.getParent(selection.getEnd(), dom.isBlock);\n\t\t\t}\n\n\t\t\teditor.on('keypress', function(e) {\n\t\t\t\tvar applyAttributes;\n\n\t\t\t\tif (!isDefaultPrevented(e) && (e.keyCode == 8 || e.keyCode == 46) && isSelectionAcrossElements()) {\n\t\t\t\t\tapplyAttributes = getAttributeApplyFunction();\n\t\t\t\t\teditor.getDoc().execCommand('delete', false, null);\n\t\t\t\t\tapplyAttributes();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdom.bind(editor.getDoc(), 'cut', function(e) {\n\t\t\t\tvar applyAttributes;\n\n\t\t\t\tif (!isDefaultPrevented(e) && isSelectionAcrossElements()) {\n\t\t\t\t\tapplyAttributes = getAttributeApplyFunction();\n\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\tapplyAttributes();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Screen readers on IE needs to have the role application set on the body.\n\t\t */\n\t\tfunction ensureBodyHasRoleApplication() {\n\t\t\tdocument.body.setAttribute(\"role\", \"application\");\n\t\t}\n\n\t\t/**\n\t\t * Backspacing into a table behaves differently depending upon browser type.\n\t\t * Therefore, disable Backspace when cursor immediately follows a table.\n\t\t */\n\t\tfunction disableBackspaceIntoATable() {\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\n\t\t\t\t\tif (selection.isCollapsed() && selection.getRng(true).startOffset === 0) {\n\t\t\t\t\t\tvar previousSibling = selection.getNode().previousSibling;\n\t\t\t\t\t\tif (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === \"table\") {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Old IE versions can't properly render BR elements in PRE tags white in contentEditable mode. So this\n\t\t * logic adds a \\n before the BR so that it will get rendered.\n\t\t */\n\t\tfunction addNewLinesBeforeBrInPre() {\n\t\t\t// IE8+ rendering mode does the right thing with BR in PRE\n\t\t\tif (getDocumentMode() > 7) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Enable display: none in area and add a specific class that hides all BR elements in PRE to\n\t\t\t// avoid the caret from getting stuck at the BR elements while pressing the right arrow key\n\t\t\tsetEditorCommandState('RespectVisibilityInDesign', true);\n\t\t\teditor.contentStyles.push('.mceHideBrInPre pre br {display: none}');\n\t\t\tdom.addClass(editor.getBody(), 'mceHideBrInPre');\n\n\t\t\t// Adds a \\n before all BR elements in PRE to get them visual\n\t\t\tparser.addNodeFilter('pre', function(nodes) {\n\t\t\t\tvar i = nodes.length, brNodes, j, brElm, sibling;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tbrNodes = nodes[i].getAll('br');\n\t\t\t\t\tj = brNodes.length;\n\t\t\t\t\twhile (j--) {\n\t\t\t\t\t\tbrElm = brNodes[j];\n\n\t\t\t\t\t\t// Add \\n before BR in PRE elements on older IE:s so the new lines get rendered\n\t\t\t\t\t\tsibling = brElm.prev;\n\t\t\t\t\t\tif (sibling && sibling.type === 3 && sibling.value.charAt(sibling.value - 1) != '\\n') {\n\t\t\t\t\t\t\tsibling.value += '\\n';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbrElm.parent.insert(new Node('#text', 3), brElm, true).value = '\\n';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Removes any \\n before BR elements in PRE since other browsers and in contentEditable=false mode they will be visible\n\t\t\tserializer.addNodeFilter('pre', function(nodes) {\n\t\t\t\tvar i = nodes.length, brNodes, j, brElm, sibling;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tbrNodes = nodes[i].getAll('br');\n\t\t\t\t\tj = brNodes.length;\n\t\t\t\t\twhile (j--) {\n\t\t\t\t\t\tbrElm = brNodes[j];\n\t\t\t\t\t\tsibling = brElm.prev;\n\t\t\t\t\t\tif (sibling && sibling.type == 3) {\n\t\t\t\t\t\t\tsibling.value = sibling.value.replace(/\\r?\\n$/, '');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Moves style width/height to attribute width/height when the user resizes an image on IE.\n\t\t */\n\t\tfunction removePreSerializedStylesWhenSelectingControls() {\n\t\t\tdom.bind(editor.getBody(), 'mouseup', function() {\n\t\t\t\tvar value, node = selection.getNode();\n\n\t\t\t\t// Moved styles to attributes on IMG eements\n\t\t\t\tif (node.nodeName == 'IMG') {\n\t\t\t\t\t// Convert style width to width attribute\n\t\t\t\t\tif ((value = dom.getStyle(node, 'width'))) {\n\t\t\t\t\t\tdom.setAttrib(node, 'width', value.replace(/[^0-9%]+/g, ''));\n\t\t\t\t\t\tdom.setStyle(node, 'width', '');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert style height to height attribute\n\t\t\t\t\tif ((value = dom.getStyle(node, 'height'))) {\n\t\t\t\t\t\tdom.setAttrib(node, 'height', value.replace(/[^0-9%]+/g, ''));\n\t\t\t\t\t\tdom.setStyle(node, 'height', '');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Removes a blockquote when backspace is pressed at the beginning of it.\n\t\t *\n\t\t * For example:\n\t\t * <blockquote><p>|x</p></blockquote>\n\t\t *\n\t\t * Becomes:\n\t\t * <p>|x</p>\n\t\t */\n\t\tfunction removeBlockQuoteOnBackSpace() {\n\t\t\t// Add block quote deletion handler\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tvar rng, container, offset, root, parent;\n\n\t\t\t\tif (isDefaultPrevented(e) || e.keyCode != VK.BACKSPACE) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\trng = selection.getRng();\n\t\t\t\tcontainer = rng.startContainer;\n\t\t\t\toffset = rng.startOffset;\n\t\t\t\troot = dom.getRoot();\n\t\t\t\tparent = container;\n\n\t\t\t\tif (!rng.collapsed || offset !== 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twhile (parent && parent.parentNode && parent.parentNode.firstChild == parent && parent.parentNode != root) {\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\t// Is the cursor at the beginning of a blockquote?\n\t\t\t\tif (parent.tagName === 'BLOCKQUOTE') {\n\t\t\t\t\t// Remove the blockquote\n\t\t\t\t\teditor.formatter.toggle('blockquote', null, parent);\n\n\t\t\t\t\t// Move the caret to the beginning of container\n\t\t\t\t\trng = dom.createRng();\n\t\t\t\t\trng.setStart(container, 0);\n\t\t\t\t\trng.setEnd(container, 0);\n\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Sets various Gecko editing options on mouse down and before a execCommand to disable inline table editing that is broken etc.\n\t\t */\n\t\tfunction setGeckoEditingOptions() {\n\t\t\tfunction setOpts() {\n\t\t\t\trefreshContentEditable();\n\n\t\t\t\tsetEditorCommandState(\"StyleWithCSS\", false);\n\t\t\t\tsetEditorCommandState(\"enableInlineTableEditing\", false);\n\n\t\t\t\tif (!settings.object_resizing) {\n\t\t\t\t\tsetEditorCommandState(\"enableObjectResizing\", false);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!settings.readonly) {\n\t\t\t\teditor.on('BeforeExecCommand MouseDown', setOpts);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Fixes a gecko link bug, when a link is placed at the end of block elements there is\n\t\t * no way to move the caret behind the link. This fix adds a bogus br element after the link.\n\t\t *\n\t\t * For example this:\n\t\t * <p><b><a href=\"#\">x</a></b></p>\n\t\t *\n\t\t * Becomes this:\n\t\t * <p><b><a href=\"#\">x</a></b><br></p>\n\t\t */\n\t\tfunction addBrAfterLastLinks() {\n\t\t\tfunction fixLinks() {\n\t\t\t\teach(dom.select('a'), function(node) {\n\t\t\t\t\tvar parentNode = node.parentNode, root = dom.getRoot();\n\n\t\t\t\t\tif (parentNode.lastChild === node) {\n\t\t\t\t\t\twhile (parentNode && !dom.isBlock(parentNode)) {\n\t\t\t\t\t\t\tif (parentNode.parentNode.lastChild !== parentNode || parentNode === root) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tparentNode = parentNode.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdom.add(parentNode, 'br', {'data-mce-bogus': 1});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\teditor.on('SetContent ExecCommand', function(e) {\n\t\t\t\tif (e.type == \"setcontent\" || e.command === 'mceInsertLink') {\n\t\t\t\t\tfixLinks();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * WebKit will produce DIV elements here and there by default. But since TinyMCE uses paragraphs by\n\t\t * default we want to change that behavior.\n\t\t */\n\t\tfunction setDefaultBlockType() {\n\t\t\tif (settings.forced_root_block) {\n\t\t\t\teditor.on('init', function() {\n\t\t\t\t\tsetEditorCommandState('DefaultParagraphSeparator', settings.forced_root_block);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Deletes the selected image on IE instead of navigating to previous page.\n\t\t */\n\t\tfunction deleteControlItemOnBackSpace() {\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tvar rng;\n\n\t\t\t\tif (!isDefaultPrevented(e) && e.keyCode == BACKSPACE) {\n\t\t\t\t\trng = editor.getDoc().selection.createRange();\n\t\t\t\t\tif (rng && rng.item) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.undoManager.beforeChange();\n\t\t\t\t\t\tdom.remove(rng.item(0));\n\t\t\t\t\t\teditor.undoManager.add();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * IE10 doesn't properly render block elements with the right height until you add contents to them.\n\t\t * This fixes that by adding a padding-right to all empty text block elements.\n\t\t * See: https://connect.microsoft.com/IE/feedback/details/743881\n\t\t */\n\t\tfunction renderEmptyBlocksFix() {\n\t\t\tvar emptyBlocksCSS;\n\n\t\t\t// IE10+\n\t\t\tif (getDocumentMode() >= 10) {\n\t\t\t\temptyBlocksCSS = '';\n\t\t\t\teach('p div h1 h2 h3 h4 h5 h6'.split(' '), function(name, i) {\n\t\t\t\t\temptyBlocksCSS += (i > 0 ? ',' : '') + name + ':empty';\n\t\t\t\t});\n\n\t\t\t\teditor.contentStyles.push(emptyBlocksCSS + '{padding-right: 1px !important}');\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Old IE versions can't retain contents within noscript elements so this logic will store the contents\n\t\t * as a attribute and the insert that value as it's raw text when the DOM is serialized.\n\t\t */\n\t\tfunction keepNoScriptContents() {\n\t\t\tif (getDocumentMode() < 9) {\n\t\t\t\tparser.addNodeFilter('noscript', function(nodes) {\n\t\t\t\t\tvar i = nodes.length, node, textNode;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\t\ttextNode = node.firstChild;\n\n\t\t\t\t\t\tif (textNode) {\n\t\t\t\t\t\t\tnode.attr('data-mce-innertext', textNode.value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tserializer.addNodeFilter('noscript', function(nodes) {\n\t\t\t\t\tvar i = nodes.length, node, textNode, value;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\t\ttextNode = nodes[i].firstChild;\n\n\t\t\t\t\t\tif (textNode) {\n\t\t\t\t\t\t\ttextNode.value = Entities.decode(textNode.value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Old IE can't retain noscript value so an attribute is used to store it\n\t\t\t\t\t\t\tvalue = node.attributes.map['data-mce-innertext'];\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\tnode.attr('data-mce-innertext', null);\n\t\t\t\t\t\t\t\ttextNode = new Node('#text', 3);\n\t\t\t\t\t\t\t\ttextNode.value = value;\n\t\t\t\t\t\t\t\ttextNode.raw = true;\n\t\t\t\t\t\t\t\tnode.append(textNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * IE has an issue where you can't select/move the caret by clicking outside the body if the document is in standards mode.\n\t\t */\n\t\tfunction fixCaretSelectionOfDocumentElementOnIe() {\n\t\t\tvar doc = dom.doc, body = doc.body, started, startRng, htmlElm;\n\n\t\t\t// Return range from point or null if it failed\n\t\t\tfunction rngFromPoint(x, y) {\n\t\t\t\tvar rng = body.createTextRange();\n\n\t\t\t\ttry {\n\t\t\t\t\trng.moveToPoint(x, y);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// IE sometimes throws and exception, so lets just ignore it\n\t\t\t\t\trng = null;\n\t\t\t\t}\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\t// Fires while the selection is changing\n\t\t\tfunction selectionChange(e) {\n\t\t\t\tvar pointRng;\n\n\t\t\t\t// Check if the button is down or not\n\t\t\t\tif (e.button) {\n\t\t\t\t\t// Create range from mouse position\n\t\t\t\t\tpointRng = rngFromPoint(e.x, e.y);\n\n\t\t\t\t\tif (pointRng) {\n\t\t\t\t\t\t// Check if pointRange is before/after selection then change the endPoint\n\t\t\t\t\t\tif (pointRng.compareEndPoints('StartToStart', startRng) > 0) {\n\t\t\t\t\t\t\tpointRng.setEndPoint('StartToStart', startRng);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpointRng.setEndPoint('EndToEnd', startRng);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpointRng.select();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tendSelection();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Removes listeners\n\t\t\tfunction endSelection() {\n\t\t\t\tvar rng = doc.selection.createRange();\n\n\t\t\t\t// If the range is collapsed then use the last start range\n\t\t\t\tif (startRng && !rng.item && rng.compareEndPoints('StartToEnd', rng) === 0) {\n\t\t\t\t\tstartRng.select();\n\t\t\t\t}\n\n\t\t\t\tdom.unbind(doc, 'mouseup', endSelection);\n\t\t\t\tdom.unbind(doc, 'mousemove', selectionChange);\n\t\t\t\tstartRng = started = 0;\n\t\t\t}\n\n\t\t\t// Make HTML element unselectable since we are going to handle selection by hand\n\t\t\tdoc.documentElement.unselectable = true;\n\n\t\t\t// Detect when user selects outside BODY\n\t\t\tdom.bind(doc, 'mousedown contextmenu', function(e) {\n\t\t\t\tif (e.target.nodeName === 'HTML') {\n\t\t\t\t\tif (started) {\n\t\t\t\t\t\tendSelection();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Detect vertical scrollbar, since IE will fire a mousedown on the scrollbar and have target set as HTML\n\t\t\t\t\thtmlElm = doc.documentElement;\n\t\t\t\t\tif (htmlElm.scrollHeight > htmlElm.clientHeight) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tstarted = 1;\n\t\t\t\t\t// Setup start position\n\t\t\t\t\tstartRng = rngFromPoint(e.x, e.y);\n\t\t\t\t\tif (startRng) {\n\t\t\t\t\t\t// Listen for selection change events\n\t\t\t\t\t\tdom.bind(doc, 'mouseup', endSelection);\n\t\t\t\t\t\tdom.bind(doc, 'mousemove', selectionChange);\n\n\t\t\t\t\t\tdom.getRoot().focus();\n\t\t\t\t\t\tstartRng.select();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Fixes selection issues where the caret can be placed between two inline elements like <b>a</b>|<b>b</b>\n\t\t * this fix will lean the caret right into the closest inline element.\n\t\t */\n\t\tfunction normalizeSelection() {\n\t\t\t// Normalize selection for example <b>a</b><i>|a</i> becomes <b>a|</b><i>a</i> except for Ctrl+A since it selects everything\n\t\t\teditor.on('keyup focusin mouseup', function(e) {\n\t\t\t\tif (e.keyCode != 65 || !VK.metaKeyPressed(e)) {\n\t\t\t\t\tselection.normalize();\n\t\t\t\t}\n\t\t\t}, true);\n\t\t}\n\n\t\t/**\n\t\t * Forces Gecko to render a broken image icon if it fails to load an image.\n\t\t */\n\t\tfunction showBrokenImageIcon() {\n\t\t\teditor.contentStyles.push(\n\t\t\t\t'img:-moz-broken {' +\n\t\t\t\t\t'-moz-force-broken-image-icon:1;' +\n\t\t\t\t\t'min-width:24px;' +\n\t\t\t\t\t'min-height:24px' +\n\t\t\t\t'}'\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * iOS has a bug where it's impossible to type if the document has a touchstart event\n\t\t * bound and the user touches the document while having the on screen keyboard visible.\n\t\t *\n\t\t * The touch event moves the focus to the parent document while having the caret inside the iframe\n\t\t * this fix moves the focus back into the iframe document.\n\t\t */\n\t\tfunction restoreFocusOnKeyDown() {\n\t\t\tif (!editor.inline) {\n\t\t\t\teditor.on('keydown', function() {\n\t\t\t\t\tif (document.activeElement == document.body) {\n\t\t\t\t\t\teditor.getWin().focus();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * IE 11 has an annoying issue where you can't move focus into the editor\n\t\t * by clicking on the white area HTML element. We used to be able to to fix this with\n\t\t * the fixCaretSelectionOfDocumentElementOnIe fix. But since M$ removed the selection\n\t\t * object it's not possible anymore. So we need to hack in a ungly CSS to force the\n\t\t * body to be at least 150px. If the user clicks the HTML element out side this 150px region\n\t\t * we simply move the focus into the first paragraph. Not ideal since you loose the\n\t\t * positioning of the caret but goot enough for most cases.\n\t\t */\n\t\tfunction bodyHeight() {\n\t\t\tif (!editor.inline) {\n\t\t\t\teditor.contentStyles.push('body {min-height: 150px}');\n\t\t\t\teditor.on('click', function(e) {\n\t\t\t\t\tvar rng;\n\n\t\t\t\t\tif (e.target.nodeName == 'HTML') {\n\t\t\t\t\t\t// Edge seems to only need focus if we set the range\n\t\t\t\t\t\t// the caret will become invisible and moved out of the iframe!!\n\t\t\t\t\t\tif (Env.ie > 11) {\n\t\t\t\t\t\t\teditor.getBody().focus();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Need to store away non collapsed ranges since the focus call will mess that up see #7382\n\t\t\t\t\t\trng = editor.selection.getRng();\n\t\t\t\t\t\teditor.getBody().focus();\n\t\t\t\t\t\teditor.selection.setRng(rng);\n\t\t\t\t\t\teditor.selection.normalize();\n\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Firefox on Mac OS will move the browser back to the previous page if you press CMD+Left arrow.\n\t\t * You might then loose all your work so we need to block that behavior and replace it with our own.\n\t\t */\n\t\tfunction blockCmdArrowNavigation() {\n\t\t\tif (Env.mac) {\n\t\t\t\teditor.on('keydown', function(e) {\n\t\t\t\t\tif (VK.metaKeyPressed(e) && !e.shiftKey && (e.keyCode == 37 || e.keyCode == 39)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.selection.getSel().modify('move', e.keyCode == 37 ? 'backward' : 'forward', 'lineboundary');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Disables the autolinking in IE 9+ this is then re-enabled by the autolink plugin.\n\t\t */\n\t\tfunction disableAutoUrlDetect() {\n\t\t\tsetEditorCommandState(\"AutoUrlDetect\", false);\n\t\t}\n\n\t\t/**\n\t\t * iOS 7.1 introduced two new bugs:\n\t\t * 1) It's possible to open links within a contentEditable area by clicking on them.\n\t\t * 2) If you hold down the finger it will display the link/image touch callout menu.\n\t\t */\n\t\tfunction tapLinksAndImages() {\n\t\t\teditor.on('click', function(e) {\n\t\t\t\tvar elm = e.target;\n\n\t\t\t\tdo {\n\t\t\t\t\tif (elm.tagName === 'A') {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} while ((elm = elm.parentNode));\n\t\t\t});\n\n\t\t\teditor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');\n\t\t}\n\n\t\t/**\n\t\t * iOS Safari and possible other browsers have a bug where it won't fire\n\t\t * a click event when a contentEditable is focused. This function fakes click events\n\t\t * by using touchstart/touchend and measuring the time and distance travelled.\n\t\t */\n\t\t/*\n\t\tfunction touchClickEvent() {\n\t\t\teditor.on('touchstart', function(e) {\n\t\t\t\tvar elm, time, startTouch, changedTouches;\n\n\t\t\t\telm = e.target;\n\t\t\t\ttime = new Date().getTime();\n\t\t\t\tchangedTouches = e.changedTouches;\n\n\t\t\t\tif (!changedTouches || changedTouches.length > 1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstartTouch = changedTouches[0];\n\n\t\t\t\teditor.once('touchend', function(e) {\n\t\t\t\t\tvar endTouch = e.changedTouches[0], args;\n\n\t\t\t\t\tif (new Date().getTime() - time > 500) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Math.abs(startTouch.clientX - endTouch.clientX) > 5) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Math.abs(startTouch.clientY - endTouch.clientY) > 5) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\targs = {\n\t\t\t\t\t\ttarget: elm\n\t\t\t\t\t};\n\n\t\t\t\t\teach('pageX pageY clientX clientY screenX screenY'.split(' '), function(key) {\n\t\t\t\t\t\targs[key] = endTouch[key];\n\t\t\t\t\t});\n\n\t\t\t\t\targs = editor.fire('click', args);\n\n\t\t\t\t\tif (!args.isDefaultPrevented()) {\n\t\t\t\t\t\t// iOS WebKit can't place the caret properly once\n\t\t\t\t\t\t// you bind touch events so we need to do this manually\n\t\t\t\t\t\t// TODO: Expand to the closest word? Touble tap still works.\n\t\t\t\t\t\teditor.selection.placeCaretAt(endTouch.clientX, endTouch.clientY);\n\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\t*/\n\n\t\t/**\n\t\t * WebKit has a bug where it will allow forms to be submitted if they are inside a contentEditable element.\n\t\t * For example this: <form><button></form>\n\t\t */\n\t\tfunction blockFormSubmitInsideEditor() {\n\t\t\teditor.on('init', function() {\n\t\t\t\teditor.dom.bind(editor.getBody(), 'submit', function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Sometimes WebKit/Blink generates BR elements with the Apple-interchange-newline class.\n\t\t *\n\t\t * Scenario:\n\t\t *  1) Create a table 2x2.\n\t\t *  2) Select and copy cells A2-B2.\n\t\t *  3) Paste and it will add BR element to table cell.\n\t\t */\n\t\tfunction removeAppleInterchangeBrs() {\n\t\t\tparser.addNodeFilter('br', function(nodes) {\n\t\t\t\tvar i = nodes.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tif (nodes[i].attr('class') == 'Apple-interchange-newline') {\n\t\t\t\t\t\tnodes[i].remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * IE cannot set custom contentType's on drag events, and also does not properly drag/drop between\n\t\t * editors. This uses a special data:text/mce-internal URL to pass data when drag/drop between editors.\n\t\t */\n\t\tfunction ieInternalDragAndDrop() {\n\t\t\teditor.on('dragstart', function(e) {\n\t\t\t\tsetMceInternalContent(e);\n\t\t\t});\n\n\t\t\teditor.on('drop', function(e) {\n\t\t\t\tif (!isDefaultPrevented(e)) {\n\t\t\t\t\tvar internalContent = getMceInternalContent(e);\n\n\t\t\t\t\tif (internalContent && internalContent.id != editor.id) {\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tvar rng = RangeUtils.getCaretRangeFromPoint(e.x, e.y, editor.getDoc());\n\t\t\t\t\t\tselection.setRng(rng);\n\t\t\t\t\t\tinsertClipboardContents(internalContent.html);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction refreshContentEditable() {\n\t\t\tvar body, parent;\n\n\t\t\t// Check if the editor was hidden and the re-initialize contentEditable mode by removing and adding the body again\n\t\t\tif (isHidden()) {\n\t\t\t\tbody = editor.getBody();\n\t\t\t\tparent = body.parentNode;\n\n\t\t\t\tparent.removeChild(body);\n\t\t\t\tparent.appendChild(body);\n\n\t\t\t\tbody.focus();\n\t\t\t}\n\t\t}\n\n\t\tfunction isHidden() {\n\t\t\tvar sel;\n\n\t\t\tif (!isGecko) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\t// Weird, wheres that cursor selection?\n\t\t\tsel = editor.selection.getSel();\n\t\t\treturn (!sel || !sel.rangeCount || sel.rangeCount === 0);\n\t\t}\n\n\t\t/**\n\t\t * Properly empties the editor if all contents is selected and deleted this to\n\t\t * prevent empty paragraphs from being produced at beginning/end of contents.\n\t\t */\n\t\tfunction emptyEditorOnDeleteEverything() {\n\t\t\tfunction isEverythingSelected(editor) {\n\t\t\t\tvar caretWalker = new CaretWalker(editor.getBody());\n\t\t\t\tvar rng = editor.selection.getRng();\n\t\t\t\tvar startCaretPos = CaretPosition.fromRangeStart(rng);\n\t\t\t\tvar endCaretPos = CaretPosition.fromRangeEnd(rng);\n\n\t\t\t\treturn !editor.selection.isCollapsed() && !caretWalker.prev(startCaretPos) && !caretWalker.next(endCaretPos);\n\t\t\t}\n\n\t\t\t// Type over case delete and insert this won't cover typeover with a IME but at least it covers the common case\n\t\t\teditor.on('keypress', function (e) {\n\t\t\t\tif (!isDefaultPrevented(e) && !selection.isCollapsed() && e.charCode > 31 && !VK.metaKeyPressed(e)) {\n\t\t\t\t\tif (isEverythingSelected(editor)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.setContent(String.fromCharCode(e.charCode));\n\t\t\t\t\t\teditor.selection.select(editor.getBody(), true);\n\t\t\t\t\t\teditor.selection.collapse(false);\n\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('keydown', function (e) {\n\t\t\t\tvar keyCode = e.keyCode;\n\n\t\t\t\tif (!isDefaultPrevented(e) && (keyCode == DELETE || keyCode == BACKSPACE)) {\n\t\t\t\t\tif (isEverythingSelected(editor)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.setContent('');\n\t\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// All browsers\n\t\tremoveBlockQuoteOnBackSpace();\n\t\temptyEditorWhenDeleting();\n\n\t\t// Windows phone will return a range like [body, 0] on mousedown so\n\t\t// it will always normalize to the wrong location\n\t\tif (!Env.windowsPhone) {\n\t\t\tnormalizeSelection();\n\t\t}\n\n\t\t// WebKit\n\t\tif (isWebKit) {\n\t\t\temptyEditorOnDeleteEverything();\n\t\t\tcleanupStylesWhenDeleting();\n\t\t\tinputMethodFocus();\n\t\t\tselectControlElements();\n\t\t\tsetDefaultBlockType();\n\t\t\tblockFormSubmitInsideEditor();\n\t\t\tdisableBackspaceIntoATable();\n\t\t\tremoveAppleInterchangeBrs();\n\n\t\t\t//touchClickEvent();\n\n\t\t\t// iOS\n\t\t\tif (Env.iOS) {\n\t\t\t\trestoreFocusOnKeyDown();\n\t\t\t\tbodyHeight();\n\t\t\t\ttapLinksAndImages();\n\t\t\t} else {\n\t\t\t\tselectAll();\n\t\t\t}\n\t\t}\n\n\t\t// IE\n\t\tif (isIE && Env.ie < 11) {\n\t\t\tremoveHrOnBackspace();\n\t\t\tensureBodyHasRoleApplication();\n\t\t\taddNewLinesBeforeBrInPre();\n\t\t\tremovePreSerializedStylesWhenSelectingControls();\n\t\t\tdeleteControlItemOnBackSpace();\n\t\t\trenderEmptyBlocksFix();\n\t\t\tkeepNoScriptContents();\n\t\t\tfixCaretSelectionOfDocumentElementOnIe();\n\t\t}\n\n\t\tif (Env.ie >= 11) {\n\t\t\tbodyHeight();\n\t\t\tdisableBackspaceIntoATable();\n\t\t}\n\n\t\tif (Env.ie) {\n\t\t\tselectAll();\n\t\t\tdisableAutoUrlDetect();\n\t\t\tieInternalDragAndDrop();\n\t\t}\n\n\t\t// Gecko\n\t\tif (isGecko) {\n\t\t\temptyEditorOnDeleteEverything();\n\t\t\tremoveHrOnBackspace();\n\t\t\tfocusBody();\n\t\t\tremoveStylesWhenDeletingAcrossBlockElements();\n\t\t\tsetGeckoEditingOptions();\n\t\t\taddBrAfterLastLinks();\n\t\t\tshowBrokenImageIcon();\n\t\t\tblockCmdArrowNavigation();\n\t\t\tdisableBackspaceIntoATable();\n\t\t}\n\n\t\treturn {\n\t\t\trefreshContentEditable: refreshContentEditable,\n\t\t\tisHidden: isHidden\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/EditorObservable.js\n\n/**\n * EditorObservable.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This mixin contains the event logic for the tinymce.Editor class.\n *\n * @mixin tinymce.EditorObservable\n * @extends tinymce.util.Observable\n */\ndefine(\"tinymce/EditorObservable\", [\n\t\"tinymce/util/Observable\",\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/util/Tools\"\n], function(Observable, DOMUtils, Tools) {\n\tvar DOM = DOMUtils.DOM, customEventRootDelegates;\n\n\t/**\n\t * Returns the event target so for the specified event. Some events fire\n\t * only on document, some fire on documentElement etc. This also handles the\n\t * custom event root setting where it returns that element instead of the body.\n\t *\n\t * @private\n\t * @param {tinymce.Editor} editor Editor instance to get event target from.\n\t * @param {String} eventName Name of the event for example \"click\".\n\t * @return {Element/Document} HTML Element or document target to bind on.\n\t */\n\tfunction getEventTarget(editor, eventName) {\n\t\tif (eventName == 'selectionchange') {\n\t\t\treturn editor.getDoc();\n\t\t}\n\n\t\t// Need to bind mousedown/mouseup etc to document not body in iframe mode\n\t\t// Since the user might click on the HTML element not the BODY\n\t\tif (!editor.inline && /^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)) {\n\t\t\treturn editor.getDoc().documentElement;\n\t\t}\n\n\t\t// Bind to event root instead of body if it's defined\n\t\tif (editor.settings.event_root) {\n\t\t\tif (!editor.eventRoot) {\n\t\t\t\teditor.eventRoot = DOM.select(editor.settings.event_root)[0];\n\t\t\t}\n\n\t\t\treturn editor.eventRoot;\n\t\t}\n\n\t\treturn editor.getBody();\n\t}\n\n\t/**\n\t * Binds a event delegate for the specified name this delegate will fire\n\t * the event to the editor dispatcher.\n\t *\n\t * @private\n\t * @param {tinymce.Editor} editor Editor instance to get event target from.\n\t * @param {String} eventName Name of the event for example \"click\".\n\t */\n\tfunction bindEventDelegate(editor, eventName) {\n\t\tvar eventRootElm = getEventTarget(editor, eventName), delegate;\n\n\t\tfunction isListening(editor) {\n\t\t\treturn !editor.hidden && !editor.readonly;\n\t\t}\n\n\t\tif (!editor.delegates) {\n\t\t\teditor.delegates = {};\n\t\t}\n\n\t\tif (editor.delegates[eventName]) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (editor.settings.event_root) {\n\t\t\tif (!customEventRootDelegates) {\n\t\t\t\tcustomEventRootDelegates = {};\n\t\t\t\teditor.editorManager.on('removeEditor', function() {\n\t\t\t\t\tvar name;\n\n\t\t\t\t\tif (!editor.editorManager.activeEditor) {\n\t\t\t\t\t\tif (customEventRootDelegates) {\n\t\t\t\t\t\t\tfor (name in customEventRootDelegates) {\n\t\t\t\t\t\t\t\teditor.dom.unbind(getEventTarget(editor, name));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcustomEventRootDelegates = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (customEventRootDelegates[eventName]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdelegate = function(e) {\n\t\t\t\tvar target = e.target, editors = editor.editorManager.editors, i = editors.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tvar body = editors[i].getBody();\n\n\t\t\t\t\tif (body === target || DOM.isChildOf(target, body)) {\n\t\t\t\t\t\tif (isListening(editors[i])) {\n\t\t\t\t\t\t\teditors[i].fire(eventName, e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tcustomEventRootDelegates[eventName] = delegate;\n\t\t\tDOM.bind(eventRootElm, eventName, delegate);\n\t\t} else {\n\t\t\tdelegate = function(e) {\n\t\t\t\tif (isListening(editor)) {\n\t\t\t\t\teditor.fire(eventName, e);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tDOM.bind(eventRootElm, eventName, delegate);\n\t\t\teditor.delegates[eventName] = delegate;\n\t\t}\n\t}\n\n\tvar EditorObservable = {\n\t\t/**\n\t\t * Bind any pending event delegates. This gets executed after the target body/document is created.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tbindPendingEventDelegates: function() {\n\t\t\tvar self = this;\n\n\t\t\tTools.each(self._pendingNativeEvents, function(name) {\n\t\t\t\tbindEventDelegate(self, name);\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Toggles a native event on/off this is called by the EventDispatcher when\n\t\t * the first native event handler is added and when the last native event handler is removed.\n\t\t *\n\t\t * @private\n\t\t */\n\t\ttoggleNativeEvent: function(name, state) {\n\t\t\tvar self = this;\n\n\t\t\t// Never bind focus/blur since the FocusManager fakes those\n\t\t\tif (name == \"focus\" || name == \"blur\") {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (state) {\n\t\t\t\tif (self.initialized) {\n\t\t\t\t\tbindEventDelegate(self, name);\n\t\t\t\t} else {\n\t\t\t\t\tif (!self._pendingNativeEvents) {\n\t\t\t\t\t\tself._pendingNativeEvents = [name];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself._pendingNativeEvents.push(name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (self.initialized) {\n\t\t\t\tself.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\n\t\t\t\tdelete self.delegates[name];\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Unbinds all native event handlers that means delegates, custom events bound using the Events API etc.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tunbindAllNativeEvents: function() {\n\t\t\tvar self = this, name;\n\n\t\t\tif (self.delegates) {\n\t\t\t\tfor (name in self.delegates) {\n\t\t\t\t\tself.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\n\t\t\t\t}\n\n\t\t\t\tdelete self.delegates;\n\t\t\t}\n\n\t\t\tif (!self.inline) {\n\t\t\t\tself.getBody().onload = null;\n\t\t\t\tself.dom.unbind(self.getWin());\n\t\t\t\tself.dom.unbind(self.getDoc());\n\t\t\t}\n\n\t\t\tself.dom.unbind(self.getBody());\n\t\t\tself.dom.unbind(self.getContainer());\n\t\t}\n\t};\n\n\tEditorObservable = Tools.extend({}, Observable, EditorObservable);\n\n\treturn EditorObservable;\n});\n\n// Included from: js/tinymce/classes/Mode.js\n\n/**\n * Mode.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Mode switcher logic.\n *\n * @private\n * @class tinymce.Mode\n */\ndefine(\"tinymce/Mode\", [], function() {\n\tfunction setEditorCommandState(editor, cmd, state) {\n\t\ttry {\n\t\t\teditor.getDoc().execCommand(cmd, false, state);\n\t\t} catch (ex) {\n\t\t\t// Ignore\n\t\t}\n\t}\n\n\tfunction clickBlocker(editor) {\n\t\tvar target, handler;\n\n\t\ttarget = editor.getBody();\n\n\t\thandler = function(e) {\n\t\t\tif (editor.dom.getParents(e.target, 'a').length > 0) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t};\n\n\t\teditor.dom.bind(target, 'click', handler);\n\n\t\treturn {\n\t\t\tunbind: function() {\n\t\t\t\teditor.dom.unbind(target, 'click', handler);\n\t\t\t}\n\t\t};\n\t}\n\n\tfunction toggleReadOnly(editor, state) {\n\t\tif (editor._clickBlocker) {\n\t\t\teditor._clickBlocker.unbind();\n\t\t\teditor._clickBlocker = null;\n\t\t}\n\n\t\tif (state) {\n\t\t\teditor._clickBlocker = clickBlocker(editor);\n\t\t\teditor.selection.controlSelection.hideResizeRect();\n\t\t\teditor.readonly = true;\n\t\t\teditor.getBody().contentEditable = false;\n\t\t} else {\n\t\t\teditor.readonly = false;\n\t\t\teditor.getBody().contentEditable = true;\n\t\t\tsetEditorCommandState(editor, \"StyleWithCSS\", false);\n\t\t\tsetEditorCommandState(editor, \"enableInlineTableEditing\", false);\n\t\t\tsetEditorCommandState(editor, \"enableObjectResizing\", false);\n\t\t\teditor.focus();\n\t\t\teditor.nodeChanged();\n\t\t}\n\t}\n\n\tfunction setMode(editor, mode) {\n\t\tvar currentMode = editor.readonly ? 'readonly' : 'design';\n\n\t\tif (mode == currentMode) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (editor.initialized) {\n\t\t\ttoggleReadOnly(editor, mode == 'readonly');\n\t\t} else {\n\t\t\teditor.on('init', function() {\n\t\t\t\ttoggleReadOnly(editor, mode == 'readonly');\n\t\t\t});\n\t\t}\n\n\t\t// Event is NOT preventable\n\t\teditor.fire('SwitchMode', {mode: mode});\n\t}\n\n\treturn {\n\t\tsetMode: setMode\n\t};\n});\n\n// Included from: js/tinymce/classes/Shortcuts.js\n\n/**\n * Shortcuts.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Contains all logic for handling of keyboard shortcuts.\n *\n * @class tinymce.Shortcuts\n * @example\n * editor.shortcuts.add('ctrl+a', function() {});\n * editor.shortcuts.add('meta+a', function() {}); // \"meta\" maps to Command on Mac and Ctrl on PC\n * editor.shortcuts.add('ctrl+alt+a', function() {});\n * editor.shortcuts.add('access+a', function() {}); // \"access\" maps to ctrl+alt on Mac and shift+alt on PC\n */\ndefine(\"tinymce/Shortcuts\", [\n\t\"tinymce/util/Tools\",\n\t\"tinymce/Env\"\n], function(Tools, Env) {\n\tvar each = Tools.each, explode = Tools.explode;\n\n\tvar keyCodeLookup = {\n\t\t\"f9\": 120,\n\t\t\"f10\": 121,\n\t\t\"f11\": 122\n\t};\n\n\tvar modifierNames = Tools.makeMap('alt,ctrl,shift,meta,access');\n\n\treturn function(editor) {\n\t\tvar self = this, shortcuts = {}, pendingPatterns = [];\n\n\t\tfunction parseShortcut(pattern) {\n\t\t\tvar id, key, shortcut = {};\n\n\t\t\t// Parse modifiers and keys ctrl+alt+b for example\n\t\t\teach(explode(pattern, '+'), function(value) {\n\t\t\t\tif (value in modifierNames) {\n\t\t\t\t\tshortcut[value] = true;\n\t\t\t\t} else {\n\t\t\t\t\t// Allow numeric keycodes like ctrl+219 for ctrl+[\n\t\t\t\t\tif (/^[0-9]{2,}$/.test(value)) {\n\t\t\t\t\t\tshortcut.keyCode = parseInt(value, 10);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshortcut.charCode = value.charCodeAt(0);\n\t\t\t\t\t\tshortcut.keyCode = keyCodeLookup[value] || value.toUpperCase().charCodeAt(0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Generate unique id for modifier combination and set default state for unused modifiers\n\t\t\tid = [shortcut.keyCode];\n\t\t\tfor (key in modifierNames) {\n\t\t\t\tif (shortcut[key]) {\n\t\t\t\t\tid.push(key);\n\t\t\t\t} else {\n\t\t\t\t\tshortcut[key] = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tshortcut.id = id.join(',');\n\n\t\t\t// Handle special access modifier differently depending on Mac/Win\n\t\t\tif (shortcut.access) {\n\t\t\t\tshortcut.alt = true;\n\n\t\t\t\tif (Env.mac) {\n\t\t\t\t\tshortcut.ctrl = true;\n\t\t\t\t} else {\n\t\t\t\t\tshortcut.shift = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Handle special meta modifier differently depending on Mac/Win\n\t\t\tif (shortcut.meta) {\n\t\t\t\tif (Env.mac) {\n\t\t\t\t\tshortcut.meta = true;\n\t\t\t\t} else {\n\t\t\t\t\tshortcut.ctrl = true;\n\t\t\t\t\tshortcut.meta = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn shortcut;\n\t\t}\n\n\t\tfunction createShortcut(pattern, desc, cmdFunc, scope) {\n\t\t\tvar shortcuts;\n\n\t\t\tshortcuts = Tools.map(explode(pattern, '>'), parseShortcut);\n\t\t\tshortcuts[shortcuts.length - 1] = Tools.extend(shortcuts[shortcuts.length - 1], {\n\t\t\t\tfunc: cmdFunc,\n\t\t\t\tscope: scope || editor\n\t\t\t});\n\n\t\t\treturn Tools.extend(shortcuts[0], {\n\t\t\t\tdesc: editor.translate(desc),\n\t\t\t\tsubpatterns: shortcuts.slice(1)\n\t\t\t});\n\t\t}\n\n\t\tfunction hasModifier(e) {\n\t\t\treturn e.altKey || e.ctrlKey || e.metaKey;\n\t\t}\n\n\t\tfunction isFunctionKey(e) {\n\t\t\treturn e.keyCode >= 112 && e.keyCode <= 123;\n\t\t}\n\n\t\tfunction matchShortcut(e, shortcut) {\n\t\t\tif (!shortcut) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (shortcut.ctrl != e.ctrlKey || shortcut.meta != e.metaKey) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (shortcut.alt != e.altKey || shortcut.shift != e.shiftKey) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (e.keyCode == shortcut.keyCode || (e.charCode && e.charCode == shortcut.charCode)) {\n\t\t\t\te.preventDefault();\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction executeShortcutAction(shortcut) {\n\t\t\treturn shortcut.func ? shortcut.func.call(shortcut.scope) : null;\n\t\t}\n\n\t\teditor.on('keyup keypress keydown', function(e) {\n\t\t\tif ((hasModifier(e) || isFunctionKey(e)) && !e.isDefaultPrevented()) {\n\t\t\t\teach(shortcuts, function(shortcut) {\n\t\t\t\t\tif (matchShortcut(e, shortcut)) {\n\t\t\t\t\t\tpendingPatterns = shortcut.subpatterns.slice(0);\n\n\t\t\t\t\t\tif (e.type == \"keydown\") {\n\t\t\t\t\t\t\texecuteShortcutAction(shortcut);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (matchShortcut(e, pendingPatterns[0])) {\n\t\t\t\t\tif (pendingPatterns.length === 1) {\n\t\t\t\t\t\tif (e.type == \"keydown\") {\n\t\t\t\t\t\t\texecuteShortcutAction(pendingPatterns[0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tpendingPatterns.shift();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * Adds a keyboard shortcut for some command or function.\n\t\t *\n\t\t * @method addShortcut\n\t\t * @param {String} pattern Shortcut pattern. Like for example: ctrl+alt+o.\n\t\t * @param {String} desc Text description for the command.\n\t\t * @param {String/Function} cmdFunc Command name string or function to execute when the key is pressed.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t * @return {Boolean} true/false state if the shortcut was added or not.\n\t\t */\n\t\tself.add = function(pattern, desc, cmdFunc, scope) {\n\t\t\tvar cmd;\n\n\t\t\tcmd = cmdFunc;\n\n\t\t\tif (typeof cmdFunc === 'string') {\n\t\t\t\tcmdFunc = function() {\n\t\t\t\t\teditor.execCommand(cmd, false, null);\n\t\t\t\t};\n\t\t\t} else if (Tools.isArray(cmd)) {\n\t\t\t\tcmdFunc = function() {\n\t\t\t\t\teditor.execCommand(cmd[0], cmd[1], cmd[2]);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\teach(explode(Tools.trim(pattern.toLowerCase())), function(pattern) {\n\t\t\t\tvar shortcut = createShortcut(pattern, desc, cmdFunc, scope);\n\t\t\t\tshortcuts[shortcut.id] = shortcut;\n\t\t\t});\n\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * Remove a keyboard shortcut by pattern.\n\t\t *\n\t\t * @method remove\n\t\t * @param {String} pattern Shortcut pattern. Like for example: ctrl+alt+o.\n\t\t * @return {Boolean} true/false state if the shortcut was removed or not.\n\t\t */\n\t\tself.remove = function(pattern) {\n\t\t\tvar shortcut = createShortcut(pattern);\n\n\t\t\tif (shortcuts[shortcut.id]) {\n\t\t\t\tdelete shortcuts[shortcut.id];\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/file/Uploader.js\n\n/**\n * Uploader.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Upload blobs or blob infos to the specified URL or handler.\n *\n * @private\n * @class tinymce.file.Uploader\n * @example\n * var uploader = new Uploader({\n *     url: '/upload.php',\n *     basePath: '/base/path',\n *     credentials: true,\n *     handler: function(data, success, failure) {\n *         ...\n *     }\n * });\n *\n * uploader.upload(blobInfos).then(function(result) {\n *     ...\n * });\n */\ndefine(\"tinymce/file/Uploader\", [\n\t\"tinymce/util/Promise\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Fun\"\n], function(Promise, Tools, Fun) {\n\treturn function(uploadStatus, settings) {\n\t\tvar pendingPromises = {};\n\n\t\tfunction fileName(blobInfo) {\n\t\t\tvar ext, extensions;\n\n\t\t\textensions = {\n\t\t\t\t'image/jpeg': 'jpg',\n\t\t\t\t'image/jpg': 'jpg',\n\t\t\t\t'image/gif': 'gif',\n\t\t\t\t'image/png': 'png'\n\t\t\t};\n\n\t\t\text = extensions[blobInfo.blob().type.toLowerCase()] || 'dat';\n\n\t\t\treturn blobInfo.id() + '.' + ext;\n\t\t}\n\n\t\tfunction pathJoin(path1, path2) {\n\t\t\tif (path1) {\n\t\t\t\treturn path1.replace(/\\/$/, '') + '/' + path2.replace(/^\\//, '');\n\t\t\t}\n\n\t\t\treturn path2;\n\t\t}\n\n\t\tfunction blobInfoToData(blobInfo) {\n\t\t\treturn {\n\t\t\t\tid: blobInfo.id,\n\t\t\t\tblob: blobInfo.blob,\n\t\t\t\tbase64: blobInfo.base64,\n\t\t\t\tfilename: Fun.constant(fileName(blobInfo))\n\t\t\t};\n\t\t}\n\n\t\tfunction defaultHandler(blobInfo, success, failure, progress) {\n\t\t\tvar xhr, formData;\n\n\t\t\txhr = new XMLHttpRequest();\n\t\t\txhr.open('POST', settings.url);\n\t\t\txhr.withCredentials = settings.credentials;\n\n\t\t\txhr.upload.onprogress = function(e) {\n\t\t\t\tprogress(e.loaded / e.total * 100);\n\t\t\t};\n\n\t\t\txhr.onerror = function() {\n\t\t\t\tfailure(\"Image upload failed due to a XHR Transport error. Code: \" + xhr.status);\n\t\t\t};\n\n\t\t\txhr.onload = function() {\n\t\t\t\tvar json;\n\n\t\t\t\tif (xhr.status != 200) {\n\t\t\t\t\tfailure(\"HTTP Error: \" + xhr.status);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tjson = JSON.parse(xhr.responseText);\n\n\t\t\t\tif (!json || typeof json.location != \"string\") {\n\t\t\t\t\tfailure(\"Invalid JSON: \" + xhr.responseText);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsuccess(pathJoin(settings.basePath, json.location));\n\t\t\t};\n\n\t\t\tformData = new FormData();\n\t\t\tformData.append('file', blobInfo.blob(), fileName(blobInfo));\n\n\t\t\txhr.send(formData);\n\t\t}\n\n\t\tfunction noUpload() {\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tresolve([]);\n\t\t\t});\n\t\t}\n\n\t\tfunction handlerSuccess(blobInfo, url) {\n\t\t\treturn {\n\t\t\t\turl: url,\n\t\t\t\tblobInfo: blobInfo,\n\t\t\t\tstatus: true\n\t\t\t};\n\t\t}\n\n\t\tfunction handlerFailure(blobInfo, error) {\n\t\t\treturn {\n\t\t\t\turl: '',\n\t\t\t\tblobInfo: blobInfo,\n\t\t\t\tstatus: false,\n\t\t\t\terror: error\n\t\t\t};\n\t\t}\n\n\t\tfunction resolvePending(blobUri, result) {\n\t\t\tTools.each(pendingPromises[blobUri], function(resolve) {\n\t\t\t\tresolve(result);\n\t\t\t});\n\n\t\t\tdelete pendingPromises[blobUri];\n\t\t}\n\n\t\tfunction uploadBlobInfo(blobInfo, handler, openNotification) {\n\t\t\tuploadStatus.markPending(blobInfo.blobUri());\n\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tvar notification, progress;\n\n\t\t\t\tvar noop = function() {\n\t\t\t\t};\n\n\t\t\t\ttry {\n\t\t\t\t\tvar closeNotification = function() {\n\t\t\t\t\t\tif (notification) {\n\t\t\t\t\t\t\tnotification.close();\n\t\t\t\t\t\t\tprogress = noop; // Once it's closed it's closed\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tvar success = function(url) {\n\t\t\t\t\t\tcloseNotification();\n\t\t\t\t\t\tuploadStatus.markUploaded(blobInfo.blobUri(), url);\n\t\t\t\t\t\tresolvePending(blobInfo.blobUri(), handlerSuccess(blobInfo, url));\n\t\t\t\t\t\tresolve(handlerSuccess(blobInfo, url));\n\t\t\t\t\t};\n\n\t\t\t\t\tvar failure = function() {\n\t\t\t\t\t\tcloseNotification();\n\t\t\t\t\t\tuploadStatus.removeFailed(blobInfo.blobUri());\n\t\t\t\t\t\tresolvePending(blobInfo.blobUri(), handlerFailure(blobInfo, failure));\n\t\t\t\t\t\tresolve(handlerFailure(blobInfo, failure));\n\t\t\t\t\t};\n\n\t\t\t\t\tprogress = function(percent) {\n\t\t\t\t\t\tif (percent < 0 || percent > 100) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!notification) {\n\t\t\t\t\t\t\tnotification = openNotification();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnotification.progressBar.value(percent);\n\t\t\t\t\t};\n\n\t\t\t\t\thandler(blobInfoToData(blobInfo), success, failure, progress);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tresolve(handlerFailure(blobInfo, ex.message));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction isDefaultHandler(handler) {\n\t\t\treturn handler === defaultHandler;\n\t\t}\n\n\t\tfunction pendingUploadBlobInfo(blobInfo) {\n\t\t\tvar blobUri = blobInfo.blobUri();\n\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tpendingPromises[blobUri] = pendingPromises[blobUri] || [];\n\t\t\t\tpendingPromises[blobUri].push(resolve);\n\t\t\t});\n\t\t}\n\n\t\tfunction uploadBlobs(blobInfos, openNotification) {\n\t\t\tblobInfos = Tools.grep(blobInfos, function(blobInfo) {\n\t\t\t\treturn !uploadStatus.isUploaded(blobInfo.blobUri());\n\t\t\t});\n\n\t\t\treturn Promise.all(Tools.map(blobInfos, function(blobInfo) {\n\t\t\t\treturn uploadStatus.isPending(blobInfo.blobUri()) ?\n\t\t\t\t\tpendingUploadBlobInfo(blobInfo) : uploadBlobInfo(blobInfo, settings.handler, openNotification);\n\t\t\t}));\n\t\t}\n\n\t\tfunction upload(blobInfos, openNotification) {\n\t\t\treturn (!settings.url && isDefaultHandler(settings.handler)) ? noUpload() : uploadBlobs(blobInfos, openNotification);\n\t\t}\n\n\t\tsettings = Tools.extend({\n\t\t\tcredentials: false,\n\t\t\t// We are adding a notify argument to this (at the moment, until it doesn't work)\n\t\t\thandler: defaultHandler\n\t\t}, settings);\n\n\t\treturn {\n\t\t\tupload: upload\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/file/Conversions.js\n\n/**\n * Conversions.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Converts blob/uris back and forth.\n *\n * @private\n * @class tinymce.file.Conversions\n */\ndefine(\"tinymce/file/Conversions\", [\n\t\"tinymce/util/Promise\"\n], function(Promise) {\n\tfunction blobUriToBlob(url) {\n\t\treturn new Promise(function(resolve) {\n\t\t\tvar xhr = new XMLHttpRequest();\n\n\t\t\txhr.open('GET', url, true);\n\t\t\txhr.responseType = 'blob';\n\n\t\t\txhr.onload = function() {\n\t\t\t\tif (this.status == 200) {\n\t\t\t\t\tresolve(this.response);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\txhr.send();\n\t\t});\n\t}\n\n\tfunction parseDataUri(uri) {\n\t\tvar type, matches;\n\n\t\turi = decodeURIComponent(uri).split(',');\n\n\t\tmatches = /data:([^;]+)/.exec(uri[0]);\n\t\tif (matches) {\n\t\t\ttype = matches[1];\n\t\t}\n\n\t\treturn {\n\t\t\ttype: type,\n\t\t\tdata: uri[1]\n\t\t};\n\t}\n\n\tfunction dataUriToBlob(uri) {\n\t\treturn new Promise(function(resolve) {\n\t\t\tvar str, arr, i;\n\n\t\t\turi = parseDataUri(uri);\n\n\t\t\t// Might throw error if data isn't proper base64\n\t\t\ttry {\n\t\t\t\tstr = atob(uri.data);\n\t\t\t} catch (e) {\n\t\t\t\tresolve(new Blob([]));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tarr = new Uint8Array(str.length);\n\n\t\t\tfor (i = 0; i < arr.length; i++) {\n\t\t\t\tarr[i] = str.charCodeAt(i);\n\t\t\t}\n\n\t\t\tresolve(new Blob([arr], {type: uri.type}));\n\t\t});\n\t}\n\n\tfunction uriToBlob(url) {\n\t\tif (url.indexOf('blob:') === 0) {\n\t\t\treturn blobUriToBlob(url);\n\t\t}\n\n\t\tif (url.indexOf('data:') === 0) {\n\t\t\treturn dataUriToBlob(url);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction blobToDataUri(blob) {\n\t\treturn new Promise(function(resolve) {\n\t\t\tvar reader = new FileReader();\n\n\t\t\treader.onloadend = function() {\n\t\t\t\tresolve(reader.result);\n\t\t\t};\n\n\t\t\treader.readAsDataURL(blob);\n\t\t});\n\t}\n\n\treturn {\n\t\turiToBlob: uriToBlob,\n\t\tblobToDataUri: blobToDataUri,\n\t\tparseDataUri: parseDataUri\n\t};\n});\n\n// Included from: js/tinymce/classes/file/ImageScanner.js\n\n/**\n * ImageScanner.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Finds images with data uris or blob uris. If data uris are found it will convert them into blob uris.\n *\n * @private\n * @class tinymce.file.ImageScanner\n */\ndefine(\"tinymce/file/ImageScanner\", [\n\t\"tinymce/util/Promise\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Fun\",\n\t\"tinymce/file/Conversions\",\n\t\"tinymce/Env\"\n], function(Promise, Arr, Fun, Conversions, Env) {\n\tvar count = 0;\n\n\treturn function(uploadStatus, blobCache) {\n\t\tvar cachedPromises = {};\n\n\t\tfunction findAll(elm, predicate) {\n\t\t\tvar images, promises;\n\n\t\t\tfunction imageToBlobInfo(img, resolve) {\n\t\t\t\tvar base64, blobInfo;\n\n\t\t\t\tif (img.src.indexOf('blob:') === 0) {\n\t\t\t\t\tblobInfo = blobCache.getByUri(img.src);\n\n\t\t\t\t\tif (blobInfo) {\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\timage: img,\n\t\t\t\t\t\t\tblobInfo: blobInfo\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tbase64 = Conversions.parseDataUri(img.src).data;\n\t\t\t\tblobInfo = blobCache.findFirst(function(cachedBlobInfo) {\n\t\t\t\t\treturn cachedBlobInfo.base64() === base64;\n\t\t\t\t});\n\n\t\t\t\tif (blobInfo) {\n\t\t\t\t\tresolve({\n\t\t\t\t\t\timage: img,\n\t\t\t\t\t\tblobInfo: blobInfo\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tConversions.uriToBlob(img.src).then(function(blob) {\n\t\t\t\t\t\tvar blobInfoId = 'blobid' + (count++),\n\t\t\t\t\t\t\tblobInfo = blobCache.create(blobInfoId, blob, base64);\n\n\t\t\t\t\t\tblobCache.add(blobInfo);\n\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\timage: img,\n\t\t\t\t\t\t\tblobInfo: blobInfo\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!predicate) {\n\t\t\t\tpredicate = Fun.constant(true);\n\t\t\t}\n\n\t\t\timages = Arr.filter(elm.getElementsByTagName('img'), function(img) {\n\t\t\t\tvar src = img.src;\n\n\t\t\t\tif (!Env.fileApi) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (img.hasAttribute('data-mce-bogus')) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (img.hasAttribute('data-mce-placeholder')) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (!src || src == Env.transparentSrc) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (src.indexOf('blob:') === 0) {\n\t\t\t\t\treturn !uploadStatus.isUploaded(src);\n\t\t\t\t}\n\n\t\t\t\tif (src.indexOf('data:') === 0) {\n\t\t\t\t\treturn predicate(img);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\tpromises = Arr.map(images, function(img) {\n\t\t\t\tvar newPromise;\n\n\t\t\t\tif (cachedPromises[img.src]) {\n\t\t\t\t\t// Since the cached promise will return the cached image\n\t\t\t\t\t// We need to wrap it and resolve with the actual image\n\t\t\t\t\treturn new Promise(function(resolve) {\n\t\t\t\t\t\tcachedPromises[img.src].then(function(imageInfo) {\n\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\timage: img,\n\t\t\t\t\t\t\t\tblobInfo: imageInfo.blobInfo\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tnewPromise = new Promise(function(resolve) {\n\t\t\t\t\timageToBlobInfo(img, resolve);\n\t\t\t\t}).then(function(result) {\n\t\t\t\t\tdelete cachedPromises[result.image.src];\n\t\t\t\t\treturn result;\n\t\t\t\t})['catch'](function(error) {\n\t\t\t\t\tdelete cachedPromises[img.src];\n\t\t\t\t\treturn error;\n\t\t\t\t});\n\n\t\t\t\tcachedPromises[img.src] = newPromise;\n\n\t\t\t\treturn newPromise;\n\t\t\t});\n\n\t\t\treturn Promise.all(promises);\n\t\t}\n\n\t\treturn {\n\t\t\tfindAll: findAll\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/file/BlobCache.js\n\n/**\n * BlobCache.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Hold blob info objects where a blob has extra internal information.\n *\n * @private\n * @class tinymce.file.BlobCache\n */\ndefine(\"tinymce/file/BlobCache\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Fun\"\n], function(Arr, Fun) {\n\treturn function() {\n\t\tvar cache = [], constant = Fun.constant;\n\n\t\tfunction create(id, blob, base64) {\n\t\t\treturn {\n\t\t\t\tid: constant(id),\n\t\t\t\tblob: constant(blob),\n\t\t\t\tbase64: constant(base64),\n\t\t\t\tblobUri: constant(URL.createObjectURL(blob))\n\t\t\t};\n\t\t}\n\n\t\tfunction add(blobInfo) {\n\t\t\tif (!get(blobInfo.id())) {\n\t\t\t\tcache.push(blobInfo);\n\t\t\t}\n\t\t}\n\n\t\tfunction get(id) {\n\t\t\treturn findFirst(function(cachedBlobInfo) {\n\t\t\t\treturn cachedBlobInfo.id() === id;\n\t\t\t});\n\t\t}\n\n\t\tfunction findFirst(predicate) {\n\t\t\treturn Arr.filter(cache, predicate)[0];\n\t\t}\n\n\t\tfunction getByUri(blobUri) {\n\t\t\treturn findFirst(function(blobInfo) {\n\t\t\t\treturn blobInfo.blobUri() == blobUri;\n\t\t\t});\n\t\t}\n\n\t\tfunction removeByUri(blobUri) {\n\t\t\tcache = Arr.filter(cache, function(blobInfo) {\n\t\t\t\tif (blobInfo.blobUri() === blobUri) {\n\t\t\t\t\tURL.revokeObjectURL(blobInfo.blobUri());\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\n\t\tfunction destroy() {\n\t\t\tArr.each(cache, function(cachedBlobInfo) {\n\t\t\t\tURL.revokeObjectURL(cachedBlobInfo.blobUri());\n\t\t\t});\n\n\t\t\tcache = [];\n\t\t}\n\n\t\treturn {\n\t\t\tcreate: create,\n\t\t\tadd: add,\n\t\t\tget: get,\n\t\t\tgetByUri: getByUri,\n\t\t\tfindFirst: findFirst,\n\t\t\tremoveByUri: removeByUri,\n\t\t\tdestroy: destroy\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/file/UploadStatus.js\n\n/**\n * UploadStatus.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Holds the current status of a blob uri, if it's pending or uploaded and what the result urls was.\n *\n * @private\n * @class tinymce.file.UploadStatus\n */\ndefine(\"tinymce/file/UploadStatus\", [\n], function() {\n\treturn function() {\n\t\tvar PENDING = 1, UPLOADED = 2;\n\t\tvar blobUriStatuses = {};\n\n\t\tfunction createStatus(status, resultUri) {\n\t\t\treturn {\n\t\t\t\tstatus: status,\n\t\t\t\tresultUri: resultUri\n\t\t\t};\n\t\t}\n\n\t\tfunction hasBlobUri(blobUri) {\n\t\t\treturn blobUri in blobUriStatuses;\n\t\t}\n\n\t\tfunction getResultUri(blobUri) {\n\t\t\tvar result = blobUriStatuses[blobUri];\n\n\t\t\treturn result ? result.resultUri : null;\n\t\t}\n\n\t\tfunction isPending(blobUri) {\n\t\t\treturn hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === PENDING : false;\n\t\t}\n\n\t\tfunction isUploaded(blobUri) {\n\t\t\treturn hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === UPLOADED : false;\n\t\t}\n\n\t\tfunction markPending(blobUri) {\n\t\t\tblobUriStatuses[blobUri] = createStatus(PENDING, null);\n\t\t}\n\n\t\tfunction markUploaded(blobUri, resultUri) {\n\t\t\tblobUriStatuses[blobUri] = createStatus(UPLOADED, resultUri);\n\t\t}\n\n\t\tfunction removeFailed(blobUri) {\n\t\t\tdelete blobUriStatuses[blobUri];\n\t\t}\n\n\t\tfunction destroy() {\n\t\t\tblobUriStatuses = {};\n\t\t}\n\n\t\treturn {\n\t\t\thasBlobUri: hasBlobUri,\n\t\t\tgetResultUri: getResultUri,\n\t\t\tisPending: isPending,\n\t\t\tisUploaded: isUploaded,\n\t\t\tmarkPending: markPending,\n\t\t\tmarkUploaded: markUploaded,\n\t\t\tremoveFailed: removeFailed,\n\t\t\tdestroy: destroy\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/EditorUpload.js\n\n/**\n * EditorUpload.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Handles image uploads, updates undo stack and patches over various internal functions.\n *\n * @private\n * @class tinymce.EditorUpload\n */\ndefine(\"tinymce/EditorUpload\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/file/Uploader\",\n\t\"tinymce/file/ImageScanner\",\n\t\"tinymce/file/BlobCache\",\n\t\"tinymce/file/UploadStatus\"\n], function(Arr, Uploader, ImageScanner, BlobCache, UploadStatus) {\n\treturn function(editor) {\n\t\tvar blobCache = new BlobCache(), uploader, imageScanner, settings = editor.settings;\n\t\tvar uploadStatus = new UploadStatus();\n\n\t\tfunction aliveGuard(callback) {\n\t\t\treturn function(result) {\n\t\t\t\tif (editor.selection) {\n\t\t\t\t\treturn callback(result);\n\t\t\t\t}\n\n\t\t\t\treturn [];\n\t\t\t};\n\t\t}\n\n\t\t// Replaces strings without regexps to avoid FF regexp to big issue\n\t\tfunction replaceString(content, search, replace) {\n\t\t\tvar index = 0;\n\n\t\t\tdo {\n\t\t\t\tindex = content.indexOf(search, index);\n\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tcontent = content.substring(0, index) + replace + content.substr(index + search.length);\n\t\t\t\t\tindex += replace.length - search.length + 1;\n\t\t\t\t}\n\t\t\t} while (index !== -1);\n\n\t\t\treturn content;\n\t\t}\n\n\t\tfunction replaceImageUrl(content, targetUrl, replacementUrl) {\n\t\t\tcontent = replaceString(content, 'src=\"' + targetUrl + '\"', 'src=\"' + replacementUrl + '\"');\n\t\t\tcontent = replaceString(content, 'data-mce-src=\"' + targetUrl + '\"', 'data-mce-src=\"' + replacementUrl + '\"');\n\n\t\t\treturn content;\n\t\t}\n\n\t\tfunction replaceUrlInUndoStack(targetUrl, replacementUrl) {\n\t\t\tArr.each(editor.undoManager.data, function(level) {\n\t\t\t\tlevel.content = replaceImageUrl(level.content, targetUrl, replacementUrl);\n\t\t\t});\n\t\t}\n\n\t\tfunction openNotification() {\n\t\t\treturn editor.notificationManager.open({\n\t\t\t\ttext: editor.translate('Image uploading...'),\n\t\t\t\ttype: 'info',\n\t\t\t\ttimeout: -1,\n\t\t\t\tprogressBar: true\n\t\t\t});\n\t\t}\n\n\t\tfunction replaceImageUri(image, resultUri) {\n\t\t\tblobCache.removeByUri(image.src);\n\t\t\treplaceUrlInUndoStack(image.src, resultUri);\n\n\t\t\teditor.$(image).attr({\n\t\t\t\tsrc: resultUri,\n\t\t\t\t'data-mce-src': editor.convertURL(resultUri, 'src')\n\t\t\t});\n\t\t}\n\n\t\tfunction uploadImages(callback) {\n\t\t\tif (!uploader) {\n\t\t\t\tuploader = new Uploader(uploadStatus, {\n\t\t\t\t\turl: settings.images_upload_url,\n\t\t\t\t\tbasePath: settings.images_upload_base_path,\n\t\t\t\t\tcredentials: settings.images_upload_credentials,\n\t\t\t\t\thandler: settings.images_upload_handler\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn scanForImages().then(aliveGuard(function(imageInfos) {\n\t\t\t\tvar blobInfos;\n\n\t\t\t\tblobInfos = Arr.map(imageInfos, function(imageInfo) {\n\t\t\t\t\treturn imageInfo.blobInfo;\n\t\t\t\t});\n\n\t\t\t\treturn uploader.upload(blobInfos, openNotification).then(aliveGuard(function(result) {\n\t\t\t\t\tresult = Arr.map(result, function(uploadInfo, index) {\n\t\t\t\t\t\tvar image = imageInfos[index].image;\n\n\t\t\t\t\t\tif (uploadInfo.status && editor.settings.images_replace_blob_uris !== false) {\n\t\t\t\t\t\t\treplaceImageUri(image, uploadInfo.url);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\telement: image,\n\t\t\t\t\t\t\tstatus: uploadInfo.status\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tcallback(result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn result;\n\t\t\t\t}));\n\t\t\t}));\n\t\t}\n\n\t\tfunction uploadImagesAuto(callback) {\n\t\t\tif (settings.automatic_uploads !== false) {\n\t\t\t\treturn uploadImages(callback);\n\t\t\t}\n\t\t}\n\n\t\tfunction isValidDataUriImage(imgElm) {\n\t\t\treturn settings.images_dataimg_filter ? settings.images_dataimg_filter(imgElm) : true;\n\t\t}\n\n\t\tfunction scanForImages() {\n\t\t\tif (!imageScanner) {\n\t\t\t\timageScanner = new ImageScanner(uploadStatus, blobCache);\n\t\t\t}\n\n\t\t\treturn imageScanner.findAll(editor.getBody(), isValidDataUriImage).then(aliveGuard(function(result) {\n\t\t\t\tArr.each(result, function(resultItem) {\n\t\t\t\t\treplaceUrlInUndoStack(resultItem.image.src, resultItem.blobInfo.blobUri());\n\t\t\t\t\tresultItem.image.src = resultItem.blobInfo.blobUri();\n\t\t\t\t\tresultItem.image.removeAttribute('data-mce-src');\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t}));\n\t\t}\n\n\t\tfunction destroy() {\n\t\t\tblobCache.destroy();\n\t\t\tuploadStatus.destroy();\n\t\t\timageScanner = uploader = null;\n\t\t}\n\n\t\tfunction replaceBlobUris(content) {\n\t\t\treturn content.replace(/src=\"(blob:[^\"]+)\"/g, function(match, blobUri) {\n\t\t\t\tvar resultUri = uploadStatus.getResultUri(blobUri);\n\n\t\t\t\tif (resultUri) {\n\t\t\t\t\treturn 'src=\"' + resultUri + '\"';\n\t\t\t\t}\n\n\t\t\t\tvar blobInfo = blobCache.getByUri(blobUri);\n\n\t\t\t\tif (!blobInfo) {\n\t\t\t\t\tblobInfo = Arr.reduce(editor.editorManager.editors, function(result, editor) {\n\t\t\t\t\t\treturn result || editor.editorUpload.blobCache.getByUri(blobUri);\n\t\t\t\t\t}, null);\n\t\t\t\t}\n\n\t\t\t\tif (blobInfo) {\n\t\t\t\t\treturn 'src=\"data:' + blobInfo.blob().type + ';base64,' + blobInfo.base64() + '\"';\n\t\t\t\t}\n\n\t\t\t\treturn match;\n\t\t\t});\n\t\t}\n\n\t\teditor.on('setContent', function() {\n\t\t\tif (editor.settings.automatic_uploads !== false) {\n\t\t\t\tuploadImagesAuto();\n\t\t\t} else {\n\t\t\t\tscanForImages();\n\t\t\t}\n\t\t});\n\n\t\teditor.on('RawSaveContent', function(e) {\n\t\t\te.content = replaceBlobUris(e.content);\n\t\t});\n\n\t\teditor.on('getContent', function(e) {\n\t\t\tif (e.source_view || e.format == 'raw') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.content = replaceBlobUris(e.content);\n\t\t});\n\n\t\teditor.on('PostRender', function() {\n\t\t\teditor.parser.addNodeFilter('img', function(images) {\n\t\t\t\tArr.each(images, function(img) {\n\t\t\t\t\tvar src = img.attr('src');\n\n\t\t\t\t\tif (blobCache.getByUri(src)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar resultUri = uploadStatus.getResultUri(src);\n\t\t\t\t\tif (resultUri) {\n\t\t\t\t\t\timg.attr('src', resultUri);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn {\n\t\t\tblobCache: blobCache,\n\t\t\tuploadImages: uploadImages,\n\t\t\tuploadImagesAuto: uploadImagesAuto,\n\t\t\tscanForImages: scanForImages,\n\t\t\tdestroy: destroy\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/FakeCaret.js\n\n/**\n * FakeCaret.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic for rendering a fake visual caret.\n *\n * @private\n * @class tinymce.caret.FakeCaret\n */\ndefine(\"tinymce/caret/FakeCaret\", [\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/geom/ClientRect\",\n\t\"tinymce/util/Delay\"\n], function(CaretContainer, CaretPosition, NodeType, RangeUtils, $, ClientRect, Delay) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse;\n\n\treturn function(rootNode, isBlock) {\n\t\tvar cursorInterval, $lastVisualCaret, caretContainerNode;\n\n\t\tfunction getAbsoluteClientRect(node, before) {\n\t\t\tvar clientRect = ClientRect.collapse(node.getBoundingClientRect(), before),\n\t\t\t\tdocElm, scrollX, scrollY, margin, rootRect;\n\n\t\t\tif (rootNode.tagName == 'BODY') {\n\t\t\t\tdocElm = rootNode.ownerDocument.documentElement;\n\t\t\t\tscrollX = rootNode.scrollLeft || docElm.scrollLeft;\n\t\t\t\tscrollY = rootNode.scrollTop || docElm.scrollTop;\n\t\t\t} else {\n\t\t\t\trootRect = rootNode.getBoundingClientRect();\n\t\t\t\tscrollX = rootNode.scrollLeft - rootRect.left;\n\t\t\t\tscrollY = rootNode.scrollTop - rootRect.top;\n\t\t\t}\n\n\t\t\tclientRect.left += scrollX;\n\t\t\tclientRect.right += scrollX;\n\t\t\tclientRect.top += scrollY;\n\t\t\tclientRect.bottom += scrollY;\n\t\t\tclientRect.width = 1;\n\n\t\t\tmargin = node.offsetWidth - node.clientWidth;\n\n\t\t\tif (margin > 0) {\n\t\t\t\tif (before) {\n\t\t\t\t\tmargin *= -1;\n\t\t\t\t}\n\n\t\t\t\tclientRect.left += margin;\n\t\t\t\tclientRect.right += margin;\n\t\t\t}\n\n\t\t\treturn clientRect;\n\t\t}\n\n\t\tfunction trimInlineCaretContainers() {\n\t\t\tvar contentEditableFalseNodes, node, sibling, i, data;\n\n\t\t\tcontentEditableFalseNodes = $('*[contentEditable=false]', rootNode);\n\t\t\tfor (i = 0; i < contentEditableFalseNodes.length; i++) {\n\t\t\t\tnode = contentEditableFalseNodes[i];\n\n\t\t\t\tsibling = node.previousSibling;\n\t\t\t\tif (CaretContainer.endsWithCaretContainer(sibling)) {\n\t\t\t\t\tdata = sibling.data;\n\n\t\t\t\t\tif (data.length == 1) {\n\t\t\t\t\t\tsibling.parentNode.removeChild(sibling);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsibling.deleteData(data.length - 1, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsibling = node.nextSibling;\n\t\t\t\tif (CaretContainer.startsWithCaretContainer(sibling)) {\n\t\t\t\t\tdata = sibling.data;\n\n\t\t\t\t\tif (data.length == 1) {\n\t\t\t\t\t\tsibling.parentNode.removeChild(sibling);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsibling.deleteData(0, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction show(before, node) {\n\t\t\tvar clientRect, rng, container;\n\n\t\t\thide();\n\n\t\t\tif (isBlock(node)) {\n\t\t\t\tcaretContainerNode = CaretContainer.insertBlock('p', node, before);\n\t\t\t\tclientRect = getAbsoluteClientRect(node, before);\n\t\t\t\t$(caretContainerNode).css('top', clientRect.top);\n\n\t\t\t\t$lastVisualCaret = $('<div class=\"mce-visual-caret\" data-mce-bogus=\"all\"></div>').css(clientRect).appendTo(rootNode);\n\n\t\t\t\tif (before) {\n\t\t\t\t\t$lastVisualCaret.addClass('mce-visual-caret-before');\n\t\t\t\t}\n\n\t\t\t\tstartBlink();\n\n\t\t\t\trng = node.ownerDocument.createRange();\n\t\t\t\tcontainer = caretContainerNode.firstChild;\n\t\t\t\trng.setStart(container, 0);\n\t\t\t\trng.setEnd(container, 1);\n\t\t\t} else {\n\t\t\t\tcaretContainerNode = CaretContainer.insertInline(node, before);\n\t\t\t\trng = node.ownerDocument.createRange();\n\n\t\t\t\tif (isContentEditableFalse(caretContainerNode.nextSibling)) {\n\t\t\t\t\trng.setStart(caretContainerNode, 0);\n\t\t\t\t\trng.setEnd(caretContainerNode, 0);\n\t\t\t\t} else {\n\t\t\t\t\trng.setStart(caretContainerNode, 1);\n\t\t\t\t\trng.setEnd(caretContainerNode, 1);\n\t\t\t\t}\n\n\t\t\t\treturn rng;\n\t\t\t}\n\n\t\t\treturn rng;\n\t\t}\n\n\t\tfunction hide() {\n\t\t\ttrimInlineCaretContainers();\n\n\t\t\tif (caretContainerNode) {\n\t\t\t\tCaretContainer.remove(caretContainerNode);\n\t\t\t\tcaretContainerNode = null;\n\t\t\t}\n\n\t\t\tif ($lastVisualCaret) {\n\t\t\t\t$lastVisualCaret.remove();\n\t\t\t\t$lastVisualCaret = null;\n\t\t\t}\n\n\t\t\tclearInterval(cursorInterval);\n\t\t}\n\n\t\tfunction startBlink() {\n\t\t\tcursorInterval = Delay.setInterval(function() {\n\t\t\t\t$('div.mce-visual-caret', rootNode).toggleClass('mce-visual-caret-hidden');\n\t\t\t}, 500);\n\t\t}\n\n\t\tfunction destroy() {\n\t\t\tDelay.clearInterval(cursorInterval);\n\t\t}\n\n\t\tfunction getCss() {\n\t\t\treturn (\n\t\t\t\t'.mce-visual-caret {' +\n\t\t\t\t\t'position: absolute;' +\n\t\t\t\t\t'background-color: black;' +\n\t\t\t\t\t'background-color: currentcolor;' +\n\t\t\t\t'}' +\n\t\t\t\t'.mce-visual-caret-hidden {' +\n\t\t\t\t\t'display: none;' +\n\t\t\t\t'}' +\n\t\t\t\t'*[data-mce-caret] {' +\n\t\t\t\t\t'position: absolute;' +\n\t\t\t\t\t'left: -1000px;' +\n\t\t\t\t\t'right: auto;' +\n\t\t\t\t\t'top: 0;' +\n\t\t\t\t\t'margin: 0;' +\n\t\t\t\t\t'padding: 0;' +\n\t\t\t\t'}'\n\t\t\t);\n\t\t}\n\n\t\treturn {\n\t\t\tshow: show,\n\t\t\thide: hide,\n\t\t\tgetCss: getCss,\n\t\t\tdestroy: destroy\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/Dimensions.js\n\n/**\n * Dimensions.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module measures nodes and returns client rects. The client rects has an\n * extra node property.\n *\n * @private\n * @class tinymce.dom.Dimensions\n */\ndefine(\"tinymce/dom/Dimensions\", [\n\t\"tinymce/util/Arr\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/geom/ClientRect\"\n], function(Arr, NodeType, ClientRect) {\n\n\tfunction getClientRects(node) {\n\t\tfunction toArrayWithNode(clientRects) {\n\t\t\treturn Arr.map(clientRects, function(clientRect) {\n\t\t\t\tclientRect = ClientRect.clone(clientRect);\n\t\t\t\tclientRect.node = node;\n\n\t\t\t\treturn clientRect;\n\t\t\t});\n\t\t}\n\n\t\tif (Arr.isArray(node)) {\n\t\t\treturn Arr.reduce(node, function(result, node) {\n\t\t\t\treturn result.concat(getClientRects(node));\n\t\t\t}, []);\n\t\t}\n\n\t\tif (NodeType.isElement(node)) {\n\t\t\treturn toArrayWithNode(node.getClientRects());\n\t\t}\n\n\t\tif (NodeType.isText(node)) {\n\t\t\tvar rng = node.ownerDocument.createRange();\n\n\t\t\trng.setStart(node, 0);\n\t\t\trng.setEnd(node, node.data.length);\n\n\t\t\treturn toArrayWithNode(rng.getClientRects());\n\t\t}\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Returns the client rects for a specific node.\n\t\t *\n\t\t * @method getClientRects\n\t\t * @param {Array/DOMNode} node Node or array of nodes to get client rects on.\n\t\t * @param {Array} Array of client rects with a extra node property.\n\t\t */\n\t\tgetClientRects: getClientRects\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/LineWalker.js\n\n/**\n * LineWalker.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module lets you walk the document line by line\n * returing nodes and client rects for each line.\n *\n * @private\n * @class tinymce.caret.LineWalker\n */\ndefine(\"tinymce/caret/LineWalker\", [\n\t\"tinymce/util/Fun\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/dom/Dimensions\",\n\t\"tinymce/caret/CaretCandidate\",\n\t\"tinymce/caret/CaretUtils\",\n\t\"tinymce/caret/CaretWalker\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/geom/ClientRect\"\n], function(Fun, Arr, Dimensions, CaretCandidate, CaretUtils, CaretWalker, CaretPosition, ClientRect) {\n\tvar curry = Fun.curry;\n\n\tfunction findUntil(direction, rootNode, predicateFn, node) {\n\t\twhile ((node = CaretUtils.findNode(node, direction, CaretCandidate.isEditableCaretCandidate, rootNode))) {\n\t\t\tif (predicateFn(node)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction walkUntil(direction, isAboveFn, isBeflowFn, rootNode, predicateFn, caretPosition) {\n\t\tvar line = 0, node, result = [], targetClientRect;\n\n\t\tfunction add(node) {\n\t\t\tvar i, clientRect, clientRects;\n\n\t\t\tclientRects = Dimensions.getClientRects(node);\n\t\t\tif (direction == -1) {\n\t\t\t\tclientRects = clientRects.reverse();\n\t\t\t}\n\n\t\t\tfor (i = 0; i < clientRects.length; i++) {\n\t\t\t\tclientRect = clientRects[i];\n\t\t\t\tif (isBeflowFn(clientRect, targetClientRect)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (result.length > 0 && isAboveFn(clientRect, Arr.last(result))) {\n\t\t\t\t\tline++;\n\t\t\t\t}\n\n\t\t\t\tclientRect.line = line;\n\n\t\t\t\tif (predicateFn(clientRect)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tresult.push(clientRect);\n\t\t\t}\n\t\t}\n\n\t\ttargetClientRect = Arr.last(caretPosition.getClientRects());\n\t\tif (!targetClientRect) {\n\t\t\treturn result;\n\t\t}\n\n\t\tnode = caretPosition.getNode();\n\t\tadd(node);\n\t\tfindUntil(direction, rootNode, add, node);\n\n\t\treturn result;\n\t}\n\n\tfunction aboveLineNumber(lineNumber, clientRect) {\n\t\treturn clientRect.line > lineNumber;\n\t}\n\n\tfunction isLine(lineNumber, clientRect) {\n\t\treturn clientRect.line === lineNumber;\n\t}\n\n\tvar upUntil = curry(walkUntil, -1, ClientRect.isAbove, ClientRect.isBelow);\n\tvar downUntil = curry(walkUntil, 1, ClientRect.isBelow, ClientRect.isAbove);\n\n\tfunction positionsUntil(direction, rootNode, predicateFn, node) {\n\t\tvar caretWalker = new CaretWalker(rootNode), walkFn, isBelowFn, isAboveFn,\n\t\t\tcaretPosition, result = [], line = 0, clientRect, targetClientRect;\n\n\t\tfunction getClientRect(caretPosition) {\n\t\t\tif (direction == 1) {\n\t\t\t\treturn Arr.last(caretPosition.getClientRects());\n\t\t\t}\n\n\t\t\treturn Arr.last(caretPosition.getClientRects());\n\t\t}\n\n\t\tif (direction == 1) {\n\t\t\twalkFn = caretWalker.next;\n\t\t\tisBelowFn = ClientRect.isBelow;\n\t\t\tisAboveFn = ClientRect.isAbove;\n\t\t\tcaretPosition = CaretPosition.after(node);\n\t\t} else {\n\t\t\twalkFn = caretWalker.prev;\n\t\t\tisBelowFn = ClientRect.isAbove;\n\t\t\tisAboveFn = ClientRect.isBelow;\n\t\t\tcaretPosition = CaretPosition.before(node);\n\t\t}\n\n\t\ttargetClientRect = getClientRect(caretPosition);\n\n\t\tdo {\n\t\t\tif (!caretPosition.isVisible()) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tclientRect = getClientRect(caretPosition);\n\n\t\t\tif (isAboveFn(clientRect, targetClientRect)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (result.length > 0 && isBelowFn(clientRect, Arr.last(result))) {\n\t\t\t\tline++;\n\t\t\t}\n\n\t\t\tclientRect = ClientRect.clone(clientRect);\n\t\t\tclientRect.position = caretPosition;\n\t\t\tclientRect.line = line;\n\n\t\t\tif (predicateFn(clientRect)) {\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tresult.push(clientRect);\n\t\t} while ((caretPosition = walkFn(caretPosition)));\n\n\t\treturn result;\n\t}\n\n\treturn {\n\t\tupUntil: upUntil,\n\t\tdownUntil: downUntil,\n\n\t\t/**\n\t\t * Find client rects with line and caret position until the predicate returns true.\n\t\t *\n\t\t * @method positionsUntil\n\t\t * @param {Number} direction Direction forward/backward 1/-1.\n\t\t * @param {DOMNode} rootNode Root node to walk within.\n\t\t * @param {function} predicateFn Gets the client rect as it's input.\n\t\t * @param {DOMNode} node Node to start walking from.\n\t\t * @return {Array} Array of client rects with line and position properties.\n\t\t */\n\t\tpositionsUntil: positionsUntil,\n\n\t\tisAboveLine: curry(aboveLineNumber),\n\t\tisLine: curry(isLine)\n\t};\n});\n\n// Included from: js/tinymce/classes/caret/LineUtils.js\n\n/**\n * LineUtils.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Utility functions for working with lines.\n *\n * @private\n * @class tinymce.caret.LineUtils\n */\ndefine(\"tinymce/caret/LineUtils\", [\n\t\"tinymce/util/Fun\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/Dimensions\",\n\t\"tinymce/geom/ClientRect\",\n\t\"tinymce/caret/CaretUtils\",\n\t\"tinymce/caret/CaretCandidate\"\n], function(Fun, Arr, NodeType, Dimensions, ClientRect, CaretUtils, CaretCandidate) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tfindNode = CaretUtils.findNode,\n\t\tcurry = Fun.curry;\n\n\tfunction distanceToRectLeft(clientRect, clientX) {\n\t\treturn Math.abs(clientRect.left - clientX);\n\t}\n\n\tfunction distanceToRectRight(clientRect, clientX) {\n\t\treturn Math.abs(clientRect.right - clientX);\n\t}\n\n\tfunction findClosestClientRect(clientRects, clientX) {\n\t\tfunction isInside(clientX, clientRect) {\n\t\t\treturn clientX >= clientRect.left && clientX <= clientRect.right;\n\t\t}\n\n\t\treturn Arr.reduce(clientRects, function(oldClientRect, clientRect) {\n\t\t\tvar oldDistance, newDistance;\n\n\t\t\toldDistance = Math.min(distanceToRectLeft(oldClientRect, clientX), distanceToRectRight(oldClientRect, clientX));\n\t\t\tnewDistance = Math.min(distanceToRectLeft(clientRect, clientX), distanceToRectRight(clientRect, clientX));\n\n\t\t\tif (isInside(clientX, clientRect)) {\n\t\t\t\treturn clientRect;\n\t\t\t}\n\n\t\t\tif (isInside(clientX, oldClientRect)) {\n\t\t\t\treturn oldClientRect;\n\t\t\t}\n\n\t\t\t// cE=false has higher priority\n\t\t\tif (newDistance == oldDistance && isContentEditableFalse(clientRect.node)) {\n\t\t\t\treturn clientRect;\n\t\t\t}\n\n\t\t\tif (newDistance < oldDistance) {\n\t\t\t\treturn clientRect;\n\t\t\t}\n\n\t\t\treturn oldClientRect;\n\t\t});\n\t}\n\n\tfunction walkUntil(direction, rootNode, predicateFn, node) {\n\t\twhile ((node = findNode(node, direction, CaretCandidate.isEditableCaretCandidate, rootNode))) {\n\t\t\tif (predicateFn(node)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction findLineNodeRects(rootNode, targetNodeRect) {\n\t\tvar clientRects = [];\n\n\t\tfunction collect(checkPosFn, node) {\n\t\t\tvar lineRects;\n\n\t\t\tlineRects = Arr.filter(Dimensions.getClientRects(node), function(clientRect) {\n\t\t\t\treturn !checkPosFn(clientRect, targetNodeRect);\n\t\t\t});\n\n\t\t\tclientRects = clientRects.concat(lineRects);\n\n\t\t\treturn lineRects.length === 0;\n\t\t}\n\n\t\tclientRects.push(targetNodeRect);\n\t\twalkUntil(-1, rootNode, curry(collect, ClientRect.isAbove), targetNodeRect.node);\n\t\twalkUntil(1, rootNode, curry(collect, ClientRect.isBelow), targetNodeRect.node);\n\n\t\treturn clientRects;\n\t}\n\n\tfunction getContentEditableFalseChildren(rootNode) {\n\t\treturn Arr.filter(Arr.toArray(rootNode.getElementsByTagName('*')), isContentEditableFalse);\n\t}\n\n\tfunction caretInfo(clientRect, clientX) {\n\t\treturn {\n\t\t\tnode: clientRect.node,\n\t\t\tbefore: distanceToRectLeft(clientRect, clientX) < distanceToRectRight(clientRect, clientX)\n\t\t};\n\t}\n\n\tfunction closestCaret(rootNode, clientX, clientY) {\n\t\tvar contentEditableFalseNodeRects, closestNodeRect;\n\n\t\tcontentEditableFalseNodeRects = Dimensions.getClientRects(getContentEditableFalseChildren(rootNode));\n\t\tcontentEditableFalseNodeRects = Arr.filter(contentEditableFalseNodeRects, function(clientRect) {\n\t\t\treturn clientY >= clientRect.top && clientY <= clientRect.bottom;\n\t\t});\n\n\t\tclosestNodeRect = findClosestClientRect(contentEditableFalseNodeRects, clientX);\n\t\tif (closestNodeRect) {\n\t\t\tclosestNodeRect = findClosestClientRect(findLineNodeRects(rootNode, closestNodeRect), clientX);\n\t\t\tif (closestNodeRect && isContentEditableFalse(closestNodeRect.node)) {\n\t\t\t\treturn caretInfo(closestNodeRect, clientX);\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\treturn {\n\t\tfindClosestClientRect: findClosestClientRect,\n\t\tfindLineNodeRects: findLineNodeRects,\n\t\tclosestCaret: closestCaret\n\t};\n});\n\n// Included from: js/tinymce/classes/dom/MousePosition.js\n\n/**\n * MousePosition.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module calculates an absolute coordinate inside the editor body for both local and global mouse events.\n *\n * @private\n * @class tinymce.dom.MousePosition\n */\ndefine(\"tinymce/dom/MousePosition\", [\n], function() {\n\tvar getAbsolutePosition = function (elm) {\n\t\tvar doc, docElem, win, clientRect;\n\n\t\tclientRect = elm.getBoundingClientRect();\n\t\tdoc = elm.ownerDocument;\n\t\tdocElem = doc.documentElement;\n\t\twin = doc.defaultView;\n\n\t\treturn {\n\t\t\ttop: clientRect.top + win.pageYOffset - docElem.clientTop,\n\t\t\tleft: clientRect.left + win.pageXOffset - docElem.clientLeft\n\t\t};\n\t};\n\n\tvar getBodyPosition = function (editor) {\n\t\treturn editor.inline ? getAbsolutePosition(editor.getBody()) : {left: 0, top: 0};\n\t};\n\n\tvar getScrollPosition = function (editor) {\n\t\tvar body = editor.getBody();\n\t\treturn editor.inline ? {left: body.scrollLeft, top: body.scrollTop} : {left: 0, top: 0};\n\t};\n\n\tvar getBodyScroll = function (editor) {\n\t\tvar body = editor.getBody(), docElm = editor.getDoc().documentElement;\n\t\tvar inlineScroll = {left: body.scrollLeft, top: body.scrollTop};\n\t\tvar iframeScroll = {left: body.scrollLeft || docElm.scrollLeft, top: body.scrollTop || docElm.scrollTop};\n\n\t\treturn editor.inline ? inlineScroll : iframeScroll;\n\t};\n\n\tvar getMousePosition = function (editor, event) {\n\t\tif (event.target.ownerDocument !== editor.getDoc()) {\n\t\t\tvar iframePosition = getAbsolutePosition(editor.getContentAreaContainer());\n\t\t\tvar scrollPosition = getBodyScroll(editor);\n\n\t\t\treturn {\n\t\t\t\tleft: event.pageX - iframePosition.left + scrollPosition.left,\n\t\t\t\ttop: event.pageY - iframePosition.top + scrollPosition.top\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tleft: event.pageX,\n\t\t\ttop: event.pageY\n\t\t};\n\t};\n\n\tvar calculatePosition = function (bodyPosition, scrollPosition, mousePosition) {\n\t\treturn {\n\t\t\tpageX: (mousePosition.left - bodyPosition.left) + scrollPosition.left,\n\t\t\tpageY: (mousePosition.top - bodyPosition.top) + scrollPosition.top\n\t\t};\n\t};\n\n\tvar calc = function (editor, event) {\n\t\treturn calculatePosition(getBodyPosition(editor), getScrollPosition(editor), getMousePosition(editor, event));\n\t};\n\n\treturn {\n\t\tcalc: calc\n\t};\n});\n\n// Included from: js/tinymce/classes/DragDropOverrides.js\n\n/**\n * DragDropOverrides.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic overriding the drag/drop logic of the editor.\n *\n * @private\n * @class tinymce.DragDropOverrides\n */\ndefine(\"tinymce/DragDropOverrides\", [\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Fun\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/dom/MousePosition\"\n], function(\n\tNodeType, Arr, Fun, Delay, DOMUtils, MousePosition\n) {\n\tvar isContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisContentEditableTrue = NodeType.isContentEditableTrue;\n\n\tvar isDraggable = function (elm) {\n\t\treturn isContentEditableFalse(elm);\n\t};\n\n\tvar isValidDropTarget = function (editor, targetElement, dragElement) {\n\t\tif (targetElement === dragElement || editor.dom.isChildOf(targetElement, dragElement)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (isContentEditableFalse(targetElement)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tvar cloneElement = function (elm) {\n\t\tvar cloneElm = elm.cloneNode(true);\n\t\tcloneElm.removeAttribute('data-mce-selected');\n\t\treturn cloneElm;\n\t};\n\n\tvar createGhost = function (editor, elm, width, height) {\n\t\tvar clonedElm = elm.cloneNode(true);\n\n\t\teditor.dom.setStyles(clonedElm, {width: width, height: height});\n\t\teditor.dom.setAttrib(clonedElm, 'data-mce-selected', null);\n\n\t\tvar ghostElm = editor.dom.create('div', {\n\t\t\t'class': 'mce-drag-container',\n\t\t\t'data-mce-bogus': 'all',\n\t\t\tunselectable: 'on',\n\t\t\tcontenteditable: 'false'\n\t\t});\n\n\t\teditor.dom.setStyles(ghostElm, {\n\t\t\tposition: 'absolute',\n\t\t\topacity: 0.5,\n\t\t\toverflow: 'hidden',\n\t\t\tborder: 0,\n\t\t\tpadding: 0,\n\t\t\tmargin: 0,\n\t\t\twidth: width,\n\t\t\theight: height\n\t\t});\n\n\t\teditor.dom.setStyles(clonedElm, {\n\t\t\tmargin: 0,\n\t\t\tboxSizing: 'border-box'\n\t\t});\n\n\t\tghostElm.appendChild(clonedElm);\n\n\t\treturn ghostElm;\n\t};\n\n\tvar appendGhostToBody = function (ghostElm, bodyElm) {\n\t\tif (ghostElm.parentNode !== bodyElm) {\n\t\t\tbodyElm.appendChild(ghostElm);\n\t\t}\n\t};\n\n\tvar moveGhost = function (ghostElm, position, width, height, maxX, maxY) {\n\t\tvar overflowX = 0, overflowY = 0;\n\n\t\tghostElm.style.left = position.pageX + 'px';\n\t\tghostElm.style.top = position.pageY + 'px';\n\n\t\tif (position.pageX + width > maxX) {\n\t\t\toverflowX = (position.pageX + width) - maxX;\n\t\t}\n\n\t\tif (position.pageY + height > maxY) {\n\t\t\toverflowY = (position.pageY + height) - maxY;\n\t\t}\n\n\t\tghostElm.style.width = (width - overflowX) + 'px';\n\t\tghostElm.style.height = (height - overflowY) + 'px';\n\t};\n\n\tvar removeElement = function (elm) {\n\t\tif (elm && elm.parentNode) {\n\t\t\telm.parentNode.removeChild(elm);\n\t\t}\n\t};\n\n\tvar isLeftMouseButtonPressed = function (e) {\n\t\treturn e.button === 0;\n\t};\n\n\tvar hasDraggableElement = function (state) {\n\t\treturn state.element;\n\t};\n\n\tvar applyRelPos = function (state, position) {\n\t\treturn {\n\t\t\tpageX: position.pageX - state.relX,\n\t\t\tpageY: position.pageY + 5\n\t\t};\n\t};\n\n\tvar start = function (state, editor) {\n\t\treturn function (e) {\n\t\t\tif (isLeftMouseButtonPressed(e)) {\n\t\t\t\tvar ceElm = Arr.find(editor.dom.getParents(e.target), Fun.or(isContentEditableFalse, isContentEditableTrue));\n\n\t\t\t\tif (isDraggable(ceElm)) {\n\t\t\t\t\tvar elmPos = editor.dom.getPos(ceElm);\n\t\t\t\t\tvar bodyElm = editor.getBody();\n\t\t\t\t\tvar docElm = editor.getDoc().documentElement;\n\n\t\t\t\t\tstate.element = ceElm;\n\t\t\t\t\tstate.screenX = e.screenX;\n\t\t\t\t\tstate.screenY = e.screenY;\n\t\t\t\t\tstate.maxX = (editor.inline ? bodyElm.scrollWidth : docElm.offsetWidth) - 2;\n\t\t\t\t\tstate.maxY = (editor.inline ? bodyElm.scrollHeight : docElm.offsetHeight) - 2;\n\t\t\t\t\tstate.relX = e.pageX - elmPos.x;\n\t\t\t\t\tstate.relY = e.pageY - elmPos.y;\n\t\t\t\t\tstate.width = ceElm.offsetWidth;\n\t\t\t\t\tstate.height = ceElm.offsetHeight;\n\t\t\t\t\tstate.ghost = createGhost(editor, ceElm, state.width, state.height);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t};\n\n\tvar move = function (state, editor) {\n\t\t// Reduces laggy drag behavior on Gecko\n\t\tvar throttledPlaceCaretAt = Delay.throttle(function (clientX, clientY) {\n\t\t\teditor._selectionOverrides.hideFakeCaret();\n\t\t\teditor.selection.placeCaretAt(clientX, clientY);\n\t\t}, 0);\n\n\t\treturn function (e) {\n\t\t\tvar movement = Math.max(Math.abs(e.screenX - state.screenX), Math.abs(e.screenY - state.screenY));\n\n\t\t\tif (hasDraggableElement(state) && !state.dragging && movement > 10) {\n\t\t\t\tvar args = editor.fire('dragstart', {target: state.element});\n\t\t\t\tif (args.isDefaultPrevented()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstate.dragging = true;\n\t\t\t\teditor.focus();\n\t\t\t}\n\n\t\t\tif (state.dragging) {\n\t\t\t\tvar targetPos = applyRelPos(state, MousePosition.calc(editor, e));\n\n\t\t\t\tappendGhostToBody(state.ghost, editor.getBody());\n\t\t\t\tmoveGhost(state.ghost, targetPos, state.width, state.height, state.maxX, state.maxY);\n\n\t\t\t\tthrottledPlaceCaretAt(e.clientX, e.clientY);\n\t\t\t}\n\t\t};\n\t};\n\n\tvar drop = function (state, editor) {\n\t\treturn function (e) {\n\t\t\tif (state.dragging) {\n\t\t\t\tif (isValidDropTarget(editor, editor.selection.getNode(), state.element)) {\n\t\t\t\t\tvar targetClone = cloneElement(state.element);\n\n\t\t\t\t\tvar args = editor.fire('drop', {\n\t\t\t\t\t\ttargetClone: targetClone,\n\t\t\t\t\t\tclientX: e.clientX,\n\t\t\t\t\t\tclientY: e.clientY\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!args.isDefaultPrevented()) {\n\t\t\t\t\t\ttargetClone = args.targetClone;\n\n\t\t\t\t\t\teditor.undoManager.transact(function() {\n\t\t\t\t\t\t\tremoveElement(state.element);\n\t\t\t\t\t\t\teditor.insertContent(editor.dom.getOuterHTML(targetClone));\n\t\t\t\t\t\t\teditor._selectionOverrides.hideFakeCaret();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tremoveDragState(state);\n\t\t};\n\t};\n\n\tvar stop = function (state, editor) {\n\t\treturn function () {\n\t\t\tremoveDragState(state);\n\t\t\tif (state.dragging) {\n\t\t\t\teditor.fire('dragend');\n\t\t\t}\n\t\t};\n\t};\n\n\tvar removeDragState = function (state) {\n\t\tstate.dragging = false;\n\t\tstate.element = null;\n\t\tremoveElement(state.ghost);\n\t};\n\n\tvar bindFakeDragEvents = function (editor) {\n\t\tvar state = {}, pageDom, dragStartHandler, dragHandler, dropHandler, dragEndHandler, rootDocument;\n\n\t\tpageDom = DOMUtils.DOM;\n\t\trootDocument = document;\n\t\tdragStartHandler = start(state, editor);\n\t\tdragHandler = move(state, editor);\n\t\tdropHandler = drop(state, editor);\n\t\tdragEndHandler = stop(state, editor);\n\n\t\teditor.on('mousedown', dragStartHandler);\n\t\teditor.on('mousemove', dragHandler);\n\t\teditor.on('mouseup', dropHandler);\n\n\t\tpageDom.bind(rootDocument, 'mousemove', dragHandler);\n\t\tpageDom.bind(rootDocument, 'mouseup', dragEndHandler);\n\n\t\teditor.on('remove', function () {\n\t\t\tpageDom.unbind(rootDocument, 'mousemove', dragHandler);\n\t\t\tpageDom.unbind(rootDocument, 'mouseup', dragEndHandler);\n\t\t});\n\t};\n\n\tvar blockIeDrop = function (editor) {\n\t\teditor.on('drop', function(e) {\n\t\t\t// FF doesn't pass out clientX/clientY for drop since this is for IE we just use null instead\n\t\t\tvar realTarget = typeof e.clientX !== 'undefined' ? editor.getDoc().elementFromPoint(e.clientX, e.clientY) : null;\n\n\t\t\tif (isContentEditableFalse(realTarget) || isContentEditableFalse(editor.dom.getContentEditableParent(realTarget))) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t});\n\t};\n\n\tvar init = function (editor) {\n\t\tbindFakeDragEvents(editor);\n\t\tblockIeDrop(editor);\n\t};\n\n\treturn {\n\t\tinit: init\n\t};\n});\n\n// Included from: js/tinymce/classes/SelectionOverrides.js\n\n/**\n * SelectionOverrides.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This module contains logic overriding the selection with keyboard/mouse\n * around contentEditable=false regions.\n *\n * @example\n * // Disable the default cE=false selection\n * tinymce.activeEditor.on('ShowCaret BeforeObjectSelected', function(e) {\n *     e.preventDefault();\n * });\n *\n * @private\n * @class tinymce.SelectionOverrides\n */\ndefine(\"tinymce/SelectionOverrides\", [\n\t\"tinymce/Env\",\n\t\"tinymce/caret/CaretWalker\",\n\t\"tinymce/caret/CaretPosition\",\n\t\"tinymce/caret/CaretContainer\",\n\t\"tinymce/caret/CaretUtils\",\n\t\"tinymce/caret/FakeCaret\",\n\t\"tinymce/caret/LineWalker\",\n\t\"tinymce/caret/LineUtils\",\n\t\"tinymce/dom/NodeType\",\n\t\"tinymce/dom/RangeUtils\",\n\t\"tinymce/geom/ClientRect\",\n\t\"tinymce/util/VK\",\n\t\"tinymce/util/Fun\",\n\t\"tinymce/util/Arr\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/DragDropOverrides\",\n\t\"tinymce/text/Zwsp\"\n], function(\n\tEnv, CaretWalker, CaretPosition, CaretContainer, CaretUtils, FakeCaret, LineWalker,\n\tLineUtils, NodeType, RangeUtils, ClientRect, VK, Fun, Arr, Delay, DragDropOverrides, Zwsp\n) {\n\tvar curry = Fun.curry,\n\t\tisContentEditableTrue = NodeType.isContentEditableTrue,\n\t\tisContentEditableFalse = NodeType.isContentEditableFalse,\n\t\tisElement = NodeType.isElement,\n\t\tisAfterContentEditableFalse = CaretUtils.isAfterContentEditableFalse,\n\t\tisBeforeContentEditableFalse = CaretUtils.isBeforeContentEditableFalse,\n\t\tgetSelectedNode = RangeUtils.getSelectedNode;\n\n\tfunction getVisualCaretPosition(walkFn, caretPosition) {\n\t\twhile ((caretPosition = walkFn(caretPosition))) {\n\t\t\tif (caretPosition.isVisible()) {\n\t\t\t\treturn caretPosition;\n\t\t\t}\n\t\t}\n\n\t\treturn caretPosition;\n\t}\n\n\tfunction SelectionOverrides(editor) {\n\t\tvar rootNode = editor.getBody(), caretWalker = new CaretWalker(rootNode);\n\t\tvar getNextVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.next);\n\t\tvar getPrevVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.prev),\n\t\t\tfakeCaret = new FakeCaret(editor.getBody(), isBlock),\n\t\t\trealSelectionId = 'sel-' + editor.dom.uniqueId(),\n\t\t\tselectedContentEditableNode, $ = editor.$;\n\n\t\tfunction getRealSelectionElement() {\n\t\t\tvar container = editor.dom.get(realSelectionId);\n\t\t\treturn container ? container.getElementsByTagName('*')[0] : container;\n\t\t}\n\n\t\tfunction isBlock(node) {\n\t\t\treturn editor.dom.isBlock(node);\n\t\t}\n\n\t\tfunction setRange(range) {\n\t\t\t//console.log('setRange', range);\n\t\t\tif (range) {\n\t\t\t\teditor.selection.setRng(range);\n\t\t\t}\n\t\t}\n\n\t\tfunction getRange() {\n\t\t\treturn editor.selection.getRng();\n\t\t}\n\n\t\tfunction scrollIntoView(node, alignToTop) {\n\t\t\teditor.selection.scrollIntoView(node, alignToTop);\n\t\t}\n\n\t\tfunction showCaret(direction, node, before) {\n\t\t\tvar e;\n\n\t\t\te = editor.fire('ShowCaret', {\n\t\t\t\ttarget: node,\n\t\t\t\tdirection: direction,\n\t\t\t\tbefore: before\n\t\t\t});\n\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tscrollIntoView(node, direction === -1);\n\n\t\t\treturn fakeCaret.show(before, node);\n\t\t}\n\n\t\tfunction selectNode(node) {\n\t\t\tvar e;\n\n\t\t\tfakeCaret.hide();\n\n\t\t\te = editor.fire('BeforeObjectSelected', {target: node});\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn getNodeRange(node);\n\t\t}\n\n\t\tfunction getNodeRange(node) {\n\t\t\tvar rng = node.ownerDocument.createRange();\n\n\t\t\trng.selectNode(node);\n\n\t\t\treturn rng;\n\t\t}\n\n\t\tfunction isMoveInsideSameBlock(fromCaretPosition, toCaretPosition) {\n\t\t\tvar inSameBlock = CaretUtils.isInSameBlock(fromCaretPosition, toCaretPosition);\n\n\t\t\t// Handle bogus BR <p>abc|<br></p>\n\t\t\tif (!inSameBlock && NodeType.isBr(fromCaretPosition.getNode())) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn inSameBlock;\n\t\t}\n\n\t\tfunction getNormalizedRangeEndPoint(direction, range) {\n\t\t\trange = CaretUtils.normalizeRange(direction, rootNode, range);\n\n\t\t\tif (direction == -1) {\n\t\t\t\treturn CaretPosition.fromRangeStart(range);\n\t\t\t}\n\n\t\t\treturn CaretPosition.fromRangeEnd(range);\n\t\t}\n\n\t\tfunction isRangeInCaretContainerBlock(range) {\n\t\t\treturn CaretContainer.isCaretContainerBlock(range.startContainer);\n\t\t}\n\n\t\tfunction moveToCeFalseHorizontally(direction, getNextPosFn, isBeforeContentEditableFalseFn, range) {\n\t\t\tvar node, caretPosition, peekCaretPosition, rangeIsInContainerBlock;\n\n\t\t\tif (!range.collapsed) {\n\t\t\t\tnode = getSelectedNode(range);\n\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\treturn showCaret(direction, node, direction == -1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trangeIsInContainerBlock = isRangeInCaretContainerBlock(range);\n\t\t\tcaretPosition = getNormalizedRangeEndPoint(direction, range);\n\n\t\t\tif (isBeforeContentEditableFalseFn(caretPosition)) {\n\t\t\t\treturn selectNode(caretPosition.getNode(direction == -1));\n\t\t\t}\n\n\t\t\tcaretPosition = getNextPosFn(caretPosition);\n\t\t\tif (!caretPosition) {\n\t\t\t\tif (rangeIsInContainerBlock) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (isBeforeContentEditableFalseFn(caretPosition)) {\n\t\t\t\treturn showCaret(direction, caretPosition.getNode(direction == -1), direction == 1);\n\t\t\t}\n\n\t\t\t// Peek ahead for handling of ab|c<span cE=false> -> abc|<span cE=false>\n\t\t\tpeekCaretPosition = getNextPosFn(caretPosition);\n\t\t\tif (isBeforeContentEditableFalseFn(peekCaretPosition)) {\n\t\t\t\tif (isMoveInsideSameBlock(caretPosition, peekCaretPosition)) {\n\t\t\t\t\treturn showCaret(direction, peekCaretPosition.getNode(direction == -1), direction == 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (rangeIsInContainerBlock) {\n\t\t\t\treturn renderRangeCaret(caretPosition.toRange());\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction moveToCeFalseVertically(direction, walkerFn, range) {\n\t\t\tvar caretPosition, linePositions, nextLinePositions,\n\t\t\t\tclosestNextLineRect, caretClientRect, clientX,\n\t\t\t\tdist1, dist2, contentEditableFalseNode;\n\n\t\t\tcontentEditableFalseNode = getSelectedNode(range);\n\t\t\tcaretPosition = getNormalizedRangeEndPoint(direction, range);\n\t\t\tlinePositions = walkerFn(rootNode, LineWalker.isAboveLine(1), caretPosition);\n\t\t\tnextLinePositions = Arr.filter(linePositions, LineWalker.isLine(1));\n\t\t\tcaretClientRect = Arr.last(caretPosition.getClientRects());\n\n\t\t\tif (isBeforeContentEditableFalse(caretPosition)) {\n\t\t\t\tcontentEditableFalseNode = caretPosition.getNode();\n\t\t\t}\n\n\t\t\tif (isAfterContentEditableFalse(caretPosition)) {\n\t\t\t\tcontentEditableFalseNode = caretPosition.getNode(true);\n\t\t\t}\n\n\t\t\tif (!caretClientRect) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tclientX = caretClientRect.left;\n\n\t\t\tclosestNextLineRect = LineUtils.findClosestClientRect(nextLinePositions, clientX);\n\t\t\tif (closestNextLineRect) {\n\t\t\t\tif (isContentEditableFalse(closestNextLineRect.node)) {\n\t\t\t\t\tdist1 = Math.abs(clientX - closestNextLineRect.left);\n\t\t\t\t\tdist2 = Math.abs(clientX - closestNextLineRect.right);\n\n\t\t\t\t\treturn showCaret(direction, closestNextLineRect.node, dist1 < dist2);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (contentEditableFalseNode) {\n\t\t\t\tvar caretPositions = LineWalker.positionsUntil(direction, rootNode, LineWalker.isAboveLine(1), contentEditableFalseNode);\n\n\t\t\t\tclosestNextLineRect = LineUtils.findClosestClientRect(Arr.filter(caretPositions, LineWalker.isLine(1)), clientX);\n\t\t\t\tif (closestNextLineRect) {\n\t\t\t\t\treturn renderRangeCaret(closestNextLineRect.position.toRange());\n\t\t\t\t}\n\n\t\t\t\tclosestNextLineRect = Arr.last(Arr.filter(caretPositions, LineWalker.isLine(0)));\n\t\t\t\tif (closestNextLineRect) {\n\t\t\t\t\treturn renderRangeCaret(closestNextLineRect.position.toRange());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction exitPreBlock(direction, range) {\n\t\t\tvar pre, caretPos, newBlock;\n\n\t\t\tfunction createTextBlock() {\n\t\t\t\tvar textBlock = editor.dom.create(editor.settings.forced_root_block);\n\n\t\t\t\tif (!Env.ie || Env.ie >= 11) {\n\t\t\t\t\ttextBlock.innerHTML = '<br data-mce-bogus=\"1\">';\n\t\t\t\t}\n\n\t\t\t\treturn textBlock;\n\t\t\t}\n\n\t\t\tif (range.collapsed && editor.settings.forced_root_block) {\n\t\t\t\tpre = editor.dom.getParent(range.startContainer, 'PRE');\n\t\t\t\tif (!pre) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (direction == 1) {\n\t\t\t\t\tcaretPos = getNextVisualCaretPosition(CaretPosition.fromRangeStart(range));\n\t\t\t\t} else {\n\t\t\t\t\tcaretPos = getPrevVisualCaretPosition(CaretPosition.fromRangeStart(range));\n\t\t\t\t}\n\n\t\t\t\tif (!caretPos) {\n\t\t\t\t\tnewBlock = createTextBlock();\n\n\t\t\t\t\tif (direction == 1) {\n\t\t\t\t\t\teditor.$(pre).after(newBlock);\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.$(pre).before(newBlock);\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.selection.select(newBlock, true);\n\t\t\t\t\teditor.selection.collapse();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction moveH(direction, getNextPosFn, isBeforeContentEditableFalseFn, range) {\n\t\t\tvar newRange;\n\n\t\t\tnewRange = moveToCeFalseHorizontally(direction, getNextPosFn, isBeforeContentEditableFalseFn, range);\n\t\t\tif (newRange) {\n\t\t\t\treturn newRange;\n\t\t\t}\n\n\t\t\tnewRange = exitPreBlock(direction, range);\n\t\t\tif (newRange) {\n\t\t\t\treturn newRange;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction moveV(direction, walkerFn, range) {\n\t\t\tvar newRange;\n\n\t\t\tnewRange = moveToCeFalseVertically(direction, walkerFn, range);\n\t\t\tif (newRange) {\n\t\t\t\treturn newRange;\n\t\t\t}\n\n\t\t\tnewRange = exitPreBlock(direction, range);\n\t\t\tif (newRange) {\n\t\t\t\treturn newRange;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction getBlockCaretContainer() {\n\t\t\treturn $('*[data-mce-caret]')[0];\n\t\t}\n\n\t\tfunction showBlockCaretContainer(blockCaretContainer) {\n\t\t\tblockCaretContainer = $(blockCaretContainer);\n\n\t\t\tif (blockCaretContainer.attr('data-mce-caret')) {\n\t\t\t\tfakeCaret.hide();\n\t\t\t\tblockCaretContainer.removeAttr('data-mce-caret');\n\t\t\t\tblockCaretContainer.removeAttr('data-mce-bogus');\n\t\t\t\tblockCaretContainer.removeAttr('style');\n\n\t\t\t\t// Removes control rect on IE\n\t\t\t\tsetRange(getRange());\n\t\t\t\tscrollIntoView(blockCaretContainer[0]);\n\t\t\t}\n\t\t}\n\n\t\tfunction renderCaretAtRange(range) {\n\t\t\tvar caretPosition, ceRoot;\n\n\t\t\trange = CaretUtils.normalizeRange(1, rootNode, range);\n\t\t\tcaretPosition = CaretPosition.fromRangeStart(range);\n\n\t\t\tif (isContentEditableFalse(caretPosition.getNode())) {\n\t\t\t\treturn showCaret(1, caretPosition.getNode(), !caretPosition.isAtEnd());\n\t\t\t}\n\n\t\t\tif (isContentEditableFalse(caretPosition.getNode(true))) {\n\t\t\t\treturn showCaret(1, caretPosition.getNode(true), false);\n\t\t\t}\n\n\t\t\t// TODO: Should render caret before/after depending on where you click on the page forces after now\n\t\t\tceRoot = editor.dom.getParent(caretPosition.getNode(), Fun.or(isContentEditableFalse, isContentEditableTrue));\n\t\t\tif (isContentEditableFalse(ceRoot)) {\n\t\t\t\treturn showCaret(1, ceRoot, false);\n\t\t\t}\n\n\t\t\tfakeCaret.hide();\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction renderRangeCaret(range) {\n\t\t\tvar caretRange;\n\n\t\t\tif (!range || !range.collapsed) {\n\t\t\t\treturn range;\n\t\t\t}\n\n\t\t\tcaretRange = renderCaretAtRange(range);\n\t\t\tif (caretRange) {\n\t\t\t\treturn caretRange;\n\t\t\t}\n\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction deleteContentEditableNode(node) {\n\t\t\tvar nextCaretPosition, prevCaretPosition, prevCeFalseElm, nextElement;\n\n\t\t\tif (!isContentEditableFalse(node)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (isContentEditableFalse(node.previousSibling)) {\n\t\t\t\tprevCeFalseElm = node.previousSibling;\n\t\t\t}\n\n\t\t\tprevCaretPosition = getPrevVisualCaretPosition(CaretPosition.before(node));\n\t\t\tif (!prevCaretPosition) {\n\t\t\t\tnextCaretPosition = getNextVisualCaretPosition(CaretPosition.after(node));\n\t\t\t}\n\n\t\t\tif (nextCaretPosition && isElement(nextCaretPosition.getNode())) {\n\t\t\t\tnextElement = nextCaretPosition.getNode();\n\t\t\t}\n\n\t\t\tCaretContainer.remove(node.previousSibling);\n\t\t\tCaretContainer.remove(node.nextSibling);\n\t\t\teditor.dom.remove(node);\n\t\t\tclearContentEditableSelection();\n\n\t\t\tif (editor.dom.isEmpty(editor.getBody())) {\n\t\t\t\teditor.setContent('');\n\t\t\t\teditor.focus();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (prevCeFalseElm) {\n\t\t\t\treturn CaretPosition.after(prevCeFalseElm).toRange();\n\t\t\t}\n\n\t\t\tif (nextElement) {\n\t\t\t\treturn CaretPosition.before(nextElement).toRange();\n\t\t\t}\n\n\t\t\tif (prevCaretPosition) {\n\t\t\t\treturn prevCaretPosition.toRange();\n\t\t\t}\n\n\t\t\tif (nextCaretPosition) {\n\t\t\t\treturn nextCaretPosition.toRange();\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction isTextBlock(node) {\n\t\t\tvar textBlocks = editor.schema.getTextBlockElements();\n\t\t\treturn node.nodeName in textBlocks;\n\t\t}\n\n\t\tfunction isEmpty(elm) {\n\t\t\treturn editor.dom.isEmpty(elm);\n\t\t}\n\n\t\tfunction mergeTextBlocks(direction, fromCaretPosition, toCaretPosition) {\n\t\t\tvar dom = editor.dom, fromBlock, toBlock, node, ceTarget;\n\n\t\t\tfromBlock = dom.getParent(fromCaretPosition.getNode(), dom.isBlock);\n\t\t\ttoBlock = dom.getParent(toCaretPosition.getNode(), dom.isBlock);\n\n\t\t\tif (direction === -1) {\n\t\t\t\tceTarget = toCaretPosition.getNode(true);\n\t\t\t\tif (isAfterContentEditableFalse(toCaretPosition) && isBlock(ceTarget)) {\n\t\t\t\t\tif (isTextBlock(fromBlock)) {\n\t\t\t\t\t\tif (isEmpty(fromBlock)) {\n\t\t\t\t\t\t\tdom.remove(fromBlock);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn CaretPosition.after(ceTarget).toRange();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn deleteContentEditableNode(toCaretPosition.getNode(true));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tceTarget = fromCaretPosition.getNode();\n\t\t\t\tif (isBeforeContentEditableFalse(fromCaretPosition) && isBlock(ceTarget)) {\n\t\t\t\t\tif (isTextBlock(toBlock)) {\n\t\t\t\t\t\tif (isEmpty(toBlock)) {\n\t\t\t\t\t\t\tdom.remove(toBlock);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn CaretPosition.before(ceTarget).toRange();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn deleteContentEditableNode(fromCaretPosition.getNode());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Verify that both blocks are text blocks\n\t\t\tif (fromBlock === toBlock || !isTextBlock(fromBlock) || !isTextBlock(toBlock)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\twhile ((node = fromBlock.firstChild)) {\n\t\t\t\ttoBlock.appendChild(node);\n\t\t\t}\n\n\t\t\teditor.dom.remove(fromBlock);\n\n\t\t\treturn toCaretPosition.toRange();\n\t\t}\n\n\t\tfunction backspaceDelete(direction, beforeFn, afterFn, range) {\n\t\t\tvar node, caretPosition, peekCaretPosition, newCaretPosition;\n\n\t\t\tif (!range.collapsed) {\n\t\t\t\tnode = getSelectedNode(range);\n\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\treturn renderRangeCaret(deleteContentEditableNode(node));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcaretPosition = getNormalizedRangeEndPoint(direction, range);\n\n\t\t\tif (afterFn(caretPosition) && CaretContainer.isCaretContainerBlock(range.startContainer)) {\n\t\t\t\tnewCaretPosition = direction == -1 ? caretWalker.prev(caretPosition) : caretWalker.next(caretPosition);\n\t\t\t\treturn newCaretPosition ? renderRangeCaret(newCaretPosition.toRange()) : range;\n\t\t\t}\n\n\t\t\tif (beforeFn(caretPosition)) {\n\t\t\t\treturn renderRangeCaret(deleteContentEditableNode(caretPosition.getNode(direction == -1)));\n\t\t\t}\n\n\t\t\tpeekCaretPosition = direction == -1 ? caretWalker.prev(caretPosition) : caretWalker.next(caretPosition);\n\t\t\tif (beforeFn(peekCaretPosition)) {\n\t\t\t\tif (direction === -1) {\n\t\t\t\t\treturn mergeTextBlocks(direction, caretPosition, peekCaretPosition);\n\t\t\t\t}\n\n\t\t\t\treturn mergeTextBlocks(direction, peekCaretPosition, caretPosition);\n\t\t\t}\n\t\t}\n\n\t\tfunction registerEvents() {\n\t\t\tvar right = curry(moveH, 1, getNextVisualCaretPosition, isBeforeContentEditableFalse);\n\t\t\tvar left = curry(moveH, -1, getPrevVisualCaretPosition, isAfterContentEditableFalse);\n\t\t\tvar deleteForward = curry(backspaceDelete, 1, isBeforeContentEditableFalse, isAfterContentEditableFalse);\n\t\t\tvar backspace = curry(backspaceDelete, -1, isAfterContentEditableFalse, isBeforeContentEditableFalse);\n\t\t\tvar up = curry(moveV, -1, LineWalker.upUntil);\n\t\t\tvar down = curry(moveV, 1, LineWalker.downUntil);\n\n\t\t\tfunction override(evt, moveFn) {\n\t\t\t\tvar range = moveFn(getRange());\n\n\t\t\t\tif (range && !evt.isDefaultPrevented()) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\tsetRange(range);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction getContentEditableRoot(node) {\n\t\t\t\tvar root = editor.getBody();\n\n\t\t\t\twhile (node && node != root) {\n\t\t\t\t\tif (isContentEditableTrue(node) || isContentEditableFalse(node)) {\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tfunction isXYWithinRange(clientX, clientY, range) {\n\t\t\t\tif (range.collapsed) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn Arr.reduce(range.getClientRects(), function(state, rect) {\n\t\t\t\t\treturn state || ClientRect.containsXY(rect, clientX, clientY);\n\t\t\t\t}, false);\n\t\t\t}\n\n\t\t\t// Some browsers (Chrome) lets you place the caret after a cE=false\n\t\t\t// Make sure we render the caret container in this case\n\t\t\teditor.on('mouseup', function() {\n\t\t\t\tvar range = getRange();\n\n\t\t\t\tif (range.collapsed) {\n\t\t\t\t\tsetRange(renderCaretAtRange(range));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('click', function(e) {\n\t\t\t\tvar contentEditableRoot;\n\n\t\t\t\t// Prevent clicks on links in a cE=false element\n\t\t\t\tcontentEditableRoot\t= getContentEditableRoot(e.target);\n\t\t\t\tif (contentEditableRoot) {\n\t\t\t\t\tif (isContentEditableFalse(contentEditableRoot)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\teditor.focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfunction handleTouchSelect(editor) {\n\t\t\t\tvar moved = false;\n\n\t\t\t\teditor.on('touchstart', function () {\n\t\t\t\t\tmoved = false;\n\t\t\t\t});\n\n\t\t\t\teditor.on('touchmove', function () {\n\t\t\t\t\tmoved = true;\n\t\t\t\t});\n\n\t\t\t\teditor.on('touchend', function (e) {\n\t\t\t\t\tvar contentEditableRoot\t= getContentEditableRoot(e.target);\n\n\t\t\t\t\tif (isContentEditableFalse(contentEditableRoot)) {\n\t\t\t\t\t\tif (!moved) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tsetContentEditableSelection(selectNode(contentEditableRoot));\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tclearContentEditableSelection();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar hasNormalCaretPosition = function (elm) {\n\t\t\t\tvar caretWalker = new CaretWalker(elm);\n\n\t\t\t\tif (!elm.firstChild) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar startPos = CaretPosition.before(elm.firstChild);\n\t\t\t\tvar newPos = caretWalker.next(startPos);\n\n\t\t\t\treturn newPos && !isBeforeContentEditableFalse(newPos) && !isAfterContentEditableFalse(newPos);\n\t\t\t};\n\n\t\t\tvar isInSameBlock = function (node1, node2) {\n\t\t\t\tvar block1 = editor.dom.getParent(node1, editor.dom.isBlock);\n\t\t\t\tvar block2 = editor.dom.getParent(node2, editor.dom.isBlock);\n\t\t\t\treturn block1 === block2;\n\t\t\t};\n\n\t\t\t// Checks if the target node is in a block and if that block has a caret position better than the\n\t\t\t// suggested caretNode this is to prevent the caret from being sucked in towards a cE=false block if\n\t\t\t// they are adjacent on the vertical axis\n\t\t\tvar hasBetterMouseTarget = function (targetNode, caretNode) {\n\t\t\t\tvar targetBlock = editor.dom.getParent(targetNode, editor.dom.isBlock);\n\t\t\t\tvar caretBlock = editor.dom.getParent(caretNode, editor.dom.isBlock);\n\n\t\t\t\treturn targetBlock && !isInSameBlock(targetBlock, caretBlock) && hasNormalCaretPosition(targetBlock);\n\t\t\t};\n\n\t\t\thandleTouchSelect(editor);\n\n\t\t\teditor.on('mousedown', function(e) {\n\t\t\t\tvar contentEditableRoot;\n\n\t\t\t\tcontentEditableRoot\t= getContentEditableRoot(e.target);\n\t\t\t\tif (contentEditableRoot) {\n\t\t\t\t\tif (isContentEditableFalse(contentEditableRoot)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tsetContentEditableSelection(selectNode(contentEditableRoot));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tclearContentEditableSelection();\n\n\t\t\t\t\t\tif (!isXYWithinRange(e.clientX, e.clientY, editor.selection.getRng())) {\n\t\t\t\t\t\t\teditor.selection.placeCaretAt(e.clientX, e.clientY);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tclearContentEditableSelection();\n\t\t\t\t\tfakeCaret.hide();\n\n\t\t\t\t\tvar caretInfo = LineUtils.closestCaret(rootNode, e.clientX, e.clientY);\n\t\t\t\t\tif (caretInfo) {\n\t\t\t\t\t\tif (!hasBetterMouseTarget(e.target, caretInfo.node)) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\teditor.getBody().focus();\n\t\t\t\t\t\t\tsetRange(showCaret(1, caretInfo.node, caretInfo.before));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('keydown', function(e) {\n\t\t\t\tif (VK.modifierPressed(e)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tswitch (e.keyCode) {\n\t\t\t\t\tcase VK.RIGHT:\n\t\t\t\t\t\toverride(e, right);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.DOWN:\n\t\t\t\t\t\toverride(e, down);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.LEFT:\n\t\t\t\t\t\toverride(e, left);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.UP:\n\t\t\t\t\t\toverride(e, up);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.DELETE:\n\t\t\t\t\t\toverride(e, deleteForward);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.BACKSPACE:\n\t\t\t\t\t\toverride(e, backspace);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tif (isContentEditableFalse(editor.selection.getNode())) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfunction paddEmptyContentEditableArea() {\n\t\t\t\tvar br, ceRoot = getContentEditableRoot(editor.selection.getNode());\n\n\t\t\t\tif (isContentEditableTrue(ceRoot) && isBlock(ceRoot) && editor.dom.isEmpty(ceRoot)) {\n\t\t\t\t\tbr = editor.dom.create('br', {\"data-mce-bogus\": \"1\"});\n\t\t\t\t\teditor.$(ceRoot).empty().append(br);\n\t\t\t\t\teditor.selection.setRng(CaretPosition.before(br).toRange());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleBlockContainer(e) {\n\t\t\t\tvar blockCaretContainer = getBlockCaretContainer();\n\n\t\t\t\tif (!blockCaretContainer) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.type == 'compositionstart') {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tshowBlockCaretContainer(blockCaretContainer);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (blockCaretContainer.innerHTML != '&nbsp;') {\n\t\t\t\t\tshowBlockCaretContainer(blockCaretContainer);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleEmptyBackspaceDelete(e) {\n\t\t\t\tvar prevent;\n\n\t\t\t\tswitch (e.keyCode) {\n\t\t\t\t\tcase VK.DELETE:\n\t\t\t\t\t\tprevent = paddEmptyContentEditableArea();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase VK.BACKSPACE:\n\t\t\t\t\t\tprevent = paddEmptyContentEditableArea();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (prevent) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Must be added to \"top\" since undoManager needs to be executed after\n\t\t\teditor.on('keyup compositionstart', function(e) {\n\t\t\t\thandleBlockContainer(e);\n\t\t\t\thandleEmptyBackspaceDelete(e);\n\t\t\t}, true);\n\n\t\t\teditor.on('cut', function() {\n\t\t\t\tvar node = editor.selection.getNode();\n\n\t\t\t\tif (isContentEditableFalse(node)) {\n\t\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\t\tsetRange(renderRangeCaret(deleteContentEditableNode(node)));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('getSelectionRange', function(e) {\n\t\t\t\tvar rng = e.range;\n\n\t\t\t\tif (selectedContentEditableNode) {\n\t\t\t\t\tif (!selectedContentEditableNode.parentNode) {\n\t\t\t\t\t\tselectedContentEditableNode = null;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\trng = rng.cloneRange();\n\t\t\t\t\trng.selectNode(selectedContentEditableNode);\n\t\t\t\t\te.range = rng;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('setSelectionRange', function(e) {\n\t\t\t\tvar rng;\n\n\t\t\t\trng = setContentEditableSelection(e.range);\n\t\t\t\tif (rng) {\n\t\t\t\t\te.range = rng;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('focus', function() {\n\t\t\t\t// Make sure we have a proper fake caret on focus\n\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\teditor.selection.setRng(renderRangeCaret(editor.selection.getRng()));\n\t\t\t\t}, 0);\n\t\t\t});\n\n\t\t\teditor.on('copy', function (e) {\n\t\t\t\tvar clipboardData = e.clipboardData;\n\n\t\t\t\t// Make sure we get proper html/text for the fake cE=false selection\n\t\t\t\t// Doesn't work at all on Edge since it doesn't have proper clipboardData support\n\t\t\t\tif (!e.isDefaultPrevented() && e.clipboardData && !Env.ie) {\n\t\t\t\t\tvar realSelectionElement = getRealSelectionElement();\n\t\t\t\t\tif (realSelectionElement) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tclipboardData.clearData();\n\t\t\t\t\t\tclipboardData.setData('text/html', realSelectionElement.outerHTML);\n\t\t\t\t\t\tclipboardData.setData('text/plain', realSelectionElement.outerText);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tDragDropOverrides.init(editor);\n\t\t}\n\n\t\tfunction addCss() {\n\t\t\tvar styles = editor.contentStyles, rootClass = '.mce-content-body';\n\n\t\t\tstyles.push(fakeCaret.getCss());\n\t\t\tstyles.push(\n\t\t\t\trootClass + ' .mce-offscreen-selection {' +\n\t\t\t\t\t'position: absolute;' +\n\t\t\t\t\t'left: -9999999999px;' +\n\t\t\t\t'}' +\n\t\t\t\trootClass + ' *[contentEditable=false] {' +\n\t\t\t\t\t'cursor: default;' +\n\t\t\t\t'}' +\n\t\t\t\trootClass + ' *[contentEditable=true] {' +\n\t\t\t\t\t'cursor: text;' +\n\t\t\t\t'}'\n\t\t\t);\n\t\t}\n\n\t\tfunction isRangeInCaretContainer(rng) {\n\t\t\treturn CaretContainer.isCaretContainer(rng.startContainer) || CaretContainer.isCaretContainer(rng.endContainer);\n\t\t}\n\n\t\tfunction setContentEditableSelection(range) {\n\t\t\tvar node, $ = editor.$, dom = editor.dom, $realSelectionContainer, sel,\n\t\t\t\tstartContainer, startOffset, endOffset, e, caretPosition, targetClone, origTargetClone;\n\n\t\t\tif (!range) {\n\t\t\t\tclearContentEditableSelection();\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (range.collapsed) {\n\t\t\t\tclearContentEditableSelection();\n\n\t\t\t\tif (!isRangeInCaretContainer(range)) {\n\t\t\t\t\tcaretPosition = getNormalizedRangeEndPoint(1, range);\n\n\t\t\t\t\tif (isContentEditableFalse(caretPosition.getNode())) {\n\t\t\t\t\t\treturn showCaret(1, caretPosition.getNode(), !caretPosition.isAtEnd());\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isContentEditableFalse(caretPosition.getNode(true))) {\n\t\t\t\t\t\treturn showCaret(1, caretPosition.getNode(true), false);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tstartContainer = range.startContainer;\n\t\t\tstartOffset = range.startOffset;\n\t\t\tendOffset = range.endOffset;\n\n\t\t\t// Normalizes <span cE=false>[</span>] to [<span cE=false></span>]\n\t\t\tif (startContainer.nodeType == 3 && startOffset == 0 && isContentEditableFalse(startContainer.parentNode)) {\n\t\t\t\tstartContainer = startContainer.parentNode;\n\t\t\t\tstartOffset = dom.nodeIndex(startContainer);\n\t\t\t\tstartContainer = startContainer.parentNode;\n\t\t\t}\n\n\t\t\tif (startContainer.nodeType != 1) {\n\t\t\t\tclearContentEditableSelection();\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (endOffset == startOffset + 1) {\n\t\t\t\tnode = startContainer.childNodes[startOffset];\n\t\t\t}\n\n\t\t\tif (!isContentEditableFalse(node)) {\n\t\t\t\tclearContentEditableSelection();\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\ttargetClone = origTargetClone = node.cloneNode(true);\n\t\t\te = editor.fire('ObjectSelected', {target: node, targetClone: targetClone});\n\t\t\tif (e.isDefaultPrevented()) {\n\t\t\t\tclearContentEditableSelection();\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\ttargetClone = e.targetClone;\n\t\t\t$realSelectionContainer = $('#' + realSelectionId);\n\t\t\tif ($realSelectionContainer.length === 0) {\n\t\t\t\t$realSelectionContainer = $(\n\t\t\t\t\t'<div data-mce-bogus=\"all\" class=\"mce-offscreen-selection\"></div>'\n\t\t\t\t).attr('id', realSelectionId);\n\n\t\t\t\t$realSelectionContainer.appendTo(editor.getBody());\n\t\t\t}\n\n\t\t\trange = editor.dom.createRng();\n\n\t\t\t// WHY is IE making things so hard! Copy on <i contentEditable=\"false\">x</i> produces: <em>x</em>\n\t\t\tif (targetClone === origTargetClone && Env.ie) {\n\t\t\t\t$realSelectionContainer.empty().append(Zwsp.ZWSP).append(targetClone).append(Zwsp.ZWSP);\n\t\t\t\trange.setStart($realSelectionContainer[0].firstChild, 0);\n\t\t\t\trange.setEnd($realSelectionContainer[0].lastChild, 1);\n\t\t\t} else {\n\t\t\t\t$realSelectionContainer.empty().append('\\u00a0').append(targetClone).append('\\u00a0');\n\t\t\t\trange.setStart($realSelectionContainer[0].firstChild, 1);\n\t\t\t\trange.setEnd($realSelectionContainer[0].lastChild, 0);\n\t\t\t}\n\n\t\t\t$realSelectionContainer.css({\n\t\t\t\ttop: dom.getPos(node, editor.getBody()).y\n\t\t\t});\n\n\t\t\t$realSelectionContainer[0].focus();\n\t\t\tsel = editor.selection.getSel();\n\t\t\tsel.removeAllRanges();\n\t\t\tsel.addRange(range);\n\n\t\t\teditor.$('*[data-mce-selected]').removeAttr('data-mce-selected');\n\t\t\tnode.setAttribute('data-mce-selected', 1);\n\t\t\tselectedContentEditableNode = node;\n\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction clearContentEditableSelection() {\n\t\t\tif (selectedContentEditableNode) {\n\t\t\t\tselectedContentEditableNode.removeAttribute('data-mce-selected');\n\t\t\t\teditor.$('#' + realSelectionId).remove();\n\t\t\t\tselectedContentEditableNode = null;\n\t\t\t}\n\t\t}\n\n\t\tfunction destroy() {\n\t\t\tfakeCaret.destroy();\n\t\t\tselectedContentEditableNode = null;\n\t\t}\n\n\t\tfunction hideFakeCaret() {\n\t\t\tfakeCaret.hide();\n\t\t}\n\n\t\tif (Env.ceFalse) {\n\t\t\tregisterEvents();\n\t\t\taddCss();\n\t\t}\n\n\t\treturn {\n\t\t\tshowBlockCaretContainer: showBlockCaretContainer,\n\t\t\thideFakeCaret: hideFakeCaret,\n\t\t\tdestroy: destroy\n\t\t};\n\t}\n\n\treturn SelectionOverrides;\n});\n\n// Included from: js/tinymce/classes/util/Uuid.js\n\n/**\n * Uuid.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Generates unique ids.\n *\n * @class tinymce.util.Uuid\n * @private\n */\ndefine(\"tinymce/util/Uuid\", [\n], function() {\n\tvar count = 0;\n\n\tvar seed = function () {\n\t\tvar rnd = function () {\n\t\t\treturn Math.round(Math.random() * 0xFFFFFFFF).toString(36);\n\t\t};\n\n\t\tvar now = new Date().getTime();\n\t\treturn 's' + now.toString(36) + rnd() + rnd() + rnd();\n\t};\n\n\tvar uuid = function (prefix) {\n\t\treturn prefix + (count++) + seed();\n\t};\n\n\treturn {\n\t\tuuid: uuid\n\t};\n});\n\n// Included from: js/tinymce/classes/Editor.js\n\n/**\n * Editor.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*jshint scripturl:true */\n\n/**\n * Include the base event class documentation.\n *\n * @include ../../../tools/docs/tinymce.Event.js\n */\n\n/**\n * This class contains the core logic for a TinyMCE editor.\n *\n * @class tinymce.Editor\n * @mixes tinymce.util.Observable\n * @example\n * // Add a class to all paragraphs in the editor.\n * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'someclass');\n *\n * // Gets the current editors selection as text\n * tinymce.activeEditor.selection.getContent({format: 'text'});\n *\n * // Creates a new editor instance\n * var ed = new tinymce.Editor('textareaid', {\n *     some_setting: 1\n * }, tinymce.EditorManager);\n *\n * // Select each item the user clicks on\n * ed.on('click', function(e) {\n *     ed.selection.select(e.target);\n * });\n *\n * ed.render();\n */\ndefine(\"tinymce/Editor\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/AddOnManager\",\n\t\"tinymce/NodeChange\",\n\t\"tinymce/html/Node\",\n\t\"tinymce/dom/Serializer\",\n\t\"tinymce/html/Serializer\",\n\t\"tinymce/dom/Selection\",\n\t\"tinymce/Formatter\",\n\t\"tinymce/UndoManager\",\n\t\"tinymce/EnterKey\",\n\t\"tinymce/ForceBlocks\",\n\t\"tinymce/EditorCommands\",\n\t\"tinymce/util/URI\",\n\t\"tinymce/dom/ScriptLoader\",\n\t\"tinymce/dom/EventUtils\",\n\t\"tinymce/WindowManager\",\n\t\"tinymce/NotificationManager\",\n\t\"tinymce/html/Schema\",\n\t\"tinymce/html/DomParser\",\n\t\"tinymce/util/Quirks\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/EditorObservable\",\n\t\"tinymce/Mode\",\n\t\"tinymce/Shortcuts\",\n\t\"tinymce/EditorUpload\",\n\t\"tinymce/SelectionOverrides\",\n\t\"tinymce/util/Uuid\"\n], function(\n\tDOMUtils, DomQuery, AddOnManager, NodeChange, Node, DomSerializer, Serializer,\n\tSelection, Formatter, UndoManager, EnterKey, ForceBlocks, EditorCommands,\n\tURI, ScriptLoader, EventUtils, WindowManager, NotificationManager,\n\tSchema, DomParser, Quirks, Env, Tools, Delay, EditorObservable, Mode, Shortcuts, EditorUpload,\n\tSelectionOverrides, Uuid\n) {\n\t// Shorten these names\n\tvar DOM = DOMUtils.DOM, ThemeManager = AddOnManager.ThemeManager, PluginManager = AddOnManager.PluginManager;\n\tvar extend = Tools.extend, each = Tools.each, explode = Tools.explode;\n\tvar inArray = Tools.inArray, trim = Tools.trim, resolve = Tools.resolve;\n\tvar Event = EventUtils.Event;\n\tvar isGecko = Env.gecko, ie = Env.ie;\n\n\t/**\n\t * Include documentation for all the events.\n\t *\n\t * @include ../../../tools/docs/tinymce.Editor.js\n\t */\n\n\t/**\n\t * Constructs a editor instance by id.\n\t *\n\t * @constructor\n\t * @method Editor\n\t * @param {String} id Unique id for the editor.\n\t * @param {Object} settings Settings for the editor.\n\t * @param {tinymce.EditorManager} editorManager EditorManager instance.\n\t */\n\tfunction Editor(id, settings, editorManager) {\n\t\tvar self = this, documentBaseUrl, baseUri, defaultSettings;\n\n\t\tdocumentBaseUrl = self.documentBaseUrl = editorManager.documentBaseURL;\n\t\tbaseUri = editorManager.baseURI;\n\t\tdefaultSettings = editorManager.defaultSettings;\n\n\t\t/**\n\t\t * Name/value collection with editor settings.\n\t\t *\n\t\t * @property settings\n\t\t * @type Object\n\t\t * @example\n\t\t * // Get the value of the theme setting\n\t\t * tinymce.activeEditor.windowManager.alert(\"You are using the \" + tinymce.activeEditor.settings.theme + \" theme\");\n\t\t */\n\t\tsettings = extend({\n\t\t\tid: id,\n\t\t\ttheme: 'modern',\n\t\t\tdelta_width: 0,\n\t\t\tdelta_height: 0,\n\t\t\tpopup_css: '',\n\t\t\tplugins: '',\n\t\t\tdocument_base_url: documentBaseUrl,\n\t\t\tadd_form_submit_trigger: true,\n\t\t\tsubmit_patch: true,\n\t\t\tadd_unload_trigger: true,\n\t\t\tconvert_urls: true,\n\t\t\trelative_urls: true,\n\t\t\tremove_script_host: true,\n\t\t\tobject_resizing: true,\n\t\t\tdoctype: '<!DOCTYPE html>',\n\t\t\tvisual: true,\n\t\t\tfont_size_style_values: 'xx-small,x-small,small,medium,large,x-large,xx-large',\n\n\t\t\t// See: http://www.w3.org/TR/CSS2/fonts.html#propdef-font-size\n\t\t\tfont_size_legacy_values: 'xx-small,small,medium,large,x-large,xx-large,300%',\n\t\t\tforced_root_block: 'p',\n\t\t\thidden_input: true,\n\t\t\tpadd_empty_editor: true,\n\t\t\trender_ui: true,\n\t\t\tindentation: '30px',\n\t\t\tinline_styles: true,\n\t\t\tconvert_fonts_to_spans: true,\n\t\t\tindent: 'simple',\n\t\t\tindent_before: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' +\n\t\t\t\t'tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n\t\t\tindent_after: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' +\n\t\t\t\t'tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\n\t\t\tvalidate: true,\n\t\t\tentity_encoding: 'named',\n\t\t\turl_converter: self.convertURL,\n\t\t\turl_converter_scope: self,\n\t\t\tie7_compat: true\n\t\t}, defaultSettings, settings);\n\n\t\t// Merge external_plugins\n\t\tif (defaultSettings && defaultSettings.external_plugins && settings.external_plugins) {\n\t\t\tsettings.external_plugins = extend({}, defaultSettings.external_plugins, settings.external_plugins);\n\t\t}\n\n\t\tself.settings = settings;\n\t\tAddOnManager.language = settings.language || 'en';\n\t\tAddOnManager.languageLoad = settings.language_load;\n\t\tAddOnManager.baseURL = editorManager.baseURL;\n\n\t\t/**\n\t\t * Editor instance id, normally the same as the div/textarea that was replaced.\n\t\t *\n\t\t * @property id\n\t\t * @type String\n\t\t */\n\t\tself.id = settings.id = id;\n\n\t\t/**\n\t\t * State to force the editor to return false on a isDirty call.\n\t\t *\n\t\t * @property isNotDirty\n\t\t * @type Boolean\n\t\t * @deprecated Use editor.setDirty instead.\n\t\t */\n\t\tself.setDirty(false);\n\n\t\t/**\n\t\t * Name/Value object containing plugin instances.\n\t\t *\n\t\t * @property plugins\n\t\t * @type Object\n\t\t * @example\n\t\t * // Execute a method inside a plugin directly\n\t\t * tinymce.activeEditor.plugins.someplugin.someMethod();\n\t\t */\n\t\tself.plugins = {};\n\n\t\t/**\n\t\t * URI object to document configured for the TinyMCE instance.\n\t\t *\n\t\t * @property documentBaseURI\n\t\t * @type tinymce.util.URI\n\t\t * @example\n\t\t * // Get relative URL from the location of document_base_url\n\t\t * tinymce.activeEditor.documentBaseURI.toRelative('/somedir/somefile.htm');\n\t\t *\n\t\t * // Get absolute URL from the location of document_base_url\n\t\t * tinymce.activeEditor.documentBaseURI.toAbsolute('somefile.htm');\n\t\t */\n\t\tself.documentBaseURI = new URI(settings.document_base_url || documentBaseUrl, {\n\t\t\tbase_uri: baseUri\n\t\t});\n\n\t\t/**\n\t\t * URI object to current document that holds the TinyMCE editor instance.\n\t\t *\n\t\t * @property baseURI\n\t\t * @type tinymce.util.URI\n\t\t * @example\n\t\t * // Get relative URL from the location of the API\n\t\t * tinymce.activeEditor.baseURI.toRelative('/somedir/somefile.htm');\n\t\t *\n\t\t * // Get absolute URL from the location of the API\n\t\t * tinymce.activeEditor.baseURI.toAbsolute('somefile.htm');\n\t\t */\n\t\tself.baseURI = baseUri;\n\n\t\t/**\n\t\t * Array with CSS files to load into the iframe.\n\t\t *\n\t\t * @property contentCSS\n\t\t * @type Array\n\t\t */\n\t\tself.contentCSS = [];\n\n\t\t/**\n\t\t * Array of CSS styles to add to head of document when the editor loads.\n\t\t *\n\t\t * @property contentStyles\n\t\t * @type Array\n\t\t */\n\t\tself.contentStyles = [];\n\n\t\t// Creates all events like onClick, onSetContent etc see Editor.Events.js for the actual logic\n\t\tself.shortcuts = new Shortcuts(self);\n\t\tself.loadedCSS = {};\n\t\tself.editorCommands = new EditorCommands(self);\n\n\t\tif (settings.target) {\n\t\t\tself.targetElm = settings.target;\n\t\t}\n\n\t\tself.suffix = editorManager.suffix;\n\t\tself.editorManager = editorManager;\n\t\tself.inline = settings.inline;\n\t\tself.settings.content_editable = self.inline;\n\n\t\tif (settings.cache_suffix) {\n\t\t\tEnv.cacheSuffix = settings.cache_suffix.replace(/^[\\?\\&]+/, '');\n\t\t}\n\n\t\tif (settings.override_viewport === false) {\n\t\t\tEnv.overrideViewPort = false;\n\t\t}\n\n\t\t// Call setup\n\t\teditorManager.fire('SetupEditor', self);\n\t\tself.execCallback('setup', self);\n\n\t\t/**\n\t\t * Dom query instance with default scope to the editor document and default element is the body of the editor.\n\t\t *\n\t\t * @property $\n\t\t * @type tinymce.dom.DomQuery\n\t\t * @example\n\t\t * tinymce.activeEditor.$('p').css('color', 'red');\n\t\t * tinymce.activeEditor.$().append('<p>new</p>');\n\t\t */\n\t\tself.$ = DomQuery.overrideDefaults(function() {\n\t\t\treturn {\n\t\t\t\tcontext: self.inline ? self.getBody() : self.getDoc(),\n\t\t\t\telement: self.getBody()\n\t\t\t};\n\t\t});\n\t}\n\n\tEditor.prototype = {\n\t\t/**\n\t\t * Renders the editor/adds it to the page.\n\t\t *\n\t\t * @method render\n\t\t */\n\t\trender: function() {\n\t\t\tvar self = this, settings = self.settings, id = self.id, suffix = self.suffix;\n\n\t\t\tfunction readyHandler() {\n\t\t\t\tDOM.unbind(window, 'ready', readyHandler);\n\t\t\t\tself.render();\n\t\t\t}\n\n\t\t\t// Page is not loaded yet, wait for it\n\t\t\tif (!Event.domLoaded) {\n\t\t\t\tDOM.bind(window, 'ready', readyHandler);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Element not found, then skip initialization\n\t\t\tif (!self.getElement()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// No editable support old iOS versions etc\n\t\t\tif (!Env.contentEditable) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Hide target element early to prevent content flashing\n\t\t\tif (!settings.inline) {\n\t\t\t\tself.orgVisibility = self.getElement().style.visibility;\n\t\t\t\tself.getElement().style.visibility = 'hidden';\n\t\t\t} else {\n\t\t\t\tself.inline = true;\n\t\t\t}\n\n\t\t\tvar form = self.getElement().form || DOM.getParent(id, 'form');\n\t\t\tif (form) {\n\t\t\t\tself.formElement = form;\n\n\t\t\t\t// Add hidden input for non input elements inside form elements\n\t\t\t\tif (settings.hidden_input && !/TEXTAREA|INPUT/i.test(self.getElement().nodeName)) {\n\t\t\t\t\tDOM.insertAfter(DOM.create('input', {type: 'hidden', name: id}), id);\n\t\t\t\t\tself.hasHiddenInput = true;\n\t\t\t\t}\n\n\t\t\t\t// Pass submit/reset from form to editor instance\n\t\t\t\tself.formEventDelegate = function(e) {\n\t\t\t\t\tself.fire(e.type, e);\n\t\t\t\t};\n\n\t\t\t\tDOM.bind(form, 'submit reset', self.formEventDelegate);\n\n\t\t\t\t// Reset contents in editor when the form is reset\n\t\t\t\tself.on('reset', function() {\n\t\t\t\t\tself.setContent(self.startContent, {format: 'raw'});\n\t\t\t\t});\n\n\t\t\t\t// Check page uses id=\"submit\" or name=\"submit\" for it's submit button\n\t\t\t\tif (settings.submit_patch && !form.submit.nodeType && !form.submit.length && !form._mceOldSubmit) {\n\t\t\t\t\tform._mceOldSubmit = form.submit;\n\t\t\t\t\tform.submit = function() {\n\t\t\t\t\t\tself.editorManager.triggerSave();\n\t\t\t\t\t\tself.setDirty(false);\n\n\t\t\t\t\t\treturn form._mceOldSubmit(form);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Window manager reference, use this to open new windows and dialogs.\n\t\t\t *\n\t\t\t * @property windowManager\n\t\t\t * @type tinymce.WindowManager\n\t\t\t * @example\n\t\t\t * // Shows an alert message\n\t\t\t * tinymce.activeEditor.windowManager.alert('Hello world!');\n\t\t\t *\n\t\t\t * // Opens a new dialog with the file.htm file and the size 320x240\n\t\t\t * // It also adds a custom parameter this can be retrieved by using tinyMCEPopup.getWindowArg inside the dialog.\n\t\t\t * tinymce.activeEditor.windowManager.open({\n\t\t\t *    url: 'file.htm',\n\t\t\t *    width: 320,\n\t\t\t *    height: 240\n\t\t\t * }, {\n\t\t\t *    custom_param: 1\n\t\t\t * });\n\t\t\t */\n\t\t\tself.windowManager = new WindowManager(self);\n\n\t\t\t/**\n\t\t\t * Notification manager reference, use this to open new windows and dialogs.\n\t\t\t *\n\t\t\t * @property notificationManager\n\t\t\t * @type tinymce.NotificationManager\n\t\t\t * @example\n\t\t\t * // Shows a notification info message.\n\t\t\t * tinymce.activeEditor.notificationManager.open({text: 'Hello world!', type: 'info'});\n\t\t\t */\n\t\t\tself.notificationManager = new NotificationManager(self);\n\n\t\t\tif (settings.encoding == 'xml') {\n\t\t\t\tself.on('GetContent', function(e) {\n\t\t\t\t\tif (e.save) {\n\t\t\t\t\t\te.content = DOM.encode(e.content);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (settings.add_form_submit_trigger) {\n\t\t\t\tself.on('submit', function() {\n\t\t\t\t\tif (self.initialized) {\n\t\t\t\t\t\tself.save();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (settings.add_unload_trigger) {\n\t\t\t\tself._beforeUnload = function() {\n\t\t\t\t\tif (self.initialized && !self.destroyed && !self.isHidden()) {\n\t\t\t\t\t\tself.save({format: 'raw', no_events: true, set_dirty: false});\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tself.editorManager.on('BeforeUnload', self._beforeUnload);\n\t\t\t}\n\n\t\t\t// Load scripts\n\t\t\tfunction loadScripts() {\n\t\t\t\tvar scriptLoader = ScriptLoader.ScriptLoader;\n\n\t\t\t\tif (settings.language && settings.language != 'en' && !settings.language_url) {\n\t\t\t\t\tsettings.language_url = self.editorManager.baseURL + '/langs/' + settings.language + '.js';\n\t\t\t\t}\n\n\t\t\t\tif (settings.language_url) {\n\t\t\t\t\tscriptLoader.add(settings.language_url);\n\t\t\t\t}\n\n\t\t\t\tif (settings.theme && typeof settings.theme != \"function\" &&\n\t\t\t\t\tsettings.theme.charAt(0) != '-' && !ThemeManager.urls[settings.theme]) {\n\t\t\t\t\tvar themeUrl = settings.theme_url;\n\n\t\t\t\t\tif (themeUrl) {\n\t\t\t\t\t\tthemeUrl = self.documentBaseURI.toAbsolute(themeUrl);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthemeUrl = 'themes/' + settings.theme + '/theme' + suffix + '.js';\n\t\t\t\t\t}\n\n\t\t\t\t\tThemeManager.load(settings.theme, themeUrl);\n\t\t\t\t}\n\n\t\t\t\tif (Tools.isArray(settings.plugins)) {\n\t\t\t\t\tsettings.plugins = settings.plugins.join(' ');\n\t\t\t\t}\n\n\t\t\t\teach(settings.external_plugins, function(url, name) {\n\t\t\t\t\tPluginManager.load(name, url);\n\t\t\t\t\tsettings.plugins += ' ' + name;\n\t\t\t\t});\n\n\t\t\t\teach(settings.plugins.split(/[ ,]/), function(plugin) {\n\t\t\t\t\tplugin = trim(plugin);\n\n\t\t\t\t\tif (plugin && !PluginManager.urls[plugin]) {\n\t\t\t\t\t\tif (plugin.charAt(0) == '-') {\n\t\t\t\t\t\t\tplugin = plugin.substr(1, plugin.length);\n\n\t\t\t\t\t\t\tvar dependencies = PluginManager.dependencies(plugin);\n\n\t\t\t\t\t\t\teach(dependencies, function(dep) {\n\t\t\t\t\t\t\t\tvar defaultSettings = {\n\t\t\t\t\t\t\t\t\tprefix: 'plugins/',\n\t\t\t\t\t\t\t\t\tresource: dep,\n\t\t\t\t\t\t\t\t\tsuffix: '/plugin' + suffix + '.js'\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tdep = PluginManager.createUrl(defaultSettings, dep);\n\t\t\t\t\t\t\t\tPluginManager.load(dep.resource, dep);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tPluginManager.load(plugin, {\n\t\t\t\t\t\t\t\tprefix: 'plugins/',\n\t\t\t\t\t\t\t\tresource: plugin,\n\t\t\t\t\t\t\t\tsuffix: '/plugin' + suffix + '.js'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tscriptLoader.loadQueue(function() {\n\t\t\t\t\tif (!self.removed) {\n\t\t\t\t\t\tself.init();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.editorManager.add(self);\n\t\t\tloadScripts();\n\t\t},\n\n\t\t/**\n\t\t * Initializes the editor this will be called automatically when\n\t\t * all plugins/themes and language packs are loaded by the rendered method.\n\t\t * This method will setup the iframe and create the theme and plugin instances.\n\t\t *\n\t\t * @method init\n\t\t */\n\t\tinit: function() {\n\t\t\tvar self = this, settings = self.settings, elm = self.getElement();\n\t\t\tvar w, h, minHeight, n, o, Theme, url, bodyId, bodyClass, re, i, initializedPlugins = [];\n\n\t\t\tself.rtl = settings.rtl_ui || self.editorManager.i18n.rtl;\n\t\t\tself.editorManager.i18n.setCode(settings.language);\n\t\t\tsettings.aria_label = settings.aria_label || DOM.getAttrib(elm, 'aria-label', self.getLang('aria.rich_text_area'));\n\n\t\t\tself.fire('ScriptsLoaded');\n\n\t\t\t/**\n\t\t\t * Reference to the theme instance that was used to generate the UI.\n\t\t\t *\n\t\t\t * @property theme\n\t\t\t * @type tinymce.Theme\n\t\t\t * @example\n\t\t\t * // Executes a method on the theme directly\n\t\t\t * tinymce.activeEditor.theme.someMethod();\n\t\t\t */\n\t\t\tif (settings.theme) {\n\t\t\t\tif (typeof settings.theme != \"function\") {\n\t\t\t\t\tsettings.theme = settings.theme.replace(/-/, '');\n\t\t\t\t\tTheme = ThemeManager.get(settings.theme);\n\t\t\t\t\tself.theme = new Theme(self, ThemeManager.urls[settings.theme]);\n\n\t\t\t\t\tif (self.theme.init) {\n\t\t\t\t\t\tself.theme.init(self, ThemeManager.urls[settings.theme] || self.documentBaseUrl.replace(/\\/$/, ''), self.$);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tself.theme = settings.theme;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction initPlugin(plugin) {\n\t\t\t\tvar Plugin = PluginManager.get(plugin), pluginUrl, pluginInstance;\n\n\t\t\t\tpluginUrl = PluginManager.urls[plugin] || self.documentBaseUrl.replace(/\\/$/, '');\n\t\t\t\tplugin = trim(plugin);\n\t\t\t\tif (Plugin && inArray(initializedPlugins, plugin) === -1) {\n\t\t\t\t\teach(PluginManager.dependencies(plugin), function(dep) {\n\t\t\t\t\t\tinitPlugin(dep);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (self.plugins[plugin]) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tpluginInstance = new Plugin(self, pluginUrl, self.$);\n\n\t\t\t\t\tself.plugins[plugin] = pluginInstance;\n\n\t\t\t\t\tif (pluginInstance.init) {\n\t\t\t\t\t\tpluginInstance.init(self, pluginUrl);\n\t\t\t\t\t\tinitializedPlugins.push(plugin);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Create all plugins\n\t\t\teach(settings.plugins.replace(/\\-/g, '').split(/[ ,]/), initPlugin);\n\n\t\t\t// Measure box\n\t\t\tif (settings.render_ui && self.theme) {\n\t\t\t\tself.orgDisplay = elm.style.display;\n\n\t\t\t\tif (typeof settings.theme != \"function\") {\n\t\t\t\t\tw = settings.width || elm.style.width || elm.offsetWidth;\n\t\t\t\t\th = settings.height || elm.style.height || elm.offsetHeight;\n\t\t\t\t\tminHeight = settings.min_height || 100;\n\t\t\t\t\tre = /^[0-9\\.]+(|px)$/i;\n\n\t\t\t\t\tif (re.test('' + w)) {\n\t\t\t\t\t\tw = Math.max(parseInt(w, 10), 100);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (re.test('' + h)) {\n\t\t\t\t\t\th = Math.max(parseInt(h, 10), minHeight);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Render UI\n\t\t\t\t\to = self.theme.renderUI({\n\t\t\t\t\t\ttargetNode: elm,\n\t\t\t\t\t\twidth: w,\n\t\t\t\t\t\theight: h,\n\t\t\t\t\t\tdeltaWidth: settings.delta_width,\n\t\t\t\t\t\tdeltaHeight: settings.delta_height\n\t\t\t\t\t});\n\n\t\t\t\t\t// Resize editor\n\t\t\t\t\tif (!settings.content_editable) {\n\t\t\t\t\t\th = (o.iframeHeight || h) + (typeof h == 'number' ? (o.deltaHeight || 0) : '');\n\t\t\t\t\t\tif (h < minHeight) {\n\t\t\t\t\t\t\th = minHeight;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\to = settings.theme(self, elm);\n\n\t\t\t\t\t// Convert element type to id:s\n\t\t\t\t\tif (o.editorContainer.nodeType) {\n\t\t\t\t\t\to.editorContainer = o.editorContainer.id = o.editorContainer.id || self.id + \"_parent\";\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert element type to id:s\n\t\t\t\t\tif (o.iframeContainer.nodeType) {\n\t\t\t\t\t\to.iframeContainer = o.iframeContainer.id = o.iframeContainer.id || self.id + \"_iframecontainer\";\n\t\t\t\t\t}\n\n\t\t\t\t\t// Use specified iframe height or the targets offsetHeight\n\t\t\t\t\th = o.iframeHeight || elm.offsetHeight;\n\t\t\t\t}\n\n\t\t\t\tself.editorContainer = o.editorContainer;\n\t\t\t}\n\n\t\t\t// Load specified content CSS last\n\t\t\tif (settings.content_css) {\n\t\t\t\teach(explode(settings.content_css), function(u) {\n\t\t\t\t\tself.contentCSS.push(self.documentBaseURI.toAbsolute(u));\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Load specified content CSS last\n\t\t\tif (settings.content_style) {\n\t\t\t\tself.contentStyles.push(settings.content_style);\n\t\t\t}\n\n\t\t\t// Content editable mode ends here\n\t\t\tif (settings.content_editable) {\n\t\t\t\telm = n = o = null; // Fix IE leak\n\t\t\t\treturn self.initContentBody();\n\t\t\t}\n\n\t\t\tself.iframeHTML = settings.doctype + '<html><head>';\n\n\t\t\t// We only need to override paths if we have to\n\t\t\t// IE has a bug where it remove site absolute urls to relative ones if this is specified\n\t\t\tif (settings.document_base_url != self.documentBaseUrl) {\n\t\t\t\tself.iframeHTML += '<base href=\"' + self.documentBaseURI.getURI() + '\" />';\n\t\t\t}\n\n\t\t\t// IE8 doesn't support carets behind images setting ie7_compat would force IE8+ to run in IE7 compat mode.\n\t\t\tif (!Env.caretAfter && settings.ie7_compat) {\n\t\t\t\tself.iframeHTML += '<meta http-equiv=\"X-UA-Compatible\" content=\"IE=7\" />';\n\t\t\t}\n\n\t\t\tself.iframeHTML += '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';\n\n\t\t\t// Load the CSS by injecting them into the HTML this will reduce \"flicker\"\n\t\t\t// However we can't do that on Chrome since # will scroll to the editor for some odd reason see #2427\n\t\t\tif (!/#$/.test(document.location.href)) {\n\t\t\t\tfor (i = 0; i < self.contentCSS.length; i++) {\n\t\t\t\t\tvar cssUrl = self.contentCSS[i];\n\t\t\t\t\tself.iframeHTML += (\n\t\t\t\t\t\t'<link type=\"text/css\" ' +\n\t\t\t\t\t\t\t'rel=\"stylesheet\" ' +\n\t\t\t\t\t\t\t'href=\"' + Tools._addCacheSuffix(cssUrl) + '\" />'\n\t\t\t\t\t);\n\t\t\t\t\tself.loadedCSS[cssUrl] = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbodyId = settings.body_id || 'tinymce';\n\t\t\tif (bodyId.indexOf('=') != -1) {\n\t\t\t\tbodyId = self.getParam('body_id', '', 'hash');\n\t\t\t\tbodyId = bodyId[self.id] || bodyId;\n\t\t\t}\n\n\t\t\tbodyClass = settings.body_class || '';\n\t\t\tif (bodyClass.indexOf('=') != -1) {\n\t\t\t\tbodyClass = self.getParam('body_class', '', 'hash');\n\t\t\t\tbodyClass = bodyClass[self.id] || '';\n\t\t\t}\n\n\t\t\tif (settings.content_security_policy) {\n\t\t\t\tself.iframeHTML += '<meta http-equiv=\"Content-Security-Policy\" content=\"' + settings.content_security_policy + '\" />';\n\t\t\t}\n\n\t\t\tself.iframeHTML += '</head><body id=\"' + bodyId +\n\t\t\t\t'\" class=\"mce-content-body ' + bodyClass +\n\t\t\t\t'\" data-id=\"' + self.id + '\"><br></body></html>';\n\n\t\t\t/*eslint no-script-url:0 */\n\t\t\tvar domainRelaxUrl = 'javascript:(function(){' +\n\t\t\t\t'document.open();document.domain=\"' + document.domain + '\";' +\n\t\t\t\t'var ed = window.parent.tinymce.get(\"' + self.id + '\");document.write(ed.iframeHTML);' +\n\t\t\t\t'document.close();ed.initContentBody(true);})()';\n\n\t\t\t// Domain relaxing is required since the user has messed around with document.domain\n\t\t\tif (document.domain != location.hostname) {\n\t\t\t\t// Edge seems to be able to handle domain relaxing\n\t\t\t\tif (Env.ie && Env.ie < 12) {\n\t\t\t\t\turl = domainRelaxUrl;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Create iframe\n\t\t\t// TODO: ACC add the appropriate description on this.\n\t\t\tvar ifr = DOM.create('iframe', {\n\t\t\t\tid: self.id + \"_ifr\",\n\t\t\t\t//src: url || 'javascript:\"\"', // Workaround for HTTPS warning in IE6/7\n\t\t\t\tframeBorder: '0',\n\t\t\t\tallowTransparency: \"true\",\n\t\t\t\ttitle: self.editorManager.translate(\n\t\t\t\t\t\t\"Rich Text Area. Press ALT-F9 for menu. \" +\n\t\t\t\t\t\t\"Press ALT-F10 for toolbar. Press ALT-0 for help\"\n\t\t\t\t),\n\t\t\t\tstyle: {\n\t\t\t\t\twidth: '100%',\n\t\t\t\t\theight: h,\n\t\t\t\t\tdisplay: 'block' // Important for Gecko to render the iframe correctly\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tifr.onload = function() {\n\t\t\t\tifr.onload = null;\n\t\t\t\tself.fire(\"load\");\n\t\t\t};\n\n\t\t\tDOM.setAttrib(ifr, \"src\", url || 'javascript:\"\"');\n\n\t\t\tself.contentAreaContainer = o.iframeContainer;\n\t\t\tself.iframeElement = ifr;\n\n\t\t\tn = DOM.add(o.iframeContainer, ifr);\n\n\t\t\t// Try accessing the document this will fail on IE when document.domain is set to the same as location.hostname\n\t\t\t// Then we have to force domain relaxing using the domainRelaxUrl approach very ugly!!\n\t\t\tif (ie) {\n\t\t\t\ttry {\n\t\t\t\t\tself.getDoc();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tn.src = url = domainRelaxUrl;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (o.editorContainer) {\n\t\t\t\tDOM.get(o.editorContainer).style.display = self.orgDisplay;\n\t\t\t\tself.hidden = DOM.isHidden(o.editorContainer);\n\t\t\t}\n\n\t\t\tself.getElement().style.display = 'none';\n\t\t\tDOM.setAttrib(self.id, 'aria-hidden', true);\n\n\t\t\tif (!url) {\n\t\t\t\tself.initContentBody();\n\t\t\t}\n\n\t\t\telm = n = o = null; // Cleanup\n\t\t},\n\n\t\t/**\n\t\t * This method get called by the init method once the iframe is loaded.\n\t\t * It will fill the iframe with contents, sets up DOM and selection objects for the iframe.\n\t\t *\n\t\t * @method initContentBody\n\t\t * @private\n\t\t */\n\t\tinitContentBody: function(skipWrite) {\n\t\t\tvar self = this, settings = self.settings, targetElm = self.getElement(), doc = self.getDoc(), body, contentCssText;\n\n\t\t\t// Restore visibility on target element\n\t\t\tif (!settings.inline) {\n\t\t\t\tself.getElement().style.visibility = self.orgVisibility;\n\t\t\t}\n\n\t\t\t// Setup iframe body\n\t\t\tif (!skipWrite && !settings.content_editable) {\n\t\t\t\tdoc.open();\n\t\t\t\tdoc.write(self.iframeHTML);\n\t\t\t\tdoc.close();\n\t\t\t}\n\n\t\t\tif (settings.content_editable) {\n\t\t\t\tself.on('remove', function() {\n\t\t\t\t\tvar bodyEl = this.getBody();\n\n\t\t\t\t\tDOM.removeClass(bodyEl, 'mce-content-body');\n\t\t\t\t\tDOM.removeClass(bodyEl, 'mce-edit-focus');\n\t\t\t\t\tDOM.setAttrib(bodyEl, 'contentEditable', null);\n\t\t\t\t});\n\n\t\t\t\tDOM.addClass(targetElm, 'mce-content-body');\n\t\t\t\tself.contentDocument = doc = settings.content_document || document;\n\t\t\t\tself.contentWindow = settings.content_window || window;\n\t\t\t\tself.bodyElement = targetElm;\n\n\t\t\t\t// Prevent leak in IE\n\t\t\t\tsettings.content_document = settings.content_window = null;\n\n\t\t\t\t// TODO: Fix this\n\t\t\t\tsettings.root_name = targetElm.nodeName.toLowerCase();\n\t\t\t}\n\n\t\t\t// It will not steal focus while setting contentEditable\n\t\t\tbody = self.getBody();\n\t\t\tbody.disabled = true;\n\t\t\tself.readonly = settings.readonly;\n\n\t\t\tif (!self.readonly) {\n\t\t\t\tif (self.inline && DOM.getStyle(body, 'position', true) == 'static') {\n\t\t\t\t\tbody.style.position = 'relative';\n\t\t\t\t}\n\n\t\t\t\tbody.contentEditable = self.getParam('content_editable_state', true);\n\t\t\t}\n\n\t\t\tbody.disabled = false;\n\n\t\t\tself.editorUpload = new EditorUpload(self);\n\n\t\t\t/**\n\t\t\t * Schema instance, enables you to validate elements and its children.\n\t\t\t *\n\t\t\t * @property schema\n\t\t\t * @type tinymce.html.Schema\n\t\t\t */\n\t\t\tself.schema = new Schema(settings);\n\n\t\t\t/**\n\t\t\t * DOM instance for the editor.\n\t\t\t *\n\t\t\t * @property dom\n\t\t\t * @type tinymce.dom.DOMUtils\n\t\t\t * @example\n\t\t\t * // Adds a class to all paragraphs within the editor\n\t\t\t * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'someclass');\n\t\t\t */\n\t\t\tself.dom = new DOMUtils(doc, {\n\t\t\t\tkeep_values: true,\n\t\t\t\turl_converter: self.convertURL,\n\t\t\t\turl_converter_scope: self,\n\t\t\t\thex_colors: settings.force_hex_style_colors,\n\t\t\t\tclass_filter: settings.class_filter,\n\t\t\t\tupdate_styles: true,\n\t\t\t\troot_element: self.inline ? self.getBody() : null,\n\t\t\t\tcollect: settings.content_editable,\n\t\t\t\tschema: self.schema,\n\t\t\t\tonSetAttrib: function(e) {\n\t\t\t\t\tself.fire('SetAttrib', e);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * HTML parser will be used when contents is inserted into the editor.\n\t\t\t *\n\t\t\t * @property parser\n\t\t\t * @type tinymce.html.DomParser\n\t\t\t */\n\t\t\tself.parser = new DomParser(settings, self.schema);\n\n\t\t\t// Convert src and href into data-mce-src, data-mce-href and data-mce-style\n\t\t\tself.parser.addAttributeFilter('src,href,style,tabindex', function(nodes, name) {\n\t\t\t\tvar i = nodes.length, node, dom = self.dom, value, internalName;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tvalue = node.attr(name);\n\t\t\t\t\tinternalName = 'data-mce-' + name;\n\n\t\t\t\t\t// Add internal attribute if we need to we don't on a refresh of the document\n\t\t\t\t\tif (!node.attributes.map[internalName]) {\n\t\t\t\t\t\t// Don't duplicate these since they won't get modified by any browser\n\t\t\t\t\t\tif (value.indexOf('data:') === 0 || value.indexOf('blob:') === 0) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (name === \"style\") {\n\t\t\t\t\t\t\tvalue = dom.serializeStyle(dom.parseStyle(value), node.name);\n\n\t\t\t\t\t\t\tif (!value.length) {\n\t\t\t\t\t\t\t\tvalue = null;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnode.attr(internalName, value);\n\t\t\t\t\t\t\tnode.attr(name, value);\n\t\t\t\t\t\t} else if (name === \"tabindex\") {\n\t\t\t\t\t\t\tnode.attr(internalName, value);\n\t\t\t\t\t\t\tnode.attr(name, null);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.attr(internalName, self.convertURL(value, name, node.name));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Keep scripts from executing\n\t\t\tself.parser.addNodeFilter('script', function(nodes) {\n\t\t\t\tvar i = nodes.length, node, type;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\ttype = node.attr('type') || 'no/type';\n\t\t\t\t\tif (type.indexOf('mce-') !== 0) {\n\t\t\t\t\t\tnode.attr('type', 'mce-' + type);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.parser.addNodeFilter('#cdata', function(nodes) {\n\t\t\t\tvar i = nodes.length, node;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\tnode.type = 8;\n\t\t\t\t\tnode.name = '#comment';\n\t\t\t\t\tnode.value = '[CDATA[' + node.value + ']]';\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div', function(nodes) {\n\t\t\t\tvar i = nodes.length, node, nonEmptyElements = self.schema.getNonEmptyElements();\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tnode = nodes[i];\n\n\t\t\t\t\tif (node.isEmpty(nonEmptyElements)) {\n\t\t\t\t\t\tnode.append(new Node('br', 1)).shortEnded = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * DOM serializer for the editor. Will be used when contents is extracted from the editor.\n\t\t\t *\n\t\t\t * @property serializer\n\t\t\t * @type tinymce.dom.Serializer\n\t\t\t * @example\n\t\t\t * // Serializes the first paragraph in the editor into a string\n\t\t\t * tinymce.activeEditor.serializer.serialize(tinymce.activeEditor.dom.select('p')[0]);\n\t\t\t */\n\t\t\tself.serializer = new DomSerializer(settings, self);\n\n\t\t\t/**\n\t\t\t * Selection instance for the editor.\n\t\t\t *\n\t\t\t * @property selection\n\t\t\t * @type tinymce.dom.Selection\n\t\t\t * @example\n\t\t\t * // Sets some contents to the current selection in the editor\n\t\t\t * tinymce.activeEditor.selection.setContent('Some contents');\n\t\t\t *\n\t\t\t * // Gets the current selection\n\t\t\t * alert(tinymce.activeEditor.selection.getContent());\n\t\t\t *\n\t\t\t * // Selects the first paragraph found\n\t\t\t * tinymce.activeEditor.selection.select(tinymce.activeEditor.dom.select('p')[0]);\n\t\t\t */\n\t\t\tself.selection = new Selection(self.dom, self.getWin(), self.serializer, self);\n\n\t\t\t/**\n\t\t\t * Formatter instance.\n\t\t\t *\n\t\t\t * @property formatter\n\t\t\t * @type tinymce.Formatter\n\t\t\t */\n\t\t\tself.formatter = new Formatter(self);\n\n\t\t\t/**\n\t\t\t * Undo manager instance, responsible for handling undo levels.\n\t\t\t *\n\t\t\t * @property undoManager\n\t\t\t * @type tinymce.UndoManager\n\t\t\t * @example\n\t\t\t * // Undoes the last modification to the editor\n\t\t\t * tinymce.activeEditor.undoManager.undo();\n\t\t\t */\n\t\t\tself.undoManager = new UndoManager(self);\n\n\t\t\tself.forceBlocks = new ForceBlocks(self);\n\t\t\tself.enterKey = new EnterKey(self);\n\t\t\tself._nodeChangeDispatcher = new NodeChange(self);\n\t\t\tself._selectionOverrides = new SelectionOverrides(self);\n\n\t\t\tself.fire('PreInit');\n\n\t\t\tif (!settings.browser_spellcheck && !settings.gecko_spellcheck) {\n\t\t\t\tdoc.body.spellcheck = false; // Gecko\n\t\t\t\tDOM.setAttrib(body, \"spellcheck\", \"false\");\n\t\t\t}\n\n\t\t\tself.quirks = new Quirks(self);\n\t\t\tself.fire('PostRender');\n\n\t\t\tif (settings.directionality) {\n\t\t\t\tbody.dir = settings.directionality;\n\t\t\t}\n\n\t\t\tif (settings.nowrap) {\n\t\t\t\tbody.style.whiteSpace = \"nowrap\";\n\t\t\t}\n\n\t\t\tif (settings.protect) {\n\t\t\t\tself.on('BeforeSetContent', function(e) {\n\t\t\t\t\teach(settings.protect, function(pattern) {\n\t\t\t\t\t\te.content = e.content.replace(pattern, function(str) {\n\t\t\t\t\t\t\treturn '<!--mce:protected ' + escape(str) + '-->';\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.on('SetContent', function() {\n\t\t\t\tself.addVisual(self.getBody());\n\t\t\t});\n\n\t\t\t// Remove empty contents\n\t\t\tif (settings.padd_empty_editor) {\n\t\t\t\tself.on('PostProcess', function(e) {\n\t\t\t\t\te.content = e.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\\s|\\u00a0|)<\\/p>[\\r\\n]*|<br \\/>[\\r\\n]*)$/, '');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.load({initial: true, format: 'html'});\n\t\t\tself.startContent = self.getContent({format: 'raw'});\n\n\t\t\t/**\n\t\t\t * Is set to true after the editor instance has been initialized\n\t\t\t *\n\t\t\t * @property initialized\n\t\t\t * @type Boolean\n\t\t\t * @example\n\t\t\t * function isEditorInitialized(editor) {\n\t\t\t *     return editor && editor.initialized;\n\t\t\t * }\n\t\t\t */\n\t\t\tself.initialized = true;\n\t\t\tself.bindPendingEventDelegates();\n\n\t\t\tself.fire('init');\n\t\t\tself.focus(true);\n\t\t\tself.nodeChanged({initial: true});\n\t\t\tself.execCallback('init_instance_callback', self);\n\n\t\t\tself.on('compositionstart compositionend', function(e) {\n\t\t\t\tself.composing = e.type === 'compositionstart';\n\t\t\t});\n\n\t\t\t// Add editor specific CSS styles\n\t\t\tif (self.contentStyles.length > 0) {\n\t\t\t\tcontentCssText = '';\n\n\t\t\t\teach(self.contentStyles, function(style) {\n\t\t\t\t\tcontentCssText += style + \"\\r\\n\";\n\t\t\t\t});\n\n\t\t\t\tself.dom.addStyle(contentCssText);\n\t\t\t}\n\n\t\t\t// Load specified content CSS last\n\t\t\teach(self.contentCSS, function(cssUrl) {\n\t\t\t\tif (!self.loadedCSS[cssUrl]) {\n\t\t\t\t\tself.dom.loadCSS(cssUrl);\n\t\t\t\t\tself.loadedCSS[cssUrl] = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Handle auto focus\n\t\t\tif (settings.auto_focus) {\n\t\t\t\tDelay.setEditorTimeout(self, function() {\n\t\t\t\t\tvar editor;\n\n\t\t\t\t\tif (settings.auto_focus === true) {\n\t\t\t\t\t\teditor = self;\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor = self.editorManager.get(settings.auto_focus);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!editor.destroyed) {\n\t\t\t\t\t\teditor.focus();\n\t\t\t\t\t}\n\t\t\t\t}, 100);\n\t\t\t}\n\n\t\t\t// Clean up references for IE\n\t\t\ttargetElm = doc = body = null;\n\t\t},\n\n\t\t/**\n\t\t * Focuses/activates the editor. This will set this editor as the activeEditor in the tinymce collection\n\t\t * it will also place DOM focus inside the editor.\n\t\t *\n\t\t * @method focus\n\t\t * @param {Boolean} skipFocus Skip DOM focus. Just set is as the active editor.\n\t\t */\n\t\tfocus: function(skipFocus) {\n\t\t\tvar self = this, selection = self.selection, contentEditable = self.settings.content_editable, rng;\n\t\t\tvar controlElm, doc = self.getDoc(), body = self.getBody(), contentEditableHost;\n\n\t\t\tfunction getContentEditableHost(node) {\n\t\t\t\treturn self.dom.getParent(node, function(node) {\n\t\t\t\t\treturn self.dom.getContentEditable(node) === \"true\";\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!skipFocus) {\n\t\t\t\t// Get selected control element\n\t\t\t\trng = selection.getRng();\n\t\t\t\tif (rng.item) {\n\t\t\t\t\tcontrolElm = rng.item(0);\n\t\t\t\t}\n\n\t\t\t\tself.quirks.refreshContentEditable();\n\n\t\t\t\t// Move focus to contentEditable=true child if needed\n\t\t\t\tcontentEditableHost = getContentEditableHost(selection.getNode());\n\t\t\t\tif (self.$.contains(body, contentEditableHost)) {\n\t\t\t\t\tcontentEditableHost.focus();\n\t\t\t\t\tselection.normalize();\n\t\t\t\t\tself.editorManager.setActive(self);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Focus the window iframe\n\t\t\t\tif (!contentEditable) {\n\t\t\t\t\t// WebKit needs this call to fire focusin event properly see #5948\n\t\t\t\t\t// But Opera pre Blink engine will produce an empty selection so skip Opera\n\t\t\t\t\tif (!Env.opera) {\n\t\t\t\t\t\tself.getBody().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tself.getWin().focus();\n\t\t\t\t}\n\n\t\t\t\t// Focus the body as well since it's contentEditable\n\t\t\t\tif (isGecko || contentEditable) {\n\t\t\t\t\t// Check for setActive since it doesn't scroll to the element\n\t\t\t\t\tif (body.setActive) {\n\t\t\t\t\t\t// IE 11 sometimes throws \"Invalid function\" then fallback to focus\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tbody.setActive();\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\tbody.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbody.focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (contentEditable) {\n\t\t\t\t\t\tselection.normalize();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Restore selected control element\n\t\t\t\t// This is needed when for example an image is selected within a\n\t\t\t\t// layer a call to focus will then remove the control selection\n\t\t\t\tif (controlElm && controlElm.ownerDocument == doc) {\n\t\t\t\t\trng = doc.body.createControlRange();\n\t\t\t\t\trng.addElement(controlElm);\n\t\t\t\t\trng.select();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.editorManager.setActive(self);\n\t\t},\n\n\t\t/**\n\t\t * Executes a legacy callback. This method is useful to call old 2.x option callbacks.\n\t\t * There new event model is a better way to add callback so this method might be removed in the future.\n\t\t *\n\t\t * @method execCallback\n\t\t * @param {String} name Name of the callback to execute.\n\t\t * @return {Object} Return value passed from callback function.\n\t\t */\n\t\texecCallback: function(name) {\n\t\t\tvar self = this, callback = self.settings[name], scope;\n\n\t\t\tif (!callback) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Look through lookup\n\t\t\tif (self.callbackLookup && (scope = self.callbackLookup[name])) {\n\t\t\t\tcallback = scope.func;\n\t\t\t\tscope = scope.scope;\n\t\t\t}\n\n\t\t\tif (typeof callback === 'string') {\n\t\t\t\tscope = callback.replace(/\\.\\w+$/, '');\n\t\t\t\tscope = scope ? resolve(scope) : 0;\n\t\t\t\tcallback = resolve(callback);\n\t\t\t\tself.callbackLookup = self.callbackLookup || {};\n\t\t\t\tself.callbackLookup[name] = {func: callback, scope: scope};\n\t\t\t}\n\n\t\t\treturn callback.apply(scope || self, Array.prototype.slice.call(arguments, 1));\n\t\t},\n\n\t\t/**\n\t\t * Translates the specified string by replacing variables with language pack items it will also check if there is\n\t\t * a key matching the input.\n\t\t *\n\t\t * @method translate\n\t\t * @param {String} text String to translate by the language pack data.\n\t\t * @return {String} Translated string.\n\t\t */\n\t\ttranslate: function(text) {\n\t\t\tvar lang = this.settings.language || 'en', i18n = this.editorManager.i18n;\n\n\t\t\tif (!text) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\ttext = i18n.data[lang + '.' + text] || text.replace(/\\{\\#([^\\}]+)\\}/g, function(a, b) {\n\t\t\t\treturn i18n.data[lang + '.' + b] || '{#' + b + '}';\n\t\t\t});\n\n\t\t\treturn this.editorManager.translate(text);\n\t\t},\n\n\t\t/**\n\t\t * Returns a language pack item by name/key.\n\t\t *\n\t\t * @method getLang\n\t\t * @param {String} name Name/key to get from the language pack.\n\t\t * @param {String} defaultVal Optional default value to retrieve.\n\t\t */\n\t\tgetLang: function(name, defaultVal) {\n\t\t\treturn (\n\t\t\t\tthis.editorManager.i18n.data[(this.settings.language || 'en') + '.' + name] ||\n\t\t\t\t(defaultVal !== undefined ? defaultVal : '{#' + name + '}')\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Returns a configuration parameter by name.\n\t\t *\n\t\t * @method getParam\n\t\t * @param {String} name Configruation parameter to retrieve.\n\t\t * @param {String} defaultVal Optional default value to return.\n\t\t * @param {String} type Optional type parameter.\n\t\t * @return {String} Configuration parameter value or default value.\n\t\t * @example\n\t\t * // Returns a specific config value from the currently active editor\n\t\t * var someval = tinymce.activeEditor.getParam('myvalue');\n\t\t *\n\t\t * // Returns a specific config value from a specific editor instance by id\n\t\t * var someval2 = tinymce.get('my_editor').getParam('myvalue');\n\t\t */\n\t\tgetParam: function(name, defaultVal, type) {\n\t\t\tvar value = name in this.settings ? this.settings[name] : defaultVal, output;\n\n\t\t\tif (type === 'hash') {\n\t\t\t\toutput = {};\n\n\t\t\t\tif (typeof value === 'string') {\n\t\t\t\t\teach(value.indexOf('=') > 0 ? value.split(/[;,](?![^=;,]*(?:[;,]|$))/) : value.split(','), function(value) {\n\t\t\t\t\t\tvalue = value.split('=');\n\n\t\t\t\t\t\tif (value.length > 1) {\n\t\t\t\t\t\t\toutput[trim(value[0])] = trim(value[1]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toutput[trim(value[0])] = trim(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\toutput = value;\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\n\t\t\treturn value;\n\t\t},\n\n\t\t/**\n\t\t * Dispatches out a onNodeChange event to all observers. This method should be called when you\n\t\t * need to update the UI states or element path etc.\n\t\t *\n\t\t * @method nodeChanged\n\t\t * @param {Object} args Optional args to pass to NodeChange event handlers.\n\t\t */\n\t\tnodeChanged: function(args) {\n\t\t\tthis._nodeChangeDispatcher.nodeChanged(args);\n\t\t},\n\n\t\t/**\n\t\t * Adds a button that later gets created by the theme in the editors toolbars.\n\t\t *\n\t\t * @method addButton\n\t\t * @param {String} name Button name to add.\n\t\t * @param {Object} settings Settings object with title, cmd etc.\n\t\t * @example\n\t\t * // Adds a custom button to the editor that inserts contents when clicked\n\t\t * tinymce.init({\n\t\t *    ...\n\t\t *\n\t\t *    toolbar: 'example'\n\t\t *\n\t\t *    setup: function(ed) {\n\t\t *       ed.addButton('example', {\n\t\t *          title: 'My title',\n\t\t *          image: '../js/tinymce/plugins/example/img/example.gif',\n\t\t *          onclick: function() {\n\t\t *             ed.insertContent('Hello world!!');\n\t\t *          }\n\t\t *       });\n\t\t *    }\n\t\t * });\n\t\t */\n\t\taddButton: function(name, settings) {\n\t\t\tvar self = this;\n\n\t\t\tif (settings.cmd) {\n\t\t\t\tsettings.onclick = function() {\n\t\t\t\t\tself.execCommand(settings.cmd);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!settings.text && !settings.icon) {\n\t\t\t\tsettings.icon = name;\n\t\t\t}\n\n\t\t\tself.buttons = self.buttons || {};\n\t\t\tsettings.tooltip = settings.tooltip || settings.title;\n\t\t\tself.buttons[name] = settings;\n\t\t},\n\n\t\t/**\n\t\t * Adds a menu item to be used in the menus of the theme. There might be multiple instances\n\t\t * of this menu item for example it might be used in the main menus of the theme but also in\n\t\t * the context menu so make sure that it's self contained and supports multiple instances.\n\t\t *\n\t\t * @method addMenuItem\n\t\t * @param {String} name Menu item name to add.\n\t\t * @param {Object} settings Settings object with title, cmd etc.\n\t\t * @example\n\t\t * // Adds a custom menu item to the editor that inserts contents when clicked\n\t\t * // The context option allows you to add the menu item to an existing default menu\n\t\t * tinymce.init({\n\t\t *    ...\n\t\t *\n\t\t *    setup: function(ed) {\n\t\t *       ed.addMenuItem('example', {\n\t\t *          text: 'My menu item',\n\t\t *          context: 'tools',\n\t\t *          onclick: function() {\n\t\t *             ed.insertContent('Hello world!!');\n\t\t *          }\n\t\t *       });\n\t\t *    }\n\t\t * });\n\t\t */\n\t\taddMenuItem: function(name, settings) {\n\t\t\tvar self = this;\n\n\t\t\tif (settings.cmd) {\n\t\t\t\tsettings.onclick = function() {\n\t\t\t\t\tself.execCommand(settings.cmd);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tself.menuItems = self.menuItems || {};\n\t\t\tself.menuItems[name] = settings;\n\t\t},\n\n\t\t/**\n\t\t * Adds a contextual toolbar to be rendered when the selector matches.\n\t\t *\n\t\t * @method addContextToolbar\n\t\t * @param {function/string} predicate Predicate that needs to return true if provided strings get converted into CSS predicates.\n\t\t * @param {String/Array} items String or array with items to add to the context toolbar.\n\t\t */\n\t\taddContextToolbar: function(predicate, items) {\n\t\t\tvar self = this, selector;\n\n\t\t\tself.contextToolbars = self.contextToolbars || [];\n\n\t\t\t// Convert selector to predicate\n\t\t\tif (typeof predicate == \"string\") {\n\t\t\t\tselector = predicate;\n\t\t\t\tpredicate = function(elm) {\n\t\t\t\t\treturn self.dom.is(elm, selector);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tself.contextToolbars.push({\n\t\t\t\tid: Uuid.uuid('mcet'),\n\t\t\t\tpredicate: predicate,\n\t\t\t\titems: items\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Adds a custom command to the editor, you can also override existing commands with this method.\n\t\t * The command that you add can be executed with execCommand.\n\t\t *\n\t\t * @method addCommand\n\t\t * @param {String} name Command name to add/override.\n\t\t * @param {addCommandCallback} callback Function to execute when the command occurs.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t * @example\n\t\t * // Adds a custom command that later can be executed using execCommand\n\t\t * tinymce.init({\n\t\t *    ...\n\t\t *\n\t\t *    setup: function(ed) {\n\t\t *       // Register example command\n\t\t *       ed.addCommand('mycommand', function(ui, v) {\n\t\t *          ed.windowManager.alert('Hello world!! Selection: ' + ed.selection.getContent({format: 'text'}));\n\t\t *       });\n\t\t *    }\n\t\t * });\n\t\t */\n\t\taddCommand: function(name, callback, scope) {\n\t\t\t/**\n\t\t\t * Callback function that gets called when a command is executed.\n\t\t\t *\n\t\t\t * @callback addCommandCallback\n\t\t\t * @param {Boolean} ui Display UI state true/false.\n\t\t\t * @param {Object} value Optional value for command.\n\t\t\t * @return {Boolean} True/false state if the command was handled or not.\n\t\t\t */\n\t\t\tthis.editorCommands.addCommand(name, callback, scope);\n\t\t},\n\n\t\t/**\n\t\t * Adds a custom query state command to the editor, you can also override existing commands with this method.\n\t\t * The command that you add can be executed with queryCommandState function.\n\t\t *\n\t\t * @method addQueryStateHandler\n\t\t * @param {String} name Command name to add/override.\n\t\t * @param {addQueryStateHandlerCallback} callback Function to execute when the command state retrieval occurs.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t */\n\t\taddQueryStateHandler: function(name, callback, scope) {\n\t\t\t/**\n\t\t\t * Callback function that gets called when a queryCommandState is executed.\n\t\t\t *\n\t\t\t * @callback addQueryStateHandlerCallback\n\t\t\t * @return {Boolean} True/false state if the command is enabled or not like is it bold.\n\t\t\t */\n\t\t\tthis.editorCommands.addQueryStateHandler(name, callback, scope);\n\t\t},\n\n\t\t/**\n\t\t * Adds a custom query value command to the editor, you can also override existing commands with this method.\n\t\t * The command that you add can be executed with queryCommandValue function.\n\t\t *\n\t\t * @method addQueryValueHandler\n\t\t * @param {String} name Command name to add/override.\n\t\t * @param {addQueryValueHandlerCallback} callback Function to execute when the command value retrieval occurs.\n\t\t * @param {Object} scope Optional scope to execute the function in.\n\t\t */\n\t\taddQueryValueHandler: function(name, callback, scope) {\n\t\t\t/**\n\t\t\t * Callback function that gets called when a queryCommandValue is executed.\n\t\t\t *\n\t\t\t * @callback addQueryValueHandlerCallback\n\t\t\t * @return {Object} Value of the command or undefined.\n\t\t\t */\n\t\t\tthis.editorCommands.addQueryValueHandler(name, callback, scope);\n\t\t},\n\n\t\t/**\n\t\t * Adds a keyboard shortcut for some command or function.\n\t\t *\n\t\t * @method addShortcut\n\t\t * @param {String} pattern Shortcut pattern. Like for example: ctrl+alt+o.\n\t\t * @param {String} desc Text description for the command.\n\t\t * @param {String/Function} cmdFunc Command name string or function to execute when the key is pressed.\n\t\t * @param {Object} sc Optional scope to execute the function in.\n\t\t * @return {Boolean} true/false state if the shortcut was added or not.\n\t\t */\n\t\taddShortcut: function(pattern, desc, cmdFunc, scope) {\n\t\t\tthis.shortcuts.add(pattern, desc, cmdFunc, scope);\n\t\t},\n\n\t\t/**\n\t\t * Executes a command on the current instance. These commands can be TinyMCE internal commands prefixed with \"mce\" or\n\t\t * they can be build in browser commands such as \"Bold\". A compleate list of browser commands is available on MSDN or Mozilla.org.\n\t\t * This function will dispatch the execCommand function on each plugin, theme or the execcommand_callback option if none of these\n\t\t * return true it will handle the command as a internal browser command.\n\t\t *\n\t\t * @method execCommand\n\t\t * @param {String} cmd Command name to execute, for example mceLink or Bold.\n\t\t * @param {Boolean} ui True/false state if a UI (dialog) should be presented or not.\n\t\t * @param {mixed} value Optional command value, this can be anything.\n\t\t * @param {Object} args Optional arguments object.\n\t\t */\n\t\texecCommand: function(cmd, ui, value, args) {\n\t\t\treturn this.editorCommands.execCommand(cmd, ui, value, args);\n\t\t},\n\n\t\t/**\n\t\t * Returns a command specific state, for example if bold is enabled or not.\n\t\t *\n\t\t * @method queryCommandState\n\t\t * @param {string} cmd Command to query state from.\n\t\t * @return {Boolean} Command specific state, for example if bold is enabled or not.\n\t\t */\n\t\tqueryCommandState: function(cmd) {\n\t\t\treturn this.editorCommands.queryCommandState(cmd);\n\t\t},\n\n\t\t/**\n\t\t * Returns a command specific value, for example the current font size.\n\t\t *\n\t\t * @method queryCommandValue\n\t\t * @param {string} cmd Command to query value from.\n\t\t * @return {Object} Command specific value, for example the current font size.\n\t\t */\n\t\tqueryCommandValue: function(cmd) {\n\t\t\treturn this.editorCommands.queryCommandValue(cmd);\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the command is supported or not.\n\t\t *\n\t\t * @method queryCommandSupported\n\t\t * @param {String} cmd Command that we check support for.\n\t\t * @return {Boolean} true/false if the command is supported or not.\n\t\t */\n\t\tqueryCommandSupported: function(cmd) {\n\t\t\treturn this.editorCommands.queryCommandSupported(cmd);\n\t\t},\n\n\t\t/**\n\t\t * Shows the editor and hides any textarea/div that the editor is supposed to replace.\n\t\t *\n\t\t * @method show\n\t\t */\n\t\tshow: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self.hidden) {\n\t\t\t\tself.hidden = false;\n\n\t\t\t\tif (self.inline) {\n\t\t\t\t\tself.getBody().contentEditable = true;\n\t\t\t\t} else {\n\t\t\t\t\tDOM.show(self.getContainer());\n\t\t\t\t\tDOM.hide(self.id);\n\t\t\t\t}\n\n\t\t\t\tself.load();\n\t\t\t\tself.fire('show');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Hides the editor and shows any textarea/div that the editor is supposed to replace.\n\t\t *\n\t\t * @method hide\n\t\t */\n\t\thide: function() {\n\t\t\tvar self = this, doc = self.getDoc();\n\n\t\t\tif (!self.hidden) {\n\t\t\t\t// Fixed bug where IE has a blinking cursor left from the editor\n\t\t\t\tif (ie && doc && !self.inline) {\n\t\t\t\t\tdoc.execCommand('SelectAll');\n\t\t\t\t}\n\n\t\t\t\t// We must save before we hide so Safari doesn't crash\n\t\t\t\tself.save();\n\n\t\t\t\tif (self.inline) {\n\t\t\t\t\tself.getBody().contentEditable = false;\n\n\t\t\t\t\t// Make sure the editor gets blurred\n\t\t\t\t\tif (self == self.editorManager.focusedEditor) {\n\t\t\t\t\t\tself.editorManager.focusedEditor = null;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tDOM.hide(self.getContainer());\n\t\t\t\t\tDOM.setStyle(self.id, 'display', self.orgDisplay);\n\t\t\t\t}\n\n\t\t\t\tself.hidden = true;\n\t\t\t\tself.fire('hide');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the editor is hidden or not.\n\t\t *\n\t\t * @method isHidden\n\t\t * @return {Boolean} True/false if the editor is hidden or not.\n\t\t */\n\t\tisHidden: function() {\n\t\t\treturn !!this.hidden;\n\t\t},\n\n\t\t/**\n\t\t * Sets the progress state, this will display a throbber/progess for the editor.\n\t\t * This is ideal for asynchronous operations like an AJAX save call.\n\t\t *\n\t\t * @method setProgressState\n\t\t * @param {Boolean} state Boolean state if the progress should be shown or hidden.\n\t\t * @param {Number} time Optional time to wait before the progress gets shown.\n\t\t * @return {Boolean} Same as the input state.\n\t\t * @example\n\t\t * // Show progress for the active editor\n\t\t * tinymce.activeEditor.setProgressState(true);\n\t\t *\n\t\t * // Hide progress for the active editor\n\t\t * tinymce.activeEditor.setProgressState(false);\n\t\t *\n\t\t * // Show progress after 3 seconds\n\t\t * tinymce.activeEditor.setProgressState(true, 3000);\n\t\t */\n\t\tsetProgressState: function(state, time) {\n\t\t\tthis.fire('ProgressState', {state: state, time: time});\n\t\t},\n\n\t\t/**\n\t\t * Loads contents from the textarea or div element that got converted into an editor instance.\n\t\t * This method will move the contents from that textarea or div into the editor by using setContent\n\t\t * so all events etc that method has will get dispatched as well.\n\t\t *\n\t\t * @method load\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole load process.\n\t\t * @return {String} HTML string that got set into the editor.\n\t\t */\n\t\tload: function(args) {\n\t\t\tvar self = this, elm = self.getElement(), html;\n\n\t\t\tif (elm) {\n\t\t\t\targs = args || {};\n\t\t\t\targs.load = true;\n\n\t\t\t\thtml = self.setContent(elm.value !== undefined ? elm.value : elm.innerHTML, args);\n\t\t\t\targs.element = elm;\n\n\t\t\t\tif (!args.no_events) {\n\t\t\t\t\tself.fire('LoadContent', args);\n\t\t\t\t}\n\n\t\t\t\targs.element = elm = null;\n\n\t\t\t\treturn html;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Saves the contents from a editor out to the textarea or div element that got converted into an editor instance.\n\t\t * This method will move the HTML contents from the editor into that textarea or div by getContent\n\t\t * so all events etc that method has will get dispatched as well.\n\t\t *\n\t\t * @method save\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole save process.\n\t\t * @return {String} HTML string that got set into the textarea/div.\n\t\t */\n\t\tsave: function(args) {\n\t\t\tvar self = this, elm = self.getElement(), html, form;\n\n\t\t\tif (!elm || !self.initialized) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\targs = args || {};\n\t\t\targs.save = true;\n\n\t\t\targs.element = elm;\n\t\t\thtml = args.content = self.getContent(args);\n\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.fire('SaveContent', args);\n\t\t\t}\n\n\t\t\t// Always run this internal event\n\t\t\tif (args.format == 'raw') {\n\t\t\t\tself.fire('RawSaveContent', args);\n\t\t\t}\n\n\t\t\thtml = args.content;\n\n\t\t\tif (!/TEXTAREA|INPUT/i.test(elm.nodeName)) {\n\t\t\t\t// Update DIV element when not in inline mode\n\t\t\t\tif (!self.inline) {\n\t\t\t\t\telm.innerHTML = html;\n\t\t\t\t}\n\n\t\t\t\t// Update hidden form element\n\t\t\t\tif ((form = DOM.getParent(self.id, 'form'))) {\n\t\t\t\t\teach(form.elements, function(elm) {\n\t\t\t\t\t\tif (elm.name == self.id) {\n\t\t\t\t\t\t\telm.value = html;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\telm.value = html;\n\t\t\t}\n\n\t\t\targs.element = elm = null;\n\n\t\t\tif (args.set_dirty !== false) {\n\t\t\t\tself.setDirty(false);\n\t\t\t}\n\n\t\t\treturn html;\n\t\t},\n\n\t\t/**\n\t\t * Sets the specified content to the editor instance, this will cleanup the content before it gets set using\n\t\t * the different cleanup rules options.\n\t\t *\n\t\t * @method setContent\n\t\t * @param {String} content Content to set to editor, normally HTML contents but can be other formats as well.\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole set process.\n\t\t * @return {String} HTML string that got set into the editor.\n\t\t * @example\n\t\t * // Sets the HTML contents of the activeEditor editor\n\t\t * tinymce.activeEditor.setContent('<span>some</span> html');\n\t\t *\n\t\t * // Sets the raw contents of the activeEditor editor\n\t\t * tinymce.activeEditor.setContent('<span>some</span> html', {format: 'raw'});\n\t\t *\n\t\t * // Sets the content of a specific editor (my_editor in this example)\n\t\t * tinymce.get('my_editor').setContent(data);\n\t\t *\n\t\t * // Sets the bbcode contents of the activeEditor editor if the bbcode plugin was added\n\t\t * tinymce.activeEditor.setContent('[b]some[/b] html', {format: 'bbcode'});\n\t\t */\n\t\tsetContent: function(content, args) {\n\t\t\tvar self = this, body = self.getBody(), forcedRootBlockName, padd;\n\n\t\t\t// Setup args object\n\t\t\targs = args || {};\n\t\t\targs.format = args.format || 'html';\n\t\t\targs.set = true;\n\t\t\targs.content = content;\n\n\t\t\t// Do preprocessing\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.fire('BeforeSetContent', args);\n\t\t\t}\n\n\t\t\tcontent = args.content;\n\n\t\t\t// Padd empty content in Gecko and Safari. Commands will otherwise fail on the content\n\t\t\t// It will also be impossible to place the caret in the editor unless there is a BR element present\n\t\t\tif (content.length === 0 || /^\\s+$/.test(content)) {\n\t\t\t\tpadd = ie && ie < 11 ? '' : '<br data-mce-bogus=\"1\">';\n\n\t\t\t\t// Todo: There is a lot more root elements that need special padding\n\t\t\t\t// so separate this and add all of them at some point.\n\t\t\t\tif (body.nodeName == 'TABLE') {\n\t\t\t\t\tcontent = '<tr><td>' + padd + '</td></tr>';\n\t\t\t\t} else if (/^(UL|OL)$/.test(body.nodeName)) {\n\t\t\t\t\tcontent = '<li>' + padd + '</li>';\n\t\t\t\t}\n\n\t\t\t\tforcedRootBlockName = self.settings.forced_root_block;\n\n\t\t\t\t// Check if forcedRootBlock is configured and that the block is a valid child of the body\n\t\t\t\tif (forcedRootBlockName && self.schema.isValidChild(body.nodeName.toLowerCase(), forcedRootBlockName.toLowerCase())) {\n\t\t\t\t\t// Padd with bogus BR elements on modern browsers and IE 7 and 8 since they don't render empty P tags properly\n\t\t\t\t\tcontent = padd;\n\t\t\t\t\tcontent = self.dom.createHTML(forcedRootBlockName, self.settings.forced_root_block_attrs, content);\n\t\t\t\t} else if (!ie && !content) {\n\t\t\t\t\t// We need to add a BR when forced_root_block is disabled on non IE browsers to place the caret\n\t\t\t\t\tcontent = '<br data-mce-bogus=\"1\">';\n\t\t\t\t}\n\n\t\t\t\tself.dom.setHTML(body, content);\n\n\t\t\t\tself.fire('SetContent', args);\n\t\t\t} else {\n\t\t\t\t// Parse and serialize the html\n\t\t\t\tif (args.format !== 'raw') {\n\t\t\t\t\tcontent = new Serializer({\n\t\t\t\t\t\tvalidate: self.validate\n\t\t\t\t\t}, self.schema).serialize(\n\t\t\t\t\t\tself.parser.parse(content, {isRootContent: true})\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Set the new cleaned contents to the editor\n\t\t\t\targs.content = trim(content);\n\t\t\t\tself.dom.setHTML(body, args.content);\n\n\t\t\t\t// Do post processing\n\t\t\t\tif (!args.no_events) {\n\t\t\t\t\tself.fire('SetContent', args);\n\t\t\t\t}\n\n\t\t\t\t// Don't normalize selection if the focused element isn't the body in\n\t\t\t\t// content editable mode since it will steal focus otherwise\n\t\t\t\t/*if (!self.settings.content_editable || document.activeElement === self.getBody()) {\n\t\t\t\t\tself.selection.normalize();\n\t\t\t\t}*/\n\t\t\t}\n\n\t\t\treturn args.content;\n\t\t},\n\n\t\t/**\n\t\t * Gets the content from the editor instance, this will cleanup the content before it gets returned using\n\t\t * the different cleanup rules options.\n\t\t *\n\t\t * @method getContent\n\t\t * @param {Object} args Optional content object, this gets passed around through the whole get process.\n\t\t * @return {String} Cleaned content string, normally HTML contents.\n\t\t * @example\n\t\t * // Get the HTML contents of the currently active editor\n\t\t * console.debug(tinymce.activeEditor.getContent());\n\t\t *\n\t\t * // Get the raw contents of the currently active editor\n\t\t * tinymce.activeEditor.getContent({format: 'raw'});\n\t\t *\n\t\t * // Get content of a specific editor:\n\t\t * tinymce.get('content id').getContent()\n\t\t */\n\t\tgetContent: function(args) {\n\t\t\tvar self = this, content, body = self.getBody();\n\n\t\t\t// Setup args object\n\t\t\targs = args || {};\n\t\t\targs.format = args.format || 'html';\n\t\t\targs.get = true;\n\t\t\targs.getInner = true;\n\n\t\t\t// Do preprocessing\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.fire('BeforeGetContent', args);\n\t\t\t}\n\n\t\t\t// Get raw contents or by default the cleaned contents\n\t\t\tif (args.format == 'raw') {\n\t\t\t\tcontent = self.serializer.getTrimmedContent();\n\t\t\t} else if (args.format == 'text') {\n\t\t\t\tcontent = body.innerText || body.textContent;\n\t\t\t} else {\n\t\t\t\tcontent = self.serializer.serialize(body, args);\n\t\t\t}\n\n\t\t\t// Trim whitespace in beginning/end of HTML\n\t\t\tif (args.format != 'text') {\n\t\t\t\targs.content = trim(content);\n\t\t\t} else {\n\t\t\t\targs.content = content;\n\t\t\t}\n\n\t\t\t// Do post processing\n\t\t\tif (!args.no_events) {\n\t\t\t\tself.fire('GetContent', args);\n\t\t\t}\n\n\t\t\treturn args.content;\n\t\t},\n\n\t\t/**\n\t\t * Inserts content at caret position.\n\t\t *\n\t\t * @method insertContent\n\t\t * @param {String} content Content to insert.\n\t\t * @param {Object} args Optional args to pass to insert call.\n\t\t */\n\t\tinsertContent: function(content, args) {\n\t\t\tif (args) {\n\t\t\t\tcontent = extend({content: content}, args);\n\t\t\t}\n\n\t\t\tthis.execCommand('mceInsertContent', false, content);\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the editor is dirty or not. It will get dirty if the user has made modifications to the contents.\n\t\t *\n\t\t * The dirty state is automatically set to true if you do modifications to the content in other\n\t\t * words when new undo levels is created or if you undo/redo to update the contents of the editor. It will also be set\n\t\t * to false if you call editor.save().\n\t\t *\n\t\t * @method isDirty\n\t\t * @return {Boolean} True/false if the editor is dirty or not. It will get dirty if the user has made modifications to the contents.\n\t\t * @example\n\t\t * if (tinymce.activeEditor.isDirty())\n\t\t *     alert(\"You must save your contents.\");\n\t\t */\n\t\tisDirty: function() {\n\t\t\treturn !this.isNotDirty;\n\t\t},\n\n\t\t/**\n\t\t * Explicitly sets the dirty state. This will fire the dirty event if the editor dirty state is changed from false to true\n\t\t * by invoking this method.\n\t\t *\n\t\t * @method setDirty\n\t\t * @param {Boolean} state True/false if the editor is considered dirty.\n\t\t * @example\n\t\t * function ajaxSave() {\n\t\t *     var editor = tinymce.get('elm1');\n\t\t *\n\t\t *     // Save contents using some XHR call\n\t\t *     alert(editor.getContent());\n\t\t *\n\t\t *     editor.setDirty(false); // Force not dirty state\n\t\t * }\n\t\t */\n\t\tsetDirty: function(state) {\n\t\t\tvar oldState = !this.isNotDirty;\n\n\t\t\tthis.isNotDirty = !state;\n\n\t\t\tif (state && state != oldState) {\n\t\t\t\tthis.fire('dirty');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets the editor mode. Mode can be for example \"design\", \"code\" or \"readonly\".\n\t\t *\n\t\t * @method setMode\n\t\t * @param {String} mode Mode to set the editor in.\n\t\t */\n\t\tsetMode: function(mode) {\n\t\t\tMode.setMode(this, mode);\n\t\t},\n\n\t\t/**\n\t\t * Returns the editors container element. The container element wrappes in\n\t\t * all the elements added to the page for the editor. Such as UI, iframe etc.\n\t\t *\n\t\t * @method getContainer\n\t\t * @return {Element} HTML DOM element for the editor container.\n\t\t */\n\t\tgetContainer: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!self.container) {\n\t\t\t\tself.container = DOM.get(self.editorContainer || self.id + '_parent');\n\t\t\t}\n\n\t\t\treturn self.container;\n\t\t},\n\n\t\t/**\n\t\t * Returns the editors content area container element. The this element is the one who\n\t\t * holds the iframe or the editable element.\n\t\t *\n\t\t * @method getContentAreaContainer\n\t\t * @return {Element} HTML DOM element for the editor area container.\n\t\t */\n\t\tgetContentAreaContainer: function() {\n\t\t\treturn this.contentAreaContainer;\n\t\t},\n\n\t\t/**\n\t\t * Returns the target element/textarea that got replaced with a TinyMCE editor instance.\n\t\t *\n\t\t * @method getElement\n\t\t * @return {Element} HTML DOM element for the replaced element.\n\t\t */\n\t\tgetElement: function() {\n\t\t\tif (!this.targetElm) {\n\t\t\t\tthis.targetElm = DOM.get(this.id);\n\t\t\t}\n\n\t\t\treturn this.targetElm;\n\t\t},\n\n\t\t/**\n\t\t * Returns the iframes window object.\n\t\t *\n\t\t * @method getWin\n\t\t * @return {Window} Iframe DOM window object.\n\t\t */\n\t\tgetWin: function() {\n\t\t\tvar self = this, elm;\n\n\t\t\tif (!self.contentWindow) {\n\t\t\t\telm = self.iframeElement;\n\n\t\t\t\tif (elm) {\n\t\t\t\t\tself.contentWindow = elm.contentWindow;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self.contentWindow;\n\t\t},\n\n\t\t/**\n\t\t * Returns the iframes document object.\n\t\t *\n\t\t * @method getDoc\n\t\t * @return {Document} Iframe DOM document object.\n\t\t */\n\t\tgetDoc: function() {\n\t\t\tvar self = this, win;\n\n\t\t\tif (!self.contentDocument) {\n\t\t\t\twin = self.getWin();\n\n\t\t\t\tif (win) {\n\t\t\t\t\tself.contentDocument = win.document;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self.contentDocument;\n\t\t},\n\n\t\t/**\n\t\t * Returns the root element of the editable area.\n\t\t * For a non-inline iframe-based editor, returns the iframe's body element.\n\t\t *\n\t\t * @method getBody\n\t\t * @return {Element} The root element of the editable area.\n\t\t */\n\t\tgetBody: function() {\n\t\t\tvar doc = this.getDoc();\n\t\t\treturn this.bodyElement || (doc ? doc.body : null);\n\t\t},\n\n\t\t/**\n\t\t * URL converter function this gets executed each time a user adds an img, a or\n\t\t * any other element that has a URL in it. This will be called both by the DOM and HTML\n\t\t * manipulation functions.\n\t\t *\n\t\t * @method convertURL\n\t\t * @param {string} url URL to convert.\n\t\t * @param {string} name Attribute name src, href etc.\n\t\t * @param {string/HTMLElement} elm Tag name or HTML DOM element depending on HTML or DOM insert.\n\t\t * @return {string} Converted URL string.\n\t\t */\n\t\tconvertURL: function(url, name, elm) {\n\t\t\tvar self = this, settings = self.settings;\n\n\t\t\t// Use callback instead\n\t\t\tif (settings.urlconverter_callback) {\n\t\t\t\treturn self.execCallback('urlconverter_callback', url, elm, true, name);\n\t\t\t}\n\n\t\t\t// Don't convert link href since thats the CSS files that gets loaded into the editor also skip local file URLs\n\t\t\tif (!settings.convert_urls || (elm && elm.nodeName == 'LINK') || url.indexOf('file:') === 0 || url.length === 0) {\n\t\t\t\treturn url;\n\t\t\t}\n\n\t\t\t// Convert to relative\n\t\t\tif (settings.relative_urls) {\n\t\t\t\treturn self.documentBaseURI.toRelative(url);\n\t\t\t}\n\n\t\t\t// Convert to absolute\n\t\t\turl = self.documentBaseURI.toAbsolute(url, settings.remove_script_host);\n\n\t\t\treturn url;\n\t\t},\n\n\t\t/**\n\t\t * Adds visual aid for tables, anchors etc so they can be more easily edited inside the editor.\n\t\t *\n\t\t * @method addVisual\n\t\t * @param {Element} elm Optional root element to loop though to find tables etc that needs the visual aid.\n\t\t */\n\t\taddVisual: function(elm) {\n\t\t\tvar self = this, settings = self.settings, dom = self.dom, cls;\n\n\t\t\telm = elm || self.getBody();\n\n\t\t\tif (self.hasVisual === undefined) {\n\t\t\t\tself.hasVisual = settings.visual;\n\t\t\t}\n\n\t\t\teach(dom.select('table,a', elm), function(elm) {\n\t\t\t\tvar value;\n\n\t\t\t\tswitch (elm.nodeName) {\n\t\t\t\t\tcase 'TABLE':\n\t\t\t\t\t\tcls = settings.visual_table_class || 'mce-item-table';\n\t\t\t\t\t\tvalue = dom.getAttrib(elm, 'border');\n\n\t\t\t\t\t\tif ((!value || value == '0') && self.hasVisual) {\n\t\t\t\t\t\t\tdom.addClass(elm, cls);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdom.removeClass(elm, cls);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tcase 'A':\n\t\t\t\t\t\tif (!dom.getAttrib(elm, 'href', false)) {\n\t\t\t\t\t\t\tvalue = dom.getAttrib(elm, 'name') || elm.id;\n\t\t\t\t\t\t\tcls = settings.visual_anchor_class || 'mce-item-anchor';\n\n\t\t\t\t\t\t\tif (value && self.hasVisual) {\n\t\t\t\t\t\t\t\tdom.addClass(elm, cls);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdom.removeClass(elm, cls);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.fire('VisualAid', {element: elm, hasVisual: self.hasVisual});\n\t\t},\n\n\t\t/**\n\t\t * Removes the editor from the dom and tinymce collection.\n\t\t *\n\t\t * @method remove\n\t\t */\n\t\tremove: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!self.removed) {\n\t\t\t\tself.save();\n\t\t\t\tself.removed = 1;\n\t\t\t\tself.unbindAllNativeEvents();\n\n\t\t\t\t// Remove any hidden input\n\t\t\t\tif (self.hasHiddenInput) {\n\t\t\t\t\tDOM.remove(self.getElement().nextSibling);\n\t\t\t\t}\n\n\t\t\t\tif (!self.inline) {\n\t\t\t\t\t// IE 9 has a bug where the selection stops working if you place the\n\t\t\t\t\t// caret inside the editor then remove the iframe\n\t\t\t\t\tif (ie && ie < 10) {\n\t\t\t\t\t\tself.getDoc().execCommand('SelectAll', false, null);\n\t\t\t\t\t}\n\n\t\t\t\t\tDOM.setStyle(self.id, 'display', self.orgDisplay);\n\t\t\t\t\tself.getBody().onload = null; // Prevent #6816\n\t\t\t\t}\n\n\t\t\t\tself.fire('remove');\n\n\t\t\t\tself.editorManager.remove(self);\n\t\t\t\tDOM.remove(self.getContainer());\n\t\t\t\tself._selectionOverrides.destroy();\n\t\t\t\tself.editorUpload.destroy();\n\t\t\t\tself.destroy();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Destroys the editor instance by removing all events, element references or other resources\n\t\t * that could leak memory. This method will be called automatically when the page is unloaded\n\t\t * but you can also call it directly if you know what you are doing.\n\t\t *\n\t\t * @method destroy\n\t\t * @param {Boolean} automatic Optional state if the destroy is an automatic destroy or user called one.\n\t\t */\n\t\tdestroy: function(automatic) {\n\t\t\tvar self = this, form;\n\n\t\t\t// One time is enough\n\t\t\tif (self.destroyed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If user manually calls destroy and not remove\n\t\t\t// Users seems to have logic that calls destroy instead of remove\n\t\t\tif (!automatic && !self.removed) {\n\t\t\t\tself.remove();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!automatic) {\n\t\t\t\tself.editorManager.off('beforeunload', self._beforeUnload);\n\n\t\t\t\t// Manual destroy\n\t\t\t\tif (self.theme && self.theme.destroy) {\n\t\t\t\t\tself.theme.destroy();\n\t\t\t\t}\n\n\t\t\t\t// Destroy controls, selection and dom\n\t\t\t\tself.selection.destroy();\n\t\t\t\tself.dom.destroy();\n\t\t\t}\n\n\t\t\tform = self.formElement;\n\t\t\tif (form) {\n\t\t\t\tif (form._mceOldSubmit) {\n\t\t\t\t\tform.submit = form._mceOldSubmit;\n\t\t\t\t\tform._mceOldSubmit = null;\n\t\t\t\t}\n\n\t\t\t\tDOM.unbind(form, 'submit reset', self.formEventDelegate);\n\t\t\t}\n\n\t\t\tself.contentAreaContainer = self.formElement = self.container = self.editorContainer = null;\n\t\t\tself.bodyElement = self.contentDocument = self.contentWindow = null;\n\t\t\tself.iframeElement = self.targetElm = null;\n\n\t\t\tif (self.selection) {\n\t\t\t\tself.selection = self.selection.win = self.selection.dom = self.selection.dom.doc = null;\n\t\t\t}\n\n\t\t\tself.destroyed = 1;\n\t\t},\n\n\t\t/**\n\t\t * Uploads all data uri/blob uri images in the editor contents to server.\n\t\t *\n\t\t * @method uploadImages\n\t\t * @param {function} callback Optional callback with images and status for each image.\n\t\t * @return {tinymce.util.Promise} Promise instance.\n\t\t */\n\t\tuploadImages: function(callback) {\n\t\t\treturn this.editorUpload.uploadImages(callback);\n\t\t},\n\n\t\t// Internal functions\n\n\t\t_scanForImages: function() {\n\t\t\treturn this.editorUpload.scanForImages();\n\t\t}\n\t};\n\n\textend(Editor.prototype, EditorObservable);\n\n\treturn Editor;\n});\n\n// Included from: js/tinymce/classes/util/I18n.js\n\n/**\n * I18n.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * I18n class that handles translation of TinyMCE UI.\n * Uses po style with csharp style parameters.\n *\n * @class tinymce.util.I18n\n */\ndefine(\"tinymce/util/I18n\", [], function() {\n\t\"use strict\";\n\n\tvar data = {}, code = \"en\";\n\n\treturn {\n\t\t/**\n\t\t * Sets the current language code.\n\t\t *\n\t\t * @method setCode\n\t\t * @param {String} newCode Current language code.\n\t\t */\n\t\tsetCode: function(newCode) {\n\t\t\tif (newCode) {\n\t\t\t\tcode = newCode;\n\t\t\t\tthis.rtl = this.data[newCode] ? this.data[newCode]._dir === 'rtl' : false;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns the current language code.\n\t\t *\n\t\t * @method getCode\n\t\t * @return {String} Current language code.\n\t\t */\n\t\tgetCode: function() {\n\t\t\treturn code;\n\t\t},\n\n\t\t/**\n\t\t * Property gets set to true if a RTL language pack was loaded.\n\t\t *\n\t\t * @property rtl\n\t\t * @type Boolean\n\t\t */\n\t\trtl: false,\n\n\t\t/**\n\t\t * Adds translations for a specific language code.\n\t\t *\n\t\t * @method add\n\t\t * @param {String} code Language code like sv_SE.\n\t\t * @param {Array} items Name/value array with English en_US to sv_SE.\n\t\t */\n\t\tadd: function(code, items) {\n\t\t\tvar langData = data[code];\n\n\t\t\tif (!langData) {\n\t\t\t\tdata[code] = langData = {};\n\t\t\t}\n\n\t\t\tfor (var name in items) {\n\t\t\t\tlangData[name] = items[name];\n\t\t\t}\n\n\t\t\tthis.setCode(code);\n\t\t},\n\n\t\t/**\n\t\t * Translates the specified text.\n\t\t *\n\t\t * It has a few formats:\n\t\t * I18n.translate(\"Text\");\n\t\t * I18n.translate([\"Text {0}/{1}\", 0, 1]);\n\t\t * I18n.translate({raw: \"Raw string\"});\n\t\t *\n\t\t * @method translate\n\t\t * @param {String/Object/Array} text Text to translate.\n\t\t * @return {String} String that got translated.\n\t\t */\n\t\ttranslate: function(text) {\n\t\t\tvar langData;\n\n\t\t\tlangData = data[code];\n\t\t\tif (!langData) {\n\t\t\t\tlangData = {};\n\t\t\t}\n\n\t\t\tif (typeof text == \"undefined\") {\n\t\t\t\treturn text;\n\t\t\t}\n\n\t\t\tif (typeof text != \"string\" && text.raw) {\n\t\t\t\treturn text.raw;\n\t\t\t}\n\n\t\t\tif (text.push) {\n\t\t\t\tvar values = text.slice(1);\n\n\t\t\t\ttext = (langData[text[0]] || text[0]).replace(/\\{([0-9]+)\\}/g, function(match1, match2) {\n\t\t\t\t\treturn values[match2];\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn (langData[text] || text).replace(/{context:\\w+}$/, '');\n\t\t},\n\n\t\tdata: data\n\t};\n});\n\n// Included from: js/tinymce/classes/FocusManager.js\n\n/**\n * FocusManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class manages the focus/blur state of the editor. This class is needed since some\n * browsers fire false focus/blur states when the selection is moved to a UI dialog or similar.\n *\n * This class will fire two events focus and blur on the editor instances that got affected.\n * It will also handle the restore of selection when the focus is lost and returned.\n *\n * @class tinymce.FocusManager\n */\ndefine(\"tinymce/FocusManager\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/util/Delay\",\n\t\"tinymce/Env\"\n], function(DOMUtils, Delay, Env) {\n\tvar selectionChangeHandler, documentFocusInHandler, documentMouseUpHandler, DOM = DOMUtils.DOM;\n\n\t/**\n\t * Constructs a new focus manager instance.\n\t *\n\t * @constructor FocusManager\n\t * @param {tinymce.EditorManager} editorManager Editor manager instance to handle focus for.\n\t */\n\tfunction FocusManager(editorManager) {\n\t\tfunction getActiveElement() {\n\t\t\ttry {\n\t\t\t\treturn document.activeElement;\n\t\t\t} catch (ex) {\n\t\t\t\t// IE sometimes fails to get the activeElement when resizing table\n\t\t\t\t// TODO: Investigate this\n\t\t\t\treturn document.body;\n\t\t\t}\n\t\t}\n\n\t\t// We can't store a real range on IE 11 since it gets mutated so we need to use a bookmark object\n\t\t// TODO: Move this to a separate range utils class since it's it's logic is present in Selection as well.\n\t\tfunction createBookmark(dom, rng) {\n\t\t\tif (rng && rng.startContainer) {\n\t\t\t\t// Verify that the range is within the root of the editor\n\t\t\t\tif (!dom.isChildOf(rng.startContainer, dom.getRoot()) || !dom.isChildOf(rng.endContainer, dom.getRoot())) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tstartContainer: rng.startContainer,\n\t\t\t\t\tstartOffset: rng.startOffset,\n\t\t\t\t\tendContainer: rng.endContainer,\n\t\t\t\t\tendOffset: rng.endOffset\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn rng;\n\t\t}\n\n\t\tfunction bookmarkToRng(editor, bookmark) {\n\t\t\tvar rng;\n\n\t\t\tif (bookmark.startContainer) {\n\t\t\t\trng = editor.getDoc().createRange();\n\t\t\t\trng.setStart(bookmark.startContainer, bookmark.startOffset);\n\t\t\t\trng.setEnd(bookmark.endContainer, bookmark.endOffset);\n\t\t\t} else {\n\t\t\t\trng = bookmark;\n\t\t\t}\n\n\t\t\treturn rng;\n\t\t}\n\n\t\tfunction isUIElement(elm) {\n\t\t\treturn !!DOM.getParent(elm, FocusManager.isEditorUIElement);\n\t\t}\n\n\t\tfunction registerEvents(e) {\n\t\t\tvar editor = e.editor;\n\n\t\t\teditor.on('init', function() {\n\t\t\t\t// Gecko/WebKit has ghost selections in iframes and IE only has one selection per browser tab\n\t\t\t\tif (editor.inline || Env.ie) {\n\t\t\t\t\t// Use the onbeforedeactivate event when available since it works better see #7023\n\t\t\t\t\tif (\"onbeforedeactivate\" in document && Env.ie < 9) {\n\t\t\t\t\t\teditor.dom.bind(editor.getBody(), 'beforedeactivate', function(e) {\n\t\t\t\t\t\t\tif (e.target != editor.getBody()) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\teditor.lastRng = editor.selection.getRng();\n\t\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\t\t// IE throws \"Unexcpected call to method or property access\" some times so lets ignore it\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// On other browsers take snapshot on nodechange in inline mode since they have Ghost selections for iframes\n\t\t\t\t\t\teditor.on('nodechange mouseup keyup', function(e) {\n\t\t\t\t\t\t\tvar node = getActiveElement();\n\n\t\t\t\t\t\t\t// Only act on manual nodechanges\n\t\t\t\t\t\t\tif (e.type == 'nodechange' && e.selectionChange) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// IE 11 reports active element as iframe not body of iframe\n\t\t\t\t\t\t\tif (node && node.id == editor.id + '_ifr') {\n\t\t\t\t\t\t\t\tnode = editor.getBody();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (editor.dom.isChildOf(node, editor.getBody())) {\n\t\t\t\t\t\t\t\teditor.lastRng = editor.selection.getRng();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Handles the issue with WebKit not retaining selection within inline document\n\t\t\t\t\t// If the user releases the mouse out side the body since a mouse up event wont occur on the body\n\t\t\t\t\tif (Env.webkit && !selectionChangeHandler) {\n\t\t\t\t\t\tselectionChangeHandler = function() {\n\t\t\t\t\t\t\tvar activeEditor = editorManager.activeEditor;\n\n\t\t\t\t\t\t\tif (activeEditor && activeEditor.selection) {\n\t\t\t\t\t\t\t\tvar rng = activeEditor.selection.getRng();\n\n\t\t\t\t\t\t\t\t// Store when it's non collapsed\n\t\t\t\t\t\t\t\tif (rng && !rng.collapsed) {\n\t\t\t\t\t\t\t\t\teditor.lastRng = rng;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tDOM.bind(document, 'selectionchange', selectionChangeHandler);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teditor.on('setcontent', function() {\n\t\t\t\teditor.lastRng = null;\n\t\t\t});\n\n\t\t\t// Remove last selection bookmark on mousedown see #6305\n\t\t\teditor.on('mousedown', function() {\n\t\t\t\teditor.selection.lastFocusBookmark = null;\n\t\t\t});\n\n\t\t\teditor.on('focusin', function() {\n\t\t\t\tvar focusedEditor = editorManager.focusedEditor, lastRng;\n\n\t\t\t\tif (editor.selection.lastFocusBookmark) {\n\t\t\t\t\tlastRng = bookmarkToRng(editor, editor.selection.lastFocusBookmark);\n\t\t\t\t\teditor.selection.lastFocusBookmark = null;\n\t\t\t\t\teditor.selection.setRng(lastRng);\n\t\t\t\t}\n\n\t\t\t\tif (focusedEditor != editor) {\n\t\t\t\t\tif (focusedEditor) {\n\t\t\t\t\t\tfocusedEditor.fire('blur', {focusedEditor: editor});\n\t\t\t\t\t}\n\n\t\t\t\t\teditorManager.setActive(editor);\n\t\t\t\t\teditorManager.focusedEditor = editor;\n\t\t\t\t\teditor.fire('focus', {blurredEditor: focusedEditor});\n\t\t\t\t\teditor.focus(true);\n\t\t\t\t}\n\n\t\t\t\teditor.lastRng = null;\n\t\t\t});\n\n\t\t\teditor.on('focusout', function() {\n\t\t\t\tDelay.setEditorTimeout(editor, function() {\n\t\t\t\t\tvar focusedEditor = editorManager.focusedEditor;\n\n\t\t\t\t\t// Still the same editor the blur was outside any editor UI\n\t\t\t\t\tif (!isUIElement(getActiveElement()) && focusedEditor == editor) {\n\t\t\t\t\t\teditor.fire('blur', {focusedEditor: null});\n\t\t\t\t\t\teditorManager.focusedEditor = null;\n\n\t\t\t\t\t\t// Make sure selection is valid could be invalid if the editor is blured and removed before the timeout occurs\n\t\t\t\t\t\tif (editor.selection) {\n\t\t\t\t\t\t\teditor.selection.lastFocusBookmark = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// Check if focus is moved to an element outside the active editor by checking if the target node\n\t\t\t// isn't within the body of the activeEditor nor a UI element such as a dialog child control\n\t\t\tif (!documentFocusInHandler) {\n\t\t\t\tdocumentFocusInHandler = function(e) {\n\t\t\t\t\tvar activeEditor = editorManager.activeEditor, target;\n\n\t\t\t\t\ttarget = e.target;\n\n\t\t\t\t\tif (activeEditor && target.ownerDocument == document) {\n\t\t\t\t\t\t// Check to make sure we have a valid selection don't update the bookmark if it's\n\t\t\t\t\t\t// a focusin to the body of the editor see #7025\n\t\t\t\t\t\tif (activeEditor.selection && target != activeEditor.getBody()) {\n\t\t\t\t\t\t\tactiveEditor.selection.lastFocusBookmark = createBookmark(activeEditor.dom, activeEditor.lastRng);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Fire a blur event if the element isn't a UI element\n\t\t\t\t\t\tif (target != document.body && !isUIElement(target) && editorManager.focusedEditor == activeEditor) {\n\t\t\t\t\t\t\tactiveEditor.fire('blur', {focusedEditor: null});\n\t\t\t\t\t\t\teditorManager.focusedEditor = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tDOM.bind(document, 'focusin', documentFocusInHandler);\n\t\t\t}\n\n\t\t\t// Handle edge case when user starts the selection inside the editor and releases\n\t\t\t// the mouse outside the editor producing a new selection. This weird workaround is needed since\n\t\t\t// Gecko doesn't have the \"selectionchange\" event we need to do this. Fixes: #6843\n\t\t\tif (editor.inline && !documentMouseUpHandler) {\n\t\t\t\tdocumentMouseUpHandler = function(e) {\n\t\t\t\t\tvar activeEditor = editorManager.activeEditor, dom = activeEditor.dom;\n\n\t\t\t\t\tif (activeEditor.inline && dom && !dom.isChildOf(e.target, activeEditor.getBody())) {\n\t\t\t\t\t\tvar rng = activeEditor.selection.getRng();\n\n\t\t\t\t\t\tif (!rng.collapsed) {\n\t\t\t\t\t\t\tactiveEditor.lastRng = rng;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tDOM.bind(document, 'mouseup', documentMouseUpHandler);\n\t\t\t}\n\t\t}\n\n\t\tfunction unregisterDocumentEvents(e) {\n\t\t\tif (editorManager.focusedEditor == e.editor) {\n\t\t\t\teditorManager.focusedEditor = null;\n\t\t\t}\n\n\t\t\tif (!editorManager.activeEditor) {\n\t\t\t\tDOM.unbind(document, 'selectionchange', selectionChangeHandler);\n\t\t\t\tDOM.unbind(document, 'focusin', documentFocusInHandler);\n\t\t\t\tDOM.unbind(document, 'mouseup', documentMouseUpHandler);\n\t\t\t\tselectionChangeHandler = documentFocusInHandler = documentMouseUpHandler = null;\n\t\t\t}\n\t\t}\n\n\t\teditorManager.on('AddEditor', registerEvents);\n\t\teditorManager.on('RemoveEditor', unregisterDocumentEvents);\n\t}\n\n\t/**\n\t * Returns true if the specified element is part of the UI for example an button or text input.\n\t *\n\t * @method isEditorUIElement\n\t * @param  {Element} elm Element to check if it's part of the UI or not.\n\t * @return {Boolean} True/false state if the element is part of the UI or not.\n\t */\n\tFocusManager.isEditorUIElement = function(elm) {\n\t\t// Needs to be converted to string since svg can have focus: #6776\n\t\treturn elm.className.toString().indexOf('mce-') !== -1;\n\t};\n\n\treturn FocusManager;\n});\n\n// Included from: js/tinymce/classes/EditorManager.js\n\n/**\n * EditorManager.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class used as a factory for manager for tinymce.Editor instances.\n *\n * @example\n * tinymce.EditorManager.init({});\n *\n * @class tinymce.EditorManager\n * @mixes tinymce.util.Observable\n * @static\n */\ndefine(\"tinymce/EditorManager\", [\n\t\"tinymce/Editor\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/util/URI\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/util/Promise\",\n\t\"tinymce/util/Observable\",\n\t\"tinymce/util/I18n\",\n\t\"tinymce/FocusManager\"\n], function(Editor, $, DOMUtils, URI, Env, Tools, Promise, Observable, I18n, FocusManager) {\n\tvar DOM = DOMUtils.DOM;\n\tvar explode = Tools.explode, each = Tools.each, extend = Tools.extend;\n\tvar instanceCounter = 0, beforeUnloadDelegate, EditorManager, boundGlobalEvents = false;\n\n\tfunction globalEventDelegate(e) {\n\t\teach(EditorManager.editors, function(editor) {\n\t\t\tif (e.type === 'scroll') {\n\t\t\t\teditor.fire('ScrollWindow', e);\n\t\t\t} else {\n\t\t\t\teditor.fire('ResizeWindow', e);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction toggleGlobalEvents(editors, state) {\n\t\tif (state !== boundGlobalEvents) {\n\t\t\tif (state) {\n\t\t\t\t$(window).on('resize scroll', globalEventDelegate);\n\t\t\t} else {\n\t\t\t\t$(window).off('resize scroll', globalEventDelegate);\n\t\t\t}\n\n\t\t\tboundGlobalEvents = state;\n\t\t}\n\t}\n\n\tfunction removeEditorFromList(editor) {\n\t\tvar editors = EditorManager.editors, removedFromList;\n\n\t\tdelete editors[editor.id];\n\n\t\tfor (var i = 0; i < editors.length; i++) {\n\t\t\tif (editors[i] == editor) {\n\t\t\t\teditors.splice(i, 1);\n\t\t\t\tremovedFromList = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Select another editor since the active one was removed\n\t\tif (EditorManager.activeEditor == editor) {\n\t\t\tEditorManager.activeEditor = editors[0];\n\t\t}\n\n\t\t// Clear focusedEditor if necessary, so that we don't try to blur the destroyed editor\n\t\tif (EditorManager.focusedEditor == editor) {\n\t\t\tEditorManager.focusedEditor = null;\n\t\t}\n\n\t\treturn removedFromList;\n\t}\n\n\tfunction purgeDestroyedEditor(editor) {\n\t\t// User has manually destroyed the editor lets clean up the mess\n\t\tif (editor && editor.initialized && !(editor.getContainer() || editor.getBody()).parentNode) {\n\t\t\tremoveEditorFromList(editor);\n\t\t\teditor.unbindAllNativeEvents();\n\t\t\teditor.destroy(true);\n\t\t\teditor.removed = true;\n\t\t\teditor = null;\n\t\t}\n\n\t\treturn editor;\n\t}\n\n\tEditorManager = {\n\t\t/**\n\t\t * Dom query instance.\n\t\t *\n\t\t * @property $\n\t\t * @type tinymce.dom.DomQuery\n\t\t */\n\t\t$: $,\n\n\t\t/**\n\t\t * Major version of TinyMCE build.\n\t\t *\n\t\t * @property majorVersion\n\t\t * @type String\n\t\t */\n\t\tmajorVersion: '4',\n\n\t\t/**\n\t\t * Minor version of TinyMCE build.\n\t\t *\n\t\t * @property minorVersion\n\t\t * @type String\n\t\t */\n\t\tminorVersion: '4.3',\n\n\t\t/**\n\t\t * Release date of TinyMCE build.\n\t\t *\n\t\t * @property releaseDate\n\t\t * @type String\n\t\t */\n\t\treleaseDate: '2016-09-01',\n\n\t\t/**\n\t\t * Collection of editor instances.\n\t\t *\n\t\t * @property editors\n\t\t * @type Object\n\t\t * @example\n\t\t * for (edId in tinymce.editors)\n\t\t *     tinymce.editors[edId].save();\n\t\t */\n\t\teditors: [],\n\n\t\t/**\n\t\t * Collection of language pack data.\n\t\t *\n\t\t * @property i18n\n\t\t * @type Object\n\t\t */\n\t\ti18n: I18n,\n\n\t\t/**\n\t\t * Currently active editor instance.\n\t\t *\n\t\t * @property activeEditor\n\t\t * @type tinymce.Editor\n\t\t * @example\n\t\t * tinyMCE.activeEditor.selection.getContent();\n\t\t * tinymce.EditorManager.activeEditor.selection.getContent();\n\t\t */\n\t\tactiveEditor: null,\n\n\t\tsetup: function() {\n\t\t\tvar self = this, baseURL, documentBaseURL, suffix = \"\", preInit, src;\n\n\t\t\t// Get base URL for the current document\n\t\t\tdocumentBaseURL = URI.getDocumentBaseUrl(document.location);\n\n\t\t\t// Check if the URL is a document based format like: http://site/dir/file and file:///\n\t\t\t// leave other formats like applewebdata://... intact\n\t\t\tif (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(documentBaseURL)) {\n\t\t\t\tdocumentBaseURL = documentBaseURL.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n\n\t\t\t\tif (!/[\\/\\\\]$/.test(documentBaseURL)) {\n\t\t\t\t\tdocumentBaseURL += '/';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If tinymce is defined and has a base use that or use the old tinyMCEPreInit\n\t\t\tpreInit = window.tinymce || window.tinyMCEPreInit;\n\t\t\tif (preInit) {\n\t\t\t\tbaseURL = preInit.base || preInit.baseURL;\n\t\t\t\tsuffix = preInit.suffix;\n\t\t\t} else {\n\t\t\t\t// Get base where the tinymce script is located\n\t\t\t\tvar scripts = document.getElementsByTagName('script');\n\t\t\t\tfor (var i = 0; i < scripts.length; i++) {\n\t\t\t\t\tsrc = scripts[i].src;\n\n\t\t\t\t\t// Script types supported:\n\t\t\t\t\t// tinymce.js tinymce.min.js tinymce.dev.js\n\t\t\t\t\t// tinymce.jquery.js tinymce.jquery.min.js tinymce.jquery.dev.js\n\t\t\t\t\t// tinymce.full.js tinymce.full.min.js tinymce.full.dev.js\n\t\t\t\t\tvar srcScript = src.substring(src.lastIndexOf('/'));\n\t\t\t\t\tif (/tinymce(\\.full|\\.jquery|)(\\.min|\\.dev|)\\.js/.test(src)) {\n\t\t\t\t\t\tif (srcScript.indexOf('.min') != -1) {\n\t\t\t\t\t\t\tsuffix = '.min';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbaseURL = src.substring(0, src.lastIndexOf('/'));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// We didn't find any baseURL by looking at the script elements\n\t\t\t\t// Try to use the document.currentScript as a fallback\n\t\t\t\tif (!baseURL && document.currentScript) {\n\t\t\t\t\tsrc = document.currentScript.src;\n\n\t\t\t\t\tif (src.indexOf('.min') != -1) {\n\t\t\t\t\t\tsuffix = '.min';\n\t\t\t\t\t}\n\n\t\t\t\t\tbaseURL = src.substring(0, src.lastIndexOf('/'));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Base URL where the root directory if TinyMCE is located.\n\t\t\t *\n\t\t\t * @property baseURL\n\t\t\t * @type String\n\t\t\t */\n\t\t\tself.baseURL = new URI(documentBaseURL).toAbsolute(baseURL);\n\n\t\t\t/**\n\t\t\t * Document base URL where the current document is located.\n\t\t\t *\n\t\t\t * @property documentBaseURL\n\t\t\t * @type String\n\t\t\t */\n\t\t\tself.documentBaseURL = documentBaseURL;\n\n\t\t\t/**\n\t\t\t * Absolute baseURI for the installation path of TinyMCE.\n\t\t\t *\n\t\t\t * @property baseURI\n\t\t\t * @type tinymce.util.URI\n\t\t\t */\n\t\t\tself.baseURI = new URI(self.baseURL);\n\n\t\t\t/**\n\t\t\t * Current suffix to add to each plugin/theme that gets loaded for example \".min\".\n\t\t\t *\n\t\t\t * @property suffix\n\t\t\t * @type String\n\t\t\t */\n\t\t\tself.suffix = suffix;\n\n\t\t\tself.focusManager = new FocusManager(self);\n\t\t},\n\n\t\t/**\n\t\t * Overrides the default settings for editor instances.\n\t\t *\n\t\t * @method overrideDefaults\n\t\t * @param {Object} defaultSettings Defaults settings object.\n\t\t */\n\t\toverrideDefaults: function(defaultSettings) {\n\t\t\tvar baseUrl, suffix;\n\n\t\t\tbaseUrl = defaultSettings.base_url;\n\t\t\tif (baseUrl) {\n\t\t\t\tthis.baseURL = new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\\/+$/, ''));\n\t\t\t\tthis.baseURI = new URI(this.baseURL);\n\t\t\t}\n\n\t\t\tsuffix = defaultSettings.suffix;\n\t\t\tif (defaultSettings.suffix) {\n\t\t\t\tthis.suffix = suffix;\n\t\t\t}\n\n\t\t\tthis.defaultSettings = defaultSettings;\n\t\t},\n\n\t\t/**\n\t\t * Initializes a set of editors. This method will create editors based on various settings.\n\t\t *\n\t\t * @method init\n\t\t * @param {Object} settings Settings object to be passed to each editor instance.\n\t\t * @return {tinymce.util.Promise} Promise that gets resolved with an array of editors when all editor instances are initialized.\n\t\t * @example\n\t\t * // Initializes a editor using the longer method\n\t\t * tinymce.EditorManager.init({\n\t\t *    some_settings : 'some value'\n\t\t * });\n\t\t *\n\t\t * // Initializes a editor instance using the shorter version and with a promise\n\t\t * tinymce.init({\n\t\t *    some_settings : 'some value'\n\t\t * }).then(function(editors) {\n\t\t *    ...\n\t\t * });\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, result, invalidInlineTargets;\n\n\t\t\tinvalidInlineTargets = Tools.makeMap(\n\t\t\t\t'area base basefont br col frame hr img input isindex link meta param embed source wbr track ' +\n\t\t\t\t'colgroup option tbody tfoot thead tr script noscript style textarea video audio iframe object menu',\n\t\t\t\t' '\n\t\t\t);\n\n\t\t\tfunction isInvalidInlineTarget(settings, elm) {\n\t\t\t\treturn settings.inline && elm.tagName.toLowerCase() in invalidInlineTargets;\n\t\t\t}\n\n\t\t\tfunction report(msg, elm) {\n\t\t\t\t// Log in a non test environment\n\t\t\t\tif (window.console && !window.test) {\n\t\t\t\t\twindow.console.log(msg, elm);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction createId(elm) {\n\t\t\t\tvar id = elm.id;\n\n\t\t\t\t// Use element id, or unique name or generate a unique id\n\t\t\t\tif (!id) {\n\t\t\t\t\tid = elm.name;\n\n\t\t\t\t\tif (id && !DOM.get(id)) {\n\t\t\t\t\t\tid = elm.name;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Generate unique name\n\t\t\t\t\t\tid = DOM.uniqueId();\n\t\t\t\t\t}\n\n\t\t\t\t\telm.setAttribute('id', id);\n\t\t\t\t}\n\n\t\t\t\treturn id;\n\t\t\t}\n\n\t\t\tfunction execCallback(name) {\n\t\t\t\tvar callback = settings[name];\n\n\t\t\t\tif (!callback) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treturn callback.apply(self, Array.prototype.slice.call(arguments, 2));\n\t\t\t}\n\n\t\t\tfunction hasClass(elm, className) {\n\t\t\t\treturn className.constructor === RegExp ? className.test(elm.className) : DOM.hasClass(elm, className);\n\t\t\t}\n\n\t\t\tfunction findTargets(settings) {\n\t\t\t\tvar l, targets = [];\n\n\t\t\t\tif (settings.types) {\n\t\t\t\t\teach(settings.types, function(type) {\n\t\t\t\t\t\ttargets = targets.concat(DOM.select(type.selector));\n\t\t\t\t\t});\n\n\t\t\t\t\treturn targets;\n\t\t\t\t} else if (settings.selector) {\n\t\t\t\t\treturn DOM.select(settings.selector);\n\t\t\t\t} else if (settings.target) {\n\t\t\t\t\treturn [settings.target];\n\t\t\t\t}\n\n\t\t\t\t// Fallback to old setting\n\t\t\t\tswitch (settings.mode) {\n\t\t\t\t\tcase \"exact\":\n\t\t\t\t\t\tl = settings.elements || '';\n\n\t\t\t\t\t\tif (l.length > 0) {\n\t\t\t\t\t\t\teach(explode(l), function(id) {\n\t\t\t\t\t\t\t\tvar elm;\n\n\t\t\t\t\t\t\t\tif ((elm = DOM.get(id))) {\n\t\t\t\t\t\t\t\t\ttargets.push(elm);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\teach(document.forms, function(f) {\n\t\t\t\t\t\t\t\t\t\teach(f.elements, function(e) {\n\t\t\t\t\t\t\t\t\t\t\tif (e.name === id) {\n\t\t\t\t\t\t\t\t\t\t\t\tid = 'mce_editor_' + instanceCounter++;\n\t\t\t\t\t\t\t\t\t\t\t\tDOM.setAttrib(e, 'id', id);\n\t\t\t\t\t\t\t\t\t\t\t\ttargets.push(e);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"textareas\":\n\t\t\t\t\tcase \"specific_textareas\":\n\t\t\t\t\t\teach(DOM.select('textarea'), function(elm) {\n\t\t\t\t\t\t\tif (settings.editor_deselector && hasClass(elm, settings.editor_deselector)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!settings.editor_selector || hasClass(elm, settings.editor_selector)) {\n\t\t\t\t\t\t\t\ttargets.push(elm);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\treturn targets;\n\t\t\t}\n\n\t\t\tvar provideResults = function(editors) {\n\t\t\t\tresult = editors;\n\t\t\t};\n\n\t\t\tfunction initEditors() {\n\t\t\t\tvar initCount = 0, editors = [], targets;\n\n\t\t\t\tfunction createEditor(id, settings, targetElm) {\n\t\t\t\t\tvar editor = new Editor(id, settings, self);\n\n\t\t\t\t\teditors.push(editor);\n\n\t\t\t\t\teditor.on('init', function() {\n\t\t\t\t\t\tif (++initCount === targets.length) {\n\t\t\t\t\t\t\tprovideResults(editors);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\teditor.targetElm = editor.targetElm || targetElm;\n\t\t\t\t\teditor.render();\n\t\t\t\t}\n\n\t\t\t\tDOM.unbind(window, 'ready', initEditors);\n\t\t\t\texecCallback('onpageload');\n\n\t\t\t\ttargets = $.unique(findTargets(settings));\n\n\t\t\t\t// TODO: Deprecate this one\n\t\t\t\tif (settings.types) {\n\t\t\t\t\teach(settings.types, function(type) {\n\t\t\t\t\t\tTools.each(targets, function(elm) {\n\t\t\t\t\t\t\tif (DOM.is(elm, type.selector)) {\n\t\t\t\t\t\t\t\tcreateEditor(createId(elm), extend({}, settings, type), elm);\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tTools.each(targets, function(elm) {\n\t\t\t\t\tpurgeDestroyedEditor(self.get(elm.id));\n\t\t\t\t});\n\n\t\t\t\ttargets = Tools.grep(targets, function(elm) {\n\t\t\t\t\treturn !self.get(elm.id);\n\t\t\t\t});\n\n\t\t\t\teach(targets, function(elm) {\n\t\t\t\t\tif (isInvalidInlineTarget(settings, elm)) {\n\t\t\t\t\t\treport('Could not initialize inline editor on invalid inline target element', elm);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcreateEditor(createId(elm), settings, elm);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tself.settings = settings;\n\t\t\tDOM.bind(window, 'ready', initEditors);\n\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tif (result) {\n\t\t\t\t\tresolve(result);\n\t\t\t\t} else {\n\t\t\t\t\tprovideResults = function(editors) {\n\t\t\t\t\t\tresolve(editors);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Returns a editor instance by id.\n\t\t *\n\t\t * @method get\n\t\t * @param {String/Number} id Editor instance id or index to return.\n\t\t * @return {tinymce.Editor} Editor instance to return.\n\t\t * @example\n\t\t * // Adds an onclick event to an editor by id (shorter version)\n\t\t * tinymce.get('mytextbox').on('click', function(e) {\n\t\t *    ed.windowManager.alert('Hello world!');\n\t\t * });\n\t\t *\n\t\t * // Adds an onclick event to an editor by id (longer version)\n\t\t * tinymce.EditorManager.get('mytextbox').on('click', function(e) {\n\t\t *    ed.windowManager.alert('Hello world!');\n\t\t * });\n\t\t */\n\t\tget: function(id) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.editors;\n\t\t\t}\n\n\t\t\treturn id in this.editors ? this.editors[id] : null;\n\t\t},\n\n\t\t/**\n\t\t * Adds an editor instance to the editor collection. This will also set it as the active editor.\n\t\t *\n\t\t * @method add\n\t\t * @param {tinymce.Editor} editor Editor instance to add to the collection.\n\t\t * @return {tinymce.Editor} The same instance that got passed in.\n\t\t */\n\t\tadd: function(editor) {\n\t\t\tvar self = this, editors = self.editors;\n\n\t\t\t// Add named and index editor instance\n\t\t\teditors[editor.id] = editor;\n\t\t\teditors.push(editor);\n\n\t\t\ttoggleGlobalEvents(editors, true);\n\n\t\t\t// Doesn't call setActive method since we don't want\n\t\t\t// to fire a bunch of activate/deactivate calls while initializing\n\t\t\tself.activeEditor = editor;\n\n\t\t\t/**\n\t\t\t * Fires when an editor is added to the EditorManager collection.\n\t\t\t *\n\t\t\t * @event AddEditor\n\t\t\t * @param {Object} e Event arguments.\n\t\t\t */\n\t\t\tself.fire('AddEditor', {editor: editor});\n\n\t\t\tif (!beforeUnloadDelegate) {\n\t\t\t\tbeforeUnloadDelegate = function() {\n\t\t\t\t\tself.fire('BeforeUnload');\n\t\t\t\t};\n\n\t\t\t\tDOM.bind(window, 'beforeunload', beforeUnloadDelegate);\n\t\t\t}\n\n\t\t\treturn editor;\n\t\t},\n\n\t\t/**\n\t\t * Creates an editor instance and adds it to the EditorManager collection.\n\t\t *\n\t\t * @method createEditor\n\t\t * @param {String} id Instance id to use for editor.\n\t\t * @param {Object} settings Editor instance settings.\n\t\t * @return {tinymce.Editor} Editor instance that got created.\n\t\t */\n\t\tcreateEditor: function(id, settings) {\n\t\t\treturn this.add(new Editor(id, settings, this));\n\t\t},\n\n\t\t/**\n\t\t * Removes a editor or editors form page.\n\t\t *\n\t\t * @example\n\t\t * // Remove all editors bound to divs\n\t\t * tinymce.remove('div');\n\t\t *\n\t\t * // Remove all editors bound to textareas\n\t\t * tinymce.remove('textarea');\n\t\t *\n\t\t * // Remove all editors\n\t\t * tinymce.remove();\n\t\t *\n\t\t * // Remove specific instance by id\n\t\t * tinymce.remove('#id');\n\t\t *\n\t\t * @method remove\n\t\t * @param {tinymce.Editor/String/Object} [selector] CSS selector or editor instance to remove.\n\t\t * @return {tinymce.Editor} The editor that got passed in will be return if it was found otherwise null.\n\t\t */\n\t\tremove: function(selector) {\n\t\t\tvar self = this, i, editors = self.editors, editor;\n\n\t\t\t// Remove all editors\n\t\t\tif (!selector) {\n\t\t\t\tfor (i = editors.length - 1; i >= 0; i--) {\n\t\t\t\t\tself.remove(editors[i]);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Remove editors by selector\n\t\t\tif (typeof selector == \"string\") {\n\t\t\t\tselector = selector.selector || selector;\n\n\t\t\t\teach(DOM.select(selector), function(elm) {\n\t\t\t\t\teditor = editors[elm.id];\n\n\t\t\t\t\tif (editor) {\n\t\t\t\t\t\tself.remove(editor);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Remove specific editor\n\t\t\teditor = selector;\n\n\t\t\t// Not in the collection\n\t\t\tif (!editors[editor.id]) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Fires when an editor is removed from EditorManager collection.\n\t\t\t *\n\t\t\t * @event RemoveEditor\n\t\t\t * @param {Object} e Event arguments.\n\t\t\t */\n\t\t\tif (removeEditorFromList(editor)) {\n\t\t\t\tself.fire('RemoveEditor', {editor: editor});\n\t\t\t}\n\n\t\t\tif (!editors.length) {\n\t\t\t\tDOM.unbind(window, 'beforeunload', beforeUnloadDelegate);\n\t\t\t}\n\n\t\t\teditor.remove();\n\n\t\t\ttoggleGlobalEvents(editors, editors.length > 0);\n\n\t\t\treturn editor;\n\t\t},\n\n\t\t/**\n\t\t * Executes a specific command on the currently active editor.\n\t\t *\n\t\t * @method execCommand\n\t\t * @param {String} cmd Command to perform for example Bold.\n\t\t * @param {Boolean} ui Optional boolean state if a UI should be presented for the command or not.\n\t\t * @param {String} value Optional value parameter like for example an URL to a link.\n\t\t * @return {Boolean} true/false if the command was executed or not.\n\t\t */\n\t\texecCommand: function(cmd, ui, value) {\n\t\t\tvar self = this, editor = self.get(value);\n\n\t\t\t// Manager commands\n\t\t\tswitch (cmd) {\n\t\t\t\tcase \"mceAddEditor\":\n\t\t\t\t\tif (!self.get(value)) {\n\t\t\t\t\t\tnew Editor(value, self.settings, self).render();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\n\t\t\t\tcase \"mceRemoveEditor\":\n\t\t\t\t\tif (editor) {\n\t\t\t\t\t\teditor.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\n\t\t\t\tcase 'mceToggleEditor':\n\t\t\t\t\tif (!editor) {\n\t\t\t\t\t\tself.execCommand('mceAddEditor', 0, value);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (editor.isHidden()) {\n\t\t\t\t\t\teditor.show();\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.hide();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Run command on active editor\n\t\t\tif (self.activeEditor) {\n\t\t\t\treturn self.activeEditor.execCommand(cmd, ui, value);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * Calls the save method on all editor instances in the collection. This can be useful when a form is to be submitted.\n\t\t *\n\t\t * @method triggerSave\n\t\t * @example\n\t\t * // Saves all contents\n\t\t * tinyMCE.triggerSave();\n\t\t */\n\t\ttriggerSave: function() {\n\t\t\teach(this.editors, function(editor) {\n\t\t\t\teditor.save();\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Adds a language pack, this gets called by the loaded language files like en.js.\n\t\t *\n\t\t * @method addI18n\n\t\t * @param {String} code Optional language code.\n\t\t * @param {Object} items Name/value object with translations.\n\t\t */\n\t\taddI18n: function(code, items) {\n\t\t\tI18n.add(code, items);\n\t\t},\n\n\t\t/**\n\t\t * Translates the specified string using the language pack items.\n\t\t *\n\t\t * @method translate\n\t\t * @param {String/Array/Object} text String to translate\n\t\t * @return {String} Translated string.\n\t\t */\n\t\ttranslate: function(text) {\n\t\t\treturn I18n.translate(text);\n\t\t},\n\n\t\t/**\n\t\t * Sets the active editor instance and fires the deactivate/activate events.\n\t\t *\n\t\t * @method setActive\n\t\t * @param {tinymce.Editor} editor Editor instance to set as the active instance.\n\t\t */\n\t\tsetActive: function(editor) {\n\t\t\tvar activeEditor = this.activeEditor;\n\n\t\t\tif (this.activeEditor != editor) {\n\t\t\t\tif (activeEditor) {\n\t\t\t\t\tactiveEditor.fire('deactivate', {relatedTarget: editor});\n\t\t\t\t}\n\n\t\t\t\teditor.fire('activate', {relatedTarget: activeEditor});\n\t\t\t}\n\n\t\t\tthis.activeEditor = editor;\n\t\t}\n\t};\n\n\textend(EditorManager, Observable);\n\n\tEditorManager.setup();\n\n\t// Export EditorManager as tinymce/tinymce in global namespace\n\twindow.tinymce = window.tinyMCE = EditorManager;\n\n\treturn EditorManager;\n});\n\n// Included from: js/tinymce/classes/LegacyInput.js\n\n/**\n * LegacyInput.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Converts legacy input to modern HTML.\n *\n * @class tinymce.LegacyInput\n * @private\n */\ndefine(\"tinymce/LegacyInput\", [\n\t\"tinymce/EditorManager\",\n\t\"tinymce/util/Tools\"\n], function(EditorManager, Tools) {\n\tvar each = Tools.each, explode = Tools.explode;\n\n\tEditorManager.on('AddEditor', function(e) {\n\t\tvar editor = e.editor;\n\n\t\teditor.on('preInit', function() {\n\t\t\tvar filters, fontSizes, dom, settings = editor.settings;\n\n\t\t\tfunction replaceWithSpan(node, styles) {\n\t\t\t\teach(styles, function(value, name) {\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tdom.setStyle(node, name, value);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tdom.rename(node, 'span');\n\t\t\t}\n\n\t\t\tfunction convert(e) {\n\t\t\t\tdom = editor.dom;\n\n\t\t\t\tif (settings.convert_fonts_to_spans) {\n\t\t\t\t\teach(dom.select('font,u,strike', e.node), function(node) {\n\t\t\t\t\t\tfilters[node.nodeName.toLowerCase()](dom, node);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (settings.inline_styles) {\n\t\t\t\tfontSizes = explode(settings.font_size_legacy_values);\n\n\t\t\t\tfilters = {\n\t\t\t\t\tfont: function(dom, node) {\n\t\t\t\t\t\treplaceWithSpan(node, {\n\t\t\t\t\t\t\tbackgroundColor: node.style.backgroundColor,\n\t\t\t\t\t\t\tcolor: node.color,\n\t\t\t\t\t\t\tfontFamily: node.face,\n\t\t\t\t\t\t\tfontSize: fontSizes[parseInt(node.size, 10) - 1]\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\n\t\t\t\t\tu: function(dom, node) {\n\t\t\t\t\t\t// HTML5 allows U element\n\t\t\t\t\t\tif (editor.settings.schema === \"html4\") {\n\t\t\t\t\t\t\treplaceWithSpan(node, {\n\t\t\t\t\t\t\t\ttextDecoration: 'underline'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tstrike: function(dom, node) {\n\t\t\t\t\t\treplaceWithSpan(node, {\n\t\t\t\t\t\t\ttextDecoration: 'line-through'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\teditor.on('PreProcess SetContent', convert);\n\t\t\t}\n\t\t});\n\t});\n});\n\n// Included from: js/tinymce/classes/util/XHR.js\n\n/**\n * XHR.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class enables you to send XMLHTTPRequests cross browser.\n * @class tinymce.util.XHR\n * @mixes tinymce.util.Observable\n * @static\n * @example\n * // Sends a low level Ajax request\n * tinymce.util.XHR.send({\n *    url: 'someurl',\n *    success: function(text) {\n *       console.debug(text);\n *    }\n * });\n *\n * // Add custom header to XHR request\n * tinymce.util.XHR.on('beforeSend', function(e) {\n *     e.xhr.setRequestHeader('X-Requested-With', 'Something');\n * });\n */\ndefine(\"tinymce/util/XHR\", [\n\t\"tinymce/util/Observable\",\n\t\"tinymce/util/Tools\"\n], function(Observable, Tools) {\n\tvar XHR = {\n\t\t/**\n\t\t * Sends a XMLHTTPRequest.\n\t\t * Consult the Wiki for details on what settings this method takes.\n\t\t *\n\t\t * @method send\n\t\t * @param {Object} settings Object will target URL, callbacks and other info needed to make the request.\n\t\t */\n\t\tsend: function(settings) {\n\t\t\tvar xhr, count = 0;\n\n\t\t\tfunction ready() {\n\t\t\t\tif (!settings.async || xhr.readyState == 4 || count++ > 10000) {\n\t\t\t\t\tif (settings.success && count < 10000 && xhr.status == 200) {\n\t\t\t\t\t\tsettings.success.call(settings.success_scope, '' + xhr.responseText, xhr, settings);\n\t\t\t\t\t} else if (settings.error) {\n\t\t\t\t\t\tsettings.error.call(settings.error_scope, count > 10000 ? 'TIMED_OUT' : 'GENERAL', xhr, settings);\n\t\t\t\t\t}\n\n\t\t\t\t\txhr = null;\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(ready, 10);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Default settings\n\t\t\tsettings.scope = settings.scope || this;\n\t\t\tsettings.success_scope = settings.success_scope || settings.scope;\n\t\t\tsettings.error_scope = settings.error_scope || settings.scope;\n\t\t\tsettings.async = settings.async === false ? false : true;\n\t\t\tsettings.data = settings.data || '';\n\n\t\t\tXHR.fire('beforeInitialize', {settings: settings});\n\n\t\t\txhr = new XMLHttpRequest();\n\n\t\t\tif (xhr) {\n\t\t\t\tif (xhr.overrideMimeType) {\n\t\t\t\t\txhr.overrideMimeType(settings.content_type);\n\t\t\t\t}\n\n\t\t\t\txhr.open(settings.type || (settings.data ? 'POST' : 'GET'), settings.url, settings.async);\n\n\t\t\t\tif (settings.crossDomain) {\n\t\t\t\t\txhr.withCredentials = true;\n\t\t\t\t}\n\n\t\t\t\tif (settings.content_type) {\n\t\t\t\t\txhr.setRequestHeader('Content-Type', settings.content_type);\n\t\t\t\t}\n\n\t\t\t\tif (settings.requestheaders) {\n\t\t\t\t\tTools.each(settings.requestheaders, function(header) {\n\t\t\t\t\t\txhr.setRequestHeader(header.key, header.value);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\txhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n\n\t\t\t\txhr = XHR.fire('beforeSend', {xhr: xhr, settings: settings}).xhr;\n\t\t\t\txhr.send(settings.data);\n\n\t\t\t\t// Syncronous request\n\t\t\t\tif (!settings.async) {\n\t\t\t\t\treturn ready();\n\t\t\t\t}\n\n\t\t\t\t// Wait for response, onReadyStateChange can not be used since it leaks memory in IE\n\t\t\t\tsetTimeout(ready, 10);\n\t\t\t}\n\t\t}\n\t};\n\n\tTools.extend(XHR, Observable);\n\n\treturn XHR;\n});\n\n// Included from: js/tinymce/classes/util/JSON.js\n\n/**\n * JSON.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * JSON parser and serializer class.\n *\n * @class tinymce.util.JSON\n * @static\n * @example\n * // JSON parse a string into an object\n * var obj = tinymce.util.JSON.parse(somestring);\n *\n * // JSON serialize a object into an string\n * var str = tinymce.util.JSON.serialize(obj);\n */\ndefine(\"tinymce/util/JSON\", [], function() {\n\tfunction serialize(o, quote) {\n\t\tvar i, v, t, name;\n\n\t\tquote = quote || '\"';\n\n\t\tif (o === null) {\n\t\t\treturn 'null';\n\t\t}\n\n\t\tt = typeof o;\n\n\t\tif (t == 'string') {\n\t\t\tv = '\\bb\\tt\\nn\\ff\\rr\\\"\"\\'\\'\\\\\\\\';\n\n\t\t\t/*eslint no-control-regex:0 */\n\t\t\treturn quote + o.replace(/([\\u0080-\\uFFFF\\x00-\\x1f\\\"\\'\\\\])/g, function(a, b) {\n\t\t\t\t// Make sure single quotes never get encoded inside double quotes for JSON compatibility\n\t\t\t\tif (quote === '\"' && a === \"'\") {\n\t\t\t\t\treturn a;\n\t\t\t\t}\n\n\t\t\t\ti = v.indexOf(b);\n\n\t\t\t\tif (i + 1) {\n\t\t\t\t\treturn '\\\\' + v.charAt(i + 1);\n\t\t\t\t}\n\n\t\t\t\ta = b.charCodeAt().toString(16);\n\n\t\t\t\treturn '\\\\u' + '0000'.substring(a.length) + a;\n\t\t\t}) + quote;\n\t\t}\n\n\t\tif (t == 'object') {\n\t\t\tif (o.hasOwnProperty && Object.prototype.toString.call(o) === '[object Array]') {\n\t\t\t\tfor (i = 0, v = '['; i < o.length; i++) {\n\t\t\t\t\tv += (i > 0 ? ',' : '') + serialize(o[i], quote);\n\t\t\t\t}\n\n\t\t\t\treturn v + ']';\n\t\t\t}\n\n\t\t\tv = '{';\n\n\t\t\tfor (name in o) {\n\t\t\t\tif (o.hasOwnProperty(name)) {\n\t\t\t\t\tv += typeof o[name] != 'function' ? (v.length > 1 ? ',' + quote : quote) + name +\n\t\t\t\t\t\tquote + ':' + serialize(o[name], quote) : '';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn v + '}';\n\t\t}\n\n\t\treturn '' + o;\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Serializes the specified object as a JSON string.\n\t\t *\n\t\t * @method serialize\n\t\t * @param {Object} obj Object to serialize as a JSON string.\n\t\t * @param {String} quote Optional quote string defaults to \".\n\t\t * @return {string} JSON string serialized from input.\n\t\t */\n\t\tserialize: serialize,\n\n\t\t/**\n\t\t * Unserializes/parses the specified JSON string into a object.\n\t\t *\n\t\t * @method parse\n\t\t * @param {string} s JSON String to parse into a JavaScript object.\n\t\t * @return {Object} Object from input JSON string or undefined if it failed.\n\t\t */\n\t\tparse: function(text) {\n\t\t\ttry {\n\t\t\t\t// Trick uglify JS\n\t\t\t\treturn window[String.fromCharCode(101) + 'val']('(' + text + ')');\n\t\t\t} catch (ex) {\n\t\t\t\t// Ignore\n\t\t\t}\n\t\t}\n\n\t\t/**#@-*/\n\t};\n});\n\n// Included from: js/tinymce/classes/util/JSONRequest.js\n\n/**\n * JSONRequest.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class enables you to use JSON-RPC to call backend methods.\n *\n * @class tinymce.util.JSONRequest\n * @example\n * var json = new tinymce.util.JSONRequest({\n *     url: 'somebackend.php'\n * });\n *\n * // Send RPC call 1\n * json.send({\n *     method: 'someMethod1',\n *     params: ['a', 'b'],\n *     success: function(result) {\n *         console.dir(result);\n *     }\n * });\n *\n * // Send RPC call 2\n * json.send({\n *     method: 'someMethod2',\n *     params: ['a', 'b'],\n *     success: function(result) {\n *         console.dir(result);\n *     }\n * });\n */\ndefine(\"tinymce/util/JSONRequest\", [\n\t\"tinymce/util/JSON\",\n\t\"tinymce/util/XHR\",\n\t\"tinymce/util/Tools\"\n], function(JSON, XHR, Tools) {\n\tvar extend = Tools.extend;\n\n\tfunction JSONRequest(settings) {\n\t\tthis.settings = extend({}, settings);\n\t\tthis.count = 0;\n\t}\n\n\t/**\n\t * Simple helper function to send a JSON-RPC request without the need to initialize an object.\n\t * Consult the Wiki API documentation for more details on what you can pass to this function.\n\t *\n\t * @method sendRPC\n\t * @static\n\t * @param {Object} o Call object where there are three field id, method and params this object should also contain callbacks etc.\n\t */\n\tJSONRequest.sendRPC = function(o) {\n\t\treturn new JSONRequest().send(o);\n\t};\n\n\tJSONRequest.prototype = {\n\t\t/**\n\t\t * Sends a JSON-RPC call. Consult the Wiki API documentation for more details on what you can pass to this function.\n\t\t *\n\t\t * @method send\n\t\t * @param {Object} args Call object where there are three field id, method and params this object should also contain callbacks etc.\n\t\t */\n\t\tsend: function(args) {\n\t\t\tvar ecb = args.error, scb = args.success;\n\n\t\t\targs = extend(this.settings, args);\n\n\t\t\targs.success = function(c, x) {\n\t\t\t\tc = JSON.parse(c);\n\n\t\t\t\tif (typeof c == 'undefined') {\n\t\t\t\t\tc = {\n\t\t\t\t\t\terror: 'JSON Parse error.'\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (c.error) {\n\t\t\t\t\tecb.call(args.error_scope || args.scope, c.error, x);\n\t\t\t\t} else {\n\t\t\t\t\tscb.call(args.success_scope || args.scope, c.result);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\targs.error = function(ty, x) {\n\t\t\t\tif (ecb) {\n\t\t\t\t\tecb.call(args.error_scope || args.scope, ty, x);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\targs.data = JSON.serialize({\n\t\t\t\tid: args.id || 'c' + (this.count++),\n\t\t\t\tmethod: args.method,\n\t\t\t\tparams: args.params\n\t\t\t});\n\n\t\t\t// JSON content type for Ruby on rails. Bug: #1883287\n\t\t\targs.content_type = 'application/json';\n\n\t\t\tXHR.send(args);\n\t\t}\n\t};\n\n\treturn JSONRequest;\n});\n\n// Included from: js/tinymce/classes/util/JSONP.js\n\n/**\n * JSONP.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\ndefine(\"tinymce/util/JSONP\", [\n\t\"tinymce/dom/DOMUtils\"\n], function(DOMUtils) {\n\treturn {\n\t\tcallbacks: {},\n\t\tcount: 0,\n\n\t\tsend: function(settings) {\n\t\t\tvar self = this, dom = DOMUtils.DOM, count = settings.count !== undefined ? settings.count : self.count;\n\t\t\tvar id = 'tinymce_jsonp_' + count;\n\n\t\t\tself.callbacks[count] = function(json) {\n\t\t\t\tdom.remove(id);\n\t\t\t\tdelete self.callbacks[count];\n\n\t\t\t\tsettings.callback(json);\n\t\t\t};\n\n\t\t\tdom.add(dom.doc.body, 'script', {\n\t\t\t\tid: id,\n\t\t\t\tsrc: settings.url,\n\t\t\t\ttype: 'text/javascript'\n\t\t\t});\n\n\t\t\tself.count++;\n\t\t}\n\t};\n});\n\n// Included from: js/tinymce/classes/util/LocalStorage.js\n\n/**\n * LocalStorage.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class will simulate LocalStorage on IE 7 and return the native version on modern browsers.\n * Storage is done using userData on IE 7 and a special serialization format. The format is designed\n * to be as small as possible by making sure that the keys and values doesn't need to be encoded. This\n * makes it possible to store for example HTML data.\n *\n * Storage format for userData:\n * <base 32 key length>,<key string>,<base 32 value length>,<value>,...\n *\n * For example this data key1=value1,key2=value2 would be:\n * 4,key1,6,value1,4,key2,6,value2\n *\n * @class tinymce.util.LocalStorage\n * @static\n * @version 4.0\n * @example\n * tinymce.util.LocalStorage.setItem('key', 'value');\n * var value = tinymce.util.LocalStorage.getItem('key');\n */\ndefine(\"tinymce/util/LocalStorage\", [], function() {\n\tvar LocalStorage, storageElm, items, keys, userDataKey, hasOldIEDataSupport;\n\n\t// Check for native support\n\ttry {\n\t\tif (window.localStorage) {\n\t\t\treturn localStorage;\n\t\t}\n\t} catch (ex) {\n\t\t// Ignore\n\t}\n\n\tuserDataKey = \"tinymce\";\n\tstorageElm = document.documentElement;\n\thasOldIEDataSupport = !!storageElm.addBehavior;\n\n\tif (hasOldIEDataSupport) {\n\t\tstorageElm.addBehavior('#default#userData');\n\t}\n\n\t/**\n\t * Gets the keys names and updates LocalStorage.length property. Since IE7 doesn't have any getters/setters.\n\t */\n\tfunction updateKeys() {\n\t\tkeys = [];\n\n\t\tfor (var key in items) {\n\t\t\tkeys.push(key);\n\t\t}\n\n\t\tLocalStorage.length = keys.length;\n\t}\n\n\t/**\n\t * Loads the userData string and parses it into the items structure.\n\t */\n\tfunction load() {\n\t\tvar key, data, value, pos = 0;\n\n\t\titems = {};\n\n\t\t// localStorage can be disabled on WebKit/Gecko so make a dummy storage\n\t\tif (!hasOldIEDataSupport) {\n\t\t\treturn;\n\t\t}\n\n\t\tfunction next(end) {\n\t\t\tvar value, nextPos;\n\n\t\t\tnextPos = end !== undefined ? pos + end : data.indexOf(',', pos);\n\t\t\tif (nextPos === -1 || nextPos > data.length) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tvalue = data.substring(pos, nextPos);\n\t\t\tpos = nextPos + 1;\n\n\t\t\treturn value;\n\t\t}\n\n\t\tstorageElm.load(userDataKey);\n\t\tdata = storageElm.getAttribute(userDataKey) || '';\n\n\t\tdo {\n\t\t\tvar offset = next();\n\t\t\tif (offset === null) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tkey = next(parseInt(offset, 32) || 0);\n\t\t\tif (key !== null) {\n\t\t\t\toffset = next();\n\t\t\t\tif (offset === null) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvalue = next(parseInt(offset, 32) || 0);\n\n\t\t\t\tif (key) {\n\t\t\t\t\titems[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t} while (key !== null);\n\n\t\tupdateKeys();\n\t}\n\n\t/**\n\t * Saves the items structure into a the userData format.\n\t */\n\tfunction save() {\n\t\tvar value, data = '';\n\n\t\t// localStorage can be disabled on WebKit/Gecko so make a dummy storage\n\t\tif (!hasOldIEDataSupport) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (var key in items) {\n\t\t\tvalue = items[key];\n\t\t\tdata += (data ? ',' : '') + key.length.toString(32) + ',' + key + ',' + value.length.toString(32) + ',' + value;\n\t\t}\n\n\t\tstorageElm.setAttribute(userDataKey, data);\n\n\t\ttry {\n\t\t\tstorageElm.save(userDataKey);\n\t\t} catch (ex) {\n\t\t\t// Ignore disk full\n\t\t}\n\n\t\tupdateKeys();\n\t}\n\n\tLocalStorage = {\n\t\t/**\n\t\t * Length of the number of items in storage.\n\t\t *\n\t\t * @property length\n\t\t * @type Number\n\t\t * @return {Number} Number of items in storage.\n\t\t */\n\t\t//length:0,\n\n\t\t/**\n\t\t * Returns the key name by index.\n\t\t *\n\t\t * @method key\n\t\t * @param {Number} index Index of key to return.\n\t\t * @return {String} Key value or null if it wasn't found.\n\t\t */\n\t\tkey: function(index) {\n\t\t\treturn keys[index];\n\t\t},\n\n\t\t/**\n\t\t * Returns the value if the specified key or null if it wasn't found.\n\t\t *\n\t\t * @method getItem\n\t\t * @param {String} key Key of item to retrieve.\n\t\t * @return {String} Value of the specified item or null if it wasn't found.\n\t\t */\n\t\tgetItem: function(key) {\n\t\t\treturn key in items ? items[key] : null;\n\t\t},\n\n\t\t/**\n\t\t * Sets the value of the specified item by it's key.\n\t\t *\n\t\t * @method setItem\n\t\t * @param {String} key Key of the item to set.\n\t\t * @param {String} value Value of the item to set.\n\t\t */\n\t\tsetItem: function(key, value) {\n\t\t\titems[key] = \"\" + value;\n\t\t\tsave();\n\t\t},\n\n\t\t/**\n\t\t * Removes the specified item by key.\n\t\t *\n\t\t * @method removeItem\n\t\t * @param {String} key Key of item to remove.\n\t\t */\n\t\tremoveItem: function(key) {\n\t\t\tdelete items[key];\n\t\t\tsave();\n\t\t},\n\n\t\t/**\n\t\t * Removes all items.\n\t\t *\n\t\t * @method clear\n\t\t */\n\t\tclear: function() {\n\t\t\titems = {};\n\t\t\tsave();\n\t\t}\n\t};\n\n\tload();\n\n\treturn LocalStorage;\n});\n\n// Included from: js/tinymce/classes/Compat.js\n\n/**\n * Compat.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * TinyMCE core class.\n *\n * @static\n * @class tinymce\n * @borrow-members tinymce.EditorManager\n * @borrow-members tinymce.util.Tools\n */\ndefine(\"tinymce/Compat\", [\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/dom/EventUtils\",\n\t\"tinymce/dom/ScriptLoader\",\n\t\"tinymce/AddOnManager\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/Env\"\n], function(DOMUtils, EventUtils, ScriptLoader, AddOnManager, Tools, Env) {\n\tvar tinymce = window.tinymce;\n\n\t/**\n\t * @property {tinymce.dom.DOMUtils} DOM Global DOM instance.\n\t * @property {tinymce.dom.ScriptLoader} ScriptLoader Global ScriptLoader instance.\n\t * @property {tinymce.AddOnManager} PluginManager Global PluginManager instance.\n\t * @property {tinymce.AddOnManager} ThemeManager Global ThemeManager instance.\n\t */\n\ttinymce.DOM = DOMUtils.DOM;\n\ttinymce.ScriptLoader = ScriptLoader.ScriptLoader;\n\ttinymce.PluginManager = AddOnManager.PluginManager;\n\ttinymce.ThemeManager = AddOnManager.ThemeManager;\n\n\ttinymce.dom = tinymce.dom || {};\n\ttinymce.dom.Event = EventUtils.Event;\n\n\tTools.each(Tools, function(func, key) {\n\t\ttinymce[key] = func;\n\t});\n\n\tTools.each('isOpera isWebKit isIE isGecko isMac'.split(' '), function(name) {\n\t\ttinymce[name] = Env[name.substr(2).toLowerCase()];\n\t});\n\n\treturn {};\n});\n\n// Describe the different namespaces\n\n/**\n * Root level namespace this contains classes directly related to the TinyMCE editor.\n *\n * @namespace tinymce\n */\n\n/**\n * Contains classes for handling the browsers DOM.\n *\n * @namespace tinymce.dom\n */\n\n/**\n * Contains html parser and serializer logic.\n *\n * @namespace tinymce.html\n */\n\n/**\n * Contains the different UI types such as buttons, listboxes etc.\n *\n * @namespace tinymce.ui\n */\n\n/**\n * Contains various utility classes such as json parser, cookies etc.\n *\n * @namespace tinymce.util\n */\n\n/**\n * Contains modules to handle data binding.\n *\n * @namespace tinymce.data\n */\n\n// Included from: js/tinymce/classes/ui/Layout.js\n\n/**\n * Layout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Base layout manager class.\n *\n * @class tinymce.ui.Layout\n */\ndefine(\"tinymce/ui/Layout\", [\n\t\"tinymce/util/Class\",\n\t\"tinymce/util/Tools\"\n], function(Class, Tools) {\n\t\"use strict\";\n\n\treturn Class.extend({\n\t\tDefaults: {\n\t\t\tfirstControlClass: 'first',\n\t\t\tlastControlClass: 'last'\n\t\t},\n\n\t\t/**\n\t\t * Constructs a layout instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tthis.settings = Tools.extend({}, this.Defaults, settings);\n\t\t},\n\n\t\t/**\n\t\t * This method gets invoked before the layout renders the controls.\n\t\t *\n\t\t * @method preRender\n\t\t * @param {tinymce.ui.Container} container Container instance to preRender.\n\t\t */\n\t\tpreRender: function(container) {\n\t\t\tcontainer.bodyClasses.add(this.settings.containerClass);\n\t\t},\n\n\t\t/**\n\t\t * Applies layout classes to the container.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tapplyClasses: function(items) {\n\t\t\tvar self = this, settings = self.settings, firstClass, lastClass, firstItem, lastItem;\n\n\t\t\tfirstClass = settings.firstControlClass;\n\t\t\tlastClass = settings.lastControlClass;\n\n\t\t\titems.each(function(item) {\n\t\t\t\titem.classes.remove(firstClass).remove(lastClass).add(settings.controlClass);\n\n\t\t\t\tif (item.visible()) {\n\t\t\t\t\tif (!firstItem) {\n\t\t\t\t\t\tfirstItem = item;\n\t\t\t\t\t}\n\n\t\t\t\t\tlastItem = item;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (firstItem) {\n\t\t\t\tfirstItem.classes.add(firstClass);\n\t\t\t}\n\n\t\t\tif (lastItem) {\n\t\t\t\tlastItem.classes.add(lastClass);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Renders the specified container and any layout specific HTML.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @param {tinymce.ui.Container} container Container to render HTML for.\n\t\t */\n\t\trenderHtml: function(container) {\n\t\t\tvar self = this, html = '';\n\n\t\t\tself.applyClasses(container.items());\n\n\t\t\tcontainer.items().each(function(item) {\n\t\t\t\thtml += item.renderHtml();\n\t\t\t});\n\n\t\t\treturn html;\n\t\t},\n\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function() {\n\t\t},\n\n\t\t/**\n\t\t * This method gets invoked after the layout renders the controls.\n\t\t *\n\t\t * @method postRender\n\t\t * @param {tinymce.ui.Container} container Container instance to postRender.\n\t\t */\n\t\tpostRender: function() {\n\t\t},\n\n\t\tisNative: function() {\n\t\t\treturn false;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/AbsoluteLayout.js\n\n/**\n * AbsoluteLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * LayoutManager for absolute positioning. This layout manager is more of\n * a base class for other layouts but can be created and used directly.\n *\n * @-x-less AbsoluteLayout.less\n * @class tinymce.ui.AbsoluteLayout\n * @extends tinymce.ui.Layout\n */\ndefine(\"tinymce/ui/AbsoluteLayout\", [\n\t\"tinymce/ui/Layout\"\n], function(Layout) {\n\t\"use strict\";\n\n\treturn Layout.extend({\n\t\tDefaults: {\n\t\t\tcontainerClass: 'abs-layout',\n\t\t\tcontrolClass: 'abs-layout-item'\n\t\t},\n\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function(container) {\n\t\t\tcontainer.items().filter(':visible').each(function(ctrl) {\n\t\t\t\tvar settings = ctrl.settings;\n\n\t\t\t\tctrl.layoutRect({\n\t\t\t\t\tx: settings.x,\n\t\t\t\t\ty: settings.y,\n\t\t\t\t\tw: settings.w,\n\t\t\t\t\th: settings.h\n\t\t\t\t});\n\n\t\t\t\tif (ctrl.recalc) {\n\t\t\t\t\tctrl.recalc();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Renders the specified container and any layout specific HTML.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @param {tinymce.ui.Container} container Container to render HTML for.\n\t\t */\n\t\trenderHtml: function(container) {\n\t\t\treturn '<div id=\"' + container._id + '-absend\" class=\"' + container.classPrefix + 'abs-end\"></div>' + this._super(container);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Button.js\n\n/**\n * Button.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is used to create buttons. You can create them directly or through the Factory.\n *\n * @example\n * // Create and render a button to the body element\n * tinymce.ui.Factory.create({\n *     type: 'button',\n *     text: 'My button'\n * }).renderTo(document.body);\n *\n * @-x-less Button.less\n * @class tinymce.ui.Button\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Button\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"widget btn\",\n\t\t\trole: \"button\"\n\t\t},\n\n\t\t/**\n\t\t * Constructs a new button instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} size Size of the button small|medium|large.\n\t\t * @setting {String} image Image to use for icon.\n\t\t * @setting {String} icon Icon to use for button.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, size;\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\n\t\t\tsize = self.settings.size;\n\n\t\t\tself.on('click mousedown', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\tself.on('touchstart', function(e) {\n\t\t\t\tself.fire('click', e);\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\tif (settings.subtype) {\n\t\t\t\tself.classes.add(settings.subtype);\n\t\t\t}\n\n\t\t\tif (size) {\n\t\t\t\tself.classes.add('btn-' + size);\n\t\t\t}\n\n\t\t\tif (settings.icon) {\n\t\t\t\tself.icon(settings.icon);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets the current button icon.\n\t\t *\n\t\t * @method icon\n\t\t * @param {String} [icon] New icon identifier.\n\t\t * @return {String|tinymce.ui.MenuButton} Current icon or current MenuButton instance.\n\t\t */\n\t\ticon: function(icon) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.state.get('icon');\n\t\t\t}\n\n\t\t\tthis.state.set('icon', icon);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Repaints the button for example after it's been resizes by a layout engine.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar btnElm = this.getEl().firstChild,\n\t\t\t\tbtnStyle;\n\n\t\t\tif (btnElm) {\n\t\t\t\tbtnStyle = btnElm.style;\n\t\t\t\tbtnStyle.width = btnStyle.height = \"100%\";\n\t\t\t}\n\n\t\t\tthis._super();\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\n\t\t\tvar icon = self.state.get('icon'), image, text = self.state.get('text'), textHtml = '';\n\n\t\t\timage = self.settings.image;\n\t\t\tif (image) {\n\t\t\t\ticon = 'none';\n\n\t\t\t\t// Support for [high dpi, low dpi] image sources\n\t\t\t\tif (typeof image != \"string\") {\n\t\t\t\t\timage = window.getSelection ? image[0] : image[1];\n\t\t\t\t}\n\n\t\t\t\timage = ' style=\"background-image: url(\\'' + image + '\\')\"';\n\t\t\t} else {\n\t\t\t\timage = '';\n\t\t\t}\n\n\t\t\tif (text) {\n\t\t\t\tself.classes.add('btn-has-text');\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\n\t\t\t}\n\n\t\t\ticon = self.settings.icon ? prefix + 'ico ' + prefix + 'i-' + icon : '';\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" tabindex=\"-1\" aria-labelledby=\"' + id + '\">' +\n\t\t\t\t\t'<button role=\"presentation\" type=\"button\" tabindex=\"-1\">' +\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\n\t\t\t\t\t\ttextHtml +\n\t\t\t\t\t'</button>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this, $ = self.$, textCls = self.classPrefix + 'txt';\n\n\t\t\tfunction setButtonText(text) {\n\t\t\t\tvar $span = $('span.' + textCls, self.getEl());\n\n\t\t\t\tif (text) {\n\t\t\t\t\tif (!$span[0]) {\n\t\t\t\t\t\t$('button:first', self.getEl()).append('<span class=\"' + textCls + '\"></span>');\n\t\t\t\t\t\t$span = $('span.' + textCls, self.getEl());\n\t\t\t\t\t}\n\n\t\t\t\t\t$span.html(self.encode(text));\n\t\t\t\t} else {\n\t\t\t\t\t$span.remove();\n\t\t\t\t}\n\n\t\t\t\tself.classes.toggle('btn-has-text', !!text);\n\t\t\t}\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tsetButtonText(e.value);\n\t\t\t});\n\n\t\t\tself.state.on('change:icon', function(e) {\n\t\t\t\tvar icon = e.value, prefix = self.classPrefix;\n\n\t\t\t\tself.settings.icon = icon;\n\t\t\t\ticon = icon ? prefix + 'ico ' + prefix + 'i-' + self.settings.icon : '';\n\n\t\t\t\tvar btnElm = self.getEl().firstChild, iconElm = btnElm.getElementsByTagName('i')[0];\n\n\t\t\t\tif (icon) {\n\t\t\t\t\tif (!iconElm || iconElm != btnElm.firstChild) {\n\t\t\t\t\t\ticonElm = document.createElement('i');\n\t\t\t\t\t\tbtnElm.insertBefore(iconElm, btnElm.firstChild);\n\t\t\t\t\t}\n\n\t\t\t\t\ticonElm.className = icon;\n\t\t\t\t} else if (iconElm) {\n\t\t\t\t\tbtnElm.removeChild(iconElm);\n\t\t\t\t}\n\n\t\t\t\tsetButtonText(self.state.get('text'));\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ButtonGroup.js\n\n/**\n * ButtonGroup.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This control enables you to put multiple buttons into a group. This is\n * useful when you want to combine similar toolbar buttons into a group.\n *\n * @example\n * // Create and render a buttongroup with two buttons to the body element\n * tinymce.ui.Factory.create({\n *     type: 'buttongroup',\n *     items: [\n *         {text: 'Button A'},\n *         {text: 'Button B'}\n *     ]\n * }).renderTo(document.body);\n *\n * @-x-less ButtonGroup.less\n * @class tinymce.ui.ButtonGroup\n * @extends tinymce.ui.Container\n */\ndefine(\"tinymce/ui/ButtonGroup\", [\n\t\"tinymce/ui/Container\"\n], function(Container) {\n\t\"use strict\";\n\n\treturn Container.extend({\n\t\tDefaults: {\n\t\t\tdefaultType: 'button',\n\t\t\trole: 'group'\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout;\n\n\t\t\tself.classes.add('btn-group');\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\">' +\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Checkbox.js\n\n/**\n * Checkbox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This control creates a custom checkbox.\n *\n * @example\n * // Create and render a checkbox to the body element\n * tinymce.ui.Factory.create({\n *     type: 'checkbox',\n *     checked: true,\n *     text: 'My checkbox'\n * }).renderTo(document.body);\n *\n * @-x-less Checkbox.less\n * @class tinymce.ui.Checkbox\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Checkbox\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"checkbox\",\n\t\t\trole: \"checkbox\",\n\t\t\tchecked: false\n\t\t},\n\n\t\t/**\n\t\t * Constructs a new Checkbox instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} checked True if the checkbox should be checked by default.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\n\t\t\tself.on('click mousedown', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tif (!self.disabled()) {\n\t\t\t\t\tself.checked(!self.checked());\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.checked(self.settings.checked);\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter function for the checked state.\n\t\t *\n\t\t * @method checked\n\t\t * @param {Boolean} [state] State to be set.\n\t\t * @return {Boolean|tinymce.ui.Checkbox} True/false or checkbox if it's a set operation.\n\t\t */\n\t\tchecked: function(state) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.state.get('checked');\n\t\t\t}\n\n\t\t\tthis.state.set('checked', state);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter function for the value state.\n\t\t *\n\t\t * @method value\n\t\t * @param {Boolean} [state] State to be set.\n\t\t * @return {Boolean|tinymce.ui.Checkbox} True/false or checkbox if it's a set operation.\n\t\t */\n\t\tvalue: function(state) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.checked();\n\t\t\t}\n\n\t\t\treturn this.checked(state);\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" unselectable=\"on\" aria-labelledby=\"' + id + '-al\" tabindex=\"-1\">' +\n\t\t\t\t\t'<i class=\"' + prefix + 'ico ' + prefix + 'i-checkbox\"></i>' +\n\t\t\t\t\t'<span id=\"' + id + '-al\" class=\"' + prefix + 'label\">' + self.encode(self.state.get('text')) + '</span>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tfunction checked(state) {\n\t\t\t\tself.classes.toggle(\"checked\", state);\n\t\t\t\tself.aria('checked', state);\n\t\t\t}\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tself.getEl('al').firstChild.data = self.translate(e.value);\n\t\t\t});\n\n\t\t\tself.state.on('change:checked change:value', function(e) {\n\t\t\t\tself.fire('change');\n\t\t\t\tchecked(e.value);\n\t\t\t});\n\n\t\t\tself.state.on('change:icon', function(e) {\n\t\t\t\tvar icon = e.value, prefix = self.classPrefix;\n\n\t\t\t\tif (typeof icon == 'undefined') {\n\t\t\t\t\treturn self.settings.icon;\n\t\t\t\t}\n\n\t\t\t\tself.settings.icon = icon;\n\t\t\t\ticon = icon ? prefix + 'ico ' + prefix + 'i-' + self.settings.icon : '';\n\n\t\t\t\tvar btnElm = self.getEl().firstChild, iconElm = btnElm.getElementsByTagName('i')[0];\n\n\t\t\t\tif (icon) {\n\t\t\t\t\tif (!iconElm || iconElm != btnElm.firstChild) {\n\t\t\t\t\t\ticonElm = document.createElement('i');\n\t\t\t\t\t\tbtnElm.insertBefore(iconElm, btnElm.firstChild);\n\t\t\t\t\t}\n\n\t\t\t\t\ticonElm.className = icon;\n\t\t\t\t} else if (iconElm) {\n\t\t\t\t\tbtnElm.removeChild(iconElm);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (self.state.get('checked')) {\n\t\t\t\tchecked(true);\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ComboBox.js\n\n/**\n * ComboBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a combobox control. Select box that you select a value from or\n * type a value into.\n *\n * @-x-less ComboBox.less\n * @class tinymce.ui.ComboBox\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/ComboBox\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/Factory\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/dom/DomQuery\"\n], function(Widget, Factory, DomUtils, $) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} placeholder Placeholder text to display.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\n\t\t\tself.classes.add('combobox');\n\t\t\tself.subinput = true;\n\t\t\tself.ariaTarget = 'inp'; // TODO: Figure out a better way\n\n\t\t\tsettings.menu = settings.menu || settings.values;\n\n\t\t\tif (settings.menu) {\n\t\t\t\tsettings.icon = 'caret';\n\t\t\t}\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tvar elm = e.target, root = self.getEl();\n\n\t\t\t\tif (!$.contains(root, elm) && elm != root) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twhile (elm && elm != root) {\n\t\t\t\t\tif (elm.id && elm.id.indexOf('-open') != -1) {\n\t\t\t\t\t\tself.fire('action');\n\n\t\t\t\t\t\tif (settings.menu) {\n\t\t\t\t\t\t\tself.showMenu();\n\n\t\t\t\t\t\t\tif (e.aria) {\n\t\t\t\t\t\t\t\tself.menu.items()[0].focus();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telm = elm.parentNode;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// TODO: Rework this\n\t\t\tself.on('keydown', function(e) {\n\t\t\t\tif (e.target.nodeName == \"INPUT\" && e.keyCode == 13) {\n\t\t\t\t\tself.parents().reverse().each(function(ctrl) {\n\t\t\t\t\t\tvar stateValue = self.state.get('value'), inputValue = self.getEl('inp').value;\n\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tself.state.set('value', inputValue);\n\n\t\t\t\t\t\tif (stateValue != inputValue) {\n\t\t\t\t\t\t\tself.fire('change');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (ctrl.hasEventListeners('submit') && ctrl.toJSON) {\n\t\t\t\t\t\t\tctrl.fire('submit', {data: ctrl.toJSON()});\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('keyup', function(e) {\n\t\t\t\tif (e.target.nodeName == \"INPUT\") {\n\t\t\t\t\tself.state.set('value', e.target.value);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tshowMenu: function() {\n\t\t\tvar self = this, settings = self.settings, menu;\n\n\t\t\tif (!self.menu) {\n\t\t\t\tmenu = settings.menu || [];\n\n\t\t\t\t// Is menu array then auto constuct menu control\n\t\t\t\tif (menu.length) {\n\t\t\t\t\tmenu = {\n\t\t\t\t\t\ttype: 'menu',\n\t\t\t\t\t\titems: menu\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tmenu.type = menu.type || 'menu';\n\t\t\t\t}\n\n\t\t\t\tself.menu = Factory.create(menu).parent(self).renderTo(self.getContainerElm());\n\t\t\t\tself.fire('createmenu');\n\t\t\t\tself.menu.reflow();\n\t\t\t\tself.menu.on('cancel', function(e) {\n\t\t\t\t\tif (e.control === self.menu) {\n\t\t\t\t\t\tself.focus();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.menu.on('show hide', function(e) {\n\t\t\t\t\te.control.items().each(function(ctrl) {\n\t\t\t\t\t\tctrl.active(ctrl.value() == self.value());\n\t\t\t\t\t});\n\t\t\t\t}).fire('show');\n\n\t\t\t\tself.menu.on('select', function(e) {\n\t\t\t\t\tself.value(e.control.value());\n\t\t\t\t});\n\n\t\t\t\tself.on('focusin', function(e) {\n\t\t\t\t\tif (e.target.tagName.toUpperCase() == 'INPUT') {\n\t\t\t\t\t\tself.menu.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.aria('expanded', true);\n\t\t\t}\n\n\t\t\tself.menu.show();\n\t\t\tself.menu.layoutRect({w: self.layoutRect().w});\n\t\t\tself.menu.moveRel(self.getEl(), self.isRtl() ? ['br-tr', 'tr-br'] : ['bl-tl', 'tl-bl']);\n\t\t},\n\n\t\t/**\n\t\t * Focuses the input area of the control.\n\t\t *\n\t\t * @method focus\n\t\t */\n\t\tfocus: function() {\n\t\t\tthis.getEl('inp').focus();\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, elm = self.getEl(), openElm = self.getEl('open'), rect = self.layoutRect();\n\t\t\tvar width, lineHeight;\n\n\t\t\tif (openElm) {\n\t\t\t\twidth = rect.w - DomUtils.getSize(openElm).width - 10;\n\t\t\t} else {\n\t\t\t\twidth = rect.w - 10;\n\t\t\t}\n\n\t\t\t// Detect old IE 7+8 add lineHeight to align caret vertically in the middle\n\t\t\tvar doc = document;\n\t\t\tif (doc.all && (!doc.documentMode || doc.documentMode <= 8)) {\n\t\t\t\tlineHeight = (self.layoutRect().h - 2) + 'px';\n\t\t\t}\n\n\t\t\t$(elm.firstChild).css({\n\t\t\t\twidth: width,\n\t\t\t\tlineHeight: lineHeight\n\t\t\t});\n\n\t\t\tself._super();\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Post render method. Called after the control has been rendered to the target.\n\t\t *\n\t\t * @method postRender\n\t\t * @return {tinymce.ui.ComboBox} Current combobox instance.\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\t$(this.getEl('inp')).on('change', function(e) {\n\t\t\t\tself.state.set('value', e.target.value);\n\t\t\t\tself.fire('change', e);\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, settings = self.settings, prefix = self.classPrefix;\n\t\t\tvar value = self.state.get('value') || '';\n\t\t\tvar icon, text, openBtnHtml = '', extraAttrs = '';\n\n\t\t\tif (\"spellcheck\" in settings) {\n\t\t\t\textraAttrs += ' spellcheck=\"' + settings.spellcheck + '\"';\n\t\t\t}\n\n\t\t\tif (settings.maxLength) {\n\t\t\t\textraAttrs += ' maxlength=\"' + settings.maxLength + '\"';\n\t\t\t}\n\n\t\t\tif (settings.size) {\n\t\t\t\textraAttrs += ' size=\"' + settings.size + '\"';\n\t\t\t}\n\n\t\t\tif (settings.subtype) {\n\t\t\t\textraAttrs += ' type=\"' + settings.subtype + '\"';\n\t\t\t}\n\n\t\t\tif (self.disabled()) {\n\t\t\t\textraAttrs += ' disabled=\"disabled\"';\n\t\t\t}\n\n\t\t\ticon = settings.icon;\n\t\t\tif (icon && icon != 'caret') {\n\t\t\t\ticon = prefix + 'ico ' + prefix + 'i-' + settings.icon;\n\t\t\t}\n\n\t\t\ttext = self.state.get('text');\n\n\t\t\tif (icon || text) {\n\t\t\t\topenBtnHtml = (\n\t\t\t\t\t'<div id=\"' + id + '-open\" class=\"' + prefix + 'btn ' + prefix + 'open\" tabIndex=\"-1\" role=\"button\">' +\n\t\t\t\t\t\t'<button id=\"' + id + '-action\" type=\"button\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t\t\t(icon != 'caret' ? '<i class=\"' + icon + '\"></i>' : '<i class=\"' + prefix + 'caret\"></i>') +\n\t\t\t\t\t\t\t(text ? (icon ? ' ' : '') + text : '') +\n\t\t\t\t\t\t'</button>' +\n\t\t\t\t\t'</div>'\n\t\t\t\t);\n\n\t\t\t\tself.classes.add('has-open');\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<input id=\"' + id + '-inp\" class=\"' + prefix + 'textbox\" value=\"' +\n\t\t\t\t\tself.encode(value, false) + '\" hidefocus=\"1\"' + extraAttrs + ' placeholder=\"' +\n\t\t\t\t\tself.encode(settings.placeholder) + '\" />' +\n\t\t\t\t\topenBtnHtml +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tvalue: function(value) {\n\t\t\tif (arguments.length) {\n\t\t\t\tthis.state.set('value', value);\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t// Make sure the real state is in sync\n\t\t\tif (this.state.get('rendered')) {\n\t\t\t\tthis.state.set('value', this.getEl('inp').value);\n\t\t\t}\n\n\t\t\treturn this.state.get('value');\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tif (self.getEl('inp').value != e.value) {\n\t\t\t\t\tself.getEl('inp').value = e.value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.state.on('change:disabled', function(e) {\n\t\t\t\tself.getEl('inp').disabled = e.value;\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tremove: function() {\n\t\t\t$(this.getEl('inp')).off();\n\t\t\tthis._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ColorBox.js\n\n/**\n * ColorBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This widget lets you enter colors and browse for colors by pressing the color button. It also displays\n * a preview of the current color.\n *\n * @-x-less ColorBox.less\n * @class tinymce.ui.ColorBox\n * @extends tinymce.ui.ComboBox\n */\ndefine(\"tinymce/ui/ColorBox\", [\n\t\"tinymce/ui/ComboBox\"\n], function(ComboBox) {\n\t\"use strict\";\n\n\treturn ComboBox.extend({\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tsettings.spellcheck = false;\n\n\t\t\tif (settings.onaction) {\n\t\t\t\tsettings.icon = 'none';\n\t\t\t}\n\n\t\t\tself._super(settings);\n\n\t\t\tself.classes.add('colorbox');\n\t\t\tself.on('change keyup postrender', function() {\n\t\t\t\tself.repaintColor(self.value());\n\t\t\t});\n\t\t},\n\n\t\trepaintColor: function(value) {\n\t\t\tvar elm = this.getEl().getElementsByTagName('i')[0];\n\n\t\t\tif (elm) {\n\t\t\t\ttry {\n\t\t\t\t\telm.style.background = value;\n\t\t\t\t} catch (ex) {\n\t\t\t\t\t// Ignore\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.repaintColor(e.value);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/PanelButton.js\n\n/**\n * PanelButton.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new panel button.\n *\n * @class tinymce.ui.PanelButton\n * @extends tinymce.ui.Button\n */\ndefine(\"tinymce/ui/PanelButton\", [\n\t\"tinymce/ui/Button\",\n\t\"tinymce/ui/FloatPanel\"\n], function(Button, FloatPanel) {\n\t\"use strict\";\n\n\treturn Button.extend({\n\t\t/**\n\t\t * Shows the panel for the button.\n\t\t *\n\t\t * @method showPanel\n\t\t */\n\t\tshowPanel: function() {\n\t\t\tvar self = this, settings = self.settings;\n\n\t\t\tself.active(true);\n\n\t\t\tif (!self.panel) {\n\t\t\t\tvar panelSettings = settings.panel;\n\n\t\t\t\t// Wrap panel in grid layout if type if specified\n\t\t\t\t// This makes it possible to add forms or other containers directly in the panel option\n\t\t\t\tif (panelSettings.type) {\n\t\t\t\t\tpanelSettings = {\n\t\t\t\t\t\tlayout: 'grid',\n\t\t\t\t\t\titems: panelSettings\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tpanelSettings.role = panelSettings.role || 'dialog';\n\t\t\t\tpanelSettings.popover = true;\n\t\t\t\tpanelSettings.autohide = true;\n\t\t\t\tpanelSettings.ariaRoot = true;\n\n\t\t\t\tself.panel = new FloatPanel(panelSettings).on('hide', function() {\n\t\t\t\t\tself.active(false);\n\t\t\t\t}).on('cancel', function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tself.focus();\n\t\t\t\t\tself.hidePanel();\n\t\t\t\t}).parent(self).renderTo(self.getContainerElm());\n\n\t\t\t\tself.panel.fire('show');\n\t\t\t\tself.panel.reflow();\n\t\t\t} else {\n\t\t\t\tself.panel.show();\n\t\t\t}\n\n\t\t\tself.panel.moveRel(self.getEl(), settings.popoverAlign || (self.isRtl() ? ['bc-tr', 'bc-tc'] : ['bc-tl', 'bc-tc']));\n\t\t},\n\n\t\t/**\n\t\t * Hides the panel for the button.\n\t\t *\n\t\t * @method hidePanel\n\t\t */\n\t\thidePanel: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self.panel) {\n\t\t\t\tself.panel.hide();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.aria('haspopup', true);\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tif (e.control === self) {\n\t\t\t\t\tif (self.panel && self.panel.visible()) {\n\t\t\t\t\t\tself.hidePanel();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.showPanel();\n\t\t\t\t\t\tself.panel.focus(!!e.aria);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tremove: function() {\n\t\t\tif (this.panel) {\n\t\t\t\tthis.panel.remove();\n\t\t\t\tthis.panel = null;\n\t\t\t}\n\n\t\t\treturn this._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ColorButton.js\n\n/**\n * ColorButton.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a color button control. This is a split button in which the main\n * button has a visual representation of the currently selected color. When clicked\n * the caret button displays a color picker, allowing the user to select a new color.\n *\n * @-x-less ColorButton.less\n * @class tinymce.ui.ColorButton\n * @extends tinymce.ui.PanelButton\n */\ndefine(\"tinymce/ui/ColorButton\", [\n\t\"tinymce/ui/PanelButton\",\n\t\"tinymce/dom/DOMUtils\"\n], function(PanelButton, DomUtils) {\n\t\"use strict\";\n\n\tvar DOM = DomUtils.DOM;\n\n\treturn PanelButton.extend({\n\t\t/**\n\t\t * Constructs a new ColorButton instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tthis._super(settings);\n\t\t\tthis.classes.add('colorbutton');\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter for the current color.\n\t\t *\n\t\t * @method color\n\t\t * @param {String} [color] Color to set.\n\t\t * @return {String|tinymce.ui.ColorButton} Current color or current instance.\n\t\t */\n\t\tcolor: function(color) {\n\t\t\tif (color) {\n\t\t\t\tthis._color = color;\n\t\t\t\tthis.getEl('preview').style.backgroundColor = color;\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\treturn this._color;\n\t\t},\n\n\t\t/**\n\t\t * Resets the current color.\n\t\t *\n\t\t * @method resetColor\n\t\t * @return {tinymce.ui.ColorButton} Current instance.\n\t\t */\n\t\tresetColor: function() {\n\t\t\tthis._color = null;\n\t\t\tthis.getEl('preview').style.backgroundColor = null;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix, text = self.state.get('text');\n\t\t\tvar icon = self.settings.icon ? prefix + 'ico ' + prefix + 'i-' + self.settings.icon : '';\n\t\t\tvar image = self.settings.image ? ' style=\"background-image: url(\\'' + self.settings.image + '\\')\"' : '',\n\t\t\t\ttextHtml = '';\n\n\t\t\tif (text) {\n\t\t\t\tself.classes.add('btn-has-text');\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" role=\"button\" tabindex=\"-1\" aria-haspopup=\"true\">' +\n\t\t\t\t\t'<button role=\"presentation\" hidefocus=\"1\" type=\"button\" tabindex=\"-1\">' +\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\n\t\t\t\t\t\t'<span id=\"' + id + '-preview\" class=\"' + prefix + 'preview\"></span>' +\n\t\t\t\t\t\ttextHtml +\n\t\t\t\t\t'</button>' +\n\t\t\t\t\t'<button type=\"button\" class=\"' + prefix + 'open\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t\t' <i class=\"' + prefix + 'caret\"></i>' +\n\t\t\t\t\t'</button>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, onClickHandler = self.settings.onclick;\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tif (e.aria && e.aria.key == 'down') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.control == self && !DOM.getParent(e.target, '.' + self.classPrefix + 'open')) {\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tonClickHandler.call(self, e);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdelete self.settings.onclick;\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/util/Color.js\n\n/**\n * Color.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class lets you parse/serialize colors and convert rgb/hsb.\n *\n * @class tinymce.util.Color\n * @example\n * var white = new tinymce.util.Color({r: 255, g: 255, b: 255});\n * var red = new tinymce.util.Color('#FF0000');\n *\n * console.log(white.toHex(), red.toHsv());\n */\ndefine(\"tinymce/util/Color\", [], function() {\n\tvar min = Math.min, max = Math.max, round = Math.round;\n\n\t/**\n\t * Constructs a new color instance.\n\t *\n\t * @constructor\n\t * @method Color\n\t * @param {String} value Optional initial value to parse.\n\t */\n\tfunction Color(value) {\n\t\tvar self = this, r = 0, g = 0, b = 0;\n\n\t\tfunction rgb2hsv(r, g, b) {\n\t\t\tvar h, s, v, d, minRGB, maxRGB;\n\n\t\t\th = 0;\n\t\t\ts = 0;\n\t\t\tv = 0;\n\t\t\tr = r / 255;\n\t\t\tg = g / 255;\n\t\t\tb = b / 255;\n\n\t\t\tminRGB = min(r, min(g, b));\n\t\t\tmaxRGB = max(r, max(g, b));\n\n\t\t\tif (minRGB == maxRGB) {\n\t\t\t\tv = minRGB;\n\n\t\t\t\treturn {\n\t\t\t\t\th: 0,\n\t\t\t\t\ts: 0,\n\t\t\t\t\tv: v * 100\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t/*eslint no-nested-ternary:0 */\n\t\t\td = (r == minRGB) ? g - b : ((b == minRGB) ? r - g : b - r);\n\t\t\th = (r == minRGB) ? 3 : ((b == minRGB) ? 1 : 5);\n\t\t\th = 60 * (h - d / (maxRGB - minRGB));\n\t\t\ts = (maxRGB - minRGB) / maxRGB;\n\t\t\tv = maxRGB;\n\n\t\t\treturn {\n\t\t\t\th: round(h),\n\t\t\t\ts: round(s * 100),\n\t\t\t\tv: round(v * 100)\n\t\t\t};\n\t\t}\n\n\t\tfunction hsvToRgb(hue, saturation, brightness) {\n\t\t\tvar side, chroma, x, match;\n\n\t\t\thue = (parseInt(hue, 10) || 0) % 360;\n\t\t\tsaturation = parseInt(saturation, 10) / 100;\n\t\t\tbrightness = parseInt(brightness, 10) / 100;\n\t\t\tsaturation = max(0, min(saturation, 1));\n\t\t\tbrightness = max(0, min(brightness, 1));\n\n\t\t\tif (saturation === 0) {\n\t\t\t\tr = g = b = round(255 * brightness);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tside = hue / 60;\n\t\t\tchroma = brightness * saturation;\n\t\t\tx = chroma * (1 - Math.abs(side % 2 - 1));\n\t\t\tmatch = brightness - chroma;\n\n\t\t\tswitch (Math.floor(side)) {\n\t\t\t\tcase 0:\n\t\t\t\t\tr = chroma;\n\t\t\t\t\tg = x;\n\t\t\t\t\tb = 0;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1:\n\t\t\t\t\tr = x;\n\t\t\t\t\tg = chroma;\n\t\t\t\t\tb = 0;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\t\t\t\t\tr = 0;\n\t\t\t\t\tg = chroma;\n\t\t\t\t\tb = x;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 3:\n\t\t\t\t\tr = 0;\n\t\t\t\t\tg = x;\n\t\t\t\t\tb = chroma;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 4:\n\t\t\t\t\tr = x;\n\t\t\t\t\tg = 0;\n\t\t\t\t\tb = chroma;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 5:\n\t\t\t\t\tr = chroma;\n\t\t\t\t\tg = 0;\n\t\t\t\t\tb = x;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tr = g = b = 0;\n\t\t\t}\n\n\t\t\tr = round(255 * (r + match));\n\t\t\tg = round(255 * (g + match));\n\t\t\tb = round(255 * (b + match));\n\t\t}\n\n\t\t/**\n\t\t * Returns the hex string of the current color. For example: #ff00ff\n\t\t *\n\t\t * @method toHex\n\t\t * @return {String} Hex string of current color.\n\t\t */\n\t\tfunction toHex() {\n\t\t\tfunction hex(val) {\n\t\t\t\tval = parseInt(val, 10).toString(16);\n\n\t\t\t\treturn val.length > 1 ? val : '0' + val;\n\t\t\t}\n\n\t\t\treturn '#' + hex(r) + hex(g) + hex(b);\n\t\t}\n\n\t\t/**\n\t\t * Returns the r, g, b values of the color. Each channel has a range from 0-255.\n\t\t *\n\t\t * @method toRgb\n\t\t * @return {Object} Object with r, g, b fields.\n\t\t */\n\t\tfunction toRgb() {\n\t\t\treturn {\n\t\t\t\tr: r,\n\t\t\t\tg: g,\n\t\t\t\tb: b\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Returns the h, s, v values of the color. Ranges: h=0-360, s=0-100, v=0-100.\n\t\t *\n\t\t * @method toHsv\n\t\t * @return {Object} Object with h, s, v fields.\n\t\t */\n\t\tfunction toHsv() {\n\t\t\treturn rgb2hsv(r, g, b);\n\t\t}\n\n\t\t/**\n\t\t * Parses the specified value and populates the color instance.\n\t\t *\n\t\t * Supported format examples:\n\t\t *  * rbg(255,0,0)\n\t\t *  * #ff0000\n\t\t *  * #fff\n\t\t *  * {r: 255, g: 0, b: 0}\n\t\t *  * {h: 360, s: 100, v: 100}\n\t\t *\n\t\t * @method parse\n\t\t * @param {Object/String} value Color value to parse.\n\t\t * @return {tinymce.util.Color} Current color instance.\n\t\t */\n\t\tfunction parse(value) {\n\t\t\tvar matches;\n\n\t\t\tif (typeof value == 'object') {\n\t\t\t\tif (\"r\" in value) {\n\t\t\t\t\tr = value.r;\n\t\t\t\t\tg = value.g;\n\t\t\t\t\tb = value.b;\n\t\t\t\t} else if (\"v\" in value) {\n\t\t\t\t\thsvToRgb(value.h, value.s, value.v);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ((matches = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)[^\\)]*\\)/gi.exec(value))) {\n\t\t\t\t\tr = parseInt(matches[1], 10);\n\t\t\t\t\tg = parseInt(matches[2], 10);\n\t\t\t\t\tb = parseInt(matches[3], 10);\n\t\t\t\t} else if ((matches = /#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value))) {\n\t\t\t\t\tr = parseInt(matches[1], 16);\n\t\t\t\t\tg = parseInt(matches[2], 16);\n\t\t\t\t\tb = parseInt(matches[3], 16);\n\t\t\t\t} else if ((matches = /#([0-F])([0-F])([0-F])/gi.exec(value))) {\n\t\t\t\t\tr = parseInt(matches[1] + matches[1], 16);\n\t\t\t\t\tg = parseInt(matches[2] + matches[2], 16);\n\t\t\t\t\tb = parseInt(matches[3] + matches[3], 16);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tr = r < 0 ? 0 : (r > 255 ? 255 : r);\n\t\t\tg = g < 0 ? 0 : (g > 255 ? 255 : g);\n\t\t\tb = b < 0 ? 0 : (b > 255 ? 255 : b);\n\n\t\t\treturn self;\n\t\t}\n\n\t\tif (value) {\n\t\t\tparse(value);\n\t\t}\n\n\t\tself.toRgb = toRgb;\n\t\tself.toHsv = toHsv;\n\t\tself.toHex = toHex;\n\t\tself.parse = parse;\n\t}\n\n\treturn Color;\n});\n\n// Included from: js/tinymce/classes/ui/ColorPicker.js\n\n/**\n * ColorPicker.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Color picker widget lets you select colors.\n *\n * @-x-less ColorPicker.less\n * @class tinymce.ui.ColorPicker\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/ColorPicker\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/DragHelper\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/util/Color\"\n], function(Widget, DragHelper, DomUtils, Color) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"widget colorpicker\"\n\t\t},\n\n\t\t/**\n\t\t * Constructs a new colorpicker instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} color Initial color value.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tthis._super(settings);\n\t\t},\n\n\t\tpostRender: function() {\n\t\t\tvar self = this, color = self.color(), hsv, hueRootElm, huePointElm, svRootElm, svPointElm;\n\n\t\t\thueRootElm = self.getEl('h');\n\t\t\thuePointElm = self.getEl('hp');\n\t\t\tsvRootElm = self.getEl('sv');\n\t\t\tsvPointElm = self.getEl('svp');\n\n\t\t\tfunction getPos(elm, event) {\n\t\t\t\tvar pos = DomUtils.getPos(elm), x, y;\n\n\t\t\t\tx = event.pageX - pos.x;\n\t\t\t\ty = event.pageY - pos.y;\n\n\t\t\t\tx = Math.max(0, Math.min(x / elm.clientWidth, 1));\n\t\t\t\ty = Math.max(0, Math.min(y / elm.clientHeight, 1));\n\n\t\t\t\treturn {\n\t\t\t\t\tx: x,\n\t\t\t\t\ty: y\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tfunction updateColor(hsv, hueUpdate) {\n\t\t\t\tvar hue = (360 - hsv.h) / 360;\n\n\t\t\t\tDomUtils.css(huePointElm, {\n\t\t\t\t\ttop: (hue * 100) + '%'\n\t\t\t\t});\n\n\t\t\t\tif (!hueUpdate) {\n\t\t\t\t\tDomUtils.css(svPointElm, {\n\t\t\t\t\t\tleft: hsv.s + '%',\n\t\t\t\t\t\ttop: (100 - hsv.v) + '%'\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tsvRootElm.style.background = new Color({s: 100, v: 100, h: hsv.h}).toHex();\n\t\t\t\tself.color().parse({s: hsv.s, v: hsv.v, h: hsv.h});\n\t\t\t}\n\n\t\t\tfunction updateSaturationAndValue(e) {\n\t\t\t\tvar pos;\n\n\t\t\t\tpos = getPos(svRootElm, e);\n\t\t\t\thsv.s = pos.x * 100;\n\t\t\t\thsv.v = (1 - pos.y) * 100;\n\n\t\t\t\tupdateColor(hsv);\n\t\t\t\tself.fire('change');\n\t\t\t}\n\n\t\t\tfunction updateHue(e) {\n\t\t\t\tvar pos;\n\n\t\t\t\tpos = getPos(hueRootElm, e);\n\t\t\t\thsv = color.toHsv();\n\t\t\t\thsv.h = (1 - pos.y) * 360;\n\t\t\t\tupdateColor(hsv, true);\n\t\t\t\tself.fire('change');\n\t\t\t}\n\n\t\t\tself._repaint = function() {\n\t\t\t\thsv = color.toHsv();\n\t\t\t\tupdateColor(hsv);\n\t\t\t};\n\n\t\t\tself._super();\n\n\t\t\tself._svdraghelper = new DragHelper(self._id + '-sv', {\n\t\t\t\tstart: updateSaturationAndValue,\n\t\t\t\tdrag: updateSaturationAndValue\n\t\t\t});\n\n\t\t\tself._hdraghelper = new DragHelper(self._id + '-h', {\n\t\t\t\tstart: updateHue,\n\t\t\t\tdrag: updateHue\n\t\t\t});\n\n\t\t\tself._repaint();\n\t\t},\n\n\t\trgb: function() {\n\t\t\treturn this.color().toRgb();\n\t\t},\n\n\t\tvalue: function(value) {\n\t\t\tvar self = this;\n\n\t\t\tif (arguments.length) {\n\t\t\t\tself.color().parse(value);\n\n\t\t\t\tif (self._rendered) {\n\t\t\t\t\tself._repaint();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn self.color().toHex();\n\t\t\t}\n\t\t},\n\n\t\tcolor: function() {\n\t\t\tif (!this._color) {\n\t\t\t\tthis._color = new Color();\n\t\t\t}\n\n\t\t\treturn this._color;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix, hueHtml;\n\t\t\tvar stops = '#ff0000,#ff0080,#ff00ff,#8000ff,#0000ff,#0080ff,#00ffff,#00ff80,#00ff00,#80ff00,#ffff00,#ff8000,#ff0000';\n\n\t\t\tfunction getOldIeFallbackHtml() {\n\t\t\t\tvar i, l, html = '', gradientPrefix, stopsList;\n\n\t\t\t\tgradientPrefix = 'filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=';\n\t\t\t\tstopsList = stops.split(',');\n\t\t\t\tfor (i = 0, l = stopsList.length - 1; i < l; i++) {\n\t\t\t\t\thtml += (\n\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-h-chunk\" style=\"' +\n\t\t\t\t\t\t\t'height:' + (100 / l) + '%;' +\n\t\t\t\t\t\t\tgradientPrefix + stopsList[i] + ',endColorstr=' + stopsList[i + 1] + ');' +\n\t\t\t\t\t\t\t'-ms-' + gradientPrefix + stopsList[i] + ',endColorstr=' + stopsList[i + 1] + ')' +\n\t\t\t\t\t\t'\"></div>'\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\treturn html;\n\t\t\t}\n\n\t\t\tvar gradientCssText = (\n\t\t\t\t'background: -ms-linear-gradient(top,' + stops + ');' +\n\t\t\t\t'background: linear-gradient(to bottom,' + stops + ');'\n\t\t\t);\n\n\t\t\thueHtml = (\n\t\t\t\t'<div id=\"' + id + '-h\" class=\"' + prefix + 'colorpicker-h\" style=\"' + gradientCssText + '\">' +\n\t\t\t\t\tgetOldIeFallbackHtml() +\n\t\t\t\t\t'<div id=\"' + id + '-hp\" class=\"' + prefix + 'colorpicker-h-marker\"></div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<div id=\"' + id + '-sv\" class=\"' + prefix + 'colorpicker-sv\">' +\n\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-overlay1\">' +\n\t\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-overlay2\">' +\n\t\t\t\t\t\t\t\t'<div id=\"' + id + '-svp\" class=\"' + prefix + 'colorpicker-selector1\">' +\n\t\t\t\t\t\t\t\t\t'<div class=\"' + prefix + 'colorpicker-selector2\"></div>' +\n\t\t\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\thueHtml +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Path.js\n\n/**\n * Path.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new path control.\n *\n * @-x-less Path.less\n * @class tinymce.ui.Path\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Path\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {String} delimiter Delimiter to display between row in path.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tif (!settings.delimiter) {\n\t\t\t\tsettings.delimiter = '\\u00BB';\n\t\t\t}\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('path');\n\t\t\tself.canFocus = true;\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tvar index, target = e.target;\n\n\t\t\t\tif ((index = target.getAttribute('data-index'))) {\n\t\t\t\t\tself.fire('select', {value: self.row()[index], index: index});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.row(self.settings.row);\n\t\t},\n\n\t\t/**\n\t\t * Focuses the current control.\n\t\t *\n\t\t * @method focus\n\t\t * @return {tinymce.ui.Control} Current control instance.\n\t\t */\n\t\tfocus: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.getEl().firstChild.focus();\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Sets/gets the data to be used for the path.\n\t\t *\n\t\t * @method row\n\t\t * @param {Array} row Array with row name is rendered to path.\n\t\t */\n\t\trow: function(row) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.state.get('row');\n\t\t\t}\n\n\t\t\tthis.state.set('row', row);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\tself._getDataPathHtml(self.state.get('row')) +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:row', function(e) {\n\t\t\t\tself.innerHtml(self._getDataPathHtml(e.value));\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t_getDataPathHtml: function(data) {\n\t\t\tvar self = this, parts = data || [], i, l, html = '', prefix = self.classPrefix;\n\n\t\t\tfor (i = 0, l = parts.length; i < l; i++) {\n\t\t\t\thtml += (\n\t\t\t\t\t(i > 0 ? '<div class=\"' + prefix + 'divider\" aria-hidden=\"true\"> ' + self.settings.delimiter + ' </div>' : '') +\n\t\t\t\t\t'<div role=\"button\" class=\"' + prefix + 'path-item' + (i == l - 1 ? ' ' + prefix + 'last' : '') + '\" data-index=\"' +\n\t\t\t\t\ti + '\" tabindex=\"-1\" id=\"' + self._id + '-' + i + '\" aria-level=\"' + i + '\">' + parts[i].name + '</div>'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!html) {\n\t\t\t\thtml = '<div class=\"' + prefix + 'path-item\">\\u00a0</div>';\n\t\t\t}\n\n\t\t\treturn html;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ElementPath.js\n\n/**\n * ElementPath.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This control creates an path for the current selections parent elements in TinyMCE.\n *\n * @class tinymce.ui.ElementPath\n * @extends tinymce.ui.Path\n */\ndefine(\"tinymce/ui/ElementPath\", [\n\t\"tinymce/ui/Path\"\n], function(Path) {\n\treturn Path.extend({\n\t\t/**\n\t\t * Post render method. Called after the control has been rendered to the target.\n\t\t *\n\t\t * @method postRender\n\t\t * @return {tinymce.ui.ElementPath} Current combobox instance.\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, editor = self.settings.editor;\n\n\t\t\tfunction isHidden(elm) {\n\t\t\t\tif (elm.nodeType === 1) {\n\t\t\t\t\tif (elm.nodeName == \"BR\" || !!elm.getAttribute('data-mce-bogus')) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (elm.getAttribute('data-mce-type') === 'bookmark') {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (editor.settings.elementpath !== false) {\n\t\t\t\tself.on('select', function(e) {\n\t\t\t\t\teditor.focus();\n\t\t\t\t\teditor.selection.select(this.row()[e.index].element);\n\t\t\t\t\teditor.nodeChanged();\n\t\t\t\t});\n\n\t\t\t\teditor.on('nodeChange', function(e) {\n\t\t\t\t\tvar outParents = [], parents = e.parents, i = parents.length;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (parents[i].nodeType == 1 && !isHidden(parents[i])) {\n\t\t\t\t\t\t\tvar args = editor.fire('ResolveName', {\n\t\t\t\t\t\t\t\tname: parents[i].nodeName.toLowerCase(),\n\t\t\t\t\t\t\t\ttarget: parents[i]\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (!args.isDefaultPrevented()) {\n\t\t\t\t\t\t\t\toutParents.push({name: args.name, element: parents[i]});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (args.isPropagationStopped()) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tself.row(outParents);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FormItem.js\n\n/**\n * FormItem.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class is a container created by the form element with\n * a label and control item.\n *\n * @class tinymce.ui.FormItem\n * @extends tinymce.ui.Container\n * @setting {String} label Label to display for the form item.\n */\ndefine(\"tinymce/ui/FormItem\", [\n\t\"tinymce/ui/Container\"\n], function(Container) {\n\t\"use strict\";\n\n\treturn Container.extend({\n\t\tDefaults: {\n\t\t\tlayout: 'flex',\n\t\t\talign: 'center',\n\t\t\tdefaults: {\n\t\t\t\tflex: 1\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, prefix = self.classPrefix;\n\n\t\t\tself.classes.add('formitem');\n\t\t\tlayout.preRender(self);\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t(self.settings.title ? ('<div id=\"' + self._id + '-title\" class=\"' + prefix + 'title\">' +\n\t\t\t\t\t\tself.settings.title + '</div>') : '') +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Form.js\n\n/**\n * Form.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a form container. A form container has the ability\n * to automatically wrap items in tinymce.ui.FormItem instances.\n *\n * Each FormItem instance is a container for the label and the item.\n *\n * @example\n * tinymce.ui.Factory.create({\n *     type: 'form',\n *     items: [\n *         {type: 'textbox', label: 'My text box'}\n *     ]\n * }).renderTo(document.body);\n *\n * @class tinymce.ui.Form\n * @extends tinymce.ui.Container\n */\ndefine(\"tinymce/ui/Form\", [\n\t\"tinymce/ui/Container\",\n\t\"tinymce/ui/FormItem\",\n\t\"tinymce/util/Tools\"\n], function(Container, FormItem, Tools) {\n\t\"use strict\";\n\n\treturn Container.extend({\n\t\tDefaults: {\n\t\t\tcontainerCls: 'form',\n\t\t\tlayout: 'flex',\n\t\t\tdirection: 'column',\n\t\t\talign: 'stretch',\n\t\t\tflex: 1,\n\t\t\tpadding: 20,\n\t\t\tlabelGap: 30,\n\t\t\tspacing: 10,\n\t\t\tcallbacks: {\n\t\t\t\tsubmit: function() {\n\t\t\t\t\tthis.submit();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * This method gets invoked before the control is rendered.\n\t\t *\n\t\t * @method preRender\n\t\t */\n\t\tpreRender: function() {\n\t\t\tvar self = this, items = self.items();\n\n\t\t\tif (!self.settings.formItemDefaults) {\n\t\t\t\tself.settings.formItemDefaults = {\n\t\t\t\t\tlayout: 'flex',\n\t\t\t\t\tautoResize: \"overflow\",\n\t\t\t\t\tdefaults: {flex: 1}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Wrap any labeled items in FormItems\n\t\t\titems.each(function(ctrl) {\n\t\t\t\tvar formItem, label = ctrl.settings.label;\n\n\t\t\t\tif (label) {\n\t\t\t\t\tformItem = new FormItem(Tools.extend({\n\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\ttype: 'label',\n\t\t\t\t\t\t\tid: ctrl._id + '-l',\n\t\t\t\t\t\t\ttext: label,\n\t\t\t\t\t\t\tflex: 0,\n\t\t\t\t\t\t\tforId: ctrl._id,\n\t\t\t\t\t\t\tdisabled: ctrl.disabled()\n\t\t\t\t\t\t}\n\t\t\t\t\t}, self.settings.formItemDefaults));\n\n\t\t\t\t\tformItem.type = 'formitem';\n\t\t\t\t\tctrl.aria('labelledby', ctrl._id + '-l');\n\n\t\t\t\t\tif (typeof ctrl.settings.flex == \"undefined\") {\n\t\t\t\t\t\tctrl.settings.flex = 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tself.replace(ctrl, formItem);\n\t\t\t\t\tformItem.add(ctrl);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Fires a submit event with the serialized form.\n\t\t *\n\t\t * @method submit\n\t\t * @return {Object} Event arguments object.\n\t\t */\n\t\tsubmit: function() {\n\t\t\treturn this.fire('submit', {data: this.toJSON()});\n\t\t},\n\n\t\t/**\n\t\t * Post render method. Called after the control has been rendered to the target.\n\t\t *\n\t\t * @method postRender\n\t\t * @return {tinymce.ui.ComboBox} Current combobox instance.\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself._super();\n\t\t\tself.fromJSON(self.settings.data);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself._super();\n\n\t\t\tfunction recalcLabels() {\n\t\t\t\tvar maxLabelWidth = 0, labels = [], i, labelGap, items;\n\n\t\t\t\tif (self.settings.labelGapCalc === false) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (self.settings.labelGapCalc == \"children\") {\n\t\t\t\t\titems = self.find('formitem');\n\t\t\t\t} else {\n\t\t\t\t\titems = self.items();\n\t\t\t\t}\n\n\t\t\t\titems.filter('formitem').each(function(item) {\n\t\t\t\t\tvar labelCtrl = item.items()[0], labelWidth = labelCtrl.getEl().clientWidth;\n\n\t\t\t\t\tmaxLabelWidth = labelWidth > maxLabelWidth ? labelWidth : maxLabelWidth;\n\t\t\t\t\tlabels.push(labelCtrl);\n\t\t\t\t});\n\n\t\t\t\tlabelGap = self.settings.labelGap || 0;\n\n\t\t\t\ti = labels.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tlabels[i].settings.minWidth = maxLabelWidth + labelGap;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.on('show', recalcLabels);\n\t\t\trecalcLabels();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FieldSet.js\n\n/**\n * FieldSet.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates fieldset containers.\n *\n * @-x-less FieldSet.less\n * @class tinymce.ui.FieldSet\n * @extends tinymce.ui.Form\n */\ndefine(\"tinymce/ui/FieldSet\", [\n\t\"tinymce/ui/Form\"\n], function(Form) {\n\t\"use strict\";\n\n\treturn Form.extend({\n\t\tDefaults: {\n\t\t\tcontainerCls: 'fieldset',\n\t\t\tlayout: 'flex',\n\t\t\tdirection: 'column',\n\t\t\talign: 'stretch',\n\t\t\tflex: 1,\n\t\t\tpadding: \"25 15 5 15\",\n\t\t\tlabelGap: 30,\n\t\t\tspacing: 10,\n\t\t\tborder: 1\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, prefix = self.classPrefix;\n\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\treturn (\n\t\t\t\t'<fieldset id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t(self.settings.title ? ('<legend id=\"' + self._id + '-title\" class=\"' + prefix + 'fieldset-title\">' +\n\t\t\t\t\t\tself.settings.title + '</legend>') : '') +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\t(self.settings.html || '') + layout.renderHtml(self) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</fieldset>'\n\t\t\t);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FilePicker.js\n\n/**\n * FilePicker.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*global tinymce:true */\n\n/**\n * This class creates a file picker control.\n *\n * @class tinymce.ui.FilePicker\n * @extends tinymce.ui.ComboBox\n */\ndefine(\"tinymce/ui/FilePicker\", [\n\t\"tinymce/ui/ComboBox\",\n\t\"tinymce/util/Tools\"\n], function(ComboBox, Tools) {\n\t\"use strict\";\n\n\treturn ComboBox.extend({\n\t\t/**\n\t\t * Constructs a new control instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, editor = tinymce.activeEditor, editorSettings = editor.settings;\n\t\t\tvar actionCallback, fileBrowserCallback, fileBrowserCallbackTypes;\n\n\t\t\tsettings.spellcheck = false;\n\n\t\t\tfileBrowserCallbackTypes = editorSettings.file_picker_types || editorSettings.file_browser_callback_types;\n\t\t\tif (fileBrowserCallbackTypes) {\n\t\t\t\tfileBrowserCallbackTypes = Tools.makeMap(fileBrowserCallbackTypes, /[, ]/);\n\t\t\t}\n\n\t\t\tif (!fileBrowserCallbackTypes || fileBrowserCallbackTypes[settings.filetype]) {\n\t\t\t\tfileBrowserCallback = editorSettings.file_picker_callback;\n\t\t\t\tif (fileBrowserCallback && (!fileBrowserCallbackTypes || fileBrowserCallbackTypes[settings.filetype])) {\n\t\t\t\t\tactionCallback = function() {\n\t\t\t\t\t\tvar meta = self.fire('beforecall').meta;\n\n\t\t\t\t\t\tmeta = Tools.extend({filetype: settings.filetype}, meta);\n\n\t\t\t\t\t\t// file_picker_callback(callback, currentValue, metaData)\n\t\t\t\t\t\tfileBrowserCallback.call(\n\t\t\t\t\t\t\teditor,\n\t\t\t\t\t\t\tfunction(value, meta) {\n\t\t\t\t\t\t\t\tself.value(value).fire('change', {meta: meta});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tself.value(),\n\t\t\t\t\t\t\tmeta\n\t\t\t\t\t\t);\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\t// Legacy callback: file_picker_callback(id, currentValue, filetype, window)\n\t\t\t\t\tfileBrowserCallback = editorSettings.file_browser_callback;\n\t\t\t\t\tif (fileBrowserCallback && (!fileBrowserCallbackTypes || fileBrowserCallbackTypes[settings.filetype])) {\n\t\t\t\t\t\tactionCallback = function() {\n\t\t\t\t\t\t\tfileBrowserCallback(\n\t\t\t\t\t\t\t\tself.getEl('inp').id,\n\t\t\t\t\t\t\t\tself.value(),\n\t\t\t\t\t\t\t\tsettings.filetype,\n\t\t\t\t\t\t\t\twindow\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (actionCallback) {\n\t\t\t\tsettings.icon = 'browse';\n\t\t\t\tsettings.onaction = actionCallback;\n\t\t\t}\n\n\t\t\tself._super(settings);\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FitLayout.js\n\n/**\n * FitLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This layout manager will resize the control to be the size of it's parent container.\n * In other words width: 100% and height: 100%.\n *\n * @-x-less FitLayout.less\n * @class tinymce.ui.FitLayout\n * @extends tinymce.ui.AbsoluteLayout\n */\ndefine(\"tinymce/ui/FitLayout\", [\n\t\"tinymce/ui/AbsoluteLayout\"\n], function(AbsoluteLayout) {\n\t\"use strict\";\n\n\treturn AbsoluteLayout.extend({\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function(container) {\n\t\t\tvar contLayoutRect = container.layoutRect(), paddingBox = container.paddingBox;\n\n\t\t\tcontainer.items().filter(':visible').each(function(ctrl) {\n\t\t\t\tctrl.layoutRect({\n\t\t\t\t\tx: paddingBox.left,\n\t\t\t\t\ty: paddingBox.top,\n\t\t\t\t\tw: contLayoutRect.innerW - paddingBox.right - paddingBox.left,\n\t\t\t\t\th: contLayoutRect.innerH - paddingBox.top - paddingBox.bottom\n\t\t\t\t});\n\n\t\t\t\tif (ctrl.recalc) {\n\t\t\t\t\tctrl.recalc();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FlexLayout.js\n\n/**\n * FlexLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This layout manager works similar to the CSS flex box.\n *\n * @setting {String} direction row|row-reverse|column|column-reverse\n * @setting {Number} flex A positive-number to flex by.\n * @setting {String} align start|end|center|stretch\n * @setting {String} pack start|end|justify\n *\n * @class tinymce.ui.FlexLayout\n * @extends tinymce.ui.AbsoluteLayout\n */\ndefine(\"tinymce/ui/FlexLayout\", [\n\t\"tinymce/ui/AbsoluteLayout\"\n], function(AbsoluteLayout) {\n\t\"use strict\";\n\n\treturn AbsoluteLayout.extend({\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function(container) {\n\t\t\t// A ton of variables, needs to be in the same scope for performance\n\t\t\tvar i, l, items, contLayoutRect, contPaddingBox, contSettings, align, pack, spacing, totalFlex, availableSpace, direction;\n\t\t\tvar ctrl, ctrlLayoutRect, ctrlSettings, flex, maxSizeItems = [], size, maxSize, ratio, rect, pos, maxAlignEndPos;\n\t\t\tvar sizeName, minSizeName, posName, maxSizeName, beforeName, innerSizeName, deltaSizeName, contentSizeName;\n\t\t\tvar alignAxisName, alignInnerSizeName, alignSizeName, alignMinSizeName, alignBeforeName, alignAfterName;\n\t\t\tvar alignDeltaSizeName, alignContentSizeName;\n\t\t\tvar max = Math.max, min = Math.min;\n\n\t\t\t// Get container items, properties and settings\n\t\t\titems = container.items().filter(':visible');\n\t\t\tcontLayoutRect = container.layoutRect();\n\t\t\tcontPaddingBox = container.paddingBox;\n\t\t\tcontSettings = container.settings;\n\t\t\tdirection = container.isRtl() ? (contSettings.direction || 'row-reversed') : contSettings.direction;\n\t\t\talign = contSettings.align;\n\t\t\tpack = container.isRtl() ? (contSettings.pack || 'end') : contSettings.pack;\n\t\t\tspacing = contSettings.spacing || 0;\n\n\t\t\tif (direction == \"row-reversed\" || direction == \"column-reverse\") {\n\t\t\t\titems = items.set(items.toArray().reverse());\n\t\t\t\tdirection = direction.split('-')[0];\n\t\t\t}\n\n\t\t\t// Setup axis variable name for row/column direction since the calculations is the same\n\t\t\tif (direction == \"column\") {\n\t\t\t\tposName = \"y\";\n\t\t\t\tsizeName = \"h\";\n\t\t\t\tminSizeName = \"minH\";\n\t\t\t\tmaxSizeName = \"maxH\";\n\t\t\t\tinnerSizeName = \"innerH\";\n\t\t\t\tbeforeName = 'top';\n\t\t\t\tdeltaSizeName = \"deltaH\";\n\t\t\t\tcontentSizeName = \"contentH\";\n\n\t\t\t\talignBeforeName = \"left\";\n\t\t\t\talignSizeName = \"w\";\n\t\t\t\talignAxisName = \"x\";\n\t\t\t\talignInnerSizeName = \"innerW\";\n\t\t\t\talignMinSizeName = \"minW\";\n\t\t\t\talignAfterName = \"right\";\n\t\t\t\talignDeltaSizeName = \"deltaW\";\n\t\t\t\talignContentSizeName = \"contentW\";\n\t\t\t} else {\n\t\t\t\tposName = \"x\";\n\t\t\t\tsizeName = \"w\";\n\t\t\t\tminSizeName = \"minW\";\n\t\t\t\tmaxSizeName = \"maxW\";\n\t\t\t\tinnerSizeName = \"innerW\";\n\t\t\t\tbeforeName = 'left';\n\t\t\t\tdeltaSizeName = \"deltaW\";\n\t\t\t\tcontentSizeName = \"contentW\";\n\n\t\t\t\talignBeforeName = \"top\";\n\t\t\t\talignSizeName = \"h\";\n\t\t\t\talignAxisName = \"y\";\n\t\t\t\talignInnerSizeName = \"innerH\";\n\t\t\t\talignMinSizeName = \"minH\";\n\t\t\t\talignAfterName = \"bottom\";\n\t\t\t\talignDeltaSizeName = \"deltaH\";\n\t\t\t\talignContentSizeName = \"contentH\";\n\t\t\t}\n\n\t\t\t// Figure out total flex, availableSpace and collect any max size elements\n\t\t\tavailableSpace = contLayoutRect[innerSizeName] - contPaddingBox[beforeName] - contPaddingBox[beforeName];\n\t\t\tmaxAlignEndPos = totalFlex = 0;\n\t\t\tfor (i = 0, l = items.length; i < l; i++) {\n\t\t\t\tctrl = items[i];\n\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\n\t\t\t\tctrlSettings = ctrl.settings;\n\t\t\t\tflex = ctrlSettings.flex;\n\t\t\t\tavailableSpace -= (i < l - 1 ? spacing : 0);\n\n\t\t\t\tif (flex > 0) {\n\t\t\t\t\ttotalFlex += flex;\n\n\t\t\t\t\t// Flexed item has a max size then we need to check if we will hit that size\n\t\t\t\t\tif (ctrlLayoutRect[maxSizeName]) {\n\t\t\t\t\t\tmaxSizeItems.push(ctrl);\n\t\t\t\t\t}\n\n\t\t\t\t\tctrlLayoutRect.flex = flex;\n\t\t\t\t}\n\n\t\t\t\tavailableSpace -= ctrlLayoutRect[minSizeName];\n\n\t\t\t\t// Calculate the align end position to be used to check for overflow/underflow\n\t\t\t\tsize = contPaddingBox[alignBeforeName] + ctrlLayoutRect[alignMinSizeName] + contPaddingBox[alignAfterName];\n\t\t\t\tif (size > maxAlignEndPos) {\n\t\t\t\t\tmaxAlignEndPos = size;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Calculate minW/minH\n\t\t\trect = {};\n\t\t\tif (availableSpace < 0) {\n\t\t\t\trect[minSizeName] = contLayoutRect[minSizeName] - availableSpace + contLayoutRect[deltaSizeName];\n\t\t\t} else {\n\t\t\t\trect[minSizeName] = contLayoutRect[innerSizeName] - availableSpace + contLayoutRect[deltaSizeName];\n\t\t\t}\n\n\t\t\trect[alignMinSizeName] = maxAlignEndPos + contLayoutRect[alignDeltaSizeName];\n\n\t\t\trect[contentSizeName] = contLayoutRect[innerSizeName] - availableSpace;\n\t\t\trect[alignContentSizeName] = maxAlignEndPos;\n\t\t\trect.minW = min(rect.minW, contLayoutRect.maxW);\n\t\t\trect.minH = min(rect.minH, contLayoutRect.maxH);\n\t\t\trect.minW = max(rect.minW, contLayoutRect.startMinWidth);\n\t\t\trect.minH = max(rect.minH, contLayoutRect.startMinHeight);\n\n\t\t\t// Resize container container if minSize was changed\n\t\t\tif (contLayoutRect.autoResize && (rect.minW != contLayoutRect.minW || rect.minH != contLayoutRect.minH)) {\n\t\t\t\trect.w = rect.minW;\n\t\t\t\trect.h = rect.minH;\n\n\t\t\t\tcontainer.layoutRect(rect);\n\t\t\t\tthis.recalc(container);\n\n\t\t\t\t// Forced recalc for example if items are hidden/shown\n\t\t\t\tif (container._lastRect === null) {\n\t\t\t\t\tvar parentCtrl = container.parent();\n\t\t\t\t\tif (parentCtrl) {\n\t\t\t\t\t\tparentCtrl._lastRect = null;\n\t\t\t\t\t\tparentCtrl.recalc();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Handle max size elements, check if they will become to wide with current options\n\t\t\tratio = availableSpace / totalFlex;\n\t\t\tfor (i = 0, l = maxSizeItems.length; i < l; i++) {\n\t\t\t\tctrl = maxSizeItems[i];\n\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\n\t\t\t\tmaxSize = ctrlLayoutRect[maxSizeName];\n\t\t\t\tsize = ctrlLayoutRect[minSizeName] + ctrlLayoutRect.flex * ratio;\n\n\t\t\t\tif (size > maxSize) {\n\t\t\t\t\tavailableSpace -= (ctrlLayoutRect[maxSizeName] - ctrlLayoutRect[minSizeName]);\n\t\t\t\t\ttotalFlex -= ctrlLayoutRect.flex;\n\t\t\t\t\tctrlLayoutRect.flex = 0;\n\t\t\t\t\tctrlLayoutRect.maxFlexSize = maxSize;\n\t\t\t\t} else {\n\t\t\t\t\tctrlLayoutRect.maxFlexSize = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Setup new ratio, target layout rect, start position\n\t\t\tratio = availableSpace / totalFlex;\n\t\t\tpos = contPaddingBox[beforeName];\n\t\t\trect = {};\n\n\t\t\t// Handle pack setting moves the start position to end, center\n\t\t\tif (totalFlex === 0) {\n\t\t\t\tif (pack == \"end\") {\n\t\t\t\t\tpos = availableSpace + contPaddingBox[beforeName];\n\t\t\t\t} else if (pack == \"center\") {\n\t\t\t\t\tpos = Math.round(\n\t\t\t\t\t\t(contLayoutRect[innerSizeName] / 2) - ((contLayoutRect[innerSizeName] - availableSpace) / 2)\n\t\t\t\t\t) + contPaddingBox[beforeName];\n\n\t\t\t\t\tif (pos < 0) {\n\t\t\t\t\t\tpos = contPaddingBox[beforeName];\n\t\t\t\t\t}\n\t\t\t\t} else if (pack == \"justify\") {\n\t\t\t\t\tpos = contPaddingBox[beforeName];\n\t\t\t\t\tspacing = Math.floor(availableSpace / (items.length - 1));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Default aligning (start) the other ones needs to be calculated while doing the layout\n\t\t\trect[alignAxisName] = contPaddingBox[alignBeforeName];\n\n\t\t\t// Start laying out controls\n\t\t\tfor (i = 0, l = items.length; i < l; i++) {\n\t\t\t\tctrl = items[i];\n\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\n\t\t\t\tsize = ctrlLayoutRect.maxFlexSize || ctrlLayoutRect[minSizeName];\n\n\t\t\t\t// Align the control on the other axis\n\t\t\t\tif (align === \"center\") {\n\t\t\t\t\trect[alignAxisName] = Math.round((contLayoutRect[alignInnerSizeName] / 2) - (ctrlLayoutRect[alignSizeName] / 2));\n\t\t\t\t} else if (align === \"stretch\") {\n\t\t\t\t\trect[alignSizeName] = max(\n\t\t\t\t\t\tctrlLayoutRect[alignMinSizeName] || 0,\n\t\t\t\t\t\tcontLayoutRect[alignInnerSizeName] - contPaddingBox[alignBeforeName] - contPaddingBox[alignAfterName]\n\t\t\t\t\t);\n\t\t\t\t\trect[alignAxisName] = contPaddingBox[alignBeforeName];\n\t\t\t\t} else if (align === \"end\") {\n\t\t\t\t\trect[alignAxisName] = contLayoutRect[alignInnerSizeName] - ctrlLayoutRect[alignSizeName] - contPaddingBox.top;\n\t\t\t\t}\n\n\t\t\t\t// Calculate new size based on flex\n\t\t\t\tif (ctrlLayoutRect.flex > 0) {\n\t\t\t\t\tsize += ctrlLayoutRect.flex * ratio;\n\t\t\t\t}\n\n\t\t\t\trect[sizeName] = size;\n\t\t\t\trect[posName] = pos;\n\t\t\t\tctrl.layoutRect(rect);\n\n\t\t\t\t// Recalculate containers\n\t\t\t\tif (ctrl.recalc) {\n\t\t\t\t\tctrl.recalc();\n\t\t\t\t}\n\n\t\t\t\t// Move x/y position\n\t\t\t\tpos += size + spacing;\n\t\t\t}\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FlowLayout.js\n\n/**\n * FlowLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This layout manager will place the controls by using the browsers native layout.\n *\n * @-x-less FlowLayout.less\n * @class tinymce.ui.FlowLayout\n * @extends tinymce.ui.Layout\n */\ndefine(\"tinymce/ui/FlowLayout\", [\n\t\"tinymce/ui/Layout\"\n], function(Layout) {\n\treturn Layout.extend({\n\t\tDefaults: {\n\t\t\tcontainerClass: 'flow-layout',\n\t\t\tcontrolClass: 'flow-layout-item',\n\t\t\tendClass: 'break'\n\t\t},\n\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function(container) {\n\t\t\tcontainer.items().filter(':visible').each(function(ctrl) {\n\t\t\t\tif (ctrl.recalc) {\n\t\t\t\t\tctrl.recalc();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tisNative: function() {\n\t\t\treturn true;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/FormatControls.js\n\n/**\n * FormatControls.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Internal class containing all TinyMCE specific control types such as\n * format listboxes, fontlist boxes, toolbar buttons etc.\n *\n * @class tinymce.ui.FormatControls\n */\ndefine(\"tinymce/ui/FormatControls\", [\n\t\"tinymce/ui/Control\",\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/FloatPanel\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/dom/DOMUtils\",\n\t\"tinymce/EditorManager\",\n\t\"tinymce/Env\"\n], function(Control, Widget, FloatPanel, Tools, DOMUtils, EditorManager, Env) {\n\tvar each = Tools.each;\n\n\tEditorManager.on('AddEditor', function(e) {\n\t\tvar editor = e.editor;\n\n\t\tsetupRtlMode(editor);\n\t\tregisterControls(editor);\n\t\tsetupContainer(editor);\n\t});\n\n\tControl.translate = function(text) {\n\t\treturn EditorManager.translate(text);\n\t};\n\n\tWidget.tooltips = !Env.iOS;\n\n\tfunction setupContainer(editor) {\n\t\tif (editor.settings.ui_container) {\n\t\t\tEnv.container = DOMUtils.DOM.select(editor.settings.ui_container)[0];\n\t\t}\n\t}\n\n\tfunction setupRtlMode(editor) {\n\t\teditor.on('ScriptsLoaded', function () {\n\t\t\tif (editor.rtl) {\n\t\t\t\tControl.rtl = true;\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction registerControls(editor) {\n\t\tvar formatMenu;\n\n\t\tfunction createListBoxChangeHandler(items, formatName) {\n\t\t\treturn function() {\n\t\t\t\tvar self = this;\n\n\t\t\t\teditor.on('nodeChange', function(e) {\n\t\t\t\t\tvar formatter = editor.formatter;\n\t\t\t\t\tvar value = null;\n\n\t\t\t\t\teach(e.parents, function(node) {\n\t\t\t\t\t\teach(items, function(item) {\n\t\t\t\t\t\t\tif (formatName) {\n\t\t\t\t\t\t\t\tif (formatter.matchNode(node, formatName, {value: item.value})) {\n\t\t\t\t\t\t\t\t\tvalue = item.value;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (formatter.matchNode(node, item.value)) {\n\t\t\t\t\t\t\t\t\tvalue = item.value;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tself.value(value);\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\tfunction createFormats(formats) {\n\t\t\tformats = formats.replace(/;$/, '').split(';');\n\n\t\t\tvar i = formats.length;\n\t\t\twhile (i--) {\n\t\t\t\tformats[i] = formats[i].split('=');\n\t\t\t}\n\n\t\t\treturn formats;\n\t\t}\n\n\t\tfunction createFormatMenu() {\n\t\t\tvar count = 0, newFormats = [];\n\n\t\t\tvar defaultStyleFormats = [\n\t\t\t\t{title: 'Headings', items: [\n\t\t\t\t\t{title: 'Heading 1', format: 'h1'},\n\t\t\t\t\t{title: 'Heading 2', format: 'h2'},\n\t\t\t\t\t{title: 'Heading 3', format: 'h3'},\n\t\t\t\t\t{title: 'Heading 4', format: 'h4'},\n\t\t\t\t\t{title: 'Heading 5', format: 'h5'},\n\t\t\t\t\t{title: 'Heading 6', format: 'h6'}\n\t\t\t\t]},\n\n\t\t\t\t{title: 'Inline', items: [\n\t\t\t\t\t{title: 'Bold', icon: 'bold', format: 'bold'},\n\t\t\t\t\t{title: 'Italic', icon: 'italic', format: 'italic'},\n\t\t\t\t\t{title: 'Underline', icon: 'underline', format: 'underline'},\n\t\t\t\t\t{title: 'Strikethrough', icon: 'strikethrough', format: 'strikethrough'},\n\t\t\t\t\t{title: 'Superscript', icon: 'superscript', format: 'superscript'},\n\t\t\t\t\t{title: 'Subscript', icon: 'subscript', format: 'subscript'},\n\t\t\t\t\t{title: 'Code', icon: 'code', format: 'code'}\n\t\t\t\t]},\n\n\t\t\t\t{title: 'Blocks', items: [\n\t\t\t\t\t{title: 'Paragraph', format: 'p'},\n\t\t\t\t\t{title: 'Blockquote', format: 'blockquote'},\n\t\t\t\t\t{title: 'Div', format: 'div'},\n\t\t\t\t\t{title: 'Pre', format: 'pre'}\n\t\t\t\t]},\n\n\t\t\t\t{title: 'Alignment', items: [\n\t\t\t\t\t{title: 'Left', icon: 'alignleft', format: 'alignleft'},\n\t\t\t\t\t{title: 'Center', icon: 'aligncenter', format: 'aligncenter'},\n\t\t\t\t\t{title: 'Right', icon: 'alignright', format: 'alignright'},\n\t\t\t\t\t{title: 'Justify', icon: 'alignjustify', format: 'alignjustify'}\n\t\t\t\t]}\n\t\t\t];\n\n\t\t\tfunction createMenu(formats) {\n\t\t\t\tvar menu = [];\n\n\t\t\t\tif (!formats) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\teach(formats, function(format) {\n\t\t\t\t\tvar menuItem = {\n\t\t\t\t\t\ttext: format.title,\n\t\t\t\t\t\ticon: format.icon\n\t\t\t\t\t};\n\n\t\t\t\t\tif (format.items) {\n\t\t\t\t\t\tmenuItem.menu = createMenu(format.items);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar formatName = format.format || \"custom\" + count++;\n\n\t\t\t\t\t\tif (!format.format) {\n\t\t\t\t\t\t\tformat.name = formatName;\n\t\t\t\t\t\t\tnewFormats.push(format);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmenuItem.format = formatName;\n\t\t\t\t\t\tmenuItem.cmd = format.cmd;\n\t\t\t\t\t}\n\n\t\t\t\t\tmenu.push(menuItem);\n\t\t\t\t});\n\n\t\t\t\treturn menu;\n\t\t\t}\n\n\t\t\tfunction createStylesMenu() {\n\t\t\t\tvar menu;\n\n\t\t\t\tif (editor.settings.style_formats_merge) {\n\t\t\t\t\tif (editor.settings.style_formats) {\n\t\t\t\t\t\tmenu = createMenu(defaultStyleFormats.concat(editor.settings.style_formats));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmenu = createMenu(defaultStyleFormats);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tmenu = createMenu(editor.settings.style_formats || defaultStyleFormats);\n\t\t\t\t}\n\n\t\t\t\treturn menu;\n\t\t\t}\n\n\t\t\teditor.on('init', function() {\n\t\t\t\teach(newFormats, function(format) {\n\t\t\t\t\teditor.formatter.register(format.name, format);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\ttype: 'menu',\n\t\t\t\titems: createStylesMenu(),\n\t\t\t\tonPostRender: function(e) {\n\t\t\t\t\teditor.fire('renderFormatsMenu', {control: e.control});\n\t\t\t\t},\n\t\t\t\titemDefaults: {\n\t\t\t\t\tpreview: true,\n\n\t\t\t\t\ttextStyle: function() {\n\t\t\t\t\t\tif (this.settings.format) {\n\t\t\t\t\t\t\treturn editor.formatter.getCssText(this.settings.format);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tonPostRender: function() {\n\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\tself.parent().on('show', function() {\n\t\t\t\t\t\t\tvar formatName, command;\n\n\t\t\t\t\t\t\tformatName = self.settings.format;\n\t\t\t\t\t\t\tif (formatName) {\n\t\t\t\t\t\t\t\tself.disabled(!editor.formatter.canApply(formatName));\n\t\t\t\t\t\t\t\tself.active(editor.formatter.match(formatName));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcommand = self.settings.cmd;\n\t\t\t\t\t\t\tif (command) {\n\t\t\t\t\t\t\t\tself.active(editor.queryCommandState(command));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\n\t\t\t\t\tonclick: function() {\n\t\t\t\t\t\tif (this.settings.format) {\n\t\t\t\t\t\t\ttoggleFormat(this.settings.format);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.settings.cmd) {\n\t\t\t\t\t\t\teditor.execCommand(this.settings.cmd);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tformatMenu = createFormatMenu();\n\n\t\tfunction initOnPostRender(name) {\n\t\t\treturn function() {\n\t\t\t\tvar self = this;\n\n\t\t\t\t// TODO: Fix this\n\t\t\t\tif (editor.formatter) {\n\t\t\t\t\teditor.formatter.formatChanged(name, function(state) {\n\t\t\t\t\t\tself.active(state);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\teditor.on('init', function() {\n\t\t\t\t\t\teditor.formatter.formatChanged(name, function(state) {\n\t\t\t\t\t\t\tself.active(state);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t// Simple format controls <control/format>:<UI text>\n\t\teach({\n\t\t\tbold: 'Bold',\n\t\t\titalic: 'Italic',\n\t\t\tunderline: 'Underline',\n\t\t\tstrikethrough: 'Strikethrough',\n\t\t\tsubscript: 'Subscript',\n\t\t\tsuperscript: 'Superscript'\n\t\t}, function(text, name) {\n\t\t\teditor.addButton(name, {\n\t\t\t\ttooltip: text,\n\t\t\t\tonPostRender: initOnPostRender(name),\n\t\t\t\tonclick: function() {\n\t\t\t\t\ttoggleFormat(name);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// Simple command controls <control>:[<UI text>,<Command>]\n\t\teach({\n\t\t\toutdent: ['Decrease indent', 'Outdent'],\n\t\t\tindent: ['Increase indent', 'Indent'],\n\t\t\tcut: ['Cut', 'Cut'],\n\t\t\tcopy: ['Copy', 'Copy'],\n\t\t\tpaste: ['Paste', 'Paste'],\n\t\t\thelp: ['Help', 'mceHelp'],\n\t\t\tselectall: ['Select all', 'SelectAll'],\n\t\t\tremoveformat: ['Clear formatting', 'RemoveFormat'],\n\t\t\tvisualaid: ['Visual aids', 'mceToggleVisualAid'],\n\t\t\tnewdocument: ['New document', 'mceNewDocument']\n\t\t}, function(item, name) {\n\t\t\teditor.addButton(name, {\n\t\t\t\ttooltip: item[0],\n\t\t\t\tcmd: item[1]\n\t\t\t});\n\t\t});\n\n\t\t// Simple command controls with format state\n\t\teach({\n\t\t\tblockquote: ['Blockquote', 'mceBlockQuote'],\n\t\t\tnumlist: ['Numbered list', 'InsertOrderedList'],\n\t\t\tbullist: ['Bullet list', 'InsertUnorderedList'],\n\t\t\tsubscript: ['Subscript', 'Subscript'],\n\t\t\tsuperscript: ['Superscript', 'Superscript'],\n\t\t\talignleft: ['Align left', 'JustifyLeft'],\n\t\t\taligncenter: ['Align center', 'JustifyCenter'],\n\t\t\talignright: ['Align right', 'JustifyRight'],\n\t\t\talignjustify: ['Justify', 'JustifyFull'],\n\t\t\talignnone: ['No alignment', 'JustifyNone']\n\t\t}, function(item, name) {\n\t\t\teditor.addButton(name, {\n\t\t\t\ttooltip: item[0],\n\t\t\t\tcmd: item[1],\n\t\t\t\tonPostRender: initOnPostRender(name)\n\t\t\t});\n\t\t});\n\n\t\tfunction toggleUndoRedoState(type) {\n\t\t\treturn function() {\n\t\t\t\tvar self = this;\n\n\t\t\t\ttype = type == 'redo' ? 'hasRedo' : 'hasUndo';\n\n\t\t\t\tfunction checkState() {\n\t\t\t\t\treturn editor.undoManager ? editor.undoManager[type]() : false;\n\t\t\t\t}\n\n\t\t\t\tself.disabled(!checkState());\n\t\t\t\teditor.on('Undo Redo AddUndo TypingUndo ClearUndos SwitchMode', function() {\n\t\t\t\t\tself.disabled(editor.readonly || !checkState());\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\tfunction toggleVisualAidState() {\n\t\t\tvar self = this;\n\n\t\t\teditor.on('VisualAid', function(e) {\n\t\t\t\tself.active(e.hasVisual);\n\t\t\t});\n\n\t\t\tself.active(editor.hasVisual);\n\t\t}\n\n\t\teditor.addButton('undo', {\n\t\t\ttooltip: 'Undo',\n\t\t\tonPostRender: toggleUndoRedoState('undo'),\n\t\t\tcmd: 'undo'\n\t\t});\n\n\t\teditor.addButton('redo', {\n\t\t\ttooltip: 'Redo',\n\t\t\tonPostRender: toggleUndoRedoState('redo'),\n\t\t\tcmd: 'redo'\n\t\t});\n\n\t\teditor.addMenuItem('newdocument', {\n\t\t\ttext: 'New document',\n\t\t\ticon: 'newdocument',\n\t\t\tcmd: 'mceNewDocument'\n\t\t});\n\n\t\teditor.addMenuItem('undo', {\n\t\t\ttext: 'Undo',\n\t\t\ticon: 'undo',\n\t\t\tshortcut: 'Meta+Z',\n\t\t\tonPostRender: toggleUndoRedoState('undo'),\n\t\t\tcmd: 'undo'\n\t\t});\n\n\t\teditor.addMenuItem('redo', {\n\t\t\ttext: 'Redo',\n\t\t\ticon: 'redo',\n\t\t\tshortcut: 'Meta+Y',\n\t\t\tonPostRender: toggleUndoRedoState('redo'),\n\t\t\tcmd: 'redo'\n\t\t});\n\n\t\teditor.addMenuItem('visualaid', {\n\t\t\ttext: 'Visual aids',\n\t\t\tselectable: true,\n\t\t\tonPostRender: toggleVisualAidState,\n\t\t\tcmd: 'mceToggleVisualAid'\n\t\t});\n\n\t\teditor.addButton('remove', {\n\t\t\ttooltip: 'Remove',\n\t\t\ticon: 'remove',\n\t\t\tcmd: 'Delete'\n\t\t});\n\n\t\teach({\n\t\t\tcut: ['Cut', 'Cut', 'Meta+X'],\n\t\t\tcopy: ['Copy', 'Copy', 'Meta+C'],\n\t\t\tpaste: ['Paste', 'Paste', 'Meta+V'],\n\t\t\tselectall: ['Select all', 'SelectAll', 'Meta+A'],\n\t\t\tbold: ['Bold', 'Bold', 'Meta+B'],\n\t\t\titalic: ['Italic', 'Italic', 'Meta+I'],\n\t\t\tunderline: ['Underline', 'Underline'],\n\t\t\tstrikethrough: ['Strikethrough', 'Strikethrough'],\n\t\t\tsubscript: ['Subscript', 'Subscript'],\n\t\t\tsuperscript: ['Superscript', 'Superscript'],\n\t\t\tremoveformat: ['Clear formatting', 'RemoveFormat']\n\t\t}, function(item, name) {\n\t\t\teditor.addMenuItem(name, {\n\t\t\t\ttext: item[0],\n\t\t\t\ticon: name,\n\t\t\t\tshortcut: item[2],\n\t\t\t\tcmd: item[1]\n\t\t\t});\n\t\t});\n\n\t\teditor.on('mousedown', function() {\n\t\t\tFloatPanel.hideAll();\n\t\t});\n\n\t\tfunction toggleFormat(fmt) {\n\t\t\tif (fmt.control) {\n\t\t\t\tfmt = fmt.control.value();\n\t\t\t}\n\n\t\t\tif (fmt) {\n\t\t\t\teditor.execCommand('mceToggleFormat', false, fmt);\n\t\t\t}\n\t\t}\n\n\t\teditor.addButton('styleselect', {\n\t\t\ttype: 'menubutton',\n\t\t\ttext: 'Formats',\n\t\t\tmenu: formatMenu\n\t\t});\n\n\t\teditor.addButton('formatselect', function() {\n\t\t\tvar items = [], blocks = createFormats(editor.settings.block_formats ||\n\t\t\t\t'Paragraph=p;' +\n\t\t\t\t'Heading 1=h1;' +\n\t\t\t\t'Heading 2=h2;' +\n\t\t\t\t'Heading 3=h3;' +\n\t\t\t\t'Heading 4=h4;' +\n\t\t\t\t'Heading 5=h5;' +\n\t\t\t\t'Heading 6=h6;' +\n\t\t\t\t'Preformatted=pre'\n\t\t\t);\n\n\t\t\teach(blocks, function(block) {\n\t\t\t\titems.push({\n\t\t\t\t\ttext: block[0],\n\t\t\t\t\tvalue: block[1],\n\t\t\t\t\ttextStyle: function() {\n\t\t\t\t\t\treturn editor.formatter.getCssText(block[1]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\ttype: 'listbox',\n\t\t\t\ttext: blocks[0][0],\n\t\t\t\tvalues: items,\n\t\t\t\tfixedWidth: true,\n\t\t\t\tonselect: toggleFormat,\n\t\t\t\tonPostRender: createListBoxChangeHandler(items)\n\t\t\t};\n\t\t});\n\n\t\teditor.addButton('fontselect', function() {\n\t\t\tvar defaultFontsFormats =\n\t\t\t\t'Andale Mono=andale mono,monospace;' +\n\t\t\t\t'Arial=arial,helvetica,sans-serif;' +\n\t\t\t\t'Arial Black=arial black,sans-serif;' +\n\t\t\t\t'Book Antiqua=book antiqua,palatino,serif;' +\n\t\t\t\t'Comic Sans MS=comic sans ms,sans-serif;' +\n\t\t\t\t'Courier New=courier new,courier,monospace;' +\n\t\t\t\t'Georgia=georgia,palatino,serif;' +\n\t\t\t\t'Helvetica=helvetica,arial,sans-serif;' +\n\t\t\t\t'Impact=impact,sans-serif;' +\n\t\t\t\t'Symbol=symbol;' +\n\t\t\t\t'Tahoma=tahoma,arial,helvetica,sans-serif;' +\n\t\t\t\t'Terminal=terminal,monaco,monospace;' +\n\t\t\t\t'Times New Roman=times new roman,times,serif;' +\n\t\t\t\t'Trebuchet MS=trebuchet ms,geneva,sans-serif;' +\n\t\t\t\t'Verdana=verdana,geneva,sans-serif;' +\n\t\t\t\t'Webdings=webdings;' +\n\t\t\t\t'Wingdings=wingdings,zapf dingbats';\n\n\t\t\tvar items = [], fonts = createFormats(editor.settings.font_formats || defaultFontsFormats);\n\n\t\t\teach(fonts, function(font) {\n\t\t\t\titems.push({\n\t\t\t\t\ttext: {raw: font[0]},\n\t\t\t\t\tvalue: font[1],\n\t\t\t\t\ttextStyle: font[1].indexOf('dings') == -1 ? 'font-family:' + font[1] : ''\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\ttype: 'listbox',\n\t\t\t\ttext: 'Font Family',\n\t\t\t\ttooltip: 'Font Family',\n\t\t\t\tvalues: items,\n\t\t\t\tfixedWidth: true,\n\t\t\t\tonPostRender: createListBoxChangeHandler(items, 'fontname'),\n\t\t\t\tonselect: function(e) {\n\t\t\t\t\tif (e.control.settings.value) {\n\t\t\t\t\t\teditor.execCommand('FontName', false, e.control.settings.value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\n\t\teditor.addButton('fontsizeselect', function() {\n\t\t\tvar items = [], defaultFontsizeFormats = '8pt 10pt 12pt 14pt 18pt 24pt 36pt';\n\t\t\tvar fontsize_formats = editor.settings.fontsize_formats || defaultFontsizeFormats;\n\n\t\t\teach(fontsize_formats.split(' '), function(item) {\n\t\t\t\tvar text = item, value = item;\n\t\t\t\t// Allow text=value font sizes.\n\t\t\t\tvar values = item.split('=');\n\t\t\t\tif (values.length > 1) {\n\t\t\t\t\ttext = values[0];\n\t\t\t\t\tvalue = values[1];\n\t\t\t\t}\n\t\t\t\titems.push({text: text, value: value});\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\ttype: 'listbox',\n\t\t\t\ttext: 'Font Sizes',\n\t\t\t\ttooltip: 'Font Sizes',\n\t\t\t\tvalues: items,\n\t\t\t\tfixedWidth: true,\n\t\t\t\tonPostRender: createListBoxChangeHandler(items, 'fontsize'),\n\t\t\t\tonclick: function(e) {\n\t\t\t\t\tif (e.control.settings.value) {\n\t\t\t\t\t\teditor.execCommand('FontSize', false, e.control.settings.value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\n\t\teditor.addMenuItem('formats', {\n\t\t\ttext: 'Formats',\n\t\t\tmenu: formatMenu\n\t\t});\n\t}\n});\n\n// Included from: js/tinymce/classes/ui/GridLayout.js\n\n/**\n * GridLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This layout manager places controls in a grid.\n *\n * @setting {Number} spacing Spacing between controls.\n * @setting {Number} spacingH Horizontal spacing between controls.\n * @setting {Number} spacingV Vertical spacing between controls.\n * @setting {Number} columns Number of columns to use.\n * @setting {String/Array} alignH start|end|center|stretch or array of values for each column.\n * @setting {String/Array} alignV start|end|center|stretch or array of values for each column.\n * @setting {String} pack start|end\n *\n * @class tinymce.ui.GridLayout\n * @extends tinymce.ui.AbsoluteLayout\n */\ndefine(\"tinymce/ui/GridLayout\", [\n\t\"tinymce/ui/AbsoluteLayout\"\n], function(AbsoluteLayout) {\n\t\"use strict\";\n\n\treturn AbsoluteLayout.extend({\n\t\t/**\n\t\t * Recalculates the positions of the controls in the specified container.\n\t\t *\n\t\t * @method recalc\n\t\t * @param {tinymce.ui.Container} container Container instance to recalc.\n\t\t */\n\t\trecalc: function(container) {\n\t\t\tvar settings, rows, cols, items, contLayoutRect, width, height, rect,\n\t\t\t\tctrlLayoutRect, ctrl, x, y, posX, posY, ctrlSettings, contPaddingBox, align, spacingH, spacingV, alignH, alignV, maxX, maxY,\n\t\t\t\tcolWidths = [], rowHeights = [], ctrlMinWidth, ctrlMinHeight, availableWidth, availableHeight, reverseRows, idx;\n\n\t\t\t// Get layout settings\n\t\t\tsettings = container.settings;\n\t\t\titems = container.items().filter(':visible');\n\t\t\tcontLayoutRect = container.layoutRect();\n\t\t\tcols = settings.columns || Math.ceil(Math.sqrt(items.length));\n\t\t\trows = Math.ceil(items.length / cols);\n\t\t\tspacingH = settings.spacingH || settings.spacing || 0;\n\t\t\tspacingV = settings.spacingV || settings.spacing || 0;\n\t\t\talignH = settings.alignH || settings.align;\n\t\t\talignV = settings.alignV || settings.align;\n\t\t\tcontPaddingBox = container.paddingBox;\n\t\t\treverseRows = 'reverseRows' in settings ? settings.reverseRows : container.isRtl();\n\n\t\t\tif (alignH && typeof alignH == \"string\") {\n\t\t\t\talignH = [alignH];\n\t\t\t}\n\n\t\t\tif (alignV && typeof alignV == \"string\") {\n\t\t\t\talignV = [alignV];\n\t\t\t}\n\n\t\t\t// Zero padd columnWidths\n\t\t\tfor (x = 0; x < cols; x++) {\n\t\t\t\tcolWidths.push(0);\n\t\t\t}\n\n\t\t\t// Zero padd rowHeights\n\t\t\tfor (y = 0; y < rows; y++) {\n\t\t\t\trowHeights.push(0);\n\t\t\t}\n\n\t\t\t// Calculate columnWidths and rowHeights\n\t\t\tfor (y = 0; y < rows; y++) {\n\t\t\t\tfor (x = 0; x < cols; x++) {\n\t\t\t\t\tctrl = items[y * cols + x];\n\n\t\t\t\t\t// Out of bounds\n\t\t\t\t\tif (!ctrl) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\n\t\t\t\t\tctrlMinWidth = ctrlLayoutRect.minW;\n\t\t\t\t\tctrlMinHeight = ctrlLayoutRect.minH;\n\n\t\t\t\t\tcolWidths[x] = ctrlMinWidth > colWidths[x] ? ctrlMinWidth : colWidths[x];\n\t\t\t\t\trowHeights[y] = ctrlMinHeight > rowHeights[y] ? ctrlMinHeight : rowHeights[y];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Calculate maxX\n\t\t\tavailableWidth = contLayoutRect.innerW - contPaddingBox.left - contPaddingBox.right;\n\t\t\tfor (maxX = 0, x = 0; x < cols; x++) {\n\t\t\t\tmaxX += colWidths[x] + (x > 0 ? spacingH : 0);\n\t\t\t\tavailableWidth -= (x > 0 ? spacingH : 0) + colWidths[x];\n\t\t\t}\n\n\t\t\t// Calculate maxY\n\t\t\tavailableHeight = contLayoutRect.innerH - contPaddingBox.top - contPaddingBox.bottom;\n\t\t\tfor (maxY = 0, y = 0; y < rows; y++) {\n\t\t\t\tmaxY += rowHeights[y] + (y > 0 ? spacingV : 0);\n\t\t\t\tavailableHeight -= (y > 0 ? spacingV : 0) + rowHeights[y];\n\t\t\t}\n\n\t\t\tmaxX += contPaddingBox.left + contPaddingBox.right;\n\t\t\tmaxY += contPaddingBox.top + contPaddingBox.bottom;\n\n\t\t\t// Calculate minW/minH\n\t\t\trect = {};\n\t\t\trect.minW = maxX + (contLayoutRect.w - contLayoutRect.innerW);\n\t\t\trect.minH = maxY + (contLayoutRect.h - contLayoutRect.innerH);\n\n\t\t\trect.contentW = rect.minW - contLayoutRect.deltaW;\n\t\t\trect.contentH = rect.minH - contLayoutRect.deltaH;\n\t\t\trect.minW = Math.min(rect.minW, contLayoutRect.maxW);\n\t\t\trect.minH = Math.min(rect.minH, contLayoutRect.maxH);\n\t\t\trect.minW = Math.max(rect.minW, contLayoutRect.startMinWidth);\n\t\t\trect.minH = Math.max(rect.minH, contLayoutRect.startMinHeight);\n\n\t\t\t// Resize container container if minSize was changed\n\t\t\tif (contLayoutRect.autoResize && (rect.minW != contLayoutRect.minW || rect.minH != contLayoutRect.minH)) {\n\t\t\t\trect.w = rect.minW;\n\t\t\t\trect.h = rect.minH;\n\n\t\t\t\tcontainer.layoutRect(rect);\n\t\t\t\tthis.recalc(container);\n\n\t\t\t\t// Forced recalc for example if items are hidden/shown\n\t\t\t\tif (container._lastRect === null) {\n\t\t\t\t\tvar parentCtrl = container.parent();\n\t\t\t\t\tif (parentCtrl) {\n\t\t\t\t\t\tparentCtrl._lastRect = null;\n\t\t\t\t\t\tparentCtrl.recalc();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Update contentW/contentH so absEnd moves correctly\n\t\t\tif (contLayoutRect.autoResize) {\n\t\t\t\trect = container.layoutRect(rect);\n\t\t\t\trect.contentW = rect.minW - contLayoutRect.deltaW;\n\t\t\t\trect.contentH = rect.minH - contLayoutRect.deltaH;\n\t\t\t}\n\n\t\t\tvar flexV;\n\n\t\t\tif (settings.packV == 'start') {\n\t\t\t\tflexV = 0;\n\t\t\t} else {\n\t\t\t\tflexV = availableHeight > 0 ? Math.floor(availableHeight / rows) : 0;\n\t\t\t}\n\n\t\t\t// Calculate totalFlex\n\t\t\tvar totalFlex = 0;\n\t\t\tvar flexWidths = settings.flexWidths;\n\t\t\tif (flexWidths) {\n\t\t\t\tfor (x = 0; x < flexWidths.length; x++) {\n\t\t\t\t\ttotalFlex += flexWidths[x];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttotalFlex = cols;\n\t\t\t}\n\n\t\t\t// Calculate new column widths based on flex values\n\t\t\tvar ratio = availableWidth / totalFlex;\n\t\t\tfor (x = 0; x < cols; x++) {\n\t\t\t\tcolWidths[x] += flexWidths ? flexWidths[x] * ratio : ratio;\n\t\t\t}\n\n\t\t\t// Move/resize controls\n\t\t\tposY = contPaddingBox.top;\n\t\t\tfor (y = 0; y < rows; y++) {\n\t\t\t\tposX = contPaddingBox.left;\n\t\t\t\theight = rowHeights[y] + flexV;\n\n\t\t\t\tfor (x = 0; x < cols; x++) {\n\t\t\t\t\tif (reverseRows) {\n\t\t\t\t\t\tidx = y * cols + cols - 1 - x;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tidx = y * cols + x;\n\t\t\t\t\t}\n\n\t\t\t\t\tctrl = items[idx];\n\n\t\t\t\t\t// No more controls to render then break\n\t\t\t\t\tif (!ctrl) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Get control settings and calculate x, y\n\t\t\t\t\tctrlSettings = ctrl.settings;\n\t\t\t\t\tctrlLayoutRect = ctrl.layoutRect();\n\t\t\t\t\twidth = Math.max(colWidths[x], ctrlLayoutRect.startMinWidth);\n\t\t\t\t\tctrlLayoutRect.x = posX;\n\t\t\t\t\tctrlLayoutRect.y = posY;\n\n\t\t\t\t\t// Align control horizontal\n\t\t\t\t\talign = ctrlSettings.alignH || (alignH ? (alignH[x] || alignH[0]) : null);\n\t\t\t\t\tif (align == \"center\") {\n\t\t\t\t\t\tctrlLayoutRect.x = posX + (width / 2) - (ctrlLayoutRect.w / 2);\n\t\t\t\t\t} else if (align == \"right\") {\n\t\t\t\t\t\tctrlLayoutRect.x = posX + width - ctrlLayoutRect.w;\n\t\t\t\t\t} else if (align == \"stretch\") {\n\t\t\t\t\t\tctrlLayoutRect.w = width;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Align control vertical\n\t\t\t\t\talign = ctrlSettings.alignV || (alignV ? (alignV[x] || alignV[0]) : null);\n\t\t\t\t\tif (align == \"center\") {\n\t\t\t\t\t\tctrlLayoutRect.y = posY + (height / 2) - (ctrlLayoutRect.h / 2);\n\t\t\t\t\t} else if (align == \"bottom\") {\n\t\t\t\t\t\tctrlLayoutRect.y = posY + height - ctrlLayoutRect.h;\n\t\t\t\t\t} else if (align == \"stretch\") {\n\t\t\t\t\t\tctrlLayoutRect.h = height;\n\t\t\t\t\t}\n\n\t\t\t\t\tctrl.layoutRect(ctrlLayoutRect);\n\n\t\t\t\t\tposX += width + spacingH;\n\n\t\t\t\t\tif (ctrl.recalc) {\n\t\t\t\t\t\tctrl.recalc();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tposY += height + spacingV;\n\t\t\t}\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Iframe.js\n\n/**\n * Iframe.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/*jshint scripturl:true */\n\n/**\n * This class creates an iframe.\n *\n * @setting {String} url Url to open in the iframe.\n *\n * @-x-less Iframe.less\n * @class tinymce.ui.Iframe\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Iframe\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/util/Delay\"\n], function(Widget, Delay) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.classes.add('iframe');\n\t\t\tself.canFocus = false;\n\n\t\t\t/*eslint no-script-url:0 */\n\t\t\treturn (\n\t\t\t\t'<iframe id=\"' + self._id + '\" class=\"' + self.classes + '\" tabindex=\"-1\" src=\"' +\n\t\t\t\t(self.settings.url || \"javascript:''\") + '\" frameborder=\"0\"></iframe>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Setter for the iframe source.\n\t\t *\n\t\t * @method src\n\t\t * @param {String} src Source URL for iframe.\n\t\t */\n\t\tsrc: function(src) {\n\t\t\tthis.getEl().src = src;\n\t\t},\n\n\t\t/**\n\t\t * Inner HTML for the iframe.\n\t\t *\n\t\t * @method html\n\t\t * @param {String} html HTML string to set as HTML inside the iframe.\n\t\t * @param {function} callback Optional callback to execute when the iframe body is filled with contents.\n\t\t * @return {tinymce.ui.Iframe} Current iframe control.\n\t\t */\n\t\thtml: function(html, callback) {\n\t\t\tvar self = this, body = this.getEl().contentWindow.document.body;\n\n\t\t\t// Wait for iframe to initialize IE 10 takes time\n\t\t\tif (!body) {\n\t\t\t\tDelay.setTimeout(function() {\n\t\t\t\t\tself.html(html);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tbody.innerHTML = html;\n\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/InfoBox.js\n\n/**\n * InfoBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2016 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * ....\n *\n * @-x-less InfoBox.less\n * @class tinymce.ui.InfoBox\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/InfoBox\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} multiline Multiline label.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('widget').add('infobox');\n\t\t\tself.canFocus = false;\n\t\t},\n\n\t\tseverity: function(level) {\n\t\t\tthis.classes.remove('error');\n\t\t\tthis.classes.remove('warning');\n\t\t\tthis.classes.remove('success');\n\t\t\tthis.classes.add(level);\n\t\t},\n\n\t\thelp: function(state) {\n\t\t\tthis.state.set('help', state);\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, prefix = self.classPrefix;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\">' +\n\t\t\t\t\t\tself.encode(self.state.get('text')) +\n\t\t\t\t\t\t'<button role=\"button\" tabindex=\"-1\">' +\n\t\t\t\t\t\t\t'<i class=\"' + prefix + 'ico ' + prefix + 'i-help\"></i>' +\n\t\t\t\t\t\t'</button>' +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tself.getEl('body').firstChild.data = self.encode(e.value);\n\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.updateLayoutRect();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.state.on('change:help', function(e) {\n\t\t\t\tself.classes.toggle('has-help', e.value);\n\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.updateLayoutRect();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Label.js\n\n/**\n * Label.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class creates a label element. A label is a simple text control\n * that can be bound to other controls.\n *\n * @-x-less Label.less\n * @class tinymce.ui.Label\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Label\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/DomUtils\"\n], function(Widget, DomUtils) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} multiline Multiline label.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('widget').add('label');\n\t\t\tself.canFocus = false;\n\n\t\t\tif (settings.multiline) {\n\t\t\t\tself.classes.add('autoscroll');\n\t\t\t}\n\n\t\t\tif (settings.strong) {\n\t\t\t\tself.classes.add('strong');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Initializes the current controls layout rect.\n\t\t * This will be executed by the layout managers to determine the\n\t\t * default minWidth/minHeight etc.\n\t\t *\n\t\t * @method initLayoutRect\n\t\t * @return {Object} Layout rect instance.\n\t\t */\n\t\tinitLayoutRect: function() {\n\t\t\tvar self = this, layoutRect = self._super();\n\n\t\t\tif (self.settings.multiline) {\n\t\t\t\tvar size = DomUtils.getSize(self.getEl());\n\n\t\t\t\t// Check if the text fits within maxW if not then try word wrapping it\n\t\t\t\tif (size.width > layoutRect.maxW) {\n\t\t\t\t\tlayoutRect.minW = layoutRect.maxW;\n\t\t\t\t\tself.classes.add('multiline');\n\t\t\t\t}\n\n\t\t\t\tself.getEl().style.width = layoutRect.minW + 'px';\n\t\t\t\tlayoutRect.startMinH = layoutRect.h = layoutRect.minH = Math.min(layoutRect.maxH, DomUtils.getSize(self.getEl()).height);\n\t\t\t}\n\n\t\t\treturn layoutRect;\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (!self.settings.multiline) {\n\t\t\t\tself.getEl().style.lineHeight = self.layoutRect().h + 'px';\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tseverity: function(level) {\n\t\t\tthis.classes.remove('error');\n\t\t\tthis.classes.remove('warning');\n\t\t\tthis.classes.remove('success');\n\t\t\tthis.classes.add(level);\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, targetCtrl, forName, forId = self.settings.forId;\n\n\t\t\tif (!forId && (forName = self.settings.forName)) {\n\t\t\t\ttargetCtrl = self.getRoot().find('#' + forName)[0];\n\n\t\t\t\tif (targetCtrl) {\n\t\t\t\t\tforId = targetCtrl._id;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (forId) {\n\t\t\t\treturn (\n\t\t\t\t\t'<label id=\"' + self._id + '\" class=\"' + self.classes + '\"' + (forId ? ' for=\"' + forId + '\"' : '') + '>' +\n\t\t\t\t\t\tself.encode(self.state.get('text')) +\n\t\t\t\t\t'</label>'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<span id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\tself.encode(self.state.get('text')) +\n\t\t\t\t'</span>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:text', function(e) {\n\t\t\t\tself.innerHtml(self.encode(e.value));\n\n\t\t\t\tif (self.state.get('rendered')) {\n\t\t\t\t\tself.updateLayoutRect();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Toolbar.js\n\n/**\n * Toolbar.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new toolbar.\n *\n * @class tinymce.ui.Toolbar\n * @extends tinymce.ui.Container\n */\ndefine(\"tinymce/ui/Toolbar\", [\n\t\"tinymce/ui/Container\"\n], function(Container) {\n\t\"use strict\";\n\n\treturn Container.extend({\n\t\tDefaults: {\n\t\t\trole: 'toolbar',\n\t\t\tlayout: 'flow'\n\t\t},\n\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('toolbar');\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.items().each(function(ctrl) {\n\t\t\t\tctrl.classes.add('toolbar-item');\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/MenuBar.js\n\n/**\n * MenuBar.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new menubar.\n *\n * @-x-less MenuBar.less\n * @class tinymce.ui.MenuBar\n * @extends tinymce.ui.Container\n */\ndefine(\"tinymce/ui/MenuBar\", [\n\t\"tinymce/ui/Toolbar\"\n], function(Toolbar) {\n\t\"use strict\";\n\n\treturn Toolbar.extend({\n\t\tDefaults: {\n\t\t\trole: 'menubar',\n\t\t\tcontainerCls: 'menubar',\n\t\t\tariaRoot: true,\n\t\t\tdefaults: {\n\t\t\t\ttype: 'menubutton'\n\t\t\t}\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/MenuButton.js\n\n/**\n * MenuButton.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new menu button.\n *\n * @-x-less MenuButton.less\n * @class tinymce.ui.MenuButton\n * @extends tinymce.ui.Button\n */\ndefine(\"tinymce/ui/MenuButton\", [\n\t\"tinymce/ui/Button\",\n\t\"tinymce/ui/Factory\",\n\t\"tinymce/ui/MenuBar\"\n], function(Button, Factory, MenuBar) {\n\t\"use strict\";\n\n\t// TODO: Maybe add as some global function\n\tfunction isChildOf(node, parent) {\n\t\twhile (node) {\n\t\t\tif (parent === node) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tnode = node.parentNode;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tvar MenuButton = Button.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._renderOpen = true;\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\n\t\t\tself.classes.add('menubtn');\n\n\t\t\tif (settings.fixedWidth) {\n\t\t\t\tself.classes.add('fixed-width');\n\t\t\t}\n\n\t\t\tself.aria('haspopup', true);\n\n\t\t\tself.state.set('menu', settings.menu || self.render());\n\t\t},\n\n\t\t/**\n\t\t * Shows the menu for the button.\n\t\t *\n\t\t * @method showMenu\n\t\t */\n\t\tshowMenu: function() {\n\t\t\tvar self = this, menu;\n\n\t\t\tif (self.menu && self.menu.visible()) {\n\t\t\t\treturn self.hideMenu();\n\t\t\t}\n\n\t\t\tif (!self.menu) {\n\t\t\t\tmenu = self.state.get('menu') || [];\n\n\t\t\t\t// Is menu array then auto constuct menu control\n\t\t\t\tif (menu.length) {\n\t\t\t\t\tmenu = {\n\t\t\t\t\t\ttype: 'menu',\n\t\t\t\t\t\titems: menu\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tmenu.type = menu.type || 'menu';\n\t\t\t\t}\n\n\t\t\t\tif (!menu.renderTo) {\n\t\t\t\t\tself.menu = Factory.create(menu).parent(self).renderTo();\n\t\t\t\t} else {\n\t\t\t\t\tself.menu = menu.parent(self).show().renderTo();\n\t\t\t\t}\n\n\t\t\t\tself.fire('createmenu');\n\t\t\t\tself.menu.reflow();\n\t\t\t\tself.menu.on('cancel', function(e) {\n\t\t\t\t\tif (e.control.parent() === self.menu) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tself.focus();\n\t\t\t\t\t\tself.hideMenu();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Move focus to button when a menu item is selected/clicked\n\t\t\t\tself.menu.on('select', function() {\n\t\t\t\t\tself.focus();\n\t\t\t\t});\n\n\t\t\t\tself.menu.on('show hide', function(e) {\n\t\t\t\t\tif (e.control == self.menu) {\n\t\t\t\t\t\tself.activeMenu(e.type == 'show');\n\t\t\t\t\t}\n\n\t\t\t\t\tself.aria('expanded', e.type == 'show');\n\t\t\t\t}).fire('show');\n\t\t\t}\n\n\t\t\tself.menu.show();\n\t\t\tself.menu.layoutRect({w: self.layoutRect().w});\n\t\t\tself.menu.moveRel(self.getEl(), self.isRtl() ? ['br-tr', 'tr-br'] : ['bl-tl', 'tl-bl']);\n\t\t},\n\n\t\t/**\n\t\t * Hides the menu for the button.\n\t\t *\n\t\t * @method hideMenu\n\t\t */\n\t\thideMenu: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self.menu) {\n\t\t\t\tself.menu.items().each(function(item) {\n\t\t\t\t\tif (item.hideMenu) {\n\t\t\t\t\t\titem.hideMenu();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.menu.hide();\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets the active menu state.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tactiveMenu: function(state) {\n\t\t\tthis.classes.toggle('active', state);\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\n\t\t\tvar icon = self.settings.icon, image, text = self.state.get('text'),\n\t\t\t\ttextHtml = '';\n\n\t\t\timage = self.settings.image;\n\t\t\tif (image) {\n\t\t\t\ticon = 'none';\n\n\t\t\t\t// Support for [high dpi, low dpi] image sources\n\t\t\t\tif (typeof image != \"string\") {\n\t\t\t\t\timage = window.getSelection ? image[0] : image[1];\n\t\t\t\t}\n\n\t\t\t\timage = ' style=\"background-image: url(\\'' + image + '\\')\"';\n\t\t\t} else {\n\t\t\t\timage = '';\n\t\t\t}\n\n\t\t\tif (text) {\n\t\t\t\tself.classes.add('btn-has-text');\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\n\t\t\t}\n\n\t\t\ticon = self.settings.icon ? prefix + 'ico ' + prefix + 'i-' + icon : '';\n\n\t\t\tself.aria('role', self.parent() instanceof MenuBar ? 'menuitem' : 'button');\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" tabindex=\"-1\" aria-labelledby=\"' + id + '\">' +\n\t\t\t\t\t'<button id=\"' + id + '-open\" role=\"presentation\" type=\"button\" tabindex=\"-1\">' +\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\n\t\t\t\t\t\ttextHtml +\n\t\t\t\t\t\t' <i class=\"' + prefix + 'caret\"></i>' +\n\t\t\t\t\t'</button>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Gets invoked after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tif (e.control === self && isChildOf(e.target, self.getEl())) {\n\t\t\t\t\tself.showMenu();\n\n\t\t\t\t\tif (e.aria) {\n\t\t\t\t\t\tself.menu.items()[0].focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.on('mouseenter', function(e) {\n\t\t\t\tvar overCtrl = e.control, parent = self.parent(), hasVisibleSiblingMenu;\n\n\t\t\t\tif (overCtrl && parent && overCtrl instanceof MenuButton && overCtrl.parent() == parent) {\n\t\t\t\t\tparent.items().filter('MenuButton').each(function(ctrl) {\n\t\t\t\t\t\tif (ctrl.hideMenu && ctrl != overCtrl) {\n\t\t\t\t\t\t\tif (ctrl.menu && ctrl.menu.visible()) {\n\t\t\t\t\t\t\t\thasVisibleSiblingMenu = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tctrl.hideMenu();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (hasVisibleSiblingMenu) {\n\t\t\t\t\t\toverCtrl.focus(); // Fix for: #5887\n\t\t\t\t\t\toverCtrl.showMenu();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:menu', function() {\n\t\t\t\tif (self.menu) {\n\t\t\t\t\tself.menu.remove();\n\t\t\t\t}\n\n\t\t\t\tself.menu = null;\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t/**\n\t\t * Removes the control and it's menus.\n\t\t *\n\t\t * @method remove\n\t\t */\n\t\tremove: function() {\n\t\t\tthis._super();\n\n\t\t\tif (this.menu) {\n\t\t\t\tthis.menu.remove();\n\t\t\t}\n\t\t}\n\t});\n\n\treturn MenuButton;\n});\n\n// Included from: js/tinymce/classes/ui/MenuItem.js\n\n/**\n * MenuItem.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new menu item.\n *\n * @-x-less MenuItem.less\n * @class tinymce.ui.MenuItem\n * @extends tinymce.ui.Control\n */\ndefine(\"tinymce/ui/MenuItem\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/Factory\",\n\t\"tinymce/Env\",\n\t\"tinymce/util/Delay\"\n], function(Widget, Factory, Env, Delay) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tborder: 0,\n\t\t\trole: 'menuitem'\n\t\t},\n\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} selectable Selectable menu.\n\t\t * @setting {Array} menu Submenu array with items.\n\t\t * @setting {String} shortcut Shortcut to display for menu item. Example: Ctrl+X\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, text;\n\n\t\t\tself._super(settings);\n\n\t\t\tsettings = self.settings;\n\n\t\t\tself.classes.add('menu-item');\n\n\t\t\tif (settings.menu) {\n\t\t\t\tself.classes.add('menu-item-expand');\n\t\t\t}\n\n\t\t\tif (settings.preview) {\n\t\t\t\tself.classes.add('menu-item-preview');\n\t\t\t}\n\n\t\t\ttext = self.state.get('text');\n\t\t\tif (text === '-' || text === '|') {\n\t\t\t\tself.classes.add('menu-item-sep');\n\t\t\t\tself.aria('role', 'separator');\n\t\t\t\tself.state.set('text', '-');\n\t\t\t}\n\n\t\t\tif (settings.selectable) {\n\t\t\t\tself.aria('role', 'menuitemcheckbox');\n\t\t\t\tself.classes.add('menu-item-checkbox');\n\t\t\t\tsettings.icon = 'selected';\n\t\t\t}\n\n\t\t\tif (!settings.preview && !settings.selectable) {\n\t\t\t\tself.classes.add('menu-item-normal');\n\t\t\t}\n\n\t\t\tself.on('mousedown', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\tif (settings.menu && !settings.ariaHideMenu) {\n\t\t\t\tself.aria('haspopup', true);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Returns true/false if the menuitem has sub menu.\n\t\t *\n\t\t * @method hasMenus\n\t\t * @return {Boolean} True/false state if it has submenu.\n\t\t */\n\t\thasMenus: function() {\n\t\t\treturn !!this.settings.menu;\n\t\t},\n\n\t\t/**\n\t\t * Shows the menu for the menu item.\n\t\t *\n\t\t * @method showMenu\n\t\t */\n\t\tshowMenu: function() {\n\t\t\tvar self = this, settings = self.settings, menu, parent = self.parent();\n\n\t\t\tparent.items().each(function(ctrl) {\n\t\t\t\tif (ctrl !== self) {\n\t\t\t\t\tctrl.hideMenu();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (settings.menu) {\n\t\t\t\tmenu = self.menu;\n\n\t\t\t\tif (!menu) {\n\t\t\t\t\tmenu = settings.menu;\n\n\t\t\t\t\t// Is menu array then auto constuct menu control\n\t\t\t\t\tif (menu.length) {\n\t\t\t\t\t\tmenu = {\n\t\t\t\t\t\t\ttype: 'menu',\n\t\t\t\t\t\t\titems: menu\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmenu.type = menu.type || 'menu';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (parent.settings.itemDefaults) {\n\t\t\t\t\t\tmenu.itemDefaults = parent.settings.itemDefaults;\n\t\t\t\t\t}\n\n\t\t\t\t\tmenu = self.menu = Factory.create(menu).parent(self).renderTo();\n\t\t\t\t\tmenu.reflow();\n\t\t\t\t\tmenu.on('cancel', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tself.focus();\n\t\t\t\t\t\tmenu.hide();\n\t\t\t\t\t});\n\t\t\t\t\tmenu.on('show hide', function(e) {\n\t\t\t\t\t\te.control.items().each(function(ctrl) {\n\t\t\t\t\t\t\tctrl.active(ctrl.settings.selected);\n\t\t\t\t\t\t});\n\t\t\t\t\t}).fire('show');\n\n\t\t\t\t\tmenu.on('hide', function(e) {\n\t\t\t\t\t\tif (e.control === menu) {\n\t\t\t\t\t\t\tself.classes.remove('selected');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tmenu.submenu = true;\n\t\t\t\t} else {\n\t\t\t\t\tmenu.show();\n\t\t\t\t}\n\n\t\t\t\tmenu._parentMenu = parent;\n\n\t\t\t\tmenu.classes.add('menu-sub');\n\n\t\t\t\tvar rel = menu.testMoveRel(\n\t\t\t\t\tself.getEl(),\n\t\t\t\t\tself.isRtl() ? ['tl-tr', 'bl-br', 'tr-tl', 'br-bl'] : ['tr-tl', 'br-bl', 'tl-tr', 'bl-br']\n\t\t\t\t);\n\n\t\t\t\tmenu.moveRel(self.getEl(), rel);\n\t\t\t\tmenu.rel = rel;\n\n\t\t\t\trel = 'menu-sub-' + rel;\n\t\t\t\tmenu.classes.remove(menu._lastRel).add(rel);\n\t\t\t\tmenu._lastRel = rel;\n\n\t\t\t\tself.classes.add('selected');\n\t\t\t\tself.aria('expanded', true);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Hides the menu for the menu item.\n\t\t *\n\t\t * @method hideMenu\n\t\t */\n\t\thideMenu: function() {\n\t\t\tvar self = this;\n\n\t\t\tif (self.menu) {\n\t\t\t\tself.menu.items().each(function(item) {\n\t\t\t\t\tif (item.hideMenu) {\n\t\t\t\t\t\titem.hideMenu();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.menu.hide();\n\t\t\t\tself.aria('expanded', false);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, settings = self.settings, prefix = self.classPrefix, text = self.encode(self.state.get('text'));\n\t\t\tvar icon = self.settings.icon, image = '', shortcut = settings.shortcut;\n\n\t\t\t// Converts shortcut format to Mac/PC variants\n\t\t\tfunction convertShortcut(shortcut) {\n\t\t\t\tvar i, value, replace = {};\n\n\t\t\t\tif (Env.mac) {\n\t\t\t\t\treplace = {\n\t\t\t\t\t\talt: '&#x2325;',\n\t\t\t\t\t\tctrl: '&#x2318;',\n\t\t\t\t\t\tshift: '&#x21E7;',\n\t\t\t\t\t\tmeta: '&#x2318;'\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\treplace = {\n\t\t\t\t\t\tmeta: 'Ctrl'\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tshortcut = shortcut.split('+');\n\n\t\t\t\tfor (i = 0; i < shortcut.length; i++) {\n\t\t\t\t\tvalue = replace[shortcut[i].toLowerCase()];\n\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tshortcut[i] = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn shortcut.join('+');\n\t\t\t}\n\n\t\t\tif (icon) {\n\t\t\t\tself.parent().classes.add('menu-has-icons');\n\t\t\t}\n\n\t\t\tif (settings.image) {\n\t\t\t\timage = ' style=\"background-image: url(\\'' + settings.image + '\\')\"';\n\t\t\t}\n\n\t\t\tif (shortcut) {\n\t\t\t\tshortcut = convertShortcut(shortcut);\n\t\t\t}\n\n\t\t\ticon = prefix + 'ico ' + prefix + 'i-' + (self.settings.icon || 'none');\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" tabindex=\"-1\">' +\n\t\t\t\t\t(text !== '-' ? '<i class=\"' + icon + '\"' + image + '></i>\\u00a0' : '') +\n\t\t\t\t\t(text !== '-' ? '<span id=\"' + id + '-text\" class=\"' + prefix + 'text\">' + text + '</span>' : '') +\n\t\t\t\t\t(shortcut ? '<div id=\"' + id + '-shortcut\" class=\"' + prefix + 'menu-shortcut\">' + shortcut + '</div>' : '') +\n\t\t\t\t\t(settings.menu ? '<div class=\"' + prefix + 'caret\"></div>' : '') +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Gets invoked after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, settings = self.settings;\n\n\t\t\tvar textStyle = settings.textStyle;\n\t\t\tif (typeof textStyle == \"function\") {\n\t\t\t\ttextStyle = textStyle.call(this);\n\t\t\t}\n\n\t\t\tif (textStyle) {\n\t\t\t\tvar textElm = self.getEl('text');\n\t\t\t\tif (textElm) {\n\t\t\t\t\ttextElm.setAttribute('style', textStyle);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.on('mouseenter click', function(e) {\n\t\t\t\tif (e.control === self) {\n\t\t\t\t\tif (!settings.menu && e.type === 'click') {\n\t\t\t\t\t\tself.fire('select');\n\n\t\t\t\t\t\t// Edge will crash if you stress it see #2660\n\t\t\t\t\t\tDelay.requestAnimationFrame(function() {\n\t\t\t\t\t\t\tself.parent().hideAll();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.showMenu();\n\n\t\t\t\t\t\tif (e.aria) {\n\t\t\t\t\t\t\tself.menu.focus(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself._super();\n\n\t\t\treturn self;\n\t\t},\n\n\t\thover: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.parent().items().each(function(ctrl) {\n\t\t\t\tctrl.classes.remove('selected');\n\t\t\t});\n\n\t\t\tself.classes.toggle('selected', true);\n\n\t\t\treturn self;\n\t\t},\n\n\t\tactive: function(state) {\n\t\t\tif (typeof state != \"undefined\") {\n\t\t\t\tthis.aria('checked', state);\n\t\t\t}\n\n\t\t\treturn this._super(state);\n\t\t},\n\n\t\t/**\n\t\t * Removes the control and it's menus.\n\t\t *\n\t\t * @method remove\n\t\t */\n\t\tremove: function() {\n\t\t\tthis._super();\n\n\t\t\tif (this.menu) {\n\t\t\t\tthis.menu.remove();\n\t\t\t}\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Throbber.js\n\n/**\n * Throbber.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This class enables you to display a Throbber for any element.\n *\n * @-x-less Throbber.less\n * @class tinymce.ui.Throbber\n */\ndefine(\"tinymce/ui/Throbber\", [\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/Control\",\n\t\"tinymce/util/Delay\"\n], function($, Control, Delay) {\n\t\"use strict\";\n\n\t/**\n\t * Constructs a new throbber.\n\t *\n\t * @constructor\n\t * @param {Element} elm DOM Html element to display throbber in.\n\t * @param {Boolean} inline Optional true/false state if the throbber should be appended to end of element for infinite scroll.\n\t */\n\treturn function(elm, inline) {\n\t\tvar self = this, state, classPrefix = Control.classPrefix, timer;\n\n\t\t/**\n\t\t * Shows the throbber.\n\t\t *\n\t\t * @method show\n\t\t * @param {Number} [time] Time to wait before showing.\n\t\t * @param {function} [callback] Optional callback to execute when the throbber is shown.\n\t\t * @return {tinymce.ui.Throbber} Current throbber instance.\n\t\t */\n\t\tself.show = function(time, callback) {\n\t\t\tfunction render() {\n\t\t\t\t\tif (state) {\n\t\t\t\t\t\t$(elm).append(\n\t\t\t\t\t\t\t'<div class=\"' + classPrefix + 'throbber' + (inline ? ' ' + classPrefix + 'throbber-inline' : '') + '\"></div>'\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.hide();\n\n\t\t\tstate = true;\n\n\t\t\tif (time) {\n\t\t\t\ttimer = Delay.setTimeout(render, time);\n\t\t\t} else {\n\t\t\t\trender();\n\t\t\t}\n\n\t\t\treturn self;\n\t\t};\n\n\t\t/**\n\t\t * Hides the throbber.\n\t\t *\n\t\t * @method hide\n\t\t * @return {tinymce.ui.Throbber} Current throbber instance.\n\t\t */\n\t\tself.hide = function() {\n\t\t\tvar child = elm.lastChild;\n\n\t\t\tDelay.clearTimeout(timer);\n\n\t\t\tif (child && child.className.indexOf('throbber') != -1) {\n\t\t\t\tchild.parentNode.removeChild(child);\n\t\t\t}\n\n\t\t\tstate = false;\n\n\t\t\treturn self;\n\t\t};\n\t};\n});\n\n// Included from: js/tinymce/classes/ui/Menu.js\n\n/**\n * Menu.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new menu.\n *\n * @-x-less Menu.less\n * @class tinymce.ui.Menu\n * @extends tinymce.ui.FloatPanel\n */\ndefine(\"tinymce/ui/Menu\", [\n\t\"tinymce/ui/FloatPanel\",\n\t\"tinymce/ui/MenuItem\",\n\t\"tinymce/ui/Throbber\",\n\t\"tinymce/util/Tools\"\n], function(FloatPanel, MenuItem, Throbber, Tools) {\n\t\"use strict\";\n\n\treturn FloatPanel.extend({\n\t\tDefaults: {\n\t\t\tdefaultType: 'menuitem',\n\t\t\tborder: 1,\n\t\t\tlayout: 'stack',\n\t\t\trole: 'application',\n\t\t\tbodyRole: 'menu',\n\t\t\tariaRoot: true\n\t\t},\n\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tsettings.autohide = true;\n\t\t\tsettings.constrainToViewport = true;\n\n\t\t\tif (typeof settings.items === 'function') {\n\t\t\t\tsettings.itemsFactory = settings.items;\n\t\t\t\tsettings.items = [];\n\t\t\t}\n\n\t\t\tif (settings.itemDefaults) {\n\t\t\t\tvar items = settings.items, i = items.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\titems[i] = Tools.extend({}, settings.itemDefaults, items[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('menu');\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tthis.classes.toggle('menu-align', true);\n\n\t\t\tthis._super();\n\n\t\t\tthis.getEl().style.height = '';\n\t\t\tthis.getEl('body').style.height = '';\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Hides/closes the menu.\n\t\t *\n\t\t * @method cancel\n\t\t */\n\t\tcancel: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.hideAll();\n\t\t\tself.fire('select');\n\t\t},\n\n\t\t/**\n\t\t * Loads new items from the factory items function.\n\t\t *\n\t\t * @method load\n\t\t */\n\t\tload: function() {\n\t\t\tvar self = this, time, factory;\n\n\t\t\tfunction hideThrobber() {\n\t\t\t\tif (self.throbber) {\n\t\t\t\t\tself.throbber.hide();\n\t\t\t\t\tself.throbber = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfactory = self.settings.itemsFactory;\n\t\t\tif (!factory) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!self.throbber) {\n\t\t\t\tself.throbber = new Throbber(self.getEl('body'), true);\n\n\t\t\t\tif (self.items().length === 0) {\n\t\t\t\t\tself.throbber.show();\n\t\t\t\t\tself.fire('loading');\n\t\t\t\t} else {\n\t\t\t\t\tself.throbber.show(100, function() {\n\t\t\t\t\t\tself.items().remove();\n\t\t\t\t\t\tself.fire('loading');\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tself.on('hide close', hideThrobber);\n\t\t\t}\n\n\t\t\tself.requestTime = time = new Date().getTime();\n\n\t\t\tself.settings.itemsFactory(function(items) {\n\t\t\t\tif (items.length === 0) {\n\t\t\t\t\tself.hide();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (self.requestTime !== time) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tself.getEl().style.width = '';\n\t\t\t\tself.getEl('body').style.width = '';\n\n\t\t\t\thideThrobber();\n\t\t\t\tself.items().remove();\n\t\t\t\tself.getEl('body').innerHTML = '';\n\n\t\t\t\tself.add(items);\n\t\t\t\tself.renderNew();\n\t\t\t\tself.fire('loaded');\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Hide menu and all sub menus.\n\t\t *\n\t\t * @method hideAll\n\t\t */\n\t\thideAll: function() {\n\t\t\tvar self = this;\n\n\t\t\tthis.find('menuitem').exec('hideMenu');\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\t/**\n\t\t * Invoked before the menu is rendered.\n\t\t *\n\t\t * @method preRender\n\t\t */\n\t\tpreRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.items().each(function(ctrl) {\n\t\t\t\tvar settings = ctrl.settings;\n\n\t\t\t\tif (settings.icon || settings.image || settings.selectable) {\n\t\t\t\t\tself._hasIcons = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (self.settings.itemsFactory) {\n\t\t\t\tself.on('postrender', function() {\n\t\t\t\t\tif (self.settings.itemsFactory) {\n\t\t\t\t\t\tself.load();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ListBox.js\n\n/**\n * ListBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new list box control.\n *\n * @-x-less ListBox.less\n * @class tinymce.ui.ListBox\n * @extends tinymce.ui.MenuButton\n */\ndefine(\"tinymce/ui/ListBox\", [\n\t\"tinymce/ui/MenuButton\",\n\t\"tinymce/ui/Menu\"\n], function(MenuButton, Menu) {\n\t\"use strict\";\n\n\treturn MenuButton.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Array} values Array with values to add to list box.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this, values, selected, selectedText, lastItemCtrl;\n\n\t\t\tfunction setSelected(menuValues) {\n\t\t\t\t// Try to find a selected value\n\t\t\t\tfor (var i = 0; i < menuValues.length; i++) {\n\t\t\t\t\tselected = menuValues[i].selected || settings.value === menuValues[i].value;\n\n\t\t\t\t\tif (selected) {\n\t\t\t\t\t\tselectedText = selectedText || menuValues[i].text;\n\t\t\t\t\t\tself.state.set('value', menuValues[i].value);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// If the value has a submenu, try to find the selected values in that menu\n\t\t\t\t\tif (menuValues[i].menu) {\n\t\t\t\t\t\tif (setSelected(menuValues[i].menu)) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself._super(settings);\n\t\t\tsettings = self.settings;\n\n\t\t\tself._values = values = settings.values;\n\t\t\tif (values) {\n\t\t\t\tif (typeof settings.value != \"undefined\") {\n\t\t\t\t\tsetSelected(values);\n\t\t\t\t}\n\n\t\t\t\t// Default with first item\n\t\t\t\tif (!selected && values.length > 0) {\n\t\t\t\t\tselectedText = values[0].text;\n\t\t\t\t\tself.state.set('value', values[0].value);\n\t\t\t\t}\n\n\t\t\t\tself.state.set('menu', values);\n\t\t\t}\n\n\t\t\tself.state.set('text', settings.text || selectedText);\n\n\t\t\tself.classes.add('listbox');\n\n\t\t\tself.on('select', function(e) {\n\t\t\t\tvar ctrl = e.control;\n\n\t\t\t\tif (lastItemCtrl) {\n\t\t\t\t\te.lastControl = lastItemCtrl;\n\t\t\t\t}\n\n\t\t\t\tif (settings.multiple) {\n\t\t\t\t\tctrl.active(!ctrl.active());\n\t\t\t\t} else {\n\t\t\t\t\tself.value(e.control.value());\n\t\t\t\t}\n\n\t\t\t\tlastItemCtrl = ctrl;\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter function for the control value.\n\t\t *\n\t\t * @method value\n\t\t * @param {String} [value] Value to be set.\n\t\t * @return {Boolean/tinymce.ui.ListBox} Value or self if it's a set operation.\n\t\t */\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tfunction activateMenuItemsByValue(menu, value) {\n\t\t\t\tif (menu instanceof Menu) {\n\t\t\t\t\tmenu.items().each(function(ctrl) {\n\t\t\t\t\t\tif (!ctrl.hasMenus()) {\n\t\t\t\t\t\t\tctrl.active(ctrl.value() === value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction getSelectedItem(menuValues, value) {\n\t\t\t\tvar selectedItem;\n\n\t\t\t\tif (!menuValues) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0; i < menuValues.length; i++) {\n\t\t\t\t\tif (menuValues[i].value === value) {\n\t\t\t\t\t\treturn menuValues[i];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (menuValues[i].menu) {\n\t\t\t\t\t\tselectedItem = getSelectedItem(menuValues[i].menu, value);\n\t\t\t\t\t\tif (selectedItem) {\n\t\t\t\t\t\t\treturn selectedItem;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.on('show', function(e) {\n\t\t\t\tactivateMenuItemsByValue(e.control, self.value());\n\t\t\t});\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tvar selectedItem = getSelectedItem(self.state.get('menu'), e.value);\n\n\t\t\t\tif (selectedItem) {\n\t\t\t\t\tself.text(selectedItem.text);\n\t\t\t\t} else {\n\t\t\t\t\tself.text(self.settings.text);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Radio.js\n\n/**\n * Radio.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new radio button.\n *\n * @-x-less Radio.less\n * @class tinymce.ui.Radio\n * @extends tinymce.ui.Checkbox\n */\ndefine(\"tinymce/ui/Radio\", [\n\t\"tinymce/ui/Checkbox\"\n], function(Checkbox) {\n\t\"use strict\";\n\n\treturn Checkbox.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"radio\",\n\t\t\trole: \"radio\"\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/ResizeHandle.js\n\n/**\n * ResizeHandle.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Renders a resize handle that fires ResizeStart, Resize and ResizeEnd events.\n *\n * @-x-less ResizeHandle.less\n * @class tinymce.ui.ResizeHandle\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/ResizeHandle\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/DragHelper\"\n], function(Widget, DragHelper) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, prefix = self.classPrefix;\n\n\t\t\tself.classes.add('resizehandle');\n\n\t\t\tif (self.settings.direction == \"both\") {\n\t\t\t\tself.classes.add('resizehandle-both');\n\t\t\t}\n\n\t\t\tself.canFocus = false;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<i class=\"' + prefix + 'ico ' + prefix + 'i-resize\"></i>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself._super();\n\n\t\t\tself.resizeDragHelper = new DragHelper(this._id, {\n\t\t\t\tstart: function() {\n\t\t\t\t\tself.fire('ResizeStart');\n\t\t\t\t},\n\n\t\t\t\tdrag: function(e) {\n\t\t\t\t\tif (self.settings.direction != \"both\") {\n\t\t\t\t\t\te.deltaX = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tself.fire('Resize', e);\n\t\t\t\t},\n\n\t\t\t\tstop: function() {\n\t\t\t\t\tself.fire('ResizeEnd');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tremove: function() {\n\t\t\tif (this.resizeDragHelper) {\n\t\t\t\tthis.resizeDragHelper.destroy();\n\t\t\t}\n\n\t\t\treturn this._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/SelectBox.js\n\n/**\n * SelectBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new select box control.\n *\n * @-x-less SelectBox.less\n * @class tinymce.ui.SelectBox\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/SelectBox\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\tfunction createOptions(options) {\n\t\tvar strOptions = '';\n\t\tif (options) {\n\t\t\tfor (var i = 0; i < options.length; i++) {\n\t\t\t\tstrOptions += '<option value=\"' + options[i] + '\">' + options[i] + '</option>';\n\t\t\t}\n\t\t}\n\t\treturn strOptions;\n\t}\n\n\treturn Widget.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"selectbox\",\n\t\t\trole: \"selectbox\",\n\t\t\toptions: []\n\t\t},\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Array} values Array with values to add to list box.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\n\t\t\tif (self.settings.size) {\n\t\t\t\tself.size = self.settings.size;\n\t\t\t}\n\n\t\t\tif (self.settings.options) {\n\t\t\t\tself._options = self.settings.options;\n\t\t\t}\n\n\t\t\tself.on('keydown', function(e) {\n\t\t\t\tvar rootControl;\n\n\t\t\t\tif (e.keyCode == 13) {\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t// Find root control that we can do toJSON on\n\t\t\t\t\tself.parents().reverse().each(function(ctrl) {\n\t\t\t\t\t\tif (ctrl.toJSON) {\n\t\t\t\t\t\t\trootControl = ctrl;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Fire event on current text box with the serialized data of the whole form\n\t\t\t\t\tself.fire('submit', {data: rootControl.toJSON()});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Getter/setter function for the options state.\n\t\t *\n\t\t * @method options\n\t\t * @param {Array} [state] State to be set.\n\t\t * @return {Array|tinymce.ui.SelectBox} Array of string options.\n\t\t */\n\t\toptions: function(state) {\n\t\t\tif (!arguments.length) {\n\t\t\t\treturn this.state.get('options');\n\t\t\t}\n\n\t\t\tthis.state.set('options', state);\n\n\t\t\treturn this;\n\t\t},\n\n\t\trenderHtml: function() {\n\t\t\tvar self = this, options, size = '';\n\n\t\t\toptions = createOptions(self._options);\n\n\t\t\tif (self.size) {\n\t\t\t\tsize = ' size = \"' + self.size + '\"';\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<select id=\"' + self._id + '\" class=\"' + self.classes + '\"' + size + '>' +\n\t\t\t\t\toptions +\n\t\t\t\t'</select>'\n\t\t\t);\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:options', function(e) {\n\t\t\t\tself.getEl().innerHTML = createOptions(e.value);\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Slider.js\n\n/**\n * Slider.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Slider control.\n *\n * @-x-less Slider.less\n * @class tinymce.ui.Slider\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Slider\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/ui/DragHelper\",\n\t\"tinymce/ui/DomUtils\"\n], function(Widget, DragHelper, DomUtils) {\n\t\"use strict\";\n\n\tfunction constrain(value, minVal, maxVal) {\n\t\tif (value < minVal) {\n\t\t\tvalue = minVal;\n\t\t}\n\n\t\tif (value > maxVal) {\n\t\t\tvalue = maxVal;\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tfunction setAriaProp(el, name, value) {\n\t\tel.setAttribute('aria-' + name, value);\n\t}\n\n\tfunction updateSliderHandle(ctrl, value) {\n\t\tvar maxHandlePos, shortSizeName, sizeName, stylePosName, styleValue, handleEl;\n\n\t\tif (ctrl.settings.orientation == \"v\") {\n\t\t\tstylePosName = \"top\";\n\t\t\tsizeName = \"height\";\n\t\t\tshortSizeName = \"h\";\n\t\t} else {\n\t\t\tstylePosName = \"left\";\n\t\t\tsizeName = \"width\";\n\t\t\tshortSizeName = \"w\";\n\t\t}\n\n\t\thandleEl = ctrl.getEl('handle');\n\t\tmaxHandlePos = (ctrl.layoutRect()[shortSizeName] || 100) - DomUtils.getSize(handleEl)[sizeName];\n\n\t\tstyleValue = (maxHandlePos * ((value - ctrl._minValue) / (ctrl._maxValue - ctrl._minValue))) + 'px';\n\t\thandleEl.style[stylePosName] = styleValue;\n\t\thandleEl.style.height = ctrl.layoutRect().h + 'px';\n\n\t\tsetAriaProp(handleEl, 'valuenow', value);\n\t\tsetAriaProp(handleEl, 'valuetext', '' + ctrl.settings.previewFilter(value));\n\t\tsetAriaProp(handleEl, 'valuemin', ctrl._minValue);\n\t\tsetAriaProp(handleEl, 'valuemax', ctrl._maxValue);\n\t}\n\n\treturn Widget.extend({\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tif (!settings.previewFilter) {\n\t\t\t\tsettings.previewFilter = function(value) {\n\t\t\t\t\treturn Math.round(value * 100) / 100.0;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tself._super(settings);\n\t\t\tself.classes.add('slider');\n\n\t\t\tif (settings.orientation == \"v\") {\n\t\t\t\tself.classes.add('vertical');\n\t\t\t}\n\n\t\t\tself._minValue = settings.minValue || 0;\n\t\t\tself._maxValue = settings.maxValue || 100;\n\t\t\tself._initValue = self.state.get('value');\n\t\t},\n\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix;\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\">' +\n\t\t\t\t\t'<div id=\"' + id + '-handle\" class=\"' + prefix + 'slider-handle\" role=\"slider\" tabindex=\"-1\"></div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\treset: function() {\n\t\t\tthis.value(this._initValue).repaint();\n\t\t},\n\n\t\tpostRender: function() {\n\t\t\tvar self = this, minValue, maxValue, screenCordName,\n\t\t\t\t\tstylePosName, sizeName, shortSizeName;\n\n\t\t\tfunction toFraction(min, max, val) {\n\t\t\t\treturn (val + min) / (max - min);\n\t\t\t}\n\n\t\t\tfunction fromFraction(min, max, val) {\n\t\t\t\treturn (val * (max - min)) - min;\n\t\t\t}\n\n\t\t\tfunction handleKeyboard(minValue, maxValue) {\n\t\t\t\tfunction alter(delta) {\n\t\t\t\t\tvar value;\n\n\t\t\t\t\tvalue = self.value();\n\t\t\t\t\tvalue = fromFraction(minValue, maxValue, toFraction(minValue, maxValue, value) + (delta * 0.05));\n\t\t\t\t\tvalue = constrain(value, minValue, maxValue);\n\n\t\t\t\t\tself.value(value);\n\n\t\t\t\t\tself.fire('dragstart', {value: value});\n\t\t\t\t\tself.fire('drag', {value: value});\n\t\t\t\t\tself.fire('dragend', {value: value});\n\t\t\t\t}\n\n\t\t\t\tself.on('keydown', function(e) {\n\t\t\t\t\tswitch (e.keyCode) {\n\t\t\t\t\t\tcase 37:\n\t\t\t\t\t\tcase 38:\n\t\t\t\t\t\t\talter(-1);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 39:\n\t\t\t\t\t\tcase 40:\n\t\t\t\t\t\t\talter(1);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction handleDrag(minValue, maxValue, handleEl) {\n\t\t\t\tvar startPos, startHandlePos, maxHandlePos, handlePos, value;\n\n\t\t\t\tself._dragHelper = new DragHelper(self._id, {\n\t\t\t\t\thandle: self._id + \"-handle\",\n\n\t\t\t\t\tstart: function(e) {\n\t\t\t\t\t\tstartPos = e[screenCordName];\n\t\t\t\t\t\tstartHandlePos = parseInt(self.getEl('handle').style[stylePosName], 10);\n\t\t\t\t\t\tmaxHandlePos = (self.layoutRect()[shortSizeName] || 100) - DomUtils.getSize(handleEl)[sizeName];\n\t\t\t\t\t\tself.fire('dragstart', {value: value});\n\t\t\t\t\t},\n\n\t\t\t\t\tdrag: function(e) {\n\t\t\t\t\t\tvar delta = e[screenCordName] - startPos;\n\n\t\t\t\t\t\thandlePos = constrain(startHandlePos + delta, 0, maxHandlePos);\n\t\t\t\t\t\thandleEl.style[stylePosName] = handlePos + 'px';\n\n\t\t\t\t\t\tvalue = minValue + (handlePos / maxHandlePos) * (maxValue - minValue);\n\t\t\t\t\t\tself.value(value);\n\n\t\t\t\t\t\tself.tooltip().text('' + self.settings.previewFilter(value)).show().moveRel(handleEl, 'bc tc');\n\n\t\t\t\t\t\tself.fire('drag', {value: value});\n\t\t\t\t\t},\n\n\t\t\t\t\tstop: function() {\n\t\t\t\t\t\tself.tooltip().hide();\n\t\t\t\t\t\tself.fire('dragend', {value: value});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tminValue = self._minValue;\n\t\t\tmaxValue = self._maxValue;\n\n\t\t\tif (self.settings.orientation == \"v\") {\n\t\t\t\tscreenCordName = \"screenY\";\n\t\t\t\tstylePosName = \"top\";\n\t\t\t\tsizeName = \"height\";\n\t\t\t\tshortSizeName = \"h\";\n\t\t\t} else {\n\t\t\t\tscreenCordName = \"screenX\";\n\t\t\t\tstylePosName = \"left\";\n\t\t\t\tsizeName = \"width\";\n\t\t\t\tshortSizeName = \"w\";\n\t\t\t}\n\n\t\t\tself._super();\n\n\t\t\thandleKeyboard(minValue, maxValue, self.getEl('handle'));\n\t\t\thandleDrag(minValue, maxValue, self.getEl('handle'));\n\t\t},\n\n\t\trepaint: function() {\n\t\t\tthis._super();\n\t\t\tupdateSliderHandle(this, this.value());\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tupdateSliderHandle(self, e.value);\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/Spacer.js\n\n/**\n * Spacer.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a spacer. This control is used in flex layouts for example.\n *\n * @-x-less Spacer.less\n * @class tinymce.ui.Spacer\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/Spacer\", [\n\t\"tinymce/ui/Widget\"\n], function(Widget) {\n\t\"use strict\";\n\n\treturn Widget.extend({\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.classes.add('spacer');\n\t\t\tself.canFocus = false;\n\n\t\t\treturn '<div id=\"' + self._id + '\" class=\"' + self.classes + '\"></div>';\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/SplitButton.js\n\n/**\n * SplitButton.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a split button.\n *\n * @-x-less SplitButton.less\n * @class tinymce.ui.SplitButton\n * @extends tinymce.ui.Button\n */\ndefine(\"tinymce/ui/SplitButton\", [\n\t\"tinymce/ui/MenuButton\",\n\t\"tinymce/ui/DomUtils\",\n\t\"tinymce/dom/DomQuery\"\n], function(MenuButton, DomUtils, $) {\n\treturn MenuButton.extend({\n\t\tDefaults: {\n\t\t\tclasses: \"widget btn splitbtn\",\n\t\t\trole: \"button\"\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, elm = self.getEl(), rect = self.layoutRect(), mainButtonElm, menuButtonElm;\n\n\t\t\tself._super();\n\n\t\t\tmainButtonElm = elm.firstChild;\n\t\t\tmenuButtonElm = elm.lastChild;\n\n\t\t\t$(mainButtonElm).css({\n\t\t\t\twidth: rect.w - DomUtils.getSize(menuButtonElm).width,\n\t\t\t\theight: rect.h - 2\n\t\t\t});\n\n\t\t\t$(menuButtonElm).css({\n\t\t\t\theight: rect.h - 2\n\t\t\t});\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Sets the active menu state.\n\t\t *\n\t\t * @private\n\t\t */\n\t\tactiveMenu: function(state) {\n\t\t\tvar self = this;\n\n\t\t\t$(self.getEl().lastChild).toggleClass(self.classPrefix + 'active', state);\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, id = self._id, prefix = self.classPrefix, image;\n\t\t\tvar icon = self.state.get('icon'), text = self.state.get('text'),\n\t\t\t\ttextHtml = '';\n\n\t\t\timage = self.settings.image;\n\t\t\tif (image) {\n\t\t\t\ticon = 'none';\n\n\t\t\t\t// Support for [high dpi, low dpi] image sources\n\t\t\t\tif (typeof image != \"string\") {\n\t\t\t\t\timage = window.getSelection ? image[0] : image[1];\n\t\t\t\t}\n\n\t\t\t\timage = ' style=\"background-image: url(\\'' + image + '\\')\"';\n\t\t\t} else {\n\t\t\t\timage = '';\n\t\t\t}\n\n\t\t\ticon = self.settings.icon ? prefix + 'ico ' + prefix + 'i-' + icon : '';\n\n\t\t\tif (text) {\n\t\t\t\tself.classes.add('btn-has-text');\n\t\t\t\ttextHtml = '<span class=\"' + prefix + 'txt\">' + self.encode(text) + '</span>';\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + id + '\" class=\"' + self.classes + '\" role=\"button\" tabindex=\"-1\">' +\n\t\t\t\t\t'<button type=\"button\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t\t(icon ? '<i class=\"' + icon + '\"' + image + '></i>' : '') +\n\t\t\t\t\t\ttextHtml +\n\t\t\t\t\t'</button>' +\n\t\t\t\t\t'<button type=\"button\" class=\"' + prefix + 'open\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t\t//(icon ? '<i class=\"' + icon + '\"></i>' : '') +\n\t\t\t\t\t\t(self._menuBtnText ? (icon ? '\\u00a0' : '') + self._menuBtnText : '') +\n\t\t\t\t\t\t' <i class=\"' + prefix + 'caret\"></i>' +\n\t\t\t\t\t'</button>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this, onClickHandler = self.settings.onclick;\n\n\t\t\tself.on('click', function(e) {\n\t\t\t\tvar node = e.target;\n\n\t\t\t\tif (e.control == this) {\n\t\t\t\t\t// Find clicks that is on the main button\n\t\t\t\t\twhile (node) {\n\t\t\t\t\t\tif ((e.aria && e.aria.key != 'down') || (node.nodeName == 'BUTTON' && node.className.indexOf('open') == -1)) {\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\n\t\t\t\t\t\t\tif (onClickHandler) {\n\t\t\t\t\t\t\t\tonClickHandler.call(this, e);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdelete self.settings.onclick;\n\n\t\t\treturn self._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/StackLayout.js\n\n/**\n * StackLayout.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This layout uses the browsers layout when the items are blocks.\n *\n * @-x-less StackLayout.less\n * @class tinymce.ui.StackLayout\n * @extends tinymce.ui.FlowLayout\n */\ndefine(\"tinymce/ui/StackLayout\", [\n\t\"tinymce/ui/FlowLayout\"\n], function(FlowLayout) {\n\t\"use strict\";\n\n\treturn FlowLayout.extend({\n\t\tDefaults: {\n\t\t\tcontainerClass: 'stack-layout',\n\t\t\tcontrolClass: 'stack-layout-item',\n\t\t\tendClass: 'break'\n\t\t},\n\n\t\tisNative: function() {\n\t\t\treturn true;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/TabPanel.js\n\n/**\n * TabPanel.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a tab panel control.\n *\n * @-x-less TabPanel.less\n * @class tinymce.ui.TabPanel\n * @extends tinymce.ui.Panel\n *\n * @setting {Number} activeTab Active tab index.\n */\ndefine(\"tinymce/ui/TabPanel\", [\n\t\"tinymce/ui/Panel\",\n\t\"tinymce/dom/DomQuery\",\n\t\"tinymce/ui/DomUtils\"\n], function(Panel, $, DomUtils) {\n\t\"use strict\";\n\n\treturn Panel.extend({\n\t\tDefaults: {\n\t\t\tlayout: 'absolute',\n\t\t\tdefaults: {\n\t\t\t\ttype: 'panel'\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Activates the specified tab by index.\n\t\t *\n\t\t * @method activateTab\n\t\t * @param {Number} idx Index of the tab to activate.\n\t\t */\n\t\tactivateTab: function(idx) {\n\t\t\tvar activeTabElm;\n\n\t\t\tif (this.activeTabId) {\n\t\t\t\tactiveTabElm = this.getEl(this.activeTabId);\n\t\t\t\t$(activeTabElm).removeClass(this.classPrefix + 'active');\n\t\t\t\tactiveTabElm.setAttribute('aria-selected', \"false\");\n\t\t\t}\n\n\t\t\tthis.activeTabId = 't' + idx;\n\n\t\t\tactiveTabElm = this.getEl('t' + idx);\n\t\t\tactiveTabElm.setAttribute('aria-selected', \"true\");\n\t\t\t$(activeTabElm).addClass(this.classPrefix + 'active');\n\n\t\t\tthis.items()[idx].show().fire('showtab');\n\t\t\tthis.reflow();\n\n\t\t\tthis.items().each(function(item, i) {\n\t\t\t\tif (idx != i) {\n\t\t\t\t\titem.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, layout = self._layout, tabsHtml = '', prefix = self.classPrefix;\n\n\t\t\tself.preRender();\n\t\t\tlayout.preRender(self);\n\n\t\t\tself.items().each(function(ctrl, i) {\n\t\t\t\tvar id = self._id + '-t' + i;\n\n\t\t\t\tctrl.aria('role', 'tabpanel');\n\t\t\t\tctrl.aria('labelledby', id);\n\n\t\t\t\ttabsHtml += (\n\t\t\t\t\t'<div id=\"' + id + '\" class=\"' + prefix + 'tab\" ' +\n\t\t\t\t\t\t'unselectable=\"on\" role=\"tab\" aria-controls=\"' + ctrl._id + '\" aria-selected=\"false\" tabIndex=\"-1\">' +\n\t\t\t\t\t\tself.encode(ctrl.settings.title) +\n\t\t\t\t\t'</div>'\n\t\t\t\t);\n\t\t\t});\n\n\t\t\treturn (\n\t\t\t\t'<div id=\"' + self._id + '\" class=\"' + self.classes + '\" hidefocus=\"1\" tabindex=\"-1\">' +\n\t\t\t\t\t'<div id=\"' + self._id + '-head\" class=\"' + prefix + 'tabs\" role=\"tablist\">' +\n\t\t\t\t\t\ttabsHtml +\n\t\t\t\t\t'</div>' +\n\t\t\t\t\t'<div id=\"' + self._id + '-body\" class=\"' + self.bodyClasses + '\">' +\n\t\t\t\t\t\tlayout.renderHtml(self) +\n\t\t\t\t\t'</div>' +\n\t\t\t\t'</div>'\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself._super();\n\n\t\t\tself.settings.activeTab = self.settings.activeTab || 0;\n\t\t\tself.activateTab(self.settings.activeTab);\n\n\t\t\tthis.on('click', function(e) {\n\t\t\t\tvar targetParent = e.target.parentNode;\n\n\t\t\t\tif (e.target.parentNode.id == self._id + '-head') {\n\t\t\t\t\tvar i = targetParent.childNodes.length;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (targetParent.childNodes[i] == e.target) {\n\t\t\t\t\t\t\tself.activateTab(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Initializes the current controls layout rect.\n\t\t * This will be executed by the layout managers to determine the\n\t\t * default minWidth/minHeight etc.\n\t\t *\n\t\t * @method initLayoutRect\n\t\t * @return {Object} Layout rect instance.\n\t\t */\n\t\tinitLayoutRect: function() {\n\t\t\tvar self = this, rect, minW, minH;\n\n\t\t\tminW = DomUtils.getSize(self.getEl('head')).width;\n\t\t\tminW = minW < 0 ? 0 : minW;\n\t\t\tminH = 0;\n\n\t\t\tself.items().each(function(item) {\n\t\t\t\tminW = Math.max(minW, item.layoutRect().minW);\n\t\t\t\tminH = Math.max(minH, item.layoutRect().minH);\n\t\t\t});\n\n\t\t\tself.items().each(function(ctrl) {\n\t\t\t\tctrl.settings.x = 0;\n\t\t\t\tctrl.settings.y = 0;\n\t\t\t\tctrl.settings.w = minW;\n\t\t\t\tctrl.settings.h = minH;\n\n\t\t\t\tctrl.layoutRect({\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tw: minW,\n\t\t\t\t\th: minH\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tvar headH = DomUtils.getSize(self.getEl('head')).height;\n\n\t\t\tself.settings.minWidth = minW;\n\t\t\tself.settings.minHeight = minH + headH;\n\n\t\t\trect = self._super();\n\t\t\trect.deltaH += headH;\n\t\t\trect.innerH = rect.h - rect.deltaH;\n\n\t\t\treturn rect;\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/ui/TextBox.js\n\n/**\n * TextBox.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * Creates a new textbox.\n *\n * @-x-less TextBox.less\n * @class tinymce.ui.TextBox\n * @extends tinymce.ui.Widget\n */\ndefine(\"tinymce/ui/TextBox\", [\n\t\"tinymce/ui/Widget\",\n\t\"tinymce/util/Tools\",\n\t\"tinymce/ui/DomUtils\"\n], function(Widget, Tools, DomUtils) {\n\treturn Widget.extend({\n\t\t/**\n\t\t * Constructs a instance with the specified settings.\n\t\t *\n\t\t * @constructor\n\t\t * @param {Object} settings Name/value object with settings.\n\t\t * @setting {Boolean} multiline True if the textbox is a multiline control.\n\t\t * @setting {Number} maxLength Max length for the textbox.\n\t\t * @setting {Number} size Size of the textbox in characters.\n\t\t */\n\t\tinit: function(settings) {\n\t\t\tvar self = this;\n\n\t\t\tself._super(settings);\n\n\t\t\tself.classes.add('textbox');\n\n\t\t\tif (settings.multiline) {\n\t\t\t\tself.classes.add('multiline');\n\t\t\t} else {\n\t\t\t\tself.on('keydown', function(e) {\n\t\t\t\t\tvar rootControl;\n\n\t\t\t\t\tif (e.keyCode == 13) {\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t// Find root control that we can do toJSON on\n\t\t\t\t\t\tself.parents().reverse().each(function(ctrl) {\n\t\t\t\t\t\t\tif (ctrl.toJSON) {\n\t\t\t\t\t\t\t\trootControl = ctrl;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Fire event on current text box with the serialized data of the whole form\n\t\t\t\t\t\tself.fire('submit', {data: rootControl.toJSON()});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tself.on('keyup', function(e) {\n\t\t\t\t\tself.state.set('value', e.target.value);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Repaints the control after a layout operation.\n\t\t *\n\t\t * @method repaint\n\t\t */\n\t\trepaint: function() {\n\t\t\tvar self = this, style, rect, borderBox, borderW, borderH = 0, lastRepaintRect;\n\n\t\t\tstyle = self.getEl().style;\n\t\t\trect = self._layoutRect;\n\t\t\tlastRepaintRect = self._lastRepaintRect || {};\n\n\t\t\t// Detect old IE 7+8 add lineHeight to align caret vertically in the middle\n\t\t\tvar doc = document;\n\t\t\tif (!self.settings.multiline && doc.all && (!doc.documentMode || doc.documentMode <= 8)) {\n\t\t\t\tstyle.lineHeight = (rect.h - borderH) + 'px';\n\t\t\t}\n\n\t\t\tborderBox = self.borderBox;\n\t\t\tborderW = borderBox.left + borderBox.right + 8;\n\t\t\tborderH = borderBox.top + borderBox.bottom + (self.settings.multiline ? 8 : 0);\n\n\t\t\tif (rect.x !== lastRepaintRect.x) {\n\t\t\t\tstyle.left = rect.x + 'px';\n\t\t\t\tlastRepaintRect.x = rect.x;\n\t\t\t}\n\n\t\t\tif (rect.y !== lastRepaintRect.y) {\n\t\t\t\tstyle.top = rect.y + 'px';\n\t\t\t\tlastRepaintRect.y = rect.y;\n\t\t\t}\n\n\t\t\tif (rect.w !== lastRepaintRect.w) {\n\t\t\t\tstyle.width = (rect.w - borderW) + 'px';\n\t\t\t\tlastRepaintRect.w = rect.w;\n\t\t\t}\n\n\t\t\tif (rect.h !== lastRepaintRect.h) {\n\t\t\t\tstyle.height = (rect.h - borderH) + 'px';\n\t\t\t\tlastRepaintRect.h = rect.h;\n\t\t\t}\n\n\t\t\tself._lastRepaintRect = lastRepaintRect;\n\t\t\tself.fire('repaint', {}, false);\n\n\t\t\treturn self;\n\t\t},\n\n\t\t/**\n\t\t * Renders the control as a HTML string.\n\t\t *\n\t\t * @method renderHtml\n\t\t * @return {String} HTML representing the control.\n\t\t */\n\t\trenderHtml: function() {\n\t\t\tvar self = this, settings = self.settings, attrs, elm;\n\n\t\t\tattrs = {\n\t\t\t\tid: self._id,\n\t\t\t\thidefocus: '1'\n\t\t\t};\n\n\t\t\tTools.each([\n\t\t\t\t'rows',\t'spellcheck',\t'maxLength', 'size', 'readonly', 'min',\n\t\t\t\t'max', 'step', 'list', 'pattern', 'placeholder', 'required', 'multiple'\n\t\t\t], function(name) {\n\t\t\t\tattrs[name] = settings[name];\n\t\t\t});\n\n\t\t\tif (self.disabled()) {\n\t\t\t\tattrs.disabled = 'disabled';\n\t\t\t}\n\n\t\t\tif (settings.subtype) {\n\t\t\t\tattrs.type = settings.subtype;\n\t\t\t}\n\n\t\t\telm = DomUtils.create(settings.multiline ? 'textarea' : 'input', attrs);\n\t\t\telm.value = self.state.get('value');\n\t\t\telm.className = self.classes;\n\n\t\t\treturn elm.outerHTML;\n\t\t},\n\n\t\tvalue: function(value) {\n\t\t\tif (arguments.length) {\n\t\t\t\tthis.state.set('value', value);\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t// Make sure the real state is in sync\n\t\t\tif (this.state.get('rendered')) {\n\t\t\t\tthis.state.set('value', this.getEl().value);\n\t\t\t}\n\n\t\t\treturn this.state.get('value');\n\t\t},\n\n\t\t/**\n\t\t * Called after the control has been rendered.\n\t\t *\n\t\t * @method postRender\n\t\t */\n\t\tpostRender: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.getEl().value = self.state.get('value');\n\t\t\tself._super();\n\n\t\t\tself.$el.on('change', function(e) {\n\t\t\t\tself.state.set('value', e.target.value);\n\t\t\t\tself.fire('change', e);\n\t\t\t});\n\t\t},\n\n\t\tbindStates: function() {\n\t\t\tvar self = this;\n\n\t\t\tself.state.on('change:value', function(e) {\n\t\t\t\tif (self.getEl().value != e.value) {\n\t\t\t\t\tself.getEl().value = e.value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.state.on('change:disabled', function(e) {\n\t\t\t\tself.getEl().disabled = e.value;\n\t\t\t});\n\n\t\t\treturn self._super();\n\t\t},\n\n\t\tremove: function() {\n\t\t\tthis.$el.off();\n\t\t\tthis._super();\n\t\t}\n\t});\n});\n\n// Included from: js/tinymce/classes/Register.js\n\n/**\n * Register.js\n *\n * Released under LGPL License.\n * Copyright (c) 1999-2015 Ephox Corp. All rights reserved\n *\n * License: http://www.tinymce.com/license\n * Contributing: http://www.tinymce.com/contributing\n */\n\n/**\n * This registers tinymce in common module loaders.\n *\n * @private\n * @class tinymce.Register\n */\ndefine(\"tinymce/Register\", [\n], function() {\n\t/*eslint consistent-this: 0 */\n\tvar context = this || window;\n\n\tvar tinymce = function() {\n\t\treturn context.tinymce;\n\t};\n\n\tif (typeof context.define === \"function\") {\n\t\t// Bolt\n\t\tif (!context.define.amd) {\n\t\t\tcontext.define(\"ephox/tinymce\", [], tinymce);\n\t\t}\n\t}\n\n\treturn {};\n});\n\nexpose([\"tinymce/geom/Rect\",\"tinymce/util/Promise\",\"tinymce/util/Delay\",\"tinymce/Env\",\"tinymce/dom/EventUtils\",\"tinymce/dom/Sizzle\",\"tinymce/util/Tools\",\"tinymce/dom/DomQuery\",\"tinymce/html/Styles\",\"tinymce/dom/TreeWalker\",\"tinymce/html/Entities\",\"tinymce/dom/DOMUtils\",\"tinymce/dom/ScriptLoader\",\"tinymce/AddOnManager\",\"tinymce/dom/RangeUtils\",\"tinymce/html/Node\",\"tinymce/html/Schema\",\"tinymce/html/SaxParser\",\"tinymce/html/DomParser\",\"tinymce/html/Writer\",\"tinymce/html/Serializer\",\"tinymce/dom/Serializer\",\"tinymce/util/VK\",\"tinymce/dom/ControlSelection\",\"tinymce/dom/BookmarkManager\",\"tinymce/dom/Selection\",\"tinymce/Formatter\",\"tinymce/UndoManager\",\"tinymce/EditorCommands\",\"tinymce/util/URI\",\"tinymce/util/Class\",\"tinymce/util/EventDispatcher\",\"tinymce/util/Observable\",\"tinymce/ui/Selector\",\"tinymce/ui/Collection\",\"tinymce/ui/ReflowQueue\",\"tinymce/ui/Control\",\"tinymce/ui/Factory\",\"tinymce/ui/KeyboardNavigation\",\"tinymce/ui/Container\",\"tinymce/ui/DragHelper\",\"tinymce/ui/Scrollable\",\"tinymce/ui/Panel\",\"tinymce/ui/Movable\",\"tinymce/ui/Resizable\",\"tinymce/ui/FloatPanel\",\"tinymce/ui/Window\",\"tinymce/ui/MessageBox\",\"tinymce/WindowManager\",\"tinymce/ui/Tooltip\",\"tinymce/ui/Widget\",\"tinymce/ui/Progress\",\"tinymce/ui/Notification\",\"tinymce/NotificationManager\",\"tinymce/EditorObservable\",\"tinymce/Shortcuts\",\"tinymce/Editor\",\"tinymce/util/I18n\",\"tinymce/FocusManager\",\"tinymce/EditorManager\",\"tinymce/util/XHR\",\"tinymce/util/JSON\",\"tinymce/util/JSONRequest\",\"tinymce/util/JSONP\",\"tinymce/util/LocalStorage\",\"tinymce/Compat\",\"tinymce/ui/Layout\",\"tinymce/ui/AbsoluteLayout\",\"tinymce/ui/Button\",\"tinymce/ui/ButtonGroup\",\"tinymce/ui/Checkbox\",\"tinymce/ui/ComboBox\",\"tinymce/ui/ColorBox\",\"tinymce/ui/PanelButton\",\"tinymce/ui/ColorButton\",\"tinymce/util/Color\",\"tinymce/ui/ColorPicker\",\"tinymce/ui/Path\",\"tinymce/ui/ElementPath\",\"tinymce/ui/FormItem\",\"tinymce/ui/Form\",\"tinymce/ui/FieldSet\",\"tinymce/ui/FilePicker\",\"tinymce/ui/FitLayout\",\"tinymce/ui/FlexLayout\",\"tinymce/ui/FlowLayout\",\"tinymce/ui/FormatControls\",\"tinymce/ui/GridLayout\",\"tinymce/ui/Iframe\",\"tinymce/ui/InfoBox\",\"tinymce/ui/Label\",\"tinymce/ui/Toolbar\",\"tinymce/ui/MenuBar\",\"tinymce/ui/MenuButton\",\"tinymce/ui/MenuItem\",\"tinymce/ui/Throbber\",\"tinymce/ui/Menu\",\"tinymce/ui/ListBox\",\"tinymce/ui/Radio\",\"tinymce/ui/ResizeHandle\",\"tinymce/ui/SelectBox\",\"tinymce/ui/Slider\",\"tinymce/ui/Spacer\",\"tinymce/ui/SplitButton\",\"tinymce/ui/StackLayout\",\"tinymce/ui/TabPanel\",\"tinymce/ui/TextBox\"]);\n})(this);";
}},[1094]);